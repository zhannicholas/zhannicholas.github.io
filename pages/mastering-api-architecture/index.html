<!doctype html><html lang=zh-cn><head><meta http-equiv=content-type content="text/html" charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon type=image/png sizes=96x96 href=https://zhannicholas.github.io/favicon/favicon-96x96.png><link rel=icon type=image/png sizes=32x32 href=https://zhannicholas.github.io/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://zhannicholas.github.io/favicon/favicon-16x16.png><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title itemprop=name>Mastering API Architecture | NZ's Digital Garden</title><meta name=description content><meta property="og:title" content="Mastering API Architecture | NZ's Digital Garden"><meta name=twitter:title content="Mastering API Architecture | NZ's Digital Garden"><meta itemprop=name content="Mastering API Architecture | NZ's Digital Garden"><meta name=application-name content="Mastering API Architecture | NZ's Digital Garden"><meta property="og:site_name" content><meta property="og:type" content="website"><meta property="og:title" content="NZ's Digital Garden"><meta property="og:description" content><meta property="og:site_name" content="NZ's Digital Garden"><meta property="og:url" content="https://zhannicholas.github.io/pages/mastering-api-architecture/"><meta property="og:locale" content="en"><meta property="og:image" content="/"><meta property="og:image:secure_url" content="https://zhannicholas.github.io"><meta property="og:type" content="website"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=stylesheet href="/css/style.min.8458c1237ecc4766957580cbadcdbc3827551cb1e8f51d9fa5c37d7473a022e9.css" integrity="sha256-hFjBI37MR2aVdYDLrc28OCdVHLHo9R2fpcN9dHOgIuk="></head><body class="bg-zinc-100 dark:bg-gray-800"><div class="top-0 z-50 w-full text-gray-200 bg-gray-900 border-2 border-gray-900 md:sticky border-b-stone-200/10"><div x-data="{ open: false }" class="flex flex-col max-w-full px-4 mx-auto md:items-center md:justify-between md:flex-row md:px-6 lg:px-8"><div class="flex flex-row items-center justify-between p-4"><a href=https://zhannicholas.github.io/ class="flex text-gray-100 transition duration-1000 ease-in-out group"><div class="mt-1 text-xl font-black tracking-tight text-gray-100 uppercase transition-colors group-hover:text-gray-400/60">NZ's Digital Garden</div></a><button class="rounded-lg md:hidden focus:outline-none focus:shadow-outline" @click="open = !open" role=navigation aria-expanded=false aria-label=Main aria-controls=menuItems><svg fill="currentcolor" viewBox="0 0 20 20" class="w-6 h-6"><path x-show="!open" fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4A1 1 0 013 5zm0 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm6 5a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z" clip-rule="evenodd"/><path x-show="open" fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414.0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg></button></div><nav :class="{'flex': open, 'hidden': !open}" class="flex-col flex-grow hidden pb-4 md:pb-0 md:flex md:justify-end md:flex-row"><div @click.away="open = false" class=relative x-data="{ open: false }"><button @click="open = !open" class="flex flex-row items-center w-full px-4 py-2 mt-2 text-sm font-semibold text-left bg-transparent rounded-lg md:w-auto md:inline md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-600 focus:outline-none focus:shadow-outline">
<span>The Garden</span><svg fill="currentcolor" viewBox="0 0 20 20" :class="{'rotate-180': open, 'rotate-0': !open}" class="inline w-4 h-4 mt-1 ml-1 transition-transform duration-200 transform md:-mt-1"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414.0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414.0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg></button><div x-show=open x-transition:enter="transition ease-out duration-100" x-transition:enter-start="transform opacity-0 scale-95" x-transition:enter-end="transform opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="transform opacity-100 scale-100" x-transition:leave-end="transform opacity-0 scale-95" class="absolute right-0 z-30 w-full mt-2 origin-top-right rounded-md shadow-lg md:w-48"><div class="px-2 py-2 text-primary-900 bg-white rounded-md shadow"><a class="block px-4 py-2 mt-2 text-sm font-semibold bg-transparent rounded-lg md:mt-0 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-600 focus:outline-none focus:shadow-outline" href=https://zhannicholas.github.io/posts>Posts</a>
<a class="block px-4 py-2 mt-2 text-sm font-semibold bg-transparent rounded-lg md:mt-0 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-600 focus:outline-none focus:shadow-outline" href=https://zhannicholas.github.io/pages>Notes</a>
<a class="block px-4 py-2 mt-2 text-sm font-semibold bg-transparent rounded-lg md:mt-0 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href=https://zhannicholas.github.io/library>Library</a></div></div></div><a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href=https://zhannicholas.github.io/now>Now</a>
<a class="px-4 py-2 mt-2 text-sm font-semibold bg-transparent rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-primary-600 focus:bg-primary-700 focus:outline-none focus:shadow-outline" href=https://zhannicholas.github.io/about>About</a>
<button id=theme-toggle type=button class="p-2 text-sm text-gray-500 rounded-lg md: dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 md:ml-2 max-w-5 xs:hidden"><svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentcolor" viewBox="0 0 20 20" aria-label="Dark or Light Mode" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></nav></div></div><div class=content><article><header class="max-w-2xl mx-auto mb-4 bg-primary-600"><span class=py-96><h1 class="px-6 pt-6 pb-16 mx-auto dark:prose-invert text-5xl font-black text-center text-white capitalize">Mastering API Architecture</h1></span></header><div class="max-w-4xl mx-auto mt-8 mb-2"><div class=px-6></div></div><div class="fixed z-20 top-[3.8125rem] bottom-0 right-[max(0px,calc(50%-45rem))] w-[18rem] py-10 overflow-y-auto hidden xl:block"><nav><div class="flex items-center"><h2 class="pl-2 my-0 text-xl font-medium text-zinc-800 uppercase break-words">Table of Contents</h2></div><div class="absolute top-auto bottom-auto right-auto p-0 -left-4" role=menu><div class="relative z-50 max-w-sm m-4 overflow-hidden shadow-lg"><ul class="relative p-4 overflow-x-hidden overflow-y-auto overscroll-y-auto overscroll-x-auto"><li><a class="px-2 text-left text-zinc-700 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#introduction>Introduction</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#chapter-1-design-build-and-specify-apis>Chapter 1. Design, Build and Specify APIs</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#chapter-2-testing-apis>Chapter 2. Testing APIs</a><ul><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#testing-strategies>Testing Strategies</a><ul><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#testing-quadrant>Testing Quadrant</a></li></ul></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#contract-testing>Contract Testing</a><ul><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#contract-methodologies>Contract Methodologies</a></li></ul></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#api-component-testing>API Component Testing</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#api-integration-testing>API Integration Testing</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#end-to-end-testing>End-to-End Testing</a></li></ul></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#chapter-3-api-gateways-ingress-traffic-management>Chapter 3. API Gateways: Ingress Traffic Management</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#chapter-4-service-mesh-service-to-service-traffic-management>Chapter 4. Service Mesh: Service-to-Service Traffic Management</a><ul><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#service-mesh>Service Mesh</a></li></ul></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#chapter-5-deploying-and-releasing-apis>Chapter 5. Deploying and Releasing APIs</a><ul><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#separating-deployment-and-release>Separating Deployment and Release</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#release-strategies>Release Strategies</a><ul><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#canary-release>Canary Release</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#traffic-mirroring>Traffic Mirroring</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#blue-green>Blue-Green</a></li></ul></li></ul></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#chapter-6-operational-security-threat-modeling-for-apis>Chapter 6. Operational Security: Threat Modeling for APIs</a><ul><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#threat-modeling>Threat Modeling</a></li></ul></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#chapter-7-api-authentication-and-authorization>Chapter 7. API Authentication and Authorization</a><ul><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#authentication>Authentication</a><ul><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#end-user-authentication-with-tokens>End User Authentication with Tokens</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#system-to-system-authentication>System-to-System Authentication</a></li></ul></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#oauth2>OAuth2</a><ul><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#json-web-tokens-jwt>JSON Web Tokens (JWT)</a><ul><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#encoding-and-verifying-jwt>Encoding and Verifying JWT</a></li></ul></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#terminology-and-mechanisms-of-oauth2-grants>Terminology and Mechanisms of OAuth2 Grants</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#authorization-code-grant>Authorization Code Grant</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#refresh-tokens>Refresh Tokens</a></li></ul></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#oidc>OIDC</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#saml-20>SAML 2.0</a></li></ul></li></ul></div></div></nav></div><div class="max-w-2xl px-6 pt-6 pb-16 mx-auto prose dark:prose-invert dark:text-white"><p>This is my reading notes of <a href=https://learning.oreilly.com/library/view/mastering-api-architecture/9781492090625/ target=_blank>Mastering API Architecture (oreilly.com)</a>
.</p><h1 id=introduction>Introduction</h1><ul><li><p>Broadly speaking, APIs can be broken into two general categories depending on whether the API invocation is in process or out of process.</p><ul><li><p>The process being referred to here is an operating system (OS) process.</p></li><li><p><em>In process</em> means the call is handled by the same process from which the call was made, such as a Java method invocation from one class to another.</p></li><li><p><em>Out of process</em> means the call is handled by additional external process other than the process from which the call was made. Typically, an out of process API call will involve data traversing a network.</p></li><li><p>This book is focus on <strong>out of process</strong> API calls.</p></li></ul></li><li><p>Generally speaking, <strong>north-south traffic</strong> is traffic that is ingressing from an external location into your system. <strong>East-west traffic</strong> is transiting internally from system-to-system or service-to-service.</p></li></ul><h1 id=chapter-1-design-build-and-specify-apis>Chapter 1. Design, Build and Specify APIs</h1><ul><li>This chapter covers how to design, build and specify APIs and the different circumstances under which you may choose REST or gRPC. <strong>It is important to remember that it is not REST vs gRPC, but rather given the situations what is the most appropriate choice for modelling the exchange</strong>.<ul><li><p>The barrier to building REST and RPC based APIs is low in most technologies, carefully considering the design and structure is an important architectural decision.</p></li><li><p>When choosing between REST and RPC models, consider the Richardson Maturity model and the degree of coupling between the producer and consumer.</p></li><li><p>REST is a fairly loose standard. When building APIs, conforming to an agreed API Standard ensures your APIs are consistent and have the expected behavior for your consumers. API Standards can also help to short circuit potential design decisions that could lead to an incompatible API.</p></li><li><p>OpenAPI specifications are a useful way of sharing API structure and automating many coding related activities. You should actively select OpenAPI features and choose what tooling or generation features will be applied to projects.</p></li><li><p>Versioning is an important topic that adds complexity for the producer but is necessary to ease API usage for the consumer. Not planning for versioning in APIs exposed to consumers is dangerous. Versioning should be an active decision in the product feature set and a mechanism to convey versioning to consumers should be part of the discussion.</p></li><li><p>gRPC performs incredibly well in high bandwidth exchanges and is an ideal option for east → west exchanges. Tooling for gRPC is powerful and provides another option when modelling exchanges.</p></li><li><p>Modelling multiple specifications starts to become quite tricky, especially when generating from one type of specification to another. Versioning complicates matters further but is an important factor to avoid breaking changes. Teams should think carefully before combining RPC representations with RESTful API representations, as there are fundamental differences in terms of usage and control over the consumer code.</p></li></ul></li></ul><h1 id=chapter-2-testing-apis>Chapter 2. Testing APIs</h1><ul><li><h2 id=testing-strategies>Testing Strategies</h2><ul><li><p>We need to be smart about deciding upon the coverage and proportions of the types of tests you should be using.</p><ul><li>Avoid creating irrelevant tests, duplicating tests, and any tests that are going to take more time and resources than the value they provide</li></ul></li><li><h3 id=testing-quadrant>Testing Quadrant</h3><ul><li><p>The testing quadrant brings together tests that help technology and business stakeholders alike, each perspective will have different opinion on priorities.</p></li><li><p><strong>Agile Testing Quadrants</strong></p></li></ul></li></ul></li></ul><p><img src=https://lisacrispin.com/wp-content/uploads/2011/11/agile-testing-quadrants.png alt></p><pre><code>    + Read [Using the Agile Testing Quadrants]([Using the Agile Testing Quadrants - Agile Testing with Lisa Crispin](https://lisacrispin.com/2011/11/08/using-the-agile-testing-quadrants/)) from Lisa Crispin.

    + The four quadrants can be generally described as follows:

      + Q1 Unit and Component tests for technology, these should verify that **the service that has been created works** and this verification should be performed using automated testing.

      + Q2 Tests with the business are to ensure **what is being built is serving a purpose**, this is verified with automated testing and can also include manual testing.

      + Q3 Testing for the business, this is about ensuring that **functional requirements are met** and also to includes exploratory testing.

      + Q4 Ensuring that **what exists works from a technical standpoint**. From Q1 you know that what has been built works, however, when the product is being used, is it performing as expected. Examples of performing correctly from a technical standpoint could include, security enforcement, SLA integrity, autoscaling.

    + Each side of the quadrant has different purpose:

      + The left side of quadrant (Q1, Q2) is all about supporting the product it helps guide the product and prevent defects.

      + The right side (Q3, Q4) is about critiquing the product and finding defects.

      + The top of the pyramid (Q2,Q3) is the external quality of your product, making sure that it meets our users expectations, this is what the business find important.

      + The bottom of the pyramid (Q1, Q4) are the technology facing tests to maintain the internal quality of our application.

+ ### Testing Pyramid

  + The test pyramid, also known as the test automation pyramid, can be used as part of your strategy for test automation.
</code></pre><p><img src=https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492090625/files/assets/maar_0203.png alt></p><pre><code>  + The test automation pyramid shows the tradeoffs that exist in terms of confidence, isolation and scope.

    + Testing small parts of the codebase gives us better isolation and faster tests, but less confidence that the whole application is working.

    + Testing the entire application gives use more confidence that the application is working. However, the scope of test will be large, it also makes it more difficult to maintain and slow.

  + This pyramid illustrates a notion of how much time should be spent on a given test area, its corresponding difficulty to maintain, and the value it provides in terms of additional confidence.

    + Unit tests, are at the bottom of the pyramid, they form the foundation of your testing. They test small, isolated units of your code to ensure that your defined unit is running as expected.

    + Service tests make up the middle tier, they will provide you with more confidence that your API is working correctly than unit tests. But a larger scope and less isolation comes with more expense.

    + UI tests sit at the top of the testing pyramid, it covers the same ground of a request flowing from a start to an end point.
</code></pre><ul><li><h2 id=contract-testing>Contract Testing</h2><ul><li><p>Contract testing has two entities, a consumer and a producer.</p><ul><li><p>A consumer requests data from an API (e.g. web client, terminal shell)</p></li><li><p>and a producer (also known as a provider) responds to the API requests, i.e. it is producing data, such as a RESTful Web Service.</p></li></ul></li><li><p>A contract is a definition of an <strong>interaction</strong> between the consumer and producer. It is a statement to say if a consumer makes a request that matches the contract request definition, then the producer will return a response that matches the contract response definition.</p></li><li><div class=tip>A key benefit of using contracts is that once a contract is agreed to be implemented by the producer, then this decouples the dependency of building the consumer and producer.</div></li><li><p>By having a written definition of an interaction, it is possible to generate a tests. The contract defines what a request and response should look like and these can be used to verify the producer (the API) is fulfilling the contract.</p></li><li><p>As the contract has the response definition it is also possible to generate a stub server. This stub server can be used by consumers to verify that they can call the producer correctly and parse the response from the producer.</p><ul><li><div class=tip>A stub server is a service that can be run locally and will return pre-canned responses.</div></li></ul></li><li><h3 id=contract-methodologies>Contract Methodologies</h3><ul><li><p><strong>Producer Contracts</strong></p><ul><li><p>Producer contract testing is when a producer defines its own contracts. This practice is used when there is when your API is being used outside your immediate organization.</p></li><li><div class=caution>When developing an API for an external audience it needs to maintain its integrity as the interface can not make breaking changes without a migration plan.</div></li><li><p>Producer driven contracts is ideal to build an <strong>external</strong> API.</p></li></ul></li><li><p><strong>Consumer Driven Contracts (CDC)</strong></p><ul><li><p>Consumer Driven Contracts are implemented by a consumer driving the functionality that they wish to see in an interaction. Consumers submit contracts, or changes to a contract, to the producer for new or additional API functionality.</p></li><li><p>CDC is ideal to build an <strong>internal</strong> API.</p></li></ul></li></ul></li></ul></li><li><h2 id=api-component-testing>API Component Testing</h2><ul><li><p>Component testing can be used to validate that multiple units work together and should be used to validate behavior.</p></li><li><p><strong>Component tests should not call out to external dependencies</strong>, like contract testing, you are not using these tests to verify external integration points.</p></li></ul></li><li><h2 id=api-integration-testing>API Integration Testing</h2><ul><li><p>Integration tests are tests across boundaries between the module being developed and any external dependencies.</p></li><li><p>When performing integration testing, you want to confirm that the communication across the boundary is correct, i.e. your service can correctly communicate with another service that is external to it.</p></li></ul></li><li><h2 id=end-to-end-testing>End-to-End Testing</h2><ul><li><p>The essence of end-to-end testing is to test services and their dependencies together to verify it works as expected.</p></li><li><p>Using end-to-end tests replicate core user journeys to help validate your APIs all integrate correctly.</p></li></ul></li></ul><h1 id=chapter-3-api-gateways-ingress-traffic-management>Chapter 3. API Gateways: Ingress Traffic Management</h1><ul><li><blockquote><p>Expose your APIs and manage associated ingress traffic from end users and other external systems in a reliable, observable, and secure way using an API gateway.</p></blockquote></li><li><p>An API gateway is a critical part of any modern technology stack, a <em>management tool</em> that sits at the network “edge” of systems between a consumer and a collection of backend services, and acts as a <em>single point of entry for a defined group of APIs</em>.</p></li><li><p>An API gateway is implemented with two high-level fundamental components, a <strong>control plane</strong> and <strong>data plane</strong>.</p><ul><li><p>The control plane is where operators interact with the gateway and define routes, policies, and required telemetry.</p></li><li><p>The data plane is the location where all of the work specified in the control plane occurs; where the network packets are routed, the policies enforced, and telemetry emitted.</p></li></ul></li><li><p>Proxy, forward proxy, and reverse proxy</p><ul><li><p>A proxy server, sometimes referred to as a forward proxy, is an intermediary server that forwards requests for content from multiple clients to different servers across the Internet. <strong>A forward proxy is used to protect clients.</strong></p><ul><li>[[draws/2022-08-30-16-20-51.excalidraw]]</li></ul></li><li><p>A reverse proxy server, on the other hand, is a type of proxy server that typically sits behind the firewall in a private network and routes client requests to the appropriate backend server. <strong>A reverse proxy is designed to protect servers</strong>.</p><ul><li>[[draws/2022-08-30-16-50-33.excalidraw]]</li></ul></li></ul></li><li><p><strong>Why use an API gateway?</strong></p><ul><li><p>Reduce Coupling</p><ul><li>Adapter / Facade Between Frontends and Backends</li></ul></li><li><p>Simplify Consumption</p><ul><li>Aggregating / Translating Backend Services</li></ul></li><li><p>Protect APIs from Overuse and Abuse</p><ul><li>Threat Detection and Mitigation</li></ul></li><li><p>Understand How APIs Are Being Consumed</p><ul><li>Observability</li></ul></li><li><p>Manage APIs as Products</p><ul><li>API Lifecycle Management</li></ul></li><li><p>Monetize APIs</p><ul><li>Account Management, Billing, and Payment</li></ul></li></ul></li><li><p>API Gateway as a single Point of Failure</p><ul><li><p>In a typical web-based system, the first obvious single point of failure is typically <strong>DNS</strong>.</p></li><li><p>The next single points of failure will typically then be the <strong>global and regional layer 4 load balancers</strong>, and depending on the deployment location and configuration, the security edge components, such as the firewall or WAF.</p></li><li><p>After these core edge components, the next layer is typically the <strong>API gateway</strong>.</p></li></ul></li></ul><h1 id=chapter-4-service-mesh-service-to-service-traffic-management>Chapter 4. Service Mesh: Service-to-Service Traffic Management</h1><ul><li><blockquote><p>Manage traffic for internal APIs, i.e. service-to-service communication.</p></blockquote></li><li><h2 id=service-mesh>Service Mesh</h2><ul><li><p>Fundamentally, “service mesh” is a pattern for managing all service-to-service (or application-to-application) communication within a distributed software system.</p></li><li><p><strong>Service mesh vs API gateway</strong></p><ul><li><p>There is a lot of overlap between the service mesh and API gateway patterns, with the primary differences being twofold.</p><ul><li><p>First, service mesh implementations are optimized to handle service-to-service, or east-west, traffic within a cluster or data center.</p></li><li><p>Second, following from this, the originator of the communication is typically a (somewhat) known internal service, rather than a user’s device or a system running external to your applications.</p></li></ul></li><li><p>Unlike an API gateway, the mapping from a service mesh data plane to a service is typically one-to-one, meaning that a service mesh proxy does not aggregate calls across multiple services.</p></li></ul></li><li><p>A service mesh is implemented with two high-level fundamental components, a <strong>control plane</strong> and a <strong>data plane</strong>.</p><ul><li><div class=note>In a service mesh these components are always deployed <strong>separately</strong>.</div></li><li><p>The control plane is where operators interact with the service mesh and define routes, policies, and required telemetry.</p></li><li><p>The data plane is the location where all of the work specified in the control plane occurs; where the network packets are routed, the policies enforced, and telemetry emitted.</p></li></ul></li><li><p>Differences between ingress (north-south) and service-to-service(east-west) traffic properties</p><ul><li><table><thead><tr><th></th><th>Ingress (n/s)</th><th>Service-to-service (e/w)</th></tr></thead><tbody><tr><td>Traffic source</td><td>External (user, third-party, Internet)</td><td>Internal (within trust boundary)</td></tr><tr><td>Traffic destination</td><td>Public or business-facing API, or web site</td><td>Service or domain API</td></tr><tr><td>Authentication</td><td>“user” (real world entity) focused</td><td>“service” (machine entity) and “user” (real world entity) focused</td></tr><tr><td>Authorization</td><td>“user” roles or capability level</td><td>“service” identity or network segment focused, and “user” roles or capability level</td></tr><tr><td>TLS</td><td>One-way, often enforced (e.g. protocol upgrade)</td><td>Mutual, can be made mandatory (strict mTLS)</td></tr><tr><td>Primary implementations</td><td>API gateway, reverse proxy</td><td>Service mesh, application libraries</td></tr><tr><td>Primary owner</td><td>Gateway/networking/ops team</td><td>Platform/cluster/ops team</td></tr><tr><td>Organizational users</td><td>Architects, API managers, developers</td><td>developer</td></tr></tbody></table></li></ul></li><li><p>Evolution of service mesh</p></li></ul></li></ul><p><img src=https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492090625/files/assets/maar_0405.png alt></p><h1 id=chapter-5-deploying-and-releasing-apis>Chapter 5. Deploying and Releasing APIs</h1><ul><li><h2 id=separating-deployment-and-release>Separating Deployment and Release</h2><ul><li><p>Thoughtworks Technology Radar has a great explanation of the difference between deployment and release.</p><ul><li><blockquote class=hint>Implementing Continuous Delivery continues to be a challenge for many organizations, and it remains important to highlight useful techniques such as decoupling deployment from release. We recommend strictly using the term Deployment when referring to the act of deploying a change to application components or infrastructure. The term Release should be used when a feature change is released to end users, with a business impact. Using techniques such as feature toggles and dark launches, we can deploy changes to production systems more frequently without releasing features. More-frequent deployments reduce the risk associated with change, while business stakeholders retain control over when features are released to end users.
Thoughtworks Technology Radar 2016</blockquote></li></ul></li><li><p>In a word, Release means bringing live traffic over to our new deployment.</p></li><li><p>Feature flags are typically hosted in a configuration store outside of the running application and allows code to be deployed with the feature off.</p></li></ul></li><li><h2 id=release-strategies>Release Strategies</h2><ul><li><p>It is important to choose a release strategy that allows you to reduce risk in production, perform a test or experiment and verify before completely release the change.</p></li><li><h3 id=canary-release>Canary Release</h3><ul><li>A canary releases introduces a new version of the software and flow a small percentage of the traffic to the canary.</li></ul></li><li><h3 id=traffic-mirroring>Traffic Mirroring</h3><ul><li><p>We can also use traffic mirroring to copy or duplicate traffic and send this to an additional location or series of locations.</p><ul><li><div class=note>Frequently with traffic mirroring, the results of the duplicated requests are not returned to the calling service or end user. Instead the responses are evaluated out-of-band for correctness.</div></li></ul></li></ul></li><li><h3 id=blue-green>Blue-Green</h3><ul><li><p>Blue-Green is usually implemented at a point in the architecture which uses a router, gateway or load balancer, behind which sits a complete blue environment and a green environment.</p><ul><li><p>The current blue environment represents the current live environment and the green environment represents the next version of the stack.</p></li><li><p>The green environment is checked prior to switching live traffic, and at go live the traffic is flipped over from blue to green. The blue environment is now “off”, but if a problem is spotted it is a quick rollback. The next change would go from green to blue, oscillating from first release onward.</p></li></ul></li><li></li></ul></li></ul></li><li></li><li></li></ul><h1 id=chapter-6-operational-security-threat-modeling-for-apis>Chapter 6. Operational Security: Threat Modeling for APIs</h1><ul><li><p><a href=https://www.owasp.org target=_blank>OWASP (Open Web Application Security Project)</a>
is a nonprofit foundation that works to improve the security of software.</p></li><li><h2 id=threat-modeling>Threat Modeling</h2><ul><li><blockquote><p>Threat modeling is a “technique you can use to help you identify threats, attacks, vulnerabilities, and countermeasures that could affect your application”</p></blockquote></li><li><p>You don’t need to be a security expert to conduct threat modeling, and a key skill is “thinking like an attacker or a bad actor”.</p></li><li><p>The process of threat modeling includes:</p><ul><li><p>Identify your objectives - Create a list of the business and security objectives. Keep them simple e.g. Avoid unauthorized access.</p></li><li><p>Gather the right information - Generate a high-level design of the system and ensure you have the right information.</p></li><li><p>Decompose the system - Break down your high-level design so that you can start to model the threats.</p></li><li><p>Identify threats - Systematically look for threats to your systems.</p><ul><li><a href=https://shostack.org/files/microsoft/The-Threats-To-Our-Products.docx target=_blank>STRIDE</a>
is a methodology to identify threats.</li></ul></li><li><p>Evaluate the risk of the threats - Prioritize threats to focus on the most likely ones, then identify mitigations to these likely threats.</p></li><li><p>Validate - Ask yourself and your team if the changes in place have been successful. Should you perform another review?</p></li></ul></li><li><p><strong>STRIDE</strong> &mdash; a methodology to identify threats</p><ul><li><p><strong>S</strong>poofing（欺骗/仿冒）: Breaching the user’s authentication information.</p><ul><li>In this case, the hacker has obtained the user’s personal information or something that enables him to replay the authentication procedure.</li></ul></li><li><p><strong>T</strong>ampering（篡改）: Modifying system or user data with or without detection.</p><ul><li><p>There are two primary ways that tampering occurs, through payload injection and mass assignment.</p><ul><li><p>Payload injection occurs when a bad actor attempts to inject a malicious payload into the request made to an API or application. SQL Injection is a typical example.</p></li><li><p>Mass Assignment is typical where client input data is bound to internal objects without thought of the repercussions, which is often a consequence when exposing a database API as an web-based API. （例如 API 反映出了数据库设计）</p></li></ul></li></ul></li><li><p><strong>R</strong>epudiation（否认）: An untrusted user performing an illegal operation without the ability to be traced. Repudiability threats are associated with users (malicious or otherwise) who can deny a wrongdoing without any way to prove otherwise.</p></li><li><p><strong>I</strong>nformation disclosure（信息暴露，privacy breach (侵犯隐私)）: Compromising the user’s private or business-critical information. Information disclosure threats expose information to individuals who are not supposed to see it.</p><ul><li><p>Two common antipatterns in this category of threat include excessive data exposure and improper assets management.</p><ul><li><p><a href=https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa3-excessive-data-exposure.md target=_blank>Excessive data exposure</a>
means data is exposed inappropriately and this should be prevented.</p></li><li><p><a href=https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa9-improper-assets-management.md target=_blank>Improper Asset Management</a>
 typically occurs as your systems evolves, and the organization loses track of which APIs (and which versions) are exposed, or which APIs were designed for internal consumption only.</p></li></ul></li></ul></li><li><p><strong>D</strong>enial of Service（拒绝服务）: Making the system temporarily unavailable or unusable.</p><ul><li><p><strong>Rate limiting</strong>: limits the amount of requests that can be made to your API over a period of time.</p><ul><li><div class=tip>The use of rate limiting typically refers to rejecting traffic based on properties of individual requests (too many from a given user, client application, or location).</div></li><li><p>Limiting strategy</p><ul><li><p>Fixed window （固定窗口） - A fixed limit within a period, e.g. 2400 requests per day</p></li><li><p>Sliding window （滑动窗口） - A limit within the last period, e.g. 100 requests within the last hour</p></li><li><p>Token bucket （令牌桶）- A set amount of total requests are allowed (bucket of tokens) and each request takes a token when a request is made, the bucket is refilled periodically.</p></li><li><p>Leaky bucket （漏桶）- Like the Token bucket, however, the rate at which requests are processed is a fixed rate, this is the leak of the bucket.</p></li></ul></li></ul></li><li><p><strong>Load-shedding</strong> refers to rejecting requests based on the overall state of the system (database at capacity, no more worker threads available).</p></li></ul></li><li><p><strong>E</strong>levation of privilege（特权提升）: An unprivileged user gains privileged access and thereby has sufficient access to completely compromise or destroy the entire system.</p></li></ul></li></ul></li></ul><h1 id=chapter-7-api-authentication-and-authorization>Chapter 7. API Authentication and Authorization</h1><ul><li><p>OAuth2 is the defacto standard for securing APIs, often leverage JWT as part of the bearer header. JWT tokens are often encoded and signed to ensure they are tamper free.</p></li><li><h2 id=authentication>Authentication</h2><ul><li><p>Authentication is the act of verifying an identity (who you are?).</p></li><li><p>MFA is useful to give higher levels of assurance that the user is who they say they are.</p></li><li><p>For machine-to-machine authentication credentials can be in the form of keys or certificates.</p></li><li><h3 id=end-user-authentication-with-tokens>End User Authentication with Tokens</h3><ul><li><p>In token based authentication the user would enter their username and password which is exchanged for a token.</p><ul><li><p>The token is sent in the REST request as part of the <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication target=_blank>Authentication Bearer header</a>
.</p></li><li><p>Though tokens have the advantage that long-lived credentials, such as passwords, are not going across the network for every request to access resources, they should have a limited lifetime.</p></li></ul></li></ul></li><li><h3 id=system-to-system-authentication>System-to-System Authentication</h3><ul><li><p>In some situations an end user is not involved in the interaction and system-to-system communication is required.</p><ul><li><p>One option would be to use an API key, it&rsquo;s very similar to password when using.</p><ul><li><p>To use API Keys for Authentication you simply add the API key into a request header and send it to the endpoint.</p></li><li><p>The API key is associated with an application or project, so it is possible to identify the requester.</p></li></ul></li></ul></li></ul></li></ul></li><li><h2 id=oauth2>OAuth2</h2><ul><li><p>OAuth2, the replacement for <a href=https://oauth.net/core/1.0/ target=_blank>OAuth</a>
, is a token based authorization framework.</p></li><li><p>OAuth2 allows a user to consent that a third-party application can access their data on their behalf.</p><ul><li><p>The consent that the user gives is the authorization, they are allowing or denying the access.</p></li><li><div class=note>OAuth2 removes a need for a user to hand over their credentials to the third party, this gives the user control over their data.</div></li></ul></li><li><h3 id=different-roles-in-oauth2-specificationhttpsdatatrackerietforgdochtmlrfc6749section-11>Different roles in <a href=https://datatracker.ietf.org/doc/html/rfc6749#section-1.1 target=_blank>OAuth2 Specification</a>
:</h3><ul><li><p><strong>Resource Owner</strong>: An entity capable of granting access to a protected resource. When the resource owner is a person, it is referred to as an end-user.</p></li><li><p><strong>Authorization Server</strong>: The server issuing access tokens to the client after successfully authenticating the resource owner and obtaining authorization. The Authorization Server has two endpoints:</p><ul><li><p>The Authorization Endpoint, is used when a <em>resource owner</em> needs to authorize access to protected resources.</p></li><li><p>The Token Endpoint, requests is made by a <em>client</em> to get an Access Token.</p></li></ul></li><li><p><strong>Client</strong>: An application making protected resource requests on behalf of the resource owner and with its authorization</p></li><li><p><strong>Resource Server</strong>: The server hosting the protected resources, capable of accepting and responding to protected resource requests using access tokens.</p></li></ul></li><li><h3 id=json-web-tokens-jwt>JSON Web Tokens (JWT)</h3><ul><li><p><a href=https://datatracker.ietf.org/doc/html/rfc7519 target=_blank>JSON (JavaScript Object Notation) Web Tokens</a>
are an RFC standardized token format that is the defacto standard token for OAuth2.</p></li><li><p>A JSON Web Token also known as a JWT (pronounced “jot”), consists of <a href=https://datatracker.ietf.org/doc/html/rfc7519#section-4 target=_blank>claims</a>
and these claims have associated values.</p></li><li><p>JWTs are structured and encoded using standards to ensure the token is unmodifiable and additionally can be encrypted.</p></li><li><h4 id=encoding-and-verifying-jwt>Encoding and Verifying JWT</h4><ul><li><p>There are two popular encoding mechanisms for JWT</p><ul><li><p><a href=https://datatracker.ietf.org/doc/html/rfc7515 target=_blank>JWS (JSON Web Signatures)</a>
provides integrity to a JWT, the content’s of the token are visible to anyone that receives the token.</p></li><li><p><a href=https://datatracker.ietf.org/doc/html/rfc7516 target=_blank>JWE (JSON Web Encryption)</a>
provides integrity but is also encrypted, this means that the content of the token can not be examined.</p></li><li><div class=tip>It is commonplace that when the term JWT is used, the implied meaning is JWT using JWS and that the term Encrypted JWT is using JWE.</div></li></ul></li></ul></li></ul></li><li><h3 id=terminology-and-mechanisms-of-oauth2-grants>Terminology and Mechanisms of OAuth2 Grants</h3><ul><li>OAuth2 is designed to be extensible. The <a href=https://datatracker.ietf.org/doc/html/rfc6749#section-1.2 target=_blank>Abstract Protocol Flow</a>
:</li></ul></li></ul></li></ul><p><code>txt +--------+ +---------------+ | |--(A)- Authorization Request ->| Resource | | | | Owner | | |&lt;-(B)-- Authorization Grant ---| | | | +---------------+ | | | | +---------------+ | |--(C)-- Authorization Grant -->| Authorization | | Client | | Server | | |&lt;-(D)----- Access Token -------| | | | +---------------+ | | | | +---------------+ | |--(E)----- Access Token ------>| Resource | | | | Server | | |&lt;-(F)--- Protected Resource ---| | +--------+ +---------------+</code></p><pre><code>  + The flow includes the following steps:


    + 1. The *Client* requests *Authorization* from the *Resource Owner*.
</code></pre><ol start=2><li><p>The <em>Resource Owner</em> will grant or deny the <em>Client</em> access to their resources.</p></li><li><p>The <em>Client</em> will ask for an <em>Access Token</em> from the <em>Authorization Server</em> for the Authorization it has been granted.</p></li><li><p>The <em>Authorization Server</em> will issue an <em>Access Token</em> if the <em>Client</em> has been Authorized by the <em>Resource Owner</em>.</p></li><li><p>The <em>Client</em> makes a request for the resource to the <em>Resource Server</em>, which in our case is the API. The request will send the <em>Access Token</em> as part of the request.</p></li><li><p>The <em>Resource Server</em> will return the Resource if the Access Token is valid.</p><ul><li><h3 id=authorization-code-grant>Authorization Code Grant</h3><ul><li>The <a href=https://datatracker.ietf.org/doc/html/rfc6749#section-4.1 target=_blank>authorization code grant</a>
type is used to obtain both access tokens and refresh tokens and is optimized for confidential clients.</li></ul></li></ul></li></ol><p>`txt
+&mdash;&mdash;&mdash;-+
| Resource |
| Owner |
| |
+&mdash;&mdash;&mdash;-+
^
|
(B)
+&mdash;-|&mdash;&ndash;+ Client Identifier +&mdash;&mdash;&mdash;&mdash;&mdash;+
| -+&mdash;-(A)&ndash; & Redirection URI &mdash;->| |
| User- | | Authorization |
| Agent -+&mdash;-(B)&ndash; User authenticates &mdash;>| Server |
| | | |
| -+&mdash;-(C)&ndash; Authorization Code &mdash;&lt;| |
+-|&mdash;-|&mdash;+ +&mdash;&mdash;&mdash;&mdash;&mdash;+
| | ^ v
(A) (C) | |
| | | |
^ v | |
+&mdash;&mdash;&mdash;+ | |
| |>&mdash;(D)&ndash; Authorization Code &mdash;&mdash;&mdash;&rsquo; |
| Client | & Redirection URI |
| | |
| |&lt;&mdash;(E)&mdash;&ndash; Access Token &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-'
+&mdash;&mdash;&mdash;+ (w/ Optional Refresh Token)</p><p>Note: The lines illustrating steps (A), (B), and (C) are broken into
two parts as they pass through the user-agent.
`</p><pre><code>  + The flow above includes the following steps:


    + (A)  The client initiates the flow by directing the resource owner's
  user-agent to the authorization endpoint.  The client includes
  its client identifier, requested scope, local state, and a
  redirection URI to which the authorization server will send the
  user-agent back once access is granted (or denied).

    + (B)  The authorization server authenticates the resource owner (via
  the user-agent) and establishes whether the resource owner
  grants or denies the client's access request.

    + (C)  Assuming the resource owner grants access, the authorization
  server redirects the user-agent back to the client using the
  redirection URI provided earlier (in the request or during
  client registration).  The redirection URI includes an
  authorization code and any local state provided by the client
  earlier.

    + (D)  The client requests an access token from the authorization
  server's token endpoint by including the authorization code
  received in the previous step.  When making the request, the
  client authenticates with the authorization server.  The client
  includes the redirection URI used to obtain the authorization
  code for verification.

    + (E)  The authorization server authenticates the client, validates the
  authorization code, and ensures that the redirection URI
  received matches the URI used to redirect the client in
  step (C).  If valid, the authorization server responds back with
  an access token and, optionally, a refresh token.

  + #### Authorization Code Grant (+ PKCE)


    + PKCE stands for Proof Key for Code Exchange, and is used to mitigate interception attacks.

    + [Authorization Code Grant + PKCE](https://datatracker.ietf.org/doc/html/rfc7636#section-1.1) protocol flow:
</code></pre><p><code>txt +-------------------+ | Authz Server | +--------+ | +---------------+ | | |--(A)- Authorization Request ---->| | | | | + t(code_verifier), t_m | | Authorization | | | | | | Endpoint | | | |&lt;-(B)---- Authorization Code -----| | | | | | +---------------+ | | Client | | | | | | +---------------+ | | |--(C)-- Access Token Request ---->| | | | | + code_verifier | | Token | | | | | | Endpoint | | | |&lt;-(D)------ Access Token ---------| | | +--------+ | +---------------+ | +-------------------+</code></p><pre><code>    + The flow above includes the following steps:

      + 1. The authorization request is made and the code_verifier is sent to the authorization server. In the Diagram  `t(code_verifier)`  is the transformation of the code_verifier to the code_challenge and  `t_m`  is the transformation method, as described previously this is a hash.
</code></pre><ol start=2><li><p>Like in the Authorization Code Grant an authorization code is returned.</p></li><li><p>The client requests the access token by sending the authorization Request which is authorization code and the code_verifier. No client secret is sent as this is a public client.</p></li><li><p>The Access Token is then issued to the client application.</p><ul><li><h3 id=refresh-tokens>Refresh Tokens</h3><ul><li><p>It is good practice to issue tokens that are short-lived, however asking a user to re-enter their username and password would soon become a jarring experience.</p></li><li><p>A refresh token is a long-lived token used by the client to request additional access tokens when the previous expires.</p></li><li><p>Refresh token <a href=https://datatracker.ietf.org/doc/html/rfc6749#section-1.5 target=_blank>work flow</a></p></li></ul></li></ul></li></ol><p><code>txt +--------+ +---------------+ | |--(A)------- Authorization Grant --------->| | | | | | | |&lt;-(B)----------- Access Token -------------| | | | & Refresh Token | | | | | | | | +----------+ | | | |--(C)---- Access Token ---->| | | | | | | | | | | |&lt;-(D)- Protected Resource --| Resource | | Authorization | | Client | | Server | | Server | | |--(E)---- Access Token ---->| | | | | | | | | | | |&lt;-(F)- Invalid Token Error -| | | | | | +----------+ | | | | | | | |--(G)----------- Refresh Token ----------->| | | | | | | |&lt;-(H)----------- Access Token -------------| | +--------+ & Optional Refresh Token +---------------+</code></p><pre><code>+ ### Client Credentials Grant


  + The [client credentials grant](https://datatracker.ietf.org/doc/html/rfc6749#section-4.4) type MUST only be used by **confidential** clients.

  + Client credentials flow
</code></pre><p><code>txt +---------+ +---------------+ | | | | | |>--(A)- Client Authentication --->| Authorization | | Client | | Server | | |&lt;--(B)---- Access Token ---------&lt;| | | | | | +---------+ +---------------+</code></p><pre><code>  + There are no additional steps as there is no resource owner to give permission. The client is acting on its own behalf so only is required to identify itself.

+ ### OAuth2 Scopes

  + Scopes are important mechanism in OAuth2 and are effectively used to limit the access of a client acting on behalf of a user.

  + When you look at authorization with OAuth2, you must keep in mind that Scopes are used to specify what a resource owner has stated regarding the range of actions a client can perform.
</code></pre><ul><li><h2 id=oidc>OIDC</h2><ul><li><p>OAuth2 provides a mechanism for the client to access APIs using authentication and authorization. However, <em>OAuth2 grants do not provide a way to obtain (or verify) the identity of the end user.</em></p></li><li><p><a href=https://openid.net/connect/ target=_blank>Open ID Connect (OIDC)</a>
provides an identity layer on top of OAuth2. It allows Clients to verify the identity of the End-User based on the authentication performed by an Authorization Server, as well as to obtain basic profile information about the End-User in an interoperable and REST-like manner.</p></li></ul></li><li><h2 id=saml-20>SAML 2.0</h2><ul><li><p><a href=https://auth0.com/intro-to-iam/what-is-saml/ target=_blank>SAML(Security Assertion Markup Language)</a>
is an open standard that transfers assertions.</p></li><li><p>It is often used for single sign on, and the assertions that are transferred are user identities. In other words, <em>it allows a user to authenticate in a system and gain access to another system by providing proof of their authentication</em>.</p></li></ul></li></ul></div><hr><aside><h4>No linked references</h4></aside><br><aside class=related><h3 class="text-2xl font-black tracking-tight text-primary-500 capitalize dark:text-primary-300 sm:text-2xl">Related Content</h3><ul><p class="inline-flex items-center rounded-md bg-gray-300 hover:bg-primary-200 hover:text-black px-2.5 py-0.5 text-sm font-medium text-gray-900 capitalize"><a style=color:var(--link) href=https://zhannicholas.github.io/pages/the-red-method>The RED method</a></p><p class="inline-flex items-center rounded-md bg-gray-300 hover:bg-primary-200 hover:text-black px-2.5 py-0.5 text-sm font-medium text-gray-900 capitalize"><a style=color:var(--link) href=https://zhannicholas.github.io/pages/the-use-method>The USE method</a></p><p class="inline-flex items-center rounded-md bg-gray-300 hover:bg-primary-200 hover:text-black px-2.5 py-0.5 text-sm font-medium text-gray-900 capitalize"><a style=color:var(--link) href=https://zhannicholas.github.io/pages/design-data-intensive-applications>Design Data Intensive Applications</a></p></ul></aside></article></div><div x-cloak x-data="{ atTop: false }"><button id=scrollToTop name="scroll to top button" aria-label="scroll to top button" class="fixed z-50 w-10 h-10 font-bold text-center text-white transition-all duration-1000 ease-in-out transform bg-violet-600 rounded-full cursor-pointer animate-bounce bottom-24 right-8 focus:outline-none" :class="{ 'opacity-0 translate-y-24': !atTop, 'opacity-1 translate-y-2' :  atTop}" @click="window.scrollTo({ top: 0, behavior: 'smooth'})" @scroll.window="atTop = (window.pageYOffset > 200)"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 11l3-3m0 0 3 3m-3-3v8m0-13a9 9 0 110 18 9 9 0 010-18z"/></svg></button></div><script src=https://zhannicholas.github.io/js/alpine.js defer></script>
<script src=https://zhannicholas.github.io/js/darkmode.js defer></script><footer class=bg-gray-900><div class="max-w-md px-4 py-12 mx-auto overflow-hidden sm:max-w-3xl sm:px-6 lg:max-w-7xl lg:px-8"><nav class="flex flex-wrap justify-center -mx-5 -my-2" aria-label=Footer><div class="px-5 py-2"><a href=https://zhannicholas.github.io/about class="text-base text-gray-400 hover:text-gray-300">About</a></div><div class="px-5 py-2"><a href=https://zhannicholas.github.io/posts class="text-base text-gray-400 hover:text-gray-300">Posts</a></div><div class="px-5 py-2"><a href=https://zhannicholas.github.io/pages class="text-base text-gray-400 hover:text-gray-300">Notes</a></div><div class="px-5 py-2"><a href=https://zhannicholas.github.io/library class="text-base text-gray-400 hover:text-gray-300">Library</a></div><div class="px-5 py-2"><a href=https://zhannicholas.github.io/contact/ class="text-base text-gray-400 hover:text-gray-300">Contact</a></div></nav><div class="flex justify-center mt-2 space-x-6"><a href=https://github.com/zhannicholas class="text-gray-400 hover:text-gray-300"><span class=sr-only>GitHub</span><svg class="w-6 h-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483.0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951.0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65.0.0.84-.27 2.75 1.026A9.564 9.564.0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688.0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855.0 1.338-.012 2.419-.012 2.747.0.268.18.58.688.482A10.019 10.019.0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/></svg></a>
<a href=mailto:zhan_nicholas@outlook.com class="text-gray-400 hover:text-gray-300"><span class=sr-only>Email</span><svg class="w-6 h-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M21 7.38246601V5H3V7.38199365l9.0000224 4.50046115L21 7.38246601zm0 2.23606798-9.0000224 4.50001121L3 9.61810635V19H21V9.61853399zM3 3H21c1.1045695.0 2 .8954305 2 2V19c0 1.1045695-.8954305 2-2 2H3c-1.1045695.0-2-.8954305-2-2V5c0-1.1045695.8954305-2 2-2z" clip-rule="evenodd"/></svg></a>
<a href=https://t.me/zhannicholas class="text-gray-400 hover:text-gray-300"><span class=sr-only>Telegram</span><svg class="w-6 h-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.78754 14.0196C5.83131 14.0344 5.87549 14.0448 5.91963 14.0512 5.96777 14.1644 6.02996 14.3107 6.10252 14.4818c.17707.4176.41566.9825.66194 1.5717C7.2667 17.2552 7.77332 18.4939 7.88521 18.8485 8.02372 19.2868 8.17013 19.5848 8.32996 19.7883 8.4126 19.8935 8.50819 19.9853 8.62003 20.0549 8.67633 20.0899 8.7358 20.1186 8.79788 20.14 8.80062 20.141 8.80335 20.1419 8.80608 20.1428 9.1261 20.2636 9.41786 20.2133 9.60053 20.1518 9.69827 20.1188 9.77735 20.0791 9.8334 20.0469 9.86198 20.0304 9.88612 20.0151 9.90538 20.0021L9.90992 19.9991l2.82618-1.7625 3.2646 2.5028C16.0488 20.7763 16.1014 20.8073 16.157 20.8316 16.5492 21.0027 16.929 21.0624 17.2862 21.0136 17.6429 20.9649 17.926 20.8151 18.1368 20.6464 18.3432 20.4813 18.4832 20.2963 18.5703 20.1589 18.6148 20.0887 18.6482 20.0266 18.6718 19.9791 18.6836 19.9552 18.6931 19.9346 18.7005 19.9181L18.7099 19.8963 18.7135 19.8877 18.715 19.8841 18.7156 19.8824 18.7163 19.8808C18.7334 19.8379 18.7466 19.7935 18.7556 19.7482L21.7358 4.72274C21.7453 4.67469 21.7501 4.62581 21.7501 4.57682 21.7501 4.13681 21.5843 3.71841 21.1945 3.46452 20.8613 3.24752 20.4901 3.23818 20.2556 3.25598 20.0025 3.27519 19.7688 3.33766 19.612 3.38757 19.5304 3.41355 19.4619 3.43861 19.4126 3.45773 19.3878 3.46734 19.3675 3.47559 19.3523 3.48188L19.341 3.48666 2.62725 10.0432 2.62509 10.044C2.61444 10.0479 2.60076 10.053 2.58451 10.0593 2.55215 10.0719 2.50878 10.0896 2.45813 10.1126 2.35935 10.1574 2.22077 10.2273 2.07856 10.3247c-.22719.1556-.74968.5817-.6617 1.285.07019.5611.45457.9057.68876 1.0714C2.23421 12.7721 2.35638 12.8371 2.44535 12.8795 2.48662 12.8991 2.57232 12.9339 2.6095 12.9491L2.61889 12.9529l3.16865 1.0667zM19.9259 4.86786 19.9236 4.86888C19.9152 4.8725 19.9069 4.87596 19.8984 4.87928L3.1644 11.4438C3.15566 11.4472 3.14686 11.4505 3.138 11.4536L3.12869 11.4571C3.11798 11.4613 3.09996 11.4686 3.07734 11.4788 3.06451 11.4846 3.05112 11.491 3.03747 11.4978 3.05622 11.5084 3.07417 11.5175 3.09012 11.5251 3.10543 11.5324 3.11711 11.5374 3.1235 11.54l3.14263 1.058C6.32365 12.6174 6.37727 12.643 6.42649 12.674L16.8033 6.59948 16.813 6.59374C16.8205 6.58927 16.8305 6.58353 16.8424 6.5768 16.866 6.56345 16.8984 6.54568 16.937 6.52603 17.009 6.48938 17.1243 6.43497 17.2541 6.39485 17.3444 6.36692 17.6109 6.28823 17.899 6.38064 18.0768 6.43767 18.2609 6.56028 18.3807 6.76798 18.4401 6.87117 18.4718 6.97483 18.4872 7.06972 18.528 7.2192 18.5215 7.36681 18.4896 7.49424 18.4208 7.76875 18.228 7.98287 18.0525 8.14665 17.9021 8.28706 15.9567 10.1629 14.0376 12.0147 13.0805 12.9381 12.1333 13.8525 11.4252 14.5359l-.465.449 5.8719 4.5018C16.9668 19.5349 17.0464 19.5325 17.0832 19.5274 17.1271 19.5214 17.163 19.5045 17.1997 19.4752 17.2407 19.4424 17.2766 19.398 17.3034 19.3557L17.3045 19.354 20.195 4.78102C20.1521 4.79133 20.1087 4.80361 20.0669 4.81691 20.0196 4.83198 19.9805 4.84634 19.9547 4.85637 19.9418 4.86134 19.9326 4.86511 19.9276 4.86719L19.9259 4.86786zM11.4646 17.2618 10.2931 16.3636 10.0093 18.1693 11.4646 17.2618zM9.21846 14.5814l1.16494-1.1247c.7081-.6835 1.6555-1.5979 2.6127-2.5215l.9725-.9382-6.52007 3.8168L7.48351 13.8963c.1777.4191.41736.9864.664940000000001 1.5788.185129999999999.4429.37872.9093.55504 1.3411l.28304-1.8004C9.01381 14.8422 9.09861 14.692 9.21846 14.5814z" clip-rule="evenodd"/></svg></a></div><p class="mt-2 text-base text-center text-gray-400">2018-2023 &copy; Nicholas Zhan. Licensed under <a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/>CC BY-NC 4.0</a>.</p><p class="mt-2 text-base text-center text-gray-400">Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://github.com/sawhney17/logseq-schrodinger>logseq-schrodinger</a>.</p></div></footer></body></html>