<!doctype html><html lang=zh-cn><head><meta http-equiv=content-type content="text/html" charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon type=image/png sizes=96x96 href=https://zhannicholas.github.io/favicon/favicon-96x96.png><link rel=icon type=image/png sizes=32x32 href=https://zhannicholas.github.io/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://zhannicholas.github.io/favicon/favicon-16x16.png><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title itemprop=name>Cloning Objects |</title><meta name=description content><meta property="og:title" content="Cloning Objects | "><meta name=twitter:title content="Cloning Objects | "><meta itemprop=name content="Cloning Objects | "><meta name=application-name content="Cloning Objects | "><meta property="og:site_name" content><meta property="og:type" content="website"><meta property="og:title" content><meta property="og:description" content><meta property="og:site_name" content><meta property="og:url" content="https://zhannicholas.github.io/posts/java/lang/cloning_objects/"><meta property="og:locale" content="en"><meta property="og:image" content="/"><meta property="og:image:secure_url" content="https://zhannicholas.github.io"><meta property="og:type" content="website"><script>localStorage.getItem("color-theme")==="dark"||!("color-theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=stylesheet href="/css/style.min.70a967cc78af9ec5b1e1b5c3552172a911554a27d8e5bdf52000296bdd439d2a.css" integrity="sha256-cKlnzHivnsWx4bXDVSFyqRFVSifY5b31IAApa91DnSo="></head><body class="bg-zinc-100 dark:bg-gray-800"><div class="top-0 z-50 w-full text-gray-200 bg-gray-900 border-2 border-gray-900 md:sticky border-b-stone-200/10"><div x-data="{ open: false }" class="flex flex-col max-w-full px-4 mx-auto md:items-center md:justify-between md:flex-row md:px-6 lg:px-8"><div class="flex flex-row items-center justify-between p-4"><a href=https://zhannicholas.github.io/ class="flex text-gray-100 transition duration-1000 ease-in-out group"><img src=https://zhannicholas.github.io/images/site-logo.svg class="transition-opacity h-9 w-9 group-hover:opacity-50 group-focus:opacity-70" alt=" Logo"><div class="mt-1 text-xl font-black tracking-tight text-gray-100 uppercase transition-colors group-hover:text-gray-400/60"></div></a><button class="rounded-lg md:hidden focus:outline-none focus:shadow-outline" @click="open = !open" role=navigation aria-expanded=false aria-label=Main aria-controls=menuItems><svg fill="currentcolor" viewBox="0 0 20 20" class="w-6 h-6"><path x-show="!open" fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4A1 1 0 013 5zm0 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm6 5a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z" clip-rule="evenodd"/><path x-show="open" fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414.0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg></button></div><nav :class="{'flex': open, 'hidden': !open}" class="flex-col flex-grow hidden pb-4 md:pb-0 md:flex md:justify-end md:flex-row"><div @click.away="open = false" class=relative x-data="{ open: false }"><button @click="open = !open" class="flex flex-row items-center w-full px-4 py-2 mt-2 text-sm font-semibold text-left bg-transparent rounded-lg md:w-auto md:inline md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-indigo-600 focus:bg-indigo-600 focus:outline-none focus:shadow-outline">
<span>The Garden</span><svg fill="currentcolor" viewBox="0 0 20 20" :class="{'rotate-180': open, 'rotate-0': !open}" class="inline w-4 h-4 mt-1 ml-1 transition-transform duration-200 transform md:-mt-1"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414.0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414.0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg></button><div x-show=open x-transition:enter="transition ease-out duration-100" x-transition:enter-start="transform opacity-0 scale-95" x-transition:enter-end="transform opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="transform opacity-100 scale-100" x-transition:leave-end="transform opacity-0 scale-95" class="absolute right-0 z-30 w-full mt-2 origin-top-right rounded-md shadow-lg md:w-48"><div class="px-2 py-2 text-indigo-900 bg-white rounded-md shadow"><a class="block px-4 py-2 mt-2 text-sm font-semibold bg-transparent rounded-lg md:mt-0 hover:text-white focus:text-white hover:bg-indigo-600 focus:bg-indigo-600 focus:outline-none focus:shadow-outline" href=https://zhannicholas.github.io/posts>Posts</a>
<a class="block px-4 py-2 mt-2 text-sm font-semibold bg-transparent rounded-lg md:mt-0 hover:text-white focus:text-white hover:bg-indigo-600 focus:bg-indigo-600 focus:outline-none focus:shadow-outline" href=https://zhannicholas.github.io/pages>Notes</a>
<a class="block px-4 py-2 mt-2 text-sm font-semibold bg-transparent rounded-lg md:mt-0 hover:text-white focus:text-white hover:bg-indigo-600 focus:bg-indigo-700 focus:outline-none focus:shadow-outline" href=https://zhannicholas.github.io/library>Library</a></div></div></div><a class="px-4 py-2 mt-2 text-sm font-semibold rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-indigo-600 focus:bg-indigo-700 focus:outline-none focus:shadow-outline" href=https://zhannicholas.github.io/now>Now</a>
<a class="px-4 py-2 mt-2 text-sm font-semibold bg-transparent rounded-lg md:mt-0 md:ml-4 hover:text-white focus:text-white hover:bg-indigo-600 focus:bg-indigo-700 focus:outline-none focus:shadow-outline" href=https://zhannicholas.github.io/about>About</a>
<button id=theme-toggle type=button class="p-2 text-sm text-gray-500 rounded-lg md: dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 md:ml-2 max-w-5 xs:hidden"><svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentcolor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001.0 1010.586 10.586z"/></svg><svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentcolor" viewBox="0 0 20 20" aria-label="Dark or Light Mode" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1A1 1 0 119 4V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707A1 1 0 1113.536 5.05l.707-.707a1 1 0 011.414.0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707A1 1 0 004.343 5.757l.707.707zm1.414 8.486-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"/></svg></button></nav></div></div><div class=content><article><header class="max-w-2xl mx-auto mb-4 bg-indigo-600"><span class=py-96><h1 class="px-6 pt-6 pb-16 mx-auto dark:prose-invert text-5xl font-black text-center text-white capitalize">Cloning Objects</h1></span></header><div class="max-w-4xl mx-auto mt-8 mb-2"><div class=px-6></div></div><div class="fixed z-20 top-[3.8125rem] bottom-0 right-[max(0px,calc(50%-45rem))] w-[18rem] py-10 overflow-y-auto hidden xl:block"><nav><div class="flex items-center"><h2 class="pl-2 my-0 text-xl font-medium text-zinc-800 uppercase break-words">Table of Contents</h2></div><div class="absolute top-auto bottom-auto right-auto p-0 -left-4" role=menu><div class="relative z-50 max-w-sm m-4 overflow-hidden shadow-lg"><ul class="relative p-4 overflow-x-hidden overflow-y-auto overscroll-y-auto overscroll-x-auto"><li><a class="px-2 text-left text-zinc-700 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#%e6%b5%85%e5%85%8b%e9%9a%86-vs-%e6%b7%b1%e5%85%8b%e9%9a%86>浅克隆 VS 深克隆</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#cloneable-%e6%8e%a5%e5%8f%a3>Cloneable 接口</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#clone-%e6%96%b9%e6%b3%95>clone() 方法</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#%e5%ae%9e%e7%8e%b0%e6%b7%b1%e5%85%8b%e9%9a%86>实现深克隆</a><ul><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#%e4%b8%ba%e5%bc%95%e7%94%a8%e7%b1%bb%e5%9e%8b%e5%ae%9e%e7%8e%b0%e5%85%8b%e9%9a%86%e6%96%b9%e6%b3%95>为引用类型实现克隆方法</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#%e4%bd%bf%e7%94%a8%e5%a4%8d%e5%88%b6%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0>使用复制构造函数</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#%e5%ba%8f%e5%88%97%e5%8c%96%e4%b8%8e%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96>序列化与反序列化</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#%e4%bd%bf%e7%94%a8%e4%b8%89%e6%96%b9%e5%b7%a5%e5%85%b7>使用三方工具</a></li></ul></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#%e7%9b%b8%e5%85%b3%e4%bb%a3%e7%a0%81>相关代码</a></li><li><a class="px-2 text-left text-zinc-900 rounded-md focus:outline-none hover:bg-lightBlue-600 hover:text-white" x-data href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99>参考资料</a></li></ul></div></div></nav></div><div class="max-w-2xl px-6 pt-6 pb-16 mx-auto prose dark:prose-invert dark:text-white"><p>通过<strong>克隆（Clone）</strong>，我们可以快速构建出一个已有对象的副本。</p><h2 id=浅克隆-vs-深克隆>浅克隆 VS 深克隆</h2><p><strong>浅克隆（Shadow Clone）</strong> 或 <strong>浅复制（Shallow Copy）</strong> 把原对象中成员变量为值类型的属性都复制给克隆对象，把原对象中成员变量为引用类型的引用地址也复制给克隆对象。当原对象中存在引用类型的成员变量时，该变量的地址会被原对象和克隆对象共享。</p><p><img src=https://zhannicholas.github.io/images/java/java_lang/shallow_copy.png alt="Shallow Copy"></p><p><strong>深克隆（Deep Clone）</strong> 或 <strong>深复制（Deep Copy）</strong> 将原对象中的所有类型的成员变量（无论是值类型还是引用类型）都复制一份给克隆对象。</p><p><img src=https://zhannicholas.github.io/images/java/java_lang/deep_copy.png alt="Deep Copy"></p><p>简单来说，浅克隆和深克隆的区别就在于对引用类型的成员变量的复制：前者复制的是引用对象的地址，而后者复制的是引用对象本身。</p><h2 id=cloneable-接口>Cloneable 接口</h2><p>在 Java 中，为了实现对象的克隆，我们需要让类实现 <code>Cloneable</code> 接口并重写 <code>Object</code> 类的 <code>clone()</code> 方法。例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CloneableName</span> <span style=color:#66d9ef>implements</span> Cloneable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String firstName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String lastName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CloneableName <span style=color:#a6e22e>clone</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> CloneNotSupportedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>CloneableName<span style=color:#f92672>)</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>clone</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CloneableUser</span> <span style=color:#66d9ef>implements</span> Cloneable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> CloneableName name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> age<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CloneableUser <span style=color:#a6e22e>clone</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> CloneNotSupportedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>CloneableUser<span style=color:#f92672>)</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>clone</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>对于一个类而言，如果我们只重写 <code>clone()</code> 方法而不实现 <code>Cloneable</code> 接口，调用 <code>clone()</code> 方法时就会抛出 <code>CloneNotSupportedException</code>。</p><p>Java 中的数组本身也是可克隆的，根据 JLS11 数组对象既是可克隆的，又是可序列化的。数组可以看成下面这个类：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>A</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>implements</span> Cloneable<span style=color:#f92672>,</span> java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Serializable</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> length <span style=color:#f92672>=</span> X<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> T<span style=color:#f92672>[]</span> <span style=color:#a6e22e>clone</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>T<span style=color:#f92672>[])</span><span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>clone</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>CloneNotSupportedException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> InternalError<span style=color:#f92672>(</span>e<span style=color:#f92672>.</span><span style=color:#a6e22e>getMessage</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=clone-方法>clone() 方法</h2><p><code>clone()</code> 是一个 native 方法，它在 <code>Object</code> 类中定，其详细内容如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Creates and returns a copy of this object.  The precise meaning
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * of &#34;copy&#34; may depend on the class of the object. The general
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * intent is that, for any object {@code x}, the expression:
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;blockquote&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;pre&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * x.clone() != x&lt;/pre&gt;&lt;/blockquote&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * will be true, and that the expression:
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;blockquote&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;pre&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * x.clone().getClass() == x.getClass()&lt;/pre&gt;&lt;/blockquote&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * will be {@code true}, but these are not absolute requirements.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * While it is typically the case that:
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;blockquote&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;pre&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * x.clone().equals(x)&lt;/pre&gt;&lt;/blockquote&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * will be {@code true}, this is not an absolute requirement.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * By convention, the returned object should be obtained by calling
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * {@code super.clone}.  If a class and all of its superclasses (except
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * {@code Object}) obey this convention, it will be the case that
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * {@code x.clone().getClass() == x.getClass()}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * By convention, the object returned by this method should be independent
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * of this object (which is being cloned).  To achieve this independence,
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * it may be necessary to modify one or more fields of the object returned
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * by {@code super.clone} before returning it.  Typically, this means
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * copying any mutable objects that comprise the internal &#34;deep structure&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * of the object being cloned and replacing the references to these
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * objects with references to the copies.  If a class contains only
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * primitive fields or references to immutable objects, then it is usually
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * the case that no fields in the object returned by {@code super.clone}
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * need to be modified.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * The method {@code clone} for class {@code Object} performs a
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * specific cloning operation. First, if the class of this object does
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * not implement the interface {@code Cloneable}, then a
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * {@code CloneNotSupportedException} is thrown. Note that all arrays
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * are considered to implement the interface {@code Cloneable} and that
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * the return type of the {@code clone} method of an array type {@code T[]}
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * is {@code T[]} where T is any reference or primitive type.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Otherwise, this method creates a new instance of the class of this
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * object and initializes all its fields with exactly the contents of
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * the corresponding fields of this object, as if by assignment; the
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * contents of the fields are not themselves cloned. Thus, this method
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * performs a &#34;shallow copy&#34; of this object, not a &#34;deep copy&#34; operation.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * The class {@code Object} does not itself implement the interface
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * {@code Cloneable}, so calling the {@code clone} method on an object
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * whose class is {@code Object} will result in throwing an
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * exception at run time.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return     a clone of this instance.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @throws  CloneNotSupportedException  if the object&#39;s class does not
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *               support the {@code Cloneable} interface. Subclasses
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *               that override the {@code clone} method can also
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *               throw this exception to indicate that an instance cannot
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *               be cloned.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @see java.lang.Cloneable
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@HotSpotIntrinsicCandidate</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>native</span> Object <span style=color:#a6e22e>clone</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> CloneNotSupportedException<span style=color:#f92672>;</span>
</span></span></code></pre></div><p>从源码中可以看出：<code>Object</code> 对 <code>clone()</code> 有三条约定：</p><ul><li>对于所有对象来说，表达式 <code>x.clone() != x</code> 的值为 <code>true</code> ，即克隆对象与原对象不应该同一个对象。</li><li>对于所有对象来说，表达式 <code>x.clone().getClass() == x.getClass()</code> 的值应该为 <code>true</code> ，即克隆对象与原对象的类型应该是一样的。</li><li>对于所有对象来说，表达式 <code>x.clone().equals(x)</code> 的值应该为 <code>true</code>，即克隆对象与原对象是相等（equal）的。</li></ul><p>默认情况下，调用 <code>Object.clone()</code> 进行的是浅克隆。例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shallowCopyTest</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> CloneNotSupportedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    CloneableUser user1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CloneableUser<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;id1&#34;</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> CloneableName<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;fn&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;ln&#34;</span><span style=color:#f92672>),</span> <span style=color:#ae81ff>20</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    CloneableUser user2 <span style=color:#f92672>=</span>  user1<span style=color:#f92672>.</span><span style=color:#a6e22e>clone</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    assertNotSame<span style=color:#f92672>(</span>user1<span style=color:#f92672>,</span> user2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// shallow copy
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    assertSame<span style=color:#f92672>(</span>user1<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>setFirstName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;nfn&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    assertSame<span style=color:#f92672>(</span>user1<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>(),</span> user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    user2<span style=color:#f92672>.</span><span style=color:#a6e22e>setId</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;id2&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    assertNotSame<span style=color:#f92672>(</span>user1<span style=color:#f92672>.</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>(),</span> user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=实现深克隆>实现深克隆</h2><p>在Java中，实现深克隆的方式有很多，例如：</p><ul><li>为所有引用类型都实现克隆方法。</li><li>使用复制构造函数。</li><li>通过序列化与反序列化。</li><li>通过第三方工具实现深克隆，例如 Apache Commons Lang 、 Jackson 、 Gson 、FastJson 等。</li></ul><h3 id=为引用类型实现克隆方法>为引用类型实现克隆方法</h3><p>这种方法需要为每种类型都实现克隆方法，并且这些类型都要实现 <code>Cloneable</code> 接口。例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>deepCopyTest_implementsCloneable</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> CloneNotSupportedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NoArgsConstructor</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>implements</span> Cloneable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String firstName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String lastName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>protected</span> Name <span style=color:#a6e22e>clone</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> CloneNotSupportedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>Name<span style=color:#f92672>)</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>clone</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NoArgsConstructor</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>implements</span> Cloneable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> Name name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> age<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>protected</span> User <span style=color:#a6e22e>clone</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> CloneNotSupportedException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            User user <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>User<span style=color:#f92672>)</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>clone</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            user<span style=color:#f92672>.</span><span style=color:#a6e22e>setName</span><span style=color:#f92672>(</span>name<span style=color:#f92672>.</span><span style=color:#a6e22e>clone</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> user<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Name newName <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Name<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;fn&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;ln&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    User user <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> User<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;id1&#34;</span><span style=color:#f92672>,</span> newName<span style=color:#f92672>,</span> <span style=color:#ae81ff>20</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    User user2 <span style=color:#f92672>=</span> user<span style=color:#f92672>.</span><span style=color:#a6e22e>clone</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>setFirstName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;nfn&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    assertNotSame<span style=color:#f92672>(</span>user<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>(),</span> user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=使用复制构造函数>使用复制构造函数</h3><p>这种方法不需要实现 <code>Cloneable</code> 接口，但是需要为所有的引用类型都定义一个复制构造函数。具体来说，如果构造器的参数为基本数据类型或字符串类型（不可变类型）就直接赋值，否则需要重新 <code>new</code> 一个对象。例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>deepCopyTest_copyConstructor</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NoArgsConstructor</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Name</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String firstName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String lastName<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Name</span> <span style=color:#f92672>(</span>Name name<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>firstName</span> <span style=color:#f92672>=</span> name<span style=color:#f92672>.</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>lastName</span> <span style=color:#f92672>=</span> name<span style=color:#f92672>.</span><span style=color:#a6e22e>getLastName</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@NoArgsConstructor</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String id<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> Name name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> age<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>(</span>User user<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> user<span style=color:#f92672>.</span><span style=color:#a6e22e>getId</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Name<span style=color:#f92672>(</span>user<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>age</span> <span style=color:#f92672>=</span> user<span style=color:#f92672>.</span><span style=color:#a6e22e>age</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Name newName <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Name<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;fn&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;ln&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    User user <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> User<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;id1&#34;</span><span style=color:#f92672>,</span> newName<span style=color:#f92672>,</span> <span style=color:#ae81ff>20</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    User user2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> User<span style=color:#f92672>(</span>user<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>setFirstName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;nfn&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    assertNotSame<span style=color:#f92672>(</span>user<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>(),</span> user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=序列化与反序列化>序列化与反序列化</h3><p>这种方法要求引用类型实现 <code>Serializable</code> 接口。思想为：先将要原对象写入到字节流中，然后再从这个字节流中读出刚刚存储的信息，来作为一个新的对象返回，新对象和原对象就不存在任何地址上的共享，这样就实现了深克隆。例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>deepCopyTest_serDe</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    SerializableUser user1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SerializableUser<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;id1&#34;</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> SerializableName<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;fn&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;ln&#34;</span><span style=color:#f92672>),</span> <span style=color:#ae81ff>20</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ByteArrayOutputStream baos <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteArrayOutputStream<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        ObjectOutputStream oos <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ObjectOutputStream<span style=color:#f92672>(</span>baos<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        oos<span style=color:#f92672>.</span><span style=color:#a6e22e>writeObject</span><span style=color:#f92672>(</span>user1<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        oos<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ByteArrayInputStream bais <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ByteArrayInputStream<span style=color:#f92672>(</span>baos<span style=color:#f92672>.</span><span style=color:#a6e22e>toByteArray</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        ObjectInputStream ois <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ObjectInputStream<span style=color:#f92672>(</span>bais<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        SerializableUser user2 <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>SerializableUser<span style=color:#f92672>)</span> ois<span style=color:#f92672>.</span><span style=color:#a6e22e>readObject</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        ois<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        assertEquals<span style=color:#f92672>(</span>user1<span style=color:#f92672>,</span> user2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        assertNotSame<span style=color:#f92672>(</span>user1<span style=color:#f92672>,</span> user2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>setFirstName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;nfn&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        assertNotSame<span style=color:#f92672>(</span>user1<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>(),</span> user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IOException <span style=color:#f92672>|</span> ClassNotFoundException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=使用三方工具>使用三方工具</h3><p>Apache Commons Lang 工具包中的 <code>SerializationUtils</code> 提供了一个 <code>clone()</code> 方法，可以实现对象的深克隆。由于方法内部也是通过序列化与反序列化实现的，因此需要被序列化的类实现 <code>Serialiable</code> 接口。例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>deepCopy_apacheCommonsLang</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    SerializableUser user1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SerializableUser<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;id1&#34;</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> SerializableName<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;fn&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;ln&#34;</span><span style=color:#f92672>),</span> <span style=color:#ae81ff>20</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    SerializableUser user2 <span style=color:#f92672>=</span> SerializationUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>clone</span><span style=color:#f92672>(</span>user1<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals<span style=color:#f92672>(</span>user1<span style=color:#f92672>,</span> user2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    assertNotSame<span style=color:#f92672>(</span>user1<span style=color:#f92672>,</span> user2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>setFirstName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;nfn&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    assertNotSame<span style=color:#f92672>(</span>user1<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>(),</span> user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>很多 JSON 工具库也可以实现对象的深克隆，它们的核心思想是先将对象转储为 JSON ，然后用 JSON 重新创建出一个全新的对象，新老对象的地址不同，但内容却是相同的。例如 Google 的 Gson 库：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>deepCopy_json</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    User user1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> User<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;id1&#34;</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> Name<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;fn&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;ln&#34;</span><span style=color:#f92672>),</span> <span style=color:#ae81ff>20</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    Gson gson <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Gson<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    User user2 <span style=color:#f92672>=</span> gson<span style=color:#f92672>.</span><span style=color:#a6e22e>fromJson</span><span style=color:#f92672>(</span>gson<span style=color:#f92672>.</span><span style=color:#a6e22e>toJson</span><span style=color:#f92672>(</span>user1<span style=color:#f92672>),</span> User<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals<span style=color:#f92672>(</span>user1<span style=color:#f92672>,</span> user2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    assertNotSame<span style=color:#f92672>(</span>user1<span style=color:#f92672>,</span> user2<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>setFirstName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;nfn&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    assertNotSame<span style=color:#f92672>(</span>user1<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>(),</span> user2<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=相关代码>相关代码</h2><p>相关代码位于 <a href=https://github.com/zhannicholas/java-demos/blob/master/java-lang/src/test/java/ml/zhannicholas/javalang/clone/CloneTest.java target=_blank>Github</a>
。</p><h2 id=参考资料>参考资料</h2><ol><li><a href=https://docs.oracle.com/javase/specs/jls/se11/html/jls-10.html#jls-10.7 target=_blank>The Java® Language Specification (Java SE 11 Edition)</a>
.</li></ol></div><hr><aside><h4>No linked references</h4></aside><br><aside class=related><h3 class="text-2xl font-black tracking-tight text-indigo-500 capitalize dark:text-indigo-300 sm:text-2xl">Related Content</h3><ul><p class="inline-flex items-center rounded-md bg-gray-300 hover:bg-indigo-200 hover:text-black px-2.5 py-0.5 text-sm font-medium text-gray-900 capitalize"><a style=color:var(--link) href=https://zhannicholas.github.io/posts/java/lang/nested_classes>Nested Classes</a></p></ul></aside></article></div><div x-cloak x-data="{ atTop: false }"><button id=scrollToTop name="scroll to top button" aria-label="scroll to top button" class="fixed z-50 w-10 h-10 font-bold text-center text-white transition-all duration-1000 ease-in-out transform bg-violet-600 rounded-full cursor-pointer animate-bounce bottom-24 right-8 focus:outline-none" :class="{ 'opacity-0 translate-y-24': !atTop, 'opacity-1 translate-y-2' :  atTop}" @click="window.scrollTo({ top: 0, behavior: 'smooth'})" @scroll.window="atTop = (window.pageYOffset > 200)"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 11l3-3m0 0 3 3m-3-3v8m0-13a9 9 0 110 18 9 9 0 010-18z"/></svg></button></div><script src=https://zhannicholas.github.io/js/alpine.js defer></script>
<script src=https://zhannicholas.github.io/js/darkmode.js defer></script><footer class=bg-gray-900><div class="max-w-md px-4 py-12 mx-auto overflow-hidden sm:max-w-3xl sm:px-6 lg:max-w-7xl lg:px-8"><nav class="flex flex-wrap justify-center -mx-5 -my-2" aria-label=Footer><div class="px-5 py-2"><a href=https://zhannicholas.github.io/about class="text-base text-gray-400 hover:text-gray-300">About</a></div><div class="px-5 py-2"><a href=https://zhannicholas.github.io/posts class="text-base text-gray-400 hover:text-gray-300">Posts</a></div><div class="px-5 py-2"><a href=https://zhannicholas.github.io/notes class="text-base text-gray-400 hover:text-gray-300">Notes</a></div><div class="px-5 py-2"><a href=https://zhannicholas.github.io/library class="text-base text-gray-400 hover:text-gray-300">Library</a></div><div class="px-5 py-2"><a href=https://zhannicholas.github.io/contact/ class="text-base text-gray-400 hover:text-gray-300">Contact</a></div></nav><div class="flex justify-center mt-2 space-x-6"><a href=https://github.com/zhannicholas class="text-gray-400 hover:text-gray-300"><span class=sr-only>GitHub</span><svg class="w-6 h-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483.0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951.0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65.0.0.84-.27 2.75 1.026A9.564 9.564.0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688.0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855.0 1.338-.012 2.419-.012 2.747.0.268.18.58.688.482A10.019 10.019.0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/></svg></a>
<a href=mailto:zhan_nicholas@outlook.com class="text-gray-400 hover:text-gray-300"><span class=sr-only>Email</span><svg class="w-6 h-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M21 7.38246601V5H3V7.38199365l9.0000224 4.50046115L21 7.38246601zm0 2.23606798-9.0000224 4.50001121L3 9.61810635V19H21V9.61853399zM3 3H21c1.1045695.0 2 .8954305 2 2V19c0 1.1045695-.8954305 2-2 2H3c-1.1045695.0-2-.8954305-2-2V5c0-1.1045695.8954305-2 2-2z" clip-rule="evenodd"/></svg></a>
<a href=https://t.me/zhannicholas class="text-gray-400 hover:text-gray-300"><span class=sr-only>Telegram</span><svg class="w-6 h-6" fill="currentcolor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.78754 14.0196C5.83131 14.0344 5.87549 14.0448 5.91963 14.0512 5.96777 14.1644 6.02996 14.3107 6.10252 14.4818c.17707.4176.41566.9825.66194 1.5717C7.2667 17.2552 7.77332 18.4939 7.88521 18.8485 8.02372 19.2868 8.17013 19.5848 8.32996 19.7883 8.4126 19.8935 8.50819 19.9853 8.62003 20.0549 8.67633 20.0899 8.7358 20.1186 8.79788 20.14 8.80062 20.141 8.80335 20.1419 8.80608 20.1428 9.1261 20.2636 9.41786 20.2133 9.60053 20.1518 9.69827 20.1188 9.77735 20.0791 9.8334 20.0469 9.86198 20.0304 9.88612 20.0151 9.90538 20.0021L9.90992 19.9991l2.82618-1.7625 3.2646 2.5028C16.0488 20.7763 16.1014 20.8073 16.157 20.8316 16.5492 21.0027 16.929 21.0624 17.2862 21.0136 17.6429 20.9649 17.926 20.8151 18.1368 20.6464 18.3432 20.4813 18.4832 20.2963 18.5703 20.1589 18.6148 20.0887 18.6482 20.0266 18.6718 19.9791 18.6836 19.9552 18.6931 19.9346 18.7005 19.9181L18.7099 19.8963 18.7135 19.8877 18.715 19.8841 18.7156 19.8824 18.7163 19.8808C18.7334 19.8379 18.7466 19.7935 18.7556 19.7482L21.7358 4.72274C21.7453 4.67469 21.7501 4.62581 21.7501 4.57682 21.7501 4.13681 21.5843 3.71841 21.1945 3.46452 20.8613 3.24752 20.4901 3.23818 20.2556 3.25598 20.0025 3.27519 19.7688 3.33766 19.612 3.38757 19.5304 3.41355 19.4619 3.43861 19.4126 3.45773 19.3878 3.46734 19.3675 3.47559 19.3523 3.48188L19.341 3.48666 2.62725 10.0432 2.62509 10.044C2.61444 10.0479 2.60076 10.053 2.58451 10.0593 2.55215 10.0719 2.50878 10.0896 2.45813 10.1126 2.35935 10.1574 2.22077 10.2273 2.07856 10.3247c-.22719.1556-.74968.5817-.6617 1.285.07019.5611.45457.9057.68876 1.0714C2.23421 12.7721 2.35638 12.8371 2.44535 12.8795 2.48662 12.8991 2.57232 12.9339 2.6095 12.9491L2.61889 12.9529l3.16865 1.0667zM19.9259 4.86786 19.9236 4.86888C19.9152 4.8725 19.9069 4.87596 19.8984 4.87928L3.1644 11.4438C3.15566 11.4472 3.14686 11.4505 3.138 11.4536L3.12869 11.4571C3.11798 11.4613 3.09996 11.4686 3.07734 11.4788 3.06451 11.4846 3.05112 11.491 3.03747 11.4978 3.05622 11.5084 3.07417 11.5175 3.09012 11.5251 3.10543 11.5324 3.11711 11.5374 3.1235 11.54l3.14263 1.058C6.32365 12.6174 6.37727 12.643 6.42649 12.674L16.8033 6.59948 16.813 6.59374C16.8205 6.58927 16.8305 6.58353 16.8424 6.5768 16.866 6.56345 16.8984 6.54568 16.937 6.52603 17.009 6.48938 17.1243 6.43497 17.2541 6.39485 17.3444 6.36692 17.6109 6.28823 17.899 6.38064 18.0768 6.43767 18.2609 6.56028 18.3807 6.76798 18.4401 6.87117 18.4718 6.97483 18.4872 7.06972 18.528 7.2192 18.5215 7.36681 18.4896 7.49424 18.4208 7.76875 18.228 7.98287 18.0525 8.14665 17.9021 8.28706 15.9567 10.1629 14.0376 12.0147 13.0805 12.9381 12.1333 13.8525 11.4252 14.5359l-.465.449 5.8719 4.5018C16.9668 19.5349 17.0464 19.5325 17.0832 19.5274 17.1271 19.5214 17.163 19.5045 17.1997 19.4752 17.2407 19.4424 17.2766 19.398 17.3034 19.3557L17.3045 19.354 20.195 4.78102C20.1521 4.79133 20.1087 4.80361 20.0669 4.81691 20.0196 4.83198 19.9805 4.84634 19.9547 4.85637 19.9418 4.86134 19.9326 4.86511 19.9276 4.86719L19.9259 4.86786zM11.4646 17.2618 10.2931 16.3636 10.0093 18.1693 11.4646 17.2618zM9.21846 14.5814l1.16494-1.1247c.7081-.6835 1.6555-1.5979 2.6127-2.5215l.9725-.9382-6.52007 3.8168L7.48351 13.8963c.1777.4191.41736.9864.664940000000001 1.5788.185129999999999.4429.37872.9093.55504 1.3411l.28304-1.8004C9.01381 14.8422 9.09861 14.692 9.21846 14.5814z" clip-rule="evenodd"/></svg></a></div><p class="mt-2 text-base text-center text-gray-400">2018-2023 &copy; Nicholas Zhan. Licensed under <a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/>CC BY-NC 4.0</a>.</p></div></footer></body></html>