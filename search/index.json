[{"content":"Stay hungry, Stay foolish\n","href":"/","title":"ä¸»é¡µ"},{"content":"","href":"/notebook/","title":"ç¬”è®°æœ¬"},{"content":"","href":"/posts/","title":"åšå®¢"},{"content":"","href":"/rust/","title":"Rust"},{"content":"","href":"/java/","title":"Java"},{"content":"","href":"/java/concurrency/","title":"å¹¶å‘"},{"content":"åˆ†å¸ƒå¼è®¡ç®—ï¼ˆDistributed Computingï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä¸“é—¨ç ”ç©¶åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆDistributed Systemsï¼‰ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ç”±ä¸€ç»„å½¼æ­¤é€šè¿‡ç½‘ç»œé€šä¿¡ã€ä¸ºäº†å®Œæˆå…±åŒçš„ç›®æ ‡è€Œä¸€èµ·åè°ƒå·¥ä½œçš„è®¡ç®—æœºèŠ‚ç‚¹ç»„æˆçš„ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½åœ¨ä½¿ç”¨çš„ä¸‡ç»´ç½‘å°±æ˜¯ä¸€ä¸ªå·¨å¤§çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚\nå¯ä¼¸ç¼©æ€§ï¼ˆScalabilityï¼‰åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒç‰¹ç‚¹ã€‚å½“æˆ‘ä»¬çš„ç³»ç»Ÿè¾¾åˆ°ç“¶é¢ˆæ—¶ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦é€šè¿‡æŸç§æ‰‹æ®µæ¥æé«˜ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚åœ¨é›†ä¸­å¼ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿèƒ½åŠ›çš„æå‡ä¸€èˆ¬æ˜¯é€šè¿‡å‡çº§æœåŠ¡å™¨åˆ°ä¸­å¤§å‹æœºã€å¢åŠ  CPU æ ¸æ•°ç­‰ç¡¬ä»¶å‡çº§æ‰‹æ®µæ¥å®Œæˆï¼Œè¿™å°±æ˜¯å‚ç›´æ‰©å±•ï¼ˆScale verticallyï¼‰ï¼›è€Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å¢åŠ æ›´å¤šçš„è®¡ç®—æœºæ¥æå‡ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œè¿™å°±æ˜¯æ°´å¹³æ‰©å±•ï¼ˆScale horizontallyï¼‰ã€‚å½“ç³»ç»Ÿèƒ½åŠ›è¿‡å‰©æ—¶ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåªéœ€å‡å°‘è®¡ç®—æœºæ•°é‡å³å¯ï¼Œè€Œé›†ä¸­å¼ç³»ç»Ÿéœ€è¦æ›´æ¢ç¡¬ä»¶ï¼Œç›¸å½“éº»çƒ¦ã€‚\nå†—ä½™ï¼ˆRedundancyï¼‰ä¹Ÿæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€å¤§ç‰¹ç‚¹ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šå°è®¡ç®—æœºå¾€å¾€æä¾›ç›¸åŒçš„æœåŠ¡ã€‚å½“æŸå°æœºå™¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œæ•´ä¸ªç³»ç»Ÿå¹¶ä¸ä¼šç˜«ç—ªï¼Œå…¶å®ƒæœºå™¨å¯ä»¥é¡¶ä¸Šæ¥ç»§ç»­æä¾›æœåŠ¡ã€‚è€Œå•æœºç³»ç»Ÿä¸­çš„æœåŠ¡å™¨æ•…éšœå¯èƒ½å¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„ç˜«ç—ªã€‚\n","href":"/distributed_computing/","title":"åˆ†å¸ƒå¼è®¡ç®—"},{"content":"JVM(Java Virtual Machine) æ˜¯ä¸€å°éå¸¸æŠ½è±¡çš„è®¡ç®—æœºï¼Œå®ƒæ‹¥æœ‰ä¸€ä¸ªæŒ‡ä»¤é›†ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶æ“ä½œå†…å­˜ã€‚JVMå¯ä»¥è¢«ç§»æ¤åˆ°ä¸åŒçš„å¹³å°ï¼Œä»¥å®ç°Javaè¯­è¨€è·¨å¹³å°çš„ç‰¹æ€§ã€‚\n","href":"/java/jvm/","title":"JVM"},{"content":"","href":"/posts/getting_started/","title":"Getting Started"},{"content":"","href":"/operating_systems/","title":"æ“ä½œç³»ç»Ÿ"},{"content":"","href":"/java/jakartaee/","title":"Jakarta EE"},{"content":"HTTPæ˜¯Webçš„åŸºçŸ³ï¼ŒWebæµè§ˆå™¨ã€æœåŠ¡å™¨å’Œç›¸å…³çš„Webåº”ç”¨ç¨‹åºéƒ½æ˜¯é€šè¿‡HTTPç›¸äº’é€šä¿¡çš„ã€‚\n","href":"/computer_networks/http/","title":"HTTP"},{"content":"","href":"/computer_networks/","title":"è®¡ç®—æœºç½‘ç»œ"},{"content":"","href":"/computer_networks/fundamentals/","title":"åŸºç¡€çŸ¥è¯†"},{"content":" åœ¨è®¾è®¡ä¸­æ€è€ƒä»€ä¹ˆåº”è¯¥å˜åŒ–ï¼Œå¹¶å°è£…ä¼šå‘ç”Ÿå˜åŒ–çš„æ¦‚å¿µã€‚ â€”â€”è®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡çš„åŸºç¡€\n ","href":"/posts/design_patterns/","title":"è®¾è®¡æ¨¡å¼"},{"content":"è¡Œä¸‡é‡Œè·¯ï¼Œæ‰¾å¯»è¿œæ–¹ã€‚\n","href":"/itinerary/","title":"æ¸¸å±±ç©æ°´"},{"content":"","href":"/authors/","title":"Authors"},{"content":"","href":"/categories/","title":"Categories"},{"content":"","href":"/tags/java/","title":"Java"},{"content":" Notes from Java Performance, 2nd Edition by Scott Oaks.\n To be a good Java Performance engineer, we need some specific knowledge. This knowledge falls into two broad categories:\n The performance of the Java Virtual Machine (JVM) itself: the way that the JVM is configured affects many aspects of a programâ€™s performance. To understand how the features of the Java platform affect performance.  JVM tuning flags With a few exceptions, the JVM accepts two kinds of flags: boolean flags, and flags that require a parameter.\n Boolean flags use this syntax: -XX:+FlagName enables the flag, and -XX:-FlagName disables the flag. Flags that require a parameter use this syntax: -XX:FlagName=something, meaning to set the value of FlagName to something.  The process of automatically tuning flags based on the environment is called ergonomics.\nHardware Platform Two popular platform in use today: Virtual Machines and Software Containers (such as Docker).\nVirtual machine sets up a completely isolated copy of the operating system on a subset of the hardware on which the virtual machine is running.\nDocker container is just a process (potentially with resource constraints) within a running OS, it provides isolation between processes. By default, a Docker container is free to use all of the machineâ€™s resources. But when the heap grows to it\u0026rsquo;s maximum size and that size is larger than the memory assigned to the Docker container, the Docker container (and hence the JVM) will be killed.\nThe Complete Performance Story A good algorithm is the most important thing when it comes to fast performance.\nA small well-written program will run faster than a large well-written program (write less code).\nWe should forget about small efficiencies, say about 97% of the time; premature optimization is the root of all evil. But premature optimization doesn\u0026rsquo;t mean avoiding code constructs that are known to be bad for performance. For example:\nlog.log(Level.FINE, \u0026#34;I am here, and the value of X is \u0026#34; + calcX() + \u0026#34; and Y is \u0026#34; + calcY()); This code does a string concatenation that is likely unnecessary, since the message wonâ€™t be logged unless the logging level is set quite high. The suggested imporvement is:\nif (log.isLoggable(Level.FINE)) { log.log(Level.FINE, \u0026#34;I am here, and the value of X is {} and Y is {}\u0026#34;, new Object[]{calcX(), calcY()}); } Remember, increasing load to a component in a system that is performing badly will make the entire system slower (For example, the database is always the bottleneck).\nWe should focus on the common use case scenarios. This principle manifests itself in several ways:\n Optimize code by profiling it and focusing on the operations in the profile taking the most time. Apply Occamâ€™s razor to diagnosing performance problems. Write simple algorithms for the most common operations in an application.  Performance testing categories Three categories of code can be used for performance testing: microbenchmarks, macrobenchmarks, and mesobenchmarks.\nMicrobenchmarks A microbenchmark is a test designed to measure a small unit of performance in order to decide which of multiple alternate implementations is preferable.\nBut just-in-time compilation and garbage collection in Java make it difficult to write microbenchmarks correctly.\nSome principles:\n Microbenchmarks must test a range of input Microbenchmarks must measure the correct input Microbenchmark code may behave differently in production  In microbenchmarks, a warm-up period is need, because one of the performance characteristics of Java is that code performs better the more it is executed.\nMacrobeanchmarks The best thing to use to measure performance of an application is the application itself, in conjunction with any external resources it uses. This is a macrobenchmark.\nMesobenchmarks Mesobenchmarks are tests that occupy a middle ground between a microbenchmark and a full application.\nThroughput, Batching, and Response Time Performance can be measured as throughput (RPS), elapsed time (batch time), or response time, and these three metrics are interrelated.\nElapsed Time (Batch) Measurements: how long it takes to accomplish a certain task. Performance is most often measured after the code in question has been executed long enough for it to have been compiled and optimized.\nThroughput Measurements: A throughput measurement is based on the amount of work that can be accomplished in a certain period of time. This measurement is frequently referred to as transactions per second (TPS), requests per second (RPS), or operations per second (OPS).\nResponse Time: the amount of time that elapses between the sending of a request from a client and the receipt of the response. One difference between average response time and a percentile response time is in the way outliers affect the calculation of the average: since they are included as part of the average, large outliers will have a large effect on the average response time.\nVariability Test results vary over time. Understanding when a difference is a real regression and when it is a random variation is difficult.\nTesting code for changes like this is called regression testing. In a regression test, the original code is known as the baseline, and the new code is called the specimen.\nIn general, the larger the variation in a set of results, the harder it is to guess the probability that the difference in the averages is real or due to random chance.\nStatistical significance does not mean statistical importance.\nCorrectly determining whether results from two tests are different requires a level of statistical analysis to make sure that perceived differences are not the result of random chance. The rigorous way to accomplish that is to use Studentâ€™s t-test to compare the results. Data from the t-test tells us the probability that a regression exists, but it doesnâ€™t tell us which regressions should be ignored and which must be pursued. Finding that balance is part of the art of performance engineering.\nTest early, Test Often Early, frequent testing is most useful if the following guidelines are followed:\n Automate everything Measure everything Run on the target system  Operating System Tools and Analysis CPU Usage CPU usage is typically divided into two categories: user time and system time (Windows refers to this as privileged time). User time is the percentage of time the CPU is executing application code, while system time is the percentage of time the CPU is executing kernel code.\nThe goal in performance is to drive CPU usage as high as possible for as short a time as possible. Driving the CPU usage higher is always the goal for batch jobs, because the job will be completed faster.\nBoth Windows and Unix systems allow you to monitor the number of threads that can be run (meaning that they are not blocked on I/O, or sleeping, and so on). Unix systems refer to this as the run queue: the first number in each line of vmstat\u0026rsquo;s output is the length of the run queue. Windows refers to this number as the processor queue and reports it (among other ways) via typeperf.\nDisk Usage Monitoring disk usage has two important goals. The first pertains to the application itself: if the application is doing a lot of disk I/O, that I/O can easily become a bottleneck. The second is even if the application is not expected to perform a significant amount of I/Oâ€”is to help monitor if the system is swapping.\nA system that is swappingâ€”moving pages of data from main memory to disk, and vice versaâ€”will have quite bad performance.\nNetwork Usage Network usage is similar to disk traffic: the application might be inefficiently using the network so that bandwidth is too low, or the total amount of data written to a particular network interface might be more than the interface is able to handle.\nBe sure to remember that the bandwidth is measured in bits per second (bps), although tools generally report bytes per second (Bps).\nJava Monitoring Tools JDK provides many Java monitoring tools to help us gain insight in to the JVM:\n jcmd: Prints basic class, thread, and JVM information for a Java process. Usage: jcmd process_id command optional_arguments jconsole: Provides a graphical view of JVM activities, including thread usage, class usage, and GC activities.  Since jconsole requires a fair amount of system resources, running it on a production system can interfere with that system. But we can set up jconsole so that it can be run locally and attach to a remote system, which won\u0026rsquo;t interfere with that remote system\u0026rsquo;s performance.   jmap: Provides heap dumps and other information about JVM memory usage. jinfo: Provides visibility into the system properties of the JVM, and allows some system properties to be set dynamically. jstack: Dumps the stacks of a Java process. Suitable for scripting. jstat: Provides information about GC and class-loading activities. jvisualvm: A GUI tool to monitor a JVM, profile a running application, and analyze JVM heap dumps.  Among these tools, nongraphical tools (expect jconsole and jvisualvm) are suitable for scripting.\nThese tools fits into broad areas:\n Basic VM information Thread information Class information Live GC analysis Heap dump postprocessing Profile a JVM  There\u0026rsquo;s a lot of overlap with each tool\u0026rsquo;s work. So it\u0026rsquo;s better to focus on different areas.\nBasic VM information Uptime The length of time the JVM has been up can be found via this command:\n$ jcmd \u0026lt;process_id\u0026gt; VM.uptime System properties The set of items in System.getProperties() can be displayed with either of these commands:\n$ jcmd \u0026lt;process_id\u0026gt; VM.system_properties or\n$ jinfo -sysprops \u0026lt;process_id\u0026gt; JVM version The version of the JVM is obtained like this:\n$ jcmd \u0026lt;process_id\u0026gt; VM.version JVM command line The command line can be displayed in the VM summary tab of jconsole, or via jcmd:\n$ jcmd \u0026lt;process_id\u0026gt; VM.command_line JVM tuning flags The tuning flags in effect for an application can be obtained like this:\n$ jcmd \u0026lt;process_id\u0026gt; VM.flags [-all] Or, you can use -XX:+PrintFlagsFinal option on the command line to see platform-specific defaults.\n$ java other_options -XX:+PrintFlagsFinal -version Yet another way to see JVM options for a running application is with jinfo. Retrive the values of all flags in the proces:\n$ jinfo -flags \u0026lt;process_id\u0026gt; If -flags option is present, this command will provide information about all flags; ohterwise, it prints only those specified on the command line.\nIf you want to inspect the value of an individual flag, use -flag option:\n$ jinfo -flag PrintGCDetails \u0026lt;process_id\u0026gt; -XX:+PrintGCDetails The advantage of jinfo is that is allows certain flag values to be changed during execution of the program. For example:\n$ jinfo -flag -PrintGCDetails \u0026lt;process_id\u0026gt; # turns off PrintGCDetails But this technique works only for those flags marked manageable in the output of PrintFlagsFinal command.\nThread Information If you have GUI, jconsole and jvisualvm are good tools to display real time information of threads running in an application.\nThe stacks can be obtained via jstack:\n$ jstack \u0026lt;process_id\u0026gt; Or jcmd:\n$ jcmd \u0026lt;process_id\u0026gt; Thread.print Class Information Information about the number of classes in use by an application can be obtained from jconsole or jstat. jstat can also provide information about class compilation.\nLive GC Analysis Virtually every monitoring tool can report something about GC activity\n jconsole displays live graphs of the heap usage; jcmd allows GC operations to be performed; jmap can print heap summaries or information on the permanent generation or create a heap dump; jstat produces a lot of views of what the garbage collector is doing  Heap Dump Postprocessing The heap dump is a snapshot of the heap that can be analyzed with various tools, including jvisualvm and the Eclipse Memory Analyzer Tool (MAT). GUI tool jvisualvm and command line tool jcmd or jmap can capture heap snapshots.\nProfile a JVM Profilers are the most important tool in a performance analystâ€™s toolbox. Profiling happens in one of two modes: sampling mode or instrumented mode.\nSampling Profilers Sampling mode is the basic mode of profiling and carries the least amount of overhead.\nIn the common Java interface for profilers, the profiler can get the stack trace of a thread only when the thread is at a safepoint, so sampling becomes even less reliable.\nThreads automatically go into a safepoint when they are:\n Blocked on a synchronized lock Blocked waiting for I/O Blocked waiting for a monitor Parked Executing Java Native Interface (JNI) code (unless they perform a GC locking function)  In addition, the JVM can set a flag asking for threads to go into a safepoint.\nInstrumented Profilers Instrumented profilers are much more intrusive than sampling profilers (they could have a greater effect on application than a sampling profiler), but they can also give more beneficial information about whatâ€™s happening inside a program.\nInstrumented profilers work by altering the bytecode sequence of classes as they are loaded (inserting code to count the invocations, and so on).\nBecause of the changes introduced into the code via instrumentation, it is best to limit its use to a few classes. This means it is best used for second-level analysis: a sampling profiler can point to a package or section of code, and then the instrumented profiler can be used to drill into that code if needed.\nJava Flight Recorder Java Flight Recorder (JFR) is a feature of the JVM that performs lightweight performance analysis of applications while they are running.\nJFR collects a set of event data, the data stream is held in a circular buffer, so only the most recent events are available.\nBy default, JFR is set up so that it has very low overhead: an impact below 1% of the programâ€™s performance.\nJFR is initially disabled. To enable it, add the flag -XX:+FlightRecorder to the command line of the application (In Oracle\u0026rsquo;s JDK 8, you must specify XX:+UnlockCommercialFeatures prior to it).\nIf you forget to include these flags, you can use jinfo to change their values and enable JFR.\nFlight recordings are made in one of two modes: either for a fixed duration (1 minute in this case) or continuously.\nWe can start JFR when the program initially begins by -XX:StartFlightRecording=string flag. Or, use jcmd \u0026lt;process_id\u0026gt; JRF.start [options_list] to start a recording during a run, use jcmd \u0026lt;process_id\u0026gt; JRF.dump [options_list] to dump current data in the circular buffer, and use jcmd \u0026lt;process_id\u0026gt; JRF.stop [options_list] to abort a recording in process.\nJFR is useful in performance analysis, but it is also useful when enabled on a production system so that you can examine the events that led up to a failure.\nJava Mission Control The usual tool to examine JFR recordings is Java Mission Control (jmc).\n","href":"/notebook/reading_notes/java_performance/java_performance_fundamentals/","title":"Java Performance: foundamentals"},{"content":"","href":"/tags/","title":"Tags"},{"content":"","href":"/authors/zhannicholas/","title":"zhannicholas"},{"content":"","href":"/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/","title":"è¯»ä¹¦ç¬”è®°"},{"content":"","href":"/tags/shell/","title":"Shell"},{"content":"","href":"/categories/shell/","title":"Shell"},{"content":"æ–‡ä»¶è¾“å…¥å’Œè¾“å‡ºæ˜¯é€šè¿‡æ•´æ•°å¥æŸ„ï¼ˆinteger handleï¼‰å®ç°çš„â€”â€”æ¯ä¸ªæ‰“å¼€çš„æ–‡ä»¶éƒ½ä¼šè¢«èµ‹äºˆä¸€ä¸ªæ•°å­—ï¼Œè¿™ä¸ªæ•°å­—å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼‰ã€‚\næœ€å¸¸è§çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰ã€æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰å’Œæ ‡å‡†é”™è¯¯ï¼ˆstderrï¼‰ï¼Œå®ƒä»¬çš„æ–‡ä»¶æè¿°ç¬¦æ•°å­—åˆ†åˆ«æ˜¯ 0ã€1ã€2ã€‚è¿™äº›æ•°å­—å’Œç›¸åº”çš„è®¾å¤‡éƒ½æ˜¯ç³»ç»Ÿä¿ç•™çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤ ls -l /dev/std* æŸ¥çœ‹ã€‚\n~$ ls -l /dev/std* lrwxrwxrwx 1 root root 15 Oct 16 18:47 /dev/stderr -\u0026gt; /proc/self/fd/2 lrwxrwxrwx 1 root root 15 Oct 16 18:47 /dev/stdin -\u0026gt; /proc/self/fd/0 lrwxrwxrwx 1 root root 15 Oct 16 18:47 /dev/stdout -\u0026gt; /proc/self/fd/1 æ¯ä¸ªè¿›ç¨‹çœ‹åˆ°çš„ /proc/self ç›®å½•ä¸‹çš„ä¸œè¥¿éƒ½ä¸ä¸€æ ·ï¼Œå› ä¸º /proc/self å®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡å‘ /proc/\u0026lt;process_ID\u0026gt; çš„ç¬¦å·é“¾æ¥ã€‚\nè¾“å‡ºé‡å®šå‘  COMMAND_OUTPUT \u0026gt;ï¼šé‡å®šå‘è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå¹¶å†™å…¥ï¼Œå¦åˆ™è¦†ç›–åŸæ–‡ä»¶ : \u0026gt; filenameï¼šåˆ é™¤ï¼ˆtruncateï¼‰æ–‡ä»¶çš„å†…å®¹ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒã€‚: æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œä»£è¡¨æ— ã€‚ \u0026gt; filenameï¼šå’Œ : \u0026gt; filename ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨æŸäº› shell ä¸‹å·¥ä½œä¸æ­£å¸¸ COMMAND_OUTPUT \u0026gt;\u0026gt;ï¼šé‡å®šå‘è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œå·²è¿½åŠ çš„æ–¹å¼å†™å…¥ 1\u0026gt;filenameï¼šé‡å®šå‘æ ‡å‡†è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œä»¥è¦†ç›–çš„æ–¹å¼å†™å…¥ 1\u0026gt;\u0026gt;filenameï¼šé‡å®šå‘æ ‡å‡†è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥ 2\u0026gt;filenameï¼šé‡å®šå‘æ ‡å‡†é”™è¯¯åˆ°æ–‡ä»¶ï¼Œä»¥è¦†ç›–çš„æ–¹å¼å†™å…¥ 2\u0026gt;\u0026gt;filenameï¼šé‡å®šå‘æ ‡å‡†é”™è¯¯åˆ°æ–‡ä»¶ï¼Œä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥ \u0026amp;\u0026gt;filenameï¼šé‡å®šå‘æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯åˆ°æ–‡ä»¶ M\u0026gt;Nï¼šé‡å®šå‘æ–‡ä»¶æè¿°ç¬¦ Mï¼ˆå¦‚æœæœªç»™å‡ºï¼Œåˆ™é»˜è®¤ä¸º 1ï¼‰å¯¹åº”çš„æ–‡ä»¶åˆ°æ–‡ä»¶ N ã€‚æ³¨æ„ï¼šM æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ŒN æ˜¯ä¸€ä¸ªæ–‡ä»¶ã€‚ M\u0026gt;\u0026amp;Nï¼šå®šå‘æ–‡ä»¶æè¿°ç¬¦ Mï¼ˆå¦‚æœæœªç»™å‡ºï¼Œåˆ™é»˜è®¤ä¸º 1ï¼‰å¯¹åº”çš„æ–‡ä»¶åˆ°æ–‡ä»¶æè¿°ç¬¦ N å¯¹åº”çš„æ–‡ä»¶ã€‚æ³¨æ„ï¼šè¿™é‡Œ M å’Œ N éƒ½æ˜¯æ–‡ä»¶æè¿°ç¬¦ 2\u0026gt;\u0026amp;1ï¼šé‡å®šå‘æ ‡å‡†é”™è¯¯åˆ°æ ‡å‡†è¾“å‡º i\u0026gt;\u0026amp;jï¼šé‡å®šå‘æ–‡ä»¶æè¿°ç¬¦ i åˆ° j \u0026gt;\u0026amp;jï¼šé‡å®šå‘æ ‡å‡†è¾“å‡ºåˆ°æ–‡ä»¶æè¿°ç¬¦ j  è¾“å…¥é‡å®šå‘  0\u0026lt; filenameï¼šä»æ–‡ä»¶è·å–è¾“å…¥ [j]\u0026lt;\u0026gt;filenameï¼šæ‰“å¼€æ–‡ä»¶ filename è¿›è¡Œè¯»å†™ï¼Œè‹¥è¯¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºå®ƒã€‚å¦‚æœæ–‡ä»¶æè¿°ç¬¦ j æœªå£°æ˜ï¼Œåˆ™é»˜è®¤ä¸º 0  å…³é—­æ–‡ä»¶æè¿°ç¬¦  n\u0026lt;\u0026amp;-ï¼šå…³é—­è¾“å…¥æ–‡ä»¶æè¿°ç¬¦ n 0\u0026lt;\u0026amp;- å’Œ \u0026lt;\u0026amp;-ï¼šå…³é—­æ ‡å‡†è¾“å…¥ n\u0026gt;\u0026amp;-ï¼šå…³é—­è¾“å‡ºæ–‡ä»¶æè¿°ç¬¦ n 1\u0026gt;\u0026amp;- å’Œ \u0026gt;\u0026amp;-ï¼šå…³é—­æ ‡å‡†è¾“å‡º  Here documents here document æ˜¯ä¸€ä¸ªæœ‰ç€ç‰¹æ®Šç”¨é€”çš„ä»£ç å—ï¼Œå®ƒå‘Šè¯‰ shell ä»å½“å‰ä½ç½®è¯»å–è¾“å…¥ï¼Œç›´åˆ°é‡åˆ°ç»“æŸå­—ç¬¦ä¸²ã€‚ç„¶åï¼Œè¯»å–åˆ°çš„å†…å®¹ä¼šè¢«ç”¨ä½œå‘½ä»¤çš„æ ‡å‡†è¾“å…¥ã€‚è¯­æ³•å¦‚ä¸‹ï¼š\nCOMMAND \u0026lt;\u0026lt;InputComesFromHERE ... ... ... InputComesFromHERE è¿™é‡ŒåŒ…å«ä¸€ä¸ªå‘½ä»¤ COMMANDï¼Œä¸€ä¸ªé™åˆ¶å­—ç¬¦ä¸²ï¼ˆlimit stringï¼‰InputComesFromHEREã€‚é™åˆ¶å­—ç¬¦ä¸²ä¹‹é—´çš„å†…å®¹å°±æ˜¯ COMMAND çš„æ ‡å‡†è¾“å…¥ï¼Œç‰¹æ®Šå­—ç¬¦ \u0026lt;\u0026lt; å‡ºç°åœ¨é™åˆ¶å­—ç¬¦ä¸²çš„å‰é¢ã€‚ç”±äº here document ä½¿ç”¨é™åˆ¶å­—ç¬¦ä¸²æ¥åˆ¤æ–­è¾“å…¥æ˜¯å¦ç»“æŸï¼Œæ‰€ä»¥é™åˆ¶å­—ç¬¦ä¸²çš„é€‰å–å°±éå¸¸é‡è¦ï¼Œå®ƒä¸åº”è¯¥å‡ºç°åœ¨ç»™ COMMAND çš„å†…å®¹ä¸­ã€‚\nHere strings here string å¯ä»¥è¢«çœ‹åš here document çš„ç®€å•ç‰ˆæœ¬ã€‚å®ƒçš„å½¢å¼ä¸ºï¼šCOMMAND \u0026lt;\u0026lt;\u0026lt; $WORDã€‚å…¶ä¸­ $WORD å±•å¼€åçš„ç»“æœå°±ä¼šåšä¸º COMMAND çš„æ ‡å‡†è¾“å…¥ã€‚\nå‚è€ƒèµ„æ–™  Bash Guide for Beginners. Advanced Bash-Scripting Guide.  ","href":"/posts/linux/shell_scripting_io_redirection/","title":"Shell è„šæœ¬ï¼šI/O é‡å®šå‘"},{"content":"æ­£åˆ™è¡¨è¾¾å¼ï¼ˆregular expression, REï¼‰åœ¨ Shell ä¸­çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ findã€grepã€sedã€awk ç­‰å‘½ä»¤éƒ½æ¶‰åŠåˆ°æ­£åˆ™è¡¨è¾¾å¼â€¦â€¦\nåœ¨ Shell ä¸­ï¼Œè¡¨è¾¾å¼å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²ç”±å­—ç¬¦ç»„æˆï¼Œå…¶ä¸­æœ‰äº›å­—ç¬¦é™¤äº†å­—é¢å«ä¹‰ä¹‹å¤–è¿˜æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œè¿™äº›å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦å°±æ˜¯å…ƒå­—ç¬¦ï¼ˆmetacharacterï¼‰ã€‚\næ­£åˆ™è¡¨è¾¾å¼ä¸»è¦ç”¨äºæœç´¢æ–‡æœ¬å’Œæ“ä½œå­—ç¬¦ä¸²ï¼Œå®ƒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\n å­—ç¬¦é›†ï¼ˆcharacter setï¼‰ã€‚å­—ç¬¦é›†å†…æ‰€æœ‰çš„å­—ç¬¦éƒ½åªå…·æœ‰å­—é¢å«ä¹‰ï¼Œä¸åŒ…æ‹¬å…ƒå­—ç¬¦ é”šç‚¹ï¼ˆanchorï¼‰ã€‚é”šç‚¹æ ‡è¯†ç€æ­£åˆ™è¡¨è¾¾å¼è¦åŒ¹é…çš„æ–‡æœ¬ä¸­çš„ä½ç½®ï¼Œæ¯”å¦‚ ^ å’Œ $ ä¿®é¥°ç¬¦ï¼ˆmodifierï¼‰ã€‚ä¿®é¥°ç¬¦çš„ä½œç”¨æ˜¯æ‰©å±•æˆ–è€…ç¼©å°æ­£åˆ™è¡¨è¾¾å¼è¦åŒ¹é…çš„æ–‡æœ¬çš„èŒƒå›´ï¼ŒåŒ…æ‹¬æ˜Ÿå·ï¼ˆ*ï¼‰ã€æ–¹æ‹¬å·ï¼ˆ[ï¼‰å’Œåæ–œæ ï¼ˆ/ï¼‰  æ ‡å‡†æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‰¹æ®Šå­—ç¬¦  *ï¼šåŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦å‡ºç°ä»»æ„æ¬¡æ•°ï¼ŒåŒ…æ‹¬ 0 æ¬¡ .ï¼šåŒ¹é…é™¤æ¢è¡Œç¬¦ï¼ˆ\\nï¼‰ä¹‹å¤–çš„ä»»ä½•å•å­—ç¬¦ ^ï¼šåŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½® $ï¼šåŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸä½ç½® [...]ï¼šå°è£…æ­£åˆ™è¡¨è¾¾å¼ä¸­ç”¨åˆ°çš„ä¸€ç»„å­—ç¬¦ \\ï¼šå¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œè½¬ç§»åçš„ç‰¹æ®Šå­—ç¬¦åªå…·å¤‡å­—é¢å«ä¹‰ \\\u0026lt;...\\\u0026gt;ï¼šæ ‡è®°å•è¯è¾¹ç•Œ  æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‰¹æ®Šå­—ç¬¦ æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ç»™æ ‡å‡†æ­£åˆ™è¡¨è¾¾å¼ä¸­åŠ å…¥äº†æ–°çš„å…ƒå­—ç¬¦ï¼Œä¸»è¦ç”¨åœ¨ egrepã€awk å’Œ Perl ä¸­ã€‚\n ?ï¼šåŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦å‡ºç°é›¶æ¬¡æˆ–ä¸€æ¬¡ +ï¼šåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼å‡ºç°ä¸€æ¬¡æˆ–å¤šæ¬¡ \\{\\}ï¼šé™å®šå‰é¢çš„å­è¡¨è¾¾å¼å‡ºç°çš„æ¬¡æ•° ()ï¼šå°è£…ä¸€ç»„æ­£åˆ™è¡¨è¾¾å¼ |ï¼šä»ä¸€ç»„é€‰æ‹©ä¸­é€‰æ‹©ä¸€ä¸ªï¼Œå³æˆ–çš„å«ä¹‰  Globbing Bash æœ¬èº«å¹¶ä¸èƒ½è¯†åˆ«æ­£åˆ™è¡¨è¾¾å¼ï¼Œè§£é‡Šæ­£åˆ™è¡¨è¾¾å¼çš„æ˜¯ä¸€äº›åƒ sed å’Œ awk è¿™æ ·çš„å‘½ä»¤å’Œå·¥å…·ã€‚Shell å±•å¼€ä¸­æœ‰ä¸€ç§ç±»å‹å«æ–‡ä»¶åå±•å¼€ï¼ˆfilename expansionï¼‰ï¼Œä½†å±•å¼€çš„äº‹æƒ…å¹¶ä¸æ˜¯ Bash è‡ªå·±å®Œæˆçš„ï¼Œè€Œæ˜¯ç”±ä¸€ä¸ªå«åš globbing çš„è¿›ç¨‹å®Œæˆçš„ã€‚ä½†æ˜¯ globbing æœ¬èº«å¹¶ä¸èƒ½ä½¿ç”¨æ ‡å‡†çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒåªèƒ½è¯†åˆ«é€šé…ç¬¦ *ã€?ã€[] å’ŒæŸäº›å…¶å®ƒçš„ç‰¹æ®Šå­—ç¬¦ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼š* å¹¶ä¸ä¼šåŒ¹é…ä»¥ . å¼€å¤´çš„æ–‡ä»¶åã€‚\nå‚è€ƒèµ„æ–™  Bash Guide for Beginners. Advanced Bash-Scripting Guide.4w  ","href":"/posts/linux/shell_scripting_regular_expressions/","title":"Shell è„šæœ¬ï¼šæ­£åˆ™è¡¨è¾¾å¼"},{"content":"åœ¨ shell å°†è¯»å–çš„å‘½ä»¤åˆ†å‰²æˆç¬¦å·ï¼ˆtokenï¼‰ä¹‹åï¼Œè¿™äº›ç¬¦å·ï¼ˆæˆ–å•è¯ï¼‰ä¼šè¢«å±•å¼€æˆ–è§£æã€‚Shell ä¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œå…«ç§ç±»å‹çš„å±•å¼€ï¼ˆexpansionï¼‰ï¼š\n Brace expansion Tilde expansion Shell parameter and variable expansion Command substitution Arithmetic expansion Process substitution Word splitting File name expansion  å¤§æ‹¬å·å±•å¼€ å¤§æ‹¬å·å±•å¼€çš„å½¢å¼ä¸ºï¼šä¸€ä¸ªå¯é€‰çš„å‰å¯¼ç¬¦ï¼ˆPREAMBLEï¼‰ã€ä¸€ç»„ä½äºä¸€å¯¹å¤§æ‹¬å·ä¹‹é—´çš„ç”±é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²å’Œä¸€ä¸ªå¯é€‰çš„è·‹ï¼ˆPOSTSCRIPTï¼‰ã€‚ä¾‹å¦‚ï¼š\n~$ echo sp{el,il,al}l spell spill spall æ³¢æµªå·å±•å¼€ å¦‚æœä¸€ä¸ªå•è¯ä»¥æ²¡æœ‰è¢«å¼•èµ·æ¥çš„æ³¢æµªå·ï¼ˆ~ï¼‰å¼€å§‹ï¼Œåˆ™åœ¨ç¬¬ä¸€ä¸ªæ²¡æœ‰è¢«å¼•èµ·æ¥çš„æ–œæ ï¼ˆè‹¥æ²¡æœ‰æ–œæ ï¼Œåˆ™ä¸€ç›´åˆ°æœ€åä¸€ä¸ªå­—ç¬¦ï¼‰ä¹‹å‰çš„å­—ç¬¦å°†è¢«è§†ä½œæ³¢æµªå·å‰ç¼€ï¼ˆtidle-prefixï¼‰ã€‚å¦‚æœæ³¢æµªå·å‰ç¼€ä¸­æ²¡æœ‰å­—ç¬¦è¢«å¼•èµ·æ¥ï¼Œé‚£ä¹ˆæ³¢æµªå·å‰ç¼€ä¸­çš„è¿™äº›å­—ç¬¦å°±ä¼šè¢«å½“ä½œä¸€ä¸ªå¯èƒ½çš„ç™»å½•ç”¨æˆ·åã€‚å¦‚æœè¿™ä¸ªç™»å½•ç”¨æˆ·åæ˜¯ null å­—ç¬¦ä¸²ï¼Œåˆ™æ³¢æµªå·è¢«æ›¿æ¢ä¸º shell å˜é‡ HOMEã€‚å¦‚æœ HOME å˜é‡æ²¡æœ‰è¢«è®¾ç½®ï¼Œåˆ™æ›¿æ¢ä¸ºæ‰§è¡Œè¿™ä¸ª shell çš„ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚ å¦‚æœæ³¢æµªå·å‰ç¼€æ˜¯â€~+â€œï¼Œé‚£ä¹ˆå®ƒä¼šè¢«æ›¿æ¢ä¸ºå˜é‡ PWD çš„å€¼ã€‚å¦‚æœæ³¢æµªå·å‰ç¼€æ˜¯â€~-â€œï¼Œé‚£ä¹ˆå®ƒä¼šè¢«æ›¿æ¢ä¸ºå˜é‡ OLDPWD çš„å€¼ã€‚\nå‚æ•°æˆ–å˜é‡å±•å¼€ ç¾å…ƒç¬¦å·ï¼ˆ$ï¼‰ç”¨äºå‚æ•°å±•å¼€ã€å‘½ä»¤æ›¿æ¢æˆ–ç®—æœ¯å±•å¼€ã€‚è¢«å±•å¼€çš„å‚æ•°åæˆ–ç¬¦å·å¯èƒ½è¢«åŒ…è£¹åœ¨å¤§æ‹¬å·ä¸­ã€‚ æœ€åŸºæœ¬çš„å‚æ•°å±•å¼€çš„å½¢å¼æ˜¯â€${PARAMETER}â€œã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨æŸä¸ªå˜é‡ä¸å­˜åœ¨æ—¶åˆ›å»ºè¿™ä¸ªå˜é‡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨â€${VAR:=value}â€œ\nå‘½ä»¤æ›¿æ¢ å‘½ä»¤æ›¿æ¢ï¼ˆcommand substitutionï¼‰å…è®¸æˆ‘ä»¬ç”¨å‘½ä»¤çš„è¾“å‡ºæ¥æ›¿æ¢å‘½ä»¤æœ¬èº«ï¼Œå®ƒæœ‰ä¸¤ç§å½¢å¼ï¼š\n $(command) `command`  å…¶ä¸­å‰è€…å·¥ä½œå¾—æ›´å¥½ï¼Œæ˜¯ç”¨æ¥å–ä»£åè€…çš„ã€‚\nä¾‹å¦‚ï¼š\n~$ whoami ubuntu2004 ~$ echo `whoami` ubuntu2004 ~$ echo $(whoami) ubuntu2004 å‘½ä»¤æ›¿æ¢ä¼šè°ƒç”¨ä¸€ä¸ª subshellã€‚\n A subshell is a child process launched by a shell (or shell script).\n ç®—æœ¯å±•å¼€ ç®—æœ¯å±•å¼€ï¼ˆarithmetic expansionï¼‰å…è®¸æˆ‘ä»¬ç”¨ä¸€ä¸ªç®—æœ¯è¡¨è¾¾å¼è®¡ç®—å¾—åˆ°çš„å€¼æ›¿æ¢è¡¨è¾¾å¼æœ¬èº«ã€‚å®ƒä¹Ÿæœ‰ä¸¤ç§å½¢å¼ï¼š\n $(( EXPRESSION )) `$[ EXPRESSION ]`  ä¾‹å¦‚ï¼š\n~$ a=1 ~$ echo $(( $a+1 )) 2 ~$ echo $[ $a+1 ] 2 å¦‚æœæ‰§è¡Œç®—æœ¯è¿ç®—çš„æ“ä½œæ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«å½“ä½œ 0 å¤„ç†ã€‚ä¾‹å¦‚ï¼š\n~$ a=1 ~$ echo $(( $a+1 )) 1 ~$ echo $[ $a+1 ] 1 è¿›ç¨‹æ›¿æ¢ è¿›ç¨‹æ›¿æ¢ï¼ˆProcess substitutionï¼‰åœ¨æ”¯æŒå‘½åç®¡é“ï¼ˆFIFOï¼‰å’Œå‘½åæ‰“å¼€æ–‡ä»¶çš„ /dev/fd æ–¹æ³•çš„ç³»ç»Ÿä¸Šã€‚å½¢å¼ä¹Ÿæœ‰ä¸¤ç§ï¼š\n \u0026lt;(LIST) \u0026gt;(LIST)  å•è¯æ‹†åˆ† Shell ä¼šæ‰«æä¸åœ¨åŒå¼•å·ä¹‹å†…çš„å‚æ•°å±•å¼€ã€å‘½ä»¤æ›¿æ¢å’Œç®—æœ¯å±•å¼€çš„ç»“æœï¼Œç”¨äºå•è¯æ‹†åˆ†ã€‚åˆ†éš”ç¬¦ä¸ºå˜é‡ IFS ä¸­çš„æ¯ä¸ªå­—ç¬¦ï¼Œé»˜è®¤ä¸º \u0026lt;space\u0026gt;\u0026lt;tab\u0026gt;\u0026lt;newline\u0026gt;ã€‚\næ–‡ä»¶åå±•å¼€ å•è¯æ‹†åˆ†ä¹‹åï¼Œå¦‚æœ bash çš„ -f é€‰é¡¹æ²¡æœ‰è¢«è®¾ç½®ï¼Œbash å°±ä¼šæ‰«ææ¯ä¸ªå•è¯ï¼Œå¯»æ‰¾å­—ç¬¦ *ã€?ã€[ã€‚å¦‚æœè¿™ä¸‰ä¸ªå­—ç¬¦æœ‰æ‰€å‡ºç°ï¼Œå•è¯ä¼šè¢«è§†ä¸ºä¸€ä¸ªæ¨¡å¼ï¼ˆPATTERNï¼‰ï¼Œç„¶åè¢«æ›¿æ¢ä¸ºä¸€ä¸ªæŒ‰ç…§å­—æ®µåºæ’åˆ—ä¸è¿™ä¸ªæ¨¡å¼ç›¸åŒ¹é…çš„æ–‡ä»¶ååˆ—è¡¨ã€‚\nå‚è€ƒèµ„æ–™  Bash Guide for Beginners. Advanced Bash-Scripting Guide.  ","href":"/posts/linux/shell_scripting_shell_expansion/","title":"Shell è„šæœ¬ï¼šshell å±•å¼€"},{"content":"å’Œå…¶å®ƒç¼–ç¨‹è¯­è¨€ç±»ä¼¼ï¼Œbash ä¹Ÿç»™æˆ‘ä»¬æä¾›äº†æ¡ä»¶è¯­å¥ï¼ˆconditional statementsï¼‰ã€‚\næ¡ä»¶åˆ†æ”¯ if åœ¨ shell ä¸­ï¼Œif/then çš„è¯­æ³•ä¸ºï¼šif TEST-COMMANDS; then CONSEQUENT-CONMMANDS; fiã€‚\nTEST-COMMANDS åˆ—è¡¨æ‰§è¡Œåï¼Œå¦‚æœå®ƒçš„è¿”å›çŠ¶æ€æ˜¯ 0ï¼Œå°±æ‰§è¡Œ CONSEQUENT-COMMANDS åˆ—è¡¨ï¼Œå…¶ä¸­æœ€åä¸€æ¡å‘½ä»¤çš„é€€å‡ºçŠ¶æ€å°±æ˜¯æ•´ä¸ª if è¡¨è¾¾å¼çš„è¿”å›çŠ¶æ€ã€‚\nåœ¨ UNIX/Linux ä¸­ï¼Œé€šå¸¸ç”¨ 0 è¡¨ç¤ºæˆåŠŸï¼Œéé›¶è¡¨ç¤ºå¤±è´¥ã€‚\nif/then/else If/then/else çš„è¯­æ³•ä¸ºï¼šif TEST-COMMANDS; then CONSEQUENT-CONMMANDS; else ALTERNATE-CONSEQUENT-COMMANDS; fi\nif/then/elif/else if è¡¨è¾¾å¼çš„å®Œæ•´çš„è¯­æ³•ä¸ºï¼šif TEST-COMMANDS; then CONSEQUENT-CONMMANDS; elif MORE-TEST-COMMANDS; then MORE-CONSEQUENT-COMMANDS; else ALTERNATE-CONSEQUENT-COMMANDS; fi\ntest test æ˜¯ä¸€ä¸ª bash å†…ç½®çš„å‘½ä»¤ï¼Œç”¨äºæ£€æŸ¥æ–‡ä»¶çš„ç±»å‹å’Œè¿›è¡Œå€¼çš„æ¯”è¾ƒã€‚ç‰¹æ®Šå­—ç¬¦ [ æ˜¯ test çš„åŒä¹‰è¯ã€‚\n[] ä¸ [[]] çš„åŒºåˆ«åœ¨äºï¼š[[]]ï¼ˆextended test commandï¼‰æ¯” [] æ›´å¼ºï¼Œå®ƒä¼šé˜»æ­¢ shell è¿›è¡Œå˜é‡åçš„åˆ†è¯æ“ä½œã€é˜»æ­¢è·¯å¾„åå±•å¼€ã€‚[ å’Œ [[ çš„ç±»å‹ä¹Ÿä¸åŒï¼š\n~$ type [ [ is a shell builtin ~$ type [[ [[ is a shell keyword è¿˜æœ‰æ›´åŠ æœ‰è¶£çš„ï¼š\n~$ type ] -bash: type: ]: not found ~$ type ]] ]] is a shell keyword  A builtin is a command contained within the Bash tool set, literally built in.\n  A keyword is a reserved word, token or operator. A keyword is not in itself a command, but a subunit of a command construct.\n ä¸æ–‡ä»¶ç›¸å…³çš„æµ‹è¯•æ“ä½œç¬¦å¾ˆå¤šï¼Œè¿›ä¸€æ­¥æŸ¥çœ‹ï¼šFile test operatorsã€‚ æ¯”è¾ƒæ“ä½œç¬¦ä¹Ÿæœ‰å¾ˆå¤šï¼Œè¿›ä¸€æ­¥æŸ¥çœ‹ï¼šOther Comparision Operatorsã€‚\ncase case è¡¨è¾¾å¼çš„è¯­æ³•ä¸ºï¼šcase EXPRESSION in CASE1) COMMAND-LIST;; CASE2) COMMAND-LIST;; ... CASEN) COMMAND-LIST;; esac\næ¯ä¸ª case éƒ½æ˜¯ä¸€ä¸ªåŒ¹é…æ¨¡å¼çš„è¡¨è¾¾å¼ï¼Œè‹¥æŸä¸ª case çš„æ¨¡å¼åŒ¹é…æˆåŠŸï¼Œåˆ™æ‰§è¡Œ ) åçš„ COMMAND-LISTã€‚) çš„ä»£è¡¨ç€æ¨¡å¼çš„ç»“æŸï¼Œå®ƒå‰é¢ç”šè‡³å¯ä»¥å†™å¤šä¸ªæ¨¡å¼ï¼Œæ¯ä¸ªæ¨¡å¼ä¹‹å‰ç”¨ | åˆ†éš”ï¼Œä¾‹å¦‚ï¼š\ncase $1 in start | Start) start ;; *) echo \u0026#34;Default branch\u0026#34; ;; esac æ¯ä¸ª case åŠ ä¸Šå¯¹åº”çš„ COMMAND-LIST å°±æ„æˆäº†ä¸€ä¸ªå­å¥ï¼ˆclauseï¼‰ï¼Œæ¯ä¸ªå­å¥éƒ½å¿…é¡»ä»¥ ;; ç»“æŸ\nselect select è¯­å¥çš„è¯­æ³•ä¸ºï¼šselect WORD [in LIST]; do RESPECTIVE-COMMANDS; doneã€‚select ç»“æ„ä¸€èˆ¬ç”¨äºç”Ÿæˆèœå•ã€‚\nå¾ªç¯ for for å¾ªç¯çš„è¯­æ³•ä¸ºï¼šfor NAME [in LIST ]; do COMMANDS; doneã€‚å¦‚æœ [in LIST] ä¸å­˜åœ¨ï¼Œåˆ™å®ƒä¼šè¢«æ›¿æ¢ä¸º in $@ï¼Œfor å¾ªç¯ä¼šä¸ºæ¯ä¸€ä¸ªä½ç½®å‚æ•°æ‰§è¡Œä¸€é COMMANDSã€‚\nwhile while å¾ªç¯çš„è¯­æ³•ä¸ºï¼šwhile CONTROL-COMMAND; do CONSEQUENT-COMMANDS; done\nuntil until å¾ªç¯çš„è¯­æ³•ä¸ºï¼šuntil TEST-COMMAND; do CONSEQUENT-COMMANDS; doneã€‚until å¾ªç¯ä¸ while å¾ªç¯ç¨æœ‰ä¸åŒï¼Œå®ƒä¼šåœ¨ TEST-COMMAND ä¸º false æ—¶ç»§ç»­å¾ªç¯ï¼Œåœ¨ TEST-COMMAND ä¸º true æ—¶ç»“æŸå¾ªç¯ï¼ŒäºŒè€…å¾ªç¯è¿›è¡Œçš„æ¡ä»¶åˆšå¥½ç›¸åã€‚\nbreak \u0026amp; continue break å’Œ continue æ˜¯ä¸¤ä¸ªèƒ½å¤Ÿå½±å“å¾ªç¯æ‰§è¡Œçš„å‘½ä»¤ï¼šå‰è€…ç»ˆæ­¢æ•´ä¸ªå¾ªç¯ï¼Œåè€…è·³è¿‡å½“å‰å¾ªç¯è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚\nå‚è€ƒèµ„æ–™  Bash Guide for Beginners. Advanced Bash-Scripting Guide.  ","href":"/posts/linux/shell_scripting_conditional_statements_and_loops/","title":"Shell è„šæœ¬ï¼šæ¡ä»¶åˆ†æ”¯ä¸å¾ªç¯"},{"content":"Shell è„šæœ¬ç”¨å˜é‡ï¼ˆvariableï¼‰æ¥è¡¨ç¤ºæ•°æ®ï¼Œå˜é‡ä»…ä»…åªæ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼ˆlabelï¼‰ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼ˆreferenceï¼‰æˆ–æŒ‡é’ˆï¼ˆpointerï¼‰ï¼ŒæŒ‡å‘ç€ä¸å˜é‡ç›¸å…³è”çš„å®é™…æ•°æ®æ‰€å­˜æ”¾çš„å†…å­˜åœ°å€ã€‚ å˜é‡çš„åå­—å°±æ˜¯å˜é‡çš„å€¼çš„å ä½ç¬¦ï¼ˆplacehoderï¼‰ï¼Œå˜é‡çš„å€¼ï¼ˆvalueï¼‰æŒæœ‰ç€æ•°æ®ã€‚å¼•ç”¨ï¼ˆreferenceï¼‰æˆ–æ£€ç´¢ï¼ˆretriveï¼‰å˜é‡çš„å€¼çš„æ“ä½œè¢«ç§°ä¸ºå˜é‡æ›¿æ¢ï¼ˆvariable substitutionï¼‰ã€‚\nå˜é‡çš„åå­—å’Œå€¼æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œå¦‚æœ variable1 æ˜¯ä¸€ä¸ªå˜é‡çš„åå­—ï¼Œé‚£ä¹ˆ $variable1ï¼ˆ$variable1 æ˜¯ ${variable1} çš„ç®€å•å½¢å¼ï¼‰å°±æ˜¯å¯¹è¯¥å˜é‡å€¼çš„å¼•ç”¨ã€‚$ ç¬¦å·åœ¨è¿™é‡Œçš„ä½œç”¨å°±æ˜¯è¿›è¡Œå˜é‡æ›¿æ¢ã€‚\næŒ‰ç…§ä½œç”¨åŸŸçš„ä¸åŒï¼Œå˜é‡åˆ†ä¸ºå…¨å±€å˜é‡ï¼ˆglobal variablesï¼‰å’Œå±€éƒ¨å˜é‡ï¼ˆlocal variablesï¼‰\n å…¨å±€å˜é‡ä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸è¯´çš„ç¯å¢ƒå˜é‡ï¼ˆenvironment variablesï¼‰ï¼Œå¯¹æ‰€æœ‰çš„ shell éƒ½æœ‰æ•ˆã€‚æŸ¥çœ‹ç¯å¢ƒå˜é‡çš„å‘½ä»¤ï¼šenv æˆ– printenvã€‚ å±€éƒ¨å˜é‡åªå¯¹å½“å‰çš„ shell æœ‰æ•ˆã€‚ä½¿ç”¨ shell å†…ç½®çš„ set å‘½ä»¤ï¼ˆä¸å¸¦ä»»ä½•é€‰é¡¹å‚æ•°ï¼‰å°±å¯ä»¥è¾“å‡ºæ‰€æœ‰å˜é‡ï¼ˆåŒ…æ‹¬ç¯å¢ƒå˜é‡ï¼‰å’Œä¸€ç³»åˆ—çš„å‡½æ•°ã€‚  åˆ›å»ºå˜é‡ å˜é‡åæ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼Œä¸€èˆ¬ç”¨å¤§å†™å‘½åå…¨å±€å˜é‡ï¼Œç”¨å°å†™å‘½åå±€éƒ¨å˜é‡ã€‚å˜é‡åå¯ä»¥åŒ…å«æ•°å­—ï¼Œä½†æ˜¯ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ã€‚å®šä¹‰å˜é‡çš„è¯­æ³•ä¸ºï¼šVARNAME=valueã€‚\n~$ variable1=123 ~$ echo variable1 variable1 ~$ echo $variable1 123 ~$ echo ${variable1} 123 ä¸æˆ‘ä»¬å¸¸ç”¨çš„ç¼–ç¨‹è¯­è¨€ä¸åŒï¼Œshell ä¸­å˜é‡å®šä¹‰ä¸­çš„ ç­‰å·ä¸¤ä¾§æ˜¯ä¸èƒ½æœ‰ç©ºæ ¼çš„ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚è¿™ä¸ shell å¯¹å‘½ä»¤çš„è§£é‡Šæœ‰å…³ï¼Œä¾‹å¦‚ï¼š\n shell ä¼šå°† VARIABLE =value å½“ä½œå‘½ä»¤ VARIABLE è¿è¡Œï¼Œå®ƒæœ‰ä¸€ä¸ªå‚æ•° =value shell ä¼šå°† VARIABLE= value å½“ä½œå‘½ä»¤ value è¿è¡Œï¼Œå¹¶ä¸”è®¤ä¸ºæœ‰ä¸€ä¸ªå€¼ä¸º \u0026quot;\u0026quot; çš„ç¯å¢ƒå˜é‡ VARIABLE  ~$ VARIABLE= value value: command not found ~$ VARIABLE =value VARIABLE: command not found ~$ VARIABLE = value VARIABLE: command not found ä»æŠ€æœ¯çš„è§’åº¦æ¥è¯´ï¼Œå˜é‡çš„åå­—å› å‡ºç°åœ¨èµ‹å€¼è¯­å¥çš„å·¦è¾¹è€Œè¢«ç§°ä¸º lvalueï¼Œå˜é‡çš„å€¼å› å‡ºç°åœ¨èµ‹å€¼è¯­å¥çš„å³è¾¹è€Œè¢«ç§°ä¸º rvalueã€‚\nå˜é‡çš„ç±»å‹ Bash å¹¶ä¸åƒå…¶å®ƒç¼–ç¨‹è¯­è¨€é‚£æ ·çœ‹é‡å˜é‡çš„ç±»å‹ã€‚Bash å˜é‡æœ¬è´¨ä¸Šéƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯æ ¹æ®ä¸Šä¸‹æ–‡çš„ä¸åŒï¼Œå¦‚æœbash ä¹Ÿæ˜¯å…è®¸åœ¨å˜é‡ä¸Šè¿›è¡Œç®—æœ¯è¿ç®—å’Œæ¯”è¾ƒæ“ä½œçš„ã€‚\nå¦‚æœå˜é‡çš„å€¼åªåŒ…å«æ•°å­—ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¯ä»¥åœ¨å®ƒä¸Šé¢è¿›è¡Œæ­£å¸¸çš„ç®—æœ¯è¿ç®—çš„ã€‚å¦‚æœå˜é‡çš„å€¼ä¸º null æˆ–åŒ…å«æ•°å­—ä»¥å¤–çš„å­—ç¬¦ï¼Œåœ¨å®ƒä¸Šé¢è¿›è¡Œç®—æœ¯è¿ç®—æ—¶ï¼Œå˜é‡çš„å€¼ä¼šè¢«å½“åšæ•´æ•° 0ã€‚\nè®¾ç½®å˜é‡çš„ç±»å‹ å¦‚æœæˆ‘ä»¬ç¡¬æ˜¯è¦æŒ‡å®šå˜é‡çš„ç±»å‹ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚Shell å†…ç½®çš„ declare å’Œ typeset å‘½ä»¤éƒ½å¯ä»¥è®¾ç½®å˜é‡çš„å€¼å’Œå±æ€§ï¼Œè¿™ä¸¤ä¸ªå‘½ä»¤æ˜¯åŒä¹‰è¯ï¼ˆsynonymï¼‰ã€‚declare è¯­å¥çš„è¯­æ³•ä¸ºï¼šdeclare OPTION(s) VARIABLE=valueï¼Œå®ƒæ”¯æŒçš„é€‰é¡¹å¯ä»¥ç”¨ man å‘½ä»¤æŸ¥çœ‹ã€‚\nå¯¼å‡ºå˜é‡ åœ¨ shell ä¸­åˆ›å»ºçš„å˜é‡åªå¯¹å½“å‰ shell æœ‰æ•ˆï¼Œå®ƒä»¬éƒ½æ˜¯å±€éƒ¨å˜é‡ã€‚å¦‚æœæˆ‘ä»¬åœ¨å½“å‰ shell ä¸­ä½¿ç”¨ bash æˆ–ç±»ä¼¼çš„å‘½ä»¤å¼€å¯ä¸€ä¸ªå­ shellï¼Œçˆ¶ shell ä¸­å®šä¹‰çš„å˜é‡æ˜¯ä¸å¯ç”¨çš„ã€‚è¦å°†å˜é‡ä¼ é€’åˆ°å­ shell ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ export å‘½ä»¤å¯¼å‡ºå˜é‡ï¼Œå¯¼å‡ºåçš„å˜é‡å°±ä¼šè¢«å½“ä½œç¯å¢ƒå˜é‡å¯¹å¾…ã€‚\nç‰¹æ®Šå‚æ•°ï¼ˆSpecial parametersï¼‰ ä»å‘½ä»¤è¡Œä¼ é€’ç»™è„šæœ¬çš„å‚æ•°ç”¨ï¼š$0,$1,$2,$3... è¡¨ç¤ºã€‚å…¶ä¸­ï¼Œ$0 æ—¶è„šæœ¬æœ¬èº«çš„åå­—ï¼Œ$1 æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ$2 æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¾æ¬¡ç±»æ¨ã€‚$9 ä¹‹åçš„å‚æ•°å¿…é¡»ç”¨å¤§æ‹¬å·åŒ…è£¹èµ·æ¥ï¼Œä¾‹å¦‚ï¼š${10}ã€‚è¿™äº›å‚æ•°ç”±äºå’Œå‡ºç°ä½ç½®æœ‰å…³ï¼Œæ‰€ä»¥è¢«ç§°ä¸ºä½ç½®å‚æ•°ï¼ˆpositional parametersï¼‰ã€‚ç‰¹æ®Šå˜é‡ $* å’Œ $@ è¡¨ç¤ºæ‰€æœ‰çš„å‚æ•°ã€‚\nQuoting characters åœ¨æœ‰äº›ä¸Šä¸‹æ–‡ä¸­ï¼Œå¾ˆå¤šå­—ç¬¦æˆ–è€…å•è¯éƒ½æœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼Œç”¨ç‰¹æ®Šç¬¦å·å°†å®ƒä»¬å¼•èµ·æ¥å¯ä»¥æ¶ˆé™¤è¿™äº›ç‰¹æ®Šå«ä¹‰ã€‚\n~$ a=123 è½¬ä¹‰å­—ç¬¦ï¼ˆ\\ï¼‰ è½¬ä¹‰å­—ç¬¦ï¼ˆEscape charactersï¼‰ç”¨æ¥ç§»é™¤å…¶å å•ä¸ªå­—ç¬¦ çš„ç‰¹æ®Šå«ä¹‰ã€‚Bash ä¸­çš„è½¬ä¹‰å­—ç¬¦æ˜¯åæ–œæ ï¼ˆ\\ï¼‰ã€‚\n~$ echo \\$a $a ~$ echo \\${a} ${a} è½¬ä¹‰ç¬¦åœ¨è¡Œå°¾ï¼ˆå¯¹æ¢è¡Œç¬¦è¿›è¡Œè½¬ä¹‰ï¼‰æ—¶ï¼Œè¡¨ç¤ºå½“å‰è¡Œçš„å‘½ä»¤è¿˜æœªå†™å®Œã€‚è¿™å…è®¸æˆ‘ä»¬å†™å‡ºå¯è¯»æ€§æ›´å¼ºçš„é•¿å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š\n~$ echo foo\\ \u0026gt; bar foobar å•å¼•å·ï¼ˆ''ï¼‰ å°†å˜é‡çš„å¼•ç”¨æ”¾åœ¨å•å¼•å·ä¸­ï¼ˆ'â€¦'ï¼‰å°±ä¼šè®©å˜é‡åè¢«å½“ä½œå­—é¢å€¼å¤„ç†ï¼Œå³ä¸ä¼šå‘ç”Ÿå˜é‡æ›¿æ¢ï¼Œæ‰€ä»¥å•å¼•å·è¢«ç§°ä¸ºâ€œfull quotingâ€ï¼Œæœ‰æ—¶åˆç§°â€œstrong quotingâ€ã€‚\n~$ echo \u0026#39;$a\u0026#39; $a ~$ echo \u0026#39;${a}\u0026#39; ${a} å•å¼•å·ï¼ˆSingle quotesï¼‰è¢«ç”¨æ¥ç§»é™¤ä¸¤ä¸ªå•å¼•å·ä¹‹é—´ æ‰€æœ‰å­—ç¬¦ çš„ç‰¹æ®Šå«ä¹‰ï¼Œå³å•å¼•å·ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯å­—é¢å€¼ï¼ˆliteral valueï¼‰ã€‚ä¸¤ä¸ªå•å¼•å·ä¹‹é—´æ˜¯ä¸èƒ½æœ‰å•å¼•å·çš„ï¼Œå³ä¾¿è¿™ä¸ªå•å¼•å·è¢«è½¬ä¹‰éƒ½ä¸è¡Œã€‚\nåŒå¼•å·ï¼ˆ\u0026quot;\u0026quot;ï¼‰ å°†å˜é‡çš„å¼•ç”¨æ”¾åœ¨åŒå¼•å·ä¸­ï¼ˆ\u0026quot;â€¦\u0026quot;ï¼‰å¹¶ä¸ä¼šå¯¹å˜é‡æ›¿æ¢é€ æˆå½±å“ï¼Œæ‰€ä»¥åŒå¼•å·è¢«ç§°ä¸ºâ€œpartial quotingâ€ï¼Œæœ‰æ—¶åˆç§°â€œweak quotingâ€ã€‚\nåŒå¼•å·ï¼ˆDouble quotesï¼‰ä¼šç§»é™¤ä¸¤ä¸ªåŒå¼•å·ä¹‹é—´é™¤ç¾å…ƒç¬¦å·ï¼ˆ$ï¼‰ã€åå¼•å·ï¼ˆ`ï¼‰å’Œåæ–œæ ï¼ˆ\\ï¼‰ä¹‹å¤–çš„æ‰€æœ‰å­—ç¬¦çš„ç‰¹æ®Šå«ä¹‰ã€‚ç¾å…ƒç¬¦å·å’Œåå¼•å·çš„ç‰¹æ®Šå«ä¹‰åœ¨åŒå¼•å·ä¹‹é—´ä¼šä¿ç•™ï¼Œè€Œåæ–œæ åªæœ‰åœ¨å…¶åçš„å­—ç¬¦æ˜¯ç¾å…ƒç¬¦å·ã€åå¼•å·ã€åŒå¼•å·ã€åæ–œæ æˆ–æ¢è¡Œç¬¦æ—¶æ‰ä¿ç•™ç‰¹æ®Šå«ä¹‰ï¼Œè¾“å…¥æµä¼šå°†è¿™äº›å­—ç¬¦å‰çš„åæ–œæ å»æ‰ã€‚åŒå¼•å·ä¹‹é—´æ˜¯å¯ä»¥æœ‰ç”±åæ–œæ è½¬ä¹‰çš„åŒå¼•å·çš„ã€‚\n~$ echo \u0026#34;$a\u0026#34; 123 ~$ echo \u0026#34;${a}\u0026#34; 123 åŒå¼•å·è¿˜å¯ä»¥ä¿ç•™å˜é‡å€¼ä¸­çš„ç©ºç™½ç¬¦ï¼Œé˜²æ­¢ shell åœ¨è§£é‡Šå‘½ä»¤æ—¶å»æ‰å¤šä½™çš„ç©ºç™½ç¬¦ã€‚\n~$ hello=\u0026#34;A B C D\u0026#34; echo $hello A B C D echo \u0026#34;$hello\u0026#34; A B C D å‚æ•°æ›¿æ¢ ${parameter}ï¼šè·å–å˜é‡ parameter çš„å€¼ï¼ŒåŒ $parameterï¼Œä½†æ˜¯å‰è€…çš„å«ä¹‰æ›´åŠ æ˜ç¡®\n~$ param=123 ~$ echo ${param} 123 ${parameter-default} æˆ– ${parameter:-default}ï¼šå¦‚æœå‚æ•° parameter æœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨ default ä½œä¸ºç»“æœï¼Œä½†ä¸ä¼šå°† default èµ‹å€¼ç»™ parameterã€‚: çš„ä½œç”¨æ˜¯ï¼šå¦‚æœ parameter å·²å£°æ˜ä¸”å€¼ä¸º nullï¼Œåˆ™ä½¿ç”¨ defaultã€‚è‹¥æ²¡æœ‰ :ï¼Œåˆ™åªè¦ parameter å·²å£°æ˜ï¼Œå°±ä¸ä¼šä½¿ç”¨ default\n~$ echo ${param-1} 123 ~$ echo ${param:-1} 123 ~$ echo ${param1-1} 1 ~$ echo ${param2:-2} 2 ~$ param3= # param3 is declared, but is null ~$ echo ${param3:-3} 3 ~$ echo ${param3-3} ~$ echo ${param3} ${parameter=default} å’Œ ${parameter:=default}ï¼šå¦‚æœ parameter æœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨ default å¹¶å°†å…¶èµ‹å€¼ç»™ parameterã€‚è¿™é‡Œ : çš„å«ä¹‰ä¸ ${parameter:-default} ä¸­çš„ : ç±»ä¼¼ã€‚\n~$ param4= # param4 is declared, but is null ~$ echo ${param4:=4} 4 ~$ echo ${param5=5} 5 ~$ echo ${param5} 4 ${parameter+alt_value} å’Œ ${parameter:+alt_value}ï¼šå¦‚æœ parameter å·²è®¾ç½®ï¼Œåˆ™ä½¿ç”¨ alt_value ä½†ä¸è¿›è¡Œèµ‹å€¼ï¼Œå¦åˆ™ä½¿ç”¨ nullã€‚\n${parameter?err_msg} å’Œ ${parameter:?err_msg}ï¼šå¦‚æœ parameter å·²è®¾ç½®ï¼Œåˆ™ä½¿ç”¨å®ƒï¼Œå¦åˆ™æ‰“å° err_msg å¹¶ç»ˆæ­¢è„šæœ¬æ‰§è¡Œã€‚\n${#var}ï¼šè®¡ç®—å­—ç¬¦ä¸² var çš„é•¿åº¦ï¼Œæˆ–æ•°ç»„ var ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„é•¿åº¦ã€‚\n${var#Pattern} å’Œ ${var##Pattern}ï¼šä» $var é¦–éƒ¨å¼€å§‹ç§»é™¤ $Pattern æœ€çŸ­ï¼ˆ#ï¼‰æˆ–æœ€é•¿ï¼ˆ##ï¼‰åŒ¹é…ä¸Šçš„éƒ¨åˆ†ã€‚\n${var%Pattern} å’Œ ${var%%Pattern}ï¼šä» $var å°¾éƒ¨å¼€å§‹ç§»é™¤ $Pattern æœ€çŸ­ï¼ˆ%ï¼‰æˆ–æœ€é•¿ï¼ˆ%%ï¼‰åŒ¹é…ä¸Šçš„éƒ¨åˆ†ã€‚\n${var:pos}ï¼šä»åç§»é‡ pos å¤„ï¼ˆå³è·³è¿‡ pos ä¸ªå­—ç¬¦ï¼‰å±•å¼€ $varã€‚\n${var:pos:len}ï¼šä»åç§»é‡ pos å¤„å±•å¼€æœ€å¤§é•¿åº¦ä¸º len ä¸ªå­—ç¬¦ã€‚\n${var/Pattern/Replacement}ï¼šä½¿ç”¨ Replacement æ›¿æ¢ var ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…ä¸Š Pattern çš„éƒ¨åˆ†ã€‚\n${var//Pattern/Replacement}ï¼šä½¿ç”¨ Replacement æ›¿æ¢ var ä¸­æ‰€æœ‰åŒ¹é…ä¸Š Pattern çš„éƒ¨åˆ†ã€‚\n${var/#Pattern/Replacement}ï¼šè‹¥ var çš„å‰ç¼€åŒ¹é…ä¸Šäº† Patternï¼Œåˆ™ä½¿ç”¨ Replacement æ›¿æ¢ Patternã€‚\n${var/%Pattern/Replacement}ï¼šè‹¥ var çš„åç¼€åŒ¹é…ä¸Šäº† Patternï¼Œåˆ™ä½¿ç”¨ Replacement æ›¿æ¢ Patternã€‚\n${!varprefix*} å’Œ ${!varprefix@}ï¼šç­›é€‰å‡ºæ‰€æœ‰åå­—ä»¥ varprefix å¼€å¤´çš„å·²å£°æ˜çš„å˜é‡ã€‚\nå‚è€ƒèµ„æ–™  Bash Guide for Beginners. Advanced Bash-Scripting Guide.  ","href":"/posts/linux/shell_scripting_variables/","title":"Shell è„šæœ¬ï¼šå˜é‡"},{"content":" æ¥ä¸‹æ¥å°†ä¼šæœ‰ä¸€ç³»åˆ—ä¸ Shell è„šæœ¬ç›¸å…³çš„ç¬”è®°æ–‡ç« ã€‚åœ¨ä¹‹å‰çš„å·¥ä½œä¸­ï¼Œä½œä¸ºä¸€ä¸ª Java Boyï¼Œæˆ‘å‡ ä¹ä¸éœ€è¦è‡ªå·±ç¼–å†™ Shell è„šæœ¬ï¼Œæ‰€ä»¥å¤§å­¦å­¦è¿‡çš„ Shell è„šæœ¬ç¼–ç¨‹åŸºæœ¬å¿˜å®Œï¼ˆå®é™…ä¸Šæˆ‘å¹¶æ²¡æœ‰ç³»ç»Ÿçš„å­¦è¿‡å®ƒğŸ˜‚ï¼‰ï¼Œå·¥ä½œä¸­ç¢°åˆ°ç›¸å…³ä¸œè¥¿æ—¶ä¹Ÿæ˜¯ Google ä¸€ä¸‹å°±æå®šäº†ã€‚ä½†æ˜¯ï¼Œç°åœ¨çš„å·¥ä½œè¦æ±‚æˆ‘èƒ½å¤Ÿç¼–å†™ Shell è„šæœ¬å®ç°ä¸€äº›è‡ªåŠ¨åŒ–æ“ä½œï¼Œæ‰€ä»¥æˆ‘å†³å®šç³»ç»Ÿåœ°å­¦ä¹ ä¸€ä¸‹ Shell è„šæœ¬ç¼–ç¨‹çš„ç›¸å…³çŸ¥è¯†ã€‚ä¸»è¦å‚è€ƒçš„å­¦ä¹ èµ„æ–™æ˜¯ The Linux Documentation Project ç½‘ç«™ä¸Šæ¨èçš„ä¸¤æœ¬åœ¨çº¿ä¹¦ç±ï¼šBash Guide for Beginners å’Œ Advanced Bash-Scripting Guideã€‚å‰è€…é€‚åˆå…¥é—¨ï¼Œåè€…é€‚åˆç²¾è¿›ï¼Œæ„Ÿè°¢ä½œè€…çš„æ— ç§åˆ†äº«ã€‚\n Shell Shell æ—¢æ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ï¼ˆcommand interpreterï¼‰ï¼Œåˆæ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€ã€‚Shell è„šæœ¬ï¼ˆshell scriptsï¼‰æ˜¯ç”¨ shell ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œå®ƒå¯ä»¥å°†ç³»ç»Ÿè°ƒç”¨ã€å„ç§å·¥å…·å’Œå·²ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ç²˜åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆæ–°çš„åº”ç”¨ã€‚\nShell è„šæœ¬æ˜¯è§£é‡Šæ‰§è¡Œçš„ï¼Œshell ä»è„šæœ¬ä¸­é€è¡Œè¯»å–å‘½ä»¤ï¼Œç„¶ååœ¨ç³»ç»Ÿä¸­æ˜‚æœç´¢è¿™äº›å‘½ä»¤å¹¶æ‰§è¡Œã€‚\nShell æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ shï¼ˆBourne Shellï¼‰ã€bashï¼ˆBourne Again shellï¼‰ã€cshï¼ˆC shellï¼‰ã€tcshï¼ˆTENEX C shellï¼‰ã€kshï¼ˆKorn shellï¼‰ã€tmux ç­‰\næŸ¥çœ‹ç³»ç»Ÿå†…å·²ç»æœ‰çš„ shellï¼šcat /etc/shells æŸ¥çœ‹å½“å‰ç”¨æˆ·é»˜è®¤çš„ shellï¼šcat /etc/passwd | grep $USER | awk 'BEGIN { FS=\u0026quot;:\u0026quot; } { print $7 }\nBash ç»å¤§å¤šæ•° Linux/Unix ç³»ç»Ÿé»˜è®¤çš„ shell éƒ½æ˜¯ bashï¼Œbash ä¸ sh ç›¸å…¼å®¹ï¼Œä½†æ˜¯èƒ½åŠ›æ›´å¼ºã€‚\nBash å¯åŠ¨æ—¶åŠ è½½çš„æ–‡ä»¶ å½“ bash åœ¨ä¸åŒçš„æƒ…å†µä¸‹è¢«è°ƒç”¨æ—¶ï¼ˆinvokedï¼‰ï¼Œå®ƒä¼šåœ¨å¯åŠ¨æ—¶ä¼šè¯»å–å¹¶æ‰§è¡Œä¸€äº›ç‰¹å®šçš„æ–‡ä»¶ï¼Œæ–‡ä»¶çš„è¯»å–é¡ºåºä¼šåœ¨ä¸‹é¢åˆ—å‡ºï¼Œå¦‚æœæŸä¸ªæ–‡ä»¶ä¸å­˜åœ¨ï¼Œbash å°±ä¼šè·³è¿‡å®ƒç»§ç»­æŸ¥æ‰¾ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚\nInvoked as an interactive login shellï¼Œor with --login äº¤äº’å¼ï¼ˆinteractiveï¼‰bash æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è¾“å…¥å‘½ä»¤ï¼Œshell é€šå¸¸ä¼šä»å®ƒè¿æ¥åˆ°çš„ç»ˆç«¯ï¼ˆterminalï¼‰è¯»å–å‘½ä»¤ï¼Œç„¶åå°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°ç»ˆç«¯ã€‚è€Œâ€œlogin shellâ€åˆ™è¡¨ç¤ºç³»ç»Ÿä¼šåœ¨ä½¿ç”¨è€…ä½¿ç”¨ shell ä¹‹å‰å¯¹å…¶è¿›è¡Œèº«ä»½çš„è®¤è¯ï¼ˆé€šå¸¸è¦ä½¿ç”¨è€…æä¾›ç”¨æˆ·åå’Œå¯†ç ï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ bash å¯åŠ¨æ—¶è¯»å–çš„æ–‡ä»¶æœ‰ï¼š\n /etc/profile ~/.bash_profile or ~/.bash_login or ~/.profileï¼šç¬¬ä¸€ä¸ªå­˜åœ¨çš„å¯è¯»æ–‡ä»¶ä¼šè¢«è¯»å– ~/.bash_logoutï¼šé€€å‡ºæ—¶è¯»å–  Invoked as an interactive non-login shell non-login shell è¡¨ç¤ºç³»ç»Ÿåœ¨ä½¿ç”¨è€…ä½¿ç”¨ shell ä¹‹å‰ä¸ä¼šå¯¹å…¶è¿›è¡Œèº«ä»½çš„è®¤è¯ã€‚è¿™ç§æƒ…å†µä¸‹è¯»å–çš„æ–‡ä»¶æœ‰ï¼š\n ~/.bashrc  Invoked non-interactively æ‰€æœ‰ bash è„šæœ¬ä½¿ç”¨çš„éƒ½æ˜¯éäº¤äº’å¼ï¼ˆnon-interactivelyï¼‰shellã€‚è¿™æ—¶è¯»å–çš„æ–‡ä»¶æœ‰ï¼š\n ç”±å˜é‡ BASH_ENV å®šä¹‰çš„æ–‡ä»¶ï¼Œä¸è¿‡åœ¨æœç´¢è¿™ä¸ªæ–‡ä»¶æ—¶å¹¶ä¸ä¼šç”¨ä¸Š PATH  Invoked with the sh command è¿™ä¸ªæ—¶å€™è¯»å–çš„æ–‡ä»¶æœ‰ï¼š\n /etc/profile ~/.profile  Shell è¯­æ³• å¦‚æœè¾“å…¥ä¸æ˜¯æ³¨é‡Šï¼ˆcommentï¼‰ï¼Œshell ä¼šè¯»å…¥å¹¶å°†å…¶æ‹†åˆ†æˆå•è¯ï¼ˆwordï¼‰å’Œæ“ä½œç¬¦ï¼ˆoperatorï¼‰ï¼Œä½¿ç”¨â€œquoting rulesâ€ç¡®å®šè¾“å…¥ä¸­æ¯ä¸ªå­—ç¬¦çš„å«ä¹‰ã€‚ç„¶åï¼Œè¿™äº›å•è¯å’Œæ“ä½œç¬¦ä¼šè¢«ç¿»è¯‘æˆå‘½ä»¤å’Œå…¶å®ƒç»“æ„ï¼ˆconstructï¼‰ã€‚Shell åˆ†æè¾“å…¥çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š\n Shell ä»æ–‡ä»¶ã€å­—ç¬¦ä¸²æˆ–ç”¨æˆ·çš„ç»ˆç«¯è¯»å–è¾“å…¥ æŒ‰ç…§â€œquoting rulesâ€å°†è¾“å…¥åˆ†è§£ä¸ºå•è¯å’Œæ“ä½œç¬¦ã€‚è¿™äº›ç¬¦å·ï¼ˆtokenï¼‰è¢«å…ƒå­—ç¬¦ï¼ˆmetacharacterï¼‰åˆ†éš”ã€‚åˆ«åï¼ˆaliasï¼‰å±•å¼€è¢«æ‰§è¡Œ Shell å°†è¿™äº›ç¬¦å·è§£æï¼ˆåˆ†æå’Œæ›¿æ¢ï¼‰æˆç®€å•å‘½ä»¤æˆ–å¤åˆå‘½ä»¤ Bash æ‰§è¡Œå„ç§ shell å±•å¼€ï¼ˆexpansionï¼‰ï¼Œå°†å±•å¼€çš„ç¬¦å·åˆ†è§£æˆæ–‡ä»¶åï¼ˆfilenameï¼‰ã€å‘½ä»¤ï¼ˆcommandï¼‰å’Œå‚æ•°ï¼ˆargumentï¼‰åˆ—è¡¨ å¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œé‡å®šå‘è¢«æ‰§è¡Œã€‚é‡å®šå‘æ“ä½œç¬¦å’Œå®ƒä»¬çš„æ“ä½œæ•°è¢«ä»å‚æ•°åˆ—è¡¨ä¸­ç§»é™¤ å‘½ä»¤è¢«æ‰§è¡Œ ï¼ˆå¯é€‰ï¼‰shell ç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæ¯•å¹¶æ”¶é›†å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ã€‚  She-Bang Sha-Bangï¼Œåˆå« Shebangã€Hashbangï¼Œæ˜¯ä¸€ä¸ªç”±äº•å·ï¼ˆsharpï¼‰å’Œå¹å·ï¼ˆbangï¼‰æ„æˆçš„å­—ç¬¦ä¸² #!ã€‚è‹¥æ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼ˆç©ºç™½è¡Œä¹Ÿæ˜¯æœ‰æ•ˆè¡Œï¼‰çš„å‰ä¸¤ä¸ªå­—ç¬¦æ˜¯ Sha-Bangï¼ŒLinux æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹åŠ è½½å™¨ä¼šåˆ†æ Sha-Bang åé¢çš„å†…å®¹ï¼Œå°†è¿™äº›å†…å®¹ä½œä¸ºè§£é‡Šå™¨æŒ‡ä»¤å¹¶è°ƒç”¨è¯¥æŒ‡ä»¤ï¼Œè½½æœ‰ Sha-Bang çš„æ–‡ä»¶è·¯å¾„ä¼šä½œä¸ºè¯¥è§£é‡Šå™¨çš„å‚æ•°ï¼ˆå¸¸è§çš„ $0ï¼‰ã€‚æ‰€ä»¥ Sha-Bang çš„ä½œç”¨æ˜¯å‘ŠçŸ¥ç³»ç»Ÿè¿™ä¸ªæ–‡ä»¶åŒ…å«ç€è¦äº¤ç»™å‘½ä»¤è§£é‡Šå™¨æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå³æ•´ä¸ªè„šæœ¬ï¼‰ï¼Œè€Œ Sha-Bang åé¢çš„è·¯å¾„å°±æ˜¯è¿™ä¸ªå‘½ä»¤è§£é‡Šå™¨çš„è·¯å¾„ã€‚å¾ˆå¤š shell è„šæœ¬çš„ç¬¬ä¸€è¡Œéƒ½æ˜¯ #!/bin/bash æˆ– #!/usr/bin/bashã€‚\nè¦æ‰§è¡ŒæŸä¸ªè„šæœ¬ï¼Œç”¨æˆ·ä¸ä»…éœ€è¦å…·å¤‡è¯¥è„šæœ¬çš„è¯»å–æƒé™ï¼Œè¿˜éœ€è¦å…·å¤‡è¯¥è„šæœ¬çš„æ‰§è¡Œæƒé™ï¼Œå…‰æœ‰æ‰§è¡Œæƒé™æ˜¯ä¸å¤Ÿçš„ã€‚\nè°ƒè¯• Shell è„šæœ¬ è‹¥è¦è°ƒè¯•ï¼ˆdebugï¼‰shell è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ bash çš„ -x é€‰é¡¹ ï¼ˆåœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰æ‰“å°å‘½ä»¤çš„ trace ä¿¡æ¯ï¼‰é€‰é¡¹ï¼Œä¾‹å¦‚ï¼šbash -x your_script.shã€‚\nbash -x æ˜¯ä½œç”¨åŸŸæ•´ä¸ªè„šæœ¬çš„ï¼Œå³è„šæœ¬ä¸­æ‰€æœ‰å‘½ä»¤çš„ trace ä¿¡æ¯éƒ½ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åªæƒ³å…³æ³¨è„šæœ¬ä¸­çš„æŸä¸€éƒ¨åˆ†ï¼Œè¿™ä¸ªä½¿ç”¨å¯ä»¥ä½¿ç”¨ shell å†…ç½®çš„ set å‘½ä»¤ï¼šä½¿ç”¨ set -x å¼€å¯è°ƒè¯•ï¼Œä½¿ç”¨ set +x å…³é—­è°ƒè¯•ã€‚Shell é€‰é¡¹ä¸­çš„ +/- ä¸æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨å…¶å®ƒç¨‹åºçš„ä¹ æƒ¯åˆšå¥½ç›¸åï¼Œéœ€è¦æ³¨æ„ã€‚set -x å’Œ set +x å¯ä»¥åœ¨è„šæœ¬ä¸­å‡ºç°ä»»æ„å¤šæ¬¡ã€‚\nè¿˜æœ‰ä¸€ç§å¼€å¯æ•´ä¸ªè„šæœ¬è°ƒè¯•ä¿¡æ¯çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯å°† -x é€‰é¡¹ç›´æ¥åŠ åˆ° Sha-Bang è¡Œè§£é‡Šå™¨è·¯å¾„çš„åé¢ï¼Œä¾‹å¦‚ï¼š#!/bin/bash -xã€‚\nå‚è€ƒèµ„æ–™  Bash Guide for Beginners. Advanced Bash-Scripting Guide.  ","href":"/posts/linux/shell_scripting_introduction/","title":"Shell è„šæœ¬ï¼šåˆè§"},{"content":"","href":"/tags/rust/","title":"Rust"},{"content":"","href":"/categories/rust/","title":"Rust"},{"content":"ä»»ä½•è½¯ä»¶éƒ½ä¸å¯é¿å…åœ°å‡ºç°å„ç§æˆ–å¤§æˆ–å°çš„ Bugï¼Œè½¯ä»¶è®¾è®¡çš„ä¸€å¤§ç›®æ ‡å°±æ˜¯è½¯ä»¶çš„å¥å£®æ€§ï¼Œè€Œé”™è¯¯å¤„ç†å°±æ˜¯æé«˜è½¯ä»¶å¥å£®æ€§çš„ä¸€å¤§åˆ©å™¨ã€‚ä½œä¸ºä¸€é—¨å¯¹å®‰å…¨æ¯”è¾ƒæ‰§ç€çš„ç¼–ç¨‹è¯­è¨€ï¼ŒRust ç»™æˆ‘ä»¬å¼€å‘è€…æä¾›äº†å¾ˆå¤šå¤„ç†é”™è¯¯çš„åŠŸèƒ½ç‰¹æ€§ã€‚\nRust ä¸­çš„é”™è¯¯ï¼ˆerrorï¼‰åˆ†ä¸ºä¸¤ç§ï¼šå¯æ¢å¤é”™è¯¯ï¼ˆrecoverable errorï¼‰å’Œä¸å¯æ¢å¤é”™è¯¯ï¼ˆunrecoverable errorï¼‰ã€‚åœ¨ Java ä¸­ï¼Œä¸ä»…æœ‰é”™è¯¯ï¼ˆerrorï¼‰ï¼Œè¿˜æœ‰å¼‚å¸¸ï¼ˆexceptionï¼‰ï¼Œä½† Rust ä¸­æ˜¯æ²¡æœ‰å¼‚å¸¸çš„ã€‚å¯¹äºå¯æ¢å¤é”™è¯¯ï¼ŒRust ç»™æˆ‘ä»¬æä¾›äº† Result\u0026lt;T, E\u0026gt; è¿™ç§æ•°æ®ç±»å‹ï¼Œä¾›æˆ‘ä»¬ä½œè¿›ä¸€æ­¥å†³å®šã€‚è€Œå¯¹äºä¸å¯æ¢å¤é”™è¯¯ï¼ŒRust ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå«åš panic! çš„å®ï¼Œpanic! ä¼šåœ¨ç¨‹åºé­é‡ä¸å¯æ¢å¤é”™è¯¯æ—¶ç«‹å³åœæ­¢ç¨‹åºçš„æ‰§è¡Œã€‚\nä¸å¯æ¢å¤é”™è¯¯ä¸ panic! æœ‰æ—¶å€™ï¼Œä½ ç¢°åˆ°çš„é”™è¯¯ï¼ˆæ¯”å¦‚æ•°ç»„ä¸‹æ ‡è¶Šç•Œï¼‰ä¼šè®©ä½ æŸæ‰‹æ— ç­–ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ Rust æä¾›çš„ panic! å®ç›´æ¥ç»ˆæ­¢ç¨‹åºï¼Œé˜²æ­¢æ›´åçš„äº‹æƒ…å‘ç”Ÿã€‚å½“ panic! æ‰§è¡Œæ—¶ï¼ŒRust ç¨‹åºé»˜è®¤ä¼šå…ˆæ‰“å°å‡ºå¤±è´¥ä¿¡æ¯ï¼Œè§£é€€ï¼ˆunwindingï¼‰å¹¶æ¸…ç†æ ˆï¼Œç„¶åé€€å‡ºã€‚è§£é€€æ˜¯ä¸€ç§æ¯”è¾ƒä¼˜é›…é€€å‡ºæ–¹å¼ï¼Œä¸ä¹‹ç›¸å¯¹çš„æ˜¯ç›´æ¥ç»ˆæ­¢ï¼ˆabortï¼‰ã€‚äºŒè€…çš„åŒºåˆ«åœ¨äºï¼Œè§£é€€ä¼šæ¸…ç†æ•°æ®ï¼Œå½’è¿˜å†…å­˜ï¼Œè€Œç›´æ¥ç»ˆæ­¢å°±ä¸ä¼šæ¸…ç†æ•°æ®ï¼Œå›æ”¶å†…å­˜çš„å·¥ä½œäº¤ç»™äº†æ“ä½œç³»ç»Ÿã€‚\nå…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ panic!ï¼š\nfn main() { panic!(\u0026#34;crash and burn\u0026#34;); } è¿™ä¸ªç¨‹åºä¸€è¿è¡Œï¼Œå°±ä¼šå‡ºç°é”™è¯¯ä¿¡æ¯ï¼š\n\u0026gt; cargo run Compiling error_handling v0.1.0 (F:\\Code\\Rust\\rust-study\\error_handling) Finished dev [unoptimized + debuginfo] target(s) in 3.19s Running `target\\debug\\error_handling.exe` thread \u0026#39;main\u0026#39; panicked at \u0026#39;crash and burn\u0026#39;, src\\main.rs:2:5 note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace error: process didn\u0026#39;t exit successfully: `target\\debug\\error_handling.exe` (exit code: 101) å€’æ•°ç¬¬ä¸‰è¡Œå±•ç¤ºäº† panic å‡ºç°çš„å…·ä½“ä½ç½®â€”â€”src/main.rs çš„ç¬¬äºŒè¡Œï¼Œå€’æ•°ç¬¬äºŒè¡Œåˆ™å‘Šè¯‰äº†æˆ‘ä»¬å±•ç¤ºå›æº¯ï¼ˆbacktraceï¼‰çš„æ–¹æ³•ï¼Œæœ€åä¸€è¡Œåˆ™æ˜¯ç»™å‡ºäº†è¿›ç¨‹æˆåŠŸé€€å‡ºä»¥åŠé€€å‡ºç çš„ä¿¡æ¯ã€‚\nBacktrace å¦‚æœ panic å‡ºç°åœ¨æˆ‘ä»¬å†™çš„ä»£ç è¿˜å¥½ï¼Œè¿™æ—¶å¯ä»¥ç›´æ¥çœ‹åˆ°é”™è¯¯å‘ç”Ÿåœ¨å“ªä¸€è¡Œã€‚ä½†å¦‚æœ panic å‡ºç°åœ¨ Rust çš„æ ¸å¿ƒåº“æˆ–è€…æ ‡å‡†åº“å†…éƒ¨ä¼šæ€æ ·å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ•°ç»„ä¸‹æ ‡è¶Šç•Œçš„ä¾‹å­ï¼š\nfn main() { let v = vec![1, 2, 3]; v[99]; } è¿™ä»½ä»£ç èƒ½å¤Ÿæ­£å¸¸é€šè¿‡ç¼–è¯‘ï¼Œä½†æ˜¯åœ¨è¿è¡Œçš„æ—¶å€™ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š\n\u0026gt; cargo run Compiling error_handling v0.1.0 (F:\\Code\\Rust\\rust-study\\error_handling) Finished dev [unoptimized + debuginfo] target(s) in 2.67s Running `target\\debug\\error_handling.exe` thread \u0026#39;main\u0026#39; panicked at \u0026#39;index out of bounds: the len is 3 but the index is 99\u0026#39;, src\\main.rs:3:5 note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace error: process didn\u0026#39;t exit successfully: `target\\debug\\error_handling.exe` (exit code: 101) è™½ç„¶é”™è¯¯ä¿¡æ¯å‘Šè¯‰äº†æˆ‘ä»¬é”™è¯¯å‘ç”Ÿåœ¨ç¬¬ä¸‰è¡Œï¼Œä½†æ²¡æœ‰ç»™å‡ºå…·ä½“æ˜¯å“ªä¸ªåœ°æ–¹å¯¼è‡´äº† panic çš„å‡ºç°ã€‚æ ¹æ®æç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡ RUST_BACKTRACE=1 æ¥å±•ç¤º backtraceã€‚\nBacktrace æ˜¯ä¸€ä¸ªç”±æ‰§è¡Œåˆ° panic å‘ç”Ÿä½ç½®è¿‡ç¨‹ä¸­è¢«è°ƒç”¨çš„å‡½æ•°ç»„æˆçš„åˆ—è¡¨ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å°±èƒ½ä¸€æ­¥ä¸€æ­¥åœ°èµ°åˆ° panic å‡ºç°çš„å…·ä½“ä½ç½®ã€‚æˆ‘ä»¬ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œé‡æ–°è¿è¡Œç¨‹åºï¼š\n\u0026gt; $env:RUST_BACKTRACE=1 \u0026gt; cargo run Finished dev [unoptimized + debuginfo] target(s) in 0.06s Running `target\\debug\\error_handling.exe` thread \u0026#39;main\u0026#39; panicked at \u0026#39;index out of bounds: the len is 3 but the index is 99\u0026#39;, src\\main.rs:3:5 stack backtrace: 0: std::panicking::begin_panic_handler at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633\\/library\\std\\src\\panicking.rs:515 1: core::panicking::panic_fmt at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633\\/library\\core\\src\\panicking.rs:92 2: core::panicking::panic_bounds_check at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633\\/library\\core\\src\\panicking.rs:69 3: core::slice::index::{{impl}}::index\u0026lt;i32\u0026gt; at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633\\library\\core\\src\\slice\\index.rs:184 4: core::slice::index::{{impl}}::index\u0026lt;i32,usize\u0026gt; at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633\\library\\core\\src\\slice\\index.rs:15 5: alloc::vec::{{impl}}::index\u0026lt;i32,usize,alloc::alloc::Global\u0026gt; at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633\\library\\alloc\\src\\vec\\mod.rs:2428 6: error_handling::main at .\\src\\main.rs:3 7: core::ops::function::FnOnce::call_once\u0026lt;fn(),tuple\u0026lt;\u0026gt;\u0026gt; at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633\\library\\core\\src\\ops\\function.rs:227 note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace. error: process didn\u0026#39;t exit successfully: `target\\debug\\error_handling.exe` (exit code: 101) è¿™æ¬¡è¾“å‡ºçš„ä¿¡æ¯å°±å¤šäº†ä¸å°‘ã€‚åœ¨ backtrace ä¸­ï¼Œæœ€ä¸‹é¢æ˜¯æˆ‘ä»¬å†™çš„ä»£ç ï¼Œæœ€ä¸Šé¢åˆ™æ˜¯åº“ä¸­å‘ç”Ÿ panic çš„å…·ä½“ä½ç½®ã€‚è‹¥è¦é¿å… panicï¼Œæˆ‘ä»¬å°±éœ€è¦ä¿®æ”¹è‡ªå·±çš„ä»£ç ï¼Œé˜²æ­¢ä»£ç ç¼ºé™·è¢«åº“å‡½æ•°è§¦å‘åº“å‡½æ•°å†…çš„ panicã€‚\nå¯æ¢å¤é”™è¯¯ä¸ Result\u0026lt;T, E\u0026gt; panic! ä¸€èˆ¬ç”¨äºé‚£äº›æˆ‘ä»¬æ— æ³•å¤„ç†çš„é”™è¯¯ï¼Œä½†åœ¨å®é™…çš„ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œå¤§éƒ¨åˆ†å¤±è´¥æƒ…å†µéƒ½æ˜¯æˆ‘ä»¬èƒ½å¤Ÿå¤„ç†çš„ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæ‹¿åˆ°é”™è¯¯ä¿¡æ¯ï¼Œç„¶åæ ¹æ®é”™è¯¯ä¿¡æ¯è¿›è¡Œç›¸å…³å¤„ç†ï¼Œç¡®ä¿ç¨‹åºèƒ½å¤Ÿç»§ç»­æ‰§è¡Œä¸‹å»ã€‚\nResult\u0026lt;T, E\u0026gt; è¿™ä¸ªæšä¸¾ç±»å‹å°±æ˜¯ä¸“é—¨ç”¨æ¥å¤„ç†å¯èƒ½å‡ºç°çš„å¤±è´¥çš„ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š\nenum Result\u0026lt;T, E\u0026gt; { OK(T), Err(E), } Result åŒ…å« OK å’Œ Err è¿™ä¸¤ä¸ª variantï¼Œåˆ†åˆ«è¡¨ç¤ºæˆåŠŸå’Œå¤±è´¥çš„æƒ…å†µã€‚è¿™é‡Œçš„ T å’Œ E éƒ½æ˜¯æ³›å‹å‚æ•°ï¼Œåˆ†åˆ«ç”¨æ¥è¡¨ç¤º OK ä¸­æˆåŠŸçš„è¿”å›å€¼çš„ç±»å‹å’Œ Err ä¸­å¤±è´¥çš„é”™è¯¯ç±»å‹ã€‚\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ‰“å¼€æ–‡ä»¶çš„ä¾‹å­ï¼š\nuse std::fs::File; fn main() { let f = File::open(\u0026#34;hello.txt\u0026#34;); } æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶å¯èƒ½æœ‰å¤šç§ç»“æœï¼šå¦‚æœæ–‡ä»¶å­˜åœ¨å¹¶ä¸”æ˜¯å¯è¯»çš„ï¼Œæˆ‘ä»¬å°±èƒ½ä» Result çš„ OK ä¸­å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼ˆfile handleï¼‰ï¼Œå¦åˆ™å¾—åˆ°çš„å°†ä¼šæ˜¯ Err ä¸­æºå¸¦çš„é”™è¯¯ã€‚é”™è¯¯å¯èƒ½æ˜¯æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¹Ÿå¯èƒ½æ˜¯æˆ‘ä»¬æ²¡æœ‰æ–‡ä»¶çš„è¯»å–æƒé™â€¦â€¦ã€‚å¦‚æœæ˜¯æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸»åŠ¨åˆ›å»ºæ–‡ä»¶ï¼Œç„¶åç»§ç»­æ‰§è¡Œåç»­æ­¥éª¤ã€‚è¿™å°±æ˜¯ä¸€ä¸ªå¯æ¢å¤é”™è¯¯çš„ä¾‹å­ã€‚å…ˆæ¥çœ‹æœ€ç®€å•çš„ï¼Œæ–‡ä»¶ä¸å­˜åœ¨æ—¶ç›´æ¥é€€å‡ºï¼š\nuse std::fs::File; fn main() { let f = File::open(\u0026#34;hello.txt\u0026#34;); let f = match f { Ok(file) =\u0026gt; file, Err(error) =\u0026gt; panic!(\u0026#34;Problem opening the file: {:?}\u0026#34;, error), }; } ä»¥ä¸Šä»£ç ç”¨ match å»åŒ¹é…æšä¸¾ç±» Resultï¼ŒæˆåŠŸæ—¶å¾—åˆ°æ–‡ä»¶å¥æŸ„ï¼Œå¤±è´¥æ—¶è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºç¨‹åºã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨æ–‡ä»¶ä¸å­˜åœ¨æ—¶åˆ›å»ºæ–‡ä»¶è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™ç§æƒ…å†µä¸‹ï¼Œå°±éœ€è¦å»åˆ¤æ–­é”™è¯¯çš„ç±»å‹ï¼š\nuse std::fs::File; use std::io::ErrorKind; fn main() { let f = File::open(\u0026#34;hello.txt\u0026#34;); let f = match f { Ok(file) =\u0026gt; file, Err(error) =\u0026gt; match error.kind() { ErrorKind::NotFound =\u0026gt; match File::create(\u0026#34;hello.txt\u0026#34;) { Ok(fc) =\u0026gt; fc, Err(e) =\u0026gt; panic!(\u0026#34;Problem creating the file: {:?}\u0026#34;, e), }, other_error =\u0026gt; { panic!(\u0026#34;Problem opening the file: {:?}\u0026#34;, other_error) } }, }; } ç°åœ¨ä»£ç å¼€èµ·æ¥å¼€å§‹æœ‰ç‚¹å¤æ‚äº†ã€‚å®é™…ä¸Šï¼ŒResult æœ‰ä¸€ä¸ªæ–¹æ³•å« unwrap_or_elseï¼Œå®ƒå¯ä»¥ä»£æ›¿ä¸Šé¢çš„ match è¡¨è¾¾å¼ï¼š\nuse std::fs::File; use std::io::ErrorKind; fn main() { let f = File::open(\u0026#34;hello.txt\u0026#34;).unwrap_or_else(|error| { if error.kind() == ErrorKind::NotFound { File::create(\u0026#34;hello.txt\u0026#34;).unwrap_or_else(|error| { panic!(\u0026#34;Problem creating the file: {:?}\u0026#34;, error); }) } else { panic!(\u0026#34;Problem opening the file: {:?}\u0026#34;, error); } }); } é”™è¯¯çš„ä¼ æ’­ æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½å¹¶ä¸åƒè‡ªå·±å¤„ç†é”™è¯¯ï¼Œè€Œæ˜¯å¸Œæœ›å°†é”™è¯¯çš„å¤„ç†äº¤ç»™è°ƒç”¨æˆ‘ä»¬ä»£ç çš„äººã€‚å½“æˆ‘ä»¬è¿™ä¹ˆåšæ—¶ï¼Œå°±å°†é”™è¯¯ä¼ æ’­ï¼ˆpropagatingï¼‰ç»™äº†è°ƒç”¨æ–¹ï¼Œç»™äº†è°ƒç”¨æ–¹æ›´å¤šçš„æ§åˆ¶èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œå½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œç›´æ¥è¿”å›é”™è¯¯ç»™è°ƒç”¨æ–¹ï¼š\nuse std::fs::File; use std::io; use std::io::Read; fn read_username_from_file() -\u0026gt; Result\u0026lt;String, io::Error\u0026gt; { let f = File::open(\u0026#34;hello.txt\u0026#34;); let mut f = match f { Ok(file) =\u0026gt; file, Err(e) =\u0026gt; return Err(e), }; let mut s = String::new(); match f.read_to_string(\u0026amp;mut s) { Ok(_) =\u0026gt; Ok(s), Err(e) =\u0026gt; Err(e), } } ä¸ºäº†æé«˜ä»£ç çš„å¯è¯»æ€§ï¼ŒRust è¿˜ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªä¼ æ’­é”™è¯¯çš„ç®€ä¾¿å†™æ³•â€”â€”ä½¿ç”¨ ? æ“ä½œç¬¦ã€‚ä¾‹å¦‚ï¼Œ? æ“ä½œç¬¦æ”¹å†™ä¸Šè¿°ä»£ç çš„ç»“æœå¦‚ä¸‹ï¼š\nfn read_username_from_file() -\u0026gt; Result\u0026lt;String, io::Error\u0026gt; { let f = File::open(\u0026#34;hello.txt\u0026#34;)?; let mut s = String::new(); f.read_to_string(\u0026amp;mut s)?; OK(s) } ? ç”šè‡³è¿˜æ”¯æŒé“¾å¼æ“ä½œï¼š\nfn read_username_from_file() -\u0026gt; Result\u0026lt;String, io::Error\u0026gt; { let mut s = String::new(); File::open(\u0026#34;hello.txt\u0026#34;)?.read_to_string(\u0026amp;mut s)?; OK(s) } ä½†æ˜¯ï¼Œ? çš„ä½¿ç”¨æ˜¯æœ‰é™åˆ¶çš„ã€‚å®ƒåªèƒ½ç”¨åœ¨è¿”å›ç»“æœç±»å‹æ˜¯ Resultã€Option æˆ–å®ç°äº† std::ops::Try çš„ç±»å‹çš„å‡½æ•°ä¸Šã€‚\nå‚è€ƒèµ„æ–™  Steve Klabnik, Carol Nichols. The Rust Programming Language.  ","href":"/rust/rust_basics_error_handling/","title":"Rust åŸºç¡€ï¼šé”™è¯¯å¤„ç†"},{"content":"æšä¸¾ï¼ˆenum or enumerationï¼‰ æ˜¯ä¸€ç§å…è®¸æˆ‘ä»¬åˆ—ä¸¾å‡ºæ‰€æœ‰å¯èƒ½çš„å€¼çš„æ•°æ®ç±»å‹ï¼Œæ¯ä¸€ä¸ªå¯èƒ½çš„å€¼éƒ½æ˜¯ä¸€ä¸ª variantã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¸¸è§çš„ IP åœ°å€æœ‰ IPv4 å’Œ IPv6 ä¸¤ç§ï¼Œè¿™æ—¶å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªè¡¨ç¤º IP åœ°å€ç±»å‹çš„æšä¸¾ç±»ã€‚\næšä¸¾çš„å®šä¹‰ æˆ‘ä»¬å…ˆæ¥å®šä¹‰ä¸€ä¸ªè¡¨ç¤º IP åœ°å€ç±»å‹çš„æšä¸¾ç±»ï¼š\nenum IpAddrKind { V4, V6, } ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆšå®šä¹‰çš„ IpAddrKind äº†ã€‚åœ¨ Rust ä¸­ï¼Œæšä¸¾ç±»å‹å®ä¾‹çš„é€šè¿‡ :: æ“ä½œç¬¦åˆ›å»ºçš„ï¼Œ:: çš„å·¦è¾¹æ˜¯å‘½åç©ºé—´ï¼ˆæšä¸¾ç±»å‹ï¼‰ï¼Œå³è¾¹æ˜¯æšä¸¾ç±»å‹ä¸­çš„å¯èƒ½å€¼ï¼ˆvariantï¼‰ã€‚ä¾‹å¦‚ï¼š\nlet four = IpAddrKind::V4; let six = IpAddrKind::V6; åœ¨ Rust ä¸­ï¼Œæšä¸¾ç±»å‹ä¸­æ‰€æœ‰ variant çš„ç±»å‹éƒ½æ˜¯ç›¸åŒçš„ï¼Œè¿™ä¸€ç‚¹ä¸å…¶å®ƒç¼–ç¨‹è¯­è¨€æœ‰äº›ä¸åŒã€‚ä¾‹å¦‚ IpAddrKind::V4 å’Œ IpAddrKind::V6 çš„ç±»å‹éƒ½æ˜¯ IpAddrKindã€‚ç°åœ¨çš„ IpAddrKind åªæœ‰ç±»å‹çš„å«ä¹‰ï¼Œå¹¶ä¸èƒ½å­˜å‚¨ä»»ä½• IP åœ°å€æ•°æ®ï¼Œæˆ‘ä»¬æŠŠå®ƒç¨å¾®æ”¹é€ ä¸€ä¸‹ï¼š\nenum IpAddrKind { V4(String), V6(String), } let home = IpAddrKind::V4(String::from(\u0026#34;127.0.0.1\u0026#34;)); let loopback = IpAddrKind::V6(String::from(\u0026#34;::1\u0026#34;)); ç°åœ¨ï¼ŒIpAddrKind éƒ½èƒ½å­˜å‚¨åœ°å€æ•°æ®äº†ã€‚ä¸è¿‡å®ƒè¿˜å¯ä»¥å˜å¾—æ›´åŠ é«˜çº§ï¼ŒIPv4 çš„åœ°å€å¯ä»¥ç”¨å››ä¸ª 0~255 ä¹‹é—´çš„æ•´æ•°è¡¨ç¤ºï¼š\nenum IpAddrKind { V4(u8, u8, u8, u8), V6(String), } let home = IpAddrKind::V4(127, 0, 0, 1); let loopback = IpAddrKind::V6(String::from(\u0026#34;::1\u0026#34;)); è¿™å°±æ˜¯æšä¸¾æ¯”ç»“æ„ä½“æ›´çµæ´»çš„åœ°å€ã€‚æšä¸¾ç±»å‹ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½å¯ä»¥æ˜¯ä¸åŒçš„ç±»å‹ï¼Œè€Œç»“æ„ä½“åˆ™åšä¸åˆ°è¿™ä¸€ç‚¹ã€‚è¦åŒæ—¶è¡¨ç¤ºä¸¤ç§ç±»å‹çš„ IP åœ°å€ï¼Œéœ€è¦å®šä¹‰ä¸¤ç§ä¸åŒç±»å‹çš„ç»“æ„ä½“ï¼Œè€Œåªéœ€è¦ä¸€ç§ç±»å‹çš„æšä¸¾ç±»å³å¯ï¼\næšä¸¾ä¹Ÿæ˜¯æ”¯æŒä½¿ç”¨ impl å®šä¹‰æ–¹æ³•çš„ã€‚ä¾‹å¦‚ï¼š\nimpl IpAddrKind { fn doSomething(\u0026amp;self) { println!(\u0026#34;do something\u0026#34;); } } fn main() { let home = IpAddrKind::V4(String::from(\u0026#34;127.0.0.1\u0026#34;)); let loopback = IpAddrKind::V6(String::from(\u0026#34;::1\u0026#34;)); home.doSomething(); loopback.doSomething(); } ä»¥ä¸Šä»£ç ä¸º IpAddrKind å®šä¹‰äº†ä¸€ä¸ª doSomething æ–¹æ³•ã€‚æšä¸¾ç±»å‹æ˜¯ä¸æ”¯æŒå…³è”å‡½æ•°çš„ã€‚\nOption ä¸ Null åœ¨æ”¯æŒ Null çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæ•°æ®çš„å€¼è¦ä¹ˆæ˜¯ nullï¼Œè¦ä¹ˆæ˜¯ not-nullã€‚åœ¨è¿™äº›ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»éå¸¸å°å¿ƒï¼Œå› ä¸º Null Pointer Exception ç»å¸¸å‡ºç°ã€‚ä½†åœ¨ Rust ä¸­ï¼Œæ˜¯æ²¡æœ‰ Null è¿™ä¸ªæ¦‚å¿µçš„ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ Optionã€‚Option æ˜¯ Rust æ ‡å‡†åº“å®šä¹‰çš„ä¸€ä¸ªæšä¸¾ç±»å‹ã€‚å®ƒçš„ä½œç”¨éå¸¸å¤§ï¼Œå¯ä»¥è¡¨ç¤ºæœ‰æˆ–è€…æ²¡æœ‰çš„æ¦‚å¿µã€‚\næˆ‘ä»¬å¯ä»¥æ¢ä¸ªè§’åº¦æ¥çœ‹å¾… null ä¸ not-nullï¼šnot-null è¡¨ç¤ºå€¼å­˜åœ¨ï¼Œè€Œ null è¡¨ç¤ºå€¼ç¼ºå¤±ã€‚Option æ°å¥½ç”¨Some å’Œ None è¡¨è¾¾å‡ºäº†æœ‰ä¸æ²¡æœ‰çš„æ¦‚å¿µï¼š\nenum Option\u0026lt;T\u0026gt; { None, Some\u0026lt;T\u0026gt;, } è¿™é‡Œçš„ \u0026lt;T\u0026gt; æ˜¯ Rust ä¸­çš„æ³›å‹è¯­æ³•ï¼Œå¯ä»¥è¡¨ç¤ºä»»ä½•ç±»å‹ã€‚æˆ‘ä»¬ä¸éœ€è¦å¯¼å…¥ä»»ä½•æ¨¡å—å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ Optionï¼Œå› ä¸ºå®ƒå®åœ¨æ˜¯å¤ªé‡è¦äº†ã€‚æ­¤å¤–ï¼ŒNone å’Œ Some åœ¨ä½¿ç”¨æ—¶ä¹Ÿå¯ä»¥ä¸åŠ  Option:: è¿™ä¸ªå‰ç¼€ã€‚ä¾‹å¦‚ï¼š\nfn main() { let some_number = Some(5); let some_string = Some(\u0026#34;a string\u0026#34;); let absent_number: Option\u0026lt;i32\u0026gt; = None; } æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šåœ¨ä½¿ç”¨ None çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»æ˜¾å¼åœ°ç»™å‡ºæ•°æ®çš„ç±»å‹ã€‚å› ä¸º None å¯ä»¥è¡¨ç¤ºä»»ä½•ç±»å‹ï¼ŒRust çš„ç¼–è¯‘å™¨æ˜¯æ— æ³•æ¨æ–­å‡ºå®ƒçš„å®é™…ç±»å‹çš„ã€‚\né‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆ Option\u0026lt;T\u0026gt; æ¯” null è¦å¥½å‘¢ï¼Ÿè¿™æ—¶å› ä¸º Option\u0026lt;T\u0026gt; å’Œ \u0026lt;T\u0026gt; è¡¨ç¤ºçš„æ˜¯ä¸åŒçš„ç±»å‹ï¼Œç¼–è¯‘å™¨æ˜¯ä¸ä¼šå…è®¸æˆ‘ä»¬å°† Option\u0026lt;T\u0026gt; å½“ä½œç»å¯¹æœ‰æ•ˆçš„å€¼ï¼ˆç¼–è¯‘å™¨ä¼šç¡®ä¿ \u0026lt;T\u0026gt; è¡¨ç¤ºçš„å€¼æ€»æ˜¯æœ‰æ•ˆçš„ï¼‰ä½¿ç”¨çš„ï¼Œå®ƒä¼šç¡®ä¿æˆ‘ä»¬åœ¨ä½¿ç”¨ Option\u0026lt;T\u0026gt; ä¹‹å‰å¤„ç†äº†ç©ºå€¼çš„æƒ…å†µã€‚\nä½¿ç”¨ match è¿›è¡Œæ¨¡å¼åŒ¹é… Rust æä¾›äº†ä¸€ä¸ªæå…¶å¼ºå¤§çš„æ§åˆ¶æµæ“ä½œç¬¦â€”â€”matchã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ match è¿›è¡Œæ¨¡å¼åŒ¹é…ï¼ˆpattern matchingï¼‰ï¼Œç„¶ååœ¨ä¸åŒçš„æ¨¡å¼ä¸‹æ‰§è¡Œä¸åŒçš„ä»£ç ã€‚è¿™ç§æ“ä½œæœ‰ç‚¹åƒ Java å’Œå…¶å®ƒç¼–ç¨‹è¯­è¨€ç§çš„ switch...caseã€‚ä½†æ˜¯ Rust ç§çš„æ¨¡å¼åŒ¹é…æ›´åŠ å¼ºå¤§ï¼Œæ¨¡å¼å¯ä»¥æ˜¯å­—é¢å€¼ã€å˜é‡åã€é€šé…ç¬¦ç­‰ç­‰ã€‚å¹¶ä¸”ï¼ŒRust çš„ç¼–è¯‘å™¨ä¼šç¡®ä¿æˆ‘ä»¬å¤„ç†äº†æ‰€æœ‰å¯èƒ½çš„æƒ…å†µï¼Œè¿™å°±æ˜¯åˆ©ç”¨ match è¿›è¡Œæ¨¡å¼åŒ¹é…çš„å¼ºå¤§ä¹‹å¤„ã€‚\nç°åœ¨æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\nenum IpAddrKind { V4(u8, u8, u8, u8), V6(String), } fn is_ipv4(ip: IpAddrKind) -\u0026gt; bool { match ip { IpAddrKind::V4(a, b, c, d) =\u0026gt; true, IpAddrKind::V6(s) =\u0026gt; false, } } fn main() { let home = IpAddrKind::V4(127, 0, 0, 1); let loopback = IpAddrKind::V6(String::from(\u0026#34;::1\u0026#34;)); println!(\u0026#34;home is Ipv4 address: {}\u0026#34;, is_ipv4(home)); println!(\u0026#34;loopback is Ipv4 address: {}\u0026#34;, is_ipv4(loopback)); } ä»¥ä¸Šä»£ç å®šä¹‰äº†ä¸€ä¸ªåˆ¤æ–­ IP åœ°å€æ˜¯å¦ä¸º IPv4 åœ°å€çš„å‡½æ•° is_ipv4ã€‚ç¨‹åºçš„æœ€ç»ˆè¿è¡Œç»“æœä¸ºï¼š\nhome is Ipv4 address: true loopback is Ipv4 address: false ä½ å¯èƒ½ä¼šè§‰å¾— match ä»£ç å—ç§çš„ (a, b, c, d) å’Œ (s) æœ‰äº›å¥‡æ€ªã€‚è¿™æ—¶å› ä¸ºæˆ‘ä»¬å®šä¹‰çš„ IPAddrKind::V4 åŒ…å«å››ä¸ªå­—æ®µï¼ŒIpAddrKind::V6 åŒ…å«ä¸€ä¸ªå­—æ®µï¼Œåœ¨ä½¿ç”¨æ—¶å¿…é¡»ç»™å‡ºæ‰€æœ‰å­—æ®µçš„å€¼ï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™ã€‚\næˆ‘ä»¬æ¥ä»”ç»†çœ‹ä¸€ä¸‹ match è¡¨è¾¾å¼ã€‚æ•´ä¸ªè¡¨è¾¾å¼ä»¥ match å…³é”®å­—å¼€å§‹ï¼Œç„¶åæ˜¯è¢«åŒ¹é…çš„æ•°æ®ï¼ˆipï¼‰ï¼Œå†å¾€ååˆ™æ˜¯ç”±å°–æ‹¬å· {} åŒ…è£¹çš„å…·ä½“åˆ†æ”¯ã€‚æ¯ä¸ªåˆ†æ”¯ä¹‹é—´ç”¨ , éš”å¼€ã€‚Rust ç®¡æ¯ä¸ªåˆ†æ”¯å« armï¼Œä¸€ä¸ª arm ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š\n æ¨¡å¼ï¼ˆä¾‹å¦‚ IpAddrKind::V6(s)ï¼‰ =\u0026gt; æ“ä½œç¬¦ åŒ¹é…æˆåŠŸåæ‰§è¡Œçš„ä»£ç   å†æ¥çœ‹ä¸€ä¸ªä½¿ç”¨ match åŒ¹é… Option\u0026lt;T\u0026gt; çš„ä¾‹å­ï¼š\nfn main() { fn plus_one(x: Option\u0026lt;i32\u0026gt;) -\u0026gt; Option\u0026lt;i32\u0026gt; { match x { None =\u0026gt; None, Some(i) =\u0026gt; Some(i + 1), } } let five = Some(5); let six = plus_one(five); let none = plus_one(None); } å¦‚æœçœç•¥ match ä»£ç å—ä¸­çš„ None =\u0026gt; None, ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ç¼–è¯‘å¤±è´¥ï¼Œå¹¶ä¸”ç¼–è¯‘å™¨ä¼šæç¤ºæˆ‘ä»¬æ²¡æœ‰è¦†ç›–åˆ° None çš„æƒ…å†µã€‚è¿™å†æ¬¡è¯´æ˜äº† Rust è¦æ±‚æˆ‘ä»¬åœ¨ä½¿ç”¨ match è¿›è¡Œæ¨¡å¼åŒ¹é…å¿…é¡»è¦è¦†ç›–æ‰€æœ‰çš„æƒ…å†µã€‚\næœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½å¹¶ä¸å¸Œæœ›æŠŠæ¨¡å¼æ‰€æœ‰å¯èƒ½çš„å€¼éƒ½åˆ—ä¸¾å‡ºæ¥ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨ Rust ç»™æˆ‘ä»¬æä¾›çš„å ä½ç¬¦ _ã€‚_ æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¨¡å¼ï¼Œå¯ä»¥åŒ¹é…æ‰€æœ‰çš„æƒ…å†µã€‚ä¸€èˆ¬å°†å®ƒæ”¾åˆ°æœ€åï¼Œç”¨äºè¡¨ç¤ºå½“å‰å‰©ä¸‹çš„æœªåˆ—ä¸¾å‡ºæ¥çš„æ‰€æœ‰æ¨¡å¼ã€‚ä¾‹å¦‚ï¼š\nfn plus_one(x: Option\u0026lt;i32\u0026gt;) -\u0026gt; Option\u0026lt;i32\u0026gt; { match x { Some(i) =\u0026gt; Some(i + 1), _ =\u0026gt; None, } } ä»”ç»†çœ‹ä¸Šé¢è¿™ä¸ª plus_one å‡½æ•°ï¼Œå®é™…æœ‰æ„ä¹‰çš„æ“ä½œåªå‘ç”Ÿåœ¨ x ä¸º Some(i) çš„æ—¶å€™ï¼Œ_ çš„æƒ…å†µç•¥æ˜¾å¤šä½™ã€‚å¯¹äºåªéœ€è¦åŒ¹é…ä¸€æ¨¡å¼å¹¶å¿½ç•¥å‰©ä½™æ‰€æœ‰æ¨¡å¼çš„æƒ…å†µï¼ŒRust ç»™æˆ‘ä»¬æä¾›äº† if let è¯­æ³•ã€‚ä¾‹å¦‚ï¼š\nfn main() { fn print_i32(x: Option\u0026lt;i32\u0026gt;) { if let Some(i) = x { println!(\u0026#34;x = {}\u0026#34;, i); }; } print_i32(Some(1)); print_i32(None); } ç¨‹åºçš„æœ€ç»ˆè¾“å‡ºç»“æœä¸ºï¼š\nx = 1 if let åé¢è·Ÿçš„åˆ†åˆ«æ˜¯æ¨¡å¼ï¼ˆSome(i)ï¼‰ã€= ã€è¢«åŒ¹é…çš„å€¼ï¼ˆxï¼‰å’ŒåŒ¹é…æˆåŠŸåè¿›è¡Œçš„æ“ä½œï¼ˆprintln!(\u0026quot;x = {}\u0026quot;, i);ï¼‰ã€‚\nif let ä¹Ÿå¯ä»¥æ­é… else ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š\nfn plus_one(x: Option\u0026lt;i32\u0026gt;) -\u0026gt; Option\u0026lt;i32\u0026gt; { if let Some(i) = x { Some(i + 1) } else { None } } å‚è€ƒèµ„æ–™  Steve Klabnik, Carol Nichols. The Rust Programming Language.  ","href":"/rust/rust_basics_enums_and_patterns_matching/","title":"Rust åŸºç¡€ï¼šæšä¸¾ä¸æ¨¡å¼åŒ¹é…"},{"content":"åœ¨ Rust ä¸­ï¼Œç»“æ„ä½“ï¼ˆstruct or structureï¼‰ æ˜¯ä¸€ç§å¯è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œå…è®¸æˆ‘ä»¬å°†ä¸€ç»„ç›¸å…³æ•°æ®ç»„ç»‡åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªæœ‰æ„ä¹‰çš„æ•´ä½“ã€‚Rust ä¸­çš„ç»“æ„ä½“å’Œ C è¯­è¨€ä¸­çš„ç»“æ„ä½“æˆ– Java ä¸­å¯¹è±¡çš„æ•°æ®å±æ€§ç±»ä¼¼ã€‚\nç»“æ„ä½“çš„å®šä¹‰ è™½ç„¶ Rust ä¸­çš„å…ƒç»„ï¼ˆtupleï¼‰ä¹Ÿå¯ä»¥å°†ä¸€ç»„ç›¸å…³æ•°æ®ç»„ç»‡åœ¨ä¸€èµ·ï¼Œä½†æ˜¯å…ƒç»„ä¸­çš„å„ä¸ªæ•°æ®é¡¹çš„å«ä¹‰å´ä¸é‚£ä¹ˆç›´è§‚ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨è®¿é—®å…ƒç»„ä¸­çš„å…ƒç´ æ—¶éœ€è¦ä½¿ç”¨ä¸‹æ ‡ï¼Œè€Œä¸‹æ ‡æ˜¯æ²¡æœ‰ä»»ä½•ç‰¹å®šçš„ä¸šåŠ¡å«ä¹‰çš„ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç»“æ„ä½“åˆ™æ›´è¦çµæ´»ä¸€äº›ï¼Œå®ƒå…è®¸æˆ‘ä»¬ç»™ç»“æ„ä½“ä¸­çš„æ¯ä¸ªæ•°æ®æŒ‡å®šä¸€ä¸ªåå­—ï¼ˆè¿™æœ‰ç‚¹åƒé”®å€¼å¯¹äº†ï¼‰ã€‚\nRust ä½¿ç”¨å…³é”®å­— struct å®šä¹‰ç»“æ„ä½“ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\nstruct User { username: String, email: String, sign_in_count: u64, active: bool, } ç»“æ„ä½“ User çš„å®šä¹‰ä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š\n struct å…³é”®å­— ç»“æ„ä½“çš„åå­—ï¼Œè¿™é‡Œæ˜¯ User ç»“æ„ä½“çš„å­—æ®µï¼ˆfieldï¼‰å®šä¹‰ï¼Œæ¯ä¸ªå­—æ®µå®šä¹‰ä»å·¦åˆ°å³åˆ†åˆ«æ˜¯å­—æ®µçš„åå­—ï¼ˆæ¯”å¦‚ usernameï¼‰ã€å†’å·ï¼ˆ:ï¼‰å’Œå­—æ®µç±»å‹ï¼ˆæ¯”å¦‚ Stringï¼‰ï¼Œä¸åŒå­—æ®µå®šä¹‰ä¹‹é—´ç”¨é€—å·ï¼ˆ,ï¼‰éš”å¼€ã€‚æœ€åä¸€ä¸ªé€—å·æ˜¯å¯é€‰çš„  éœ€è¦æ³¨æ„çš„æ˜¯ï¼šç»“æ„ä½“çš„å®šä¹‰æœ«å°¾ä¸èƒ½åŠ åˆ†å·ï¼ˆ;ï¼‰ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ›å‡ºç±»ä¼¼äºä¸‹é¢è¿™æ ·çš„é”™è¯¯ï¼š\nerror: expected item, found `;` --\u0026gt; src\\main.rs:6:2 6 | }; | ^ help: remove this semicolon | = help: braced struct declarations are not followed by a semicolon ç»“æ„ä½“å­—æ®µçš„è®¿é—®ä¸æ›´æ–° ç»“æ„ä½“å®šä¹‰å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨å®ƒã€‚ä¸ºäº†ä½¿ç”¨ User ç»“æ„ä½“ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª User çš„å®ä¾‹ï¼ˆinstanceï¼‰ï¼š\nfn main() { let user1 = User { email: String::from(\u0026#34;someone@example.com\u0026#34;), username: String::from(\u0026#34;someone\u0026#34;), active: true, sign_in_count: 1 }; println!(\u0026#34;{}\u0026#34;, user1.username); } åˆ›å»ºç»“æ„ä½“å®ä¾‹æ—¶ï¼Œå­—æ®µçš„é¡ºåºå¿…é¡»ä¸¥æ ¼æŒ‰ç…§å®šä¹‰ç»“æ„ä½“æ—¶çš„é¡ºåºã€‚ä½†æ‰€æœ‰å­—æ®µéƒ½å¿…é¡»ç»™å‡ºï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ä»¥ä¸Šç¤ºä¾‹è¿˜å±•ç¤ºäº†è¯»å–ç»“æ„ä½“å®ä¾‹å­—æ®µå€¼çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯ä½¿ç”¨ç‚¹ç¬¦å·ï¼ˆ.ï¼‰ã€‚\né‚£ä¹ˆå¦‚ä½•ä¿®æ”¹æŸä¸ªå­—æ®µçš„å€¼å‘¢ï¼Ÿç­”æ¡ˆè¿˜æ˜¯ä½¿ç”¨ç‚¹ç¬¦å·ï¼ˆ.ï¼‰ï¼Œå¹¶ä¸”è¿˜è¦å°†æ•´ä¸ªå®ä¾‹å£°æ˜ä¸ºå¯å˜çš„ï¼ˆRust å¹¶ä¸å…è®¸æˆ‘ä»¬å°†éƒ¨åˆ†å­—æ®µæ ‡è®°ä¸ºå¯å˜çš„ï¼‰ï¼Œä¾‹å¦‚ï¼š\nfn main() { let mut user1 = User { email: String::from(\u0026#34;someone@example.com\u0026#34;), username: String::from(\u0026#34;someone\u0026#34;), active: true, sign_in_count: 1 }; user1.username = String::from(\u0026#34;anotherone\u0026#34;); println!(\u0026#34;{}\u0026#34;, user1.username); } è¿™é‡Œæˆ‘è¿˜å‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„äº‹æƒ…ï¼šString å’Œ \u0026amp;str æ˜¯ä¸åŒçš„ç±»å‹ï¼Œè™½ç„¶ \u0026amp;str å¯ä»¥æ›¿ä»£ Stringï¼Œä½†å®ƒä»¬å´æ˜¯æœ‰ç€å¾ˆå¤§çš„ä¸åŒï¼å¦‚æœå°† user.username = String::from(\u0026quot;anotherone\u0026quot;); æ›¿æ¢æˆ user1.username = \u0026quot;anotherone\u0026quot;;ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ›å‡ºç±»å‹ä¸åŒ¹é…çš„é”™è¯¯ï¼š\nerror[E0308]: mismatched types --\u0026gt; src\\main.rs:18:22 | 18 | user1.username = \u0026#34;anotherone\u0026#34;; | | | expected struct `String`, found `\u0026amp;str` | help: try using a conversion method: `\u0026#34;anotherone\u0026#34;.to_string()` å˜é‡ä¸å­—æ®µåŒåæ—¶å­—æ®µåˆå§‹åŒ–çš„ç®€å†™æ–¹æ³• é™¤äº†åœ¨ main å‡½æ•°ä¸­åˆå§‹åŒ–ç»“æ„ä½“å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å•ç‹¬å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥è¿”å›ä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹ï¼š\nfn build_user(email: String, username: String) -\u0026gt; User { User { email: email, username: username, sign_in_count: 1, active: true } } æœ‰æ²¡æœ‰è§‰å¾—è¿™é‡Œçš„ email å’Œ username çš„åˆå§‹åŒ–ç•¥æ˜¾é‡å¤ï¼Ÿæ¯•ç«Ÿå‡½æ•°çš„å‚æ•°åä¹Ÿæ˜¯ email å’Œ usernameã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ å­—æ®µåˆå§‹åŒ–ç®€å†™è¯­æ³•ï¼ˆfield init shorthand syntaxï¼‰ æ¥ç®€åŒ–ä»£ç ï¼š\nfn build_user(email: String, username: String) -\u0026gt; User { User { email, username, sign_in_count: 1, active: true } } å³ï¼šå½“å‡½æ•°çš„å‚ä¸åä¸ç»“æ„ä½“çš„å­—æ®µåç›¸åŒæ—¶ï¼Œå¯ä»¥çœç•¥å­—æ®µçš„å€¼ï¼Œä½†å¿…é¡»ä¿ç•™å­—æ®µåã€‚\nä½¿ç”¨ç»“æ„ä½“æ›´æ–°è¯­æ³•ä»å…¶å®ƒå®ä¾‹åˆ›å»ºå®ä¾‹ æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šåŸºäºç°æœ‰çš„å®ä¾‹å»åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œç„¶åä»…æ”¹åŠ¨æ–°å®ä¾‹ä¸­çš„å°‘éƒ¨åˆ†å­—æ®µçš„å€¼ï¼Œæ–°å®ä¾‹ä¸­ç»å¤§éƒ¨åˆ†å­—æ®µå€¼è¿˜æ˜¯å’Œæ—§å®ä¾‹ä¸€è‡´ã€‚ç»“æ„ä½“æ›´æ–°è¯­æ³•ï¼ˆstruct update syntaxï¼‰ å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´åŠ ä¼˜é›…åœ°å®ç°è¿™ä¸ªç›®æ ‡ã€‚\né¦–å…ˆçœ‹ä¸ä½¿ç”¨ç»“æ„ä½“æ›´æ–°è¯­æ³•çš„å†™æ³•ï¼š\nlet user2 = User { email: String::from(\u0026#34;another@example.com\u0026#34;), username: String::from(\u0026#34;another\u0026#34;), active: user1.active, sign_in_count: user1.sign_in_count, }; å†æ¥çœ‹ä½¿ç”¨ç»“æ„ä½“æ›´æ–°è¯­æ³•çš„å†™æ³•ï¼š\nlet user2 = User { email: String::from(\u0026#34;another@example.com\u0026#34;), username: String::from(\u0026#34;another\u0026#34;), ..user1 }; ç»“æ„ä½“æ›´æ–°è¯­æ³• .. çš„ä½œç”¨æ˜¯è®©å‰©ä¸‹é‚£äº›æ²¡æœ‰æ˜¾å¼ç»™å‡ºçš„å­—æ®µçš„å€¼ä¸ .. åé¢ç»™å‡ºçš„å®ä¾‹ä¸€è‡´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ ..user1 åé¢æ˜¯ä¸èƒ½è·Ÿ , çš„ï¼ŒåŸå› æ˜¯ error: cannot use a comma after the base structã€‚\nå…ƒç»„ç»“æ„ä½“ Rust è¿˜æ”¯æŒæ²¡æœ‰å­—æ®µåçš„ç»“æ„ä½“ï¼Œè¿™ç§ç»“æ„ä½“å’Œå…ƒç»„ç±»ä¼¼ï¼Œè¢«ç§°ä¸º å…ƒç»„ç»“æ„ä½“ï¼ˆtuple strucï¼‰ã€‚å…ƒç»„ç»“æ„ä½“çš„å®šä¹‰ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š\n struct å…³é”®å­— ç»“æ„ä½“åå­— å­—æ®µç±»å‹ç»„æˆçš„å…ƒç»„  ä¾‹å¦‚ï¼š\nfn main() { struct Color(i32, i32, i32); struct Point(i32, i32, i32); let black = Color(0, 0, 0); let origin = Point(0, 0, 0); } ä»¥ä¸Šä»£ç å®šä¹‰äº†ä¸¤ä¸ªç»“æ„ä½“ Color å’Œ Pointã€‚è™½ç„¶äºŒè€…å…ƒç»„ä¸­çš„ç±»å‹ä¸€æ ·ï¼Œä½†å®ƒä»¬å´æ˜¯ä¸¤ä¸ªä¸åŒçš„ç»“æ„ä½“ï¼Œä¸å¯æ··ç”¨ï¼å…ƒç»„ç»“æ„ä½“çš„ä½¿ç”¨å’Œå…ƒç»„ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥è§£æ„å®ƒï¼Œä¹Ÿå¯ä»¥æ˜¯ä½¿ç”¨ . åŠ ä¸‹æ ‡å»è®¿é—®ç‰¹å®šçš„å…ƒç´ ã€‚\nRust è¿˜æ”¯æŒæ²¡æœ‰ä»»ä½•å­—æ®µçš„ç»“æ„ä½“ï¼Œè¿™ç§ç»“æ„ä½“è¢«ç§°ä¸º ç±»å•å…ƒç»“æ„ä½“ï¼ˆUnit-Like Structï¼‰ï¼Œå®ƒå°±åƒç©ºå…ƒç»„ () ä¸€æ ·ã€‚\nå•å…ƒç»“æ„ä½“ å•å…ƒç»“æ„ä½“ï¼ˆunit structï¼‰ä¸åŒ…å«ä»»ä½•å­—æ®µï¼Œä¾‹å¦‚ï¼šstruct Unit;\nç»“æ„ä½“ä¸æ‰€æœ‰æƒ ç»“æ„ä½“æ‹¥æœ‰æ‰€æœ‰å­—æ®µå€¼çš„æ‰€æœ‰æƒï¼Œå¹¶ä¸”ç»“æ„ä½“å†…æ‰€æœ‰æ•°æ®çš„æœ‰æ•ˆæœŸä¸ç»“æ„ä½“æœ¬èº«ä¸€è‡´ã€‚åªè¦ç»“æ„ä½“æœ‰æ•ˆï¼Œç»“æ„ä½“å†…çš„æ•°æ®å°±æœ‰æ•ˆã€‚è¿˜è®°å¾—ä¸Šæ–‡ä¸­æåˆ°çš„å­—æ®µä¸åŒ¹é…çš„é”™è¯¯å—ï¼Ÿé‚£ä¸ªé—®é¢˜å…¶å®ä¹Ÿå’Œæ‰€æœ‰æƒæœ‰å…³ç³»ï¼Œå› ä¸º \u0026amp;str æ˜¯å¼•ç”¨ï¼Œå®ƒä¸å…·å¤‡æ•°æ®çš„æ‰€æœ‰æƒã€‚\næ–¹æ³• æ–¹æ³•ï¼ˆmethodï¼‰ å’Œå‡½æ•°ï¼ˆfunctionï¼‰ç±»ä¼¼ï¼ŒäºŒè€…é™¤äº†å®šä¹‰çš„ä½ç½®å’Œå‚æ•°åˆ—è¡¨ä¸åŒå¤–ï¼Œå…¶å®ƒå®Œå…¨ç›¸åŒã€‚æ–¹æ³•åœ¨ç»“æ„ä½“ï¼ˆæˆ–æšä¸¾ï¼ˆenumï¼‰å’Œ trait å¯¹è±¡ï¼‰çš„ä¸Šä¸‹æ–‡ä¸­å®šä¹‰ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå‚æ•°å§‹ç»ˆæ˜¯ selfï¼ˆå…¶å®ƒå‚æ•°éƒ½åœ¨ self åé¢ï¼‰ã€‚self è¡¨ç¤ºçš„æ˜¯å½“å‰çš„ç»“æ„ä½“å®ä¾‹ï¼Œè¢«è°ƒç”¨çš„æ–¹æ³•å°±åœ¨å®ƒèº«ä¸Šã€‚\næ–¹æ³•çš„å®šä¹‰ å‰é¢æåˆ°è¿‡ï¼Œæ–¹æ³•çš„å®šä¹‰å‡ºç°åœ¨ä¸€ä¸ªæŸä¸ªä¸Šä¸‹æ–‡ä¸­ã€‚æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\nstruct Rectangle { width: u32, height: u32, } impl Rectangle { fn area(\u0026amp;self) -\u0026gt; u32 { self.width * self.height } } fn main() { let rect1 = Rectangle { width: 30, height: 50, }; println!( \u0026#34;The area of the rectangle is {} square pixels.\u0026#34;, rect1.area() ); } ä»¥ä¸Šä»£ç åœ¨ Rectangle ä¸Šä¸‹æ–‡ä¸­å®šä¹‰äº†ä¸€ä¸ªæ±‚é¢ç§¯çš„æ–¹æ³• areaã€‚è¿™é‡Œç”¨åˆ°äº† impl å…³é”®å­—ï¼Œå…¶åæ˜¯ä¸Šä¸‹æ–‡ Rectangleï¼Œå†å¾€ååˆ™æ˜¯æ–¹æ³•çš„å®šä¹‰ã€‚\nè™½ç„¶ area æ–¹æ³•çš„å®šä¹‰ä¸­åŒ…å«å‚æ•° \u0026amp;selfï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è°ƒç”¨å®ƒçš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰æ˜¾å¼åœ°ä¼ å…¥ä»»ä½•å‚æ•°ï¼Œè€Œæ˜¯ç®€å•åœ°ä½¿ç”¨äº† rect1.area()ï¼Œè¿™æ˜¯å› ä¸º \u0026amp;self åœ¨è¿™é‡ŒæŒ‡ä»£çš„æ˜¯ rect1ã€‚ä»”ç»†ä¸€çœ‹ï¼Œä¼¼ä¹ \u0026amp;self çš„ç±»å‹ä¸ rect1 çš„ç±»å‹å¹¶ä¸åŒ¹é…ï¼Œä½†ä¸ºä½•æ²¡æœ‰å‡ºç°é”™è¯¯å‘¢ï¼Ÿè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ Rust ä¸­çš„ è‡ªåŠ¨å¼•ç”¨å’Œè§£å¼•ç”¨ï¼ˆautomatic referencing and deferencingï¼‰ åŠŸèƒ½ã€‚\næ–¹æ³•è°ƒç”¨æ—¶å‘ç”Ÿè‡ªåŠ¨å¼•ç”¨ä¸è§£å¼•ç”¨çš„å°‘æ•°å‡ ä¸ªåœ°æ–¹ä¹‹ä¸€ã€‚è¿™ä¸ªåŠŸèƒ½çš„å¤§è‡´å·¥ä½œè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šå½“æˆ‘ä»¬ä½¿ç”¨ object.something() è°ƒç”¨æ–¹æ³•æ—¶ï¼ŒRust ä¼šè‡ªåŠ¨æ·»åŠ  \u0026amp;ã€\u0026amp;mut æˆ– *ï¼Œä½¿å¾— object ä¸æ–¹æ³•ç­¾ååŒ¹é…ã€‚æˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢ä»£ç ä¸­çš„ self.width * self.height æ›¿æ¢æˆ \u0026amp;self.width * \u0026amp;self.heightï¼Œæˆ–å°† rect1.area() æ›¿æ¢æˆ \u0026amp;rect1.area()ï¼Œç¨‹åºä¾ç„¶èƒ½æ­£ç¡®è¿è¡Œã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥å°†ï¼š\nimpl Rectangle { fn area(\u0026amp;self) -\u0026gt; u32 { self.width * self.height } } æ›¿æ¢ä¸ºï¼š\nimpl Rectangle { fn area(self) -\u0026gt; u32 { \u0026amp;self.width * \u0026amp;self.height } } å…³è”å‡½æ•° é™¤äº†å®šä¹‰æ–¹æ³•å¤–ï¼Œimpl è¿˜å…è®¸æˆ‘ä»¬å®šä¹‰ä¸å¸¦ self å‚æ•°çš„å‡½æ•°ã€‚è¿™ç§å‡½æ•°è¢«ç§°ä¸º å…³è”å‡½æ•°ï¼ˆassociated functionï¼‰ï¼Œå› ä¸ºå®ƒä»¬ä¸ç»“æ„ä½“æœ¬èº«ç›¸å…³è”ã€‚å…³è”å‡½æ•°ä¸æ˜¯æ–¹æ³•ï¼Œå› ä¸ºå®ƒä¸æ¶‰åŠä»»ä½•ç»“æ„ä½“å®ä¾‹ã€‚æˆ‘ä»¬ä»å­—ç¬¦ä¸²å­—é¢é‡åˆ›å»º String çš„ from å‡½æ•°å°±æ˜¯ä¸€ä¸ªå…³è”å‡½æ•°ã€‚åœ¨è°ƒç”¨å…³è”å‡½æ•°æ—¶ï¼Œéœ€è¦ä½¿ç”¨æ“ä½œç¬¦ ::ï¼Œä¾‹å¦‚ï¼šlet s = String::from(\u0026quot;hello\u0026quot;);ã€‚\nå‚è€ƒèµ„æ–™  Steve Klabnik, Carol Nichols. The Rust Programming Language.  ","href":"/rust/rust_basics_struct/","title":"Rust åŸºç¡€ï¼šç»“æ„ä½“"},{"content":"æ‰€æœ‰æƒï¼ˆownershipï¼‰ æ˜¯ Rust ç‹¬ä¸€æ— äºŒçš„åŠŸèƒ½ï¼Œä¹Ÿæ˜¯ Rust ä¸­çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚Rust ä¸éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å›æ”¶å†…å­˜ï¼Œä¹Ÿæ²¡æœ‰åƒåœ¾æ”¶é›†å™¨ï¼Œä½†å®ƒè¿˜èƒ½ä¿è¯å†…å­˜å®‰å…¨ï¼Œè¿™å°±æ˜¯æ‰€æœ‰æƒçš„å¼ºå¤§ä¹‹å¤„ã€‚\nåœ¨ Rust ä¸­ï¼Œå†…å­˜çš„ç®¡ç†æ˜¯é€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿï¼ˆownership systemï¼‰è¿›è¡Œçš„ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶æ ¹æ®ä¸€ç³»åˆ—çš„è§„åˆ™è¿›è¡Œæ£€æŸ¥ã€‚æ›´åŠ ä»¤äººèµå¹çš„æ˜¯ï¼Œæ‰€æœ‰æƒç³»ç»Ÿä¸­çš„ä»»ä½•åŠŸèƒ½éƒ½ä¸ä¼šå‡æ…¢ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ï¼\næ ˆä¸å † åœ¨å¼€å§‹å­¦ä¹ æ‰€æœ‰æƒè¿™ä¸ªæ¦‚å¿µä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å…ˆå›é¡¾ä¸€ä¸‹æ•°æ®åœ¨å†…å­˜ä¸­çš„å­˜æ”¾å½¢å¼ã€‚åœ¨ Rust ä¸­ï¼Œæ•°æ®è¢«å­˜æ”¾åœ¨æ ˆï¼ˆstackï¼‰æˆ–å †ï¼ˆheapï¼‰ä¸­ã€‚\næ ˆä¸å †ç»„ç»‡æ•°æ®çš„æ–¹å¼ä¸åŒã€‚åœ¨æ ˆä¸­ï¼Œæ•°æ®æ—¶å…ˆå…¥åå‡ºï¼ˆFILOï¼‰çš„ï¼Œå³æœ€åå­˜å…¥çš„æ•°æ®æœ€å…ˆè¢«ä½¿ç”¨ã€‚è€Œåœ¨å †ä¸­ï¼Œæ•°æ®çš„ä½¿ç”¨å°±æ²¡æœ‰é¡ºåºè¦æ±‚ï¼Œæ•°æ®åœ¨å †ä¸­çš„ç»„ç»‡æƒ…å†µæ¯”æ ˆä¸­è¦å·®å¾ˆå¤šã€‚æ­¤å¤–ï¼Œå­˜æ”¾åœ¨æ ˆä¸­çš„æ•°æ®å ç”¨çš„ç©ºé—´å¿…é¡»æ˜¯ ç¼–è¯‘æœŸé—´å·²çŸ¥ä¸”å›ºå®šçš„ï¼Œå¯¹äºé‚£äº›å¤§å°ä¸å›ºå®šæˆ–ç¼–è¯‘æ—¶æ— æ³•çŸ¥é“å¤§å°çš„æ•°æ®ï¼Œåº”å½“è¢«å­˜æ”¾åœ¨å †ä¸Šã€‚åœ¨æˆ‘ä»¬å¾€å †ä¸­å­˜æ•°æ®æ—¶ï¼Œå†…å­˜åˆ†é…å™¨ä¼šä»å †ä¸­æ‰¾å‡ºä¸€å—å¤§å°åˆé€‚çš„å†…å­˜ç©ºé—´ï¼Œæ ‡è®°å…¶å·²ä½¿ç”¨ï¼Œç„¶åè¿”å›ç»™æˆ‘ä»¬ä¸€ä¸ªæŒ‡å‘åˆ†é…åœ°å€çš„æŒ‡é’ˆï¼Œåç»­æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆè®¿é—®å †ä¸­çš„æ•°æ®ã€‚è¿™ä¸ªæŒ‡é’ˆä¼šè¢«å­˜å‚¨åœ¨æ ˆä¸Šï¼Œå› ä¸ºå®ƒçš„å¤§å°æ˜¯å›ºå®šä¸”å·²çŸ¥çš„ã€‚\nå°†æ•°æ®å­˜å‚¨åœ¨æ ˆä¸Šçš„é€Ÿåº¦è¦å¿«äºå­˜å‚¨åœ¨å †ä¸Šçš„é€Ÿåº¦ã€‚å› ä¸ºå½“æ•°æ®è¢«æ”¾åœ¨æ ˆä¸Šæ—¶ï¼Œå†…å­˜åˆ†é…å™¨ä¸éœ€è¦ä¸ºæ–°æ•°æ®æ‰¾å‡ºä¸€å—ç©ºé—²ç©ºé—´ï¼Œæ•°æ®æ€»æ˜¯è¢«æ”¾åœ¨æ ˆé¡¶ã€‚å¦‚æœæ•°æ®è¦è¢«æ”¾åˆ°å †ä¸Šï¼Œå†…å­˜åˆ†é…å™¨ä¸ä»…éœ€è¦ä»å †ä¸­æ‰¾å‡ºä¸€å—åˆé€‚çš„ç©ºé—²ç©ºé—´ï¼Œè¿˜éœ€è¦é˜²æ­¢è¿™å—ç©ºé—´è¢«å…¶å®ƒæ•°æ®æŠ¢å ã€‚ç±»ä¼¼åœ°ï¼Œè®¿é—®æ ˆä¸Šæ•°æ®çš„é€Ÿåº¦è¦å¿«äºè®¿é—®å †ä¸Šæ•°æ®çš„é€Ÿåº¦ã€‚å› ä¸ºå †ä¸Šçš„æ•°æ®éœ€è¦é€šè¿‡æ ˆä¸Šçš„æŒ‡é’ˆæ‰èƒ½å®šä½åˆ°ï¼Œè¿™æ¯”æ ˆä¸Šçš„æ•°æ®å¤šäº†ä¸€æ¬¡å†…å­˜è®¿é—®ã€‚\nå½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼ é€’ç»™å‡½æ•°çš„å€¼ï¼ˆæˆ–æŒ‡å‘å †ä¸­æ•°æ®çš„æŒ‡é’ˆï¼‰å’Œå‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡éƒ½æ˜¯å­˜æ”¾åœ¨æ ˆä¸Šçš„ã€‚å½“å‡½æ•°è°ƒç”¨ç»“æŸåï¼Œè¿™äº›å€¼éƒ½ä¼šä»æ ˆä¸­å¼¹å‡ºã€‚\nè®²äº†è¿™ä¹ˆå¤šï¼Œç°åœ¨è¯¥æ‰€æœ‰æƒå‡ºåœºäº†ã€‚æ‰€æœ‰æƒè´Ÿè´£ è·Ÿè¸ªå“ªéƒ¨åˆ†ä»£ç æ­£åœ¨ä½¿ç”¨å †ä¸­çš„å“ªéƒ¨åˆ†æ•°æ®ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘å †ä¸­çš„é‡å¤æ•°æ®ï¼Œæ¸…ç†å †ä¸­æœªä½¿ç”¨çš„æ•°æ®ï¼Œé˜²æ­¢å†…å­˜ç©ºé—´è¢«è€—å°½ã€‚ç®€å•æ¥è¯´ï¼Œæ‰€æœ‰æƒç®¡ç†ç€å †ä¸­çš„æ•°æ®ã€‚\né‚£ä¹ˆï¼ŒRust ä¸­çš„å“ªäº›æ•°æ®ä¼šè¢«åˆ†é…åœ¨å †ä¸Šå‘¢ï¼Ÿç­”æ¡ˆæ˜¯é‚£äº›å¤§å°åœ¨ç¼–è¯‘æœŸé—´ä¸å¯çŸ¥æˆ–è€…å¤§å°ä¸å›ºå®šçš„æ•°æ®ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ç±»å‹ï¼ˆStringï¼‰ã€‚æ ‡é‡ç±»å‹ï¼ˆæ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”ç±»å‹å’Œå­—ç¬¦ç±»å‹ï¼‰æˆ–å¤åˆç±»å‹ï¼ˆå…ƒç»„å’Œæ•°ç»„ï¼‰çš„æ•°æ®éƒ½æ˜¯å­˜æ”¾åœ¨æ ˆä¸Šçš„ï¼Œä½œç”¨åŸŸç»“æŸæ—¶å°±ä¼šè¢«ä»æ ˆä¸Šå¼¹å‡ºã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼šå­—ç¬¦ä¸²ç±»å‹ï¼ˆStringï¼‰å’Œå­—ç¬¦ä¸²å­—é¢é‡ï¼ˆstring literalï¼‰æ˜¯ä¸åŒçš„ã€‚å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆæ¯”å¦‚ let s = \u0026quot;hello, world\u0026quot;;ï¼‰æ˜¯ä»£ç ä¸­ç¡¬ç¼–ç çš„ï¼ˆç¼–è¯‘æ—¶å¤§å°å·²çŸ¥ï¼‰ã€ä¸å¯å˜çš„ï¼Œè€Œå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®è¢«å­˜å‚¨åœ¨å †ä¸Šï¼Œå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®æ˜¯å¯å˜çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ String çš„ from å‡½æ•°ä»å­—ç¬¦ä¸²å­—é¢é‡åˆ›å»ºä¸€ä¸ª String ç±»å‹çš„å˜é‡ï¼Œæ¯”å¦‚ï¼š\nfn main() { let mut s = String::from(\u0026#34;hello\u0026#34;); s.push_str(\u0026#34;, world!\u0026#34;); // push_str() appends a literal to a String  println!(\u0026#34;{}\u0026#34;, s); // This will print `hello, world!` } æ‰€æœ‰æƒè§„åˆ™ æ‰€æœ‰æƒçš„è§„åˆ™å¦‚ä¸‹ï¼Œå®ƒä»¬ä¸å¯è¢«è¿åï¼š\n Rust ä¸­çš„æ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡å°±æ˜¯è¿™ä¸ªå€¼çš„ æ‰€æœ‰è€…ï¼ˆownerï¼‰ æ¯ä¸ªå€¼åœ¨åŒä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€… å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰è¶…å‡ºä½œç”¨åŸŸï¼ˆscopeï¼‰ï¼Œå€¼å°±ä¼šè¢«ä¸¢å¼ƒï¼ˆdropï¼‰ï¼Œå€¼å æ®çš„å†…å­˜è¢«å½’è¿˜  å˜é‡åœ¨è¿›å…¥ä½œç”¨åŸŸåå¼€å§‹ç”Ÿæ•ˆï¼Œæ­¤åï¼Œå˜é‡åœ¨è¶…å‡ºä½œç”¨åŸŸä¹‹å‰ä¸€ç›´éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼š\nfn main() { { // s is not valid here, itâ€™s not yet declared  let s = \u0026#34;hello\u0026#34;; // s is valid from this point forward  // do stuff with s  } // this scope is now over, and s is no longer valid } å®é™…ä¸Šï¼Œå½“å˜é‡è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼ŒRust ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå« drop çš„ç‰¹æ®Šå‡½æ•°è¿›è¡Œå†…å­˜çš„å½’è¿˜ã€‚åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œdrop ä¼šåœ¨ç¬¬ä¸€ä¸ª } å¤„è¢«è°ƒç”¨ã€‚\nå˜é‡ä¸æ•°æ®çš„äº¤äº’æ–¹å¼ åœ¨ Rust ä¸­ï¼Œå¤šä¸ªå˜é‡å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼ä¸åŒä¸€ä»½æ•°æ®è¿›è¡Œäº¤äº’ï¼Œæœ€å¸¸è§çš„äº¤äº’æ–¹å¼æœ‰ç§»åŠ¨ï¼ˆmoveï¼‰å’Œå…‹éš†ï¼ˆcloneï¼‰ã€‚\nç§»åŠ¨ï¼ˆMoveï¼‰ å…ˆæ¥çœ‹ä¸€æ®µç®€å•çš„ä»£ç ï¼š\nfn main() { let x = 5; let y = x; println!(\u0026#34;x = {}, y = {}.\u0026#34;, x, y); } è¿™æ®µä»£ç å¾ˆç®€å•ï¼Œä¹Ÿèƒ½é€šè¿‡ç¼–è¯‘ï¼Œæœ€ç»ˆè¿è¡Œä¼šæ‰“å°å‡ºç»“æœ x = 5, y = 5.ã€‚å¦‚æœå°† let x = 5; ä¿®æ”¹ä¸º let x = \u0026quot;5\u0026quot;;ï¼Œä»ç„¶èƒ½å¾—åˆ°ä¸€æ ·çš„è¿è¡Œç»“æœã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘å°† let x = 5; ä¿®æ”¹æˆ let x = String::from(\u0026quot;5\u0026quot;);ï¼Œç¼–è¯‘éƒ½è¿‡ä¸å»äº†ğŸ˜‚ã€‚æˆ‘å¹¶æ²¡æœ‰æ”¹åŠ¨ä»£ç çš„ç»“æ„ï¼Œå”¯ä¸€æ”¹å˜çš„åªæœ‰å˜é‡ x çš„ç±»å‹ï¼Œè¿™é‡Œé¢åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼ŸğŸ¤”\nè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ Rust ä¸­ String åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å½¢å¼ã€‚ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨å®˜æ–¹çš„å›¾ï¼Œè®©æˆ‘å°†ä»£ç ä¿®æ”¹ä¸ºå®˜æ–¹çš„ä»£ç ğŸ˜ï¼š\nfn main() { let s1 = String::from(\u0026#34;hello\u0026#34;); let s2 = s1; println!(\u0026#34;s1 = {}, s2 = {}\u0026#34;, s1, s2); } åœ¨ Rust ä¸­ï¼ŒString ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šæŒ‡å‘å­—ç¬¦ä¸²å®é™…å†…å®¹çš„æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡ã€‚å®ƒä»¬å­˜æ”¾åœ¨æ ˆä¸Šï¼Œå¯¹åº”ä¸‹å›¾ä¸­çš„å·¦ä¾§éƒ¨åˆ†ï¼Œå­—ç¬¦ä¸²çš„å®é™…å†…å®¹åˆ™å­˜æ”¾åœ¨å †ä¸Šï¼Œå¯¹åº”ä¸‹å›¾ä¸­çš„å³ä¾§éƒ¨åˆ†ï¼š\nå½“å˜é‡ s1 è¢«èµ‹å€¼ç»™ s2 åï¼Œå­—ç¬¦ä¸² s1 åœ¨æ ˆä¸Šçš„æ•°æ®è¢«å¤åˆ¶äº†ä¸€ä»½ç»™ s2 ç”¨ï¼Œè€Œå †ä¸Šçš„å†…å®¹æ²¡æœ‰è¢«å¤åˆ¶ï¼š\nè¿™ä¸ªè¿‡ç¨‹ä¼¼æ›¾ç›¸è¯†ï¼Œå®ƒå°±åƒ Java ä¸­çš„æµ…æ‹·è´ï¼ˆshallow copyï¼‰ä¸€æ ·ã€‚åœ¨ï¼ŒRust ä¸­ï¼Œå®é™…çš„è¿‡ç¨‹ä¸å®Œå…¨æ˜¯è¿™æ ·ï¼Œå› ä¸ºå½“ s1 å’Œ s2 éƒ½è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œæ˜¾ç„¶ä¸åº”è¯¥å½’è¿˜ä¸¤æ¬¡å†…å­˜ã€‚Rust ä¸ºäº†ä¿è¯å†…å­˜å®‰å…¨ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå¤åˆ¶æ“ä½œï¼Œè€Œæ˜¯åœ¨åœ¨æ‰§è¡Œ let s2 = s1; ä¹‹åä½¿ s1 å¤±æ•ˆã€‚è¿™æ ·ï¼Œå½“ s1 è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼ŒRust å°±ä¸éœ€è¦å› ä¸ºå®ƒé‡Šæ”¾ä»»ä½•å†…å­˜äº†ã€‚è®© s1 å¤±æ•ˆçš„æ“ä½œåœ¨ Rust ä¸­è¢«ç§°ä¸º ç§»åŠ¨ï¼ˆmoveï¼‰ï¼Œlet s2 = s1; çš„å®é™…ä½œç”¨æ˜¯è®© s1 ç§»åŠ¨åˆ° s2ã€‚æ‰€ä»¥ï¼Œæ­£ç¡®çš„å›¾æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š\nè¿™å°±æ˜¯ä¸Šé¢ä»£ç ç¼–è¯‘å¤±è´¥çš„åŸå› ï¼Œè¿™ä¸‹åº”è¯¥èƒ½çœ‹æ‡‚ç¼–è¯‘å™¨ç»™å‡ºçš„ä¿¡æ¯äº†ï¼š\n\u0026gt; cargo run Compiling ownership v0.1.0 (F:\\Code\\Rust\\rust-study\\ownership) warning: unused variable: `s2` --\u0026gt; src\\main.rs:3:9 | 3 | let s2 = s1; | ^^ help: if this is intentional, prefix it with an underscore: `_s2` | = note: `#[warn(unused_variables)]` on by default error[E0382]: borrow of moved value: `s1` --\u0026gt; src\\main.rs:4:28 | 2 | let s1 = String::from(\u0026#34;hello\u0026#34;); | -- move occurs because `s1` has type `String`, which does not implement the `Copy` trait | -- value moved here 4 | println!(\u0026#34;{}, world!\u0026#34;, s1); | ^^ value borrowed here after move error: aborting due to previous error; 1 warning emitted For more information about this error, try `rustc --explain E0382`. error: could not compile `ownership` To learn more, run the command again with --verbose. F:\\Code\\Rust\\rust-study\\ownership [master +4 ~0 -0 !]\u0026gt; cargo run Compiling ownership v0.1.0 (F:\\Code\\Rust\\rust-study\\ownership) error[E0382]: borrow of moved value: `s1` --\u0026gt; src\\main.rs:4:34 | 2 | let s1 = String::from(\u0026#34;hello\u0026#34;); | -- move occurs because `s1` has type `String`, which does not implement the `Copy` trait 3 | let s2 = s1; | -- value moved here 4 | println!(\u0026#34;s1 = {}, s2 = {}\u0026#34;, s1, s2); | ^^ value borrowed here after move error: aborting due to previous error For more information about this error, try `rustc --explain E0382`. error: could not compile `ownership` To learn more, run the command again with --verbose. å…‹éš†ï¼ˆCloneï¼‰ Rust ä¸ä¼šè‡ªåŠ¨è¿›è¡Œæ•°æ®çš„æ·±æ‹·è´ï¼ˆdeep copyï¼‰ï¼Œå› ä¸ºæ·±æ‹·è´ä¼šå¯¹ç¨‹åºçš„æ€§èƒ½é€ æˆå¾ˆå¤§çš„å½±å“ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ› Rust è¿›è¡Œæ•°æ®çš„æ·±æ‹·è´ï¼Œéœ€è¦ä½¿ç”¨ clone æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š\nfn main() { let s1 = String::from(\u0026#34;hello\u0026#34;); let s2 = s1.clone(); println!(\u0026#34;s1 = {}, s2 = {}\u0026#34;, s1, s2); } è¿™æ ·ä¸€æ¥ï¼Œs1 å’Œ s2 æ¶‰åŠçš„æ•°æ®å°±æ˜¯ä¸‹å›¾ä¸­å±•ç¤ºçš„è¿™æ ·äº†ï¼š\næ ˆä¸Šæ•°æ®çš„å¤åˆ¶ï¼ˆCopyï¼‰ ç°åœ¨æ¥æ€è€ƒä¸ºå•¥ let x = 5; æˆ– let x = \u0026quot;5\u0026quot;;æ—¶ä»£ç èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚è¿™æ˜¯å› ä¸º 5 å’Œ \u0026quot;5\u0026quot; çš„å¤§å°éƒ½æ˜¯å›ºå®šçš„ï¼Œç¨‹åºç¼–è¯‘æ—¶å°±å¯ä»¥çŸ¥é“å®ƒä»¬çš„å¤§å°ï¼Œæ‰€ä»¥æ•°æ®è¢«åˆ†é…åœ¨äº†æ ˆä¸Šã€‚è€Œ Rust å¯¹æ ˆä¸Šæ•°æ®çš„å¤åˆ¶é‡‡å–çš„æ˜¯æ·±æ‹·è´ï¼Œæ·±æ‹·è´å°±ä¸å­˜åœ¨ç§»åŠ¨äº†ã€‚\nè¿˜è®°å¾—ç¼–è¯‘é”™è¯¯â€œmove occurs because s1 has type String, which does not implement the Copy traitâ€å—ï¼ŸRust ä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ³¨è§£å«åš Copyã€‚å¦‚æœæŸç§æ•°æ®ç±»å‹å®ç°äº† Copyï¼Œæ—§å˜é‡åœ¨èµ‹å€¼ä¹‹åä»ç„¶æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚æ­¤å¤–ï¼ŒRust ä¸­è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ³¨è§£å«åš Dropï¼Œå®ƒä¼šåœ¨å˜é‡è¶…å‡ºä½œç”¨åŸŸååšäº›äº‹æƒ…ã€‚Rust ä¸å…è®¸æˆ‘ä»¬å°† Copy æ”¾åœ¨äº†å®ç°äº†Drop çš„ç±»å‹ä¸Šï¼Œå¦‚æœæˆ‘ä»¬è¿™ä¹ˆåšï¼Œç¼–è¯‘ä¼šå¤±è´¥ã€‚\né‚£ä¹ˆï¼Œå“ªäº›ç±»å‹å®ç°äº† Copy å‘¢ï¼Ÿè¯´å®è¯ï¼Œæœ‰ç‚¹å¤šï¼Œå…·ä½“çš„å†…å®¹å¯ä»¥æŸ¥çœ‹ Trait Copyã€‚ä½ ä¼šå‘ç°ï¼Œæ‰€æœ‰çš„æ ‡é‡ç±»å‹éƒ½å®ç°äº† Copyã€‚\næ‰€æœ‰æƒä¸å‡½æ•° ä¼ é€’å˜é‡ç»™å‡½æ•°æ—¶æ‰€æœ‰æƒçš„å˜åŒ–ä¸å˜é‡èµ‹å€¼ä¸€æ ·ã€‚æ ¹æ®æ•°æ®ç±»å‹çš„ä¸åŒï¼Œå¯èƒ½å‘ç”Ÿç§»åŠ¨ï¼ˆä¸¢å¤±æ‰€æœ‰æƒï¼‰æˆ–å¤åˆ¶ï¼Œä¸‹é¢ä¾‹å­ä¸­çš„æ³¨é‡Šè§£é‡Šå¾—éå¸¸æ¸…æ¥šï¼š\nfn main() { let s = String::from(\u0026#34;hello\u0026#34;); // s comes into scope  takes_ownership(s); // s\u0026#39;s value moves into the function...  // ... and so is no longer valid here  let x = 5; // x comes into scope  makes_copy(x); // x would move into the function,  // but i32 is Copy, so it\u0026#39;s okay to still  // use x afterward  } // Here, x goes out of scope, then s. But because s\u0026#39;s value was moved, nothing  // special happens.  fn takes_ownership(some_string: String) { // some_string comes into scope  println!(\u0026#34;{}\u0026#34;, some_string); } // Here, some_string goes out of scope and `drop` is called. The backing  // memory is freed.  fn makes_copy(some_integer: i32) { // some_integer comes into scope  println!(\u0026#34;{}\u0026#34;, some_integer); } // Here, some_integer goes out of scope. Nothing special happens. å¦‚æœå‡½æ•°å¸¦è¿”å›å€¼å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™æ‰€æœ‰æƒä¹Ÿä¼šå‘ç”Ÿè½¬ç§»ï¼š\nfn main() { let s1 = gives_ownership(); // gives_ownership moves its return value into s1  let s2 = String::from(\u0026#34;hello\u0026#34;); // s2 comes into scope  let s3 = takes_and_gives_back(s2); // s2 is moved into takes_and_gives_back, which also  // moves its return value into s3 } // Here, s3 goes out of scope and is dropped. s2 goes out of scope but was  // moved, so nothing happens. s1 goes out of scope and is dropped.  fn gives_ownership() -\u0026gt; String { // gives_ownership will move its  // return value into the function that calls it  let some_string = String::from(\u0026#34;hello\u0026#34;); // some_string comes into scope  some_string // some_string is returned and moves out to the calling function } // takes_and_gives_back will take a String and return one fn takes_and_gives_back(a_string: String) -\u0026gt; String { // a_string comes into scope  a_string // a_string is returned and moves out to the calling function } å¼•ç”¨ å¦‚æœæ¯æ¬¡éƒ½è¿›è¡Œ takes_and_gives_back è¿™ç§å¤ºå–æ‰€æœ‰æƒè€Œååˆå½’è¿˜æ‰€æœ‰æƒçš„æ“ä½œï¼Œæœªå…ä¹Ÿå¤ªè¿‡ç¹çã€‚å¹¸è¿çš„æ˜¯ï¼ŒRust ä¸ºæˆ‘ä»¬æä¾›äº† å¼•ç”¨ï¼ˆreferenceï¼‰ï¼Œå®ƒå¯ä»¥æ¶ˆé™¤ takes_and_gives_bakc çš„å°´å°¬ä¹‹å¤„ã€‚\nä¸‹é¢æ˜¯ä½¿ç”¨å¼•ç”¨çš„ä¸€ä¸ªä¾‹å­ï¼š\nfn main() { let s1 = String::from(\u0026#34;hello\u0026#34;); let len = calculate_length(\u0026amp;s1); println!(\u0026#34;The length of \u0026#39;{}\u0026#39; is {}.\u0026#34;, s1, len); } fn calculate_length(s: \u0026amp;String) -\u0026gt; usize { // s is a reference to a String  s.len() } // Here, s goes out of scope. But because it does not have ownership of what it refers to, nothing happens. å¼•ç”¨å…è®¸æˆ‘ä»¬å¼•ç”¨æŸä¸ªå˜é‡ï¼Œè€Œä¸ä¼šå¤ºå–å˜é‡å¯¹æ•°æ®çš„æ‰€æœ‰æƒã€‚å¼•ç”¨ç›¸å…³çš„æ“ä½œç¬¦æ˜¯ \u0026amp;ï¼Œä¸ä¹‹ç›¸åçš„æ“ä½œå«è§£å¼•ç”¨ï¼ˆdereferencingï¼‰ï¼Œæ“ä½œç¬¦æ˜¯ *ã€‚åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œ\u0026amp;s1 åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ s1 çš„å¼•ç”¨ï¼Œs1 ä¾ç„¶æŒæœ‰å­—ç¬¦ä¸² \u0026quot;hello\u0026quot; çš„æ‰€æœ‰æƒã€‚\nç”±äº \u0026amp;s1 ä¸å…·æœ‰æ•°æ®çš„æ‰€æœ‰æƒï¼Œæ‰€ä»¥å½“ \u0026amp;s1 è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œæ•°æ®ä¸ä¼šè¢«ä¸¢å¼ƒã€‚Rust å°†å¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•°çš„æ“ä½œç§°ä¸º å€Ÿç”¨ï¼ˆborrowingï¼‰ï¼Œè¿™æœ‰ç‚¹åƒç°å®ç”Ÿæ´»ä¸­åˆ«äººå€Ÿäº†æˆ‘ä»¬çš„ä¸œè¥¿åˆå½’è¿˜ä¸€æ ·ï¼Œæ‰€æœ‰æƒä¸ä¼šè½¬ç§»ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼ŒRust æ˜¯ä¸å…è®¸æˆ‘ä»¬ä¿®æ”¹å€Ÿç”¨çš„æ•°æ®çš„ï¼š\nfn main() { let s = String::from(\u0026#34;hello\u0026#34;); change(\u0026amp;s); } fn change(some_string: \u0026amp;String) { some_string.push_str(\u0026#34;, world\u0026#34;); } ä»¥ä¸Šä»£ç ä¼šç¼–è¯‘å¤±è´¥ï¼Œå¹¶ä¸”ç¼–è¯‘å™¨ä¼šå‘Šè¯‰æˆ‘ä»¬é”™è¯¯åŸå› ï¼Œå¹¶ç»™å‡ºæ­£ç¡®çš„ä¿®æ”¹å»ºè®®ï¼š\n\u0026gt; cargo run Compiling ownership v0.1.0 (F:\\Code\\Rust\\rust-study\\ownership) error[E0596]: cannot borrow `*some_string` as mutable, as it is behind a `\u0026amp;` reference --\u0026gt; src\\main.rs:7:5 | 6 | fn change(some_string: \u0026amp;String) { | ------- help: consider changing this to be a mutable reference: `\u0026amp;mut String` 7 | some_string.push_str(\u0026#34;, world\u0026#34;); | ^^^^^^^^^^^ `some_string` is a `\u0026amp;` reference, so the data it refers to cannot be borrowed as mutable error: aborting due to previous error For more information about this error, try `rustc --explain E0596`. error: could not compile `ownership` To learn more, run the command again with --verbose. å¯å˜å¼•ç”¨ åœ¨ä¸Šé¢çš„é”™è¯¯ä¸­ï¼Œç¼–è¯‘å™¨å»ºè®®æˆ‘ä»¬å°† change å‡½æ•°çš„å‚æ•°ç”± \u0026amp;String ä¿®æ”¹ä¸º \u0026amp;mut Stringï¼Œå³ä»ä¸å¯å˜å¼•ç”¨ï¼ˆimmutable referenceï¼‰ä¿®æ”¹ä¸ºå¯å˜å¼•ç”¨ï¼ˆmutable referenceï¼‰ã€‚è¿™æ“ä½œå’Œæ™®é€šå˜é‡çš„å¯å˜ä¸ä¸å¯å˜ç±»ä¼¼ã€‚æ­£ç¡®çš„ä»£ç åº”è¯¥æ˜¯ï¼š\nfn main() { let mut s = String::from(\u0026#34;hello\u0026#34;); change(\u0026amp;mut s); } fn change(some_string: \u0026amp;mut String) { some_string.push_str(\u0026#34;, world\u0026#34;); } è¿™é‡Œè¿›è¡Œäº†ä¸‰å¤„ä¿®æ”¹ï¼šé¦–å…ˆå°† s æ”¹ä¸ºå¯å˜çš„ mut sï¼Œç„¶åæ˜¯ä¼ é€’ç»™ change çš„å‚æ•°ä¿®æ”¹ä¸º \u0026amp;mut sï¼Œæœ€åæ˜¯ change å‡½æ•°çš„å®šä¹‰ä¿®æ”¹ä¸º \u0026amp;mut Stringï¼Œä¸‰è€…ç¼ºä¸€ä¸å¯ã€‚\nä½†æ˜¯ï¼Œå¯å˜å¼•ç”¨æœ‰ä¸€ä¸ªéå¸¸å¤§çš„é™åˆ¶ï¼šåŒä¸€æ—¶åˆ»ï¼ŒåŒä¸€æ•°æ®çš„å¯å˜å¼•ç”¨åªèƒ½æœ‰ä¸€ä¸ªï¼Œè€Œä¸å¯å˜å¼•ç”¨å´å¯ä»¥æœ‰å¤šä¸ªã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ä¼šç¼–è¯‘å¤±è´¥ï¼š\nfn main() { let mut s = String::from(\u0026#34;hello\u0026#34;); let r1 = \u0026amp;mut s; let r2 = \u0026amp;mut s; println!(\u0026#34;{}, {}\u0026#34;, r1, r2); } ç¼–è¯‘å™¨ç®€å•æ˜äº†åœ°æŒ‡å‡ºäº†æˆ‘çš„é”™è¯¯ï¼š\n\u0026gt; cargo run Compiling ownership v0.1.0 (F:\\Code\\Rust\\rust-study\\ownership) error[E0499]: cannot borrow `s` as mutable more than once at a time --\u0026gt; src\\main.rs:4:14 | 3 | let r1 = \u0026amp;mut s; | ------ first mutable borrow occurs here 4 | let r2 = \u0026amp;mut s; | ^^^^^^ second mutable borrow occurs here 5 | println!(\u0026#34;{}, {}\u0026#34;, r1, r2); | -- first borrow later used here error: aborting due to previous error For more information about this error, try `rustc --explain E0499`. error: could not compile `ownership` To learn more, run the command again with --verbose. Rust è¿™ä¹ˆåšçš„åŸå› æ˜¯ä¸ºäº†é˜²æ­¢ç¼–è¯‘æœŸé—´çš„æ•°æ®ç«äº‰ï¼ˆå’Œ Java å¹¶å‘ä¸­çš„æ•°æ®ç«äº‰ç±»ä¼¼ï¼‰ã€‚æ•°æ®ç«äº‰ä¼šå¯¼è‡´ç¨‹åºçš„è¡Œä¸ºè¶…å‡ºé¢„æœŸï¼ŒåŠ å¤§è¿è¡Œæ—¶è¯Šæ–­é—®é¢˜çš„éš¾åº¦ã€‚\né‚£ä¹ˆåº”è¯¥å¦‚ä½•ä¿®æ”¹ä¸Šé¢æœ‰é—®é¢˜çš„ä»£ç å‘¢ï¼Ÿæ‹†åˆ†ä¸¤ä¸ªå˜é‡çš„ä½œç”¨åŸŸå³å¯ï¼š\nfn main() { let mut s = String::from(\u0026#34;hello\u0026#34;); { let r1 = \u0026amp;mut s; } let r2 = \u0026amp;mut s; println!(\u0026#34;{}, {}\u0026#34;, r1, r2); } åœ¨ Rust ä¸­ï¼Œå¼•ç”¨çš„ä½œç”¨åŸŸä»å£°æ˜å¼€å§‹ï¼Œç»“æŸäºå¼•ç”¨æœ€åä¸€æ¬¡è¢«ä½¿ç”¨ã€‚Rust ä¸å…è®¸åŒä¸€ä»½æ•°æ®åœ¨ä¸€ä¸ªä½œç”¨åŸŸå†…åŒæ—¶å‡ºç°å¯å˜å¼•ç”¨å’Œä¸å¯å˜å¼•ç”¨çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼š\nfn main() { let mut s = String::from(\u0026#34;hello\u0026#34;); let r1 = \u0026amp;s; // no problem  let r2 = \u0026amp;s; // no problem  let r3 = \u0026amp;mut s; // BIG PROBLEM  println!(\u0026#34;{}, {}, and {}\u0026#34;, r1, r2, r3); } ä¼šå‡ºç°ä»¥ä¸‹ç¼–è¯‘é”™è¯¯ï¼š\n\u0026gt; cargo run Compiling ownership v0.1.0 (F:\\Code\\Rust\\rust-study\\ownership) error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable --\u0026gt; src\\main.rs:5:14 | 3 | let r1 = \u0026amp;s; // no problem | -- immutable borrow occurs here 4 | let r2 = \u0026amp;s; // no problem 5 | let r3 = \u0026amp;mut s; // BIG PROBLEM | ^^^^^^ mutable borrow occurs here 6 | println!(\u0026#34;{}, {}, and {}\u0026#34;, r1, r2, r3); | -- immutable borrow later used here error: aborting due to previous error For more information about this error, try `rustc --explain E0502`. error: could not compile `ownership` To learn more, run the command again with --verbose. ä½†å¦‚æœæˆ‘å°†ä»£ç ä¿®æ”¹ä¸ºï¼š\nfn main() { let mut s = String::from(\u0026#34;hello\u0026#34;); let r1 = \u0026amp;s; // no problem  let r2 = \u0026amp;s; // no problem  println!(\u0026#34;{} and {}\u0026#34;, r1, r2); // variables r1 and r2 will not be used after this point  let r3 = \u0026amp;mut s; // no problem  println!(\u0026#34;{}\u0026#34;, r3); } ç¨‹åºå°±èƒ½é€šè¿‡ç¼–è¯‘å¹¶æ­£å¸¸è¿è¡Œã€‚è¿™æ˜¯å› ä¸ºï¼Œr3 è¢«å£°æ˜ä¹‹å‰ï¼Œr1 å’Œ r2 çš„ä½œç”¨åŸŸå·²ç»ç»“æŸäº†ï¼Œä¸å­˜åœ¨ä½œç”¨åŸŸçš„é‡å ã€‚\nåˆ‡ç‰‡ï¼ˆSliceï¼‰ åˆ‡ç‰‡ï¼ˆsliceï¼‰å…è®¸æˆ‘ä»¬å¼•ç”¨é›†åˆä¸­çš„ä¸€æ®µè¿ç»­å…ƒç´ ï¼Œå®ƒæ˜¯ä¸€ç§æ²¡æœ‰æ‰€æœ‰æƒçš„æ•°æ®ç±»å‹ã€‚\nå­—ç¬¦ä¸²åˆ‡ç‰‡ å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼ˆstring sliceï¼‰æ˜¯ä¸€ä¸ªæŒ‡å‘ String ä¸­çš„ä¸€éƒ¨åˆ†å†…å®¹çš„å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹æ˜¯åŸå­—ç¬¦ä¸²çš„ä¸€ä¸ªå­ä¸²ã€‚ä¾‹å¦‚ï¼š\nfn main() { let s = String::from(\u0026#34;hello world\u0026#34;); let hello = \u0026amp;s[0..5]; // hello  let world = \u0026amp;s[6..11]; // world  println!(\u0026#34;{}, {}\u0026#34;, hello, world); // hello, world } åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œhello å’Œ world éƒ½åªå¼•ç”¨äº† s ä¸­çš„ä¸€éƒ¨åˆ†ï¼š\nå­—ç¬¦ä¸²åˆ‡ç‰‡ç±»å‹åœ¨ Rust ä¸­ç”¨ \u0026amp;str è¡¨ç¤ºï¼Œå®ƒæ¯” String æ›´åŠ çµæ´»ã€‚å› ä¸º \u0026amp;str ä¸ä»…å¯ä»¥å¼•ç”¨ String çš„ä¸€éƒ¨åˆ†ï¼Œè¿˜èƒ½å¼•ç”¨ String çš„æ‰€æœ‰å†…å®¹ã€‚åˆ©ç”¨ \u0026amp;strï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™è·å–å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªå•è¯çš„å‡½æ•°ï¼š\nfn first_word(s: \u0026amp;String) -\u0026gt; \u0026amp;str { let bytes = s.as_bytes(); for (i, \u0026amp;item) in bytes.iter().enumerate() { if item == b\u0026#39; \u0026#39; { return \u0026amp;s[0..i]; } } \u0026amp;s[..] } ç°åœ¨å¯ä»¥æ¥å›ç­”ä¸ºå•¥å­—ç¬¦ä¸²å­—é¢é‡æ˜¯ä¸å¯å˜çš„è¿™ä¸ªé—®é¢˜äº†ã€‚å› ä¸ºå­—ç¬¦ä¸²å­—é¢é‡çš„æ•°æ®ç±»å‹æ˜¯ \u0026amp;strï¼Œè€Œ \u0026amp;str æ˜¯ä¸å¯å˜å¼•ç”¨ã€‚\nå…¶å®ƒç±»å‹çš„åˆ‡ç‰‡ é™¤äº†å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼ˆ\u0026amp;strï¼‰ï¼ŒRust ä¸­è¿˜æœ‰å¾ˆå¤šå…¶å®ƒç±»å‹çš„åˆ‡ç‰‡ï¼Œæ¯”å¦‚æ•°ç»„çš„åˆ‡ç‰‡ï¼š\n#![allow(unused)] fn main() { let a = [1, 2, 3, 4, 5]; let slice = \u0026amp;a[1..3]; assert_eq!(slice, \u0026amp;[2, 3]); } åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œslice æ˜¯æ•°ç»„ a çš„åˆ‡ç‰‡ï¼Œå®ƒçš„æ•°æ®ç±»å‹æ˜¯ \u0026amp;[int32]ã€‚\nå‚è€ƒèµ„æ–™  Steve Klabnik, Carol Nichols. The Rust Programming Language.  ","href":"/rust/rust_basics_ownership/","title":"Rust åŸºç¡€ï¼šæ‰€æœ‰æƒ"},{"content":"","href":"/tags/communication/","title":"Communication"},{"content":"","href":"/categories/communication/","title":"Communication"},{"content":"æœ€è¿‘å·¥ä½œä¸­éœ€è¦ç”¨åˆ° gPRCï¼Œèµ¶ç´§å­¦äº†ä¸€ä¸‹ï¼Œé¡ºä¾¿åšäº†äº›ç¬”è®°ã€‚\ngPRC ä¸ Protocol Buffers ç»å¸¸ä¸€èµ·ä½¿ç”¨ï¼ŒäºŒè€…çš„å…³ç³»éå¸¸å¯†åˆ‡ã€‚å› ä¸º gPRC ä¸ä»…å°† Protocol Buffers ä½œä¸ºè‡ªå·±çš„ IDLï¼ˆInterface Definition Languageï¼‰ï¼Œè¿˜å°†å…¶ç”¨ä½œåº•å±‚çš„æ¶ˆæ¯äº¤æ¢æ ¼å¼ã€‚\ngRPC  A hight performance, open source universal RPC framework.\n gPRC æ˜¯ä¸€ä¸ªç”± Google å‡ºå“çš„ RPCï¼ˆRemote Procedure Callï¼‰ æ¡†æ¶ã€‚åœ¨ç¬”è€…å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼ŒgPRC è¿˜æ˜¯äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼ˆCNCFï¼‰ çš„ä¸€ä¸ªå­µåŒ–é¡¹ç›®ã€‚\ngRPC çš„æ ¸å¿ƒæ€æƒ³å’Œå…¶å®ƒçš„ RPC æ¡†æ¶ä¸€æ ·ï¼Œéƒ½æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡ï¼Œç„¶åå£°æ˜å¯ä»¥è¢«è¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ä»¥åŠæ–¹æ³•çš„å‚æ•°å’Œè¿”å›ç±»å‹ã€‚æœåŠ¡ç«¯å®ç°å®šä¹‰çš„æ¥å£å¹¶å¤„ç†å®¢æˆ·ç«¯çš„è°ƒç”¨ï¼Œè€Œå®¢æˆ·ç«¯åˆ™æœ‰ä¸€ä¸ªæ¡©å¯¹è±¡ï¼ˆstubï¼‰ï¼Œå®ƒæä¾›äº†ä¸æœåŠ¡ç«¯ç›¸åŒçš„æ–¹æ³•ã€‚\ngRPC è°ƒç”¨è¿‡ç¨‹ gRPC çš„ä½¿ç”¨è€…é€šå¸¸ä¼šåœ¨æœåŠ¡ç«¯å®ç° .proto æ–‡ä»¶ä¸­æè¿°çš„æœåŠ¡ APIï¼Œç„¶ååœ¨å®¢æˆ·ç«¯è¿›è¡Œ API çš„è°ƒç”¨ã€‚æ¯ä¸€ä¸ª API éƒ½æ¶‰åŠæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤æ–¹é¢ï¼ŒæœåŠ¡ç«¯è´Ÿè´£å®ç°ï¼Œè€Œå®¢æˆ·ç«¯è¿›è¡Œè°ƒç”¨ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚\næœåŠ¡ç«¯ä¸ä»…ä¼šå®ç° .proto æ‰€æè¿°çš„æœåŠ¡ä¸­å£°æ˜çš„æ–¹æ³•ï¼Œè¿˜ä¼šè¿è¡Œä¸€ä¸ªå¤„ç†å®¢æˆ·ç«¯è°ƒç”¨çš„æœåŠ¡å™¨ã€‚gRPC ä¼šè§£ç ä¼ å…¥è¯·æ±‚ï¼Œæ‰§è¡ŒæœåŠ¡æ–¹æ³•ï¼Œå¹¶ç¼–ç æœåŠ¡å“åº”ã€‚è€Œåœ¨å®¢æˆ·ç«¯è¿™ä¸€ä¾§ï¼Œä¼šæœ‰ä¸€ä¸ªå®ç°äº†ç›¸åŒæœåŠ¡æ–¹æ³•æœ¬åœ°å¯¹è±¡ï¼ˆä¸€èˆ¬å« stubï¼Œæœ‰äº›è¯­è¨€ä¹Ÿç§° clientï¼‰ã€‚å®¢æˆ·ç«¯ä¼šç›´æ¥è°ƒç”¨è¿™ä¸ªæœ¬åœ°å¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼Œä½¿ç”¨æ°å½“çš„ Protocol Buffers æ¶ˆæ¯ç±»å‹åŒ…è£¹æ–¹æ³•å‚æ•°ã€‚gRPC ä¼šå°†è¯·æ±‚å‘é€ç»™æœåŠ¡ç«¯ï¼Œå¹¶è·å–æœåŠ¡ç«¯çš„å“åº”æ•°æ®ã€‚\nä¸‹é¢è¿™å¼ å›¾æ¥è‡ª gRPC å®˜ç½‘ï¼Œå®ƒä¸ä»…å±•ç¤ºå‡ºäº† gRPC ä¸­å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯äº¤äº’çš„è¿‡ç¨‹ï¼Œè¿˜æš—ç¤ºäº† gRPC æ˜¯è·¨è¯­è¨€çš„ï¼š\nå½“ä¸‹åˆ†å¸ƒå¼ç³»ç»Ÿå’Œå¾®æœåŠ¡æ¶æ„éå¸¸æµè¡Œï¼ŒRPC çš„è¿™ä¸€å¤§ç‰¹ç‚¹ä½¿å¾—æˆ‘ä»¬åˆ›å»ºåˆ†å¸ƒå¼åº”ç”¨å’ŒæœåŠ¡æ›´åŠ ç®€å•ã€‚\nå®šä¹‰æœåŠ¡ é»˜è®¤æƒ…å†µä¸‹ï¼ŒgRPC ä½¿ç”¨ Protocol Buffers æè¿°æœåŠ¡æ¥å£å’Œæ¶ˆæ¯è´Ÿè½½ï¼ˆmessage payloadï¼‰çš„ç»“æ„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‰ç…§å®é™…éœ€è¦ï¼Œé€‰æ‹©å…¶å®ƒçš„è¯­è¨€æ¥æè¿°æ¥å£å’Œæ¶ˆæ¯çš„ç»“æ„ã€‚\nservice HelloService { rpc SayHello (HelloRequest) returns (HelloResponse);}message HelloRequest { string greeting = 1;}message HelloResponse { string reply = 1;}ä»¥ä¸Šä»£ç ä½¿ç”¨ Protocol Buffers æè¿°äº† HelloRequest å’Œ HelloResponse è¿™ä¸¤ä¸ªæ¶ˆæ¯çš„ç»“æ„ï¼Œä»¥åŠæœåŠ¡æ¥å£ HelloServiceã€‚åœ¨æœåŠ¡æ¥å£ HelloService ä¸­ï¼Œæœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•å« SayHelloï¼Œå®ƒä»å®¢æˆ·ç«¯æ¥æ”¶ HelloRequest å¹¶ä»¥ HelloResponse å“åº”ã€‚SayHello ä½œä¸ºä¸€ä¸ªå…¥é—¨çš„ä¾‹å­ï¼Œç»™æˆ‘ä»¬å±•ç¤ºçš„æ˜¯ gRPC ä¸­æœ€ç®€å•çš„é€šä¿¡æ¨¡å¼â€”â€”Unary RPCã€‚\nå®é™…ä¸Šï¼ŒgRPC ä¸­æœ‰å››ç§é€šä¿¡æ¨¡å¼ï¼š\n Unary RPCï¼šå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å•ä¸ªè¯·æ±‚ï¼Œå¹¶ä»æœåŠ¡ç«¯è·å–å•ä¸ªå“åº”ã€‚ç”¨ Protocol Buffers æè¿°æœåŠ¡æ¥å£çš„æ–¹æ³•ï¼Œå°±æ˜¯ï¼šrpc SayHello (HelloRequest) returns (HelloResponse)ã€‚ Server Streaming RPCï¼šå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶ä»æœåŠ¡ç«¯è·å¾—ä¸€ä¸ªå“åº”æµã€‚å®¢æˆ·ç«¯ä¼šä»è¿™ä¸ªå“åº”æµä¸­è¯»å–ä¸€ä¸ªæ¶ˆæ¯åºåˆ—ï¼ŒgRPC ä¼šä¿è¯æ¯ä¸ª RPC è°ƒç”¨ä¸­æ¶ˆæ¯çš„é¡ºåºã€‚ç”¨ Protocol Buffers æè¿°æœåŠ¡æ¥å£çš„æ–¹æ³•ï¼Œå°±æ˜¯ï¼šrpc SayHello (HelloRequest) returns (stream HelloResponse) Client Streaming RPCï¼šå®¢æˆ·ç«¯å‘æµä¸­å†™å…¥ä¸€ä¸ªæ¶ˆæ¯åºåˆ—ï¼Œç„¶åæŠŠå®ƒå‘ç»™æœåŠ¡ç«¯ï¼Œç­‰å¾…æœåŠ¡ç«¯è¿”å›å•ä¸ªå“åº”ã€‚gRPC ä¾ç„¶ä¼šä¿è¯å®¢æˆ·ç«¯æµä¸­æ¶ˆæ¯çš„é¡ºåºã€‚ç”¨ Protocol Buffers æè¿°æœåŠ¡æ¥å£çš„æ–¹æ³•ï¼Œå°±æ˜¯ï¼šrpc SayHello (stream HelloRequest) returns (HelloResponse) Bidirectional Streaming RPCï¼šå®¢æˆ·ç«¯ä»¥æ¶ˆæ¯æµçš„æ–¹å¼ç»™æœåŠ¡ç«¯å‘é€æ•°æ®ï¼Œè€ŒæœåŠ¡ç«¯ä¹Ÿä»¥æ¶ˆæ¯æµçš„æ–¹å¼å“åº”æ•°æ®ã€‚gRPC ä¼šä¿è¯æ¯ä¸ªæµå½“ä¸­æ¶ˆæ¯çš„é¡ºåºã€‚ç”¨ Protocol Buffers æè¿°æœåŠ¡æ¥å£çš„æ–¹æ³•ï¼Œå°±æ˜¯ï¼šrpc SayHello (stream HelloRequest) returns (stream HelloResponse)  ä¸éš¾å‘ç°ï¼Œæµå¼é€šä¿¡ä¸æ™®é€šé€šä¿¡åœ¨æè¿°æ—¶åªæœ‰ä¸€ä¸ªå·®åˆ«ï¼šæ˜¯å¦æœ‰ stream å…³é”®å­—ã€‚\nProtocol Buffers  Protocol buffers are a language-neutral, platform-neutral extensible mechanism for serializing structured data.\n Protocol Buffers æ˜¯ä¸€ç§å¯¹ç»“æ„åŒ–æ•°æ®è¿›è¡Œåºåˆ—åŒ–çš„æœºåˆ¶ï¼Œå®ƒä¸ä»…è·¨è¯­è¨€ã€è·¨å¹³å°ï¼Œè¿˜å¯æ‰©å±•ã€‚\næ¶ˆæ¯ç±»å‹çš„å®šä¹‰ ç›´æ¥çœ‹å®˜ç½‘çš„ä¾‹å­ï¼š\nsyntax = \u0026#34;proto3\u0026#34;;message SearchRequest { string query = 1; int32 page_number = 2; int32 result_per_page = 3;}ä»¥ä¸Šå®šä¹‰äº†ä¸€ä¸ªéå¸¸ç®€å•çš„æ¶ˆæ¯ç±»å‹ï¼ˆmessage typeï¼‰ã€‚å¦‚æœè¦ä½¿ç”¨ proto3ï¼Œæ–‡ä»¶çš„ç¬¬ä¸€éç©ºç™½ä¸”éæ³¨é‡Šçš„è¡Œå¿…é¡»è¿™ä¹ˆå†™ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šè®¤ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ proto2ã€‚åœ¨ SearchRequest å†…éƒ¨ï¼Œå£°æ˜äº†ä¸‰ä¸ªå­—æ®µï¼ˆé”®å€¼å¯¹ï¼‰ï¼Œæ¯ä¸ªå­—æ®µéƒ½æœ‰è‡ªå·±çš„åå­—å’Œç±»å‹ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªå­—æ®µè¿˜æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å…³è”çš„æ•°å­—ï¼ˆunique numberï¼‰ï¼Œä¸€ä¸ªæ¶ˆæ¯ä¸­çš„æ¯ä¸ªå­—æ®µçš„æ•°å­—å„ä¸ç›¸åŒã€‚å…¶å®ï¼Œè¿™äº›æ•°å­—æ˜¯ç”¨æ¥è¯†åˆ«äºŒè¿›åˆ¶æ ¼å¼çš„æ¶ˆæ¯ä¸­çš„å­—æ®µçš„ï¼Œæ‰€ä»¥å®ƒä»¬åº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”åœ¨æ¶ˆæ¯ç±»å‹æŠ•å…¥ä½¿ç”¨ä¹‹åä¸åº”è¯¥å†è¢«ä¿®æ”¹ã€‚\næ ‡è¯†å­—æ®µçš„æ•°å­—ä¹Ÿæ˜¯æœ‰èŒƒå›´é™åˆ¶çš„ï¼Œå…è®¸çš„èŒƒå›´æ˜¯ $[1, 2^{29} - 1]$ã€‚å…¶ä¸­ï¼Œ[19000, 19999] æ˜¯ Protocol Buffers è‡ªå·±ä½¿ç”¨çš„ï¼Œæˆ‘ä»¬ä¸å¯ä½¿ç”¨å®ƒä»¬ã€‚èŒƒå›´åœ¨ [1, 15] å†…çš„æ•°å­—é‡‡ç”¨ä¸€ä¸ªå­—èŠ‚ç¼–ç ï¼ˆç¼–ç å†…å®¹åŒ…æ‹¬æ•°å­—æœ¬èº«å’Œå­—æ®µç±»å‹ï¼‰ï¼Œåº”å½“è¢«ç”¨åœ¨ä½¿ç”¨æœ€é¢‘ç¹çš„å­—æ®µä¸Šï¼›è€ŒèŒƒå›´åœ¨ [16, 2047] å†…çš„æ•°å­—åœ¨ç¼–ç æ—¶é‡‡ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œé€‚åˆè¢«ç”¨åœ¨ä½¿ç”¨æ²¡é‚£ä¹ˆé¢‘ç¹çš„å­—æ®µä¸Šã€‚\nå­—æ®µç±»å‹ æ¶ˆæ¯çš„å­—æ®µå¯ä»¥æ˜¯æ ‡é‡ç±»å‹ï¼ˆscalar typeï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤åˆç±»å‹ï¼ˆæ¯”å¦‚æšä¸¾ç±»å‹æˆ–å…¶å®ƒæ¶ˆæ¯ç±»å‹ï¼‰ã€‚\næ ‡é‡ç±»å‹ ä»¥ä¸‹è¡¨æ ¼åˆ—å‡ºäº† Protocol Buffers ä¸­çš„æ ‡é‡ç±»å‹ä¸å…¶åœ¨ Java/Python ä¸­å¯¹åº”çš„æ•°æ®ç±»å‹ï¼š\n   .proto Type Java Type Python Type     double float float   float float float   int32 int int   int64 long int/long   uint32 int int/long   uint64 long int/long   sint32 int int   sint64 long int/long   fixed32 int int/long   fixed64 long int/long   sfixed32 int int   sfixed64 long int/long   bool boolean bool   string String str/unicode   bytes ByteString str    ä¸åŒç±»å‹çš„å…·ä½“ç»†èŠ‚å¯ä»¥å‚è€ƒ åŸè¡¨æ ¼ã€‚\næšä¸¾ç±»å‹ å¦‚æœæˆ‘ä»¬å¸Œæœ›æ¶ˆæ¯å­—æ®µçš„å€¼ä½äºæŸä¸ªç‰¹å®šçš„é›†åˆä¸­ï¼Œåˆ™å¯ä»¥å°†è¯¥å­—æ®µå®šä¹‰æˆæšä¸¾ç±»å‹ï¼ˆenumerationï¼‰ã€‚ä¾‹å¦‚ï¼š\nmessage SearchRequest { string query = 1; int32 page_number = 2; int32 result_per_page = 3; enum Corpus { UNIVERSAL = 0; WEB = 1; IMAGES = 2; LOCAL = 3; NEWS = 4; PRODUCTS = 5; VIDEO = 6; } Corpus corpus = 4;}åœ¨å®šä¹‰æšä¸¾ç±»å‹æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è®©æ•°å­— 0 ä¸æšä¸¾ç±»å‹çš„ç¬¬ä¸€ä¸ªå…ƒç´ ç›¸å…³è”ã€‚å› ä¸º 0 æ˜¯æ•°å€¼ç±»å‹çš„é»˜è®¤å€¼ï¼Œ0 ä¸ç¬¬ä¸€ä¸ªå…ƒç´ ç›¸å…³è”çš„ç›®çš„æ˜¯ä¸ºäº†ç»´æŒå¯¹ proto2 çš„å…¼å®¹æ€§ã€‚\né»˜è®¤å€¼ ä¸åŒçš„æ•°æ®ç±»å‹æœ‰ç€ä¸åŒçš„é»˜è®¤å€¼ã€‚å½“ Protocol Buffers è§£ææ¶ˆæ¯æ—¶ï¼Œå¦‚æœå‘ç°ç¼–ç åçš„æ¶ˆæ¯ä¸­å¹¶ä¸å­˜åœ¨æŸä¸ªå­—æ®µï¼Œåˆ™ä¼šå°†å¯¹åº”å­—æ®µçš„å€¼è®¾ç½®ä¸ºå­—æ®µç±»å‹çš„é»˜è®¤å€¼ã€‚ä¸åŒç±»å‹çš„é»˜è®¤å€¼å¦‚ä¸‹ï¼š\n   å­—æ®µç±»å‹ é»˜è®¤å€¼     string empty string   bytes empty bytes   bool false   numeric types zero   enum first defined enum value, which must be 0   message not set   repeated field empty    åœ¨ Java ä¸­ä½¿ç”¨ Protocol Buffers Protocol Buffers çš„ç¼–è¯‘å™¨ protoc èƒ½å¤Ÿæ ¹æ®ç›®æ ‡è¯­è¨€ä¸ºæˆ‘ä»¬ç”Ÿæˆ .proto æ–‡ä»¶å¯¹åº”çš„ä»£ç ã€‚å¯¹äº Java æ¥è¯´ï¼Œprotoc ä¼šä¸ºæ¯ä¸€ç§æ¶ˆæ¯ç±»å‹éƒ½ç”Ÿæˆä¸€ä¸ª .java æ–‡ä»¶ï¼Œæ¯ä¸ª .java æ–‡ä»¶ä¸­éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ Builder è´Ÿè´£åˆ›å»ºæ¶ˆæ¯ç±»çš„å®ä¾‹ã€‚\nç›´æ¥æ¥çœ‹å®˜ç½‘çš„ä¸€ä¸ªä¾‹å­ï¼š\nsyntax = \u0026#34;proto3\u0026#34;;package tutorial;option java_multiple_files = true;option java_package = \u0026#34;com.example.tutorial.protos\u0026#34;;option java_outer_classname = \u0026#34;AddressBookProtos\u0026#34;;message Person { optional string name = 1; optional int32 id = 2; optional string email = 3; enum PhoneType { MOBILE = 0; HOME = 1; WORK = 2; } message PhoneNumber { optional string number = 1; optional PhoneType type = 2; } repeated PhoneNumber phones = 4;}message AddressBook { repeated Person people = 1;}è¿™æ®µä»£ç é¦–å…ˆå‘Šè¯‰ç¼–è¯‘å™¨ä½¿ç”¨ proto3ï¼Œç„¶åå£°æ˜äº†å½“å‰ .proto æ–‡ä»¶æ‰€å±çš„åŒ…ï¼ˆpackageï¼‰ï¼Œç”¨äºè§£å†³ä¸åŒé¡¹ç›®ä¹‹é—´å¯èƒ½å‡ºç°çš„å‘½åå†²çªï¼Œå®ƒçš„ä½œç”¨å’Œ Java ä¸­çš„åŒ…å¾ˆç›¸ä¼¼ã€‚ä¸è¿‡ä½ ä¼šå‘ç°ï¼Œåé¢è¿˜æœ‰ä¸€ä¸ª java_packageï¼Œå®ƒç»™å‡ºäº† Java çš„åŒ…åï¼Œç”¨äºå­˜æ”¾ç”Ÿæˆçš„ Java ç±»æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸€è¡Œï¼Œç¼–è¯‘å™¨ä¼šä½¿ç”¨ package çš„å€¼ä½œä¸º Java çš„åŒ…åã€‚\njava_outer_classname åˆ™å®šä¹‰äº†è¡¨ç¤ºæ•´ä¸ª .proto æ–‡ä»¶çš„ Java ç±»åï¼Œè€Œ java_multiple_files åˆ™å‘Šè¯‰ç¼–è¯‘å™¨è¦å°†æ¯ä¸ªç”Ÿæˆçš„ Java ç±»éƒ½æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„ .java æ–‡ä»¶ä¸­ã€‚\nBuilder ç¼–è¯‘å™¨ protoc ç”Ÿæˆçš„æ‰€æœ‰ Java æ¶ˆæ¯ç±»éƒ½æ˜¯ ä¸å¯å˜ çš„ã€‚è¿™æ„å‘³ç€ï¼Œæ¶ˆæ¯å¯¹è±¡åœ¨è¢«æ„é€ å‡ºæ¥ä¹‹åï¼Œå°±ä¸èƒ½è¢«ä¿®æ”¹ï¼Œå°±åƒ Java ä¸­çš„ String ä¸€æ ·ã€‚è¦æ„å»ºä¸€ä¸ªæ¶ˆæ¯å¯¹è±¡ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆæ„é€ å‡ºå¯¹åº”çš„ Builder å¯¹è±¡ï¼Œä½¿ç”¨ Builder ä¸ºå­—æ®µèµ‹å€¼ï¼Œæœ€åè°ƒç”¨ Builder çš„ build() æ–¹æ³•å®Œæˆå¯¹è±¡çš„åˆ›å»ºã€‚\nå‚è€ƒèµ„æ–™  gPRC Documentation. Protocol Buffers Guide.  ","href":"/posts/communication/gprc-and-protocol-buffers/","title":"gPRC ä¸ Protocol Buffers"},{"content":"","href":"/tags/rpc/","title":"RPC"},{"content":"","href":"/categories/rpc/","title":"RPC"},{"content":"å‡ ä¹æ‰€æœ‰çš„ç¼–ç¨‹è¯­è¨€ä¸­éƒ½æœ‰æ§åˆ¶æµï¼ˆcontrol flowï¼‰çš„æ¦‚å¿µï¼Œæ§åˆ¶æµå³æ ¹æ®æ¡ä»¶çš„æˆç«‹ä¸å¦å†³å®šä»£ç çš„æ‰§è¡Œé€»è¾‘ã€‚åœ¨ Rust ä¸­ï¼Œæ§åˆ¶æµåˆ†ä¸º if è¡¨è¾¾å¼å’Œå¾ªç¯ã€‚\nif è¡¨è¾¾å¼ ä¸€ä¸ªç®€å•çš„ if if è¡¨è¾¾å¼å‘Šè¯‰ç¨‹åºï¼šå¦‚æœæ¡ä»¶æˆç«‹ï¼Œåˆ™æ‰§è¡ŒæŸæ®µä»£ç ï¼Œå¦åˆ™ä¸æ‰§è¡Œé‚£æ®µä»£ç ã€‚ä¸¾ä¸ªä¾‹å­ï¼š\nfn main() { let condition = true; if condition { println!(\u0026#34;The condition was true.\u0026#34;) } } ä½¿ç”¨ cargo run è¿è¡Œè¿™æ®µä»£ç ï¼Œç¨‹åºçš„è¾“å‡ºç»“æœæ˜¯ï¼š\nThe condition was true. ä½†å¦‚æœä½ å°† let condition = true; æ›¿æ¢æˆ let condition = false;ï¼Œå°±ä¸ä¼šçœ‹åˆ°ä»»ä½•è¾“å‡ºã€‚\nåœ¨ Rust ä¸­ï¼Œæ‰€ä»¥çš„ if è¡¨è¾¾å¼éƒ½ä»¥å…³é”®å­— if å¼€å¤´ï¼Œéšåæ˜¯ä¸€ä¸ª bool ç±»å‹çš„æ¡ä»¶ï¼Œæ¡ä»¶æ»¡è¶³æ—¶æ‰§è¡Œçš„ä»£ç æ”¾åœ¨æ¡ä»¶åé¢çš„å°–æ‹¬å·é‡Œã€‚Rust è¦æ±‚æ¡ä»¶çš„æ•°æ®ç±»å‹å¿…é¡»æ˜¯å¸ƒå°”ç±»å‹ï¼Œå› ä¸º Rust ä¸ä¼šè‡ªåŠ¨è¿›è¡Œéå¸ƒå°”ç±»å‹åˆ°å¸ƒå°”ç±»å‹çš„å€¼è½¬æ¢ã€‚æ‰€ä»¥ï¼Œä»¥ä¸‹ä»£ç æ˜¯ä¸ä¼šé€šè¿‡ç¼–è¯‘çš„ï¼š\nfn main() { let number = 1; if number { println!(\u0026#34;The value of number is: {}\u0026#34;, number); } } ä½¿ç”¨ else æˆ‘ä»¬ä¹Ÿå¯ä»¥ç»™ if è¡¨è¾¾å¼åŠ ä¸€ä¸ªå¯é€‰çš„ else è¡¨è¾¾å¼ï¼Œç”¨æ¥å‘ŠçŸ¥ç¨‹åºå½“æ¡ä»¶ä¸æ»¡è¶³çš„æ—¶å€™åº”è¯¥æ‰§è¡Œä½•ç§æ“ä½œã€‚ä¾‹å¦‚ï¼š\nfn main() { let condition = false; if condition { println!(\u0026#34;The condition was true.\u0026#34;) } else { println!(\u0026#34;The condition was false.\u0026#34;); } } ä½¿ç”¨ cargo run è¿è¡Œä»¥ä¸Šä»£ç ï¼Œä½ ä¼šçœ‹åˆ°å±å¹•ä¸Šæ‰“å°å‡ºäº†ä»¥ä¸‹å†…å®¹ï¼š\nThe condition was false. ä½¿ç”¨ else if å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªæ¡ä»¶ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•å†™å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨ else ifã€‚ä¸¾ä¸ªä¾‹å­ï¼š\nfn main() { let number = 6; if number % 4 == 0 { println!(\u0026#34;number is divisible by 4\u0026#34;); } else if number % 3 == 0 { println!(\u0026#34;number is divisible by 3\u0026#34;); } else if number % 2 == 0 { println!(\u0026#34;number is divisible by 2\u0026#34;); } else { println!(\u0026#34;number is not divisible by 4, 3, or 2\u0026#34;); } } ä»¥ä¸Šç¨‹åºä¸­æœ‰å››æ¡æ‰§è¡Œè·¯å¾„ï¼Œä½†æ˜¯åªä¼šæ‰“å°ä¸€æ¡è·¯å¾„ä¸Šçš„ç»“æœï¼š\nnumber is divisible by 3 è¿™æ˜¯å› ä¸º Rust ä¼šä¾æ¬¡æ£€æŸ¥æ¯ä¸€ä¸ªæ¡ä»¶ï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªå€¼ä¸º true çš„æ¡ä»¶å°±æ‰§è¡Œä¸ä¹‹å…³è”çš„ä»£ç å—ï¼Œç„¶åç»“æŸå¯¹æ‰€æœ‰åç»­æ¡ä»¶çš„æ£€æŸ¥ã€‚\nåœ¨ let è¯­å¥ä¸­ä½¿ç”¨ if å› ä¸º if æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ let è¯­å¥ä¸­ä½¿ç”¨å®ƒï¼Œä¾‹å¦‚ï¼š\nfn main() { let condition = true; let number = if condition {5} else {6}; println!(\u0026#34;The value of number is: {}\u0026#34;, number); } if è¡¨è¾¾å¼çš„è¿”å›å€¼ä¼šè¢«ç»‘å®šåˆ°å˜é‡ number ä¸Šã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œç»‘å®šç»™å˜é‡ number çš„å€¼æ˜¯ 5ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ cargo run æ£€æŸ¥ä¸€ä¸‹è¿è¡Œç»“æœï¼š\nThe value of number is: 5 Rust è¦æ±‚æ‰€æœ‰å¯èƒ½ä» if è¡¨è¾¾å¼è¿”å›çš„å€¼éƒ½å¿…é¡»æ˜¯åŒä¸€ä¸ªç±»å‹ã€‚ä¾‹å¦‚ï¼š\nfn main() { let number = if true {5} else {\u0026#34;six\u0026#34;} } ä»¥ä¸Šä»£ç ä¼šç”±äº if è¡¨è¾¾å¼å¯èƒ½è¿”å›çš„ 5 å’Œ \u0026quot;six\u0026quot; ä¸¤ä¸ªå€¼ç±»å‹ä¸åŒè€Œæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚\nå¾ªç¯ å¦‚æœæˆ‘ä»¬æƒ³è®©æŸä¸€æ®µä»£ç æ‰§è¡Œå¤šæ¬¡ï¼Œè¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿä¸€ç§ç®€å•ä¸”ç¬¨çš„æ–¹æ³•æ˜¯å°†é‚£æ®µä»£ç å¤åˆ¶å¤šæ¬¡ï¼Œä¾‹å¦‚ï¼š\nfn main() { println!(\u0026#34;again!\u0026#34;); println!(\u0026#34;again!\u0026#34;); println!(\u0026#34;again!\u0026#34;); } æ˜¾ç„¶å¤åˆ¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ä»¥ä¸Šä»£ç æ‰“å°äº†ä¸‰æ¬¡ again!ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³è®©ç¨‹åºä¸€ç›´ä¸åœåœ°æ‰“å° again! å‘¢ï¼Ÿè¿™æ—¶å€™å¤åˆ¶å°±æ— èƒ½ä¸ºåŠ›äº†ï¼ˆæ¯•ç«Ÿå¤åˆ¶æ˜¯ä¸ªä½“åŠ›æ´»ğŸ˜ï¼‰ã€‚æ­£ç¡®çš„å§¿åŠ¿æ˜¯ä½¿ç”¨å¾ªç¯ï¼Œå¾ªç¯å¯ä»¥ä¸æ–­åœ°æ‰§è¡Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æŸä¸ªæ—¶å€™ä¸­æ­¢å¾ªç¯ã€‚Rust ä¸­æœ‰ä¸‰ç±»å¾ªç¯ï¼šloopã€while å’Œ forã€‚\nloop loop å‘Šè¯‰ Rust ä¸åœåœ°é‡å¤æ‰§è¡ŒæŸä¸ªä»£ç å—ã€‚ä¾‹å¦‚ï¼š\nfn main() { loop { println!(\u0026#34;again!\u0026#34;); } } å¦‚æœè¿è¡Œè¿™æ®µä»£ç ï¼Œä½ çš„å±å¹•ä¸Šä¼šä¸æ–­åœ°æ‰“å°å‡º again!ã€‚åœ¨ä½ æ‰‹åŠ¨åœæ­¢ç¨‹åºä¹‹å‰ï¼Œè¿™ä¸ªæ‰“å°è¿‡ç¨‹ä¸ä¼šåœæ­¢ã€‚\nä½ å¯èƒ½æƒ³é—®ï¼Œå¦‚æœæˆ‘æƒ³åœ¨æŸä¸ªæ—¶å€™é€€å‡ºå¾ªç¯ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿç­”æ¡ˆå°±æ˜¯ä½¿ç”¨ break å…³é”®å­—æ˜¾å¼åœ°å‘Šè¯‰ç¨‹åºä¸è¦å†æ‰§è¡Œå¾ªç¯äº†ã€‚ä¾‹å¦‚ï¼š\nfn main() { let mut counter = 0; loop { if counter == 2 { println!(\u0026#34;The value of counter is: 2. Over!\u0026#34;); break; } println!(\u0026#34;The value of counter is not 2. Again!\u0026#34;); counter += 1; } } è¿™æ®µä»£ç çš„ç»“æœå¦‚ä¸‹ï¼š\nThe value of counter is not 2. Again! The value of counter is not 2. Again! The value of counter is: 2. Over! åœ¨ Rust ä¸­ï¼Œbreak ä¸ä»…å¯ä»¥ç»ˆæ­¢å¾ªç¯ï¼Œè¿˜å¯ä»¥åœ¨ç»ˆæ­¢å¾ªç¯çš„æ—¶å€™è¿”å›ä¸€ä¸ªå€¼ä¾›ç¨‹åºä¸­çš„å…¶å®ƒä»£ç ä½¿ç”¨ã€‚è¿™ä½¿å¾— break æœ‰ç‚¹åƒ Rust å‡½æ•°ä¸­çš„ return äº†ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\nfn main() { let mut counter = 0; let result = loop { counter += 1; if counter == 2 { break counter; } }; println!(\u0026#34;The result is {}\u0026#34;, result); } ä»¥ä¸Šä»£ç ä¸­å£°æ˜äº†ä¸€ä¸ª result å˜é‡ï¼Œå®ƒå°†æŒæœ‰ä» loop å¾ªç¯è¿”å›çš„å€¼ã€‚æœ€ç»ˆç¨‹åºçš„è¾“å‡ºç»“æœä¸ºï¼š\nThe result is 2 while åœ¨ loop çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸æ–­æ£€æŸ¥ counter çš„å€¼ï¼Œå½“ counter çš„å€¼ä¸º 2 æ—¶å°±ä½¿ç”¨ break ç»“æŸå¾ªç¯ï¼Œå¦åˆ™ç»§ç»­æ‰§è¡Œå¾ªç¯å†…çš„ä»£ç å—ã€‚è¿™ä¹Ÿå¯ä»¥ä½¿ç”¨ Rust ä¸­çš„ while å¾ªç¯æ¥å®ç°ï¼Œè€Œä¸”å®ƒçœ‹èµ·æ¥æ›´åŠ ç®€æ´ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ while å¾ªç¯æ¥æ”¹é€ ç¬¬ä¸€ä¸ª counter ç¤ºä¾‹ï¼š\nfn main() { let mut counter = 0; while counter != 2 { println!(\u0026#34;The value of counter is not 2. Again!\u0026#34;); counter += 1; } println!(\u0026#34;The value of counter is: 2. Over!\u0026#34;); } ç¨‹åºçš„è¿è¡Œç»“æœä¾ç„¶æ˜¯ï¼š\nThe value of counter is not 2. Again! The value of counter is not 2. Again! The value of counter is: 2. Over! åœ¨ while å¾ªç¯ä¸­ï¼Œæ¡ä»¶ä½äº while å…³é”®å­—åé¢ã€‚æ¯æ¬¡å¾ªç¯ä¹‹å‰éƒ½ä¼šæ£€æŸ¥æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œè‹¥æˆç«‹åˆ™æ‰§è¡Œå¾ªç¯ä½“å†…çš„ä»£ç ï¼Œå¦åˆ™ç»“æŸå¾ªç¯ã€‚\nfor Rust ä¸­çš„ for å¾ªç¯ä¸å…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸­çš„ for æœ‰äº›ä¸åŒã€‚å®ƒä¸»è¦ç”¨äºå¯¹é›†åˆæˆ–æŸä¸ªèŒƒå›´è¿›è¡Œè¿­ä»£æ“ä½œï¼Œéœ€è¦æ­é…å…³é”®å­— in ä½¿ç”¨ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥æ›¿ä»£ loop å’Œ whileã€‚ä¾‹å¦‚ï¼š\nfn main() { for element in [1, 2, 3] { println!(\u0026#34;{}\u0026#34;, element); } } ä»¥ä¸Šä»£ç çš„è¿è¡Œç»“æœä¸ºï¼š\n1 2 3 å†æ¥çœ‹ä¸€ä¸ªèŒƒå›´è¿­ä»£ï¼š\nfn main() { for element in 1..4 { println!(\u0026#34;{}\u0026#34;, element); } } ä»¥ä¸Šä»£ç çš„è¿è¡Œç»“æœä¾ç„¶æ˜¯ï¼š\n1 2 3 åœ¨ Rust ä¸­ï¼ŒèŒƒå›´ï¼ˆrangeï¼‰é»˜è®¤æ˜¯å·¦é—­å³å¼€çš„ã€‚å½“ç„¶ï¼ŒèŒƒå›´ä¹Ÿæœ‰å·¦é—­å³é—­çš„å†™æ³•ã€‚ä¾‹å¦‚ï¼Œ1..4 ä¸ 1.=3 æ˜¯ç­‰ä»·çš„ã€‚\nå‚è€ƒèµ„æ–™  Steve Klabnik, Carol Nichols. The Rust Programming Language.  ","href":"/rust/rust_basics_control_flow/","title":"Rust åŸºç¡€ï¼šæ§åˆ¶æµ"},{"content":"åœ¨ Rust ä¸­ï¼Œå‡½æ•°æ— å¤„ä¸åœ¨ã€‚æˆ‘ä»¬å­¦ä¹ â€œHello, world!â€æ—¶æ¥è§¦åˆ°çš„ main å‡½æ•°å°±æ˜¯ Rust ä¸­æœ€é‡è¦çš„å‡½æ•°ã€‚æˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œå£°æ˜ main å‡½æ•°çš„æ—¶å€™éœ€è¦ç”¨åˆ°å…³é”®å­— fnã€‚å®é™…ä¸Šï¼ŒRust ä¸­çš„æ‰€æœ‰å‡½æ•°éƒ½æ˜¯é€šè¿‡ fn å£°æ˜çš„ã€‚\nåœ¨æ­£å¼å­¦ä¹ å‡½æ•°ä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹ Rust ä¸­çš„å‡½æ•°ä¸å˜é‡å‘½åé£æ ¼ã€‚ä¸åŒäº Java ä¸­çš„é©¼å³°å‘½åï¼ˆcamel caseï¼‰ï¼ŒRust ä¸­æ¨å´‡ä½¿ç”¨è›‡å½¢å‘½åï¼ˆsnake caseï¼‰ã€‚åœ¨è›‡å½¢å‘½åä¸­ï¼Œæ‰€æœ‰å­—æ¯éƒ½æ˜¯å°å†™çš„ï¼Œå•è¯ä¹‹é—´ä½¿ç”¨ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰åˆ†éš”ï¼Œæ¯”å¦‚ hello_worldã€‚\nä¸€ä¸ªç®€å•çš„å‡½æ•° ä¸‹é¢ä»£ç å±•ç¤ºäº†ä¸€ä¸ªç®€å•åœ°æ— å‚å‡½æ•°çš„ä½¿ç”¨ï¼š\nfn main() { println!(\u0026#34;Hello, world!\u0026#34;); another_function(); } fn another_function() { println!(\u0026#34;Another function.\u0026#34;); } ä½¿ç”¨ cargo run è¿è¡Œç¨‹åºï¼Œç»“æœå¦‚ä¸‹ï¼š\nHello, world! Another function. ä»£ç ä¸­å®šä¹‰çš„ another_function çš„å®šä¹‰å‡ºç°åœ¨ main å‡½æ•°ä¹‹åï¼Œå®ƒè¿˜å¯ä»¥å‡ºç°åœ¨ main å‡½æ•°ä¹‹å‰ã€‚å…¶å®ï¼ŒRust å¹¶ä¸å…³å¿ƒæˆ‘ä»¬åœ¨ä½•å¤„å®šä¹‰å‡½æ•°ï¼Œåªè¦å®ƒèƒ½æ‰¾åˆ°å°±è¡Œã€‚\nå†æ¥çœ‹ä¸€ä¸‹ another_function çš„ç»„æˆï¼šé¦–å…ˆæ˜¯ fn å…³é”®å­—ï¼Œå¾€åæ˜¯å‡½æ•°åï¼Œå‡½æ•°ååè·Ÿäº†ä¸€å¯¹åœ†æ‹¬å·ï¼Œæœ€ååˆ™æ˜¯æœ‰å°–æ‹¬å·åŒ…è£¹çš„å‡½æ•°ä½“ã€‚å› ä¸º another_function ä¸éœ€è¦ä»»ä½•å‚æ•°ï¼Œæ‰€ä»¥åœ†æ‹¬å·å†…æ²¡æœ‰ä»»ä½•å†…å®¹ã€‚\nå‡½æ•°å‚æ•° Rust ä¸­çš„å‡½æ•°æ˜¯å¯ä»¥æœ‰å‚æ•°çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå‚æ•°ä¿¡æ¯æ”¾åˆ°å‡½æ•°ååé¢çš„åœ†æ‹¬å·ä¸­ï¼Œå°±å¯ä»¥åœ¨å‡½æ•°ä½“ä¸­ä½¿ç”¨å®ƒä»¬äº†ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ another_function ç¨åŠ æ”¹é€ ï¼ŒæŠŠå®ƒå˜æˆä¸€ä¸ªæœ‰å‚å‡½æ•°ï¼š\nfn main() { another_function(5); } fn another_function(x: i32) { println!(\u0026#34;The value of x is: {}\u0026#34;, x); } ä½¿ç”¨ cargo run è¿è¡Œç¨‹åºï¼Œä½ å°±ä¼šçœ‹åˆ°æ§åˆ¶å°æ‰“å°å‡ºäº†ä»¥ä¸‹å†…å®¹ï¼š\nThe value of x is: 5 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œanother_function æœ‰ä¸€ä¸ªç±»å‹ä¸º i32 çš„å‚æ•° xã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ i32 æ˜¯ä¸å¯çœç•¥çš„ã€‚æˆ‘ä»¬å¿…é¡»åœ¨å‡½æ•°ç­¾åä¸­æ˜¾å¼ç»™å‡ºæ¯ä¸ªå‚æ•°çš„ç±»å‹ï¼Œå¦åˆ™å°±ä¼šç¼–è¯‘å¤±è´¥ã€‚å¦‚æœæˆ‘ä»¬çš„å‡½æ•°æœ‰å¤šä¸ªå‚æ•°ï¼Œä½¿ç”¨é€—å·è¿›è¡Œåˆ†éš”å³å¯ï¼Œå¤šä¸ªå‚æ•°çš„ç±»å‹ä¸å¿…ç›¸åŒã€‚æ¯”å¦‚ï¼š\nfn another_fuction(x: i32, y: i8) { println!(\u0026#34;x = {}, y = {}\u0026#34;, x, y); } ä¸Šé¢ä»£ç ä¸­çš„ another_fuction å°±æœ‰ x å’Œ y ä¸¤ä¸ªå‚æ•°ã€‚å…¶ä¸­ï¼Œå‚æ•° x çš„ç±»å‹æ˜¯ i32ï¼Œè€Œå‚æ•° y çš„ç±»å‹æ˜¯ i8ã€‚\nè¯­å¥ä¸è¡¨è¾¾å¼ Rust æ˜¯ä¸€é—¨åŸºäºè¡¨è¾¾å¼çš„è¯­è¨€ã€‚è¡¨è¾¾å¼ï¼ˆexpressionsï¼‰ä¼šè®¡ç®—å¹¶è¿”å›ä¸€ä¸ªå€¼ã€‚è¯­å¥ï¼ˆstatementsï¼‰åˆ™æ˜¯æ‰§è¡ŒæŸäº›åŠ¨ä½œçš„æŒ‡ä»¤ï¼Œå¹¶ä¸ä¼šè¿”å›ä¸€ä¸ªå€¼ã€‚æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\nfn main() { let x = 1; } åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ1 æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒè¿”å›çš„å€¼æ°å¥½æ˜¯ 1ã€‚è€Œ let x = 1 åˆ™æ˜¯ä¸€ä¸ªè¯­å¥ï¼Œå®ƒæ²¡æœ‰ä»»ä½•è¿”å›å€¼ã€‚å› æ­¤ï¼Œä¸‹é¢è¿™ç§å†™æ³•æ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘çš„ï¼š\nfn main() { let y = (let x = 1); } å› ä¸º let x = 1 æ˜¯ä¸€ä¸ªè¯­å¥ï¼Œå®ƒæ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥æ²¡æœ‰ä»»ä½•ä¸œè¥¿ç»‘å®šåˆ°å˜é‡ y ä¸Šã€‚Rust åœ¨è¿™ä¸€ç‚¹ä¸Šè·Ÿå…¶å®ƒç¼–ç¨‹è¯­è¨€æœ‰å¾ˆå¤§ä¸åŒï¼Œåœ¨å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­ y = x = 1 æ˜¯åˆæ³•çš„ï¼Œè€Œ Rust ä¸­æ˜¯ä¸å…è®¸çš„ã€‚\nå‡½æ•°è°ƒç”¨æ˜¯è¡¨è¾¾å¼ï¼Œå®è°ƒç”¨æ˜¯è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬ç”¨æ¥åˆ›å»ºæ–°ä½œç”¨åŸŸçš„ä»£ç å—ï¼ˆ{}ï¼‰ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼š\nfn main() { let x = 5; let y = { let x = 3; x + 1 }; println!(\u0026#34;The value of y is: {}\u0026#34;, y); } åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œè¡¨è¾¾å¼ï¼š\n{ let x = 3; x + 1 } è¿”å›çš„å€¼æ˜¯ 4ï¼Œè€Œè¿™ä¸ª 4 æœ€ç»ˆä¼šè¢«ç»‘å®šåˆ°å˜é‡ y ä¸Šã€‚æˆ‘ä»¬å¯èƒ½ä¼šè§‰å¾—è¿™ä¸ªè¡¨è¾¾å¼çœ‹ä¸Šå»å¾ˆå¥‡æ€ªï¼Œå°¤å…¶æ˜¯æœ€åä¸€è¡Œ x + 1 å±…ç„¶æ²¡æœ‰ç”¨åˆ†å·ç»“å°¾ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨ Rust ä¸­ï¼Œè¡¨è¾¾å¼æ˜¯ä¸åŒ…æ‹¬æœ«å°¾çš„åˆ†å·çš„ï¼Œå¦‚æœæˆ‘ä»¬å°†åˆ†å·åŠ åˆ°è¡¨è¾¾å¼åé¢ï¼Œé‚£å°±ä¸æ˜¯è¡¨è¾¾å¼è€Œæ˜¯ä¸€ä¸ªè¯­å¥äº†ã€‚\nå¸¦è¿”å›å€¼çš„å‡½æ•° è¿„ä»Šä¸ºæ­¢ï¼Œæˆ‘ä»¬å†™çš„å‡½æ•°éƒ½æ˜¯ä¸å¸¦è¿”å›å€¼çš„ã€‚é‚£ä¹ˆå¸¦è¿”å›å€¼çš„å‡½æ•°è¯¥æ€ä¹ˆå†™å‘¢ï¼Ÿå…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\nfn five() -\u0026gt; i32 { 5 } fn main() { let x = five(); println!(\u0026#34;The value of x is: {}\u0026#34;, x); } å’Œä¹‹å‰çš„å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨åœ†æ‹¬å·åé¢åŠ äº† -\u0026gt; å’Œè¿”å›å€¼ç±»å‹ i32ï¼ŒåŒæ—¶ï¼Œå‡½æ•°ä½“ä¸­çš„æœ€åä¸€è¡Œæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ 5ã€‚è¿™å°±æ˜¯å¸¦è¿”å›å€¼çš„å‡½æ•°çš„å†™æ³•ï¼Œå³åœ¨å‡½æ•°ç­¾åä¸ŠåŠ ä¸Š -\u0026gt; å’Œè¿”å›å€¼ç±»å‹ï¼Œå¹¶åœ¨å‡½æ•°ä½“çš„æœ€åä¸€è¡Œå†™ä¸Šä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼å°±æ˜¯æˆ‘ä»¬çš„è¿”å›å€¼ï¼Œè¡¨è¾¾å¼çš„ç±»å‹å°±æ˜¯å‡½æ•°ç­¾åä¸Š -\u0026gt; åé¢çš„å‡½æ•°ç±»å‹ã€‚è¿”å›å€¼å¹¶ä¸ä¸€æ ·è¦åœ¨å‡½æ•°ä½“çš„æœ€åä¸€è¡Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å‡½æ•°ä½“çš„ä¸­é—´ä½¿ç”¨å…³é”®å­— return åŠ ä¸Šä¸€ä¸ªè¡¨è¾¾å¼æå‰è¿”å›ã€‚ä½¿ç”¨ return æ˜¯æ˜¾å¼è¿”å›ï¼Œè€Œå‡½æ•°ä½“ä¸­æœ€åä¸€è¡Œçš„è¡¨è¾¾å¼åˆ™æ˜¯éšå¼è¿”å›ã€‚\nå‚è€ƒèµ„æ–™  Steve Klabnik, Carol Nichols. The Rust Programming Language.  ","href":"/rust/rust_basics_functions/","title":"Rust åŸºç¡€ï¼šå‡½æ•°"},{"content":"å˜é‡ å˜é‡ä¸å¯å˜æ€§ åœ¨ Rust ä¸­ï¼Œå˜é‡ï¼ˆvariablesï¼‰æœ‰ä¸¤ç§ï¼š\n ä¸å¯å˜å˜é‡ï¼šä¸€ç»èµ‹å€¼ï¼Œå°±ä¸å†å…è®¸å¯¹å˜é‡çš„å€¼è¿›è¡Œä¿®æ”¹ å¯å˜å˜é‡ï¼šå¯å¯å¯¹å˜é‡çš„å€¼è¿›è¡Œå¤šæ¬¡ä¿®æ”¹  åœ¨ Rust ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ let å…³é”®å­—å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œä¾‹å¦‚ï¼šlet x = 1ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œlet å£°æ˜çš„å˜é‡æ˜¯ ä¸å¯å˜çš„ã€‚å¦‚æœä»£ç é‡Œé¢å‡ºç°ä¸å¯å˜å˜é‡è¢«å¤šæ¬¡èµ‹å€¼çš„æƒ…å†µï¼Œåˆ™ä»£ç æ˜¯ä¸ä¼šç¼–è¯‘é€šè¿‡çš„ã€‚ä¾‹å¦‚ï¼š\nfn main() { let x = 5; println!(\u0026#34;The value of x is: {}\u0026#34;, x); x = 6; println!(\u0026#34;The value of x is: {}\u0026#34;, x); } å¦‚æœä½¿ç”¨ cargo run è¿è¡Œè¿™æ®µä»£ç ï¼Œåˆ™ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š\n\u0026gt; cargo run Compiling variables v0.1.0 (F:\\Code\\Rust\\rust-study\\variables) error[E0384]: cannot assign twice to immutable variable `x` --\u0026gt; src\\main.rs:4:5 | 2 | let x = 5; | - | | | first assignment to `x` | help: consider making this binding mutable: `mut x` 3 | println!(\u0026#34;The value of x is: {}\u0026#34;, x); 4 | x = 6; | ^^^^^ cannot assign twice to immutable variable error: aborting due to previous error For more information about this error, try `rustc --explain E0384`. error: could not compile `variables` To learn more, run the command again with --verbose. Cargo ç»™äº†æˆ‘ä»¬å¾ˆå¤šæœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯ï¼Œå…¶ä¸­å°±ä¸€è¡Œè¢«æ ‡æˆäº†çº¢è‰²ï¼Œååˆ†é†’ç›®ï¼šcannot assign twice to immutable variableã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯ä»¥å†æ¬¡ç»™ä¸å¯å˜å˜é‡èµ‹å€¼ã€‚\nè§£å†³é”™è¯¯çš„æ–¹æ³•å¾ˆç®€å•ï¼Œå°†ç¬¬äºŒè¡Œæ›¿æ¢æˆ let mut x = 5 å³å¯ã€‚æˆ‘ä»¬åœ¨å˜é‡ x ä¹‹å‰åŠ äº†ä¸€ä¸ªå…³é”®å­— mutï¼Œè¡¨æ˜ x æ˜¯ä¸€ä¸ªå¯å˜å˜é‡ã€‚å†æ¬¡è¿è¡Œ cargo runï¼Œæˆ‘ä»¬å°±èƒ½çœ‹åˆ°æ­£ç¡®çš„è¾“å‡ºäº†ã€‚\nå¸¸é‡ å’Œå…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒRust ä¸­ä¹Ÿæœ‰å¸¸é‡ï¼ˆconstantsï¼‰è¿™ä¸ªæ¦‚å¿µã€‚Rust ä¸­çš„å¸¸é‡åœ¨èµ‹å€¼ä¹‹åå°±ä¸èƒ½ä¿®æ”¹ã€‚æœ‰äººå¯èƒ½ä¼šé—®ï¼Œè¿™ä¸å°±è·Ÿä¸å¯å˜å˜é‡ä¸€æ ·å—ï¼Ÿå®é™…ä¸Šï¼Œè¿™åªæ˜¯å¸¸é‡ä¸ä¸å¯å˜å˜é‡çš„ä¸€ä¸ªç›¸åŒç‚¹ï¼ŒäºŒè€…è¿˜æ˜¯æœ‰å·®å¼‚çš„ã€‚\né¦–å…ˆï¼Œå£°æ˜å¸¸é‡çš„å…³é”®å­—æ˜¯ constï¼Œè€Œå£°æ˜å˜é‡çš„å…³é”®å­—æ˜¯ letã€‚\nconst ONE: u32 = 1; ä»¥ä¸Šä»£ç å£°æ˜äº†ä¸€ä¸ªåä¸º ONE çš„å¸¸é‡ï¼Œå¹¶èµ‹å€¼ä¸º 1ã€‚å¸¸é‡åçº¦å®šä½¿ç”¨å¤§å†™å­—æ¯ï¼Œå¤šä¸ªå•è¯ä¹‹é—´ç”¨ä¸‹åˆ’çº¿éš”å¼€ã€‚\nå…¶æ¬¡ï¼Œå¸¸é‡çš„èµ‹å€¼éƒ¨åˆ†åªèƒ½æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ï¼Œä¸èƒ½æ˜¯æŸä¸ªå‡½æ•°è°ƒç”¨çš„ç»“æœæˆ–è¿è¡ŒæœŸé—´è®¡ç®—å‡ºæ¥çš„å€¼ã€‚è€Œå˜é‡å°±æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚\nlet x = 1; const SQUARE = x * x; ä¸Šé¢è¿™æ®µä»£ç æ˜¯æ— æ³•æ­£å¸¸ç¼–è¯‘çš„ï¼Œå› ä¸º x æ˜¯å˜é‡ï¼Œè€Œ SQUARE æ˜¯å¸¸é‡ï¼Œx * x çš„å€¼æ˜¯åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è®¡ç®—å‡ºæ¥çš„ã€‚\næ­¤å¤–ï¼Œstatic å…³é”®å­—ä¹Ÿå¯ä»¥ç”¨æ¥å£°æ˜ä¸€ä¸ªå¸¸é‡ï¼Œä½¿ç”¨ static å…³é”®å­—å£°æ˜çš„å¸¸é‡ä»£è¡¨çš„æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸º 'staticï¼Œè€Œ const å£°æ˜çš„å¸¸é‡ä»£è¡¨çš„æ˜¯ä¸€ä¸ªå€¼ã€‚0246-const-vs-static æè¿°äº†äºŒè€…çš„ä¸åŒã€‚\néšè— æˆ‘ä»¬å¯ä»¥å¤šæ¬¡å®šä¹‰ä¸€ä¸ªåŒåçš„å˜é‡ï¼Œåé¢å®šä¹‰çš„å˜é‡ä¼šéšè—ï¼ˆshadowingï¼‰å®ƒä¹‹å‰çš„åŒåå˜é‡ï¼Œå³ç¨‹åºåªèƒ½çœ‹åˆ°æœ€æ–°ä¸€ä¸ªåŒåå˜é‡çš„å€¼ã€‚\nfn main() { let x = 5; let x = x + 1; { let x = x * 2; println!(\u0026#34;The value of x in the inner scope is: {}\u0026#34;, x); } println!(\u0026#34;The value of x is: {}\u0026#34;, x); } ä»¥ä¸Šè¿™æ®µä»£ç å¾ˆæœ‰æ„æ€ï¼Œå®ƒé¦–å…ˆå°†å˜é‡ x çš„å€¼ç»‘å®šä¸º 5ï¼Œç„¶åé€šè¿‡ let x = éšè— 5 è¿™ä¸ªå€¼ï¼ŒçœŸæ­£å¯è§çš„å€¼æ˜¯ 6ã€‚è€Œåœ¨å†…éƒ¨ä½œç”¨åŸŸä¸­ï¼Œç¬¬äºŒä¸ª let å†æ¬¡éšè— x ä¹‹å‰çš„å€¼ï¼ŒçœŸæ­£å¯è§çš„å€¼æ˜¯ 12ã€‚å†…éƒ¨ä½œç”¨åŸŸç»“æŸï¼Œä½œç”¨åŸŸå†…çš„éšè—æ•ˆæœä¹Ÿç»“æŸäº†ï¼Œx çš„å€¼åˆå˜æˆ 6ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªç¨‹åºçš„è¾“å‡ºç»“æœåº”è¯¥æ˜¯ï¼š\nThe value of x in the inner scope is: 12 The value of x in the inner scope is: 6 å¦‚æœæˆ‘ä»¬å»æ‰ç¬¬äºŒè¡Œå¼€å¤´çš„ letï¼Œç¨‹åºå°±å› ä¸å¯å˜å˜é‡è¢«å†æ¬¡èµ‹å€¼è€Œç¼–è¯‘å¤±è´¥ã€‚ä¸å¯å˜å˜é‡çš„éšè—ä¸ä¸å¯å˜å˜é‡çš„èµ‹å€¼æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºéšè—å°±æ˜¯é‡æ–°å£°æ˜äº†ä¸€ä¸ªæ–°çš„å˜é‡ã€‚\næ—¢ç„¶å¦‚æ­¤ï¼Œä¸ºå•¥ä¸ç›´æ¥ä½¿ç”¨å¯å˜å˜é‡å‘¢ï¼ŸåŸå› æ˜¯éšè—æ›´åŠ çµæ´»ï¼Œå› ä¸ºä¸å¯å˜å˜é‡çš„å˜é‡ç±»å‹åœ¨å£°æ˜ä¹‹åå°±ä¸èƒ½å†æ”¹äº†ï¼Œè€Œéšè—å¯ä»¥ä¿®æ”¹å˜é‡çš„æ•°æ®ç±»å‹ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç æ˜¯å¯ä»¥ç¼–è¯‘æˆåŠŸçš„ï¼š\nlet a = 1; let a = \u0026#34;1\u0026#34;; è€Œä¸‹é¢è¿™æ®µä»£ç å°†ä¼šç¼–è¯‘å¤±è´¥ï¼š\nlet mut a = 1; a = \u0026#34;1\u0026#34;; å†»ç»“ï¼ˆFreezingï¼‰ å½“æ•°æ®è¢«ç»‘å®šåˆ°ä¸å¯å˜çš„åŒåå˜é‡ä¸Šæ—¶ï¼Œè¯¥æ•°æ®ä¼šè¢«å†»ç»“ã€‚è¢«å†»ç»“çš„æ•°æ®åªæœ‰åœ¨è¶…å‡ºä¸å¯å˜ç»‘å®šçš„ä½œç”¨åŸŸä¹‹å¤–æ‰èƒ½è¢«ä¿®æ”¹ã€‚ä¾‹å¦‚ï¼š\nfn main() { let mut _mutable_integer = 7i32; { // Shadowing by immutable `_mutable_integer`  let _mutable_integer = _mutable_integer; // Error! `_mutable_integer` is frozen in this scope  _mutable_integer = 50; // FIXME ^ Comment out this line  // `_mutable_integer` goes out of scope  } // Ok! `_mutable_integer` is not frozen in this scope  _mutable_integer = 3; } æ•°æ®ç±»å‹ Rust æ˜¯ä¸€é—¨ é™æ€ç±»å‹ è¯­è¨€ï¼Œåœ¨ç¼–è¯‘æœŸé—´å°±å¿…é¡»ç¡®å®šæ‰€æœ‰å˜é‡çš„ç±»å‹ã€‚Rust ä¸­çš„æ¯ä¸€ä¸ªå˜é‡çš„å€¼éƒ½å±äºæŸä¸€æ•°æ®ç±»å‹ï¼ŒRust é€šè¿‡æ•°æ®ç±»å‹å¾—çŸ¥å˜é‡çš„å€¼æ˜¯ä½•ç§æ•°æ®ï¼Œè¿›è€Œå†³å®šå¦‚ä½•å¤„ç†è¿™ä¸ªå€¼ã€‚\næˆ‘ä»¬å¹¶ä¸éœ€è¦ä¸€ä¸€å£°æ˜å˜é‡æ‰€å±çš„æ•°æ®ç±»å‹ï¼ŒRust çš„ç¼–è¯‘å™¨æ˜¯å¾ˆæ™ºèƒ½çš„ï¼Œå®ƒå¯ä»¥æ ¹æ®å€¼åŠå…¶ä½¿ç”¨æ–¹å¼æ¨æ–­å‡ºæˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„æ•°æ®ç±»å‹ã€‚ä½†æ˜¯ï¼Œå½“æŸä¸ªå€¼å¯èƒ½å±äºå¤šç§æ•°æ®ç±»å‹æ—¶ï¼Œæˆ‘ä»¬å°±å¿…é¡»é€šè¿‡ç±»å‹æ³¨è§£æ˜¾å¼åœ°ç»™å‡ºå˜é‡çš„æ•°æ®ç±»å‹ï¼Œå¦åˆ™ç¼–è¯‘å°±ä¼šå‡ºé”™ã€‚\nlet x = 1; // ç¼–è¯‘å™¨å¯ä»¥æ¨æ–­å‡º x çš„æ•°æ®ç±»å‹ let guess: u32 = \u0026#34;42\u0026#34;.parse().expect(\u0026#34;Not a number!\u0026#34;); // \u0026#34;42\u0026#34;.parse() çš„ç»“æœå¯èƒ½å¯¹åº”å¤šç§ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ç±»å‹æ³¨è§£ åœ¨ Rust ä¸­ï¼Œæ•°æ®ç±»å‹åˆ†ä¸ºä¸¤ç±»ï¼šæ ‡é‡ç±»å‹ï¼ˆscalar typesï¼‰å’Œå¤åˆç±»å‹ï¼ˆcompound typesï¼‰\næ ‡é‡ç±»å‹ ä¸€ä¸ªæ ‡é‡ç±»å‹è¡¨ç¤ºçš„æ˜¯å•ä¸ªå€¼ã€‚Rust ä¸­æœ‰å››ç§åŸºæœ¬çš„æ ‡é‡ç±»å‹ï¼šæ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”ç±»å‹å’Œå­—ç¬¦ç±»å‹ã€‚\næ•´å‹ æ•´å‹ï¼ˆintegerï¼‰æ˜¯æ²¡æœ‰å°æ•°éƒ¨åˆ†çš„æ•°å­—ã€‚æ ¹æ®æ˜¯å¦å¯ä»¥è¡¨ç¤ºè´Ÿæ•°ï¼Œæ•´å‹åˆå¯ä»¥åˆ†ä¸ºæœ‰ç¬¦å·æ•´å‹å’Œæ— ç¬¦å·æ•´å‹ã€‚ä¸‹é¢çš„è¡¨æ ¼åˆ—å‡ºäº† Rust ä¸­çš„æ‰€æœ‰æ•´å‹ï¼š\n   Length Signed Unsigned     8-bit i8 u8   16-bit i16 u16   32-bit i32 u32   64-bit i64 u64   128-bit i128 u128   arch isize usize    å…¶ä¸­ï¼Œæœ‰ç¬¦å·æ•´å‹ä»¥å­—æ¯ i å¼€å¤´ï¼Œæ— ç¬¦å·æ•´å‹ä»¥å­—æ¯ u å¼€å¤´ã€‚i æˆ– u åé¢çš„æ•°å­—å³è¯¥ç±»å‹æ‰€å çš„äºŒè¿›åˆ¶ä½æ•°ã€‚å‡è®¾æ•´å‹çš„é•¿åº¦ä¸º n ä½ï¼Œåˆ™æœ‰ç¬¦å·æ•´å‹èƒ½è¡¨ç¤ºæ•°å€¼èŒƒå›´çš„åŒºé—´æ˜¯ $[-2^{n - 1}, 2^{n - 1} - 1]$ï¼Œè€Œæ— ç¬¦å·æ•´å‹èƒ½è¡¨ç¤ºæ•°å€¼èŒƒå›´åŒºé—´æ˜¯ $[0, 2^n - 1]$ã€‚ä¾‹å¦‚ï¼Œi8 å¯å­˜å‚¨çš„æ•°å€¼èŒƒå›´æ˜¯ [0, 255]ï¼Œè€Œ u8 å¯å­˜å‚¨çš„æ•°å€¼èŒƒå›´æ˜¯ [-128, 127]ã€‚è¡¨æ ¼ä¸­çš„ isize å’Œ usize ç±»å‹ç”±è¿è¡Œç¨‹åºçš„æœºå™¨æ¶æ„å†³å®šï¼šå¯¹äº 64 ä½æ¶æ„çš„è®¡ç®—æœºæ¥è¯´ï¼Œå®ƒä»¬å°±æ˜¯ 64 ä½çš„ï¼Œè€Œå¯¹äº 32 ä½æ¶æ„çš„è®¡ç®—æœºæ¥è¯´ï¼Œå®ƒä»¬å°±æ˜¯ 32 ä½çš„ã€‚Rust ä¸­é»˜è®¤çš„æ•´å‹æ˜¯ i32ã€‚\né™¤äº†å°†æ•´æ•°å†™æˆæœ€å¸¸è§çš„åè¿›åˆ¶å½¢å¼å¤–ï¼ŒRust è¿˜å…è®¸æˆ‘ä»¬å°†æ•°å­—å†™æˆåå…­è¿›åˆ¶ã€å…«è¿›åˆ¶ç­‰å½¢å¼ã€‚ä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥åœ¨æ•°å€¼åé¢è·Ÿä¸Šå®ƒçš„å…·ä½“ç±»å‹ï¼ˆæ¯”å¦‚ 58u8 è¡¨ç¤º u8 ç±»å‹çš„æ•°å­— 58ï¼‰ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰å¯¹æ•°å­—è¿›è¡Œåˆ†éš”ï¼ˆæ¯”å¦‚ 10_000 å°±æ˜¯æ•°å­— 10000ï¼‰ã€‚ä¸‹é¢è¡¨æ ¼åˆ—å‡ºäº† Rust ä¸­çš„å„ç§æ•´æ•°è¡¨ç¤ºæ³•ï¼Œé™¤äº†é»˜è®¤çš„åè¿›åˆ¶è¡¨ç¤ºæ³•å¤–ï¼Œå„ä¸ªè¡¨ç¤ºå½¢å¼éƒ½æœ‰ç‰¹å®šçš„å‰ç¼€ï¼š\n   Number Literals Example     Decimal 98_222   Hex 0xff   Octal 0o77   Binary 0b1111_0000   Byte(u8 only) b\u0026rsquo;A'    æµ®ç‚¹å‹ æµ®ç‚¹å‹ï¼ˆfloating-pointï¼‰æ˜¯å¸¦å°æ•°ç‚¹çš„æ•°å­—ã€‚Rust æœ‰ä¸¤ç§åŸç”Ÿçš„æµ®ç‚¹ç±»å‹ï¼šå•ç²¾åº¦æµ®ç‚¹å‹ f32ï¼ˆå  32 ä½ï¼‰å’ŒåŒç²¾åº¦æµ®ç‚¹å‹ f64ï¼ˆå  64 ä½ï¼‰ã€‚f64 æ˜¯ Rust ä¸­é»˜è®¤çš„æµ®ç‚¹ç±»å‹ã€‚ä¾‹å¦‚ï¼š\nlet x = 2.0; // f64 let y: f32 = 3.0; // f32 å’Œå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸€çœ¼ï¼ŒRust ä¸­çš„æµ®ç‚¹å‹æ˜¯ä½¿ç”¨ IEEE-754 æ ‡å‡†è¡¨ç¤ºçš„ã€‚\nå¸ƒå°”ç±»å‹ Rust ä¸­çš„å¸ƒå°”ç±»å‹æœ‰ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼štrue å’Œ falseã€‚å¸ƒå°”ç±»å‹å ä¸€ä¸ªå­—èŠ‚ï¼Œç±»å‹æ³¨è§£ä¸º boolã€‚\nå­—ç¬¦ç±»å‹ å­—ç¬¦ç±»å‹ï¼ˆcharï¼‰å  4 ä¸ªå­—èŠ‚ï¼Œå¯ä»¥è¡¨ç¤º U+0000 åˆ° U+D7FF ä¹‹é—´å’Œ U+E000 åˆ° U+10FFF ä¹‹é—´çš„ Unicode å­—ç¬¦ã€‚\nå¤åˆç±»å‹ å¤åˆç±»å‹å¯ä»¥å°†å¤šä¸ªå€¼ç»„åˆåˆ°ä¸€ä¸ªç±»å‹ä¸­ã€‚Rust å†…ç½®äº†å…ƒç»„ï¼ˆtuplesï¼‰å’Œæ•°ç»„ï¼ˆarraysï¼‰è¿™ä¸¤ç§å¤åˆç±»å‹ã€‚\nå…ƒç»„ å…ƒç»„æ˜¯ä¸€ä¸ªç”±å¤šä¸ªå€¼ç»„æˆçš„é›†åˆï¼Œæ¯ä¸ªå€¼çš„ç±»å‹å¯ä»¥ä¸åŒï¼Œå…¶é•¿åº¦åœ¨æŒ‡å®šåå°±ä¸èƒ½ä¿®æ”¹ã€‚åˆ›å»ºä¸€ä¸ªå…ƒç»„çš„æ–¹å¼å¾ˆç®€å•ï¼Œå°†å„ä¸ªå€¼ç”¨é€—å·åˆ†éš”ï¼Œæ”¾åœ¨å°æ‹¬å·å½“ä¸­å³å¯ï¼š\nlet tup: (i32, f64, u8) = (500, 6.4, 1); ä»¥ä¸Šä»£ç åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªä¸åŒç±»å‹æ•°å€¼çš„å…ƒç»„ tupã€‚é‚£ä¹ˆå¦‚ä½•è®¿é—®å…ƒç»„ä¸­çš„å…ƒç´ å‘¢ï¼ŸRust ç»™æˆ‘ä»¬æä¾›äº†ä¸¤ç§æ–¹æ³•ï¼Œå…¶ä¸­ä¸€ç§æ˜¯ä½¿ç”¨æ¨¡å¼åŒ¹é…å¯¹å…ƒç»„è¿›è¡Œè§£æ„ï¼ˆdestructureï¼‰ï¼š\nlet tup = (500, 6.4, 1); let (x, y, z) = tup; println!(\u0026#34;The value of y is: {}\u0026#34;, y); ä»¥ä¸Šä»£ç é¦–å…ˆå°†å…ƒç»„ (500, 6.4, 1) ç»‘å®šåˆ°äº†å˜é‡ tup ä¸Šï¼Œç„¶åä½¿ç”¨æ¨¡å¼ (x, y, z) å°† tup åˆ†æˆäº†ä¸‰ä¸ªä¸åŒçš„éƒ¨åˆ†ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯è§£æ„ï¼ˆdestructringï¼‰ã€‚é™¤äº†ä½¿ç”¨æ¨¡å¼åŒ¹é…è§£æ„å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ç‚¹å·ï¼ˆ.ï¼‰åŠ ç´¢å¼•çš„æ–¹å¼è®¿é—®å…ƒç»„ä¸­çš„å€¼ï¼š\nlet tup = (500, 6.4, 1); let x = tup.0; // 500 let y = tup.1; // 6.4 let z = tup.2; // 1 println!(\u0026#34;x = {}, y = {}, z = {}\u0026#34;, x, y, z); å’Œå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒRust ä¸­çš„ä¸‹æ ‡ä¹Ÿæ˜¯ä» 0 å¼€å§‹çš„ã€‚\nå…ƒç»„ç”šè‡³å¯ä»¥åŒ…å«å…ƒç»„ï¼Œä¾‹å¦‚ï¼š\nlet tuple_of_tuples = ((1u8, 2u16, 2u32), (4u64, -1i8), -2i16); å¦‚æœå…ƒç»„ä¸­åªæœ‰ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆæœ«å°¾çš„é‚£ä¸ªé€—å·æ˜¯ä¸èƒ½çœç•¥çš„ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šè®¤ä¸ºé‚£æ˜¯ä¸€ä¸ªå­—é¢é‡ã€‚\nprintln!(\u0026#34;A tuple: {:?}\u0026#34;, (5,)); // A tuple: (5,) print!(\u0026#34;An integer: {:?}\u0026#34;, (5)); // An integer: 5 ä¸åŒ…å«ä»»ä½•å€¼çš„å…ƒç»„ï¼ˆç©ºå…ƒç»„ï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹â€”â€”å•å…ƒç±»å‹ï¼ˆunit typeï¼‰ã€‚è¿™ç§æ•°æ®ç±»å‹åªæœ‰ä¸€ä¸ªå¯èƒ½çš„å€¼ï¼Œå³ ()ï¼Œå®ƒè¢«ç§°ä¸ºå•å…ƒå€¼ï¼ˆunit valueï¼‰ã€‚è™½ç„¶å•å…ƒå€¼æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å±äºå¤åˆç±»å‹ï¼Œå› ä¸ºå®ƒå¹¶ä¸åŒ…å«å¤šä¸ªå€¼ã€‚\næ•°ç»„ æ•°ç»„åªèƒ½åŒ…å«å¤šä¸ªç›¸åŒç±»å‹å¾—å€¼ï¼Œå…¶é•¿åº¦åœ¨æŒ‡å®šåä¹Ÿä¸èƒ½ä¿®æ”¹ã€‚åˆ›å»ºä¸€ä¸ªæ•°ç»„çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œå°†å„ä¸ªå€¼ç”¨é€—å·åˆ†éš”ï¼Œç„¶åæ”¾åˆ°ä¸­æ‹¬å·å½“ä¸­å³å¯ï¼š\nlet arr = [1, 2, 3]; æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹æ ‡è®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ ï¼š\nlet arr = [1, 2, 3]; let x = arr[0]; // 1 let y = arr[1]; // 2 let z = arr[2]; // 3 println!(\u0026#34;x = {}, y = {}, z = {}\u0026#34;, x, y, z); æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å£°æ˜æ•°ç»„çš„æ—¶å€™æ˜¾å¼ç»™å‡ºæ•°ç»„å…ƒç´ çš„ç±»å‹å’Œæ•°ç»„é•¿åº¦ï¼Œä¾‹å¦‚ï¼š\nlet arr: [i32; 3] = [1, 2, 3]; ä»¥ä¸Šä»£ç å£°æ˜äº†ä¸€ä¸ªé•¿åº¦ä¸º 3 çš„æ•°ç»„ [1, 2, 3]ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ ç±»å‹ä¸º i32ã€‚\næ­¤å¤–ï¼ŒRust è¿˜ç»™æˆ‘ä»¬æä¾›äº†å°†æ•°ç»„åˆå§‹åŒ–ä¸ºç›¸åŒå€¼çš„ç®€ä¾¿å†™æ³•ï¼š\nlet arr = [1; 3]; ä»¥ä¸Šä»£ç å£°æ˜äº†ä¸€ä¸ªé•¿åº¦ä¸º 3 çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ éƒ½æ˜¯ 1ã€‚è¯¥å†™æ³•ç­‰ä»·äºï¼šlet arr = [1, 1, 1]ã€‚\nè‡ªå®šä¹‰æ•°æ®ç±»å‹ Rust å½“ç„¶æ”¯æŒæˆ‘ä»¬åˆ›å»ºè‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œåˆ›å»ºè‡ªå®šä¹‰æ•°æ®ç±»å‹çš„ä¸»è¦é€”å¾„æœ‰ä¸¤ç§ï¼š\n ä½¿ç”¨ enum å®šä¹‰æšä¸¾ç±» ä½¿ç”¨ struct å®šä¹‰ç»“æ„ä½“  ç±»å‹è½¬æ¢ åŸºæœ¬ç±»å‹ä¹‹é—´çš„ç±»å‹è½¬æ¢ Rust æ˜¯ä¸å…è®¸åŸºæœ¬ç±»å‹çš„æ•°æ®ä¹‹é—´è¿›è¡Œéšå¼ç±»å‹è½¬æ¢çš„ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ as å…³é”®å­—æ˜¾å¼è¦æ±‚è¿›è¡Œæ•°æ®è½¬æ¢ã€‚ä¾‹å¦‚ï¼š\nlet decimal = 6.5; // Error! No implicit conversion // let integer: u8 = decimal; let integer = decimal as u8; let character = integer as char; Rust ç®¡åŸºæœ¬ç±»å‹æ•°æ®ä¹‹é—´çš„ç±»å‹è½¬æ¢å« Castingã€‚\nè‡ªå®šä¹‰ç±»å‹æ•°æ®ä¹‹é—´çš„ç±»å‹è½¬æ¢ åœ¨ Rust ä¸­ï¼Œè‡ªå®šä¹‰ç±»å‹æ•°æ®ä¹‹é—´çš„ç±»å‹è½¬æ¢æ˜¯é€šè¿‡ä½¿ç”¨ traits å®ç°çš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨çš„ traits æ˜¯ From å’Œ Intoã€‚å¦‚æœè½¬æ¢å¯èƒ½å¤±è´¥ï¼Œåˆ™ä½¿ç”¨ TryFrom å’Œ TryInto ä¼šæ›´åˆé€‚ã€‚æ­¤å¤–ï¼Œæ•°æ®ç±»å‹å’Œå­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢ä½¿ç”¨çš„ traits æ˜¯ FromStr å’Œ ToStringã€‚\nRust ç®¡è‡ªå®šä¹‰ç±»å‹æ•°æ®ä¹‹é—´çš„ç±»å‹è½¬æ¢å« Conversionã€‚\nç±»å‹åˆ«å Rust å…è®¸æˆ‘ä»¬ä½¿ç”¨ type å…³é”®å­—ç»™å·²å­˜åœ¨çš„æ•°æ®ç±»å‹è®¾ç½®æ–°çš„åå­—ï¼ˆaliasï¼‰ã€‚å¦‚æœæ–°çš„åå­—ä¸æ˜¯é©¼å³°å‘½åçš„ï¼Œç¼–è¯‘å™¨ä¼šå‘å‡ºè­¦å‘Šï¼Œä½†ç¼–è¯‘è¿˜æ˜¯ä¼šé€šè¿‡ã€‚å¦‚æœä¸æƒ³è®©ç¼–è¯‘å™¨å‘å‡ºè­¦å‘Šï¼Œå¯ä»¥ä½¿ç”¨ #[allow(non_camel_case_types)] å±æ€§ã€‚ç±»å‹åˆ«åå¹¶ä¸æ˜¯æ–°çš„æ•°æ®ç±»å‹ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªåˆ«åè€Œå·²ã€‚ç±»å‹åˆ«åä¸»è¦ç”¨äºå‡å°‘æ ·æ¿ä»£ç ï¼Œæ¯”å¦‚ IoResult\u0026lt;T\u0026gt; å°±æ˜¯ Result\u0026lt;T, IoError\u0026gt; çš„ä¸€ä¸ªåˆ«åã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ç±»å‹åˆ«åçš„ä¾‹å­ï¼š\nype NanoSecond = u64; type Inch = u64; #[allow(non_camel_case_types)] type u64_t = u64; // NanoSecond, Inch and u64_t are the same type as u64 å‚è€ƒèµ„æ–™  Steve Klabnik, Carol Nichols. The Rust Programming Language. Rust by Example.  ","href":"/rust/rust_basics_variables_and_data_types/","title":"Rust åŸºç¡€ï¼šå˜é‡ä¸æ•°æ®ç±»å‹"},{"content":" å¹´åˆå­¦è¿‡å‡ å¤© Rustï¼Œèµ°é©¬è§‚èŠ±ï¼Œå¾ˆå¿«å°±å¿˜å®Œäº†ã€‚ç°åœ¨æœ‰äº†äº›ç©ºé—²æ—¶é—´ï¼Œå‡†å¤‡é‡æ–°å¥½å¥½åœ°æŠŠ Rust å­¦ä¸€éï¼Œä¸ºåç»­æ“ä½œç³»ç»Ÿçš„æ·±å…¥å­¦ä¹ åšå¥½é“ºå«ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä¸»è¦å†™ Javaï¼Œå‡ ä¹æ‰€æœ‰çš„ Java å¼€å‘è€…éƒ½æœ‰è¿‡å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰æˆ–å†…å­˜æ³„éœ²çš„å™©æ¢¦ã€‚ä¸ºäº†é¿å…å„ç§å†…å­˜é—®é¢˜ï¼ŒJava å¼€å‘è€…é€šå¸¸éœ€è¦ç†Ÿæ‚‰åƒåœ¾å›æ”¶ï¼Œä»¥åŠå¦‚ä½•è¿›è¡Œåƒåœ¾æ”¶é›†å™¨çš„è°ƒä¼˜ã€‚å½“æˆ‘ç¬¬ä¸€æ¬¡é‡åˆ° Rust çš„æ—¶å€™ï¼Œå°±è¢« Rust æƒŠäººçš„è¿è¡Œé€Ÿåº¦å’Œæé«˜çš„å†…å­˜åˆ©ç”¨ç‡æ‰€å¸å¼•ï¼Œè¿™é—¨è¯­è¨€å±…ç„¶æ²¡æœ‰è¿è¡Œæ—¶ï¼ˆruntimeï¼‰å’Œåƒåœ¾å›æ”¶å™¨ï¼ˆgarbage collectorï¼‰ï¼Œå¤šä¹ˆåœ°ç¥å¥‡ï¼\n å®‰è£… Rust å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„æœ€ä½³æ–¹å¼å°±æ˜¯å®è·µã€‚åœ¨å®è·µä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡å¥½ç›¸åº”çš„å¼€å‘ç¯å¢ƒã€‚Rust æ¨èæˆ‘ä»¬ä½¿ç”¨ rustup å®‰è£… Rustã€‚rustup æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† Rust ç‰ˆæœ¬å’Œç›¸å…³çš„å…¶å®ƒå·¥å…·ã€‚åœ¨ Windows å¹³å°ä¸Šï¼Œæˆ‘åªéœ€è¦å…ˆä¸‹è½½ rustupï¼Œè¿è¡Œå®ƒï¼Œç„¶åæ ¹æ®æç¤ºä¸€æ­¥ä¸€æ­¥æ“ä½œå³å¯ã€‚é™¤äº† rustupï¼Œè¿˜æœ‰å¾ˆå¤šå…¶å®ƒçš„å®‰è£…æ–¹æ³•ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\nå®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ rustc --version æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸã€‚è‹¥æ§åˆ¶å°è¾“å‡ºäº† rustc x.y.z (abcabcabc yyyy-mm-dd) å½¢å¼çš„ç‰ˆæœ¬å·ï¼Œåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚\nrustup rustup æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šå®ç”¨çš„åŠŸèƒ½ã€‚\n æ›´æ–° Rust åˆ°æœ€æ–°ç‰ˆæœ¬ï¼šrustup update å¸è½½ Rust å’Œ rustupï¼šrustup self uninstall æŸ¥çœ‹ Rust çš„æœ¬åœ°æ–‡æ¡£ï¼šrustup doc  Hello, world! ä»å¤§å­¦çš„ C/C++ï¼Œåˆ°åæ¥çš„ Javaã€Pythonï¼Œæˆ‘ä»¬å­¦ä¹ ä¸€é—¨æ–°çš„ç¼–ç¨‹è¯­è¨€å‡ ä¹éƒ½æ˜¯ä»â€œHello, world!â€å¼€å§‹ã€‚ä¸‹é¢æ¥å†™ä¸€ä¸ª Rust ç‰ˆæœ¬çš„â€œHello, world!â€ã€‚\nä¸ºäº†ç»„ç»‡å¥½ä»£ç ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†ä¸åŒçš„ä»£ç æ”¾åˆ°ä¸åŒçš„æ–‡ä»¶å¤¹ä¸­ã€‚å…ˆç»™â€œHello, world!â€åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ hello_worldï¼š\n\u0026gt; mkdir hello_world \u0026gt; cd hello_world ç°åœ¨ï¼Œåˆ›å»º Rust çš„æºä»£ç æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ç®¡å®ƒå« hello_world.rsã€‚Rust çš„æºä»£ç æ–‡ä»¶æ€»æ˜¯ä»¥ .rs ç»“å°¾ï¼Œå¦‚æœæ–‡ä»¶ååŒ…å«ä¸æ­¢ä¸€ä¸ªå•è¯ï¼Œå»ºè®®ä½¿ç”¨ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰åˆ†éš”ã€‚\nfn main() { println!(\u0026#34;Hello, world!\u0026#34;); } è¿™å°±æ˜¯ Rust ç‰ˆæœ¬çš„â€œHello, world!â€æºä»£ç ï¼Œå’Œ Java æ¯”èµ·æ¥ï¼Œç®€å•äº†å¤ªå¤šã€‚ä¸‹ä¸€æ­¥è¦åšçš„å°±æ˜¯ç¼–è¯‘æºæ–‡ä»¶å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åè¿è¡Œï¼š\n\u0026gt; rustc hello_world.rs \u0026gt; ./hello_world.exe Hello, world! åˆ°æ­¤ï¼Œæˆ‘ä»¬â€œHello, world!â€å°±å…¨éƒ¨å®Œæˆäº†ã€‚\nHello, world! è¯¦è§£ â€œHello, world!â€ è™½ç„¶åªæœ‰çŸ­çŸ­ä¸‰è¡Œï¼Œä½†éº»é›€è™½å°ï¼Œäº”è„ä¿±å…¨ã€‚å®ƒåŒ…å«äº†ä¸€ä¸ªç®€å• Rust ç¨‹åºå¿…è¦çš„ç»„æˆéƒ¨åˆ†ã€‚é¦–å…ˆæ˜¯\nfn main() { } è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª Rust å‡½æ•°ã€‚å’Œå¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œmain å‡½æ•°æœ‰ç€ç‰¹æ®Šçš„åœ°ä½ï¼Œå®ƒæ˜¯ Rust ç¨‹åºçš„æ‰§è¡Œå…¥å£ã€‚æˆ‘ä»¬çš„â€œHello, world!â€ ä¸­çš„ main å‡½æ•°æ˜¯æ²¡æœ‰å‚æ•°çš„ï¼Œå¦‚æœä½ éœ€è¦å‚æ•°ï¼ŒæŠŠå®ƒä»¬æ”¾åˆ° () ä¸­å³å¯ã€‚å‡½æ•°ä½“è¢«åŒ…è£¹åœ¨ {} ä¸­ï¼ŒRust ä¸­ä¹ æƒ¯å°† { æ”¾åœ¨å‡½æ•°å®šä¹‰çš„åŒä¸€è¡Œï¼Œä¸­é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚\n å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿‡äºåœ¨æ„ä»£ç çš„é£æ ¼ã€‚å› ä¸º Rust ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªä»£ç è‡ªåŠ¨æ ¼å¼åŒ–å·¥å…·â€”â€”rustfmtï¼Œå®ƒæ˜¯éšç€ Rust çš„åˆ†å‘åŒ…ä¸€èµ·å‘å¸ƒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ çš„ç”µè„‘ä¸Šå·²ç»æœ‰å®ƒäº†ã€‚\n åœ¨ main å‡½æ•°å†…éƒ¨æœ‰ä¸€è¡Œä»£ç ï¼š\nprintln!(\u0026#34;Hello, world!\u0026#34;); è¿™è¡Œä»£ç æ­£æ˜¯æ•´ä¸ªâ€œHello, world!â€çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒå°†â€œHello, world!â€æ‰“å°åˆ°äº†æˆ‘ä»¬çš„å±å¹•ä¸Šã€‚å®ƒåŒ…å«äº†å››ä¸ªå€¼å¾—æˆ‘ä»¬æ³¨æ„çš„ç‚¹ï¼š\n Rust style çš„ç¼©è¿›æ˜¯å››ä¸ªç©ºæ ¼ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª TAB println! è°ƒç”¨äº† Rust å®ï¼ˆmacroï¼‰ã€‚å¦‚æœæ˜¯è°ƒç”¨æ™®é€šå‡½æ•°çš„è¯ï¼Œæ˜¯æ²¡æœ‰åé¢é‚£ä¸ª ! çš„ï¼Œè¿™å°±æ˜¯è°ƒç”¨å®ä¸æ™®é€šå‡½æ•°çš„åŒºåˆ« \u0026quot;Hello, world!\u0026quot; æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å°†å®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™ println!ï¼Œæœ€ç»ˆè¢«è¾“å‡ºåˆ°äº†å±å¹•ä¸Š ä»£ç ä¸Šçš„æœ«å°¾æœ‰ä¸€ä¸ª ;ï¼Œä»£è¡¨ç€å½“å‰è¡¨è¾¾å¼ç»“æŸï¼Œå®ƒåé¢å°±æ˜¯ä¸€ä¸ªæ–°çš„è¡¨è¾¾å¼äº†  é™¤äº†å®ä¸å‡½æ•°å¤–ï¼Œå‰©ä½™ä¸‰ä¸ªéƒ¨åˆ†éƒ½å’Œ Java ç­‰ç¼–ç¨‹è¯­è¨€ç±»ä¼¼ã€‚\nä»ç¼–è¯‘åˆ°è¿è¡Œ Rust æ˜¯ä¸€ç§ é¢„ç¼–è¯‘ï¼ˆahead-of-time compiledï¼‰ è¯­è¨€ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç¼–è¯‘å‡ºæ¥çš„ Rust ç¨‹åºç›´æ¥äº¤ç»™åˆ«äººï¼Œä»–ä»¬ä¸éœ€è¦å®‰è£… Rust å°±å¯ä»¥ç›´æ¥è¿è¡Œã€‚ä¸ Python å’Œ JavaScript ç­‰å°†ç¼–è¯‘å’Œè¿è¡Œæ”¾åœ¨ä¸€èµ·çš„åŠ¨æ€è¯­è¨€ä¸åŒï¼ŒRust ä¸­ç¼–è¯‘å’Œè¿è¡Œæ˜¯åˆ†å¼€çš„ä¸¤ä¸ªæ­¥éª¤ã€‚åœ¨â€œHello, world!â€ä¸­ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡ Rust çš„ç¼–è¯‘å™¨ rustc ç¼–è¯‘æºä»£ç ï¼š\n\u0026gt; rustc hello_world.rs åœ¨ Windows ä¸Šï¼Œå¦‚æœç¼–è¯‘æˆåŠŸï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶ï¼š hello_world.exeå’Œ hello_world.pdbã€‚å…¶ä¸­ï¼Œhello_world.exe æ˜¯ Windows å¹³å°ä¸Šçš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œhello_world.pdb åˆ™æ˜¯é’ˆå¯¹ Windows åˆ›å»ºçš„æ–‡ä»¶ï¼Œå®ƒåŒ…å«ç¬¦å·ï¼ˆsymbolï¼‰ã€ç±»å‹ï¼ˆtypeï¼‰å’Œæ¨¡å—ï¼ˆmoduleï¼‰ç­‰è°ƒè¯•ä¿¡æ¯ã€‚pdb å³â€œProgram Databaseâ€ã€‚\nåœ¨ Linux ä¸Šï¼Œå¦‚æœç¼–è¯‘æˆåŠŸï¼Œåˆ™åªä¼šå¾—åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼šhello_worldã€‚\nä¸ç®¡æ˜¯ Windows ä¸Šçš„ hello_world.exeï¼Œè¿˜æ˜¯ Linux ä¸Šçš„ hello_worldï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æŠŠå®ƒä»¬ç›´æ¥æ”¾åˆ°å¦ä¸€å°æ²¡æœ‰å®‰è£… Rust çš„æœºå™¨ä¸Šè¿è¡Œã€‚è¿™å°±æ˜¯ Rust æ²¡æœ‰è¿è¡Œæ—¶ï¼ˆruntimeï¼‰çš„å…·ä½“ä½“ç°ã€‚ä¸ä¹‹ç›¸å¯¹çš„ Java è¯­è¨€å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œæˆ‘ä»¬å…ˆå°† Java çš„æºä»£ç æ–‡ä»¶ .java ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ .classï¼Œå†ä½¿ç”¨ java å‘½ä»¤è¿è¡Œç¼–è¯‘å­—èŠ‚ç æ–‡ä»¶ã€‚è¿™å°±è¦æ±‚ç›®æ ‡æœºå™¨ä¸Šå®‰è£…æœ‰ JREï¼ˆJava Runtime Environmentï¼‰ã€‚\nCargo å¦‚æœç¨‹åºå¾ˆç®€å•ï¼Œä½¿ç”¨ rustc å°±èƒ½è½»æ˜“åº”ä»˜ã€‚ä½†æ˜¯ï¼Œéšç€é¡¹ç›®çš„å¢é•¿ï¼Œé¡¹ç›®çš„æ–¹æ–¹é¢é¢éƒ½éœ€è¦è¢«ç®¡ç†ï¼Œè¿™æ—¶ rustc å°±éš¾ä»¥èƒœä»»äº†ã€‚æ‰€ä»¥ï¼ŒRust ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå·¥å…·â€”â€”Cargoã€‚Cargo æ˜¯ Rust çš„ç¨‹åºæ„å»ºç³»ç»Ÿå’ŒåŒ…ç®¡ç†å™¨ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®Œæˆæ„å»ºä»£ç ã€ä¸‹è½½ä¾èµ–ç­‰ä»»åŠ¡ã€‚Cargo ä¹‹äº Rust å°±åƒ Maven æˆ– Gradle ä¹‹äº Javaã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œå®‰è£… Rust çš„æ—¶å€™ä¹Ÿä¼šä¸€å¹¶å®‰è£… Cargoï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ cargo æ˜¯å¦è¢«æ­£ç¡®å®‰è£…ï¼š\n\u0026gt; cargo --version ä½¿ç”¨ cargo åˆ›å»ºæ–°é¡¹ç›® ä½¿ç”¨ cargo åˆ›å»ºæ–°é¡¹ç›®çš„æ“ä½œå°¤ä¸ºç®€å•ã€‚\n\u0026gt; cargo new hello_cargo \u0026gt; cd hello_cargo åœ¨ hello_cargo æ–‡ä»¶å¤¹å†…ï¼ŒCargo é»˜è®¤ä¸ºæˆ‘ä»¬ç”Ÿæˆäº† .git ç›®å½•å’Œ .gitignoreã€æºä»£ç ç›®å½• src ä»¥åŠ Cargo çš„é…ç½®æ–‡ä»¶ Cargo.tomlã€‚æºä»£ç ç›®å½• src é‡Œé¢æœ‰ä¸€ä¸ªæ–‡ä»¶å« main.rsï¼Œå®ƒçš„å†…å®¹å’Œå‰æ–‡çš„ hello_world.rs ä¸€è‡´ã€‚Cargo æœŸæœ›æ‰€æœ‰çš„æºä»£ç æ–‡ä»¶éƒ½ä½äº src ç›®å½•å†…ï¼Œé¡¹ç›®çš„æ ¹ç›®å½•ä¸­ä¸€èˆ¬æ˜¯é…ç½®æ–‡ä»¶ã€READMEã€LICENSE ç­‰ä¸æºä»£ç æ— å…³çš„æ–‡ä»¶ã€‚\næˆ‘ä»¬è¦é‡ç‚¹å…³æ³¨çš„æ˜¯ Cargo.tomlï¼Œæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š\n[package] name = \u0026#34;hello_cargo\u0026#34; version = \u0026#34;0.1.0\u0026#34; edition = \u0026#34;2018\u0026#34; # See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html [dependencies] .toml æ˜¯ä¸€ç§æ–‡ä»¶æ ¼å¼ï¼Œå®ƒé€šè¿‡ç‰‡æ®µï¼ˆsectionï¼‰ç»„ç»‡æ–‡ä»¶å†…å®¹ã€‚æˆ‘ä»¬çš„ Cargo.toml å°±åŒ…å« [package] å’Œ [dependencies] ä¸¤ä¸ªç‰‡æ®µã€‚å…¶ä¸­ï¼Œ[package] ä¸‹é¢ç½—åˆ—çš„æ˜¯å½“å‰åŒ…çš„é…ç½®ä¿¡æ¯ï¼Œè¿™é‡ŒåŒ…æ‹¬é¡¹ç›®åç§°ï¼ˆnameï¼‰ã€ç‰ˆæœ¬ï¼ˆversionï¼‰å’Œ Rust ç‰ˆæœ¬ï¼ˆeditionï¼‰ï¼›[dependencies] ä¸‹é¢ç½—åˆ—çš„åˆ™æ˜¯é¡¹ç›®çš„ä¾èµ–ã€‚åœ¨ Rust ä¸­ï¼Œä»£ç åŒ…è¢«ç§°ä¸º cratesã€‚ç”±äº hello_cargo ä¸éœ€è¦ä»»ä½•ä¾èµ–ï¼ˆcratesï¼‰ï¼Œæ‰€ä»¥ [dependencies] ä¸‹é¢æ˜¯ç©ºçš„ã€‚\næ„å»ºå¹¶è¿è¡Œ Cargo é¡¹ç›® æ„å»º Cargo é¡¹ç›®çš„å‘½ä»¤æ˜¯ï¼š\n\u0026gt; cargo build ä»¥ hello_cargo ä¸ºä¾‹ï¼Œåœ¨ Windows ä¸Šæ‰§è¡Œ cargo build ä¹‹åï¼Œé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ä¼šå¤šå‡ºä¸€ä¸ª target æ–‡ä»¶å¤¹å’Œä¸€ä¸ª Cargo.lock æ–‡ä»¶ã€‚ä½ ä¼šå‘ç° target ä¸‹æœ‰ä¸€å¤§å †æ–‡ä»¶ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†æ–‡ä»¶éƒ½ä¸æ˜¯å¤ªé‡è¦ï¼ŒçœŸæ­£çš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ target/debug/hello_cargo.exeã€‚\n\u0026gt; ./target/debug/hello_cargo.exe Hello, world! Cargo.lock æ˜¯ç¬¬ä¸€æ¬¡è¿è¡Œ cargo build æ‰ä¼šåˆ›å»ºçš„æ–‡ä»¶ï¼ŒCargo ç”¨å®ƒæ¥è·Ÿè¸ªé¡¹ç›®ä¸­ä¾èµ–çš„å…·ä½“ç‰ˆæœ¬ã€‚è¿™ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ç»™ Cargo è‡ªå·±ä½¿ç”¨çš„ï¼Œæˆ‘ä»¬ä¸åº”è¯¥å»ç¼–è¾‘å®ƒã€‚\né™¤äº†å…ˆæ‰‹åŠ¨æ„å»ºé¡¹ç›®å†æ‰‹åŠ¨è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶å¤–ï¼ŒCargo è¿˜ç»™æˆ‘ä»¬æä¾›äº†ä¸€æ¡å¯ä»¥è‡ªåŠ¨æ„å»ºå¹¶è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶çš„å‘½ä»¤â€”â€”cargo runã€‚\nä½¿ç”¨ cargo check æ£€æŸ¥é”™è¯¯ Cargo è¿˜ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå« cargo check çš„å‘½ä»¤ï¼Œå®ƒä¼šåˆ†æå½“å‰åŒ…å†…çš„ä»£ç å¹¶æŠ¥å‘Šé”™è¯¯ï¼Œä½†å¹¶ä¸ä¼šäº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œcargo check çš„æ‰§è¡Œé€Ÿåº¦æ¯” cargo build è¦å¿«å¾—å¤šã€‚å¦‚æœä½ ç»å¸¸åœ¨ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¸­é€šè¿‡ç¼–è¯‘æ¥æ£€æŸ¥ä»£ç é—®é¢˜ï¼Œé‚£ä¹ˆ cargo check ç»å¯¹ä¼šæˆä¸ºä½ åŠ é€Ÿå¼€å‘çš„å¥½å¸®æ‰‹ã€‚å¾ˆå¤š Rustaceans éƒ½åœ¨ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¸­å®šæœŸè¿è¡Œ cargo checkï¼Œç¡®ä¿ä»£ç å¯ä»¥æ­£å¸¸ç¼–è¯‘ã€‚å½“ä»–ä»¬å‡†å¤‡å¥½è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œæ‰ä¼šä½¿ç”¨ cargo buildã€‚\nprofiles Cargo ç»™æˆ‘ä»¬æä¾›äº†ä¸¤ç§ profileï¼Œç”¨äºä¸åŒåœºæ™¯ä¸‹çš„ç¨‹åºæ„å»ºï¼š\n Default Profileï¼šç”¨äºå¼€å‘ç¯å¢ƒï¼Œcargo build é»˜è®¤é€‰é¡¹ \u0026ndash;release Profileï¼šç”¨äºå‘å¸ƒé¡¹ç›®ï¼Œéœ€è¦é€šè¿‡ cargo build --release æ˜¾å¼æŒ‡å‡º  åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›ç¼–è¯‘å°½å¯èƒ½å¿«ï¼Œè¿™æ ·æˆ‘ä»¬èƒ½å¤Ÿæ›´å¿«åœ°è¿›è¡ŒéªŒè¯ï¼Œæ‰€ä»¥ cargo build é»˜è®¤ä¼šç”Ÿæˆå¼€å‘ç”¨è¿‡ç¨‹ä½¿ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨ cargo build --release æ„å»ºå‘å¸ƒé¡¹ç›®æ—¶ï¼ŒCargo ä¼šåœ¨ç¼–è¯‘å‘å¸ƒç‰ˆæœ¬çš„è¿‡ç¨‹ä¸­è¿›è¡Œä¸€ç³»åˆ—ä¼˜åŒ–ã€‚è¿™äº›ä¼˜åŒ–ä¼šä½¿å¾—ä½ çš„ Rust ç¨‹åºè¿è¡Œå¾—æ›´å¿«ï¼Œä½†æ˜¯ä¼šæ¶ˆè€—æ›´å¤šçš„ç¼–è¯‘æ—¶é—´ã€‚ç¨‹åºçš„æœ€ç»ˆç”¨æˆ·é€šå¸¸å¸Œæœ›ç¨‹åºè¿è¡Œå°½å¯èƒ½åœ°å¿«ï¼Œè¿™æ­£æ˜¯æ˜¯ cargo build --realease èŠ±æ›´å¤šç¼–è¯‘æ—¶é—´è¿›è¡Œä¼˜åŒ–çš„åŸå› ã€‚\nä¸åŒ profile æ„å»ºå‡ºæ¥çš„æœ€ç»ˆæ–‡ä»¶å­˜æ”¾ä½ç½®æ˜¯ä¸ä¸€æ ·çš„ã€‚cargo build ç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶ä½äº target/debug ç›®å½•ä¸‹ï¼Œè€Œcargo build --release ç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶ä½äº target/release ç›®å½•ä¸‹ã€‚\nå‚è€ƒèµ„æ–™  Steve Klabnik, Carol Nichols. The Rust Programming Language.  ","href":"/rust/hello_rust/","title":"Hello, Rust!"},{"content":"","href":"/categories/java/","title":"Java"},{"content":"ä¸€è°ˆåˆ°åŸå­ç±»ï¼ˆæˆ–åŸå­å˜é‡ï¼‰ï¼Œæˆ‘ä»¬å¯èƒ½å°±ä¼šæƒ³çŸ¥é“å®ƒå’Œæˆ‘ä»¬ç¼–ç¨‹ä¸­å¸¸è¯´çš„åŸå­æ€§ï¼ˆAtomicyï¼‰ä¹‹é—´æ˜¯å¦æœ‰å…³ç³»ã€‚è‹¥ä¸€ç»„æ“ä½œå…·å¤‡â€œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸èƒ½ä¸€éƒ¨åˆ†æˆåŠŸä¸€éƒ¨åˆ†å¤±è´¥â€çš„æ€§è´¨ï¼Œé‚£ä¹ˆè¿™ç»„æ“ä½œå°±æ˜¯åŸå­æ“ä½œï¼Œè¿™ç»„æ“ä½œå…·å¤‡åŸå­æ€§ã€‚\nåœ¨ Java ä¸­ï¼ŒåŸå­æ“ä½œå¯ä»¥é€šè¿‡é”å’Œå¾ªç¯ CAS çš„æ–¹å¼å®ç°ã€‚å…¶ä¸­ CAS æ“ä½œæ˜¯åˆ©ç”¨å¤„ç†å™¨æä¾›çš„ COMPXCHG æŒ‡ä»¤å®ç°çš„ã€‚è‡ªæ—‹ CAS å®ç°çš„åŸºæœ¬æ€è·¯æ˜¯å¾ªç¯è¿›è¡Œ CAS æ“ä½œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚ä½† CAS å­˜åœ¨ä¸‰ä¸ªé—®é¢˜ï¼š\n ABAé—®é¢˜ã€‚å¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æ¥è§£å†³ã€‚ å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§ã€‚è¿™ä¸€èˆ¬å‡ºç°åœ¨è‡ªæ—‹CASé•¿æ—¶é—´ä¸æˆåŠŸçš„æƒ…å†µä¸‹ã€‚ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œã€‚å¯¹äºå¤šä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œï¼Œä¸€èˆ¬é‡‡ç”¨é”æ¥è§£å†³ï¼Œä¹Ÿå¯ä»¥å°†å¤šä¸ªå…±äº«å˜é‡å°è£…è¿›ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åä½¿ç”¨AtomicReferenceç±»æ¥è§£å†³ã€‚  JVM å†…éƒ¨å®ç°äº†å¾ˆå¤šé”æœºåˆ¶ï¼Œæœ‰æ„æ€çš„æ˜¯é™¤äº†åå‘é”ï¼ŒJVM å®ç°é”çš„æ–¹å¼éƒ½ç”¨äº†å¾ªç¯ CASï¼Œå³å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—æ—¶ä½¿ç”¨å¾ªç¯ CAS è·å–é”ï¼Œç¦»å¼€åŒæ­¥ä»£ç å—æ—¶ä½¿ç”¨å¾ªç¯ CAS é‡Šæ”¾é”ã€‚CAS æœ€ç›´æ¥çš„ä½“ç°å°±æ˜¯ java.util.concurrent.atomic åŒ…ä¸‹å®šä¹‰çš„å„ç§æ— é”åŸå­ç±»ï¼Œè¿™äº›åŸå­ç±»éƒ½æ”¯æŒå•ä¸ªå˜é‡ä¸Šçš„åŸå­æ“ä½œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œi++ åœ¨å¹¶å‘ç¯å¢ƒä¸­å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬éœ€è¦ç»™ i++ åŠ é”ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨åŸå­ç±»æä¾›çš„ getAndIncrement æ–¹æ³•å®ŒæˆåŒæ ·çš„æ“ä½œã€‚ç”±äºåŸå­ç±»åº•å±‚é‡‡ç”¨çš„ CAS å®ç°ï¼Œåœ¨å¹¶å‘ç«äº‰ä¸æ˜¯ç‰¹åˆ«æ¿€çƒˆçš„æƒ…å†µä¸‹ï¼Œæ•ˆç‡è¦é«˜äºåŒæ­¥äº’æ–¥é”ã€‚\næ ¹æ®æ“ä½œç±»å‹çš„ä¸åŒï¼Œå¯ä»¥å¤§è‡´å°† java.util.concurrent.atomic ä¸‹çš„åŸå­ç±»åˆ†æˆå…­ç§ï¼š\n   ç±»å‹ å…·ä½“ç±»     åŸºæœ¬ç±»å‹åŸå­ç±»ï¼ˆAtomicXxxï¼‰ AtomicInteger, AtomicLong, AtomicBoolean   å¼•ç”¨ç±»å‹åŸå­ç±»ï¼ˆAtomicXxxReferenceï¼‰ AtomicReference, AtomicStampedReference, AtomicMarkableReference   æ•°ç»„ç±»å‹åŸå­ç±»ï¼ˆAtomicXxxArrayï¼‰ AtomicIntegerArray, AtomicLongArray, AtomicReferenceArray   å­—æ®µæ›´æ–°åŸå­ç±»ï¼ˆAtomicXxxFieldUpdaterï¼‰ AtomicIntegerFieldUpdater, AtomicLongFieldUpdater, AtomicReferenceFieldUpdater   åŠ æ³•å™¨ï¼ˆAdderï¼‰ LongAdder, DoubleAdder   ç´¯åŠ å™¨ï¼ˆAccumulatorï¼‰ LongAccumulator, DoubleAccumulator    ä¸‹é¢åˆ†åˆ«æœ€è¿™å…­å¤§ç±»å‹çš„åŸå­ç±»è¿›è¡Œä»‹ç»ã€‚\nåŸºæœ¬ç±»å‹åŸå­ç±» åŸºæœ¬ç±»å‹åŸå­ç±»åŒ…æ‹¬ä¸‰ç§ï¼šAtomicIntegerã€AtomicLong å’Œ AtomicBooleanã€‚å…¶ä¸­ AtomicInteger å’Œ AtomicLong æ˜¯å¯¹ intã€long çš„å°è£…ï¼Œè€Œ AtomicBoolean å†…éƒ¨å°è£…çš„å˜é‡çš„ç±»å‹å¹¶ä¸æ˜¯ booleanï¼Œè€Œæ˜¯ intï¼Œå®ƒç”¨ 0 å’Œ 1 åˆ†åˆ«è¡¨ç¤º false å’Œ trueã€‚ä¸‰ç§ç±»å‹éƒ½æä¾›äº†å¯¹å†…éƒ¨å°è£…å˜é‡çš„åŸå­æ€§è®¿é—®å’Œæ›´æ–°æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¹¶å‘ç¯å¢ƒä¸­æ”¾å¿ƒä½¿ç”¨ã€‚\nä»¥ AtomicInteger ä¸ºä¾‹ï¼Œå®ƒç»™æˆ‘ä»¬æä¾›çš„å¸¸ç”¨æ–¹æ³•æœ‰ï¼š\n get()ï¼šè·å–å°è£…å˜é‡çš„å½“å‰å€¼ getAndSet(int newValue)ï¼šè·å–å°è£…å˜é‡çš„å½“å‰å€¼ï¼Œç„¶åå°†å˜é‡çš„å€¼è®¾ç½®ä¸ºæ–°çš„å€¼ getAndIncrement()ï¼šè·å–å°è£…å˜é‡çš„å½“å‰å€¼ï¼Œç„¶åå°†å˜é‡çš„å€¼åŠ ä¸€ getAndDecrement()ï¼šè·å–å°è£…å˜é‡çš„å½“å‰å€¼ï¼Œç„¶åå°†å˜é‡çš„å€¼å‡ä¸€ getAndAdd(int delta)ï¼šè·å–å°è£…å˜é‡çš„å½“å‰å€¼ï¼Œç„¶åå°†å˜é‡çš„å€¼åŠ ä¸Š delta compareAndSet(int expectedValue, int newValue)ï¼šå¦‚æœå°è£…å˜é‡çš„å½“å‰å€¼ä¸º expectedValueï¼Œåˆ™åŸå­æ€§åœ°å°†å˜é‡çš„å€¼è®¾ç½®ä¸º newValueã€‚è¿™ä¸ªæ–¹æ³•å°±æ˜¯åŸå­ç±» CAS çš„å…·ä½“ä½“ç°ã€‚  AtomicInteger å…¶å®è¿˜ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šå®ç”¨çš„æ–¹æ³•ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚AtomicLong å’Œ AtomicBoolean æä¾›çš„æ–¹æ³•ä¹Ÿä¸ AtomicInteger ç±»ä¼¼ï¼Œè¿™äº›åŸå­ç±»çš„å†…éƒ¨éƒ½ä¾èµ– JDK æä¾›çš„ Unsafe ç±»ï¼Œå®ƒæä¾›äº†ç¡¬ä»¶çº§åˆ«çš„åŸå­æ“ä½œï¼Œå…è®¸è°ƒç”¨æ–¹ç›´æ¥æ“ä½œå†…å­˜ä¸­çš„æ•°æ®ã€‚\nå¼•ç”¨ç±»å‹åŸå­ç±» å¼•ç”¨ç±»å‹åŸå­ç±»ä¹ŸåŒ…æ‹¬ä¸‰ç§ï¼šAtomicReferenceã€AtomicStampedReference å’Œ AtomicMarkableReferenceã€‚å¼•ç”¨ç±»å‹åŸå­ç±»ä¸åŸºæœ¬ç±»å‹åŸå­ç±»çš„åŒºåˆ«åœ¨äºï¼šå¼•ç”¨ç±»å‹åŸå­ç±»ä¿è¯çš„æ˜¯åŸºæœ¬ç±»å‹çš„åŸå­æ€§ï¼Œè€Œå¼•ç”¨ç±»å‹åŸå­ç±»ä¿è¯çš„æ˜¯å¯¹è±¡çš„åŸå­æ€§ã€‚\nAtomicReference å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œè€ŒAtomicStampedReference å’Œ AtomicMarkableReference éƒ½æ˜¯ AtomicReference çš„å¢å¼ºç‰ˆæœ¬ã€‚å…¶ä¸­ AtomicStampedReference å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª int ç±»å‹çš„ stamp å˜é‡ï¼Œå®ƒåŒå¯¹è±¡å¼•ç”¨ä¸€èµ·åŸå­æ€§åœ°æ›´æ–°ï¼Œç”¨äºè§£å†³ CAS ä¸­å¯èƒ½å‡ºç°çš„ ABA é—®é¢˜ã€‚è€Œ AtomicMarkableReference å†…éƒ¨åˆ™ç»´æŠ¤äº†ä¸€ä¸ª boolean ç±»å‹çš„ mark å˜é‡ï¼Œå®ƒåŒå¯¹è±¡å¼•ç”¨ä¸€èµ·åŸå­æ€§åœ°æ›´æ–°ï¼Œå¯ä»¥ç”¨æ¥æ ‡è¯†å¯¹è±¡çš„çŠ¶æ€ç­‰ã€‚\næ•°ç»„ç±»å‹åŸå­ç±» æ•°ç»„ç±»å‹åŸå­ç±»ä¹ŸåŒ…æ‹¬ä¸‰ç§ï¼šAtomicIntegerArrayã€AtomicLongArrayã€AtomicReferenceArrayï¼Œå®ƒä»¬å†…éƒ¨åˆ†åˆ«ç»´æŠ¤äº†ä¸€ä¸ª int[]ã€long[] å’Œ Object[] ç±»å‹çš„æ•°ç»„ï¼Œå¯¹æ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ çš„è¯»å†™æ“ä½œéƒ½å…·å¤‡åŸå­æ€§ã€‚\nå­—æ®µæ›´æ–°åŸå­ç±» å­—æ®µæ›´æ–°åŸå­ç±»ä¹ŸåŒ…æ‹¬ä¸‰ç§ï¼šAtomicIntegerFieldUpdaterã€AtomicLongFieldUpdater å’Œ AtomicReferenceFieldUpdaterï¼Œåˆ†åˆ«ç”¨äºåŸå­æ€§æ›´æ–°å¯¹è±¡çš„ intã€long å’Œå¼•ç”¨ç±»å‹çš„å­—æ®µã€‚ä¸‰è€…éƒ½è¦æ±‚è¢«åŸå­æ›´æ–°çš„å­—æ®µè¢« volatile ä¿®é¥°ï¼Œå› ä¸ºå®ƒä»¬ä¸‰ä¸ªéƒ½ä¼šåœ¨æ„é€ å‡½æ•°å†…æ£€æŸ¥è¢«æ›´æ–°çš„å­—æ®µæ˜¯å¦è¢« volatile ä¿®é¥°ï¼Œå¦‚æœè¢«æ›´æ–°çš„å­—æ®µä¸æ˜¯ volatible çš„ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\nåŠ æ³•å™¨ åŠ æ³•å™¨æœ‰ä¸¤ç§ï¼šDoubleAdder å’Œ LongAdderã€‚äºŒè€…éƒ½ç»§æ‰¿è‡ª Stripe64ï¼Œè¯¥ç±»å¼•å…¥äº†åˆ†æ®µç´¯åŠ çš„æ¦‚å¿µï¼Œå†…éƒ¨æœ‰ä¸¤ä¸ªå‚æ•°å‚ä¸ç´¯åŠ ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ long ç±»å‹çš„ baseï¼Œå¦ä¸€ä¸ªæ˜¯ Cell[] ç±»å‹çš„ cellsã€‚å…¶ä¸­ï¼Œbase æ˜¯åœ¨ç«äº‰ä¸æ¿€çƒˆçš„æƒ…å†µä¸‹ä½¿ç”¨çš„ï¼Œç´¯åŠ ç»“æœä¼šè¢«ç›´æ¥æ”¹åˆ°å®ƒä¸Šé¢ï¼Œè€Œ cells æ˜¯åœ¨ç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹ä½¿ç”¨çš„ï¼Œå„ä¸ªçº¿ç¨‹åˆ†æ•£ç´¯åŠ è‡ªå·±æ‰€å¯¹åº”çš„é‚£ä¸ª Cellï¼Œè¿™å°±é™ä½äº†å†²çªçš„æ¦‚ç‡ï¼Œæä¾›äº†å¹¶å‘æ€§ã€‚\nåŠ æ³•å™¨å®ç°æ±‚å’Œçš„å…³é”®åœ¨äº sum() å‡½æ•°ï¼Œå®ƒå…ˆåŠ ä¸Š base çš„å€¼ï¼Œç„¶åå†ä¾æ¬¡ç´¯åŠ å„ä¸ª Cell ä¸­çš„å€¼ï¼Œæœ€ç»ˆå¾—åˆ°æ€»å’Œã€‚æ—¢ç„¶ base å’Œ cells éƒ½å®šä¹‰åœ¨ Stripe64 ä¸­ï¼Œé‚£ä¹ˆ DoubleAdder æ˜¯å¦‚ä½•å®ç° double æ•°æ®çš„æ±‚å’Œçš„å‘¢ï¼Ÿç­”æ¡ˆåœ¨äºåœ¨ Java ä¸­ï¼Œdouble å’Œ long éƒ½å  8 ä¸ªå­—èŠ‚ï¼ŒäºŒè€…åœ¨ä¸€å®šæ¡ä»¶ä¸‹å¯ä»¥äº’ç›¸è¡¨ç¤ºã€‚æ‰€ä»¥ DoubleAdder åœ¨ç´¯åŠ æ—¶è°ƒç”¨äº† Double.doubleToRawLongBits(double value) è®¡ç®—å‡º double å˜é‡çš„ long å€¼ï¼Œæ±‚å’Œæ—¶è°ƒç”¨äº† longBitsToDouble(long bits) è®¡ç®—å‡º long å˜é‡å¯¹åº”çš„ double å€¼ã€‚\nåŠ æ³•å™¨å°±åƒæ˜¯åŸºæœ¬ç±»å‹åŸå­ç±»çš„å¾®ç¼©ç‰ˆæœ¬ï¼Œå‰è€…ä¸»è¦è´Ÿè´£æ‰§è¡ŒåŠ æ³•ï¼Œè€Œåè€…è¿˜æä¾›äº†æ›´å¤šé«˜çº§çš„æ“ä½œã€‚åœ¨çº¿ç¨‹ç«äº‰æ²¡é‚£ä¹ˆæ¿€çƒˆçš„æƒ…å†µä¸‹ï¼ŒäºŒè€…çš„ååé‡ç›¸å·®ä¸å¤§ï¼Œè€Œåœ¨çº¿ç¨‹ç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹ï¼ŒåŠ æ³•å™¨æ±‚å’Œçš„ååé‡å°±é«˜å¾—å¤šäº†ã€‚ä¸è¿‡ï¼Œè¿™æ›´é«˜çš„ååé‡æ˜¯æœ‰ä»£ä»·çš„ï¼Œé‚£å°±æ˜¯æ›´å¤šçš„ç©ºé—´æ¶ˆè€—ã€‚\nç´¯åŠ å™¨ å’ŒåŠ æ³•å™¨ç±»ä¼¼ï¼Œç´¯åŠ å™¨ä¹Ÿæœ‰ä¸¤ç§ï¼šDoubleAccumulator å’Œ LongAccumulatorã€‚ç´¯åŠ å™¨å’ŒåŠ æ³•å™¨å¾ˆç›¸ä¼¼ï¼Œå®é™…ä¸Šï¼Œç´¯åŠ å™¨æ˜¯ä¸€ä¸ªæ›´åŠ é€šç”¨çš„åŠ æ³•å™¨ï¼Œå®ƒå¢å¼ºäº†åŠ æ³•å™¨çš„åŠŸèƒ½ï¼Œå…è®¸æˆ‘ä»¬æä¾›è‡ªå®šä¹‰çš„ç´¯åŠ å‡½æ•°ã€‚\nå‚è€ƒèµ„æ–™  Atomic Variables.  ","href":"/java/concurrency/java_atomic_variables/","title":"Java ä¸­çš„åŸå­ç±»"},{"content":"","href":"/tags/%E5%B9%B6%E5%8F%91/","title":"å¹¶å‘"},{"content":"å¹¶å‘é˜Ÿåˆ—ï¼ˆæˆ–çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ï¼‰æ˜¯åœ¨æˆ‘ä»¬åœ¨è¿›è¡Œå¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹æ—¶ç»å¸¸ä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚å¹¶å‘é˜Ÿåˆ—ä¸ä»…å…·å¤‡åŸºæœ¬é˜Ÿåˆ—çš„æ‰€æœ‰ç‰¹æ€§ï¼Œè¿˜æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ç”±äºå¹¶å‘é˜Ÿåˆ—åœ¨å®ç°æ—¶å·²ç»è€ƒè™‘äº†å„ç§çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å¹¶å‘ç¯å¢ƒä¸­ç›´æ¥ä½¿ç”¨ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæœ‰åˆ©äºé™ä½å¼€å‘éš¾åº¦å’Œå·¥ä½œé‡ã€‚\nJava ä¸­çš„å¹¶å‘é˜Ÿåˆ—å¯ä»¥åˆ†ä¸ºé˜»å¡é˜Ÿåˆ—å’Œéé˜»å¡é˜Ÿåˆ—ä¸¤å¤§ç±»ã€‚\né˜»å¡é˜Ÿåˆ— é™¤äº†é˜Ÿåˆ—çš„åŸºæœ¬åŠŸèƒ½å¤–ï¼Œé˜»å¡é˜Ÿåˆ—æœ€å¤§çš„ç‰¹ç‚¹åœ¨äº é˜»å¡ï¼šåœ¨è¯»å–å…ƒç´ æ—¶ï¼Œè‹¥é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™é˜»å¡è¯»å–æ“ä½œç›´åˆ°é˜Ÿåˆ—éç©ºï¼›åœ¨å†™å…¥å…ƒç´ æ—¶ï¼Œè‹¥é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™é˜»å¡å†™å…¥æ“ä½œç›´åˆ°é˜Ÿåˆ—ä¸­å‡ºç°å¯ç”¨ç©ºé—´ã€‚\né˜»å¡é˜Ÿåˆ—çš„å…¸å‹ä»£è¡¨æ˜¯ BlockingQueue æ¥å£çš„å„ä¸ªå®ç°ç±»ï¼Œä¸»è¦æœ‰ ArrayBlockingQueueã€LinkedBlockingQueueã€SynchronousQueueã€DelayQueueã€PriorityBlockingQueue å’Œ LinkedTransferQueueã€‚\næ ¹æ®é˜»å¡é˜Ÿåˆ—å®¹é‡çš„å¤§å°ï¼Œåˆå¯ä»¥å°†å…¶åˆ†ä¸ºæœ‰ç•Œé˜Ÿåˆ—å’Œæ— ç•Œé˜Ÿåˆ—ã€‚æœ‰ç•Œé˜Ÿåˆ—çš„å…¸å‹ä»£è¡¨æ˜¯ ArrayBlockingQueueï¼Œä¸€æ—¦é˜Ÿåˆ—æ»¡äº†å°±æ— æ³•å…¥é˜Ÿæ–°çš„å…ƒç´ äº†ï¼Œå› ä¸ºå®ƒä¸ä¼šæ‰©å®¹ã€‚æ— ç•Œé˜Ÿåˆ—çš„å…¸å‹ä»£è¡¨æ˜¯ LinkedBlockingQueueï¼Œå…¶å®¹é‡æœ€å¤§ä¸º Integer.MAX_VALUEï¼Œå³ 2^31 - 1ï¼Œè¿™ä¹ˆå¤§çš„å®¹é‡å‡ ä¹ä¸å¯èƒ½è¢«å¡«æ»¡ï¼Œæ•…å¯ä»¥è¿‘ä¼¼çœ‹æˆæ— é™å®¹é‡ã€‚\nåœ¨é˜»å¡é˜Ÿåˆ—ä¸­æœ‰å¾ˆå¤šç›¸ä¼¼çš„æ–¹æ³•ï¼Œæ¯”è¾ƒå®¹æ˜“æ··æ·†ã€‚å› æ­¤ï¼Œæœ‰å¿…è¦å¯¹å®ƒä»¬è¿›è¡Œåˆ†ç±»æ•´ç†ï¼Œæ ¹æ®æ–¹æ³•æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ã€æ˜¯å¦è¿”å›ç‰¹æ®Šå€¼ã€æ˜¯å¦é˜»å¡ã€æ˜¯å¦å…·æœ‰è¶…æ—¶æ—¶é—´ï¼ŒJDK å·²ç»åˆ†ç±»å¥½äº†ï¼š\n    Throws exception Special value Blocks Times out     Insert add(e) offer(e) put(e) offer(e, time, unit)   Remove remove() poll() take() poll(time, unit)   Examine element() peek() not applicable not applicable    æ ¹æ®æ“ä½œç±»å‹çš„ä¸åŒï¼Œç‰¹æ®Šå€¼ï¼ˆSpecial Valueï¼‰ç•¥æœ‰å·®å¼‚ï¼šå¸ƒå°”ç±»å‹çš„ç‰¹æ®Šå€¼ä¸º falseï¼Œå¯¹è±¡ç±»å‹çš„ç‰¹æ®Šå€¼ä¸º nullã€‚\néé˜»å¡é˜Ÿåˆ— éé˜»å¡é˜Ÿåˆ—å®¶æ—åˆ™æ²¡æœ‰é˜»å¡é˜Ÿåˆ—å®¶æ—è¿™ä¹ˆåºå¤§ï¼Œå…¸å‹ä»£è¡¨æ˜¯ ConcurrentLinkedQueueï¼Œå…¶å†…éƒ¨é€šè¿‡ CAS ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œé€‚åˆå¹¶å‘ä¸æ˜¯ç‰¹åˆ«å‰§çƒˆçš„åœºæ™¯ã€‚\n","href":"/java/concurrency/java_concurrent_queue/","title":"Java ä¸­çš„å¹¶å‘é˜Ÿåˆ—"},{"content":"æœ‰ä¸€é“ç»å…¸çš„ Java é¢è¯•é¢˜å«ï¼šé‡å†™äº† equals()ï¼Œä¸ºä»€ä¹ˆè¿˜è¦é‡å†™ hashCode()ï¼Ÿ\n ä¸å¹¸çš„æ˜¯ï¼Œç¬”è€…æœ€è¿‘ä¹Ÿè¢«é—®åˆ°è¿™ä¸ªé—®é¢˜çš„å˜ç§äº†ã€‚å½“æ—¶é¢è¯•å®˜çš„æé—®ç‚¹æœ‰ç‚¹å¥‡è‘©ï¼Œé—®æˆ‘è¿™ä¸¤ä¸ªæ–¹æ³•åœ¨è¢«è°ƒç”¨æ—¶è°å…ˆè°åçš„é—®é¢˜ã€‚ç¬”è€…å½“æ—¶æƒ³ï¼Œè¿™é¢è¯•å®˜æ˜¯ä¸æ˜¯å…«è‚¡æ–‡çœ‹å¤šäº†ï¼Œè¿è¿™ä¸¤æ–¹æ³•è°ƒç”¨å…ˆåéƒ½é—®å‡ºæ¥äº†å—ï¼Ÿä¸¥æ ¼ä¸Šæ¥è¯´ï¼Œequals() å’Œ hashCode() åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å•ç‹¬è°ƒç”¨çš„ï¼Œåªæœ‰åœ¨åƒ HashMap è¿™æ ·çš„æ•°æ®ç»“æ„çš„å†…éƒ¨å®ç°ä¸­ï¼Œæ‰ä¼šå­˜åœ¨æ–¹æ³•è°ƒç”¨çš„å…ˆåå…³ç³»ã€‚ç¬”è€…å½“æ—¶ä¹Ÿæ²¡å®Œå…¨ææ¸…æ¥šé¢è¯•å®˜åˆ°åº•æƒ³é—®ä»€ä¹ˆï¼Œæ‰€ä»¥å°±è±¡å¾æ€§çš„å›ç­”äº† hashCode() å…ˆè°ƒç”¨ã€‚ä»Šå¤©ï¼Œç¬”è€…çªç„¶æƒ³åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæ„Ÿè§‰å½“æ—¶é¢è¯•å®˜æƒ³é—®çš„æ˜¯ HashMap å†…éƒ¨å®ç°æ—¶å¯¹è¿™ä¸¤ä¸ªæ–¹æ³•çš„ä¾èµ–æƒ…å†µã€‚\n åœ¨ Java ä¸­ï¼Œä¸€åˆ‡çš†å¯¹è±¡ã€‚å¹¶ä¸”æ‰€æœ‰çš„å¯¹è±¡éƒ½ç›´æ¥æˆ–é—´æ¥åœ°ç»§æ‰¿è‡ª java.lang.Objectã€‚Object ç±»å®šä¹‰äº†ä¸€ç³»åˆ— Java å¯¹è±¡æ‰€å…±æœ‰çš„æ–¹æ³•ï¼ŒhashCode() å’Œ equals() å°±åœ¨å…¶ä¸­ã€‚\nhashCode() {hashCode()](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#hashCode()) æ–¹æ³•ç”¨äºè¿”å›å¯¹è±¡çš„å“ˆå¸Œå€¼ã€‚Object ç±»å®šä¹‰äº† hashCode() çš„å¥‘çº¦ï¼Œè¿™é‡Œæˆ‘ç›´æ¥åˆ—å‡ºï¼š\n The general contract of hashCode is:\n Whenever it is invoked on the same object more than once during an execution of a Java application, the hashCode method must consistently return the same integer, provided no information used in equals comparisons on the object is modified. This integer need not remain consistent from one execution of an application to another execution of the same application. If two objects are equal according to the equals(Object) method, then calling the hashCode method on each of the two objects must produce the same integer result. It is not required that if two objects are unequal according to the equals(Object) method, then calling the hashCode method on each of the two objects must produce distinct integer results. However, the programmer should be aware that producing distinct integer results for unequal objects may improve the performance of hash tables.   equals() equals() æ–¹æ³•ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡åœ¨æ˜¯å¦ç›¸ç­‰ã€‚å®ƒä¸ == æœ‰ç€æœ¬è´¨åŒºåˆ«ï¼š== æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œå³åˆ¤æ–­å®ƒä»¬æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ equals() æ˜¯åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡åœ¨é€»è¾‘ä¸Šæ˜¯å¦ç›¸ç­‰ã€‚Object ç±»ä¹ŸåŒæ ·å®šä¹‰äº† equals() çš„å¥‘çº¦ï¼Œæˆ‘è¿˜æ˜¯ç›´æ¥åˆ—å‡ºï¼š\n he equals method implements an equivalence relation on non-null object references:\n It is reflexive: for any non-null reference value x, x.equals(x) should return true. It is symmetric: for any non-null reference values x and y, x.equals(y) should return true if and only if y.equals(x) returns true. It is transitive: for any non-null reference values x, y, and z, if x.equals(y) returns true and y.equals(z) returns true, then x.equals(z) should return true. It is consistent: for any non-null reference values x and y, multiple invocations of x.equals(y) consistently return true or consistently return false, provided no information used in equals comparisons on the objects is modified. For any non-null reference value x, x.equals(null) should return false. Note that it is generally necessary to override the hashCode method whenever this method is overridden, so as to maintain the general contract for the hashCode method, which states that equal objects must have equal hash codes.   æ³¨æ„ï¼šè¿™é‡Œç”¨äº†ä¸€ä¸ªä¿®é¥°è¯ generallyï¼ˆé€šå¸¸ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨é‡å†™ equals() ä¹‹åæ˜¯å¯ä»¥ä¸é‡å†™ hashCode() çš„ã€‚åªæ˜¯è¿™æ ·ä¼šå¼•å‘ä¸€ä¸ªé—®é¢˜ï¼Œä¸é‡å†™å°±è¿åäº† hashCode() çš„å¥‘çº¦ï¼Œå› ä¸ºå½“ä¸¤ä¸ªå¯¹è±¡ equals æ—¶ï¼Œå®ƒä»¬çš„å“ˆå¸Œå€¼ä¹Ÿåº”è¯¥æ˜¯ä¸€æ ·çš„ã€‚è¿™åœ¨ HashMap è¿™ä¸€ç±»æ•°æ®ç»“æ„ä¸­å°±ä¼šå¼•èµ·é—®é¢˜ï¼Œå…¸å‹çš„é—®é¢˜å°±æ˜¯å†…å­˜æ³„éœ²ã€‚\nhashCode() å’Œ equals() é‡å†™ä¸å½“é€ æˆçš„å†…å­˜æ³„éœ² æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼š\nclass Key { String name; public Key(String name) { this.name = name; } } class HashMapMemoryLeakDemo { public static void main(String[] args) { Map\u0026lt;Key, Integer\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); map.put(new Key(\u0026#34;1\u0026#34;), 1); map.put(new Key(\u0026#34;2\u0026#34;), 2); map.put(new Key(\u0026#34;3\u0026#34;), 3); System.out.println(map.get(new Key(\u0026#34;1\u0026#34;))); } } ç¨‹åºçš„è¾“å‡ºç»“æœæ˜¯ nullã€‚ä¸ºä»€ä¹ˆä¸æ˜¯ 1 å‘¢ï¼Ÿå› ä¸º hashCode() æ˜¯ä¸€ä¸ª native æ–¹æ³•ï¼Œå®ƒçš„å®ç°å–å†³äºå…·ä½“çš„ JVM å®ç°ã€‚ä¸€äº› JVM ä¼šå°† hashCode() å®ç°ä¸ºå¯¹è±¡åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚ä¸Šé¢ä»£ç åœ¨ä» map ä¸­å–å€¼çš„æ—¶å€™ä½¿ç”¨äº†ä¸€ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸º keyï¼Œæ‰€ä»¥ä¼šè¿”å› nullã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬ä½¿ç”¨ map.remove(new Key(\u0026quot;1\u0026quot;)) ä¹Ÿæ— æ³•å°†æœ€åˆç”¨ new Key(\u0026quot;1\u0026quot;) åˆ›å»ºçš„é‚£ä¸ªå¯¹è±¡ä» map ä¸­ç§»é™¤ã€‚ä¹…è€Œä¹…ä¹‹ï¼Œå°±ä¼šå‡ºç°å†…å­˜æ³„éœ²ã€‚\nhashCode å’Œ equals() åœ¨ HashMap ä¸­çš„ä½¿ç”¨ HashMap åº•å±‚çš„æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ª table ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\ntransient Node\u0026lt;K,V\u0026gt;[] table; è¿™ä¸ª table å°±æ˜¯æˆ‘ä»¬ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„å“ˆå¸Œè¡¨ã€‚æœ‰å“ˆå¸Œè¡¨å°±æœ‰å¯èƒ½å‡ºç°å“ˆå¸Œå†²çªï¼ŒHashMap é‡‡ç”¨é“¾è¡¨ï¼ˆæˆ–çº¢é»‘æ ‘ï¼‰æ¥è§£å†³å“ˆå¸Œå†²çªã€‚å½“é“¾è¡¨é•¿åº¦å¤§äº 8 å¹¶ä¸”å®¹é‡å¤§äº 64 æ—¶ï¼Œé“¾è¡¨ç»“æ„ä¼šè½¬æ¢æˆçº¢é»‘æ ‘ç»“æ„ã€‚Node è¡¨ç¤ºé“¾è¡¨ä¸­çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¹Ÿè¢«çº¢é»‘æ ‘èŠ‚ç‚¹ TreeNode é—´æ¥ç»§æ‰¿ã€‚æˆ‘ä»¬å°†table æ•°ç»„ä¸­çš„å…ƒç´ ç§°ä¸ºå“ˆå¸Œæ¡¶ï¼Œæ•´ä¸ª HashMap çš„ç»„æˆç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nçŸ¥é“è¿™äº›ä¹‹åï¼Œå°±å¯ä»¥å°è¯•å›ç­”æ–‡ç« å¼€å¤´é‚£ä¸ªé—®é¢˜äº†ã€‚HashMap é€šè¿‡å“ˆå¸Œå‡½æ•°å°† \u0026lt;K, V\u0026gt; åˆ†æ•£åˆ°ä¸åŒçš„å“ˆå¸Œæ¡¶ä¸­ã€‚ç„¶è€Œç”±äºå“ˆå¸Œå†²çªçš„å­˜åœ¨ï¼Œä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­å¯èƒ½æ”¾æœ‰å¤šä¸ªèŠ‚ç‚¹ã€‚åœ¨æŸ¥æ‰¾å…ƒç´ çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šé€šè¿‡å“ˆå¸Œå‡½æ•°å¾—åˆ°ä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œé€šè¿‡å“ˆå¸Œå€¼å®šä½åˆ°å“ˆå¸Œæ¡¶ã€‚HashMap ä¸­çš„å“ˆå¸Œå‡½æ•°æ˜¯è¿™æ ·çš„ï¼š\nstatic final int hash(Object key) { int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h \u0026gt;\u0026gt;\u0026gt; 16); } è¿™é‡Œå°±ç”¨åˆ°äº† key çš„ hashCode()ã€‚æ‰¾åˆ°å“ˆå¸Œæ¡¶ä¹‹åï¼Œä¼šæ¥ç€éå†æ¡¶ä¸­æ‰€æœ‰èŠ‚ç‚¹ï¼Œé€šè¿‡ key çš„ equals() æ¥åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦å°±æ˜¯æˆ‘ä»¬è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ã€‚\nè¿™åº”è¯¥å°±æ˜¯â€œIf a.equals(b), then a.hashCode() == b.hashCode(), not vice versa.â€ çš„åŸå› äº†ã€‚åˆ°äº†è¿™é‡Œï¼Œä¹Ÿä¸éš¾å›ç­”ä¸ºä»€ä¹ˆé‡å†™ equals() å°±è¦é‡å†™ hashCode() è¿™ä¸ªé—®é¢˜äº†ã€‚ç­”æ¡ˆçš„æ ¸å¿ƒå°±åœ¨äºå“ˆå¸Œè¡¨å’Œå“ˆå¸Œå†²çªã€‚\n","href":"/java/java_lang/java-hashcode-equals-contracts/","title":"Java ä¸­çš„ hashCode() ä¸ equals()"},{"content":"","href":"/categories/spring/","title":"Spring"},{"content":"","href":"/tags/spring-boot/","title":"Spring Boot"},{"content":"å¼€å‘çš„åŒå­¦å¯èƒ½éƒ½é‡åˆ°è¿‡ä¸€ä¸ª Spring Boot åº”ç”¨è¦åœ¨å¤šä¸ªç¯å¢ƒä¸Šéƒ¨ç½²ï¼Œè€Œæ¯ä¸ªç¯å¢ƒçš„é…ç½®éƒ½ä¸åŒçš„æƒ…å†µã€‚æ¯”å¦‚ï¼Œå¼€å‘ç¯å¢ƒç”¨ä¸€å¥—é…ç½®ï¼Œæµ‹è¯•ç¯å¢ƒç”¨å¦ä¸€å¥—é…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒåˆæ˜¯ä¸€å¥—æ–°é…ç½®ã€‚å¦‚æœæˆ‘ä»¬æŠŠé…ç½®æ”¾åœ¨åŒä¸€ä¸ªåœ°æ–¹ï¼Œç„¶åæ¯æ¬¡éƒ½æ ¹æ®ä¸åŒçš„ç¯å¢ƒè¿›è¡Œä¿®æ”¹ï¼Œå¯èƒ½è¦ä¸äº†å¤šä¹…ï¼Œæˆ‘ä»¬çš„å¤´å°±å¤§äº†ã€‚å› ä¸ºï¼Œæˆ‘ä»¬å¯èƒ½ä¸€ä¸å°å¿ƒæŠŠå¼€å‘ç¯å¢ƒçš„é…ç½®æ”¾åˆ°æµ‹è¯•ç¯å¢ƒä¸­å»äº†â€¦â€¦\nä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬åœ¨ä¸åŒç¯å¢ƒä¸­è¿è¡Œåº”ç”¨ç¨‹åºï¼ŒSpring Boot å…è®¸æˆ‘ä»¬å°†é…ç½®ä¿¡æ¯å¤–éƒ¨åŒ–ã€‚Spring Boot æ”¯æŒå¤šç§å¤–éƒ¨åŒ–çš„é…ç½®æºï¼ŒåŒ…æ‹¬ Java çš„ properties æ–‡ä»¶ã€YAML æ–‡ä»¶ã€ç¯å¢ƒå˜é‡å’Œå‘½ä»¤è¡Œå‚æ•°ã€‚\né…ç½®æº æ—¢ç„¶é…ç½®å¯ä»¥æ¥è‡ªå¾ˆå¤šä¸åŒçš„åœ°æ–¹ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å‡ºç°åŒä¸€ä¸ªé…ç½®é¡¹åœ¨å¤šä¸ªé…ç½®æºä¸­å‡ºç°çš„æƒ…å†µã€‚æ‰€ä»¥ Spring Boot æœ‰ä¸€ä¸ªé…ç½®å€¼è¦†ç›–è§„åˆ™ï¼Œä¼˜å…ˆçº§é«˜çš„é…ç½®ä¼šè¦†ç›–ä¼˜å…ˆçº§ä½çš„ï¼Œä¼˜å…ˆçº§ä»ä½åˆ°é«˜ä¾æ¬¡ä¸ºï¼š\n é»˜è®¤å±æ€§ï¼ˆå³é€šè¿‡ SpringApplication.setDefaultProperties è®¾ç½®çš„å±æ€§ï¼‰ @Configuration ç±»ä¸Šçš„ @PropertySource æ³¨è§£ é…ç½®æ•°æ®ï¼ˆæ¯”å¦‚ application.propertiesï¼‰ã€‚é…ç½®æ•°æ®æ–‡ä»¶çš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼Œå½“.properties æ–‡ä»¶ä¸ .yml æ–‡ä»¶åŒæ—¶å‡ºç°æ—¶ï¼Œå‰è€…çš„ä¼˜å…ˆçº§ä¼šé«˜äºåè€…ï¼š  Jar åŒ…å†…çš„ application.properties å’Œ application.yml Jar åŒ…å†…ç‰¹å®š Profile çš„ application-{profile}.properties å’Œ application-{profile}.yml Jar åŒ…å¤–çš„ application.properties å’Œ application.yml Jar åŒ…å¤–ç‰¹å®š Profile çš„ application-{profile}.properties å’Œ application-{profile}.yml   ç”± RandomValuePropertySource é…ç½®çš„ random.* å±æ€§å€¼ æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ Java ç³»ç»Ÿå±æ€§ï¼ˆSystem.getProperties()ï¼‰ æ¥è‡ª java:comp/env çš„ JNDI å±æ€§ ServletContext çš„åˆå§‹åŒ–å‚æ•° ServletConfig çš„åˆå§‹åŒ–å‚æ•° SPRING_APPLICATION_JSONï¼ˆç¯å¢ƒå˜é‡æˆ–ç³»ç»Ÿå±æ€§ä¸­çš„å•è¡Œ JSONï¼‰ ä¸­çš„å±æ€§å€¼ å‘½ä»¤è¡Œå‚æ•° æµ‹è¯•ä¸Šçš„ properties å±æ€§ã€‚åœ¨ @SpringBootTest å’Œå…¶å®ƒæµ‹è¯•ç›¸å…³æ³¨è§£ä¸Šæœ‰ç”¨ æµ‹è¯•ä¸Šçš„ @TestPropertySource æ³¨è§£ å½“ devtools æ¿€æ´»æ—¶ï¼Œ$HOME/.config/spring-boot ç›®å½•ä¸‹çš„ devtools å…¨å±€è®¾ç½®å±æ€§  å‘½ä»¤è¡Œå‚æ•° é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringApplication ä¼šå°†æ‰€æœ‰ä»¥ -- å¼€å¤´çš„å‘½ä»¤è¡Œå‚æ•°è½¬æ¢ä¸º property å¹¶å°†å®ƒä»¬åŠ å…¥åˆ° Spring çš„ Environment ä¸­ã€‚ä¾‹å¦‚ï¼š\n$ java -jar app.jar --name=value å¦‚æœä½ ä¸å¸Œæœ› SpringApplication å°†å‘½ä»¤è¡Œå‚æ•°æ·»åŠ åˆ° Environmentï¼Œå¯ä»¥ä½¿ç”¨ SpringApplication.setAddCommandLineProperties(false) å…³é—­æ­¤åŠŸèƒ½ã€‚\nSPRING_APPLICATION_JSON ç¯å¢ƒå˜é‡å’Œç³»ç»Ÿå±æ€§é€šå¸¸æœ‰ä¸€äº›é™åˆ¶ï¼Œå¯¼è‡´éƒ¨åˆ†å±æ€§åæ— æ³•ä½¿ç”¨ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒSpring Boot å…è®¸æˆ‘ä»¬å°†ä¸€ç»„å±æ€§æ”¾åˆ°å•è¡Œ JSON ä¸­ã€‚åœ¨ Spring Boot åº”ç”¨å¯åŠ¨æ—¶ï¼Œæ‰€æœ‰çš„ spring.application.json æˆ– SPRING_APPLICATION_JSON éƒ½ä¼šè¢«è§£æå¹¶åŠ å…¥åˆ° Environment ä¸­ã€‚ä¾‹å¦‚ï¼š\n$ java -Dspring.application.json=\u0026#34;{\\\u0026#34;name\\\u0026#34;:\\\u0026#34;value\\\u0026#34;}\u0026#34; -jar app.jar å¤–éƒ¨åº”ç”¨å±æ€§ åœ¨åº”ç”¨å¯åŠ¨æ—¶ï¼ŒSpring Boot ä¼šè‡ªåŠ¨ä»ä¸‹åˆ—ä½ç½®æŸ¥æ‰¾å’ŒåŠ è½½ application.propertiesã€application-{profile}.propertiesã€application.yml å’Œ application-{profile}.ymlã€‚å…¶ä¸­ï¼Œé«˜ä¼˜å…ˆçº§çš„é…ç½®é¡¹ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®é¡¹ï¼Œé…ç½®è¦†ç›–çš„ä¼˜å…ˆçº§ä»ä½åˆ°é«˜ä¾æ¬¡ä¸ºï¼š\n classpath:  classpath æ ¹ç›®å½• classpath ç›®å½•ä¸‹çš„ /config åŒ…   å½“å‰ç›®å½•ï¼š  å½“å‰ç›®å½• å½“å‰ç›®å½•çš„ /config å­ç›®å½• /config å­ç›®å½•çš„ç›´æ¥å­ç›®å½•    è¿™é‡Œçš„ application.properties çš„æ–‡ä»¶åä¹Ÿä¸æ˜¯å†™æ­»çš„ï¼ŒSpring Boot å…è®¸æˆ‘ä»¬é€šè¿‡ spring.config.name è¿™ä¸ªç¯å¢ƒå±æ€§å®šä¹‰è‡ªå·±å–œæ¬¢çš„é…ç½®æ–‡ä»¶åã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½åå‘ŠçŸ¥ Spring Boot å»å¯»æ‰¾ myname.properties æˆ– myname.yml æ–‡ä»¶ï¼š\n$ java -jar app.jar --spring.config.name=myname æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ spring.config.location å’Œ spring.config.additional-location ç¯å¢ƒå±æ€§ æ˜¾å¼ æŒ‡å‡ºé…ç½®æ–‡ä»¶çš„ä½ç½®ã€‚ç”±äºSpring Boot éœ€è¦ä½¿ç”¨ spring.config.nameã€spring.config.location å’Œ spring.config.additional-location æ¥å†³å®šåŠ è½½å“ªäº›é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥å®ƒä»¬å¿…é¡»è¢«å®šä¹‰æˆç¯å¢ƒå±æ€§ï¼ˆé€šå¸¸æ˜¯æ“ä½œç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ã€ç³»ç»Ÿå±æ€§æˆ–å‘½ä»¤è¡Œå‚æ•°ï¼‰ã€‚\né…ç½®éšæœºå€¼ æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›æŸä¸ªé…ç½®é¡¹çš„å€¼æ˜¯éšæœºç”Ÿæˆçš„ã€‚å¦‚æœæ¯æ¬¡éƒ½ç”Ÿæˆä¸€ä¸ªéšæœºå€¼æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­å»ï¼Œæœªå…å¤ªè¿‡ç¹çã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ RandomValuePropertySourceï¼Œå®ƒæ”¯æŒéšæœºäº§ç”Ÿæ•´æ•°ã€é•¿æ•´å‹æ•°ã€UUID å’Œå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼š\nmy: number: \u0026#34;${random.int}\u0026#34; bignumber: \u0026#34;${random.long}\u0026#34; uuid: \u0026#34;${random.uuid}\u0026#34; name: \u0026#34;${random.value}\u0026#34; ä½¿ç”¨ YAML YAML æ˜¯ JSON çš„è¶…é›†ï¼Œåœ¨å£°æ˜å…·æœ‰å±‚æ¬¡åŒ–çš„é…ç½®æ•°æ®æ—¶éå¸¸æ–¹ä¾¿ã€‚ä¸è¿‡ï¼ŒYAML æ–‡ä»¶ä¸­çš„é…ç½®åœ¨ä»å±‚çº§ç»“æ„è½¬åŒ–ä¸ºæ‰å¹³ç»“æ„ä¹‹åï¼Œæ‰èƒ½åœ¨ Environment ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ YAML æ–‡ä»¶ï¼š\ndatabase: username: test-user password: test-password ä¼šè¢«æ‰å¹³åŒ–ä¸ºï¼š\ndatabase.username=test-user database.password=test-password å±æ€§çš„æ³¨å…¥ä¸ä½¿ç”¨ Spring Boot ç»™æˆ‘ä»¬æä¾›äº†å¤šç§æ³¨å…¥å±æ€§çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ @Value å’Œ @ConfigurationPropertiesã€‚\n@Value @Value ä¸€èˆ¬ç”¨äºå°†å•ä¸ªå±æ€§æ³¨å…¥åˆ°ç¨‹åºä¸­ã€‚ä¾‹å¦‚ï¼š\n@Value(\u0026#34;${server.port}\u0026#34;) int port; @ConfigurationProperties å½“é…ç½®ä¿¡æ¯æœ‰å¾ˆå¤šä¸ªæ—¶ï¼Œ@Value çš„å±€é™æ€§å°±ä½“ç°å‡ºæ¥äº†ã€‚æœ‰å¤šå°‘ä¸ªé…ç½®é¡¹ï¼Œå°±éœ€è¦å†™å¤šå°‘ä¸ª @ValueğŸ˜£ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @ConfigurationPropertiesï¼Œå®ƒæ”¯æŒå°†å¤šä¸ªé…ç½®é¡¹ç»‘å®šåˆ° Bean çš„å­—æ®µä¸Šã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€æ®µæ•°æ®åº“çš„é…ç½®ä¿¡æ¯ï¼š\ndatabase: url: jdbc:postgresql:/localhost:5432/instance username: test-user password: test-password æˆ‘ä»¬å¯ä»¥é€šè¿‡ Java Bean å±æ€§ç»‘å®šçš„æ–¹å¼ï¼Œå°†é…ç½®ä¿¡æ¯ç»‘å®šåˆ° Bean çš„å±æ€§ä¸Šï¼š\n@ConfigurationProperties(prefix=\u0026#34;database\u0026#34;) public class Database { String url; String name; String password; // getters and setters } ä¹Ÿå¯ä»¥é€šè¿‡æ„é€ å™¨ç»‘å®šçš„æ–¹å¼ï¼Œå°†é…ç½®ä¿¡æ¯ç»‘å®šåˆ° Bean çš„å±æ€§ä¸Šï¼š\npublic class Database { String url; String name; String password; public Database(String url, String name, String password) { this.url = url; this.name = name; this.password = password; } // getters } Profiles Spring Boot å…è®¸æˆ‘ä»¬æ ¹æ®ä¸åŒçš„ç¯å¢ƒç»„ç»‡é…ç½®æ–‡ä»¶ï¼Œè®©æŸäº›é…ç½®åªåœ¨ç‰¹å®šçš„ç¯å¢ƒä¸‹æ‰ç”Ÿæ•ˆï¼Œè¿™å°±æ˜¯ Profileã€‚é€šè¿‡ spring.profiles.active è¿™ä¸ªç¯å¢ƒå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šæ¿€æ´»å“ªäº› profileã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒé…ç½®åœ¨ application.yml ä¸­ï¼Œè®© dev å’Œ hsqldb ä¸¤ä¸ª profile ç”Ÿæ•ˆï¼š\nspring: profiles: active: \u0026#34;dev,hsqldb\u0026#34; ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ï¼Œåªè®© dev è¿™ä¸ª profile ç”Ÿæ•ˆï¼š\n$ java -jar app.jar --spring.profiles.active=dev è¿˜å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ç­‰å¤šç§æ–¹å¼æŒ‡å®šç”Ÿæ•ˆçš„ profileã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šç”Ÿæ•ˆçš„ profile æ–‡ä»¶ï¼Œå°±ä¼šå¯ç”¨é»˜è®¤çš„ profileã€‚\nå‚è€ƒèµ„æ–™  Spring Boot Documentation. Externalized Configuration.  ","href":"/java/spring/configurations-in-spring-boot/","title":"Spring Boot ä¸­çš„é…ç½®ä½“ç³»"},{"content":"","href":"/tags/spring/","title":"Spring"},{"content":"Iocï¼ˆInverse of Controlï¼‰ï¼Œåˆå« DIï¼ˆDependence Injectionï¼‰ã€‚å®ƒæ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼šå¯¹è±¡å£°æ˜è‡ªå·±çš„ä¾èµ–ï¼Œç„¶åå®¹å™¨åœ¨åˆ›å»º Bean çš„æ—¶å€™æ³¨å…¥è¿™äº›ä¾èµ–ã€‚å¦‚æœä¸ä½¿ç”¨ IoCï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºå¯¹è±¡ä¹‹å‰å°±éœ€è¦å…ˆæŠŠå¯¹è±¡çš„ä¾èµ–åˆ›å»ºå‡ºæ¥ï¼Œè¿™ä¸ªæ­£å‘çš„è¿‡ç¨‹ä¼šå¯¼è‡´å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„å¼ºè€¦åˆã€‚å¦‚æœåè¿‡æ¥ï¼Œå¯¹è±¡ä¸è‡ªå·±åˆ›å»ºä¾èµ–ï¼Œè€Œæ˜¯ç”± Spring çš„ Ioc å®¹å™¨è‡ªåŠ¨è£…é…ï¼Œè¿™å°±æ˜¯æ§åˆ¶åè½¬ã€‚é€†å‘çš„è¿‡ç¨‹ä½¿å¾—ç¨‹åºçš„ç»“æ„å˜å¾—æ›´åŠ çµæ´»ï¼Œæ²¡æœ‰å¼ºè€¦åˆï¼Œè¿˜æœ‰åˆ©äºå¯¹è±¡çš„å¤ç”¨ã€‚\nIoc å®¹å™¨ åœ¨ Spring ä¸­ï¼Œorg.springframework.context.ApplicationContext æ¥å£å°±æ˜¯ IoC å®¹å™¨çš„æŠ½è±¡è¡¨ç¤ºï¼Œå®ƒè´Ÿè´£ Bean çš„å®ä¾‹åŒ–ã€é…ç½®ä»¥åŠç»„è£…ã€‚é‚£ä¹ˆï¼ŒIoC å®¹å™¨æ˜¯å¦‚ä½•çŸ¥é“è¦ç®¡ç†å“ªäº› Bean å‘¢ï¼Ÿç­”æ¡ˆæ˜¯é…ç½®å…ƒæ•°æ®ï¼ˆConfiguration Metadataï¼‰ã€‚é…ç½®å…ƒæ•°æ®å¯ä»¥æ˜¯ XMLã€æ³¨è§£ï¼Œè¿˜å¯ä»¥æ˜¯ Java ä»£ç ã€‚\né…ç½®å…ƒæ•°æ® Spring çš„ Ioc å®¹å™¨ä¼šè¯»å–é…ç½®å…ƒæ•°æ®ï¼Œç„¶åæ ¹æ®é…ç½®å…ƒæ•°æ®å»å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…åº”ç”¨ç¨‹åºä¸­çš„ Beanã€‚åœ¨ Spring çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œé…ç½®ä¿¡æ¯ä½¿ç”¨çš„æ˜¯ XMLã€‚Spring 2.5 å¼€å§‹æ”¯æŒåŸºäºæ³¨è§£çš„é…ç½®ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ @Required å’Œ @Autowired å°±æ˜¯åŸºäºæ³¨è§£çš„é…ç½®ã€‚ Spring 3.0 å¼€å§‹æ”¯æŒåŸºäº Java ä»£ç çš„é…ç½®ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥åŒæ—¶ä½¿ç”¨ XML å’Œ æ³¨è§£å»é…ç½® Beanã€‚\nå®é™…ä¸Šï¼Œåœ¨ IoC å®¹å™¨å†…éƒ¨ï¼Œè¿™äº›é…ç½®å…ƒæ•°æ®ä¼šè¢«è§£ææˆ BeanDefinition å¯¹è±¡ï¼ŒBeanDefinition å°è£…çš„å°±æ˜¯ Bean çš„å®šä¹‰å’Œæè¿°ä¿¡æ¯ï¼Œæ¯”å¦‚ç±»åã€æ„é€ å™¨å‚æ•°ã€å±æ€§å€¼ã€ä½œç”¨åŸŸã€ç”Ÿå‘½å‘¨æœŸç­‰ï¼Œå®¹å™¨ä¼šæ ¹æ® BeanDefinition ä¸­å°è£…çš„ä¿¡æ¯æ¥åˆ›å»º Beanã€‚\nä½¿ç”¨ BeanFactoryPostProcessor å¯¹é…ç½®å…ƒæ•°æ®è¿›è¡Œä¸ªæ€§åŒ–é…ç½® åœ¨ Spring ä¸­ï¼ŒBeanFactory æä¾›äº†ä¸€ç§ç®¡ç†ä»»ä½•ç±»å‹å¯¹è±¡çš„é«˜çº§æœºåˆ¶ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°çš„ ApplicationContext åˆ™æ˜¯å®ƒçš„ä¸€ä¸ªå­æ¥å£ã€‚è‹¥è¦ç”¨ä¸€å¥è¯æ¥æè¿°äºŒè€…çš„å·®å¼‚ï¼Œé‚£å°±æ˜¯ï¼šBeanFactory æä¾›é…ç½®æ¡†æ¶å’ŒåŸºæœ¬åŠŸèƒ½ï¼ŒApplicationContext åˆ™æ˜¯æ·»åŠ äº†æ›´å¤šçš„ä¼ä¸šçº§åŠŸèƒ½ã€‚\nBeanFactoryPostProcessor å…è®¸æˆ‘ä»¬å¯¹é…ç½®å…ƒæ•°æ®ï¼ˆBeanDefinitionï¼‰è¿›è¡Œä¸ªæ€§åŒ–é…ç½®ã€‚å®ƒä¸åé¢ä»‹ç»çš„ BeanPostProcessor åŠŸèƒ½ç±»ä¼¼ï¼Œåªä¸è¿‡åè€…çš„ä½œç”¨æ˜¯å¯¹ Bean æœ¬èº«è¿›è¡Œä¸ªæ€§åŒ–é…ç½®ã€‚æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š\npublic interface BeanFactoryPostProcessor { /** * Modify the application context\u0026#39;s internal bean factory after its standard * initialization. All bean definitions will have been loaded, but no beans * will have been instantiated yet. This allows for overriding or adding * properties even to eager-initializing beans. */ void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException; } åœ¨ postProcessBeanFactory() æ–¹æ³•è¢«è°ƒç”¨å‰ï¼Œæ‰€æœ‰çš„ Bean å®šä¹‰ä¿¡æ¯éƒ½å·²ç»åŠ è½½å®Œæ¯•ã€‚æ‰€ä»¥ BeanFactoryPostProcessor å¯ä»¥åœ¨ Bean å®ä¾‹åŒ–ä¹‹å‰è·å– Bean çš„é…ç½®å…ƒæ•°æ®ï¼Œå¹¶å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚\nä¾èµ–æ³¨å…¥ ä¾èµ–æ³¨å…¥ä¸»è¦æœ‰ä¸¤ç§ï¼š\n åŸºäºæ„é€ å™¨çš„ä¾èµ–æ³¨å…¥ï¼ˆConstructor-based DIï¼‰ï¼šå®¹å™¨è°ƒç”¨æœ‰å‚æ„é€ å‡½æ•°ï¼ˆæˆ–é™æ€å·¥å‚æ–¹æ³•ï¼‰ï¼Œä¼ å…¥å‚æ•°åˆ—è¡¨ï¼Œæ¯ä¸€ä¸ªå‚æ•°ä»£è¡¨ä¸€ä¸ªä¾èµ–ã€‚ åŸºäº Setter çš„ä¾èµ–æ³¨å…¥ï¼ˆSetter-based DIï¼‰ï¼šå®¹å™¨åœ¨è°ƒç”¨æ— å‚æ„é€ å‡½æ•°æˆ–æ— å‚é™æ€å·¥å‚æ–¹æ³•ä¹‹åï¼Œå†è°ƒç”¨ Bean çš„ setter æ–¹æ³•æ³¨å…¥ä¾èµ–ã€‚  IoC å®¹å™¨ç”šè‡³æ”¯æŒä¸¤ç§æ³¨å…¥æ–¹å¼çš„æ··ç”¨çš„æƒ…å†µï¼Œä½ å¯ä»¥å…ˆé€šè¿‡æ„é€ å‡½æ•°ç»™ Bean æ³¨å…¥ä¸€éƒ¨åˆ†ä¾èµ–ï¼Œå†é€šè¿‡ setter æ–¹æ³•ç»™ Bean æ³¨å…¥å¦ä¸€éƒ¨åˆ†ä¾èµ–ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨æ„é€ å™¨æ³¨å…¥å¼ºåˆ¶æ€§ä¾èµ–ï¼Œä½¿ç”¨ setter æ–¹æ³•æ³¨å…¥å¯é€‰çš„ä¾èµ–ã€‚\nBean çš„ä¾èµ–é¡¹è§£æè¿‡ç¨‹å¦‚ä¸‹ï¼š\n å®¹å™¨è¢«åˆ›å»ºå‡ºæ¥ï¼Œé€šè¿‡æè¿° Bean çš„é…ç½®å…ƒæ•°æ®è¿›è¡Œåˆå§‹åŒ–ï¼Œæ£€éªŒæ¯ä¸ª Bean çš„é…ç½®ä¿¡æ¯ã€‚é…ç½®å…ƒæ•°æ®å¯ä»¥æ˜¯ XMLï¼Œä¹Ÿå¯ä»¥æ˜¯æ³¨è§£å’Œ Java ä»£ç  å¯¹äºæ¯ä¸€ä¸ª Beanï¼Œå®ƒä¾èµ–ä¼šè¢«è¡¨ç¤ºæˆå±æ€§ã€æ„é€ å™¨å‚æ•°æˆ–é™æ€å·¥å‚æ–¹æ³•çš„å‚æ•°ã€‚è¿™äº›ä¾èµ–å°†ä¼šåœ¨ Bean è¢«çœŸæ­£åˆ›å»ºçš„æ—¶æä¾›ç»™å®ƒ æ¯ä¸ªå±æ€§æˆ–æ„é€ å™¨å‚æ•°éƒ½æ˜¯ä¸€ä¸ªå…·ä½“çš„å€¼ï¼Œæˆ–è€…æŒ‡å‘å®¹å™¨å†…å¦ä¸€ä¸ª Bean çš„å¼•ç”¨ å¯¹äºé‚£äº›æ˜¯å…·ä½“å€¼çš„å±æ€§æˆ–æ„é€ å™¨å‚æ•°ï¼Œç›¸åº”çš„å€¼ä¼šè¢«è½¬åŒ–æˆå±æ€§æˆ–æ„é€ å™¨å‚æ•°çš„å®é™…ç±»å‹  è‡ªåŠ¨è£…é… Spring æä¾›äº†å››ç§è‡ªåŠ¨è£…é…æ¨¡å¼ï¼š\n   Mode Description     no ä¸ä½¿ç”¨è‡ªåŠ¨è£…é…ï¼Œé€šè¿‡ ref å®šä¹‰ Bean çš„ä¾èµ–ã€‚è¿™æ˜¯é»˜è®¤å€¼   byName é€šè¿‡å±æ€§åè£…é…ã€‚Spring ä¼šæŸ¥æ‰¾ä¸å±æ€§åŒåçš„ Bean è¿›è¡Œè£…é…   byType å½“æ»¡è¶³ç»™å®šç±»å‹çš„ Bean åªæœ‰ä¸€ä¸ªæ—¶ï¼Œè¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œæœ‰å¤šä¸ªæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚è‹¥æ²¡æœ‰æ»¡è¶³ç±»å‹çš„ Beanï¼Œä¸è¿›è¡Œè£…é…ã€‚   constructor ä¸ byType ç±»ä¼¼ï¼Œåªæ˜¯ Bean ç”¨ä½œæ„é€ å™¨å‚æ•°    Bean åœ¨ Spring ä¸­ï¼ŒBean å°±æ˜¯é‚£äº›ç”± IoC å®¹å™¨åˆå§‹åŒ–ã€é…ç½®å’Œç»„è£…çš„å¯¹è±¡ï¼ŒIoC å®¹å™¨å°±æ˜¯ Bean çš„ç®¡ç†è€…ã€‚æˆ‘ä»¬åœ¨å‰é¢æåˆ°ï¼Œå¼€å‘è€…é€šè¿‡é…ç½®å…ƒæ•°æ®å‘Šè¯‰ IoC å®¹å™¨ Bean çš„ç›¸å…³é…ç½®ä¿¡æ¯ï¼Œå®¹å™¨å°†é…ç½®å…ƒæ•°æ®è§£ææˆ BeanDefinition å¯¹è±¡ï¼Œå†é€šè¿‡å®ƒåˆ›å»º Beanã€‚\nBean çš„å‘½å é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ª Bean åªæœ‰ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼ˆidentifierï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœ Bean éœ€è¦å¤šä¸ªæ ‡è¯†ç¬¦ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™äº›å¤šçš„æ ‡è¯†ç¬¦å°±æ˜¯ Bean çš„åˆ«åï¼ˆaliasï¼‰ã€‚ä½†æ˜¯ï¼Œåœ¨åŒä¸€ä¸ª IoC å®¹å™¨ä¸­ï¼Œæ˜¯ä¸å…è®¸æœ‰å¤šä¸ªç›¸åŒçš„æ ‡è¯†ç¬¦çš„ã€‚\né‚£ä¹ˆï¼Œå¦‚ä½•æŒ‡å®š Bean çš„æ ‡è¯†ç¬¦å‘¢ï¼Ÿåœ¨åŸºäº XML çš„é…ç½®é‡Œï¼ŒBean çš„æ ‡è¯†ç¬¦ç”± id å’Œ name å±æ€§æŒ‡å®šã€‚å…¶ä¸­ id åªå…è®¸æˆ‘ä»¬å£°æ˜ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œè€Œ name å…è®¸æˆ‘ä»¬å£°æ˜å¤šä¸ªï¼Œå¤šä¸ªæ ‡è¯†ç¬¦ä¹‹é—´ä½¿ç”¨é€—å·ï¼ˆ,ï¼‰æˆ–åˆ†å·ï¼ˆ;ï¼‰æˆ–ç©ºæ ¼åˆ†éš”å°±è¡Œäº†ã€‚ä¾‹å¦‚ï¼š\u0026lt;bean id=\u0026quot;xx\u0026quot; name=\u0026quot;xx1,xx2\u0026quot;/\u0026gt;æœ‰æ—¶å€™ï¼Œåœ¨ name ä¸­å£°æ˜æ‰€æœ‰çš„åˆ«åå¯èƒ½å¹¶ä¸åˆé€‚ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨ \u0026lt;alias/\u0026gt; æ ‡ç­¾æ¥å•ç‹¬æ˜åˆ«åã€‚ä¾‹å¦‚ï¼š\u0026lt;alias name=\u0026quot;fromName\u0026quot; alias=\u0026quot;toName\u0026quot;/\u0026gt;ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨ \u0026lt;bean/\u0026gt; ä¸­å®šä¹‰ id æˆ– name çš„å€¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™æ˜¯å®¹å™¨æˆ–è‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ª Bean çš„æ ‡è¯†ç¬¦ã€‚\nå½“æˆ‘ä»¬ä½¿ç”¨åƒ @Bean è¿™ç§åŸºäº Java çš„é…ç½®åˆ›å»º Bean æ—¶ï¼ŒBean çš„æ ‡è¯†ç¬¦é»˜è®¤ä¸ºæ–¹æ³•çš„åå­—ï¼Œä¾‹å¦‚ä¸‹é¢ä»£ç ä¸­åˆ›å»ºçš„ Bean çš„æ ‡è¯†ç¬¦å°±æ˜¯ transferServiceï¼š\n@Configuration public class AppConfig { @Bean public TransferServiceImpl transferService() { return new TransferServiceImpl(); } } depends-on æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½æ˜¯å¸Œæœ›æŸä¸ª Bean åœ¨å¦ä¸€ä¸ªæˆ–å¤šä¸ª Bean ä¹‹å‰åˆå§‹åŒ–ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ depends-onã€‚ä¾‹å¦‚ï¼š\u0026lt;bean id=\u0026quot;beanOne\u0026quot; depends-on=\u0026quot;beanTwo,beanThree\u0026quot;/\u0026gt; å‘ŠçŸ¥å®¹å™¨åœ¨åˆå§‹åŒ– beanOne ä¹‹å‰å…ˆåˆå§‹åŒ– beanTwo å’Œ beanThreeã€‚\nå»¶è¿Ÿåˆå§‹åŒ– Bean ApplicationContext é»˜è®¤ä¼šåœ¨å¯åŠ¨çš„æ—¶å€™åˆå§‹åŒ–æ‰€æœ‰çš„å•ä¾‹ Beanã€‚è™½ç„¶è¿™ç§é¥¿æ±‰å¼çš„åˆå§‹åŒ–æ–¹å¼èƒ½å¤Ÿå°½æ—©å°†é—®é¢˜æš´éœ²å‡ºæ¥ï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ› Bean åœ¨ç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨æ—¶æ‰åˆ›å»ºï¼Œå³å»¶è¿Ÿåˆå§‹åŒ–ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ lazy-init å±æ€§ã€‚ä¾‹å¦‚ï¼Œ\u0026lt;bean id=\u0026quot;beanOne\u0026quot; lazy-init=\u0026quot;true\u0026quot;/\u0026gt; å‘Šè¯‰å®¹å™¨ä¸è¦åœ¨å¯åŠ¨æ—¶åˆ›å»º beanOneï¼Œè€Œæ˜¯åœ¨ beanOne ç¬¬ä¸€æ¬¡è¢«è¯·æ±‚æ—¶æ‰åˆ›å»ºå®ƒã€‚\nBean çš„ä½œç”¨åŸŸ æˆ‘ä»¬å‰é¢æœ‰è¯´ï¼ŒIoC å®¹å™¨ä¼šä½¿ç”¨ BeanDefinition ä¸­å°è£…çš„æè¿°ä¿¡æ¯æ¥åˆ›å»º Beanã€‚Bean çš„ä½œç”¨åŸŸï¼ˆScopeï¼‰æè¿°çš„æ˜¯ï¼šåœ¨ä¸åŒåœºæ™¯ä¸‹ï¼Œ BeanDefinition å’Œé€šè¿‡å®ƒåˆ›å»ºå‡ºæ¥çš„ Bean çš„æ•°é‡å…³ç³»ã€‚åœ¨Spring ä¸­ï¼ŒBean çš„ä½œç”¨åŸŸæ˜¯ç›¸å¯¹äº IoC å®¹å™¨æ¥è¯´çš„ã€‚Spring é»˜è®¤æ”¯æŒäº†å…­ç§ä½œç”¨åŸŸï¼š\n   Scope Description     singleton é€šè¿‡å•ä¸ª BeanDefinition åˆ›å»ºçš„ Bean åœ¨å®¹å™¨å†…åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚è¿™ä¹Ÿæ˜¯é»˜è®¤çš„ä½œç”¨åŸŸ   prototype é€šè¿‡å•ä¸ª BeanDefinition å¯ä»¥åˆ›å»ºå‡ºä»»æ„æ•°é‡çš„ Bean å®ä¾‹   request åœ¨æ¯ä¸ª HTTP è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œé€šè¿‡å•ä¸ª BeanDefinition åˆ›å»ºçš„å®ä¾‹åªæœ‰ä¸€ä¸ª   session åœ¨æ¯ä¸ª HTTP ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œé€šè¿‡å•ä¸ª BeanDefinition åˆ›å»ºçš„å®ä¾‹åªæœ‰ä¸€ä¸ª   application åœ¨æ¯ä¸ª ServletContext çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œé€šè¿‡å•ä¸ª BeanDefinition åˆ›å»ºçš„å®ä¾‹åªæœ‰ä¸€ä¸ª   websocket åœ¨æ¯ä¸ª WebSocket çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œé€šè¿‡å•ä¸ª BeanDefinition åˆ›å»ºçš„å®ä¾‹åªæœ‰ä¸€ä¸ª    æ­¤å¤–ï¼ŒSpring è¿˜æ”¯æŒå¼€å‘è€…åˆ›å»ºè‡ªå®šä¹‰çš„ Bean ä½œç”¨åŸŸï¼Œå…·ä½“åšæ³•å¯ä»¥å‚è€ƒ Custom Scopesã€‚\nBean çš„ç”Ÿå‘½å‘¨æœŸ Bean æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Java å¯¹è±¡ã€‚æˆ‘ä»¬å…ˆå›é¡¾ä¸‹ Java å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼ŒJVM ä¸­çš„å¯¹è±¡ä¸€ç”Ÿå¤§æ¦‚ä¼šç»å†ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š\nç«™åœ¨ JVM çš„è§’åº¦æ¥çœ‹ï¼ŒBean çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå°±æ˜¯è¿™æ ·ã€‚ä½†æ˜¯ï¼Œç”±äº Bean æ˜¯ IoC å®¹å™¨ç®¡ç†çš„ï¼Œå®¹å™¨å¯èƒ½ç»™å®ƒå®šä¹‰é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯æ·»åŠ æ–°çš„é˜¶æ®µã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä» IoC å®¹å™¨çš„è§’åº¦çœ‹ Bean çš„ç”Ÿå‘½å‘¨æœŸã€‚\nIoC å®¹å™¨ä¸­ Bean çš„ç”Ÿå‘½å‘¨æœŸä¸»è¦æœ‰ 4 ä¸ªå¤§çš„é˜¶æ®µï¼š\n å®ä¾‹åŒ–ï¼ˆInstantiationï¼‰ åˆå§‹åŒ–ï¼ˆInitializationï¼‰ ä½¿ç”¨ï¼ˆIn Useï¼‰ é”€æ¯ï¼ˆDestructionï¼‰  è¿™å’Œ Java å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæœ‰ç‚¹ä¸ä¸€æ ·ã€‚ä½†å¦‚æœæˆ‘ä»¬å°† Bean çš„ç”Ÿå‘½å‘¨æœŸçœ‹æˆåˆ›å»ºã€ä½¿ç”¨å’Œé”€æ¯è¿™ä¸‰ä¸ªå¤§çš„é˜¶æ®µæ˜¯ä¸æ˜¯å°±å¥½ç†è§£äº†ä¸€äº›å‘¢ã€‚Bean çš„ä½¿ç”¨å°±ä¸ç”¨è¯´äº†ï¼Œé”€æ¯ä¹Ÿåªæ˜¯åœ¨å®¹å™¨å…³é—­å‰ï¼ˆè¯¦è§ ConfigurableApplicationContext#closeï¼‰è°ƒç”¨ä¸€ä¸‹ï¼Œå¤æ‚çš„éƒ½åœ¨ Bean çš„åˆ›å»ºè¿‡ç¨‹ã€‚æ‰€ä»¥ä¸‹é¢æˆ‘ä»¬é‡ç‚¹æ¥çœ‹ Bean çš„åˆ›å»ºè¿‡ç¨‹ã€‚\nBean çš„åˆ›å»º å…ˆå£°æ˜ä»¥ä¸‹ï¼Œè¿™é‡Œè¯´çš„ Bean çš„åˆ›å»ºå¹¶ä¸åªæ˜¯è¯´æŠŠ Bean å®ä¾‹åŒ–å‡ºæ¥å°±è¡Œäº†ï¼Œè€Œæ˜¯æŒ‡å®ä¾‹åŒ–å’Œåˆå§‹åŒ–ä¸¤ä¸ªæ­¥éª¤ã€‚æ™®é€šéå»¶è¿Ÿåˆå§‹åŒ–çš„ Bean åˆ›å»ºæµç¨‹çš„å…¥å£å…¶å®åœ¨ org.springframework.context.support.AbstractApplicationContext#refresh() æ–¹æ³•ä¸­çš„ finishBeanFactoryInitialization(beanFactory)ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥æ‰“å¼€æºç ä¸€æ¢ç©¶ç«Ÿã€‚ä¸€ç•ªæ¢ç´¢ä¹‹åï¼Œå‘ç°æœ€ç»ˆçš„ Bean åˆ›å»ºé€»è¾‘ä½äº org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#doCreateBean æ–¹æ³•ã€‚doCreateBean() çš„æ–¹æ³•ä½“è¿˜æ˜¯ä¸çŸ­ï¼Œä¸ºäº†æŠ“ä½ä¸»çº¿ï¼Œå…ˆè´´å‡ºä¸»å¹²ä»£ç ï¼š\nprotected Object doCreateBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) throws BeanCreationException { // Instantiate the bean. \tBeanWrapper instanceWrapper = null; if (mbd.isSingleton()) { instanceWrapper = this.factoryBeanInstanceCache.remove(beanName); } if (instanceWrapper == null) { instanceWrapper = createBeanInstance(beanName, mbd, args); } Object bean = instanceWrapper.getWrappedInstance(); // ...  // Allow post-processors to modify the merged bean definition. \tsynchronized (mbd.postProcessingLock) { if (!mbd.postProcessed) { try { applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName); } catch (Throwable ex) { // ... \t} mbd.postProcessed = true; } } // Eagerly cache singletons to be able to resolve circular references \t// even when triggered by lifecycle interfaces like BeanFactoryAware. \tboolean earlySingletonExposure = (mbd.isSingleton() \u0026amp;\u0026amp; this.allowCircularReferences \u0026amp;\u0026amp; isSingletonCurrentlyInCreation(beanName)); if (earlySingletonExposure) { // ... \taddSingletonFactory(beanName, () -\u0026gt; getEarlyBeanReference(beanName, mbd, bean)); } // Initialize the bean instance. \tObject exposedObject = bean; try { populateBean(beanName, mbd, instanceWrapper); exposedObject = initializeBean(beanName, exposedObject, mbd); } catch (Throwable ex) { // ... \t} // Register bean as disposable. \ttry { registerDisposableBeanIfNecessary(beanName, bean, mbd); } catch (BeanDefinitionValidationException ex) { // ... \t} return exposedObject; } è¿™ä»£ç å°±æ¸…çˆ½å¤šäº†ã€‚æ‰€ä»¥ Bean çš„åˆ›å»ºæ­¥éª¤ä¸»è¦æ˜¯ä»¥ä¸‹å‡ æ­¥ï¼š\nBeanPostProcessor BeanPostProcessor å…è®¸æˆ‘ä»¬å¯¹ Bean è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶å¤„ç†ã€‚è¯¥æ¥å£æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š\n postProcessBeforeInitialization(Object bean, String beanName)ï¼šåœ¨ Bean åˆå§‹åŒ–ä¹‹å‰è°ƒç”¨ postProcessAfterInitialization(Object bean, String beanName)ï¼šåœ¨ Bean åˆå§‹åŒ–ä¹‹åè°ƒç”¨  BeanPostProcessor æœ‰ä¸€ç³»åˆ—çš„å­æ¥å£ï¼Œæ¯”å¦‚ InstantiationAwareBeanPostProcessor ã€DestructionAwareBeanPostProcessorã€BeanFactoryPostProcessorã€ApplicationContextAwareProcessor ç­‰ã€‚BeanPostProcessor ç³»åˆ—æ¥å£ä¸­çš„å›è°ƒæ˜¯å®¹å™¨çº§åˆ«çš„ï¼Œå¯¹æ‰€æœ‰çš„ Bean ç”Ÿæ•ˆã€‚ä¸åŒå­æ¥å£å‘æŒ¥ä½œç”¨çš„æ—¶é—´ä¸åŒï¼Œåé¢ä¼šè¿›è¡Œä»‹ç»ã€‚\nå®ä¾‹åŒ– Bean åˆ›å»º Bean çš„ç¬¬ä¸€æ­¥æ˜¯å®ä¾‹åŒ–ï¼Œå…¥å£æ–¹æ³•æ˜¯ AbstractAutowireCapableBeanFactory#createBeanInstanceã€‚å®¹å™¨ä¼šæ ¹æ®é…ç½®å…ƒæ•°æ®ï¼Œé‡‡å–åˆé€‚çš„ç­–ç•¥ï¼ˆå·¥å‚æ–¹æ³•æˆ–æ„é€ å™¨ï¼‰å®ä¾‹åŒ– Beanã€‚\nInstantiationAwareBeanPostProcessor æä¾›äº†ä¸‰ä¸ªéå¸¸é‡è¦çš„æ–¹æ³•ï¼š\n postProcessBeforeInstantiation(Class\u0026lt;?\u0026gt; beanClass, String beanName)ï¼šåœ¨å®ä¾‹åŒ– Bean ä¹‹å‰è°ƒç”¨ postProcessAfterInstantiation(Object bean, String beanName)ï¼šåœ¨å®ä¾‹åŒ– Bean ä¹‹åã€æ­£å¼å¡«å……å±æ€§ä¹‹å‰è°ƒç”¨ postProcessProperties(PropertyValues pvs, Object bean, String beanName)ï¼šåœ¨å¡«å……å±æ€§ä¹‹å‰å¯¹å±æ€§å€¼ä½œå¤„ç†  åŠ å…¥è¿™ä¸‰ä¸ªæ–¹æ³•ä¹‹åçš„ Bean åˆ›å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼š\nåˆå§‹åŒ– Bean åˆå§‹åŒ– Bean çš„å…¥å£æ–¹æ³•æ˜¯ AbstractAutowireCapableBeanFactory#initializeBeanï¼Œä¸»å¹²ä»£ç å¦‚ä¸‹ï¼š\nprotected Object initializeBean(String beanName, Object bean, @Nullable RootBeanDefinition mbd) { invokeAwareMethods(beanName, bean); Object wrappedBean = bean; if (mbd == null || !mbd.isSynthetic()) { wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName); } try { invokeInitMethods(beanName, wrappedBean, mbd); } catch (Throwable ex) { // ... \t} if (mbd == null || !mbd.isSynthetic()) { wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName); } return wrappedBean; } ä»ä¸Šåˆ°ä¸‹çš„é€»è¾‘ä¸»è¦æ˜¯ï¼šè°ƒç”¨ Aware ç±»å‹çš„å›è°ƒæ–¹æ³•ï¼ŒBeanPostProcessor åˆå§‹åŒ–å‰ç½®å¤„ç†ï¼Œè°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ï¼Œè°ƒç”¨ BeanPostProcessor åˆå§‹åŒ–åç½®å¤„ç†ã€‚æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥çœ‹ã€‚\nBean åˆå§‹åŒ– Aware Aware ç±»å‹çš„æ¥å£ä¼—å¤šï¼Œä½†æ˜¯åœ¨ Bean çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­åªå¯èƒ½ä¼šè°ƒç”¨ BeanNameAwareã€BeanClassLoaderAware å’Œ BeanFactoryAware ä¸‰ä¸ªæ¥å£çš„å›è°ƒæ–¹æ³•ã€‚å…·ä½“é€»è¾‘å¯ä»¥å‚è€ƒAbstractAutowireCapableBeanFactory#initializeBean æ–¹æ³•è°ƒç”¨çš„ invokeAwareMethods(beanName, bean) æ–¹æ³•ã€‚æ–¹æ³•ä¸é•¿ï¼Œæˆ‘ç›´æ¥è´´å‡ºæ¥ï¼š\nprivate void invokeAwareMethods(String beanName, Object bean) { if (bean instanceof Aware) { if (bean instanceof BeanNameAware) { ((BeanNameAware) bean).setBeanName(beanName); } if (bean instanceof BeanClassLoaderAware) { ClassLoader bcl = getBeanClassLoader(); if (bcl != null) { ((BeanClassLoaderAware) bean).setBeanClassLoader(bcl); } } if (bean instanceof BeanFactoryAware) { ((BeanFactoryAware) bean).setBeanFactory(AbstractAutowireCapableBeanFactory.this); } } } æ­£å¼åˆå§‹åŒ– org.springframework.beans.factory.InitializingBean å…è®¸ Bean åœ¨æ‰€æœ‰å±æ€§å¡«å……å®Œæ¯•ä¹‹åæ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œæ¥å£å®šä¹‰å¦‚ä¸‹ï¼š\npublic interface InitializingBean { /** * Invoked by the containing BeanFactory after it has set all bean properties * and satisfied BeanFactoryAware, ApplicationContextAware etc. */ void afterPropertiesSet() throws Exception; } afterPropertiesSet() æ–¹æ³•ä¼šåœ¨ Bean çš„å±æ€§è®¾ç½®å®Œæ¯•ã€å„ç§ Aware è°ƒç”¨å®Œæˆä¹‹åæ‰§è¡Œã€‚å®é™…ä¸Šï¼ŒSpring å¹¶ä¸æ¨èæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ¥å£æ¥è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´æˆ‘ä»¬çš„ä»£ç ä¸ Spring æ¡†æ¶å¼ºè€¦åˆã€‚æ¨èçš„åšæ³•æ˜¯ä½¿ç”¨è‡ªå®šä¹‰çš„ init() æ–¹æ³•æˆ– JSR-250 å®šä¹‰çš„ @PostConstruct æ³¨è§£ã€‚\ninvokeInitMethods() æ–¹æ³•ä¼šå°è¯•å…ˆåˆ¤æ–­ Bean æ˜¯å¦å®ç° InitializingBean æ¥å£ã€‚è‹¥æ˜¯ï¼Œåˆ™è°ƒç”¨ Bean çš„ afterPropertiesSet() æ–¹æ³•ã€‚ç„¶åï¼Œåˆ¤æ–­ Bean æ˜¯å¦æœ‰è‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•ã€‚è‹¥æœ‰ï¼Œåˆ™è°ƒç”¨è‡ªå®šä¹‰çš„ init() æ–¹æ³•ã€‚ä½ å¯èƒ½å·²ç»å‘ç°äº†ï¼Œè¿™é‡Œæ²¡æœ‰è°ƒç”¨ @PostConstruct æ³¨è§£çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨ #BeanPostProcessor#postProcessBeforeInitialization ä¸­è°ƒç”¨çš„ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥æŸ¥çœ‹ InitDestroyAnnotationBeanPostProcessor#postProcessBeforeInitialization çš„æºç ã€‚invokeInitMethods() çš„ä¸»å¹²ä»£ç å¦‚ä¸‹ï¼š\nprotected void invokeInitMethods(String beanName, Object bean, @Nullable RootBeanDefinition mbd) throws Throwable { boolean isInitializingBean = (bean instanceof InitializingBean); if (isInitializingBean \u0026amp;\u0026amp; (mbd == null || !mbd.isExternallyManagedInitMethod(\u0026#34;afterPropertiesSet\u0026#34;))) { // ...  ((InitializingBean) bean).afterPropertiesSet(); // ... \t} if (mbd != null \u0026amp;\u0026amp; bean.getClass() != NullBean.class) { String initMethodName = mbd.getInitMethodName(); if (StringUtils.hasLength(initMethodName) \u0026amp;\u0026amp; !(isInitializingBean \u0026amp;\u0026amp; \u0026#34;afterPropertiesSet\u0026#34;.equals(initMethodName)) \u0026amp;\u0026amp; !mbd.isExternallyManagedInitMethod(initMethodName)) { invokeCustomInitMethod(beanName, bean, mbd); } } } åˆ°è¿™é‡Œï¼ŒBean çš„åˆå§‹åŒ–è¿‡ç¨‹åŸºæœ¬å°±åˆ†æå®Œäº†ï¼Œæˆ‘ä»¬æ¥å®Œå–„ä¸€ä¸‹ä¹‹å‰çš„å›¾ï¼š\né”€æ¯ Bean è·Ÿ InitializingBean ç±»ä¼¼ï¼ŒSpring ä¸ºæˆ‘ä»¬æä¾›äº† DisposableBean ç”¨äºå®¹å™¨å…³é—­å‰æ‰§è¡Œ Bean çš„æ¸…ç†å·¥ä½œã€‚Spring å¹¶ä¸æ¨èæˆ‘ä»¬ä½¿ç”¨å®ƒï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´ç¨‹åºä»£ç ä¸ Spring å¼ºè€¦åˆã€‚æ¨èçš„åšæ³•æ˜¯ä½¿ç”¨ JSR-250 å®šä¹‰çš„ @PreDestroy æ³¨è§£æˆ–é…ç½®è‡ªå®šä¹‰çš„ destroy() æ–¹æ³•ã€‚å¦‚æœåŒæ—¶ä½¿ç”¨äº†å‡ ç§ï¼Œé‚£ä¹ˆæ–¹æ³•çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š\n @PreDestroy æ³¨è§£çš„æ–¹æ³• DisposableBean çš„ destory() æ–¹æ³• é…ç½®çš„è‡ªå®šä¹‰ destroy() æ–¹æ³•  åˆ°è¿™é‡Œï¼ŒBean çš„ç”Ÿå‘½å‘¨æœŸåŸºæœ¬å°±ä»‹ç»å®Œäº†ã€‚ç”¨ä¸€å¼ å›¾æ€»ç»“ä¸‹ï¼š\nå…¶å®ƒ Aware æ¥å£ é™¤äº†ä¹‹å‰æåˆ°è¿‡çš„ Aware æ¥å£ï¼ŒSpring è¿˜ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šå…¶å®ƒçš„ Aware æ¥å£ã€‚è¿™äº›æ¥å£å‘Šè¯‰ IoC å®¹å™¨ Bean éœ€è¦å¯¹åº”çš„ä¾èµ–ã€‚ä¾‹å¦‚ ApplicationContextAware å…è®¸ Bean è·å¾—ä¸€ä¸ª ApplicationContext çš„å¼•ç”¨ï¼ŒResourceLoaderAware å…è®¸ Bean è·å¾—ä¸€ä¸ª ResourceLoader çš„å¼•ç”¨ã€‚\nä¸€ä¸ªä¾‹å­ çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚ä¸‹é¢ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­åŠ æ·±å¯¹ Bean ç”Ÿå‘½å‘¨æœŸçš„ç†è§£ã€‚\nå…ˆå®šä¹‰ä¸€ä¸ª Bean ç±»ï¼Œå®ƒå®ç°äº†ä¼—å¤šçš„æ¥å£ï¼ŒåŒ…å«è‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•å’Œè‡ªå®šä¹‰çš„é”€æ¯æ–¹æ³•ï¼Œä»¥åŠä¸€ä¸ªæ™®é€šæ–¹æ³• hello()ï¼š\npublic class MySpringBean implements ApplicationContextAware, BeanNameAware, BeanClassLoaderAware, BeanFactoryAware, InitializingBean, DisposableBean { @Override public void setBeanClassLoader(ClassLoader classLoader) { System.out.println(\u0026#34;Executing setBeanClassLoader...\u0026#34;); } @Override public void setBeanFactory(BeanFactory beanFactory) throws BeansException { System.out.println(\u0026#34;Executing setBeanFactory...\u0026#34;); } @Override public void setBeanName(String s) { System.out.println(\u0026#34;Executing setBeanName...\u0026#34;); } @Override public void destroy() throws Exception { System.out.println(\u0026#34;Executing destroy...\u0026#34;); } @Override public void afterPropertiesSet() throws Exception { System.out.println(\u0026#34;Executing afterPropertiesSet...\u0026#34;); } @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException { System.out.println(\u0026#34;Executing setApplicationContext...\u0026#34;); } @PostConstruct public void postConstruct() { System.out.println(\u0026#34;Executing @PostConstruct...\u0026#34;); } @PreDestroy public void preDestroy() { System.out.println(\u0026#34;Executing @PreDestroy...\u0026#34;); } public void customInitMethod() { System.out.println(\u0026#34;Executing custom init method...\u0026#34;); } public void customDestroyMethod() { System.out.println(\u0026#34;Executing custom destroy method...\u0026#34;); } public void hello() { System.out.println(\u0026#34;Hello, Spring!\u0026#34;); } } ç„¶åå®šä¹‰ä¸€ä¸ª BeanPostProcessor çš„å®ç°ç±»ï¼š\npublic class MyBeanPostProcessor implements BeanPostProcessor { @Override public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException { System.out.println(\u0026#34;Executing postProcessBeforeInitialization of \u0026#34; + beanName + \u0026#34; ...\u0026#34;); return bean; } @Override public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException { System.out.println(\u0026#34;Executing postProcessAfterInitialization of \u0026#34; + beanName + \u0026#34; ...\u0026#34;); return bean; } } å†å®šä¹‰ä¸€ä¸ª InstantiationAwareBeanPostProcessor çš„å®ç°ç±»ï¼š\npublic class MyInstantiationAwareBeanPostProcessor implements InstantiationAwareBeanPostProcessor { @Override public Object postProcessBeforeInstantiation(Class\u0026lt;?\u0026gt; beanClass, String beanName) throws BeansException { System.out.println(\u0026#34;Executing postProcessBeforeInstantiation of \u0026#34; + beanName + \u0026#34; ...\u0026#34;); return null; } @Override public boolean postProcessAfterInstantiation(Object bean, String beanName) throws BeansException { System.out.println(\u0026#34;Executing postProcessAfterInstantiation of \u0026#34; + beanName + \u0026#34; ...\u0026#34;); return true; } @Override public PropertyValues postProcessProperties(PropertyValues pvs, Object bean, String beanName) throws BeansException { System.out.println(\u0026#34;Executing postProcessProperties of \u0026#34; + beanName + \u0026#34; ...\u0026#34;); return pvs; } } ä»¥åŠä¸€ä¸ªé…ç½®ç±»ï¼š\n@Configuration public class MyLifeCycleConfiguration { @Bean public MyBeanPostProcessor myBeanPostProcessor() { return new MyBeanPostProcessor(); } @Bean public MyInstantiationAwareBeanPostProcessor myInstantiationAwareBeanPostProcessor() { return new MyInstantiationAwareBeanPostProcessor(); } @Bean(initMethod = \u0026#34;customInitMethod\u0026#34;, destroyMethod = \u0026#34;customDestroyMethod\u0026#34;) public MySpringBean mySpringBean() { return new MySpringBean(); } } æœ€åå†™ä¸€ä¸ªæµ‹è¯•ï¼š\n@SpringBootTest class BeanLifecycleApplicationTests { @Autowired private MySpringBean mySpringBean; @Test void testMySpringBeanLifecycle() { mySpringBean.hello(); } } ç°åœ¨è¿è¡Œæµ‹è¯•ï¼Œå„ä¸ªç”Ÿå‘½å‘¨æœŸå›è°ƒçš„æ‰§è¡Œæ­¥éª¤å°±ä¸€è§ˆæ— ä½™å•¦ã€‚ç”±äºå®¹å™¨é»˜è®¤è¿˜ä¼šåˆ›å»ºå…¶å®ƒ Beanï¼Œæ•°é‡è¿˜ä¸å°‘ï¼Œå½±å“æˆ‘ä»¬è§‚å¯Ÿã€‚æ‰€ä»¥ä¸‹é¢æ‰§è¡Œç»“æœä¸­åªåˆ—å‡ºäº†ä¸ MySpringBean ç›¸å…³çš„æ‰§è¡Œç»“æœï¼š\nExecuting postProcessBeforeInstantiation of mySpringBean ... Executing postProcessAfterInstantiation of mySpringBean ... Executing postProcessProperties of mySpringBean ... Executing setBeanName... Executing setBeanClassLoader... Executing setBeanFactory... Executing setApplicationContext... Executing postProcessBeforeInitialization of mySpringBean ... Executing @PostConstruct... Executing afterPropertiesSet... Executing custom init method... Executing postProcessAfterInitialization of mySpringBean ... Hello, Spring! Executing @PreDestroy... Executing destroy... Executing custom destroy method... å®Œæ•´ä»£ç å·²ç»æ”¾åˆ° Githubã€‚\næœªå®Œå¾…ç»­ æ—¶é—´æœ‰é™ï¼Œå…ˆå†™åˆ°è¿™é‡Œã€‚å†™ä¸œè¥¿ä»æ¥éƒ½ä¸æ˜¯ä¸€æ¬¡æ€§è¿‡ç¨‹ï¼Œè¦å¸¸çœ‹ï¼Œå¸¸æ€è€ƒï¼Œå¸¸æ›´æ–°ã€‚\nå‚è€ƒèµ„æ–™  Spring Framework Documentation. ä¸€æ–‡è¯»æ‡‚ Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ.  ","href":"/java/spring/spring-ioc/","title":"Spring Ioc"},{"content":"","href":"/tags/redis/","title":"Redis"},{"content":"","href":"/categories/redis/","title":"Redis"},{"content":"ä½œä¸ºä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼ŒRedis çš„å®¹é‡è‚¯å®šæ˜¯æœ‰é™çš„ã€‚å¦‚æœ Redis å…è®¸æˆ‘ä»¬ä¸æ–­å†™å…¥æ•°æ®è€Œåˆä¸ä½œä»»ä½•æ¸…ç†å·¥ä½œçš„è¯ï¼Œå†…å­˜è¿Ÿæ—©è¦è¢«è€—å°½ã€‚æ­¤å¤–ï¼Œè‹¥æˆ‘ä»¬åœ¨ Redis ä¸­åˆ›å»ºäº†ä¸€ä¸ªä¸å¸¦è¿‡æœŸæ—¶é—´çš„ keyï¼Œè¿™ä¸ª key å³ä½¿ä¸è¢«ä½¿ç”¨ï¼Œå®ƒä¹Ÿä¼šåœ¨æˆ‘ä»¬ä½¿ç”¨ DEL å‘½ä»¤åˆ é™¤å®ƒä¹‹å‰ä¸€ç›´å­˜åœ¨äº Redis ä¸­ï¼Œè¿™å¯ä¸æ˜¯ä¸€ä»¶å¥½äº‹å„¿ã€‚æ‰€ä»¥ï¼Œä¸º key è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚é‚£ä¹ˆï¼ŒRedis æ˜¯å¦‚ä½•è®© key è¿‡æœŸçš„å‘¢ï¼Œå®ƒåˆæ˜¯å¦‚ä½•æ·˜æ±°è¿‡æœŸçš„ key çš„å‘¢ï¼Ÿè¿™å°±æ˜¯æœ¬æ–‡è¦å°†çš„ä¸»è¦å†…å®¹ã€‚\nkey è¿‡æœŸ æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»º key æ—¶æŒ‡å®šå®ƒçš„å­˜æ´»æ—¶é—´ï¼Œä¹Ÿå¯ä»¥ç”¨ EXPIRE key seconds [NX|XX|GT|LT] å‘½ä»¤ç»™ key è®¾ç½®å­˜æ´»æ—¶é—´ã€‚å½“ key è¿‡æœŸæ—¶ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚\nRedis ä½¿ç”¨ volatile è¿™ä¸ªæœ¯è¯­æ¥æè¿°å¸¦æœ‰è¿‡æœŸæ—¶é—´çš„ keyï¼Œæˆ‘ä»¬ä¼šåœ¨ key çš„æ·˜æ±°ç­–ç•¥ä¸­å†æ¬¡ä¸è¿™ä¸ªæœ¯è¯­è§é¢ã€‚å¯¹äºä¸å¸¦è¿‡æœŸæ—¶é—´çš„ keyï¼ŒRedis ä¹Ÿæœ‰ä¸€ä¸ªä¸“é—¨çš„æœ¯è¯­ï¼Œé‚£å°±æ˜¯ persistentã€‚\nç›¸å…³å‘½ä»¤ Redis æ”¯æŒä¸å°‘ä¸ key è¿‡æœŸæœ‰å…³çš„å‘½ä»¤ï¼ŒåŒ…æ‹¬ä¸º key è®¾ç½®è¿‡æœŸæ—¶é—´ã€æŸ¥çœ‹ key è¿˜æœ‰å¤šä¹…è¿‡æœŸå’Œç§»é™¤ key çš„è¿‡æœŸæ—¶é—´ã€‚\nä¸º key è®¾ç½®è¿‡æœŸæ—¶é—´ ç›¸å…³å‘½ä»¤æœ‰ï¼š\n EXPIREï¼šè®¾ç½® key çš„å­˜æ´»æ—¶é—´ï¼Œå•ä½ä¸ºç§’ PEXPIREï¼šè®¾ç½® key çš„å­˜æ´»æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ EXPIREATï¼šè®¾ç½® key è¿‡æœŸçš„ UNIX æ—¶é—´æˆ³ï¼Œå•ä½ä¸ºç§’ PEXPIREATï¼šè®¾ç½® key è¿‡æœŸçš„ UNIX æ—¶é—´æˆ³ï¼Œå•ä½ä¸ºæ¯«ç§’  EXPIRE å’Œ PEXPIRE è®¾ç½®çš„æ˜¯ key çš„å­˜æ´»æ—¶é—´ï¼ˆtime to liveï¼‰ï¼Œkey çš„å­˜æ´»æ—¶é—´ä¼šéšç€æ—¶é—´çš„æµé€è€Œä¸æ–­å‡å°‘ï¼Œå½“å€¼ä¸º 0 æ—¶ï¼ŒRedis å°±ä¼šç§»é™¤è¿™ä¸ª keyã€‚EXPIREAT å’Œ PEXPIRE è®¾ç½®çš„æ˜¯ key çš„è¿‡æœŸæ—¶é—´ï¼ˆexpire timeï¼‰ï¼Œå½“ç³»ç»Ÿçš„å½“å‰ UNIX æ—¶é—´è¶…è¿‡è®¾ç½®çš„æ—¶é—´åï¼Œkey å°±ä¼šè¢«åˆ é™¤ã€‚\næŸ¥çœ‹ key è¿˜æœ‰å¤šä¹…è¿‡æœŸ ç›¸å…³å‘½ä»¤æœ‰ï¼š\n TTLï¼šæŸ¥çœ‹ key çš„å‰©ä½™å­˜æ´»æ—¶é—´ï¼Œå•ä½ä¸ºç§’ PTTLï¼šæŸ¥çœ‹ key çš„å‰©ä½™å­˜æ´»æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’  ç§»é™¤ key çš„è¿‡æœŸæ—¶é—´ PERSIST å‘½ä»¤å¯ä»¥ç§»é™¤ key çš„è¿‡æœŸæ—¶é—´ï¼Œå°† key ä» volatile å˜æˆ persistentã€‚\nå…·ä½“åšæ³• Redis ä¸­çš„ key æœ‰ä¸¤ç§è¿‡æœŸæ–¹å¼ï¼šè¢«åŠ¨è¿‡æœŸå’Œä¸»åŠ¨è¿‡æœŸã€‚\nRedis ä½¿ç”¨ç»å¯¹çš„æ¯«ç§’çº§ UNIX æ—¶é—´æˆ³æ¥å­˜å‚¨ key çš„è¿‡æœŸæ—¶é—´ã€‚ä»»ä½•æ—¶å€™ï¼Œå½“æŸä¸ª key è¢«è®¿é—®æ—¶ï¼Œå¦‚æœç³»ç»Ÿçš„å½“å‰ UNIX æ—¶é—´è¶…è¿‡äº†å®ƒçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ª key å°±ä¼šè¢«åŠ¨è¿‡æœŸã€‚ä½†æ˜¯ï¼Œæœ‰äº› key å¯èƒ½æ°¸è¿œä¹Ÿä¸ä¼šè¢«è®¿é—®ï¼Œè€Œå®ƒä»¬ä¹Ÿéœ€è¦è¢«è¿‡æœŸï¼Œè¿™å°±éœ€è¦ç”¨åˆ°ä¸»åŠ¨è¿‡æœŸã€‚\nRedis ä¼šå‘¨æœŸæ€§åœ°ä»å¸¦è¿‡æœŸæ—¶é—´çš„ key ä¸­éšæœºé€‰å–ä¸€éƒ¨åˆ†è¿›è¡Œæ£€æµ‹ï¼Œç„¶ååˆ é™¤å…¶ä¸­å·²ç»è¿‡æœŸçš„é‚£äº› keyã€‚å®é™…ä¸Šï¼ŒRedis æ¯ç§’éƒ½ä¼šè¿›è¡Œåæ¬¡ä¸‹é¢çš„æ“ä½œï¼š\n ä»æ‰€æœ‰å¸¦æœ‰è¿‡æœŸæ—¶é—´çš„ key ä¸­éšæœºé€‰å– 20 ä¸ª åˆ é™¤å…¶ä¸­è¿‡æœŸçš„é‚£äº› key å¦‚æœè¿‡æœŸçš„ key è¶…è¿‡ 5 ä¸ªï¼ˆè¿‡æœŸå æ¯”å¤§äº 25%ï¼‰ï¼Œç»§ç»­è¿›å…¥æ­¥éª¤ 1  key çš„æ·˜æ±°æœºåˆ¶ å½“æŠŠ Redis ä½œä¸ºç¼“å­˜ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ˜¯å¸Œæœ› Redis èƒ½å¤Ÿåœ¨æˆ‘ä»¬æ·»åŠ æ–°æ•°æ®æ—¶è‡ªåŠ¨æ·˜æ±°æ—§çš„æ•°æ®ã€‚å½“ç„¶ï¼Œä½œä¸ºä¸€ä¸ªä¼˜ç§€çš„ç¼“å­˜ç»„ä»¶ï¼ŒRedis æ—©å·²è€ƒè™‘åˆ°äº†è¿™äº›ï¼Œå®ƒè¿˜ç»™æˆ‘ä»¬æä¾›äº†å¤šç§ä¸åŒçš„æ·˜æ±°ç­–ç•¥ã€‚redis.conf ä¸­æœ‰ä¸€ä¸ªåä¸º maxmemory çš„é…ç½®é¡¹ï¼Œç”¨æ¥æŒ‡å®š Redis å¯ä½¿ç”¨çš„å†…å­˜é˜ˆå€¼ã€‚å½“ key è¿‡æœŸï¼Œæˆ–è€… Redis åœ¨æ‰§è¡Œæ–°å‘½ä»¤æ—¶å‘ç°å®é™…å†…å­˜å ç”¨è¶…è¿‡äº† maxmemory è®¾ç½®çš„é˜ˆå€¼ä¹‹åï¼ŒRedis å°±ä¼šæ ¹æ®maxmemory-policy é…ç½®çš„æ·˜æ±°ç­–ç•¥æ·˜æ±°è¿‡æœŸæˆ–è€…ä¸æ´»è·ƒçš„ keyï¼Œå›æ”¶å†…å­˜ï¼Œä¾›æ–°çš„ key ä½¿ç”¨ã€‚maxmemory=0 è¡¨ç¤ºä¸å¯¹å†…å­˜åšé™åˆ¶ï¼Œå¯ä»¥ä¸æ–­å­˜å…¥æ•°æ®ï¼ŒRedis è¢«ç”¨ä½œå†…å­˜æ•°æ®åº“ï¼Œé€‚åˆæ•°æ®é‡è¾ƒå°çš„ä¸šåŠ¡ã€‚å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œå°±éœ€è¦ç»™ maxmemory è®¾ç½®ä¸€ä¸ªåˆé€‚çš„å€¼ï¼Œå°† Redis ä½œä¸ºç¼“å­˜ä½¿ç”¨ã€‚\næ·˜æ±°ç­–ç•¥ Redis æä¾›äº†å…«ç§æ·˜æ±°ç­–ç•¥ï¼š\n   ç­–ç•¥ï¼ˆPolicyï¼‰ æè¿°ï¼ˆDescriptionï¼‰     noeviction åœ¨æ’å…¥æ–°æ•°æ®æ—¶ï¼Œè‹¥å†…å­˜è¶…è¿‡é™åˆ¶ï¼Œåˆ™è¿”å›é”™è¯¯ï¼Œä¸æ·˜æ±°ä»»ä½• key   allkeys-lru é‡‡ç”¨ LRU ç®—æ³•å¯¹æ‰€æœ‰ key è¿›è¡Œæ·˜æ±°   allkeys-lfu é‡‡ç”¨ LRU ç®—æ³•å¯¹æ‰€æœ‰ key è¿›è¡Œæ·˜æ±°   allkeys-random é‡‡ç”¨éšæœºç®—æ³•å¯¹æ‰€æœ‰ key è¿›è¡Œæ·˜æ±°   volatile-lru é‡‡ç”¨ LRU ç®—æ³•å¯¹å¸¦è¿‡æœŸæ—¶é—´çš„ key è¿›è¡Œæ·˜æ±°   volatile-lfu é‡‡ç”¨ LFU ç®—æ³•å¯¹å¸¦è¿‡æœŸæ—¶é—´çš„ key è¿›è¡Œæ·˜æ±°   volatile-random é‡‡ç”¨éšæœºç®—æ³•å¯¹å¸¦è¿‡æœŸæ—¶é—´çš„ key è¿›è¡Œæ·˜æ±°   volatile-ttl æ·˜æ±°å¸¦è¿‡æœŸæ—¶é—´çš„ key ä¸­å­˜æ´»æ—¶é—´æœ€çŸ­çš„ key    å…«ç§æ·˜æ±°ç­–ç•¥å„æœ‰ä¸åŒçš„é€‚ç”¨åœºæ™¯ï¼šnoeviction æ˜¯ Redis çš„é»˜è®¤ key æ·˜æ±°æœºåˆ¶ï¼Œé€‚ç”¨äºæ•°æ®é‡ä¸å¤ªå¤§çš„åœºæ™¯ï¼Œå› ä¸ºæ­¤æ—¶ Redis è¢«å½“æˆäº†å†…å­˜æ•°æ®åº“ä½¿ç”¨ï¼›éšæœºç­–ç•¥é€‚ç”¨äº key æ²¡æœ‰æ˜æ˜¾çƒ­ç‚¹çš„åœºæ™¯ï¼›LRU æ·˜æ±°ç­–ç•¥é€‚ç”¨äºæ•°æ®æœ‰å†·çƒ­è¯»å†™åŒºåˆ†çš„åœºæ™¯ï¼›LFU ä¹Ÿé€‚ç”¨äºæ•°æ®æœ‰å†·çƒ­è¯»å†™åŒºåˆ†çš„åœºæ™¯ï¼Œä¸”è¶Šçƒ­çš„æ•°æ®çš„è®¿é—®é¢‘ç‡è¶Šé«˜ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼šRedis ä¸ºäº†èŠ‚çœå†…å­˜ï¼Œå¹¶æ²¡æœ‰å®ç°å®Œæ•´çš„ LRU ç®—æ³•å’Œ LFU ç®—æ³•ï¼Œè€Œæ˜¯é‡‡ç”¨äº†è¿‘ä¼¼å®ç°ã€‚\nå‚è€ƒèµ„æ–™  Redis Command Reference. Redis expires. Using Redis as an LRU cache.  ","href":"/posts/redis/key_expiration_and_eviction_in_redis/","title":"Redis ä¸­çš„ key è¿‡æœŸä¸æ·˜æ±°æœºåˆ¶"},{"content":"","href":"/tags/english/","title":"English"},{"content":"","href":"/categories/english/","title":"English"},{"content":" ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬åœ¨è‹±è¯­ä¸­ä¸€èˆ¬ç”¨ AMï¼ˆæˆ– A.M.ï¼‰è¡¨ç¤ºä¸Šåˆï¼Œç”¨ PMï¼ˆæˆ– P.M.ï¼‰è¡¨ç¤ºä¸‹åˆã€‚å½“ç„¶ï¼Œè¿™ä¸€ç‚¹æˆ‘ä¹ŸçŸ¥é“ã€‚ä¸ä»…å¦‚æ­¤ï¼Œç¬”è€…è¿˜å¤©çœŸçš„è®¤ä¸º 12:00 PM è¡¨ç¤ºä¸‹åˆåäºŒç‚¹ï¼Œå³åˆå¤œã€‚ä»Šå¤©ç¬”è€…å»æŸå…¬å¸é¢è¯•ï¼Œåšäº†ä¸€é“é¢˜ï¼Œå…¶ä¸­å°±éœ€è¦ç”¨åˆ°è¿™ä¸ª 12:00 PMã€‚æ ¹æ®é¢˜ç›®è¦æ±‚ï¼Œæˆ‘æ€»æ„Ÿè§‰æŠŠ 12:00 PM å½“æˆåˆå¤œæœ‰ç‚¹æ€ªæ€ªçš„ï¼Œäºæ˜¯æˆ‘æ‰“å¼€äº†æˆ‘çš„ Chrome æ’ä»¶æ²™æ‹‰æŸ¥è¯ï¼Œç¡®è®¤äº† PM çš„ç¡®è¡¨ç¤ºä¸‹åˆï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯æŠŠå®ƒå½“æˆåˆå¤œå¤„ç†äº†ã€‚ç›´åˆ°åé¢ï¼Œæˆ‘åœ¨ç»™é¢è¯•å®˜è®²æˆ‘çš„è§£é¢˜æ€è·¯æ—¶ï¼Œé¢è¯•å®˜å’Œè”¼çš„å‘Šè¯‰æˆ‘ 12:00 PM è¡¨ç¤ºä¸­åˆåäºŒç‚¹ï¼Œæˆ‘å·®ç‚¹å½“åœºå»ä¸–â€¦â€¦ğŸ˜¶ã€‚ä¸è¿‡ç¬”è€…å½“æ—¶çš„å†…å¿ƒä»ç„¶è¡¨ç¤ºæ€€ç–‘ï¼Œä½†æ˜¯è¿™ä¸ªä¸­åˆåäºŒç‚¹å°±è®©é¢˜ç›®é‡Œé¢çš„å…¶å®ƒæ¡ä»¶æœ‰äº†æ„ä¹‰ï¼Œæ‰€ä»¥å°±æš‚æ—¶è®¤ä¸ºé¢è¯•å®˜è¯´çš„æ˜¯å¯¹çš„ã€‚ç†¬è¿‡å‡ è½®é¢è¯•ï¼Œç¬”è€…çš„æ€ç»´æ—©å·²è¢«å¸¦å‘äº†å¤©å—æµ·åŒ—ï¼Œå›åˆ°å®¶åï¼Œçªç„¶æƒ³èµ·äº†è¿™ä»¶å°´å°¬çš„äº‹æƒ…ï¼Œé‚æ‰“å¼€ Googleï¼Œå¼€å§‹æ¢ç´¢çœŸçŸ¥â€¦â€¦\n å°±è¿å°å­¦ç”Ÿéƒ½çŸ¥é“ï¼Œä¸€å¤©æœ‰ 24 ä¸ªå°æ—¶ã€‚ä½†ç”±äºå†å²å’Œæ–‡åŒ–çš„å·®å¼‚ï¼Œä¸åŒåœ°æ–¹ä½¿ç”¨äº†ä¸åŒçš„äº‹ä»¶è¡¨ç¤ºæ–¹æ³•ã€‚\nåœ¨ä¸­å›½å¤ä»£ï¼Œäººä»¬ä½¿ç”¨â€œé“œå£¶æ»´æ¼â€è®¡ç®—æ—¶é—´ï¼ŒæŠŠä¸€æ˜¼å¤œåˆ†ä¸ºåäºŒæ—¶è¾°ï¼Œå³å­ã€ä¸‘ã€å¯…ã€å¯ã€è¾°ã€å·³ã€åˆã€æœªã€ç”³ã€é…‰ã€æˆŒã€äº¥ï¼Œè¿™åäºŒæ—¶è¾°åˆšå¥½å¯¹åº”äºä»Šå¤©çš„äºŒåå››å°æ—¶ã€‚åŠå¤œåä¸€ç‚¹åˆ°ä¸€ç‚¹ä¸ºå­æ—¶ï¼Œä¸€ç‚¹åˆ°ä¸‰ç‚¹ä¸ºä¸‘æ—¶ï¼Œå…¶ä½™æ—¶è¾°ä»¥æ­¤ç±»æ¨ã€‚\nè€Œåœ¨å…¶å®ƒçš„ä¸€äº›å›½å®¶ï¼Œæ¯”å¦‚ç¾å›½å’ŒåŠ æ‹¿å¤§ï¼Œåˆ™ä½¿ç”¨å¸¦ AM å’Œ PM çš„åäºŒå°æ—¶åˆ¶æ¥è¡¨ç¤ºæ—¶é—´ã€‚é‚£ä¹ˆ AM å’Œ PM åˆ°åº•æ˜¯ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿåˆå¤œåˆåº”è¯¥ç”¨å“ªä¸ªè¡¨ç¤ºå‘¢ï¼Ÿ\nåäºŒå°æ—¶åˆ¶ åäºŒå°æ—¶åˆ¶å°†ä¸€å¤©çš„äºŒåå››å°æ—¶åˆ†æˆä¸¤æ®µé•¿ä¸ºåäºŒå°æ—¶çš„åŒºé—´ã€‚å‰ä¸€æ®µä»åˆå¤œåˆ°æ­£åˆï¼Œç”¨ AM è¡¨ç¤ºï¼›åä¸€æ®µä»æ­£åˆåˆ°åˆå¤œï¼Œç”¨ PM è¡¨ç¤ºã€‚\nAM = A.M. = Ante Meridiem: before noon\nPM = P.M. = Post Meridiem: after noon\næˆ‘ä»¬ä½¿ç”¨æ•°å­— 1-12 åŠ ä¸Š AM æˆ– PM å°±å¯ä»¥è¡¨ç¤ºä¸€å¤©ä¸­çš„äºŒåå››ä¸ªå°æ—¶äº†ã€‚ä¾‹å¦‚ï¼Œ1AM æ˜¯åˆå¤œåçš„ä¸€ä¸ªå°æ—¶ï¼Œè€Œ 11PM æ˜¯åˆå¤œå‰çš„ä¸€ä¸ªå°æ—¶ã€‚\nåˆå¤œä¸æ­£åˆ åœ¨åäºŒå°æ—¶åˆ¶ä¸­ï¼Œä¸­åˆå’Œåˆå¤œæœ‰ç‚¹å°´å°¬ã€‚å› ä¸ºä»é€»è¾‘ä¸Šæ¥è®²ï¼šåˆå¤œæ—¢ä¸èƒ½è¢«è®¤ä¸ºæ˜¯æ­£åˆå‰ï¼Œä¹Ÿä¸èƒ½è¢«è®¤ä¸ºæ˜¯æ­£åˆåï¼Œå› ä¸ºä¸ç®¡æ˜¯ä»å‰è¿˜æ˜¯åæ¥è®¡ç®—ï¼Œåˆå¤œä¸æ­£åˆä¹‹é—´çš„æ—¶é—´å·®å€¼éƒ½æ˜¯åäºŒä¸ªå°æ—¶ã€‚æ­£åˆå°±æ˜¯æ­£åˆï¼Œä¸åœ¨æ­£åˆå‰ï¼Œä¹Ÿä¸åœ¨æ­£åˆåã€‚\nä»ç»å¤§å¤šæ•°èµ„æ–™æ¥çœ‹ï¼Œä¸€èˆ¬ç”¨ 12:00 AM è¡¨ç¤ºåˆå¤œï¼ˆäºŒåå››å°æ—¶åˆ¶ä¸­çš„ 0:00ï¼‰ï¼Œç”¨ 12:00 PM è¡¨ç¤ºæ­£åˆï¼ˆäºŒåå››å°æ—¶ä¸­çš„ 12:00ï¼‰ã€‚\nå…¶å® 12:00 AM è¡¨ç¤ºçš„åˆå¤œä¹Ÿå¾ˆå®¹æ˜“ç»™äººé€ æˆå›°æ‰°ï¼Œå› ä¸ºä¸€å¤©ä»¥åˆå¤œå¼€å§‹ï¼Œåˆä»¥åˆå¤œç»“æŸã€‚æœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯é™ä½æ—¶é—´çš„å‡†ç¡®åº¦æ¥æ¶ˆé™¤ç–‘æƒ‘ã€‚æˆ‘ä»¬å¯ä»¥ç‰ºç‰²æ‰ä¸€åˆ†é’Ÿï¼Œä½¿ç”¨ 11:59 AM æ¥è¡¨æ˜æˆ‘ä»¬æœŸæœ›çš„æ—¶é—´ï¼Œè¿™å°±æ²¡æœ‰æ­§ä¹‰äº†ã€‚\nå‚è€ƒèµ„æ–™  ç™¾åº¦ç™¾ç§‘. åäºŒæ—¶è¾°åˆ¶. Wikipedia. 12-hour clock.  ","href":"/posts/english/am_and_pm/","title":"è‹±è¯­ä¸­çš„æ—¶é—´è¡¨è¾¾ï¼šAM ä¸ PM"},{"content":"æˆ‘ä»¬å¸¸è¯´äº‹åŠ¡æ˜¯ä¸€ç»„æ“ä½œï¼Œè¿™ç»„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æˆåŠŸã€‚å½“äº‹åŠ¡å¤±è´¥æ—¶ï¼Œäº‹åŠ¡å†…æ‰€ä½œçš„æ‰€æœ‰å˜æ›´éƒ½ä¼šè¢«å›æ»šã€‚åœ¨å•æœºç¯å¢ƒä¸­ï¼Œè‹¥å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œäº‹åŠ¡å°±æ˜¯å¯¹æ•°æ®çš„å®Œæ•´æ€§çš„ä¿éšœã€‚ç±»ä¼¼åœ°ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­å¤„ç†æ•°æ®å˜æ›´çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡åˆ†å¸ƒå¼äº‹åŠ¡æ¥ä¿è¯æ•°æ®çš„æ­£ç¡®å®Œæ•´ï¼Œé˜²æ­¢æ•°æ®å˜æ›´è¯·æ±‚åœ¨éƒ¨åˆ†èŠ‚ç‚¹ä¸Šçš„æ‰§è¡Œå¤±è´¥è€Œå¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚\nä¸ºäº†å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œäººä»¬å¼€å‘å‡ºäº†å¾ˆå¤šç»å…¸çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ï¼Œä¾‹å¦‚ 2PCã€3PCã€TCC ç­‰ã€‚\n2PC 2PC æ˜¯ä¸¤é˜¶æ®µæäº¤ï¼ˆTwo-phase Commitï¼‰çš„ç®€ç§°ï¼Œå®ƒæ˜¯ä¸€ç§å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„ç®—æ³•ã€‚é¡¾åæ€ä¹‰ï¼Œ2PC ä¸­äº‹åŠ¡çš„æäº¤è¿‡ç¨‹åˆ†ä¸¤ä¸ªé˜¶æ®µæ¥å®Œæˆï¼šå‡†å¤‡ï¼ˆPrepareï¼‰é˜¶æ®µå’Œæäº¤ï¼ˆCommitï¼‰é˜¶æ®µã€‚\nå‡†å¤‡é˜¶æ®µï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€äº‹åŠ¡å†…å®¹ï¼Œè¯¢é—®å…¶æ˜¯å¦å¯ä»¥æäº¤äº‹åŠ¡ï¼Œç„¶åç­‰å¾…æ‰€æœ‰å‚ä¸è€…çš„ç­”å¤ã€‚å‚ä¸è€…æ‰§è¡Œäº‹åŠ¡ï¼ˆä½†ä¸æäº¤ï¼‰ï¼Œè‹¥æ‰§è¡ŒæˆåŠŸï¼Œåˆ™ç»™åè°ƒè€…åé¦ˆ YESï¼Œè‹¥æ‰§è¡Œå¤±è´¥ï¼Œåˆ™ç»™åè°ƒè€…åé¦ˆ NOã€‚\næäº¤é˜¶æ®µï¼šå½“åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆä¿¡æ¯åï¼Œä¼šå¯¹ä¿¡æ¯è¿›è¡Œç»Ÿè®¡ã€‚åªæœ‰å½“æ‰€æœ‰çš„å‚ä¸è€…éƒ½åé¦ˆ YES æ—¶ï¼Œåè°ƒè€…æ‰ä¼šç»™æ‰€æœ‰çš„å‚ä¸è€…å‘é€æäº¤äº‹åŠ¡çš„å‘½ä»¤ã€‚å¦åˆ™ï¼Œåè°ƒè€…ä¼šç»™æ‰€æœ‰çš„å‚ä¸è€…å‘é€ abort è¯·æ±‚ï¼Œå›æ»šäº‹åŠ¡ã€‚\nè™½ç„¶ 2PC å¯ä»¥æœ‰æ•ˆä¿è¯åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„äº‹åŠ¡ï¼Œä½†ç®—æ³•æœ¬èº«ä¹Ÿå­˜åœ¨ä¸å°‘ç¼ºé™·ï¼š\n æ€§èƒ½é—®é¢˜ã€‚åœ¨ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„å‚ä¸è€…éƒ½å¤„äºé˜»å¡çŠ¶æ€ã€‚åªæœ‰åœ¨åè°ƒè€…é€šçŸ¥å‚ä¸è€…æäº¤æˆ–å›æ»šï¼Œå‚ä¸è€…åœ¨æœ¬åœ°æ‰§è¡Œå®Œç›¸åº”çš„æ“ä½œä¹‹åï¼Œèµ„æºæ‰ä¼šè¢«é‡Šæ”¾ã€‚ åè°ƒè€…å•ç‚¹é—®é¢˜ã€‚è‹¥åè°ƒè€…å‘ç”Ÿæ•…éšœï¼Œå‚ä¸è€…æ”¶ä¸åˆ°æäº¤æˆ–å›æ»šçš„é€šçŸ¥ï¼Œå°±ä¼šä¸€ç›´å¤„äºé”å®šçŠ¶æ€ã€‚ æ¶ˆæ¯ä¸¢å¤±å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚åœ¨æäº¤é˜¶æ®µï¼Œè‹¥ç³»ç»Ÿå‡ºç°åˆ†åŒºï¼Œéƒ¨åˆ†å‚ä¸è€…æ²¡æœ‰æ”¶åˆ°æäº¤æ¶ˆæ¯ï¼Œå„èŠ‚ç‚¹çš„æ•°æ®å°±ä¼šå˜å¾—ä¸ä¸€è‡´ã€‚  3PC ç”±äº 2PC å­˜åœ¨å„ç§é—®é¢˜ï¼Œäººä»¬å¯¹å®ƒè¿›è¡Œäº†æ”¹è¿›ï¼Œè¡ç”Ÿå‡ºäº†æ–°çš„åè®®ã€‚ä¸‰é˜¶æ®µæäº¤ï¼ˆThree-Phase Commit, 3PCï¼‰å°±æ˜¯ 2PC çš„æ”¹è¿›ç‰ˆæœ¬ï¼Œå®ƒå°†äº‹åŠ¡çš„æäº¤è¿‡ç¨‹åˆ†ä¸ºäº† CanCommitã€PreCommit å’Œ DoCommit ä¸‰ä¸ªé˜¶æ®µã€‚\nCanCommitï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€åŒ…å«äº‹åŠ¡å†…å®¹çš„ CanCommit è¯·æ±‚ï¼Œè¯¢é—®å…¶æ˜¯å¦å¯ä»¥æäº¤äº‹åŠ¡ï¼Œç„¶åç­‰å¾…æ‰€æœ‰å‚ä¸è€…çš„ç­”å¤ã€‚å‚ä¸è€…æ”¶åˆ°è¯·æ±‚åï¼Œåˆ¤æ–­è‡ªå·±èƒ½å¤Ÿæ‰§è¡Œäº‹åŠ¡ã€‚è‹¥å‚ä¸è€…è®¤ä¸ºè‡ªå·±å¯ä»¥æäº¤ï¼Œåˆ™åé¦ˆ YES ï¼Œå¦åˆ™åé¦ˆ NOã€‚\nPreCommitï¼šåè°ƒè€…æ¥æ”¶æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆæ¶ˆæ¯ï¼Œæ ¹æ®åé¦ˆæ¶ˆæ¯å†³å®šæ˜¯å¦ä¸­æ–­äº‹åŠ¡ã€‚å½“æ‰€æœ‰å‚ä¸è€…éƒ½åé¦ˆ YES æ—¶ï¼Œåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘å‡º PreCommit è¯·æ±‚ï¼Œå‚ä¸è€…æ”¶åˆ°è¯·æ±‚åæ‰§è¡Œäº‹åŠ¡ï¼ˆä½†ä¸æäº¤ï¼‰ï¼Œæ‰§è¡ŒæˆåŠŸåå‘åè°ƒè€…åé¦ˆ Ack è¡¨ç¤ºå·²ç»å‡†å¤‡å¥½æäº¤äº‹åŠ¡ï¼Œå¦åˆ™åé¦ˆ NOã€‚è‹¥æœ‰å‚ä¸è€…åœ¨ CanCommit é˜¶æ®µè¿”å› NO æˆ–åè°ƒè€…åœ¨è¶…æ—¶ä¹‹å‰æœªæ”¶åˆ°ä»»ä½•åé¦ˆï¼Œåè°ƒè€…å°±ä¼šå‘æ‰€æœ‰çš„å‚ä¸è€…å‘å‡º abort è¯·æ±‚ï¼Œè¯·æ±‚ä¸­æ–­äº‹åŠ¡ã€‚\nDoCommitï¼šå¦‚æœ PreCommit é˜¶æ®µä¸­çš„æ‰€æœ‰å‚ä¸è€…éƒ½åé¦ˆ Ackï¼Œåè°ƒè€…å°±ä¼šç»™æ‰€æœ‰çš„å‚ä¸è€…å‘é€ DoCommit è¯·æ±‚ï¼Œå‚ä¸è€…æ”¶åˆ°ä¹‹åä¼šè¿›è¡ŒçœŸæ­£çš„äº‹åŠ¡æäº¤ã€‚åä¹‹ï¼Œå¦‚æœ PreCommit é˜¶æ®µæœ‰ä¸€ä¸ªå‚ä¸è€…åé¦ˆ NO æˆ–è€…åè°ƒè€…åœ¨è¶…æ—¶ä¹‹å‰æ²¡æœ‰æ”¶åˆ°åé¦ˆï¼Œåˆ™ä¼šå‘æ‰€æœ‰çš„å‚ä¸è€…å‘é€ abort è¯·æ±‚ï¼Œä¸­æ–­äº‹åŠ¡ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼šåªè¦è¿›å…¥åˆ°äº† DoCommit é˜¶æ®µï¼Œæ— è®ºåè°ƒè€…å‡ºç°æ•…éšœï¼Œè¿˜æ˜¯åè°ƒè€…ä¸å‚ä¸è€…ä¹‹é—´çš„é€šä¿¡å‡ºç°é—®é¢˜ï¼Œéƒ½ä¼šå¯¼è‡´å‚ä¸è€…æ— æ³•æ”¶åˆ°åè°ƒè€…å‘å‡ºçš„ DoCommit è¯·æ±‚æˆ– abort è¯·æ±‚ã€‚è¿™æ˜¯ï¼Œå‚ä¸è€…ä¼šåœ¨ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œä¸»åŠ¨æäº¤äº‹åŠ¡ã€‚\nä¸ 2PC ç›¸æ¯”ï¼Œ3PC é€šè¿‡è¶…æ—¶æœºåˆ¶é™ä½äº†é˜»å¡èŒƒå›´å¹¶è§£å†³äº†åè°ƒè€…å•ç‚¹é—®é¢˜ï¼Œä½†è¿˜æ˜¯æ²¡æœ‰å®Œå…¨è§£å†³æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚\nå‚è€ƒèµ„æ–™  Wikipedia. Two-phase commit protocol. Wikipedia. Three-phase commit protocol.  ","href":"/distributed_computing/distributed_transactions/","title":"åˆ†å¸ƒå¼äº‹åŠ¡"},{"content":"","href":"/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97/","title":"åˆ†å¸ƒå¼è®¡ç®—"},{"content":"","href":"/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97/","title":"åˆ†å¸ƒå¼è®¡ç®—"},{"content":"CAP å®šç† è®¡ç®—æœºç§‘å­¦å®¶ Eric Brewer æŒ‡å‡ºï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰å’Œåˆ†åŒºå®¹é”™æ€§ï¼ˆPartition Toleranceï¼‰è¿™ä¸‰é¡¹ä¸­çš„ä¸¤é¡¹ã€‚è¿™å°±æ˜¯ CAP å®šç†ï¼Œä¹Ÿå« Brewer å®šç†ã€‚CAP å®šç†æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå‘å±•çš„ç†è®ºåŸºçŸ³ï¼Œå¯¹åˆ†å¸ƒå¼ç³»ç»Ÿçš„å‘å±•æœ‰ç€å¹¿æ³›è€Œæ·±è¿œçš„å½±å“ã€‚\nä¸€è‡´æ€§ æ˜¯æŒ‡æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶åˆ»çš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æ‹¥æœ‰æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œä¸ç®¡è®¿é—®ç³»ç»Ÿä¸­çš„å“ªä¸ªèŠ‚ç‚¹ï¼Œæ‰€å¾—åˆ°çš„æ•°æ®ä¸ä»…æ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”æ˜¯æœ€æ–°çš„ã€‚\nå¯ç”¨æ€§ æ˜¯æŒ‡ç³»ç»Ÿæ€»èƒ½å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚ç»™äºˆå“åº”ã€‚ç³»ç»Ÿå¹¶ä¸ä¿è¯å“åº”åŒ…å«çš„æ•°æ®ä¸€å®šæ˜¯æœ€æ–°çš„ï¼Œæ•°æ®å¯èƒ½æ˜¯è€æ—§çš„ç”šè‡³é”™è¯¯çš„ï¼Œä½†å“åº”æ˜¯ä¸€å®šä¼šæœ‰çš„ã€‚ä»å®¢æˆ·ç«¯æ¥çœ‹ï¼Œå®ƒå‘å‡ºå»çš„è¯·æ±‚æ€»æ˜¯æœ‰å“åº”çš„ï¼Œä¸ä¼šå‡ºç°æ•´ä¸ªç³»ç»Ÿæ— æ³•è¿æ¥ã€è¶…æ—¶æˆ–æ— å“åº”çš„æƒ…å†µã€‚\nåˆ†åŒºå®¹é”™æ€§ æ˜¯æŒ‡å½“ç³»ç»Ÿä¸­çš„éƒ¨åˆ†èŠ‚ç‚¹å‡ºç°æ¶ˆæ¯ä¸¢å¤±æˆ–åˆ†åŒºæ•…éšœæ—¶ï¼Œç³»ç»Ÿä»ç„¶èƒ½å¤Ÿç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ã€‚åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæ¯ä¸ªæœåŠ¡èŠ‚ç‚¹éƒ½æ˜¯ä¸å¯é çš„ã€‚å½“æŸäº›èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œæˆ–èŠ‚ç‚¹ä¸èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å‡ºç°å¼‚å¸¸æ—¶ï¼Œç³»ç»Ÿå°±å‡ºç°äº†åˆ†åŒºé—®é¢˜ã€‚ä»ç³»ç»Ÿæœ¬èº«æ¥çœ‹ï¼Œå½“åˆ†åŒºé—®é¢˜å‡ºç°æ—¶ï¼Œå®ƒä»ç„¶è¦å¯¹å¤–æä¾›ç¨³å®šæœåŠ¡ã€‚è€Œå¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œç³»ç»Ÿçš„åˆ†åŒºé—®é¢˜å¯¹å®ƒæ¥è¯´æ˜¯é€æ˜çš„ï¼Œå®¢æˆ·ç«¯å¹¶ä¸ä¼šæ„Ÿå—åˆ°ç³»ç»Ÿçš„åˆ†åŒºé—®é¢˜ã€‚\nCAP å®šç†çš„è¯æ˜ æ ¹æ® CAP å®šç†ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ä¸å¯å…¼å¾—ï¼Œæœ€å¤šåªèƒ½æ»¡è¶³å…¶ä¸­ä¸¤ç‚¹ã€‚ä¸‹é¢ç”¨åªæœ‰ä¸¤ä¸ªæœåŠ¡å™¨çš„æƒ…å†µæ¥ç®€å•è¯æ˜ä¸€ä¸‹ã€‚å‡å®šæˆ‘ä»¬æœ‰ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå®ƒç”± node1 å’Œ node2 ä¸¤ä¸ªèŠ‚ç‚¹ç»„æˆã€‚åœ¨æœ€å¼€å§‹çš„æ—¶å€™ï¼Œä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ® X çš„å€¼ç›¸åŒï¼Œéƒ½æ˜¯ $v_0$ã€‚æ­¤æ—¶ï¼Œä¸ç®¡ç”¨æˆ·æ˜¯è®¿é—® node1 è¿˜æ˜¯ node2ï¼Œæ‰€å¾— X çš„å€¼éƒ½æ˜¯ $v_0$ã€‚\nåœ¨æ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œnode1 å’Œ node2 æ­¤æ—¶éƒ½åœ¨æ­£å¸¸å·¥ä½œï¼Œç›¸äº’ä¹‹é—´é€šä¿¡è‰¯å¥½ã€‚æŸä¸€æ—¶åˆ»ï¼Œç”¨æˆ·å‘ node1 æ‰§è¡Œäº†æ›´æ–°æ“ä½œï¼Œnode1 ä¸­æ•°æ® X çš„å€¼è¢«ä¿®æ”¹æˆäº† $v_1$ã€‚æ­¤æ—¶ï¼Œnode1 ä¼šå‘é€ä¸€ä¸ªæ¶ˆæ¯ M ç»™ node2ï¼Œå‘ŠçŸ¥ node2 å°† X çš„å€¼ä¿®æ”¹ä¸º $v_1$ã€‚node2 åœ¨æ”¶åˆ°æ¶ˆæ¯ M ä¹‹åï¼Œ X çš„å€¼ä¹Ÿä¼šè¢«ä¿®æ”¹æˆ $v_1$ã€‚æ­¤åï¼Œç”¨æˆ·ä¸ç®¡æ˜¯è¯·æ±‚ node1 è¿˜æ˜¯ node2ï¼Œæ‰€å¾— X çš„å€¼éƒ½æ˜¯ $v_1$ã€‚\nå¦‚æœç½‘ç»œå‡ºç°äº†åˆ†åŒºï¼Œnode1 ä¸ node2 ä¹‹é—´æ— æ³•æ­£å¸¸è¿›è¡Œé€šä¿¡ï¼Œæ¶ˆæ¯ M æ— æ³•æŠµè¾¾ node2ï¼Œé‚£ä¹ˆ node1 å’Œ node2 çš„æ•°æ®å°±ä¼šå‡ºç°ä¸ä¸€è‡´ã€‚\næ­¤æ—¶ï¼Œè‹¥ç”¨æˆ·è¯·æ±‚ node2ï¼Œç”±äº node1 ä¸ node2 é€šä¿¡æ•…éšœï¼Œnode2 æ— æ³•ç»™ç”¨æˆ·è¿”å›æ­£ç¡®çš„ç»“æœ $v_1$ï¼Œæ­¤æ—¶æœ‰ä¸¤ç§å¤„ç†æ–¹æ¡ˆï¼š\n ç‰ºç‰²ä¸€è‡´æ€§ï¼Œnode2 å‘ç”¨æˆ·è¿”å›è€æ•°æ® $v_0$ ç‰ºç‰²å¯ç”¨æ€§ï¼Œnode2 é˜»å¡ç”¨æˆ·è¯·æ±‚ï¼Œç›´åˆ°å®Œæˆæ•°æ®åŒæ­¥  åˆ°è¿™é‡Œï¼ŒCAP å®šç†çš„å°±è¯æ˜å®Œäº†ã€‚åˆ†æè¿‡ç¨‹è¯´æ˜ï¼Œå½“ç³»ç»Ÿå‡ºç°åˆ†åŒºæ—¶ï¼Œä¸€è‡´æ€§ä¸å¯ç”¨æ€§åªèƒ½äºŒé€‰ä¸€ã€‚\nCAP å®šç†çš„æƒè¡¡ æ ¹æ® CAP å®šç†ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæ— æ³•åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ã€‚é‚£ä¹ˆåœ¨æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å–èˆå‘¢ï¼Ÿ\nCA è¿™ç§æ–¹æ¡ˆä¸æ”¯æŒåˆ†åŒºå®¹é”™ï¼Œä¹Ÿå°±æ˜¯è¯´èŠ‚ç‚¹å’Œç½‘ç»œä¸€ç›´ä¼šå¤„äºç†æƒ³çŠ¶æ€ï¼Œä¸ä¼šå‘ç”Ÿæ•…éšœã€‚ä½†æ˜¯ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•…éšœæ˜¯å®¢è§‚å­˜åœ¨çš„ï¼Œç³»ç»Ÿä¸­çš„èŠ‚ç‚¹è¶Šå¤šï¼Œå‡ºé”™çš„æ¦‚ç‡å°±è¶Šå¤§ã€‚æ‰€ä»¥ CA æ˜¯ä¸åˆ‡å®é™…çš„ã€‚\nCP è¿™ç§æ–¹æ¡ˆæ”¾å¼ƒäº†å¯ç”¨æ€§ï¼Œåœ¨ç³»ç»Ÿå‡ºç°åˆ†åŒºæ—¶ï¼ŒæœåŠ¡ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æ•°æ®è¾¾æˆä¸€è‡´ã€‚åœ¨æ­¤æœŸé—´ï¼Œç³»ç»Ÿå¯¹å¤–æ˜¯ä¸å¯ç”¨çš„ã€‚CP é€‚åˆå¯¹æ•°æ®ä¸€è‡´æ€§æ¯”è¾ƒæ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ã€‚æˆ‘ä»¬å¸¸ç”¨çš„ Zookeeper å°±æ˜¯ä¼˜å…ˆä¿è¯ CPã€‚\nAP ç‰ºç‰²ä¸€è‡´æ€§ï¼Œæ¢å–å¯ç”¨æ€§ã€‚å½“ç³»ç»Ÿå‡ºç°åˆ†åŒºæ—¶ï¼Œç”¨æˆ·çš„è¯·æ±‚ä¾ç„¶å¯ä»¥å¾—åˆ°å“åº”ï¼Œåªæ˜¯æ•°æ®å¯èƒ½æ˜¯è€æ—§çš„æ•°æ®ã€‚æ•´ä¸ªç³»ç»Ÿä¾ç„¶å¯¹å¤–æä¾›ç¨³å®šæœåŠ¡ï¼Œç”¨æˆ·ä½“éªŒä¼šå¥½äº CPã€‚\nCAP çš„é—®é¢˜å’Œè¯¯åŒº è™½ç„¶ CAP å®šç†æå¤§åœ°ä¿ƒè¿›äº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å‘å±•ï¼Œä½†æ˜¯äººä»¬åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿæ¼”è¿›çš„è¿‡ç¨‹ä¸­å‘ç°ï¼ŒCAP è¿‡äºç†æƒ³åŒ–ï¼Œå­˜åœ¨ä¸å°‘é—®é¢˜å’Œè¯¯åŒºã€‚\nç”±äºç½‘ç»œåˆ†åŒºé—®é¢˜è‚¯å®šå­˜åœ¨ï¼Œå¾ˆå¤šäººåœ¨è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶å°±å±€é™åœ¨äº† CP å’Œ AP çš„äºŒé€‰ä¸€å½“ä¸­ã€‚ä½†å®é™…ä¸Šï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åˆ†åŒºé—®é¢˜å‡ºç°çš„æ¦‚ç‡å¹¶ä¸é«˜ã€‚åœ¨æ²¡æœ‰å‡ºç°åˆ†åŒºé—®é¢˜æ—¶ï¼Œä¸åº”è¯¥åªé€‰æ‹©ä¸€è‡´æ€§æˆ–å¯ç”¨æ€§ï¼Œè€Œåº”è¯¥åŒæ—¶æä¾›ã€‚Brewer æœ¬äººä¹Ÿåœ¨ CAP å®šç†æå‡ºçš„ 12 å¹´ï¼ˆ2012 å¹´ï¼‰å‘æ–‡ æŒ‡å‡ºäººä»¬åœ¨ä½¿ç”¨ CAP æ—¶å­˜åœ¨çš„è¯¯åŒºã€‚\næ­¤å¤–ï¼Œåœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œä¸åŒä¸šåŠ¡åœ¨åˆ†åŒºå‡ºç°æ—¶å¯¹ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„é€‰æ‹©å–å¯èƒ½æ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥ï¼Œåœ¨è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œè¦æ ¹æ®å®é™…çš„ä¸šåŠ¡åœºæ™¯çµæ´»å˜é€šã€‚CAP ä½œä¸ºæŒ‡å¯¼åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çš„ç†è®ºï¼Œå‘Šè¯‰æˆ‘ä»¬çš„æ˜¯å®é™…è®¾è®¡æ—¶è¦è€ƒè™‘çš„å› ç´ ï¼Œè€Œä¸æ˜¯è®©æˆ‘ä»¬è¿›è¡Œç»å¯¹çš„é€‰æ‹©ã€‚\nBASE ç†è®º åœ¨è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¹‹é—´æƒè¡¡ï¼Œå¹¶ä¸ä¸€å®šæ˜¯äºŒé€‰ä¸€ã€‚CAP å®šç†ä¸­çš„ä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯å¼ºä¸€è‡´æ€§ï¼Œä½†åœ¨å®é™…è¿ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯èƒ½é€‰æ‹©å¼±ä¸€è‡´æ€§æˆ–æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™å°±å¼•å‡ºäº† BASE ç†è®ºï¼Œå®ƒæ˜¯ CAP çš„å»¶ä¼¸ã€‚\nBASE æ˜¯ Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft Stateï¼ˆè½¯çŠ¶æ€ï¼‰å’Œ Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´ï¼‰çš„ç®€å†™ã€‚å®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šæƒè¡¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„å„ä¸ªåŠŸèƒ½ï¼Œå°½é‡ä¿è¯ç³»ç»Ÿçš„ç¨³å®šå¯ç”¨ï¼Œå³ä¾¿åœ¨å‡ºç°å±€éƒ¨æ•…éšœå’Œå¼‚å¸¸æ—¶ï¼Œä¹Ÿç¡®ä¿ç³»ç»Ÿçš„ä¸»ä½“åŠŸèƒ½å¯ç”¨ï¼Œç¡®ä¿ç³»ç»Ÿçš„æœ€ç»ˆä¸€è‡´æ€§ã€‚\nåŸºæœ¬å¯ç”¨ï¼šå½“åˆ†å¸ƒå¼ç³»ç»Ÿå‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œä¿è¯æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ã€‚\nè½¯çŠ¶æ€ï¼šå…è®¸ç³»ç»Ÿå‡ºç°ä¸­é—´çŠ¶æ€ã€‚å½“ç³»ç»Ÿå‡ºç°åˆ†åŒºæ—¶ï¼Œè™½ç„¶å„åˆ†åŒºçš„æ•°æ®å¤„äºä¸ä¸€è‡´çŠ¶æ€ï¼Œä½†è¿™å¹¶ä¸å½±å“ç³»ç»Ÿå¯¹å¤–æä¾›æœåŠ¡ã€‚\næœ€ç»ˆä¸€è‡´æ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸éœ€è¦å®æ—¶ä¿æŒå¼ºä¸€è‡´çŠ¶æ€ï¼Œå½“ç³»ç»Ÿå‘ç”Ÿæ•…éšœæ—¶ï¼Œæ•°æ®çš„ä¸ä¸€è‡´æ˜¯å¯ä»¥å®¹å¿çš„ã€‚ä½†åœ¨æ•…éšœæ¢å¤åï¼Œè¦è¿›è¡Œæ•°æ®çš„åŒæ­¥ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸€è‡´æ€§çŠ¶æ€ã€‚\nå‚è€ƒèµ„æ–™  Wikipedia. CAP theorem. Brewer\u0026rsquo;s CAP Theorem. Eric Brewer. CAP Twelve Years Later: How the \u0026ldquo;Rules\u0026rdquo; Have Changed.  ","href":"/distributed_computing/cap_theorem_and_base/","title":"CAP å®šç†ä¸ BASE ç†è®º"},{"content":"","href":"/categories/db/","title":"DB"},{"content":"","href":"/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/","title":"æ•°æ®åº“"},{"content":"åœ¨å…³ç³»æ•°æ®åº“è®¾è®¡ä¸­ï¼Œæ•°æ®åº“è§„èŒƒåŒ–ï¼ˆDatabase normalizationï¼‰ æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå…³ç³»æ•°æ®åº“è®¾è®¡çš„ç›®æ ‡æ˜¯ç”Ÿæˆä¸€ç»„å…³ç³»æ¨¡å¼ï¼Œä½¿æˆ‘ä»¬å­˜å‚¨æ•°æ®æ—¶é¿å…ä¸å¿…è¦çš„å†—ä½™ï¼ŒåŒæ—¶è®©æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°è·å–æ•°æ®ã€‚è§„èŒƒåŒ–å°±æ˜¯ç»„ç»‡æ•°æ®åº“å†…æ•°æ®çš„ä¸€ä¸ªè¿‡ç¨‹ï¼ŒåŒ…æ‹¬åˆ›å»ºæ•°æ®è¡¨å’Œå»ºç«‹è¿™äº›è¡¨ä¹‹é—´çš„å…³ç³»ã€‚è€Œåœ¨å»ºç«‹è¡¨é—´å…³ç³»æ—¶ï¼Œæˆ‘ä»¬æ—¢è¦ä¿æŠ¤æ•°æ®çš„å®Œæ•´æ€§ï¼Œåˆè¦æ¶ˆé™¤å†—ä½™æ•°æ®ã€‚å†—ä½™æ•°æ®ä¸ä»…ä¼šæµªè´¹ç£ç›˜ç©ºé—´ï¼Œè¿˜ä¼šå¢åŠ æˆ‘ä»¬ç»´æŠ¤çš„æˆæœ¬ã€‚\nç›¸å…³æœ¯è¯­ å…³ç³»æ•°æ®åº“è®¾è®¡ä¸­æ¶‰åŠå¾ˆå¤šä¸“ä¸šæœ¯è¯­ï¼Œåœ¨è¿›å…¥åˆ°ä¸»è¦å†…å®¹ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆä»‹ç»ä¸‹è¿™äº›æœ¯è¯­ï¼Œç¡®ä¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨æœ¯è¯­çš„ä½¿ç”¨ä¸Šè¾¾æˆå…±è¯†ã€‚\n æ•°æ®åº“è¡¨ï¼ˆTableï¼‰ï¼šåœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œæ•°æ®åº“è¡¨æ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼Œä»£è¡¨ä»¥è¡¨æ ¼çš„å½¢å¼è¿›è¡Œç»„ç»‡çš„ä¸€ç»„ç›¸å…³æ•°æ®æ„æˆçš„é›†åˆã€‚å®ƒç”±è¡Œå’Œåˆ—ç»„æˆã€‚ è¡Œï¼ˆRowï¼‰ï¼šæ•°æ®åº“è¡¨ä¸­çš„æ¯ä¸€è¡Œï¼ˆæˆ–æ¯ä¸€æ¡ è®°å½•ï¼ˆRecordï¼‰ï¼‰éƒ½è¡¨ç¤ºä¸€ç»„ç›¸å…³æ•°æ®ï¼Œè¡¨ä¸­çš„æ‰€æœ‰è¡Œçš„ç»“æ„éƒ½æ˜¯ç›¸åŒçš„ã€‚è¡Œåˆç§° å…ƒç»„ï¼ˆTupleï¼‰ã€‚ åˆ—ï¼ˆColumnï¼‰ï¼šåœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œåˆ—æ˜¯ä¸€ç»„ç‰¹å®šç±»å‹æ•°æ®æ„æˆçš„é›†åˆï¼Œé›†åˆä¸­çš„æ¯ä¸€é¡¹æ•°æ®ï¼ˆå­—æ®µï¼‰éƒ½åˆ†æ•£åœ¨æ¯ä¸€è¡Œä¸­ã€‚å¦‚æœä¸€ä¸ªè¡¨æœ‰ N åˆ—ï¼Œé‚£ä¹ˆè¡¨ä¸­çš„æ¯ä¸€æ¡è®°å½•å°±ä¼šæœ‰ N ä¸ªå­—æ®µã€‚åˆ—åˆç§° å±æ€§ï¼ˆAttributeï¼‰ã€‚  ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå­¦ç”Ÿè¡¨ student(stu_id, name, gender)ï¼Œåœ¨ä¸‹é¢çš„ SQL å®ç°ä¸­ï¼š\nCREATE TABLE student( stu_id INTEGER NOT NULL, name VARCHAR(50) NOT NULL, gender INTEGER NOT NULL, PRIMARY KEY (id) ); INSERT INTO student VALUES(1, \u0026#34;Mike\u0026#34;, 1); create TABLE student(...); å°±ä»£è¡¨ä¸€ä¸ªè¡¨ï¼Œstu_id INTEGER NOT NULL å°±æ˜¯è¡¨ä¸­çš„ä¸€åˆ—ï¼ŒINSERT INTO student VALUES(1, \u0026quot;Mike\u0026quot;, 1); å°±æ˜¯æˆ‘ä»¬æ’å…¥è¡¨ä¸­çš„ä¸€è¡Œæ•°æ®ã€‚ç®€å•æ¥è¯´ï¼Œè¡¨å…³æ³¨çš„æ˜¯æ•°æ®çš„ç»„ç»‡å½¢å¼ï¼Œè¡Œå…³æ³¨çš„æ˜¯æ•°æ®çš„ç›¸å…³æ€§ï¼Œåˆ—å…³æ³¨çš„æ˜¯æ•°æ®çš„ç±»å‹ã€‚\næ•°æ®åº“ä¸­çš„é”® é”®ï¼ˆKeyï¼‰æ˜¯æ•°æ®åº“è¡¨ç»“æ„çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œé€šå¸¸ç”±è¡¨ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µæ„æˆï¼Œç”¨æ¥å”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„ä¸€æ¡è®°å½•ã€‚æ­¤å¤–ï¼Œé”®è¿˜è¢«ç”¨æ¥æé«˜æ•°æ®çš„å®Œæ•´æ€§ï¼Œå»ºç«‹è¡¨ä¸è¡¨ä¹‹é—´çš„å…³ç³»ã€‚åœ¨å…³ç³»æ•°æ®æ¨¡å‹ä¸­ï¼Œé”®ä¸»è¦æœ‰ä¸‰ç§ï¼šå€™é€‰é”®ã€ä¸»é”®å’Œå¤–é”®ã€‚\n è¶…é”®ï¼ˆSuperkeyï¼‰ï¼šè¶…é”®æ˜¯ä¸€ç»„èƒ½å”¯ä¸€æ ‡è¯†å‡ºè¡¨ä¸­çš„æ¯ä¸€è¡Œè®°å½•çš„å±æ€§é›†åˆã€‚ å€™é€‰é”®ï¼ˆCandidate keyï¼‰ï¼šè‹¥è¶…é”®ä¸åŒ…å«å¤šä½™çš„å±æ€§ï¼ˆå³æœ€å°è¶…é”®ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªè¶…é”®å°±æ˜¯å€™é€‰é”®ã€‚å€™é€‰é”®æ˜¯è¶…é”®çš„å­é›†ï¼Œæ¯ä¸ªè¡¨éƒ½å¿…é¡»æœ‰è‡³å°‘ä¸€ä¸ªå€™é€‰é”®ã€‚ä¾‹å¦‚ï¼Œåœ¨å­¦ç”Ÿè¡¨ student(stu_id, name, gender) ä¸­ï¼Œè‹¥ stu_id å’Œ name éƒ½å¯ä»¥å”¯ä¸€ç¡®å®šå‡ºä¸€åå­¦ç”Ÿï¼Œé‚£ä¹ˆ stu_id å’Œ name éƒ½æ˜¯å€™é€‰é”®ã€‚ç»„æˆå€™é€‰é”®ä¸­çš„å±æ€§å«ä¸»å±æ€§ï¼ˆprime attributesï¼‰ï¼Œä¸åŒ…å«åœ¨å€™é€‰é”®ä¸­çš„å±æ€§å°±æ˜¯éä¸»å±æ€§ã€‚ ä¸»é”®ï¼ˆPrimary keyï¼‰ï¼šæ—¢ç„¶å€™é€‰é”®å¯ä»¥å”¯ä¸€æ ‡è¯†å‡ºè¡¨ä¸­çš„æ¯ä¸€è¡Œè®°å½•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä»å€™é€‰é”®ä¸­é€‰å–ä¸€ä¸ªä½œä¸ºä¸»é”®ï¼Œå‰©ä¸‹çš„é‚£äº›å€™é€‰é”®å°±è¢«ç§°ä¸ºæ›¿ä»£é”®ï¼ˆAlternative keyï¼‰ã€‚ å¤–é”®ï¼ˆForeign keyï¼‰ï¼šè‹¥è¡¨ A ä¸­çš„å±æ€§é›† S ä¸æ˜¯è¡¨ A çš„ä¸»é”®ï¼Œä½† S æ˜¯è¡¨ B çš„ä¸»é”®ï¼Œåˆ™ S å°±æ˜¯è¡¨ A ä¸­æŒ‡å‘è¡¨ B çš„å¤–é”®ã€‚  èŒƒå¼ ä¸ºäº†ä¿è¯æ•°æ®åº“çš„è§„èŒƒåŒ–ï¼Œäººä»¬å¼€å‘å‡ºäº†ä¸€ç³»åˆ—çš„è®¾è®¡å‡†åˆ™ã€‚è¿™äº›å‡†åˆ™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ èŒƒå¼ï¼ˆnormal formï¼‰ã€‚èŒƒå¼ä¹Ÿåˆ†ä¸ºå¾ˆå¤šç­‰çº§ï¼ŒæŒ‰ç…§æ•°æ®çš„è§„èŒƒåŒ–ç¨‹åº¦ï¼Œä»ä½åˆ°é«˜ä¾æ¬¡æœ‰ï¼šç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ã€ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ã€ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ã€BC èŒƒå¼ï¼ˆBCNFï¼‰ã€ç¬¬å››èŒƒå¼ï¼ˆ4NFï¼‰ã€ç¬¬äº”èŒƒå¼ï¼ˆ5NFï¼‰ã€‚\næ»¡è¶³æœ€ä½è¦æ±‚çš„æ˜¯ç¬¬ä¸€èŒƒå¼ï¼Œåœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥æ»¡è¶³ä¸€äº›è¦æ±‚çš„æ˜¯ç¬¬äºŒèŒƒå¼ï¼Œåœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šå†è¿›ä¸€æ­¥æ»¡è¶³ä¸€äº›è¦æ±‚çš„æ˜¯ç¬¬ä¸‰èŒƒå¼â€¦â€¦ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ•°æ®åº“æ»¡è¶³çš„èŒƒå¼è¶Šé«˜ï¼Œæ•°æ®å†—ä½™å°±è¶Šå°ï¼Œä¸€èˆ¬æ•°æ®è¡¨çš„æ•°é‡ä¹Ÿä¼šè¶Šå¤šã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸åªä¼šç”¨åˆ°å‰ä¸‰ä¸ªèŒƒå¼ï¼Œæ‰€ä»¥æœ¬æ–‡ä¹Ÿåªä¼šè¦†ç›–å¸¦å‰ä¸‰ä¸ªèŒƒå¼ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒèŒƒå¼åªæ˜¯ç”¨æ¥æŒ‡å¯¼æ•°æ®åº“è®¾è®¡çš„ï¼Œåœ¨å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ä¸‹æ˜¯é€‚ç”¨çš„ã€‚è€Œå¯¹äºä¸€äº›ç‰¹æ®Šçš„ä¸šåŠ¡åœºæ™¯ï¼ŒèŒƒå¼è®¾è®¡çš„è¡¨æ˜¯æ— æ³•æ»¡è¶³éœ€æ±‚çš„ï¼Œè¿™æ—¶å°±éœ€è¦è¿›è¡ŒåèŒƒå¼è®¾è®¡ã€‚\nç¬¬ä¸€èŒƒå¼ ç¬¬ä¸€èŒƒå¼å¼ºè°ƒçš„æ˜¯åˆ—çš„ åŸå­æ€§ï¼Œè¦æ±‚è¡¨ä¸­çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯åŸå­çš„ï¼Œä¸å¯å†åˆ†ã€‚\nä¾‹å¦‚ï¼Œå½“å­¦ç”ŸåŒæ—¶æœ‰åº§æœºå’Œæ‰‹æœºä¸¤ä¸ªç”µè¯å·ç æ—¶ï¼Œå°†åº§æœºå’Œæ‰‹æœºæ”¾åœ¨ä¸€åˆ—â€”â€”student(stu_id, name, phone) çš„è¡¨è®¾è®¡å°±ä¸æ»¡è¶³ç¬¬ä¸€èŒƒå¼ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°†ç”µè¯æ‹†åˆ†ä¸ºä¸¤åˆ—ï¼šstudent(stu_id, name, telephone, cellphone)ï¼Œç¬¬ä¸€èŒƒå¼å°±æ»¡è¶³äº†ã€‚\nç¬¬äºŒèŒƒå¼ ç¬¬äºŒèŒƒå¼æ»¡è¶³ç¬¬ä¸€èŒƒå¼ï¼Œå¹¶ä¸”ï¼š\n ä»»ä½•éä¸»å±æ€§éƒ½å¿…é¡» å®Œå…¨ä¾èµ– å€™é€‰é”®ï¼Œè€Œä¸èƒ½åªä¾èµ–å€™é€‰é”®ä¸­çš„éƒ¨åˆ†å±æ€§ã€‚  ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª stu_course(stu_id, course_id, course_name, stu_name, grade)ï¼Œä¸»é”®ä¸ºå¤åˆä¸»é”® (stu_id, course_id)ã€‚åœ¨è¿™ä¸ªè¡¨ä¸­ï¼Œæˆç»©æ˜¯å®Œå…¨ä¾èµ–äºä¸»é”®çš„ï¼Œåªæœ‰å½“å­¦å·å’Œè¯¾ç¨‹å·ç¡®å®šäº†ï¼Œæ‰èƒ½ç¡®å®šæˆç»©ã€‚è€Œå§“åæ˜¯ä¸å®Œå…¨ä¾èµ–äºä¸»é”®çš„ï¼Œå› ä¸ºåªè¦å­¦å·ç¡®å®šäº†ï¼Œå§“åä¹Ÿå°±å”¯ä¸€ç¡®å®šäº†ï¼Œä¸éœ€è¦å†ä½¿ç”¨è¯¾ç¨‹å·ã€‚æ‰€ä»¥ï¼Œå§“åæ˜¯éƒ¨åˆ†ä¾èµ–äºä¸»é”® (stu_id, course_id)çš„ï¼Œå­¦ç”Ÿè¯¾ç¨‹è¡¨å› æ­¤ä¸æ»¡è¶³ç¬¬äºŒèŒƒå¼ã€‚æ­¤å¤–ï¼Œè¯¾ç¨‹åç§°ä¹Ÿæ˜¯éƒ¨åˆ†ä¾èµ–äºä¸»é”®çš„ã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Œæ­£ç¡®çš„åšæ³•æ˜¯å°† stu_course(stu_id, course_id, course_name, stu_name, grade) æ‹†åˆ†ä¸ºä¸‰ä¸ªè¡¨ï¼šstudent(stu_id, stu_name)ã€course(course_id, course_name) å’Œ stu_course(stu_id, course_id, grade)ã€‚\nç¬¬ä¸‰èŒƒå¼ ç¬¬ä¸‰èŒƒå¼æ»¡è¶³ç¬¬äºŒèŒƒå¼ï¼Œå¹¶ä¸”ï¼š\n ä»»ä½•éä¸»å±æ€§éƒ½å¿…é¡»ç›´æ¥ä¾èµ–å€™é€‰é”®ï¼Œä¸èƒ½å‡ºç°ä¼ é€’ä¾èµ–ã€‚å³ä¸èƒ½å‡ºç°éä¸»å±æ€§ A ä¾èµ–éä¸»å±æ€§ Bï¼Œè€Œå±æ€§ B åˆç›´æ¥ä¾èµ–äºå€™é€‰é”®é”®çš„æƒ…å†µã€‚  ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªstudent(stu_id, stu_name, dept_id, dept_name)ã€‚è¿™é‡Œï¼Œå­¦å·å¯ä»¥å”¯ä¸€ç¡®å®šå­¦é™¢ç¼–å·ï¼Œè€Œå­¦é™¢ç¼–å·å¯ä»¥å”¯ä¸€ç¡®å®šå­¦é™¢åç§°ã€‚è¿™å°±å‡ºç°äº†å­¦é™¢åç§° \u0026lt;- å­¦é™¢ç¼–å· \u0026lt;- å­¦å·è¿™æ ·çš„ä¼ é€’ä¾èµ–ï¼Œå› æ­¤ä¸æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ã€‚è§£å†³åŠæ³•å°±æ˜¯å°†student(stu_id, stu_name, dept_id, dept_name)æ‹†åˆ†ä¸ºä¸¤ä¸ªå­è¡¨ï¼šdept(dept_id, dept_name)å’Œstudent(stu_id, stu_name, dept_id)ã€‚\nåèŒƒå¼ åœ¨å¤§å¤šæ•°çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼ŒèŒƒå¼è®¾è®¡çš„è¡¨éƒ½èƒ½æ»¡è¶³éœ€æ±‚ã€‚è€Œå¯¹äºä¸€äº›ç‰¹æ®Šçš„ä¸šåŠ¡åœºæ™¯ï¼ŒèŒƒå¼è®¾è®¡çš„è¡¨æ— æ³•æ»¡è¶³æ€§èƒ½çš„éœ€æ±‚ã€‚æ­¤æ—¶å°±éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œåœ¨èŒƒå¼çš„åŸºç¡€ä¹‹ä¸Šè¿›è¡Œçµæ´»è®¾è®¡ï¼Œä¹Ÿå°±æ˜¯åèŒƒå¼è®¾è®¡ã€‚\nåèŒƒå¼è®¾è®¡ä¸»è¦ä»ä¸šåŠ¡åœºæ™¯ã€å“åº”æ—¶é—´å’Œå­—æ®µå†—ä½™ä¸‰æ–¹é¢è€ƒè™‘ã€‚ç”¨ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼šç”¨ç©ºé—´æ¥æ¢å–æ—¶é—´ï¼Œæé«˜ä¸šåŠ¡åœºæ™¯çš„å“åº”æ—¶é—´ï¼Œå‡å°‘å¤šè¡¨å…³è”ã€‚\nå‚è€ƒèµ„æ–™  Wikipedia. Database normalization. Database Keys.  ","href":"/posts/databases/database_normalization/","title":"æ•°æ®åº“è§„èŒƒåŒ–"},{"content":"","href":"/tags/linux/","title":"Linux"},{"content":"","href":"/categories/linux/","title":"Linux"},{"content":"åœ¨ Linux ä¸­ï¼Œæœ‰ä¸€ä¸ªä¸œè¥¿å«é“¾æ¥æ–‡ä»¶ï¼Œå®ƒæœ‰ç‚¹åƒ Windows ä¸­çš„å¿«æ·æ–¹å¼ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®ç°æ–‡ä»¶çš„å…±äº«ã€‚é“¾æ¥ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼šç¡¬é“¾æ¥ï¼ˆhard linkï¼‰ å’Œ è½¯è¿æ¥ï¼ˆsoft linkï¼‰ã€‚é“¾æ¥åœ¨ Linux éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºåœ¨ Linux ä¸­ï¼Œâ€œevery thing is a fileâ€ï¼Œé“¾æ¥å¯ä»¥å¸¦æ¥æå¤§çš„çµæ´»æ€§ã€‚\nInode åœ¨å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€ä¸‹ç£ç›˜åˆ†åŒºä¸ ç´¢å¼•èŠ‚ç‚¹ï¼ˆinodeï¼‰ã€‚\nä¸ºäº†æ–¹ä¾¿ç®¡ç†å’Œä¿è¯æ•°æ®çš„å®‰å…¨ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå¯¹ç£ç›˜è¿›è¡Œåˆ†åŒºã€‚æ¯ä¸ªåˆ†åŒºéƒ½å¯ä»¥è¢«å•ç‹¬æŒ‚è½½ï¼ˆmountï¼‰æˆ–å–æ¶ˆæŒ‚è½½ï¼ˆumountï¼‰ã€‚æ¯ä¸ªåˆ†åŒºéƒ½æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¸åŒåˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿå¯ä»¥ä¸åŒã€‚åœ¨ Linux æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶å°±ç”¨ inode è¡¨ç¤ºï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è‡ªå·±å¯¹åº”çš„ inodeã€‚æ¯ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ç»„è‡ªå·±çš„ inode ï¼Œä¸åŒåˆ†åŒºçš„ inode äº’ä¸å½±å“ï¼Œå› ä¸ºå®ƒä»¬ä½äºä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚åœ¨å»ºç«‹æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œä¼šå»ºç«‹ä¸€ä¸ª inode è¡¨ï¼Œè¡¨ä¸­åŒ…å«ä¸€å®šæ•°é‡çš„ inode ã€‚æ¯åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œç³»ç»Ÿå°±ä¼šåˆ†é…ä¸€ä¸ª inode å·ï¼ˆinode numberï¼‰ç»™å®ƒï¼Œè¿™ä¸ª inode å·å°±ç›¸å½“äºæ–‡ä»¶çš„åœ°å€ã€‚\nLinux çš„æ–‡ä»¶å®é™…ä¸Šç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæ•°æ®éƒ¨åˆ†å’Œæ–‡ä»¶åéƒ¨åˆ†ã€‚æ–‡ä»¶åéƒ¨åˆ†ä¿å­˜åœ¨ç›®å½•ä¸­ï¼Œå®ƒåŒ…å«æ–‡ä»¶çš„åå­—ä»¥åŠå¯¹åº”çš„ inode å·ï¼Œé€šè¿‡ inode å·æˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ°æ•°æ®éƒ¨åˆ†çš„ç›¸å…³ä¿¡æ¯ã€‚é€šè¿‡åˆ†å¼€å­˜å‚¨æ–‡ä»¶åå’Œæ–‡ä»¶æ•°æ®ï¼ŒLinux ç³»ç»Ÿå°±èƒ½åšåˆ°å¤šä¸ªæ–‡ä»¶åå…³è”åŒä¸€ä¸ª inode å·ã€‚æ–‡ä»¶çš„æ•°æ®éƒ¨åˆ†ä¸ä»…åŒ…æ‹¬æ–‡ä»¶æ‰€æœ‰è€…ã€åˆ›å»ºæ—¶é—´ç­‰å…ƒæ•°æ®ï¼Œè¿˜åŒ…æ‹¬å®é™…æ–‡ä»¶å†…å®¹æ‰€åœ¨çš„ç£ç›˜ä½ç½®ã€‚ç¡¬é“¾æ¥å’Œè½¯è¿æ¥å…¶å®å°±æ˜¯ä¸¤ç§å°†å¤šä¸ªæ–‡ä»¶åå…³è”åˆ°åŒä¸€ä»½æ–‡ä»¶æ•°æ®çš„æ–¹æ³•ã€‚\nç¡¬é“¾æ¥ å¤šä¸ªæ–‡ä»¶åå¯ä»¥æŒ‡å‘åŒä¸€ä¸ª inode å·ï¼Œè¿™äº›æ–‡ä»¶çš„å…³ç³»å°±æ˜¯ç¡¬é“¾æ¥çš„å…³ç³»ã€‚ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªç¡¬é“¾æ¥å°±æ˜¯ä¸€ä¸ªç›®å½•é¡¹ï¼Œå®ƒå…³è”çš„æ˜¯æ–‡ä»¶åä¸ inodeã€‚ç”±äºæ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸€ä¸ªç›®å½•é¡¹ï¼Œå› æ­¤ä¸€ä¸ªæ–‡ä»¶è‡³å°‘æœ‰ä¸€ä¸ªç¡¬é“¾æ¥ã€‚åˆ é™¤ç¡¬é“¾æ¥æ—¶ï¼Œå¯¹åº” inode çš„ç¡¬é“¾æ¥æ•°é‡å‡ä¸€ï¼Œåªæœ‰å½“ inode çš„ç¡¬é“¾æ¥æ•°é‡ä¸º 0 æ—¶ï¼Œæ–‡ä»¶æ‰ä¼šè¢«åˆ é™¤ã€‚ç¡¬é“¾æ¥æ˜¯ä¸èƒ½è·¨åˆ†åŒºï¼ˆæˆ–è€…è·¨æ–‡ä»¶ç³»ç»Ÿï¼‰çš„ï¼Œå› ä¸ºæ¯ä¸ªåˆ†åŒºéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ inodeã€‚\nè½¯è¿æ¥ è½¯é“¾æ¥ä¹Ÿå«ç¬¦å·é“¾æ¥ï¼ˆsymbolic link or symlinkï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æ–‡ä»¶ã€‚ç¬¦å·é“¾æ¥çš„æ–‡ä»¶å†…å®¹å®é™…ä¸Šæ˜¯å¦å¤–ä¸€ä¸ªæ–‡ä»¶ï¼ˆç›®æ ‡æ–‡ä»¶ï¼‰çš„è·¯å¾„ã€‚æ“ä½œç³»ç»Ÿä¼šæŠŠå¯¹ç¬¦å·é“¾æ¥çš„è¯»å†™æ“ä½œé‡å®šå‘åˆ°ç›®æ ‡æ–‡ä»¶ä¸Šã€‚ç”±äºç¬¦å·é“¾æ¥æŒ‡å‘çš„æ˜¯æ–‡ä»¶è·¯å¾„è€Œä¸æ˜¯ inodeï¼Œæ‰€ä»¥ç¬¦å·é“¾æ¥æ˜¯å¯ä»¥è·¨åˆ†åŒºçš„ã€‚åˆ é™¤ç¬¦å·é“¾æ¥å¹¶ä¸ä¼šå¯¹ç›®æ ‡æ–‡ä»¶é€ æˆä»»ä½•å½±å“ã€‚ä½†æ˜¯ï¼Œå¦‚æœç›®æ ‡æ–‡ä»¶è¢«åˆ é™¤æˆ–è€…é‡å‘½åäº†ï¼Œç¬¦å·é“¾æ¥å°±æˆä¸ºäº†æ­»é“¾æ¥ã€‚\nç”¨ä¸€å¼ å›¾æ¥è¯´æ˜ç¡¬é“¾æ¥ä¸ç¬¦å·é“¾æ¥çš„åŒºåˆ«ï¼š\nå®è·µ åˆ›å»ºé“¾æ¥çš„å‘½ä»¤æ˜¯ ln targetfile linknameï¼Œå‘½ä»¤é»˜è®¤åˆ›å»ºçš„æ˜¯ç¡¬é“¾æ¥ï¼Œè‹¥è¦åˆ›å»ºç¬¦å·é“¾æ¥ï¼Œéœ€è¦åŠ ä¸Š -s å‚æ•°ï¼Œå³ ln -s targetfile linknameã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ls -l æŸ¥çœ‹æ–‡ä»¶ç¡¬é“¾æ¥çš„ä¸ªæ•°ï¼Œé€šè¿‡ ls -i æŸ¥çœ‹æ–‡ä»¶æ‰€å¯¹åº”çš„ inode å·ã€‚\nå…ˆç”¨ mkdir links åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç›®å½•ï¼Œcd links åˆ‡æ¢å·¥ä½œç›®å½•ï¼Œå†åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ echo \u0026quot;hello\u0026quot; \u0026gt; hello.txtã€‚ç°åœ¨ç”¨ ls -li æ£€æŸ¥ä¸€ä¸‹ï¼š\nubuntu@XPS9380:~/links$ ls -li total 4 3095 -rw-r--r-- 1 ubuntu ubuntu 6 Jul 27 14:25 hello.txt å¯ä»¥çœ‹åˆ°ï¼Œhello.txt çš„ç¡¬é“¾æ¥ä¸ªæ•°ä¸º 1ã€‚ç°åœ¨åˆ›å»ºä¸€ä¸ªç¡¬é“¾æ¥ï¼š\nubuntu@XPS9380:~/links$ ln hello.txt hlink ubuntu@XPS9380:~/links$ ls -li total 8 3095 -rw-r--r-- 2 ubuntu ubuntu 6 Jul 27 14:25 hello.txt 3095 -rw-r--r-- 2 ubuntu ubuntu 6 Jul 27 14:25 hlink å¯ä»¥çœ‹åˆ°ï¼Œhello.txt ä¸ hlink å¯¹åº”çš„ inode å·éƒ½æ˜¯ 3095ã€‚æ­¤å¤–ï¼Œhlink çš„æ–‡ä»¶ç±»å‹æ˜¯ -ï¼Œè¯´æ˜ç¡¬é“¾æ¥å°±æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ã€‚\nå†æ¥æ£€æŸ¥ä¸€ä¸‹æ–‡ä»¶å†…å®¹ï¼š\nubuntu@XPS9380:~/links$ cat hello.txt hello ubuntu@XPS9380:~/links$ cat hlink hello ä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜¯ä¸€æ ·çš„ã€‚\nç°åœ¨æ¥åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥ï¼š\nubuntu@XPS9380:~/links$ ln -s hello.txt slink ubuntu@XPS9380:~/links$ ls -li total 8 3095 -rw-r--r-- 2 ubuntu ubuntu 6 Jul 27 14:25 hello.txt 3095 -rw-r--r-- 2 ubuntu ubuntu 6 Jul 27 14:25 hlink 3633 lrwxrwxrwx 1 ubuntu ubuntu 9 Jul 27 14:38 slink -\u0026gt; hello.txt ubuntu@XPS9380:~/links$ cat slink hello ä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œslink çš„æ–‡ä»¶ç±»å‹æ˜¯ lï¼ˆç¬¦å·é“¾æ¥ï¼‰ã€‚è™½ç„¶ cat å‘½ä»¤çš„è¾“å‡ºå†…å®¹ä¸ hello.txt ç›¸åŒï¼Œä½† slink æœ‰ç€ä¸åŒçš„ inode å·ï¼Œæ–‡ä»¶å¤§å°ä¹Ÿä¸åŒã€‚\nç°åœ¨æ¥è¯•ä¸€ä¸‹åˆ é™¤æ“ä½œï¼Œæˆ‘ä»¬å…ˆåˆ é™¤ hello.txtï¼Œç„¶ååˆ†åˆ«æŸ¥çœ‹ slink ä¸ hlink çš„å†…å®¹ï¼š\nubuntu@XPS9380:~/links$ rm hello.txt ; ls -li total 4 3095 -rw-r--r-- 1 ubuntu ubuntu 6 Jul 27 14:25 hlink 3633 lrwxrwxrwx 1 ubuntu ubuntu 9 Jul 27 14:38 slink -\u0026gt; hello.txt ubuntu@XPS9380:~/links$ cat slink cat: slink: No such file or directory ubuntu@XPS9380:~/links$ cat hlink hello ubuntu@XPS9380:~/links$ å¯ä»¥å‘ç°ï¼Œé€šè¿‡ slink ä¸èƒ½å†è®¿é—®åˆ°æ–‡ä»¶å†…å®¹äº†ï¼Œè€Œé€šè¿‡ hlink å°±å¯ä»¥ã€‚\nå‚è€ƒèµ„æ–™  Hard link. Symbolic link. Manipulating files. The difference between hard and soft links.  ","href":"/posts/linux/links_in_the_linux_filesystem/","title":"Linux ä¸­çš„ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥"},{"content":"åœ¨å¹³å¸¸ä½¿ç”¨ Linux çš„è¿‡ç¨‹ä¸­ï¼Œæ€»æ„Ÿè§‰å„ä¸ªç›®å½•çš„ä½œç”¨å­˜åœ¨æŸç§çº¦å®šï¼Œä¼¼ä¹å¤§å®¶éƒ½å°†ç¨‹åºæ”¾åœ¨ /binã€/sbinã€/usr/bin æˆ– usr/sbin ä¸‹ï¼Œå°†é…ç½®æ–‡ä»¶æ”¾åˆ° /etc ä¸‹ï¼Œå°†ç”¨æˆ·çš„ä¸»ç›®å½•æ”¾åˆ° /home ä¸‹â€¦â€¦æ·±å…¥æŸ¥é˜…ç›¸å…³èµ„æ–™åæ‰å‘ç°ï¼Œè¿™èƒŒåè¿˜éšè—ç€ä¸€ä¸ªæ ‡å‡†â€”â€”Filesystem Hierarchy Standardã€‚æœ¬æ–‡çš„ä¸»è¦å†…å®¹å°±æ¥è‡ª FHS 3.0ã€‚\nä»”ç»†ä¸€æƒ³ï¼Œè¿™ä¹ˆåšä¹Ÿå¾ˆæœ‰é“ç†ã€‚æ¯•ç«Ÿ Linux æ˜¯å¼€æºçš„ï¼Œå‘è¡Œç‰ˆä¼—å¤šï¼Œæ›´æœ‰å¾ˆå¤šäººåœ¨ Linux çš„åŸºç¡€ä¸Šè¿›è¡Œå®šåˆ¶å¼€å‘ã€‚å¦‚æœå¤§å®¶éƒ½æŒ‰ç…§è‡ªå·±çš„æƒ³æ³•é…ç½® Linux ç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿç»“æ„ï¼Œå¯¹æ–‡ä»¶çš„ç®¡ç†å°†ä¼šæ˜¯ä¸€ä¸ªä»¤äººå¤´ç–¼çš„é—®é¢˜ã€‚ä¸ºäº†é¿å…äº”èŠ±å…«é—¨çš„ç›®å½•å±‚çº§ç»“æ„ï¼ŒLinux åŸºé‡‘ä¼šå‘å¸ƒäº† FHSï¼ˆFilesystem Hierarchy Standardï¼‰ï¼Œæ ‡å‡†ä¸»è¦è§„èŒƒäº† Linux ç³»ç»Ÿä¸­ä¸€çº§ç›®å½•å’Œéƒ¨åˆ†äºŒçº§ç›®å½•çš„ç”¨é€”ï¼Œä»¥åŠå„ä¸ªç›®å½•åº”è¯¥å­˜å‚¨ä»€ä¹ˆæ ·çš„æ•°æ®ï¼Œå¤§å¤šæ•° Linux å‘è¡Œç‰ˆéƒ½éµå¾ªè¿™ä¸€æ ‡å‡†ã€‚è¿™æ ·ï¼Œåœ¨ä¸ FHS ç›¸å…¼å®¹çš„ Linux ç³»ç»Ÿä¸Šï¼Œç”¨æˆ·å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œæ–‡ä»¶çš„ç®¡ç†ã€‚\nåŒºåˆ†æ–‡ä»¶ FHS é‡‡ç”¨äº†ä¸¤ç§ä¸åŒçš„æ–¹å¼å¯¹æ–‡ä»¶è¿›è¡ŒåŒºåˆ†ï¼š\n å¯å…±äº«ï¼ˆsharableï¼‰vs ä¸å¯å…±äº«ï¼ˆunsharableï¼‰ å¯å˜ï¼ˆvariableï¼‰ vs ä¸å¯å˜ï¼ˆstaticï¼‰  å¯å…±äº«æ–‡ä»¶æŒ‡é‚£äº›å¯ä»¥å…±äº«ç»™å…¶å®ƒä¸»æœºä½¿ç”¨çš„æ–‡ä»¶ï¼Œä¸å¯å…±äº«æ–‡ä»¶åˆ™ç›¸åã€‚ä¸å¯å˜æ–‡ä»¶åŒ…æ‹¬äºŒè¿›åˆ¶æ–‡ä»¶ã€åº“æ–‡ä»¶ã€æ–‡æ¡£ç­‰ï¼Œæ–‡ä»¶çš„æ”¹å˜é€šå¸¸éœ€è¦ç³»ç»Ÿçš„ç®¡ç†å‘˜ä»‹å…¥ï¼Œå¯å˜æ–‡ä»¶åˆ™ç›¸åã€‚\nä»¥ä¸‹æ˜¯ FHS ç»™å‡ºçš„ä¸€ä¸ªä¾‹å­ï¼š\n    sharable unsharable     static /usr, /opt /etc, /boot   variable /var/mail, /var/spool/news /var/run, /var/lock    æ ¹ç›®å½• Linux å°†æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçœ‹æˆä¸€æ£µæ ‘ï¼Œè¿™æ£µæ ‘çš„æ ¹èŠ‚ç‚¹å°±æ˜¯æ ¹ç›®å½•ï¼Œç”¨ / è¡¨ç¤ºã€‚æ ¹ç›®å½•å¾ˆé‡è¦ï¼Œæ‰€æœ‰çš„ç›®å½•éƒ½æ˜¯ç”±æ ¹ç›®å½•è¡ç”Ÿå‡ºæ¥çš„ï¼Œå®ƒè¿˜ä¸å¼€æœºã€è¿˜åŸã€ç³»ç»Ÿä¿®å¤ç­‰æ“ä½œæœ‰å…³ã€‚\nFHS å»ºè®®å°†æ ¹ç›®å½•æ”¾åœ¨ä¸å¤ªå¤§çš„åˆ†åŒºï¼Œå› ä¸ºåˆ†åŒºè¶Šå¤§ï¼Œå¯æ”¾å…¥çš„æ•°æ®å°±è¶Šå¤šï¼Œå‡ºé”™çš„å¯èƒ½æ€§å°±ä¼šå¢å¤§ã€‚FHS è¦æ±‚æ ¹ç›®å½•ä¸‹åº”è¯¥æœ‰ä»¥ä¸‹ç›®å½•ï¼š\n /binï¼šå­˜æ”¾ä¾›æ‰€æœ‰ç”¨æˆ·ä½¿ç”¨çš„å®ŒæˆåŸºæœ¬ç»´æŠ¤ä»»åŠ¡çš„å‘½ä»¤ã€‚è¿™é‡Œçš„ bin æ˜¯ binaries çš„ç¼©å†™ï¼Œä»£è¡¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé€šå¸¸æ˜¯å¯æ‰§è¡Œçš„ã€‚ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œæ¯”å¦‚ catã€lsã€cpã€rm ç­‰éƒ½åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚FHS è¿˜è¦æ±‚ /bin ç›®å½•ä¸èƒ½æœ‰å­ç›®å½•ã€‚ /bootï¼šå­˜æ”¾å¯åŠ¨ Linux æ—¶ç”¨åˆ°çš„ä¸€äº›æ ¸å¿ƒæ–‡ä»¶ï¼Œæ¯”å¦‚æ“ä½œç³»ç»Ÿå†…æ ¸ã€å¼•å¯¼ç¨‹åº Grub ç­‰ã€‚ /devï¼šå­˜æ”¾æ‰€æœ‰çš„è®¾å¤‡æ–‡ä»¶ã€‚ä»æ­¤ç›®å½•å¯ä»¥è®¿é—®ç£ç›˜ã€å†…å­˜ã€CD-ROM ç­‰ç³»ç»Ÿè®¾å¤‡ã€‚dev è¡¨ç¤º devicesã€‚FHS è¿˜è¦æ±‚ /dev ä¸‹æœ‰ä»¥ä¸‹è®¾å¤‡ï¼š  /dev/nullï¼šå†™åˆ°è¿™ä¸ªè®¾å¤‡çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šè¢«ä¸¢å¼ƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ \u0026gt; é‡å®šå‘ç¬¦å·å°†è¾“å‡ºæµé‡å®šå‘åˆ° /dev/null æ¥å¿½ç•¥è¾“å‡ºçš„ç»“æœã€‚ /dev/zeroï¼šè¿™æ˜¯ä¸€ä¸ªäº§ç”Ÿæ•°å­— 0 çš„è®¾å¤‡ï¼Œå†™åˆ°è¿™ä¸ªè®¾å¤‡çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚æ— è®ºä½ å¯¹å®ƒè¿›è¡Œå¤šå°‘æ¬¡è¯»å–ï¼Œéƒ½ä¼šè¯»åˆ° 0ã€‚ /dev/ttyï¼šè¡¨ç¤ºå½“å‰è¿›ç¨‹çš„æ§åˆ¶ç»ˆç«¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ echo \u0026quot;hello\u0026quot; \u0026gt; /dev/tty æ—¶ï¼Œhello å°±ä¼šå‡ºç°åœ¨å±å¹•ä¸Šã€‚tty æ˜¯ Teletype çš„ç¼©å†™ã€‚   /etcï¼šå­˜æ”¾é…ç½®æ–‡ä»¶ã€‚ /homeï¼šç”¨æˆ·çš„ä¸»ç›®å½•ï¼Œå­˜æ”¾ç”¨æˆ·çš„ä¸ªäººæ–‡ä»¶ã€‚é™¤ root ç”¨æˆ·å¤–ï¼Œæ¯ä¸ªç”¨æˆ·çš„ä¸»ç›®å½•å‡åœ¨ /home ä¸‹ä»¥ç”¨æˆ·è‡ªå·±çš„åå­—å‘½åã€‚ /libï¼šå­˜æ”¾å¯ç”¨ç³»ç»Ÿæˆ–è¿è¡Œ /bin å’Œ /sbin ç›®å½•ä¸­çš„å‘½ä»¤æ‰€éœ€çš„å…±äº«åº“ã€‚/libç›®å½•å¯èƒ½ä¼šæœ‰ä¸€äº›å˜ç§ï¼Œæ¯”å¦‚ lib32 å­˜æ”¾ 32 ä½ç¨‹åºæ‰€éœ€çš„åº“æ–‡ä»¶ï¼Œè€Œ lib64 å­˜æ”¾ 64 ä½ç¨‹åºæ‰€éœ€çš„åº“æ–‡ä»¶ã€‚ /mediaï¼šæŒ‚è½½å¯ç§»åŠ¨è®¾å¤‡ï¼Œä¸€èˆ¬ç”¨äºè‡ªåŠ¨æŒ‚è½½ U ç›˜ç­‰åª’ä½“ã€‚ /mntï¼šä¸´æ—¶ç”¨äºæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿçš„åœ°æ–¹ï¼Œ /optï¼šå¤šæ•°ç¬¬ä¸‰æ–¹è½¯ä»¶é»˜è®¤ä¼šå®‰è£…åˆ°æ­¤ä½ç½®ã€‚è¿™é‡Œçš„ opt æ˜¯ optional çš„ç¼©å†™ã€‚ /rootï¼šroot ç”¨æˆ·ä¸»ç›®å½•çš„é»˜è®¤ä½ç½®ã€‚ /runï¼šå­˜æ”¾ç³»ç»Ÿå¯åŠ¨åä¸ç³»ç»Ÿçš„ä¿¡æ¯æ•°æ®ï¼ŒåŒ…æ‹¬ PID(process identifier) æ–‡ä»¶ï¼ŒPID æ–‡ä»¶é€šå¸¸å‘½åä¸º \u0026lt;program-name\u0026gt;.pidã€‚åœ¨ boot è¿›ç¨‹å¼€å§‹ä¹‹å‰ï¼Œè¿™ä¸ªç›®å½•å¿…é¡»è¢«æ¸…ç©ºã€‚ /sbinï¼šå­˜æ”¾ä¸ç³»ç»Ÿå¯åŠ¨ã€ä¿®å¤ã€æ¢å¤ç­‰ä¸ç³»ç»Ÿç»´æŠ¤æœ‰å…³çš„å‘½ä»¤ï¼Œä¾‹å¦‚ shutdownã€rebootã€fsckã€ifconfig ç­‰ï¼Œéœ€è¦ root ç”¨æˆ·æ‰èƒ½æ‰§è¡Œã€‚sbin è¡¨ç¤º system binariesã€‚ /srvï¼šå­˜æ”¾ç³»ç»Ÿæ‰€æä¾›çš„æœåŠ¡çš„ç›¸å…³æ•°æ®ï¼Œä¾‹å¦‚ /srv/www å¯åŒ…å« Web æœåŠ¡å™¨ç›¸å…³çš„æ•°æ®ã€‚srv è¡¨ç¤º serviceã€‚ /tmpï¼šå­˜æ”¾ä¸´æ—¶æ–‡ä»¶ã€‚æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥åœ¨è¿™ä¸ªç›®å½•ä¸­åˆ›å»ºã€ç¼–è¾‘æ–‡ä»¶ï¼Œä½†åªæœ‰æ–‡ä»¶æ‹¥æœ‰è€…æ‰èƒ½åˆ é™¤æ–‡ä»¶ã€‚tmp è¡¨ç¤º temporaryã€‚ /sysï¼šå­˜æ”¾ä¸è®¾å¤‡ã€é©±åŠ¨å’Œä¸€äº›ä¸å†…æ ¸æœ‰å…³çš„ä¿¡æ¯ã€‚ /procï¼šå­˜æ”¾å†…æ ¸ä¸è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ã€‚ä¾‹å¦‚ /proc/cpuinfo å«æœ‰ä¸ CPU ç›¸å…³çš„ä¿¡æ¯ã€‚  /usr ç›®å½• /usr æ˜¯ä¸€ä¸ªåºå¤§çš„æ–‡ä»¶å¤¹ï¼Œå…¶ä¸‹çš„ç›®å½•ç»“æ„ä¸æ ¹ç›®å½•ç›¸ä¼¼ã€‚æ ¹ç›®å½•ä¸­çš„æ–‡ä»¶å¤šæ˜¯ç³»ç»Ÿçº§çš„æ–‡ä»¶ï¼Œè€Œ /usr ä¸­æ˜¯ç”¨æˆ·çº§çš„æ–‡ä»¶ï¼Œä¸€èˆ¬ä¸å…·ä½“çš„ç³»ç»Ÿæ— å…³ã€‚/usr ç›®å½•å­˜æ”¾çš„æ˜¯ å¯å…±äº«ã€åªè¯» çš„æ•°æ®ã€‚è¿™æ„å‘³ç€ /usr ä¸­çš„æ–‡ä»¶å¯ä»¥åœ¨ä¸ FHS å…¼å®¹çš„ä¸»æœºä¹‹é—´å…±äº«ï¼Œä¸”ä¸å¯ä»¥è¢«ä¿®æ”¹ã€‚\nåœ¨æ—©æœŸçš„ Unix/Linux ç³»ç»Ÿä¸­ï¼Œ/usr è¢«ç”¨ä½œç”¨æˆ·çš„ä¸»ç›®å½•ï¼ˆç±»ä¼¼äºç°åœ¨çš„ /home ç›®å½•ï¼‰ï¼Œusr è¡¨ç¤º userã€‚è€Œåœ¨ç°åœ¨çš„ Unix/Linux ç³»ç»Ÿä¸­ï¼Œ/usr å­˜æ”¾çš„æ˜¯ç”¨æˆ·çº§çš„ç¨‹åºå’Œæ•°æ®ï¼Œusr è¡¨ç¤º User System Resourcesã€‚ä¸è¿‡åœ¨ç½‘ä¸Šï¼Œæœ‰äººè¯´ usr æ˜¯ Unix Software Resources çš„ç¼©å†™ï¼Œè¿˜æœ‰äººè¯´æ˜¯ Unix System Resources çš„ç¼©å†™â€¦â€¦ç¬”è€…åœ¨è¿™é‡Œç»™å‡ºä¸Šé¢å†…å®¹çš„å‚è€ƒæ¥æºâ€”â€”Linux Filesystem Hierarchyï¼š/usrï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œåˆ¤æ–­ã€‚å½“ç„¶ï¼Œåå­—çš„æ¥æºä¸çŸ¥é‡ç‚¹ğŸ¤­\n/usr çš„å­ç›®å½•ä¸€èˆ¬æœ‰ï¼š\n /usr/binï¼šç»å¤§éƒ¨åˆ†ç”¨æˆ·å¯ä½¿ç”¨çš„å‘½ä»¤éƒ½æ”¾åœ¨è¿™é‡Œï¼Œè¿™äº›å‘½ä»¤é€šå¸¸ä¸ç³»ç»Ÿçš„ç»´æŠ¤æ— å…³ã€‚ /usr/includeï¼šä¸»è¦æ”¾ç½® C/C++ ç¨‹åºçš„å¤´æ–‡ä»¶ã€‚ /usr/libï¼šå­˜æ”¾ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨çš„åº“æ–‡ä»¶ã€‚ /usr/localï¼šç³»ç»Ÿç®¡ç†å‘˜åœ¨æœ¬æœºå®‰è£…çš„è½¯ä»¶ä¸€èˆ¬éƒ½åœ¨è¿™ä¸‹é¢ï¼Œå…¶ç›®å½•ç»“æ„ä¸ /usr ç›®å½•ç±»ä¼¼ã€‚ /usr/sbinï¼šå­˜æ”¾ä¸æ˜¯ /sbin ä¸­ä¸€å®šè¦æœ‰çš„ç³»ç»Ÿç®¡ç†å‘½ä»¤ã€‚ /usr/shareï¼šå­˜æ”¾äºç³»ç»Ÿç¡¬ä»¶æ¶æ„æ— å…³çš„æ•°æ®ã€‚æ¯”å¦‚ /usr/share/man å­˜æ”¾æœ‰åœ¨çº¿æ‰‹å†Œã€/usr/share/xml å­˜æ”¾ XML æ•°æ®ã€‚ /usr/srcï¼šå­˜æ”¾æºä»£ç æ–‡ä»¶ã€‚  /var ç›®å½• /var ç›®å½•å­˜æ”¾ç€å¯å˜çš„æ•°æ®æ–‡ä»¶ï¼Œæ¯”å¦‚è¿è¡Œæ—¥å¿—ã€ä¸´æ—¶æ–‡ä»¶ç­‰ã€‚var è¡¨ç¤º variableã€‚\n/var çš„å­ç›®å½•ä¸»è¦æœ‰ï¼š\n /var/cacheï¼šå­˜æ”¾åº”ç”¨çš„ç¼“å­˜æ•°æ®ã€‚ /var/crashï¼šå­˜æ”¾ç³»ç»Ÿå´©æºƒåçš„è½¬å‚¨æ–‡ä»¶ï¼ˆdumpï¼‰ã€‚ /var/libï¼šå­˜æ”¾åº”ç”¨ç¨‹åºè¿è¡Œæ—¶éœ€è¦çš„çŠ¶æ€ä¿¡æ¯ã€‚ /var/lockï¼šå­˜æ”¾é”æ–‡ä»¶ã€‚æŸäº›è®¾å¤‡æˆ–èµ„æºä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œå¦‚æœèµ„æºåŒæ—¶è¢«ä¸¤ä¸ªæˆ–å¤šä¸ªç¨‹åºä½¿ç”¨ï¼Œå°±å¯èƒ½äº§ç”Ÿä¸€äº›é”™è¯¯ï¼Œå› æ­¤éœ€è¦ä¸Šé”ã€‚ /var/logï¼šå­˜æ”¾æ—¥å¿—æ•°æ®ã€‚ /var/optï¼šå­˜æ”¾å®‰è£…åœ¨ /opt ç›®å½•ä¸­çš„ç¨‹åºç”¨åˆ°çš„å¯å˜æ•°æ®ã€‚ /var/runï¼šå­˜æ”¾æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºçš„ä¿¡æ¯ï¼Œä¾‹å¦‚ PID æ–‡ä»¶ã€‚ /var/tmpï¼šå­˜æ”¾ç³»ç»Ÿé‡å¯ä¹‹é—´ä¿å­˜çš„ä¸´æ—¶æ–‡ä»¶ã€‚  å‚è€ƒèµ„æ–™  FHS 3 Specification Series. Linux Filesystem Hierarchyï¼š/usr. Filesystem Hierarchy Standard. Terminal Special Files such as /dev/tty.  ","href":"/posts/linux/linux_directory_structure/","title":"Linux ç›®å½•ç»“æ„"},{"content":"åœ¨ Windows ä¸­ï¼Œæ–‡ä»¶ç±»å‹æ˜¯æ ¹æ®æ‰©å±•åæ¥ç¡®å®šçš„ã€‚ä¾‹å¦‚ï¼ša.pdf æ˜¯ä¸€ä¸ª pdf æ–‡ä»¶ï¼Œè€Œ b.txt æ˜¯ä¸€ä¸ª txt æ–‡ä»¶ã€‚ä½†åœ¨ Linux/Unix ä¸­ï¼Œæ–‡ä»¶ç±»å‹ä¸æ–‡ä»¶æ‰©å±•åæ²¡æœ‰å…³ç³»ï¼Œå®ƒä»¬æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æ¦‚å¿µã€‚Linux/Unix å°†ä¸€åˆ‡éƒ½çœ‹ä½œæ˜¯æ–‡ä»¶ï¼Œäº†è§£æ–‡ä»¶ç±»å‹æœ‰åŠ©äºæˆ‘ä»¬å¯¹å®ƒä»¬è¿›è¡Œé«˜æ•ˆçš„ç®¡ç†ã€‚\nPOSIX ä¸­å®šä¹‰äº†ä¸ƒç§æ ‡å‡†çš„æ–‡ä»¶ç±»å‹ï¼š\n æ™®é€šæ–‡ä»¶ï¼ˆregular fileï¼‰ ç›®å½•ï¼ˆdirectoryï¼‰ ç¬¦å·é“¾æ¥ï¼ˆsymbolic linkï¼‰ å‘½åç®¡é“ï¼ˆFIFO special file or named pipeï¼‰ å¥—æ¥å­—ï¼ˆsocketï¼‰ å­—ç¬¦è®¾å¤‡ï¼ˆcharacter special fileï¼‰ å—è®¾å¤‡ï¼ˆblock special fileï¼‰  æ­¤å¤–ï¼Œéƒ¨åˆ† Linux/Unix æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆä¸­å¯èƒ½è¿˜æœ‰ POSIX è§„å®šä»¥å¤–çš„æ–‡ä»¶ç±»å‹ï¼Œæ¯”å¦‚ Solaris ä¸­çš„ door ç±»å‹ã€‚\nåœ¨ Linux/Unix æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶çš„å…ƒæ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªè¢«ç§°ä¸º inode çš„æ•°æ®ç»“æ„ä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ inodeã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ stat å‘½ä»¤æ¥æŸ¥çœ‹æŸä¸ªæ–‡ä»¶çš„ inode ä¿¡æ¯ã€‚è‹¥åªéœ€è¦æŸ¥çœ‹æ–‡ä»¶ç±»å‹ï¼Œstatè¾“å‡ºå†…å®¹æœªå…å¤ªå¤šäº†ç‚¹ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ file å‘½ä»¤æˆ–è€… ll(æˆ– ls -l) å‘½ä»¤ã€‚file å‘½ä»¤ä¼šç›´æ¥å±•ç¤ºæ–‡ä»¶ç±»å‹ï¼Œè€Œ ll å‘½ä»¤çš„æ–‡ä»¶ç±»å‹éšè—åœ¨è¾“å‡ºçš„ç¬¬ä¸€ä¸ªå­—æ¯ä¸­ï¼Œä»¥ä¸‹é¢è¾“å‡ºä¸ºä¾‹ï¼š\ndrwxr-xr-x 4 ubuntu ubuntu 4096 Feb 24 23:28 test ls -l å‘½ä»¤ä¸­çš„å‚æ•° l è¡¨ç¤º â€œuse a long listing formatâ€ï¼Œè¯¥è¾“å‡ºçš„å†…å®¹ä»å·¦åˆ°å³åˆ†åˆ«æ˜¯ï¼šæ–‡ä»¶ç±»å‹ï¼ˆdï¼‰ã€æƒé™ï¼ˆrwxr-xr-xï¼‰ã€ç¡¬é“¾æ¥ä¸ªæ•°ï¼ˆ4ï¼‰ã€æ‰€æœ‰è€…ï¼ˆubuntuï¼‰ã€æ‰€å±ç»„ï¼ˆubuntuï¼‰ã€æ–‡ä»¶å¤§å°ï¼ˆ4096ï¼‰ã€ä¸Šæ¬¡ä¿®æ”¹æ—¶é—´ï¼ˆFeb 24 23:28ï¼‰å’Œæ–‡ä»¶åï¼ˆtestï¼‰ã€‚å…¶ä¸­æƒé™åˆåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œä»å·¦åˆ°å³åˆ†åˆ«æ˜¯æ‰€æœ‰è€…æƒé™ï¼ˆrwrï¼‰ã€æ‰€å±ç»„æƒé™ï¼ˆr-xï¼‰å’Œå…¶ä»–äººæƒé™ï¼ˆr-xï¼‰ã€‚æˆ‘ä»¬è¿™é‡Œä¸»è¦å…³å¿ƒçš„æ˜¯æ–‡ä»¶ç±»å‹ï¼Œå³è¾“å‡ºä¸­çš„ç¬¬ä¸€ä¸ªå­—æ¯ã€‚ls çš„æ–‡æ¡£ç»™å‡ºäº† 13 ä¸ªå­—æ¯ï¼Œç”¨æ¥æ ‡è¯†ä¸åŒçš„æ–‡ä»¶ç±»å‹ï¼š\n   character file type     - regular file   b block special file   c character special file   C high performance (â€œcontiguous dataâ€) file   d directory   D door (Solaris 2.5 and up)   l symbolic link   M off-line (â€œmigratedâ€) file (Cray DMF)   n network special file (HP-UX)   p FIFO (named pipe)   P port (Solaris 10 and up)   s socket   ? some other file type    ls å‘½ä»¤ä¸­è¿˜æœ‰ä¸€ä¸ªæœ‰è¶£çš„å‚æ•°æ˜¯ -Fï¼Œå®ƒçš„ä½œç”¨æ˜¯â€œAppend a character to each file name indicating the file typeâ€ã€‚åŒæ ·ï¼Œls çš„æ–‡æ¡£ä¹Ÿç»™å‡ºäº†ä¸åŒå­—æ¯çš„å«ä¹‰ã€‚å¯èƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿æ˜¾ç¤ºå’ŒåŒºåˆ†ï¼Œ-F è¾“å‡ºçš„å†…å®¹ä¸­ç”¨çš„æ˜¯ç¬¦å·ï¼š\n   å­—æ¯ æ–‡ä»¶ç±»å‹     * å¯æ‰§è¡Œæ–‡ä»¶   / ç›®å½•   @ ç¬¦å·é“¾æ¥   | ç®¡é“   = å¥—æ¥å­—   \u0026gt; door    æ²¡æœ‰åœ¨æ–‡ä»¶åæœ«å°¾è¿½åŠ ç¬¦å·çš„å°±æ˜¯æ™®é€šæ–‡ä»¶ã€‚\næ™®é€šæ–‡ä»¶ æ™®é€šæ–‡ä»¶ æ˜¯ä¸€ä¸ªå¯éšæœºè®¿é—®çš„å­—èŠ‚åºåˆ—ã€‚å®ƒæ˜¯ Linux/Unix ä¸­æœ€å¤šçš„ä¸€ç±»æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ–‡æœ¬æ–‡ä»¶ã€äºŒè¿›åˆ¶æ–‡ä»¶ã€å›¾ç‰‡ã€è§†é¢‘ã€å‹ç¼©æ–‡ä»¶ç­‰ã€‚\nç›®å½• ç›®å½•æ˜¯ä¸€ä¸ªåŒ…å«ç›®å½•é¡¹çš„æ–‡ä»¶ã€‚ç›®å½•é¡¹å°†æ–‡ä»¶åä¸æ–‡ä»¶ï¼ˆæ¯”å¦‚æ™®é€šæ–‡ä»¶ã€ç›®å½•å’Œå„ç§ç‰¹æ®Šæ–‡ä»¶ï¼‰è¿›è¡Œå…³è”ã€‚ä½†ä¸€ä¸ªç›®å½•ä¸­ä¸èƒ½æœ‰ä¸¤ä¸ªåŒåçš„ç›®å½•é¡¹ã€‚\nç¬¦å·é“¾æ¥ ç¬¦å·é“¾æ¥æŒ‡å‘è®¡ç®—æœºä¸Šçš„å¦ä¸€ä¸ªæ™®é€šæ–‡ä»¶æˆ–ç›®å½•ï¼Œå®ƒä¼šå½±å“åˆ°è·¯å¾„åè§£æçš„è¿‡ç¨‹ã€‚\nå‘½åç®¡é“ å‘½åç®¡é“ï¼ˆnamed pipeï¼‰å³å…·å¤‡ FIFO ç‰¹æ€§çš„æ–‡ä»¶ï¼Œåœ¨ Linux/Unix ä¸­å¸¸ç”¨äºè¿›ç¨‹é—´é€šä¿¡ã€‚ä¸ä¼ ç»Ÿçš„åŒ¿åç®¡é“ï¼ˆå³æˆ‘ä»¬å¸¸ç”¨çš„ | å‘½ä»¤ï¼‰ä¸åŒçš„æ˜¯ï¼Œå‘½åç®¡é“ä½¿ç”¨åˆ°äº†æ–‡ä»¶ç³»ç»Ÿï¼Œæ˜¯ä¸€ç§æ–‡ä»¶ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ mkfifo å‘½ä»¤åˆ›å»ºå‘½åç®¡é“ï¼Œä¾‹å¦‚ï¼š\nmkfifo my_pipe ä½¿ç”¨ ls -l å‘½ä»¤å¯ä»¥å‘ç°è¾“å‡ºç»“æœçš„ç¬¬ä¸€ä¸ªå­—æ¯æ˜¯ pï¼ŒåŒæ—¶æ–‡ä»¶å¤§å°æ˜¯ 0ï¼š\nprw-r--r-- 1 ubuntu ubuntu 0 Jul 22 16:51 my_pipe å½“æ‰§è¡Œ cat my_pipe æ—¶ï¼Œä½ ä¼šå‘ç°å½“å‰çš„ç»ˆç«¯ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚å› ä¸ºæ­¤æ—¶ my_pipe ä¸­æ²¡æœ‰ä»»ä½•å†…å®¹ï¼ˆä½ åˆšæ‰ä¹Ÿçœ‹åˆ°äº†ï¼Œå®ƒçš„æ–‡ä»¶å¤§å°æ˜¯ 0ï¼‰ã€‚æ­¤æ—¶ï¼Œè‹¥æˆ‘ä»¬å¦å¼€ä¸€ä¸ªç»ˆç«¯å†™ç‚¹ä¸œè¥¿åˆ° my_pipe ä¸­ï¼Œä¾‹å¦‚ï¼š\necho \u0026#34;test\u0026#34; \u0026gt; my_pipe è¿™æ—¶ï¼Œåˆšæ‰æ‰§è¡Œçš„ cat my_pipe å°±ä¼šè¿”å›ï¼Œå¹¶æ‰“å°å‡º testã€‚\nå¥—æ¥å­— å¥—æ¥å­—ä½œä¸ºé€šä¿¡ç«¯ç‚¹ç”¨äºè¿›ç¨‹é—´é€šä¿¡ï¼Œæ˜¯ä¸€ç§æœ‰ç€ç‰¹å®šç”¨é€”çš„æ–‡ä»¶ã€‚åœ¨è¿›ç¨‹é—´é€šä¿¡æ–¹é¢ï¼Œå®ƒå’Œç®¡é“æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†ç®¡é“æ˜¯å•å‘çš„ï¼Œè€Œå¥—æ¥å­—æ˜¯åŒå‘å…¨åŒå·¥çš„ã€‚\nå­—ç¬¦è®¾å¤‡ å­—ç¬¦è®¾å¤‡ æä¾›ä¸²è¡Œè¾“å…¥æµæˆ–è€…æ¥æ”¶ä¸²è¡Œè¾“å‡ºæµï¼Œä¸å…·å¤‡éšæœºè®¿é—®çš„èƒ½åŠ›ã€‚ä¾‹å¦‚ç»ˆç«¯å’Œ /dev/null éƒ½æ˜¯å­—ç¬¦è®¾å¤‡æ–‡ä»¶ã€‚\nå—è®¾å¤‡ å—è®¾å¤‡å…·å¤‡éšæœºè®¿é—®çš„èƒ½åŠ›ï¼Œ/dev/ ç›®å½•ä¸‹çš„å¤§å¤šæ•°æ–‡ä»¶éƒ½æ˜¯å—è®¾å¤‡ã€‚\nå‚è€ƒèµ„æ–™  Unix file types.  ","href":"/posts/linux/file_types_in_linux_or_unix/","title":"Linux/Unix ä¸­çš„æ–‡ä»¶ç±»å‹"},{"content":"","href":"/tags/%E6%B8%B8%E8%AE%B0/","title":"æ¸¸è®°"},{"content":"","href":"/categories/%E6%B8%B8%E8%AE%B0/","title":"æ¸¸è®°"},{"content":"è‡ªå¤§å­¦å–œæ¬¢ä¸Šéª‘è¡Œä»¥æ¥ï¼Œå·è—çº¿å°±ä¸€ç›´è¦ç»•åœ¨å¿ƒå¤´ï¼Œè¿™ä¸ªå¿µæƒ³ç»ˆäºä¹Ÿåœ¨æˆ‘æ¯•ä¸šä¸¤å¹´åæˆä¸ºäº†ç°å®ã€‚ç»è¿‡ä¸€ç•ªå‡†å¤‡ï¼Œæˆ‘äº 2021 å¹´ 6 æœˆ 22 æ—¥å‡ºå‘ï¼Œç”¨è½¦è½®å»è½»å»æœ€ç¾çš„ 318ï¼Œå»è¿½å¯»å¤§å­¦æ—¶çš„æ¢¦ã€‚\nD1ï¼šæˆéƒ½â€”â€”é›…å®‰ï¼ˆ141kmï¼‰ åŸæœ¬æ˜¯æ‰“ç®— 21 å·å‡ºå‘çš„ï¼Œä½†ç”±äºå¿«é€’åŸå› ï¼Œè£…å¤‡æ²¡æœ‰åˆ°é½ï¼Œåªå¾—æ¨è¿Ÿä¸€å¤©å‡ºå‘ã€‚ä¸€ç›´æ²¡æ‰¾åˆ°é è°±çš„é˜Ÿå‹ï¼Œåªå¾—ç‹¬è‡ªè¸ä¸Šå¾é€”ï¼Œæ—¢å…´å¥‹åˆå¿å¿‘ã€‚\nä¸Šåˆçš„å¤©æ°”è¿˜ä¸ç®—å¤ªçƒ­ï¼Œæˆ‘ç‹¬è‡ªç©¿è¿‡åŒæµâ€”â€”æ–°æ´¥ï¼Œåœ¨å‰å¾€é‚›å´ƒçš„è·¯ä¸Šç»ˆäºç¢°åˆ°äº†ä¸‰ä¸ªé•¿é€”éª‘è¡Œè€…ï¼Œäº¤è°ˆåå‘ç°ä»–ä»¬æ¥è‡ªé£ç™»éª‘è¡Œï¼Œæ­¤è¡Œçš„ç›®çš„åœ°ä¹Ÿæ˜¯æ‹‰è¨ã€‚\nä¸‰äººä¸­ä¸ºé¦–çš„æ˜¯ä¸€ä½æ¥è‡ªå±±ä¸œçš„å¤§çˆ·ï¼Œä»¥å‰æŒ‘æˆ˜è¿‡ä¸€æ¬¡å·è—çº¿ï¼ŒæœªæˆåŠŸï¼Œè¿™æ¬¡å¿—åœ¨å¿…å¾—ã€‚åŠ äº†èƒ–å­çš„å¾®ä¿¡ï¼Œè·Ÿä»–ä»¬èµ°äº†ä¸€æ®µå‘ç°èŠ‚å¥ç›¸å·®å¤ªå¤§ï¼Œäºæ˜¯æˆ‘åˆå•é£äº†ã€‚\nåˆ°äº†é‚›å´ƒï¼Œçƒˆæ—¥å½“ç©ºï¼Œçœ‹äº†ä¸€çœ¼æ‰‹è¡¨ï¼Œå·²æ˜¯é¥­ç‚¹ï¼Œé‚åœ¨è·¯å£æ‰¾äº†å®¶é¢é¦†åƒé¢ï¼Œé¡ºä¾¿ä¼‘æ¯ä¼‘æ¯ã€‚ä¸€ç¢—é¢ä¸‹è‚šï¼Œå‡†å¤‡å‡ºå‘ï¼Œå‘ç°ä¸€ç™½è¡£éª‘å£«å‘æˆ‘æ‰“æ‹›å‘¼ï¼Œå«æˆ‘æ­‡ä¼šå„¿å†èµ°ã€‚æƒ³äº†ä¸€ä¸‹ï¼Œåæ­£ä»Šå¤©ä¹Ÿä¸èµ¶æ—¶é—´ï¼Œåˆçœ‹äº†çœ‹è¿™å¤´é¡¶çš„çƒˆæ—¥ï¼Œå°±åä¸‹å’Œä»–èŠäº†èµ·æ¥ã€‚é€šè¿‡èŠå¤©å¾—çŸ¥ï¼Œè¿™å…„å¼Ÿæ¥è‡ªæ²³å—ï¼Œå§“éº»ï¼Œæˆ‘ç®¡ä»–å«â€œéº»å…„â€ã€‚éº»å…„ä»Šå¤©ä¹Ÿåˆšä»æˆéƒ½å‡ºå‘ï¼Œç›®çš„åœ°ä¹Ÿæ˜¯æ‹‰è¨ï¼Œæœ‰ç¼˜çš„æ˜¯ï¼Œéº»å…„æˆä¸ºäº†æˆ‘ä¸€è·¯çš„å®¤å‹ï¼Œç›´åˆ°æ‹‰è¨ã€‚éº»å…„é¢è¿˜æœªåƒå®Œï¼Œä¸¤ä½å¥³éª‘å£«æœ‰ä»æ—è€Œè¿‡ï¼Œå…¶ä¸­ä¸€å¤§å§è¿˜å«æˆ‘å¸®å¥¹çœ‹è½¦å­çš„é—®é¢˜ã€‚çœ‹ç€é—®é¢˜èŠç€å¤©ï¼Œå‘ç°å¥¹ä»¬æ˜¯ä»ç»µé˜³å‡ºå‘ï¼Œä»Šå¤©ç¬¬äºŒå¤©ï¼Œä¹Ÿæ˜¯æ‰“ç®—åˆ°æ‹‰è¨ã€‚é—®å¥¹ä»¬ä»Šæ™šå‡†å¤‡åˆ°é‚£ï¼Œè¯´æ˜¯é£ä»™å…³é•‡æˆ–è€…å¤©å…¨å¿ï¼Œæˆ‘é»˜é»˜åœ°æå‡ºæ‰‹æœºçœ‹äº†ä¸‹åœ°å›¾ï¼Œè¿é“äº†ä¸‰å¥â€œç‰›é€¼â€ã€‚è¿™ä¸¤ä½å¥³éª‘å£«ä¸­æœ‰ä¸€ä½æ¯”è¾ƒå‰å®³ï¼Œæˆ‘ç®¡å¥¹å«â€œå¤§ä½¬â€ï¼Œå¤§ä½¬ç®¡å¦ä¸€ä½å«â€œç‚¹ç¯â€ã€‚\nå¾…éº»å…„åƒå®Œé¢ç¨ä½œæ­‡æ¯åï¼Œæˆ‘å°±å’Œéº»å…„ä¸€èµ·å…ˆå‡ºå‘äº†ã€‚æˆ‘å’Œéº»å…„ä¸€è‡´è®¤ä¸ºå¥¹ä»¬åˆ°é£ä»™å…³æˆ–å¤©å…¨çš„è®¡åˆ’æ˜¯ç—´å¿ƒå¦„æƒ³ï¼Œæ²¡æƒ³åˆ°æ˜¯çœŸçš„ï¼Œå› ä¸ºç¬¬äºŒå¤©æˆ‘ä»¬åˆç¢°ä¸Šå¥¹ä»¬äº†ã€‚åŸæ¥ï¼Œå¥¹ä»¬ç¬¬ä¸€å¤©çœŸçš„åˆ°äº†å¤©å…¨å¿ï¼Œåªä¸è¿‡æ˜¯èµ¶äº†å¤œè·¯ï¼Œæ™šä¸Šåç‚¹åˆ°çš„ã€‚æ›´æœ‰è¶£çš„æ—¶ï¼Œå¥¹ä»¬è·¯ä¸Šè¿˜æ¡äº†ä¸¤ä¸ªäººï¼Œç»„å»ºäº†å¾®ä¿¡ç¾¤â€œå¤§ä½¬ä¸‰äººè¡Œå’Œä»–ä»¬çš„å°è·Ÿç­â€ã€‚\né‚›å´ƒå‡ºå»ä¸ä¹…ï¼Œæˆ‘å’Œéº»å…„å°±åœ¨è·¯è¾¹æ‰¾äº†æ£µå¤§æ ‘æ­‡å‡‰ï¼Œå› ä¸ºå¤©æ°”å®åœ¨å¤ªçƒ­äº†ã€‚æ ‘ä¸‹æ­‡äº†è¿‘åŠå°æ—¶ï¼Œä¹Ÿæ²¡è§ä¸€æœµäº‘è·‘æ¥æŠŠå¤ªé˜³é®ä½ï¼Œæ— å¥ˆä¹‹ä¸‹ï¼Œæˆ‘ä»¬åˆå‡ºå‘äº†ã€‚æˆéƒ½çš„å¤å¤©ï¼Œä¸€ä¸ªè¥¿ç“œç»å¯¹èƒ½è®©ä½ çˆ½ä¸Šå¤©ï¼Œå†°é•‡çš„å°±æ›´ä¸ç”¨è¯´äº†ã€‚é¡¶ç€å¤ªé˜³éª‘è¡Œåˆ°äº†ç”˜æºªé•‡ï¼Œå‘ç°é©¬è·¯å¯¹é¢æœ‰ä¸€æ°´æœåº—ï¼Œæˆ‘å’Œéº»å…„å†³å®šè¿›å»åƒä¸ªè¥¿ç“œï¼Œé¡ºä¾¿é¿é¿å¤©ä¸Šè¿™ä¸ªç«çƒã€‚è°çŸ¥ï¼Œåˆšè¿›æ°´æœæ‘Šï¼Œå°±æ„Ÿè§‰å¤ªé˜³å…‰çš„å¼ºåº¦å˜å¾—æ›´å¤§äº†ï¼Œä¹Ÿç½¢ï¼Œæˆ‘ä»¬å°±åƒç€è¥¿ç“œç­‰â€¦â€¦åƒç“œè¿‡ç¨‹ä¸­ï¼Œé©¬è·¯å¯¹é¢è¿‡å»äº†ä¸€è¾†è‡ªè¡Œè½¦ï¼Œæœ€å¼€å§‹æˆ‘è¿˜ä»¥ä¸ºæ˜¯å­¦ç”Ÿï¼Œåæ¥è¿½ä¸Šåå‘ç°ä»–ä¹Ÿæ˜¯å‡†å¤‡éª‘è‡ªè¡Œè½¦åˆ°æ‹‰è¨ï¼Œæ¥è‡ªå¹¿ä¸œï¼Œæ‰€ä»¥æˆ‘ä»¬ç®¡ä»–å«â€œå°å¹¿ä¸œâ€ã€‚\nå°å¹¿ä¸œæ¥æˆéƒ½ä¹‹å‰åœ¨å¹¿è¥¿æ¸¸ç©ï¼Œéª‘è¡Œè£…å¤‡éƒ½æ˜¯åœ¨æˆéƒ½æ·»ç½®çš„ï¼Œä»Šå¤©ä¸­åˆæ‰ä»é‚›å´ƒå‡ºå‘ï¼Œå–œæ¬¢æ·±åº¦æ¸¸ç©ã€‚æˆ‘å’Œéº»å…„ã€å°å¹¿ä¸œä¸‰äººå†³å®šæš‚æ—¶ç»“ä¼´åŒè¡Œï¼Œä¸€è·¯æœ‰è¯´æœ‰ç¬‘ï¼Œäºä¸‹åˆäº”ç‚¹è¿‡æŠµè¾¾é›…å®‰é©¬è¸é£ç‡•åœ°æ ‡ã€‚\nå…¶å®åœ¨è·ç¦»é©¬è¸é£ç‡•è¿˜æœ‰ä¸€å…¬é‡Œå·¦å³æ—¶ï¼Œå°±æœ‰ä¸€ä¸ªéª‘ç€ç”µæ‘©çš„äººè¿½ç€æˆ‘ä»¬é—®è¦ä¸è¦ä½å®¿ï¼Œæ­¤äººèº«ä»½å°±ä¸ç»†è¯´äº†ã€‚è™½æ˜¯éª‘è¡Œè”ç›Ÿçš„å®¢æ ˆè€æ¿ï¼Œè¿™æ½å®¢æœªå…ä¹Ÿå¤ªè¿‡çƒ­æƒ…äº†å§ï¼Œå±…ç„¶ä¸€ç›´è·Ÿç€æˆ‘ä»¬åˆ°äº†é©¬è¸é£ç‡•ï¼Œè¿˜ç»™æˆ‘ä»¬æ‹äº†ç…§ç‰‡ã€‚å©‰è¨€ç›¸è·ä¹‹åï¼Œæˆ‘ä»¬ç»§ç»­å‰è¡Œï¼Œåœ¨é›…å®‰æ±½è½¦ç«™é™„è¿‘æ‰¾äº†åŠ å®¾é¦†å…¥ä½ï¼Œç»“æŸäº†ç¬¬ä¸€å¤©çš„è¡Œç¨‹ã€‚æ™šé¥­åï¼Œå¸¦ä¸¤ä½å¤–åœ°æœ‹å‹å°äº†ä¸‹é›…å®‰çš„å†°ç²‰ï¼Œä¸€è‡´å¥½è¯„ï¼Œä»¥è‡³äºåé¢å‡ å¤©ä»–ä»¬éƒ½åœ¨æ‰¾å†°ç²‰ã€‚\nD2ï¼šé›…å®‰â€”â€”æ³¸å®šï¼ˆ133kmï¼‰ ä¸€æ—©èµ·æ¥ï¼Œåƒå®Œæ—©é¥­ï¼Œè¿˜ä¸åˆ°ä¸ƒç‚¹ï¼Œå°å¹¿ä¸œã€éº»å…„å’Œæˆ‘ä¸‰äººå°±å‡ºå‘äº†ã€‚ä¸€è·¯ç»è¿‡äº†æ˜¨å¤©æåˆ°çš„é£ä»™å…³é•‡ï¼Œå†å¾€å‰æ¥åˆ°äº†å¤©å…¨å¿åŸï¼Œå…¥åŸè¡¥ç»™äº†ä¸€äº›ä¸œè¥¿ä¹‹åå°±å¼€å§‹å¸®ä»–ä»¬å¯»æ‰¾æ·å®‰ç‰¹åº—ã€‚åœ°å›¾æ˜¾ç¤ºè½¦åº—ä½äºä¸€ä¸ªèœå¸‚åœºå†…ï¼Œåˆ°äº†åœ°æ–¹å´ä¸è§åº—é“ºï¼Œåè€Œè®©æˆ‘ä»¬å¼€å§‹æ€€ç–‘è‡ªå·±æ˜¯ä¸æ˜¯æ¥é”™åœ°æ–¹äº†ã€‚éº»å…„è·Ÿç€å¯¼èˆªï¼Œå¸¦ç€æˆ‘å’Œå°å¹¿ä¸œä¸€é˜µçè½¬æ— æœï¼Œæˆ‘ä¾¿åœä¸‹æ¥çœ‹åœ°å›¾ï¼Œä»»éº»å…„ç»§ç»­å‰å»ã€‚å¥½åœ¨é«˜å¾·æœ‰è½¦åº—è€æ¿ç”µè¯ï¼Œç»™è€æ¿æ‰“ç”µè¯ç¡®è®¤äº†åº—è¿˜åœ¨å°±æ”¾å¿ƒäº†ï¼Œè¿™æ—¶éº»å…„ä¹Ÿå·²ç»æ‰¾åˆ°äº†è½¦åº—ï¼Œå¼€å§‹è”ç³»æˆ‘ä»¬äº†ã€‚é€šè¿‡å…±äº«ä½ç½®ï¼Œæˆ‘ç»ˆäºåœ¨èœå¸‚åœºæ—è¾¹çš„ä¸€ä¸ªå°å··å­å†…è§åˆ°äº†è½¦åº—ã€‚å’Œè€æ¿èŠäº†èŠæ˜¨å¤©ä¸­åˆå¸®å¤§å§ä¿®è½¦çš„äº‹æƒ…ï¼Œè€æ¿è¿˜ä¸€ä¸ªåŠ²çš„å®å˜±æˆ‘è¦è®©å¤§å§å¥¹ä»¬ç»å¸¸æ£€æŸ¥åè½®çš„ä½ç½®ï¼Œå®‰å…¨ç¬¬ä¸€ï¼Œè®©æˆ‘ä¸€å®šè¦æŠŠè¯å¸¦åˆ°ã€‚åˆå’Œè€æ¿äº¤è°ˆäº†ä¸€ä¼šå„¿ï¼Œæ„Ÿè§‰è€æ¿æ˜¯ä¸ªååˆ†æœ´å®ç®€å•çš„äººã€‚\nå¾…ä»–ä¿©åœ¨è½¦åº—ä¹°å®Œéœ€è¦çš„ä¸œè¥¿ä¹‹åï¼Œæˆ‘ä»¬ä¾¿å†æ¬¡ä¸Šè·¯ã€‚ä¸Šå¡å±…å¤šï¼Œå°å¹¿ä¸œæ…¢æ…¢æ¶ˆå¤±åœ¨äº†å›å¤´çš„è§†é‡ä¸­ã€‚çº¦æ‘¸ä¸€ä¸ªå°æ—¶ï¼Œæˆ‘å’Œéº»å…„å°±è¿½ä¸Šäº†åœ¨ç´«çŸ³å…³å’Œæ‘©æ—…å¤§å“¥ä»¬åˆç…§çš„ä»–ä»¬å››äººï¼Œæˆ‘å’Œéº»å…„ä¹Ÿåº”é‚€åŠ å…¥äº†åˆç…§ã€‚\nåˆå½±ä¹‹åæˆ‘å’Œéº»å…„åŠ å…¥äº†ä»–ä»¬çš„ç¾¤ï¼Œç¾¤å› æ­¤æ”¹åä¸ºâ€œå¤§ä½¬äº”äººè¡Œå’Œä»–ä»¬çš„å°è·Ÿç­â€ğŸ˜„ã€‚ç»§ç»­å¾€å‰ï¼Œæå…„ä¸€éª‘ç»å°˜ï¼Œå¾ˆå¿«å°±æ¶ˆå¤±åœ¨äº†äº‹ä¸šå½“ä¸­ï¼ŒORZâ€¦â€¦11 ç‚¹åŠå·¦å³ï¼Œä¸¤å§å§æ‹¦ä½äº†è·¯ä¸Šå–æ°´æœçš„å°è´§è½¦ï¼Œä¹°äº†ä¸ªè¥¿ç“œï¼Œå«ä¸Šæˆ‘å’Œéº»å…„ä¸€èµ·åƒï¼Œè¿˜æœªåƒå®Œï¼Œéœ²å…„å·²ç»èµ¶äº†ä¸Šæ¥ã€‚æ‘„å½±å¸ˆæ‹ä¸‹äº†åœ¨æ±Ÿè¾¹æ´—å®Œæ‰‹çš„æˆ‘ä»¬ã€‚\nä»Šå¤©çš„åˆé¥­æ˜¯åœ¨æ–°æ²Ÿåƒçš„ï¼Œç”±äºéº»å…„åœ¨ä¸‹åˆä¸€ç‚¹åŠæœ‰é¢è¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å§‹ç•™æ„åˆé€‚çš„åœ°æ–¹ã€‚åœ¨è¿›å±±ä¹‹å‰ï¼Œæˆ‘ä»¬é‡åˆ°ä¸€å¤„æ–½å·¥é˜Ÿçš„å®¿èˆï¼Œæƒ³ç€å‰é¢å¯èƒ½å·²ç»æ²¡æœ‰æˆ¿å­ï¼Œå°±è¿›å»æ±‚åŠ©ã€‚æ¥è§æˆ‘ä»¬çš„æ˜¯ä¸€ä½å¹´è½»çš„å¤§å“¥ï¼Œå‡ å¤©å‰ä¹Ÿæ˜¯åˆšæ¥è¿™é‡Œï¼Œé—²èŠä¸­å¾—çŸ¥ä»–ä¹Ÿæ˜¯éª‘è¡Œçˆ±å¥½è€…ã€‚æˆ‘æ‰“ç®—ç­‰éº»å…„é¢è¯•å®Œä¹‹åä¸€èµ·çˆ¬äºŒéƒå±±ï¼Œæ‰€ä»¥æˆ‘çœ‹ç€ä¸¤ä½å¤§å§ã€æå…„å’Œéœ²å…„è·¯è¿‡ã€‚åé¢ï¼Œå°å¹¿ä¸œä¹Ÿä¸Šæ¥äº†ï¼Œæ­‡äº†ä¸€ä¼šå„¿ï¼Œä»–è¯´ä»–éª‘å¾—æ…¢å°±å…ˆå‡ºå‘äº†ã€‚ç­‰éº»å…„é¢å®Œï¼Œå·²æ˜¯ä¸¤ç‚¹è¿‡äº†ï¼Œæˆ‘ä»¬å¼€å§‹èµ¶è·¯ã€‚æ‰èµ°äº†å‡ å…¬é‡Œï¼Œéº»å…„å°±æ”¶åˆ°äº†é©¬ä¸Šè¦å†æ¬¡é¢è¯•çš„æ¶ˆæ¯ï¼Œæ°å¥½è·¯è¿‡ä¸€å¤„æ²¡äººçš„æ¿æˆ¿ï¼Œéº»å…„å°±åœ¨å¤–é¢æ‰¾äº†ä¸ªè§’è½ç»§ç»­é¢è¯•äº†ã€‚é¢å®Œä¸‰ç‚¹è¿‡ï¼Œçœ‹äº†ä¸‹åœ°å›¾ï¼Œæˆ‘ä»¬å¼€å§‹èµ¶è·¯ï¼Œå¾ˆå¿«å°±è¿½ä¸Šäº†å°å¹¿ä¸œï¼Œä»–å±…ç„¶è¿˜ä¹°äº†è·¯è¾¹é˜¿å§¨å–çš„èœ‚èœœï¼Œè¶³è¶³ä¸¤æ–¤ï¼Œè¿™å…„å¼Ÿå¸¦ç€è¿™ä¸œè¥¿çˆ¬äºŒéƒå±±ä¹Ÿæ˜¯å¤Ÿå¼ºçš„ï¼\näºŒéƒå±±æ˜¯å·è—çº¿ä¸Šçš„ç¬¬ä¸€åº§å¤§å±±ï¼Œæµ·æ‹” 3400 å¤šç±³ï¼Œæˆ‘ä»¬éœ€è¦ç©¿è¿‡çš„äºŒéƒå±±éš§é“æµ·æ‹” 2200ã€‚æˆ‘å’Œéº»å…„åˆ°è¾¾éš§é“å…¥å£æ—¶å·²æ˜¯ä¸‹åˆäº”ç‚¹å››åå¤šï¼Œä¸¤äººéƒ½é¥¿äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åƒäº†ç‚¹ä¸œè¥¿ï¼Œé¡ºå¸¦æ­‡äº†æ­‡ï¼Œå‡†å¤‡å…­ç‚¹è¿‡éš§é“ã€‚éš§é“å‰çš„æ¸©åº¦åä½ï¼Œæˆ‘ä¸å¾—ä¸åŠ äº†ä»¶çš®è‚¤è¡£ä¿æš–ï¼Œå°å¹¿ä¸œä¹Ÿå¥‡è¿¹èˆ¬åœ°çˆ¬äº†ä¸Šæ¥ã€‚ç©¿è¿‡éš§é“åï¼Œæˆ‘ä»¬ä¸‰äººéƒ½å‚»çœ¼äº†ï¼Œå±…ç„¶è¿˜æœ‰ä¸ªä¸€å…¬é‡Œå¤šçš„ä¸Šå¡æ‰åˆ°å­å£ï¼Œå‡ºä¹æ„æ–™ï¼æ²¡åŠæ³•ï¼Œåªèƒ½å’¬å’¬ç‰™ç»§ç»­å¹²ï¼Œç†¬åˆ°å­å£ã€‚å­å£é£æ™¯å¾ˆæ£’ï¼Œä¸€ä¾§å†™ç€â€œåƒé‡Œå·è—çº¿ï¼Œå¤©å ‘äºŒéƒå±±â€ï¼Œå¦ä¸€ä¾§åˆ™æ˜¯å‡¶é™©çš„æ‚¬å´–ã€‚\nå¤©è‰²æ¸æ™šï¼ŒåŒ†åŒ†æ¬£èµå®Œå­å£çš„é£å…‰åï¼Œæˆ‘ä»¬ä¾¿å¼€å§‹ä¸‹å±±ã€‚ä¸€è·¯çˆ½å¡åˆ°äº†æ³¸å®šå¿åŸï¼Œå¤©è¿˜æœªé»‘ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šå…ˆå»æ³¸å®šæ¡¥æ‰“ä¸ªå¡ã€‚æˆ‘å’Œéº»å…„åˆ°äº†æ³¸å®šæ¡¥åï¼Œå¾ˆå¿«å°±çœ‹åˆ°äº†å¤§å§å¥¹ä»¬ï¼ŒåŸæ¥ä»–ä»¬ä¹Ÿåˆšåˆ°ä¸€ä¼šå„¿ï¼Œæ­£ä¹°äº†é—¨ç¥¨å‡†å¤‡åˆ°æ¡¥ä¸Šçœ‹çœ‹ã€‚æˆ‘å»ä¹°ç¥¨æ—¶ï¼Œå”®ç¥¨ç³»ç»Ÿå·²ç»å…³é—­ï¼Œå¥½å¿ƒçš„å”®ç¥¨å‘˜è®©æˆ‘ç”¨ç°é‡‘ä¹°åˆ°äº†ç¥¨ã€‚æ¥åˆ°æ³¸å®šæ¡¥ä¸Šï¼Œè¿™æ˜¯ä¸€åº§é“ç´¢å’Œæœ¨æ¿å»ºé€ çš„æ¡¥ï¼Œèµ°ä¸Šå»ä¾¿å¼€å§‹æ‘‡æ™ƒï¼Œè„šä¸‹åˆæ˜¯æ±¹æ¶Œçš„å¤§æ¸¡æ²³ï¼Œä¸ç”±å¾—æŠŠæ‰‹æœºæ”¾è¿›äº†åŒ…é‡Œï¼Œæ·±æ€•ä¸€ä¸å°å¿ƒæ‰‹æœºæ‰å…¥æ±Ÿä¸­ä¸€å»ä¸è¿”ã€‚æƒ³èµ·å½“å¹´çº¢å†›é£å¤ºæ³¸å®šæ¡¥çš„æ•…äº‹ï¼Œè‚ƒç„¶èµ·æ•¬ã€‚\nD3ï¼šæ³¸å®šâ€”â€”æŠ˜å¤šå¡˜ï¼ˆ63kmï¼‰ ä»ä½å®¿çš„å®¾é¦†å‡ºæ¥ï¼Œåƒè¿‡æ—©é¤ï¼Œæˆ‘ä»¬ä¾¿æœåº·å®šå‡ºå‘äº†ã€‚åˆšå‡ºåŸå°±æ˜¯ä¸€ä¸ªéš§é“ï¼Œéš§é“ç´§é‚»å¤§æ¸¡æ²³ï¼Œä¸å®œä¹…ç•™ï¼Œè¿…é€Ÿé€šè¿‡ã€‚ç©¿è¿‡éš§é“ï¼Œè¿æ¥ä¸€ä¸ªå°ä¸‹å¡ï¼Œç„¶ååˆæ˜¯ä¸€ä¸ªä¸Šå¡ä¸€ä¸ªä¸‹å¡ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œä»Šå¤©çš„è¡Œç¨‹ç»å¤§éƒ¨åˆ†éƒ½æ˜¯ä¸Šå¡ï¼Œä½†è¿™ä¸ªå¡ä¸‹å¾—è®©æˆ‘ä»¬æ€€ç–‘äººç”Ÿã€‚å› ä¸ºæˆ‘ä»¬å‰è¿›çš„æ–¹å‘åˆšå¥½ä¸æ°´æµçš„æ–¹å‘ç›¸åï¼Œç„¶è€Œæˆ‘ä»¬çš„æµ·æ‹”å´åœ¨ä¸æ–­ä¸‹é™ã€‚å½“å¡ä¸‹å®Œä¹‹åï¼Œæˆ‘ä»¬å·®ä¸å¤šä¹Ÿåˆ°äº†ç“¦æ–¯æ²Ÿï¼Œéšåä¾¿å¼€å§‹äº†æ¼«æ¼«çš„ä¸Šå¡ã€‚\næˆ‘å¤§æ¦‚åœ¨åäºŒç‚¹äº”åå·¦å³æŠµè¾¾åº·å®šå¸‚ï¼Œæƒ³å½“å¹´ï¼Œä¸€é¦–ã€Šåº·å®šæƒ…æ­Œã€‹ç«éäº†å¤§æ±Ÿå—åŒ—ã€‚è·‘é©¬æºœæºœåœ°å±±ä¸Šï¼Œä¸€æœµæºœæºœçš„äº‘å“Ÿâ€¦â€¦ä¹‹å‰ä¸€ä½æˆéƒ½çš„éª‘å‹æ¨èæˆ‘åˆ°åº·å®šä¸€å®šè¦å°å°ç”°å‡‰ç²‰ï¼Œæˆ‘ä¾¿æ‰“å¼€é«˜å¾·æœç´¢åœ°ç‚¹ï¼Œå¾—çŸ¥ç”°å‡‰ç²‰å°±åœ¨æ–°å¸‚åè¡—ã€‚æƒ³ç€éº»å…„è¿˜æœªæŠµè¾¾ï¼Œä¾¿ç»™ä»–å‘äº†ä¸ªæ¶ˆæ¯ï¼Œè¯´æˆ‘å»ç”°å‡‰ç²‰ç­‰ä»–ã€‚æ²¡æƒ³åˆ°ä¹‹åå‘ç”Ÿçš„äº‹æƒ…å°±æŠŠæˆ‘æ‰“è„¸äº†ï¼Œæˆ‘å¯¹ç€é«˜å¾·åœ°å›¾ä¸Šç”°å‡‰ç²‰çš„ä½ç½®è½¬äº†ä¸€åœˆåˆä¸€åœˆï¼Œè¿˜åˆ°éš”å£æ–°å¸‚å‰è¡—çœ‹äº†çœ‹ï¼Œå°±æ˜¯æ²¡æ‰¾åˆ°ï¼Œç›´åˆ°å’Œéº»å…„æ±‡åˆæˆ‘éƒ½æ²¡æ‰¾åˆ°ã€‚éº»å…„åˆ°äº†ä¹‹åï¼Œæˆ‘å…ˆæ˜¯ç»™åº—å®¶æ‰“äº†ä¸ªç”µè¯ï¼Œç¡®è®¤äº†åº—è¿˜åœ¨ï¼Œå¾—åˆ°äº†å¤§æ¦‚ä½ç½®ã€‚åˆ°äº†é™„è¿‘ï¼Œéº»å…„é—®äº†ä¸€ä½å¤–å–å°å“¥ï¼Œç«‹é©¬å°±æ‰¾åˆ°äº†åº—çš„ä½ç½®ã€‚æœç„¶ï¼Œå¤–å–å°å“¥æ¯”åœ°å›¾å¥½ç”¨â€¦â€¦ä¸å¹¸çš„æ˜¯ï¼Œç­‰æˆ‘ä»¬åˆ°äº†åº—é‡Œåä¸‹æ‰å‘ç°ï¼Œå‡‰ç²‰å–å®Œäº†ğŸ˜’â€¦â€¦\nè™½ç„¶åº—é‡Œè¿˜æœ‰ä¸å°‘å°åƒï¼Œä½†æƒ³ç€ä¸‹åˆè¿˜æœ‰å‡ åå…¬é‡Œçš„å¡ï¼Œå¾—åƒç‚¹ç®¡é¥±çš„ï¼Œè¦ä¸ç„¶é¡¶ä¸ä½æˆ‘ä»¬å°±å‡ºæ¥æ‰¾é¥­åº—äº†ã€‚åƒå®Œæ­‡æ¯åï¼Œæ—¶é—´å·²åˆ°ä¸‹åˆä¸¤ç‚¹åŠã€‚åˆšä¸€å‡ºå‘ï¼Œå¤©ä¸Šå°±ä¸‹èµ·äº†é›¨ï¼Œè¿˜è¶Šæ¥è¶Šå¤§ã€‚æˆ‘ä»¬åŒ†åŒ†å¿™å¿™å¥—ä¸Šé›¨è¡£é›¨è£¤ï¼Œç©¿ä¸Šé›¨é´ï¼Œç»§ç»­å‰è¿›ã€‚æ¥åˆ°åŸå¤–ï¼Œçˆ¬äº†ä¸€å°æ®µå¡ä¹‹åé›¨å°±åœäº†ã€‚çˆ¬å¡å¾ˆçƒ­ï¼Œé›¨è¡£ä¸‹çš„è¡£æœå‡ ä¹å·²ç»æ¹¿é€ï¼Œåˆ°äº†ä¸€ä¸ªè·¯è¾¹çš„åœè½¦åœºï¼Œä¾¿å°†é›¨è¡£è„±ä¸‹ï¼Œå±±ä¸Šçš„é£å¸¦èµ°äº†å¤šä½™çš„çƒ­é‡ï¼Œå¾ˆæ˜¯å‡‰çˆ½ï¼Œé¡ºä¾¿æ‹äº†ä¸€å¼ ä¸å®Œæ•´çš„åº·å®šåŸçš„ç…§ç‰‡ï¼š\nå››ç‚¹ä¸€åˆ»ï¼Œç»è¿‡å¤§æ¡¥æ¹¾ï¼Œç»§ç»­å‘å‰ï¼Œæ¥åˆ°äº†ä¸€å¤„è§‚æ™¯å¹³å°ï¼Œçœ‹åˆ°å‡ ä¸ªå¤§å­—â€”â€”â€œæƒ…æ­Œæ•…é‡Œæ¬¢è¿ä½ â€ã€‚\nåœ¨æ­¤å°æ­‡ä¸€ä¼šå„¿åï¼Œç»§ç»­å¾€æŠ˜å¤šå¡˜å‰è¿›ã€‚äº”ç‚¹è¿‡ï¼Œç»ˆäºéª‘åˆ°äº†æŠ˜å¤šå¡˜æ‘ï¼Œè¿œè¿œåœ°å°±çœ‹åˆ°å¤§ä½¬åœ¨ä¸€å®¶å†…æ±Ÿé¥­åº—å‰é¢å‘æˆ‘æŒ¥æ‰‹äº†ã€‚è¿‡å»æ‰å‘ç°ï¼Œå¤§ä½¬å·²ç»é—®äº†ä¸€éå‘¨å›´ä½å®¿çš„ä»·æ ¼ï¼Œå†…æ±Ÿçš„è€ä¹¡çœ‹æˆ‘ä»¬éª‘è½¦ç´¯ï¼Œä¹Ÿç»™äº†æˆ‘ä»¬å¾ˆå¤§çš„ä¼˜æƒ ï¼Œäºæ˜¯æˆ‘ä»¬å°±å†³å®šåœ¨è¿™é‡Œä½ä¸‹ã€‚ç”±äºé¥­åº—çš„ä¸‰äººé—´æ²¡æœ‰æ´—æµ´çš„åœ°æ–¹ï¼Œæ‰€ä»¥æˆ‘å’Œå…ˆåˆ°çš„éº»å…„ä¸åšé“åœ°æŠŠå°å¹¿ä¸œæŠ›å¼ƒäº†ï¼Œå°å¹¿ä¸œæœ€ååœ¨éš”å£é’å¹´æ—…èˆå…¥ä½ã€‚å°å¹¿ä¸œåˆ°çš„æ—¶å€™å·²ç»æ˜¯å…­ç‚¹åŠä»¥åäº†ï¼Œé‚£æ—¶æˆ‘æ­£åœ¨æ¥¼é¡¶æ´—è¡£æœï¼Œæ¥¼é¡¶çš„é£å¾ˆå¤§ï¼Œå±±ä¸Šæµä¸‹æ¥çš„æ°´å¾ˆæ˜¯å†°å‡‰ã€‚å½“æ™šï¼Œæˆ‘ä»¬ä¸ƒä¸ªäººéƒ½åœ¨å†…æ±Ÿé¥­åº—åƒé¥­ï¼Œè¿™ç«Ÿç„¶æˆäº†æˆ‘ä»¬ä¸ƒä¸ªäººæœ€åä¸€æ¬¡ä¸€èµ·åƒé¥­ï¼Œå› ä¸ºç¬¬äºŒå¤©å°å¹¿ä¸œåªåˆ°äº†æ–°éƒ½æ¡¥ï¼Œè€Œæˆ‘ä»¬å…­ä¸ªäººç¿»è¿‡äº†é«˜å°”å¯ºå±±åˆ°äº†é›…æ±Ÿã€‚\né¥­åå¾—çŸ¥ï¼Œé¥­åº—æ—©ä¸Šä¸æä¾›æ—©é¤ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æƒ³åŠæ³•ã€‚å‡ºå»æ‰“å¬äº†ä¸€åœˆï¼Œå‘ç°å‘¨å›´çš„é¥­åº—éƒ½æ²¡æœ‰æ—©é¤ï¼Œåªæœ‰é’æ—…åˆ°ä¸ƒç‚¹åæ‰æä¾›é¢æ¡ã€‚æƒ³ç€ä¸ƒç‚¹å¤ªæ™šäº†ï¼Œè·Ÿè€æ¿å•†é‡ï¼Œè€æ¿ç»™æˆ‘ä»¬å…­äººä¸€äººç…®äº†ä¸¤ä¸ªåœŸé¸¡è›‹ï¼Œæ—©ä¸Šæˆ‘ä»¬è‡ªå·±ç”¨æ°´å£¶çƒ­ã€‚äºæ˜¯ï¼Œæˆ‘åˆå’Œéº»å…„åˆ°è¶…å¸‚ï¼Œä¸€äººä¹°äº†é€šæ³¡é¢ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘å¯èƒ½æœ‰ä¸€å¹´æ²¡åƒè¿‡æ³¡é¢äº†ã€‚\nå‡†å¤‡å¥½ç¬¬äºŒå¤©æ—©ä¸Šçš„ä¸œè¥¿ä¹‹åï¼Œå°±ç¡äº†ã€‚\nD4ï¼šæŠ˜å¤šå¡˜â€”â€”é›…æ±Ÿï¼ˆ126kmï¼‰ ","href":"/itinerary/riding_on_sichuan-tibet_highway/","title":"éª‘è¡Œå·è—çº¿"},{"content":"æˆ‘ä»¬åœ¨å·¥ä½œä¸­ç»å¸¸å¬äººæèµ·çº¿ç¨‹å®‰å…¨ï¼Œä½†è¦æ˜¯è¢«é—®åˆ°ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬å¯èƒ½å°±ä¼šæŒ æŒ è„‘è¢‹äº†ã€‚å› ä¸ºçº¿ç¨‹å®‰å…¨å¹¶æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„å®šä¹‰ã€‚Java Concurrency in Practice è¿™æœ¬ Java å¹¶å‘å®å…¸æ˜¯è¿™æ ·è§£é‡Šçº¿ç¨‹å®‰å…¨çš„ï¼š\n å½“å¤šä¸ªçº¿ç¨‹è®¿é—®æŸä¸ªç±»æ—¶ï¼Œè¿™ä¸ªç±»å§‹ç»ˆéƒ½èƒ½è¡¨ç°å‡ºæ­£ç¡®çš„è¡Œä¸ºï¼Œé‚£ä¹ˆå°±ç§°è¿™ä¸ªç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚çº¿ç¨‹å®‰å…¨æ€§å¯¹å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„æ“ä½œæå‡ºäº†è¦æ±‚ï¼šå¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„æ“ä½œæ— è®ºé‡‡ç”¨ä½•ç§æ‰§è¡Œæ—¶åºæˆ–äº¤æ›¿æ–¹å¼ï¼Œéƒ½è¦ä¿è¯ä¸å˜æ€§æ¡ä»¶ä¸è¢«ç ´åã€‚\nè‹¥ä¸€ä¸ªç±»æ—¢ä¸åŒ…å«ä»»ä½•åŸŸï¼Œä¹Ÿä¸åŒ…å«ä»»ä½•å¯¹å…¶å®ƒç±»ä¸­åŸŸçš„å¼•ç”¨ï¼Œåˆ™ç§°è¿™ä¸ªç±»æ˜¯æ— çŠ¶æ€çš„ã€‚æ— çŠ¶æ€çš„å¯¹è±¡ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\n æœ¬æ–‡çš„ç»å¤§éƒ¨åˆ†å†…å®¹ä¹Ÿæ¥è‡ªè¿™æœ¬ä¹¦ã€‚\nçº¿ç¨‹å®‰å…¨é—®é¢˜ å¦‚æœçº¿ç¨‹ä¸å®‰å…¨ï¼Œä¼šå‡ºç°å“ªäº›é—®é¢˜å‘¢ï¼Ÿå¸¸è§çš„é—®é¢˜æœ‰ä¸‰ç±»ï¼š\n è¿è¡Œç»“æœé”™è¯¯ å¯¹è±¡é€ƒé€¸ æ´»è·ƒæ€§é—®é¢˜  è¿è¡Œç»“æœé”™è¯¯ æœ€å¸¸è§çº¿ç¨‹å®‰å…¨é—®é¢˜å¯èƒ½å°±æ˜¯ è¿è¡Œç»“æœé”™è¯¯ äº†ã€‚æ¯”å¦‚ï¼š\npublic class UnsafeCounter { private static volatile int count = 0; public static void main(String[] args) throws InterruptedException { Runnable r = () -\u0026gt; { for (int i = 0; i \u0026lt; 1000; i++) { count++; } }; Thread t1 = new Thread(r); t1.start(); Thread t2 = new Thread(r); t2.start(); // ç­‰å¾…ä¸¤ä¸ªçº¿ç¨‹è¿è¡Œç»“æŸ  t1.join(); t2.join(); System.out.println(\u0026#34;count = \u0026#34; + count); } } è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªé™æ€å˜é‡ countï¼Œç„¶åå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¯¹è¿™ä¸ªå˜é‡æ‰§è¡Œ 1000 æ¬¡é€’å¢æ“ä½œã€‚ç†è®ºä¸Šï¼Œæœ€ç»ˆåº”è¯¥å¾—åˆ°çš„ count å€¼ä¸º 2000ï¼Œä½†å®é™…ä¸Šç»“æœå¯èƒ½æ˜¯ 1662ï¼Œä¹Ÿå¯èƒ½æ˜¯ 1713ï¼Œæ¯æ¬¡è¿è¡Œçš„ç»“æœéƒ½è¿˜ä¸ä¸€æ ·ã€‚é—®é¢˜çš„åŸå› åœ¨äºï¼šcount++ ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå®ƒçš„æ‰§è¡Œæ­¥éª¤ä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼š\n è¯»å– count çš„å€¼ å°† count çš„å€¼åŠ ä¸€ ä¿å­˜ count çš„å€¼  ç”±äº CPU æ˜¯ä»¥æ—¶é—´ç‰‡ä¸ºå•ä½è¿›è¡Œçº¿ç¨‹è°ƒåº¦çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥åœ¨æŸä¸ªæ—¶é—´ç‰‡å†…ä½¿ç”¨ CPUã€‚å½“å‰æ—¶é—´ç‰‡è¢«ç”¨å®Œåï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šæš‚åœå½“å‰çº¿ç¨‹ï¼Œç„¶åæŠŠ CPU åˆ†é…ç»™å…¶å®ƒçº¿ç¨‹ï¼Œå½“å…¶å®ƒçº¿ç¨‹ç”¨å®Œä¹‹åï¼Œè¢«æš‚åœçš„çº¿ç¨‹åˆä¼šå¾—åˆ°ä½¿ç”¨ CPU çš„æœºä¼šã€‚åœ¨ count++ çš„ä¸‰ä¸ªæ­¥éª¤ä¸­ï¼Œæ¯ä¸€æ­¥æ“ä½œéƒ½æœ‰å¯èƒ½è¢«æ‰“æ–­ã€‚è¿™å°±æ˜¯ åŸå­æ€§é—®é¢˜ã€‚è™½ç„¶å˜é‡ count è¢« volatile ä¿®é¥°ï¼Œä½†ç”±äº volatile åªèƒ½ä¿è¯å¯è§æ€§ï¼Œå¹¶ä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œæ‰€ä»¥è¿è¡Œç»“æœè¿˜æ˜¯æœ‰é—®é¢˜çš„ã€‚\nå¯¹è±¡é€ƒé€¸ å¯¹è±¡å‘å¸ƒ â€œå‘å¸ƒâ€ä¸€ä¸ªå¯¹è±¡æ„å‘³ç€è¯¥å¯¹è±¡èƒ½å¤Ÿè¢«å½“å‰ä½œç”¨åŸŸä»¥å¤–çš„ä»£ç ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼šå°†ä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åˆ°å…¶å®ƒä»£ç å¯ä»¥è®¿é—®çš„åœ°æ–¹ï¼Œæˆ–è€…åœ¨æŸä¸€ä¸ªéç§æœ‰çš„æ–¹æ³•ä¸­è¿”å›è¯¥å¼•ç”¨ï¼Œæˆ–è€…å°†è¯¥å¼•ç”¨ä¼ é€’åˆ°å…¶å®ƒç±»çš„æ–¹æ³•ä¸­ã€‚\nå‘å¸ƒå¯¹è±¡çš„æœ€ç®€å•æ–¹æ³•å°±æ˜¯å°†å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åˆ°ä¸€ä¸ªå…¬æœ‰çš„é™æ€å˜é‡ä¸­ã€‚å½“å‘å¸ƒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè¯¥å¯¹è±¡çš„éç§æœ‰åŸŸä¸­å¼•ç”¨çš„æ‰€æœ‰å¯¹è±¡ä¹Ÿä¼šè¢«å‘å¸ƒã€‚è¿˜æœ‰ä¸€ç§å‘å¸ƒå¯¹è±¡æˆ–å…¶å†…éƒ¨çŠ¶æ€çš„æ–¹æ³•å°±æ˜¯ï¼šå‘å¸ƒä¸€ä¸ªå†…éƒ¨ç±»çš„å®ä¾‹ã€‚\nå¯¹è±¡é€ƒé€¸ â€œé€ƒé€¸â€æ˜¯æŒ‡æŸä¸ªä¸åº”è¯¥è¢«å‘å¸ƒçš„å¯¹è±¡è¢«å‘å¸ƒå‡ºå»äº†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\npublic class WrongInit { private Map\u0026lt;String, String\u0026gt; colorMap; public WrongInit() { new Thread(() -\u0026gt; { colorMap = new HashMap\u0026lt;\u0026gt;(); colorMap.put(\u0026#34;RED\u0026#34;, \u0026#34;çº¢\u0026#34;); colorMap.put(\u0026#34;ORANGE\u0026#34;, \u0026#34;æ©™\u0026#34;); colorMap.put(\u0026#34;YELLOW\u0026#34;, \u0026#34;é»„\u0026#34;); // ...  }).start(); } public Map\u0026lt;String, String\u0026gt; getColorMap() { return colorMap; } public static void main(String[] args) { WrongInit wrongInit = new WrongInit(); System.out.println(wrongInit.getColorMap().get(\u0026#34;RED\u0026#34;)); } } è¿™æ®µä»£ç å¹¶ä¸ä¼šè¾“å‡º çº¢ï¼Œè€Œæ˜¯ä¼šæŠ›å‡º NullPointerExceptionã€‚è¿™æ˜¯å› ä¸º colorMap çš„åˆå§‹åŒ–æ”¾åœ¨äº†æ„é€ å‡½æ•°å†…çš„æ–°çº¿ç¨‹ä¸­ï¼Œè€Œçº¿ç¨‹çš„å¯åŠ¨æ˜¯éœ€è¦ä¸€å®šçš„æ—¶é—´çš„ï¼Œä½†æ˜¯ä¸»å‡½æ•°å¹¶æ²¡æœ‰ç­‰å¾…å°±ç›´æ¥è·å–æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ colorMap å¯èƒ½å¹¶æ²¡æœ‰åˆå§‹åŒ–å¥½ã€‚\næ­£å¸¸æƒ…å†µä¸‹ï¼ŒcolorMap åº”è¯¥åœ¨æ„é€ å‡½æ•°å†…è¢«åˆå§‹åŒ–å¥½äº†æ‰å¯è®©å¤–ç•Œè®¿é—®ï¼Œä»¥ä¸Šä»£ç å°±å‡ºç°äº† colorMap çš„é€ƒé€¸ã€‚å¯¹è±¡é€ƒé€¸ä¼šå¸¦æ¥é—®é¢˜ï¼Œå› ä¸ºï¼šåªæœ‰å½“å¯¹è±¡çš„æ„é€ å‡½æ•°è¿”å›æ—¶ï¼Œå¯¹è±¡çš„çŠ¶æ€æ‰æ˜¯å¯é¢„æµ‹çš„ï¼ˆpredictableï¼‰ã€ä¸€è‡´çš„ï¼ˆconsistentï¼‰ã€‚åœ¨é”™è¯¯çš„æ—¶é—´æˆ–åœ°ç‚¹å‘å¸ƒæˆ–åˆå§‹åŒ–å¯èƒ½å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚\næ´»è·ƒæ€§é—®é¢˜ åœ¨çº¿ç¨‹çš„å®‰å…¨æ€§å’Œæ´»è·ƒæ€§ä¹‹é—´é€šå¸¸å­˜åœ¨ç€æŸç§å¹³è¡¡ã€‚æˆ‘ä»¬ä½¿ç”¨åŠ é”æœºåˆ¶æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œä½†å¦‚æœè¿‡åº¦çš„ä½¿ç”¨åŠ é”ï¼Œåˆ™å¯èƒ½å¯¼è‡´ é¡ºåºæ­»é”ï¼ˆLock-ordering Deadlockï¼‰ã€‚åŒæ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹æ± å’Œä¿¡å·é‡æ¥é™åˆ¶å¯¹èµ„æºçš„ä½¿ç”¨ï¼Œä½†è¿™äº›é™åˆ¶è¡Œä¸ºå¯èƒ½å¯¼è‡´ èµ„æºæ­»é”ï¼ˆResource Deadlockï¼‰ã€‚Java åº”ç”¨ç¨‹åºæ— æ³•ä»æ­»é”ä¸­æ¢å¤è¿‡æ¥ï¼ˆæ¢å¤åº”ç”¨ç¨‹åºçš„å”¯ä¸€æ–¹å¼å°±æ˜¯ç»ˆæ­¢å¹¶é‡å¯å®ƒï¼Œå¹¶å¸Œæœ›å®ƒä¸è¦å†å‘ç”Ÿï¼‰ï¼Œå› æ­¤åœ¨è®¾è®¡æ—¶ä¸€å®šè¦æ’é™¤é‚£äº›å¯èƒ½å¯¼è‡´æ­»é”å‡ºç°çš„æ¡ä»¶ã€‚\næ´»è·ƒæ€§é—®é¢˜ä¸å‰é¢æåˆ°çš„è¿è¡Œç»“æœé”™è¯¯æœ‰ç€å¾ˆå¤§ä¸åŒï¼Œå½“å‡ºç°æ´»è·ƒæ€§é—®é¢˜æ—¶ï¼Œç¨‹åºå¯èƒ½å§‹ç»ˆéƒ½å¾—ä¸åˆ°ç»“æœã€‚å¸¸è§çš„æ´»è·ƒæ€§é—®é¢˜æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ï¼šæ­»é”ã€é¥¥é¥¿å’Œæ´»é”ã€‚\næ­»é” æ­»é”ï¼ˆDeadlockï¼‰ æ˜¯æŒ‡ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´ç›¸äº’ç­‰å¾…å¯¹æ–¹å æœ‰çš„èµ„æºï¼ˆé”ï¼‰ï¼Œä½†åŒæ—¶åˆäº’ä¸ç›¸è®©ï¼Œéƒ½æƒ³è‡ªå·±å…ˆæ‰§è¡Œã€‚\né¡ºåºæ­»é” ä»¥ä¸‹ä»£ç å¯èƒ½å¯¼è‡´é¡ºåºæ­»é”ï¼š\npublic class LeftRightDeadLock { private final Object left = new Object(); private final Object right = new Object(); public void leftRight() { synchronized (left) { synchronized (right) { // doSomething();  } } } public void rightLeft() { synchronized (right) { synchronized (left) { // doSomethingElse();  } } } public static void main(String[] args) { LeftRightDeadLock lrdl = new LeftRightDeadLock(); new Thread(lrdl::leftRight).start(); new Thread(lrdl::rightLeft).start(); } } å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šçº¿ç¨‹ A è°ƒç”¨çš„æ–¹æ³•ä¼šå°è¯•å…ˆè·å¾— left çš„é”å†å°è¯•è·å¾— right çš„é”ï¼Œè€Œçº¿ç¨‹ B åˆšå¥½ç›¸åï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªçº¿ç¨‹çš„æ“ä½œæ˜¯äº¤æ›¿æ‰§è¡Œï¼Œé‚£ä¹ˆå®ƒä»¬å°±ä¼šå‘ç”Ÿæ­»é”ã€‚\nä»¥ä¸Šå‘ç”Ÿæ­»é”çš„åŸå› æ˜¯ï¼šä¸¤ä¸ªçº¿ç¨‹è¯•å›¾ä»¥ä¸åŒçš„é¡ºåºè·å¾—ç›¸åŒçš„é”ã€‚å¦‚æœå½¼æ­¤æŒ‰ç…§ç›¸åŒçš„é¡ºåºæ¥è¯·æ±‚é”ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‡ºç°å¾ªç¯çš„åŠ é”ä¾èµ–æ€§ï¼Œä¹Ÿå°±ä¸ä¼šäº§ç”Ÿæ­»é”ã€‚æ¢å¥è¯è¯´ï¼šå¦‚æœæ¯ä¸ªéœ€è¦é” L å’Œ M çš„çº¿ç¨‹éƒ½ä»¥ ç›¸åŒçš„é¡ºåº æ¥è·å–é” L å’Œ M ï¼Œå°±ä¸ä¼šå‘ç”Ÿæ­»é”ã€‚\nèµ„æºæ­»é” æ­£å¦‚å½“å¤šä¸ªçº¿ç¨‹ç›¸äº’æŒæœ‰å½¼æ­¤æ­£åœ¨ç­‰å¾…çš„é”è€Œåˆä¸é‡Šæ”¾è‡ªå·±æŒæœ‰çš„é”æ—¶ä¼šå‘ç”Ÿæ­»é”ä¸€æ ·ï¼Œå½“å®ƒä»¬å‘ç”Ÿåœ¨ç›¸åŒçš„èµ„æºé›†åˆä¸Šç­‰å¾…æ—¶ï¼Œä¹Ÿä¼šå‘ç”Ÿæ­»é”ã€‚\nå‡è®¾æœ‰ä¸¤ä¸ªèµ„æºæ±  L å’Œ M ï¼Œè‹¥åœ¨çº¿ç¨‹ A æŒæœ‰ L ä¸­çš„ S å¹¶ç­‰å¾… M ä¸­çš„ T çš„åŒæ—¶ï¼Œçº¿ç¨‹ B æŒæœ‰ M ä¸­çš„ T å¹¶ç­‰å¾… L ä¸­çš„ S ï¼Œåˆ™ä¼šå‡ºç°æ­»é”ã€‚è¿™æœ‰ç‚¹ç±»ä¼¼äºé¡ºåºæ­»é”ä¸­æåˆ°çš„äº¤æ›¿æ‰§è¡Œå¯¼è‡´æ­»é”å‡ºç°çš„æƒ…å†µã€‚\nå¦ä¸€ç§åŸºäºèµ„æºçš„æ­»é”å½¢å¼å°±æ˜¯çº¿ç¨‹é¥¥é¥¿æ­»é”ï¼ˆThread-Starvation Deadlockï¼‰ï¼šåªè¦èµ„æºæ± ä¸­çš„ä»»åŠ¡éœ€è¦æ— é™ç­‰å¾…ä¸€äº›å¿…é¡»ç”±æ± ä¸­çš„å…¶å®ƒä»»åŠ¡æ‰èƒ½æä¾›çš„èµ„æºæˆ–æ¡ä»¶ï¼ˆä¾‹å¦‚ä¸€ä¸ªä»»åŠ¡ç­‰å¾…å¦ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼‰ï¼Œé‚£ä¹ˆé™¤éèµ„æºæ± è¶³å¤Ÿå¤§ï¼Œå¦åˆ™å°†å‘ç”Ÿçº¿ç¨‹é¥¥é¥¿æ­»é”ã€‚\nä¾‹å¦‚ï¼šåœ¨å•çº¿ç¨‹çš„ Executor ä¸­ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡å°†å¦ä¸€ä¸ªä»»åŠ¡æäº¤åˆ°åŒä¸€ä¸ª Executorï¼Œå¹¶ä¸”ç­‰å¾…è¿™ä¸ªè¢«æäº¤çš„ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œé‚£ä¹ˆé€šå¸¸ä¼šå¼•å‘æ­»é”ã€‚å› ä¸ºç¬¬äºŒä¸ªä»»åŠ¡å°†åœç•™åœ¨å·¥ä½œé˜Ÿåˆ—ä¸­ï¼Œå¹¶ç­‰å¾…ç¬¬ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œè€Œç¬¬ä¸€ä¸ªä»»åŠ¡åˆæ— æ³•å®Œæˆï¼Œå› ä¸ºå®ƒåœ¨ç­‰å¾…ç¬¬äºŒä¸ªä»»åŠ¡çš„å®Œæˆã€‚è¿™å°±æ˜¯çº¿ç¨‹é¥¥é¥¿æ­»é”ã€‚\né¥¥é¥¿ é¥¥é¥¿ï¼ˆStarvationï¼‰ æ˜¯æŒ‡çº¿ç¨‹ç”±äºæ— æ³•è®¿é—®å®ƒæ‰€éœ€è¦çš„èµ„æºè€Œä¸èƒ½ç»§ç»­æ‰§è¡Œã€‚æ¯”å¦‚ï¼ŒJava åº”ç”¨ç¨‹åºå¯¹çº¿ç¨‹çš„ä¼˜å…ˆçº§è®¾ç½®ä¸å½“ï¼Œå¯¼è‡´éƒ¨åˆ†çº¿ç¨‹æ— æ³•è·å– CPU æ—¶é—´ç‰‡ã€‚Java ä¸­çš„çº¿ç¨‹æ˜¯æœ‰ä¼˜å…ˆçº§çš„ã€‚Java ä¸­çº¿ç¨‹ä¼˜å…ˆçº§åˆ†ä¸º 1 åˆ° 10ï¼Œ1 æœ€ä½ï¼Œ10 æœ€é«˜ï¼Œä¼˜å…ˆçº§è¶Šé«˜çš„çº¿ç¨‹è·å¾— CPU æ—¶é—´ç‰‡çš„æ¦‚ç‡è¶Šå¤§ã€‚å¦‚æœæˆ‘ä»¬æŠŠæŸä¸ªçº¿ç¨‹çš„ä¼˜å…ˆçº§è®¾ç½®ä¸º 1ï¼Œè¿™æ˜¯æœ€ä½çš„ä¼˜å…ˆçº§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªçº¿ç¨‹å°±æœ‰å¯èƒ½å§‹ç»ˆåˆ†é…ä¸åˆ°Â CPUÂ èµ„æºï¼Œè€Œå¯¼è‡´é•¿æ—¶é—´æ— æ³•è¿è¡Œã€‚\næ´»é” æ´»é”ï¼ˆLivelockï¼‰ ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œä½†ä¹Ÿä¸èƒ½ç»§ç»­æ‰§è¡Œï¼Œå› ä¸ºçº¿ç¨‹å°†ä¸æ–­é‡å¤æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œè€Œä¸”æ€»ä¼šå¤±è´¥ã€‚è¿™å°±åƒä¸¤ä¸ªè¿‡äºç¤¼è²Œçš„äººåœ¨åŠè·¯ä¸Šé¢å¯¹é¢åœ°ç›¸é‡ï¼šä»–ä»¬å½¼æ­¤éƒ½ç»™å¯¹æ–¹è®©è·¯ï¼Œç„¶ååˆåœ¨å¦ä¸€æ¡è·¯ä¸Šç›¸é‡äº†ï¼Œå¹¶ä¸”ä»–ä»¬å°±è¿™æ ·åå¤åœ°é¿è®©ä¸‹å»ã€‚å¯ä»¥åœ¨é‡è¯•æœºåˆ¶ä¸­å¼•å…¥éšæœºæ€§æ¥è§£å†³æ´»è·ƒæ€§é—®é¢˜ï¼Œè¿™æ ·èƒ½å‡å°‘å†²çªã€‚\nçº¿ç¨‹å®‰å…¨é—®é¢˜å‡ºç°çš„åœºæ™¯ çº¿ç¨‹å®‰å…¨é—®é¢˜æœ€å¸¸å‡ºç°åœ¨å¯¹å…±äº«å˜é‡æˆ–å…±äº«èµ„æºçš„è®¿é—®ä¸­ã€‚å‰é¢æåˆ°çš„è®¡æ•°é—®é¢˜å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ã€‚\næœ‰æ—¶ï¼Œæˆ‘ä»¬çš„æ“ä½œæ˜¯ä¾èµ–æ—¶åºçš„ï¼Œè€Œå¹¶å‘åœºæ™¯ä¸‹å¯èƒ½å‡ºç°æ‰§è¡Œé¡ºåºä¸æˆ‘ä»¬é¢„æƒ³ä¸ä¸€è‡´çš„æƒ…å†µã€‚æ¯”å¦‚ï¼š\nif (x == 1) { x = 3 * x; } è¿™æ®µä»£ç æ¶‰åŠå…ˆæ£€æŸ¥åè®¡ç®—çš„ç»„åˆæ“ä½œã€‚ä½†è¿™ä¸ªç»„åˆæ“ä½œå¹¶ä¸æ˜¯åŸå­æ“ä½œï¼Œä¸­é—´å¯èƒ½è¢«æ‰“æ–­ã€‚\næˆ‘ä»¬ä½¿ç”¨å…¶ä»–ç±»æ—¶ï¼Œå¦‚æœå¯¹æ–¹æ²¡æœ‰å£°æ˜è‡ªå·±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œå¹¶å‘æ“ä½œï¼Œå°±æœ‰å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚\nå‚è€ƒèµ„æ–™  Brian Goetz, Tim Peierls, Joshua Bloch, Joseph Bowbeer, David Holmes, and Doug Lea. Java Concurrency in Practice. Addison-Wesley Professional, 2006.  ","href":"/java/concurrency/thread_safety/","title":"çº¿ç¨‹å®‰å…¨"},{"content":"","href":"/categories/%E5%B9%B6%E5%8F%91/","title":"å¹¶å‘"},{"content":"","href":"/tags/%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85/","title":"ç”Ÿäº§è€…æ¶ˆè´¹è€…"},{"content":"ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼ï¼ˆProducer/Consumer Patternï¼‰æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„ç¨‹åºè®¾è®¡æ¨¡å¼ï¼Œå¹¿æ³›ç”¨äºæ¶ˆæ¯é˜Ÿåˆ—ã€è§£è€¦ç­‰åœºæ™¯ä¸­ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æœ‰ä¸€ä¸ªå…±äº«çš„æ•°æ®ç»“æ„è¿æ¥ç€ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…è´Ÿè´£ç”Ÿäº§æ•°æ®å¹¶å°†æ•°æ®æ·»åŠ åˆ°å…±äº«æ•°æ®ç»“æ„ä¸­ï¼Œè€Œæ¶ˆè´¹è€…è´Ÿè´£ä»å…±äº«æ•°æ®ç»“æ„ä¸­å–èµ°æ•°æ®å¹¶æ¶ˆè´¹ã€‚å¦‚æœç”Ÿäº§è€…çš„ç”Ÿäº§é€Ÿåº¦ç‰¹åˆ«å¿«ï¼Œè€Œæ¶ˆè´¹è€…çš„æ¶ˆè´¹é€Ÿåº¦åˆç‰¹åˆ«æ…¢ï¼Œå°±ä¼šå‡ºç°â€œäº§èƒ½è¿‡å‰©â€çš„æƒ…å†µï¼Œåä¹‹åˆ™æ˜¯â€œäº§èƒ½ä¸è¶³â€ã€‚\nä¸Šé¢æåˆ°çš„å…±äº«æ•°æ®ç»“æ„å…¶å®æ‰®æ¼”äº†ç¼“å†²åŒºçš„è§’è‰²ï¼Œå®ƒå¹³è¡¡äº†ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ä¹‹é—´çš„èƒ½åŠ›ã€‚å½“ç¼“å†²åŒºæ»¡æ—¶ï¼Œç”Ÿäº§è€…è¢«é˜»å¡ï¼Œä½†å½“æ¶ˆè´¹è€…æ‹¿èµ°æ•°æ®ç©ºå‡ºä½ç½®ä¹‹åï¼Œæ¶ˆè´¹è€…å°±ä¼šé€šçŸ¥ç”Ÿäº§è€…è¿›è¡Œç”Ÿäº§ï¼›è€Œå½“ç¼“å†²åŒºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…è¢«é˜»å¡ï¼Œç­‰å¾…æ•°æ®åˆ°æ¥ï¼Œåœ¨ç”Ÿäº§è€…å°†ç”Ÿäº§çš„æ•°æ®æ”¾åˆ°å…±äº«æ•°æ®ç»“æ„ä¹‹åï¼Œå°±ä¼šé€šçŸ¥æ¶ˆè´¹è€…å»æ¶ˆè´¹ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå…±äº«æ•°æ®ç»“æ„çš„ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå› æ­¤ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜åˆç§°æœ‰ç•Œç¼“å†²åŒºé—®é¢˜ï¼ˆbounded-buffer problem)ï¼‰ã€‚\nåœ¨ Java ä¸­ï¼Œå®ç°ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼çš„æ–¹æ³•åˆå¾ˆå¤šç§ï¼Œå¸¸è§çš„æœ‰åŸºäºé˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰çš„ã€ä¹Ÿæœ‰åŸºäº Condition çš„ï¼Œè¿˜æœ‰åŸºäº wait/notify çš„ã€‚\nä½¿ç”¨é˜»å¡é˜Ÿåˆ—å®ç°ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼ è¿™æ—¶ï¼Œé˜»å¡é˜Ÿåˆ—æ‰¿æ‹…çš„å°±æ˜¯å…±äº«æ•°æ®ç»“æ„çš„åŠŸèƒ½ã€‚\npublic class BlockingQueueProducerConsumer { public static void main(String[] args) { BlockingQueue\u0026lt;Object\u0026gt; buffer = new ArrayBlockingQueue\u0026lt;\u0026gt;(10); Runnable producer = () -\u0026gt; { while (true) { try { buffer.put(new Object()); } catch (InterruptedException e) { e.printStackTrace(); } } }; Runnable consumer = () -\u0026gt; { while (true) { try { buffer.take(); } catch (InterruptedException e) { e.printStackTrace(); } } }; new Thread(producer).start(); new Thread(producer).start(); new Thread(consumer).start(); new Thread(consumer).start(); } } ä¸Šé¢è¿™æ®µä»£ç å…ˆæ˜¯åˆ›å»ºäº†ä¸€ä¸ªç”¨äºç”Ÿäº§è€…/æ¶ˆè´¹è€…äº¤æµçš„ç¼“å†²åŒºï¼Œéšååˆ†åˆ«å¼€å¯ä¸¤ä¸ªç”Ÿäº§è€…çº¿ç¨‹å’Œä¸¤ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ï¼Œç”Ÿäº§è€…ä¸æ–­å‘ buffer æ·»åŠ æ•°æ®ï¼Œè€Œæ¶ˆè´¹è€…ä¸æ–­ä» buffer æ¶ˆè´¹æ•°æ®ã€‚è™½ç„¶è¿™æ®µä»£ç çœ‹ä¸Šå»ä¸æ¶‰åŠä»»ä½•é˜»å¡ç­‰å¾…ä¸å”¤é†’ï¼Œå› ä¸ºé˜»å¡ç­‰å¾…ä¸å”¤é†’æ“ä½œæ˜¯ ArrayBlockingQueue å†…éƒ¨å®ç°çš„ã€‚\nä½¿ç”¨ Condition å®ç°ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼ ä»¥ä¸‹ä»£ç åˆ©ç”¨ Condition å®ç°ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼ï¼Œå…¶èƒŒåçš„æ€æƒ³ä¸ BlockingQueue éå¸¸ç›¸ä¼¼ï¼š\npublic class ConditionProducerConsumer { static class MyBlockingQueue { private Queue buffer; private int max = 16; private ReentrantLock lock = new ReentrantLock(); private Condition notEmpty = lock.newCondition(); // é˜Ÿåˆ—æ²¡ç©º  private Condition notFull = lock.newCondition(); // é˜Ÿåˆ—æ²¡æ»¡  public MyBlockingQueue(int size) { this.buffer = new LinkedList(); this.max = size; } public void put(Object o) throws InterruptedException { lock.lock(); try { while (buffer.size() == max) { notFull.await(); // è‡ªåŠ¨é‡Šæ”¾lockå¹¶ç­‰å¾…ç©ºé—´  } buffer.add(o); notEmpty.signalAll(); // å”¤é†’æ¶ˆè´¹è€…  } finally { lock.unlock(); } } public Object take() throws InterruptedException { lock.lock(); try { while (buffer.size() == 0) { notEmpty.await(); // è‡ªåŠ¨é‡Šæ”¾lockå¹¶ç­‰å¾…æ•°æ®  } Object item = buffer.remove(); notFull.signalAll(); // å”¤é†’ç”Ÿäº§è€…  return item; } finally { lock.unlock(); } } } public static void main(String[] args) { MyBlockingQueue buffer = new MyBlockingQueue(10); Runnable producer = () -\u0026gt; { for (int i = 0; i \u0026lt; 100; i++) { try { buffer.put(new Object()); } catch (InterruptedException e) { e.printStackTrace(); } } }; Runnable consumer = () -\u0026gt; { for (int i = 0; i \u0026lt; 100; i++) { try { buffer.take(); } catch (InterruptedException e) { e.printStackTrace(); } } }; new Thread(producer).start(); new Thread(consumer).start(); } } é¦–å…ˆä»£ç ä¸­å®ç°äº†ä¸€ä¸ªç®€åŒ–ç‰ˆçš„é˜»å¡é˜Ÿåˆ—ï¼Œå®ƒå……å½“çš„æ˜¯ç¼“å†²åŒºçš„è§’è‰²ã€‚éšåï¼Œå®šä¹‰äº†ä¸€ä¸ª ReentrantLock ç±»å‹çš„é”ï¼Œå¹¶åœ¨å®ƒçš„åŸºç¡€ä¸Šåˆ›å»ºäº†ä¸¤ä¸ª Conditionï¼š\n notEmptyï¼šè¡¨ç¤ºç¼“å†²åŒºä¸­æœ‰æ•°æ® notFullï¼šè¡¨ç¤ºç¼“å†²åŒºä¸­æœ‰ç©ºé—²ç©ºé—´  æœ€åï¼Œæ˜¯ put() å’Œ take() è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«ç”¨äºå¾€ç¼“å†²åŒºä¸­æ”¾æ•°æ®å’Œä»ç¼“å†²åŒºä¸­å–æ•°æ®ã€‚ç”±äºç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼é€šå¸¸å‘ç”Ÿåœ¨å¤šçº¿ç¨‹çš„åœºæ™¯ä¸‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿éšœçº¿ç¨‹å®‰å…¨ã€‚ä¸ºæ­¤ï¼Œput() æ–¹æ³•é¦–å…ˆè·å–é”ï¼Œç„¶ååœ¨ while å¾ªç¯ä¸­æ£€æµ‹ç¼“å†²åŒºçš„ç©ºé—²æƒ…å†µï¼Œå¦‚æœç¼“å†²åŒºæ»¡äº†ï¼Œåˆ™è°ƒç”¨ notFull.await() é˜»å¡ç”Ÿäº§è€…å¹¶é‡Šæ”¾é”ï¼Œå¦‚æœæ²¡æœ‰æ»¡ï¼Œåˆ™å‘ç¼“å†²åŒºä¸­æ·»åŠ æ•°æ®å¹¶ä½¿ç”¨ notEmpty.signalAll() å”¤é†’æ‰€æœ‰æ­£åœ¨ç­‰å¾…çš„æ¶ˆè´¹è€…ã€‚æœ€åçš„ finally ä¿è¯äº†é”çš„æ­£ç¡®é‡Šæ”¾ã€‚\ntake() æ–¹æ³•ç±»ä¼¼ï¼Œå®ƒå…ˆé€šè¿‡ while æ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºåˆ™è®©æ¶ˆè´¹è€…ç­‰å¾…ï¼Œå¦åˆ™ä»ç¼“å†²åŒºä¸­å–èµ°æ•°æ®å¹¶é€šçŸ¥ç”Ÿäº§è€…æœ‰ç©ºé—²ä½ç½®ï¼Œæœ€åé‡Šæ”¾é”ã€‚\nä½¿ç”¨ wait/notify å®ç°ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼ è™½ç„¶ä½¿ç”¨æ–¹æ³•ä¸åŒï¼Œä½†å®ƒçš„åŸç†ä¸ Condition éå¸¸ç±»ä¼¼ï¼š\npublic class WaitNotifyProducerConsumer { static class MyBlockingQueue { private Queue buffer; private int max = 16; public MyBlockingQueue(int size) { this.buffer = new LinkedList(); this.max = size; } public synchronized void put(Object o) throws InterruptedException { while (buffer.size() == max) { wait(); // è‡ªåŠ¨é‡Šæ”¾lockå¹¶ç­‰å¾…ç©ºé—´  } buffer.add(o); notifyAll(); // å”¤é†’æ¶ˆè´¹è€…  } public synchronized Object take() throws InterruptedException { while (buffer.size() == 0) { wait(); // è‡ªåŠ¨é‡Šæ”¾lockå¹¶ç­‰å¾…æ•°æ®  } Object item = buffer.remove(); notifyAll(); // å”¤é†’ç”Ÿäº§è€…  return item; } } public static void main(String[] args) { MyBlockingQueue buffer = new MyBlockingQueue(10); Runnable producer = () -\u0026gt; { for (int i = 0; i \u0026lt; 100; i++) { try { buffer.put(new Object()); } catch (InterruptedException e) { e.printStackTrace(); } } }; Runnable consumer = () -\u0026gt; { for (int i = 0; i \u0026lt; 100; i++) { try { buffer.take(); } catch (InterruptedException e) { e.printStackTrace(); } } }; new Thread(producer).start(); new Thread(consumer).start(); } } ","href":"/java/concurrency/producer_consumer_pattern/","title":"ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼çš„å‡ ç§å®ç°æ–¹æ¡ˆ"},{"content":"","href":"/tags/gc/","title":"GC"},{"content":"The Truth About Garbage Collection è¿™ç¯‡æ–‡ç« å†™å¾—æŒºå¥½çš„ï¼Œæœ¬æ–‡çš„å¾ˆå¤šå†…å®¹ä¹Ÿæ˜¯åŸºäºè¿™ç¯‡æ–‡ç« è€Œæ¥ã€‚\nJava æ˜¯ä¸€é—¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸æ–­æœ‰æ–°çš„å¯¹è±¡è¢«åˆ›å»ºå‡ºæ¥ï¼Œä¹Ÿä¸æ–­æœ‰å¯¹è±¡è¢«å›æ”¶ã€‚JVM ä¸­çš„å¯¹è±¡ä»åˆ›å»ºåˆ°å›æ”¶ï¼Œé€šå¸¸ä¼šç»å†ä»¥ä¸‹å¤§å¤šæ•°çŠ¶æ€ï¼š\n Created In use (strongly reachable) Invisible Unreachable Collected Finalized Deallocated  Created å¯¹è±¡çš„åˆ›å»ºé€šå¸¸ä¼šç»å†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\n ä¸ºå¯¹è±¡åˆ†é…ç©ºé—´ å¼€å§‹æ„é€ å¯¹è±¡ è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•° åˆå§‹åŒ–å®ä¾‹ä¸å®ä¾‹å˜é‡ æ‰§è¡Œæ„é€ å‡½æ•°çš„å‰©ä½™éƒ¨åˆ†  è¿™äº›æ“ä½œçš„å…·ä½“ä»£ä»·å–å†³äº JVM çš„å®ç°ï¼Œä»¥åŠæ„é€ ç±»çš„è¿‡ç¨‹æ˜¯å¦‚ä½•å®ç°çš„ã€‚å¯¹è±¡è¢«åˆ›å»ºåï¼Œå¦‚æœå®ƒè¢«èµ‹ç»™æŸç»™å˜é‡ï¼ˆæœ‰å˜é‡å¼•ç”¨äº†è¿™ä¸ªå¯¹è±¡ï¼‰ï¼Œå®ƒå°±ä¼šç›´æ¥è¿›å…¥ In Use çŠ¶æ€ã€‚\nå…¶å®ä»¥ä¸Šäº”ä¸ªæ­¥éª¤å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªå¤§çš„æ­¥éª¤â€”â€”å®ä¾‹åŒ–ï¼ˆInstantiationï¼‰å’Œåˆå§‹åŒ–ï¼ˆInitializationï¼‰ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä¸¾ä¸€ä¸ªä¾‹å­ã€‚å…ˆå®šä¹‰ä¸€ä¸ªç±» Birdï¼Œå®ƒæœ‰ä¸€ä¸ª name å±æ€§ï¼š\npublic class Bird { private final String name; public Bird(String name) {this.name = name;} } å½“æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ª Bird å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬ä¼šæ€ä¹ˆåšï¼Ÿæœ€ç®€å•æœ€ç›´æ¥çš„æ–¹æ³•å½“ç„¶æ˜¯ä½¿ç”¨ new å…³é”®å­—å•¦ã€‚æ¯”å¦‚ï¼š\nBird eagle = new Bird(\u0026#34;eagle\u0026#34;); è¿™è¡Œä»£ç åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š\n å£°æ˜ï¼ˆDeclarationï¼‰ï¼šBird eagle å£°æ˜äº†ä¸€ä¸ªç±»å‹ä¸º Bird çš„å˜é‡ï¼Œå˜é‡åä¸º eagleã€‚ å®ä¾‹åŒ–ï¼ˆInstantiationï¼‰ï¼šJava ä½¿ç”¨ new å…³é”®å­—åˆ›å»ºæ–°å¯¹è±¡ã€‚new å…ˆä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ï¼Œç„¶åè¿”å›é‚£å—å†…å­˜çš„å¼•ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å¯¹è±¡çš„å®ä¾‹åŒ–ã€‚ åˆå§‹åŒ–ï¼ˆInitializationï¼‰ï¼šnew ä¼šè°ƒç”¨æ„é€ å™¨ Bird(\u0026quot;eagle\u0026quot;)ï¼Œæ„é€ å™¨ä¼šåˆå§‹åŒ–å‰é¢åˆ›å»ºçš„æ–°å¯¹è±¡ã€‚  In Use è‹¥å¯¹è±¡è¢«è‡³å°‘ä¸€ä¸ªå¼ºå¼•ç”¨æŒæœ‰ï¼Œå®ƒå°±å¤„äºä½¿ç”¨ä¸­ï¼ˆIn Useï¼‰çŠ¶æ€ã€‚JDK 1.1.x ä¸­çš„æ‰€æœ‰å¼•ç”¨éƒ½æ˜¯å¼ºå¼•ç”¨ï¼ŒJDK 1.2 åˆ™å¼•å…¥äº†ä¸‰ç§å…¶å®ƒçš„å¼•ç”¨ï¼šè½¯å¼•ç”¨ï¼ˆsoft referenceï¼‰ã€å¼±å¼•ç”¨ï¼ˆweak referenceï¼‰å’Œè™šå¼•ç”¨ï¼ˆphantom referenceï¼‰ï¼Œä¸‰ç§å¼•ç”¨çš„å¼ºåº¦ä¾æ¬¡å‡å¼±ã€‚ä¸‹é¢è¿™æ®µä»£ç å±•ç¤ºäº†åˆ›å»ºå¯¹è±¡å¹¶å°†å…¶èµ‹å€¼ç»™ä¸€äº›å˜é‡çš„è¿‡ç¨‹ï¼š\npublic class CatTest { static Vector catList = new Vector(); static void makeCat() { Object cat = new Cat(); catList.addElement(cat); } public static void main(String[] arg) { makeCat(); // do more stuff  } } ä¸‹å›¾æ˜¾ç¤ºäº† makeCat æ–¹æ³•è¿”å›å‰ï¼ŒJVM ä¸­å¯¹è±¡çš„å¼•ç”¨å…³ç³»ã€‚æ­¤æ—¶ï¼Œæœ‰ä¸¤ä¸ªå¼•ç”¨æŒ‡å‘äº† Cat å¯¹è±¡ï¼š\nå½“ makeCat æ–¹æ³•è¿”å›åï¼Œå®ƒçš„æ ˆå¸§ä¸æ–¹æ³•å†…å£°æ˜çš„æ‰€æœ‰ä¸´æ—¶å˜é‡éƒ½ä¼šè¢«ç§»é™¤ã€‚å¦‚æ­¤ä¸€æ¥ï¼ŒæŒ‡å‘ Cat å¯¹è±¡çš„å¼•ç”¨å°±åªæœ‰é™æ€å˜é‡ catList äº†ï¼Œå®ƒé€šè¿‡ Vector é—´æ¥æŒ‡å‘ Cat å¯¹è±¡ã€‚\nInvisible å³ä½¿æŒ‡å‘å¯¹è±¡çš„å¼ºå¼•ç”¨ä¾ç„¶å­˜åœ¨ï¼Œä½†å¦‚æœè¿™äº›å¼ºå¼•ç”¨å¯¹ç¨‹åºæ¥è¯´æ˜¯ ä¸å¯è®¿é—®çš„ï¼Œå¯¹è±¡å°±ä¼šè¿›å…¥ä¸å¯è§çŠ¶æ€ï¼ˆinvisibleï¼‰ã€‚å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šè¿›å…¥è¿™ä¸ªçŠ¶æ€ï¼Œä¸‹é¢ä»£ç ç‰‡æ®µå±•ç¤ºäº†ä¸€ä¸ªä¸å¯è§å¯¹è±¡ï¼š\npublic void run() { try { Object foo = new Object(); foo.doSomething(); } catch (Exception e) { // whatever  } while (true) { // loop forever  // do stuff  } } ä»¥ä¸Šä»£ç åˆ›å»ºäº† foo è¿™ä¸ªå¯¹è±¡ï¼Œå½“ try è¯­å¥å—æ‰§è¡Œå®Œæˆæ—¶ï¼Œfoo å°±å˜å¾—ä¸å¯è®¿é—®äº†ï¼ˆfoo åªå¯åœ¨try è¯­å¥å—å†…è¢«è®¿é—®ï¼ŒJLS11 ä¸­çš„ Scope of a Declaration éƒ¨åˆ†å¯¹å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸè¿›è¡Œäº†è¯¦ç»†è¯´æ˜ï¼‰ã€‚åœ¨ run æ–¹æ³•è¿”å›ä¹‹å‰ï¼Œfoo éƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œå¹¶ä¸”æ˜¯ GC Rootï¼Œæ‰€ä»¥ä¸èƒ½è¢«å›æ”¶ï¼Œå› æ­¤å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»æ˜¾å¼åœ°å°† foo è®¾ç½®ä¸º nullï¼Œæ‰èƒ½ä¿è¯åƒåœ¾å›æ”¶ã€‚\nUnreachable å½“ä¸å­˜åœ¨ä» GC Root åˆ°å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼ˆé“¾ï¼‰æ—¶ï¼Œå¯¹è±¡å°±å¤„äºä¸å¯è¾¾ï¼ˆunreachableï¼‰çŠ¶æ€ã€‚å¤„äºä¸å¯è¾¾çŠ¶æ€çš„å¯¹è±¡å°±å¯ä»¥è¢«å›æ”¶äº†ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€å¯¹è±¡ä¼šè¢«ç«‹å³å›æ”¶ï¼ŒJVM å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„æ—¶å€™è¿›è¡Œå›æ”¶æ“ä½œã€‚\nå¾ªç¯å¼•ç”¨å¹¶ä¸ä¸€å®šä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œä¸¾ä¸ªä¾‹å­ï¼š\npublic void buildDog() { Dog newDog = new Dog(); Tail newTail = new Tail(); newDog.tail = newTail; newTail.dog = newDog; } ä¸‹å›¾å±•ç¤ºäº† buildDog æ–¹æ³•è¿”å›å‰å¯¹è±¡çš„å¼•ç”¨å›¾ã€‚æ–¹æ³•è¿”å›å‰ï¼ŒnewDog å’Œ newTail éƒ½æ˜¯æ ˆçš„å±€éƒ¨å˜é‡ï¼Œå¹¶ä¸”äº’ç›¸å¼•ç”¨ï¼Œå®ƒä»¬éƒ½æ˜¯ GC Rootï¼š\nä¸‹å›¾å±•ç¤ºäº† buildDog æ–¹æ³•è¿”å›åçš„å¯¹è±¡å¼•ç”¨å›¾ã€‚è¿™æ—¶ï¼Œç”±äºæ ˆå¸§å¼¹å‡ºï¼ŒDog å’Œ Tail è™½ç„¶ç›¸äº’å¼•ç”¨ï¼Œä½†æ˜¯å®ƒä»¬å½“ä¸­ä»»ä½•ä¸€ä¸ªå¯¹ GC Roots æ¥è¯´éƒ½æ˜¯ä¸å¯è¾¾çš„ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥è¢«å›æ”¶ã€‚\nCollected å½“ GC åœ¨è¯†åˆ«å‡ºå¯¹è±¡å¤„äºä¸å¯è¾¾çŠ¶æ€ï¼Œå¹¶åšå¥½äº†å¯¹è¯¥å¯¹è±¡çš„å†…å­˜ç©ºé—´è¿›è¡Œé‡æ–°åˆ†é…çš„å‡†å¤‡ä¹‹åï¼Œå¯¹è±¡å°±è¿›å…¥è¢«æ”¶é›†ï¼ˆCollectedï¼‰çŠ¶æ€ã€‚å¦‚æœå¯¹è±¡æ²¡æœ‰ finalize æ–¹æ³•ï¼Œå®ƒå°±ä¼šç›´æ¥è¿›å…¥ç»ˆç»“ï¼ˆFinalizedï¼‰çŠ¶æ€ã€‚è‹¥å¯¹è±¡æœ‰ finalize æ–¹æ³•ï¼ˆå…·æœ‰ finalizerï¼‰ï¼Œå¹¶ä¸”æ²¡æœ‰æ‰§è¡Œè¿‡ï¼Œfinalize æ–¹æ³•ä¼šè¢«æ‰§è¡Œï¼ˆfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚\næ³¨ï¼šfinalize æ–¹æ³•åœ¨ JDK9 ä¸­å·²è¢«å¼ƒç”¨ï¼Œå› ä¸ºå®ƒå¯èƒ½å¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œå¯¼è‡´æ­»é”ã€èµ„æºæ³„æ¼ç­‰ã€‚\nFinalized è‹¥å¯¹è±¡å…·æœ‰ finalize æ–¹æ³•ï¼Œå¦‚æœå¯¹è±¡åœ¨ finalize æ–¹æ³•è¢«æ‰§è¡Œåä»ç„¶æ˜¯ä¸å¯è¾¾çš„ï¼Œå¯¹è±¡çš„çŠ¶æ€å°±æ˜¯å·²ç»ˆç»“ï¼ˆFinalizedï¼‰ã€‚å¤„äºç»ˆç»“çŠ¶æ€çš„å¯¹è±¡æ­£ç­‰å¾…è¢«å›æ”¶ã€‚è™½ç„¶ finalizer çš„æ‰§è¡Œæ—¶æœºç”± JVM å†³å®šï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹å¯ä»¥è‚¯å®šï¼šfinalizer ä¼šå»¶é•¿å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œç”šè‡³è®©å¯¹è±¡èµ·æ­»å›ç”Ÿã€‚\nå‘¨å¿—æ˜è€å¸ˆçš„ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬3ç‰ˆï¼‰ã€‹ä¸­å°±ç»™å‡ºäº†ä¸€æ®µå¯¹è±¡è‡ªæˆ‘æ‹¯æ•‘çš„ä»£ç ï¼š\n/** * æ­¤ä»£ç æ¼”ç¤ºäº†ä¸¤ç‚¹ï¼š * 1.å¯¹è±¡å¯ä»¥åœ¨è¢«GCæ—¶è‡ªæˆ‘æ‹¯æ•‘ã€‚ * 2.è¿™ç§è‡ªæ•‘çš„æœºä¼šåªæœ‰ä¸€æ¬¡ï¼Œå› ä¸ºä¸€ä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•æœ€å¤šåªä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡ * @author zzm */ public class FinalizeEscapeGC { public static FinalizeEscapeGC SAVE_HOOK = null; public void isAlive() { System.out.println(\u0026#34;yes, i am still alive :)\u0026#34;); } @Override protected void finalize() throws Throwable { super.finalize(); System.out.println(\u0026#34;finalize mehtod executed!\u0026#34;); FinalizeEscapeGC.SAVE_HOOK = this; } public static void main(String[] args) throws Throwable { SAVE_HOOK = new FinalizeEscapeGC(); //å¯¹è±¡ç¬¬ä¸€æ¬¡æˆåŠŸæ‹¯æ•‘è‡ªå·±  SAVE_HOOK = null; System.gc(); // å› ä¸ºFinalizeræ–¹æ³•ä¼˜å…ˆçº§å¾ˆä½ï¼Œæš‚åœ0.5ç§’ï¼Œä»¥ç­‰å¾…å®ƒ  Thread.sleep(500); if (SAVE_HOOK != null) { SAVE_HOOK.isAlive(); } else { System.out.println(\u0026#34;no, i am dead :(\u0026#34;); } // ä¸‹é¢è¿™æ®µä»£ç ä¸ä¸Šé¢çš„å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯è¿™æ¬¡è‡ªæ•‘å´å¤±è´¥äº†  SAVE_HOOK = null; System.gc(); // å› ä¸ºFinalizeræ–¹æ³•ä¼˜å…ˆçº§å¾ˆä½ï¼Œæš‚åœ0.5ç§’ï¼Œä»¥ç­‰å¾…å®ƒ  Thread.sleep(500); if (SAVE_HOOK != null) { SAVE_HOOK.isAlive(); } else { System.out.println(\u0026#34;no, i am dead :(\u0026#34;); } } } è¿è¡Œç»“æœï¼š\nfinalize mehtod executed ! yes,i am still alive : ) no,i am dead : ( ç”±äº finalize æ–¹æ³•åªä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥å¯¹è±¡ç¬¬ä¸€æ¬¡è‡ªæ•‘æˆåŠŸï¼Œç¬¬äºŒæ¬¡å´å¤±è´¥äº†ã€‚JLS11 çš„ Finalization of Class Instances éƒ¨åˆ†å¯¹ Finalization è¿›è¡Œäº†è¯¦ç»†çš„ä»‹ç»ï¼Œä½†è€ƒè™‘åˆ°å®ƒå·²ç»è¢« JDK å¼ƒç”¨ï¼Œæˆ‘ä»¬è¿˜æ˜¯è·³è¿‡å§ã€‚\nDeallocated é‡Šæ”¾ï¼ˆDeallocatedï¼‰çŠ¶æ€æ˜¯ GC è¿‡ç¨‹æœ€åä¸€æ­¥ä¸­å¯¹è±¡çš„çŠ¶æ€ã€‚åœ¨ç»è¿‡ä»¥ä¸Šå…­ä¸ªé˜¶æ®µä¹‹åï¼Œå¦‚æœå¯¹è±¡ä¾ç„¶ä¸å¯è¾¾ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥è¢«é‡Šæ”¾äº†ã€‚ä½•æ—¶ä»¥åŠå¦‚ä½•é‡Šæ”¾å¯¹è±¡æ‰€å å†…å­˜ä¾ç„¶æ˜¯ç”± JVM å†³å®šçš„ã€‚\nå°ç»“ æœ€åï¼Œå€Ÿç½‘ä¸Šçš„ä¸€å¼ å›¾æ¥ç»“æŸæœ¬æ–‡ï¼Œæ„Ÿè°¢åŸä½œã€‚\næœ¬æ–‡å…¶å®åªæ¶‰åŠå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªå®è§‚æ­¥éª¤ï¼Œå®é™…çš„å¯¹è±¡çš„ä¸€ç”Ÿä¼šæ›´åŠ å¤æ‚ã€‚å¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ï¼Œå¯¹äºä¸€ä¸ªæ–°ç”Ÿå¯¹è±¡ï¼ŒJVM éœ€è¦æ‰¾åˆ°å¯¹è±¡æ‰€å±çš„ç±»ï¼Œå¦‚æœç±»æ²¡æœ‰åŠ è½½ï¼Œè¿˜éœ€è¦å…ˆè¿›è¡Œç±»åŠ è½½ï¼Œç„¶åä¸ºå¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´ï¼Œåˆå§‹åŒ–å¯¹è±¡çš„å±æ€§ä¸ºé›¶å€¼ï¼Œå¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®â€¦â€¦ç»è¿‡è¿™ä¸€ç³»åˆ—æ­¥éª¤ï¼Œå¯¹è±¡æ‰å¾—ä»¥è¯ç”Ÿã€‚éšåï¼Œä¸ºäº†ä½¿ç”¨å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå¯¹è±¡çš„è®¿é—®å®šä½ã€‚ç”¨å®Œä¹‹åï¼Œå¯¹è±¡ç­‰å¾…è¢«åƒåœ¾å›æ”¶ï¼Œä¸ºå…¶å®ƒæ–°ç”Ÿå¯¹è±¡ç•™å‡ºå®è´µçš„å†…å­˜ç©ºé—´ã€‚å¯¹è±¡çš„ä¸€ç”Ÿå¯ä¸ç®€å•ã€‚\nå‚è€ƒèµ„æ–™  The Truth About Garbage Collection. å‘¨å¿—æ˜. æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬3ç‰ˆï¼‰. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2019. Creating Objects.  ","href":"/java/jvm/java_object_lifecycle/","title":"Java å¯¹è±¡çš„ä¸€ç”Ÿ"},{"content":"","href":"/tags/jvm/","title":"JVM"},{"content":"JDK 1.2 ä¹‹åï¼ŒJava å°†å¼•ç”¨åˆ†ä¸ºå¼ºå¼•ç”¨ï¼ˆStrongly Referenceï¼‰ã€è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰ã€å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰å’Œè™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰å››ç§ï¼Œè¿™å››ç§å¼•ç”¨çš„å¼ºåº¦ä¾æ¬¡å‡å¼±ï¼Œå®ƒä»¬ä¸ Java çš„å¯¹è±¡å›æ”¶æœ‰ç€å¾ˆå¤§çš„å…³ç³»ã€‚\n A reference object encapsulates a reference to some other object so that the reference itself may be examined and manipulated like any other object. Three types of reference objects are provided, each weaker than the last: soft, weak, and phantom. Each type corresponds to a different level of reachability.\n è¿™æ®µè¯å·²ç»æè¿°å¾—å¾ˆæ¸…æ¥šäº†ï¼šJava ä¸­æœ‰ä¸‰ç§å¼•ç”¨å¯¹è±¡ï¼ˆreference objectï¼‰ï¼Œå®ƒä»¬å°è£…äº†ä¸€äº›å…¶å®ƒçš„å¯¹è±¡ï¼Œä»è€Œè®©æˆ‘ä»¬å¯ä»¥åƒæ“ä½œå…¶å®ƒå¯¹è±¡ä¸€æ ·æ“ä½œå¼•ç”¨æœ¬èº«ï¼Œä¸åŒå¼•ç”¨å¯¹è±¡çš„å¯è¾¾æ€§ä¸åŒã€‚\né™¤å¼€ä¸ Finalization æœ‰å…³çš„ç±»ï¼Œä¸‹å›¾å±•ç¤ºäº† java.lang.ref åŒ…ä¸­çš„ç±»ç»“æ„ï¼š\nReference å¯¹è±¡ç”¨äºç»´æŒå¯¹å…¶å®ƒå¯¹è±¡çš„å¼•ç”¨ï¼Œä½† GC ä»ç„¶å¯ä»¥å›æ”¶è¿™äº›è¢«å¼•ç”¨çš„å…¶å®ƒå¯¹è±¡ã€‚å½“ GC å†³å®šå›æ”¶æŸä¸ªå¼•ç”¨å¯¹è±¡å…³è”çš„å¯¹è±¡æ—¶ï¼Œå®ƒä¼šå°†å¯¹åº”çš„å¼•ç”¨å¯¹è±¡æ”¾å…¥ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å¯¹è±¡è¢«å›æ”¶çš„é€šçŸ¥äº†ã€‚\nå¯¹è±¡å¯è¾¾æ€§ åœ¨è¿›è¡Œåƒåœ¾å›æ”¶ä¹‹å‰ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯æ‰¾å‡ºåƒåœ¾ã€‚å¼•ç”¨è®¡æ•°ç®—æ³•å’Œå¯è¾¾æ€§åˆ†æç®—æ³•æ˜¯ä¸¤ç§å¸¸è§çš„åˆ¤æ–­åƒåœ¾çš„æ–¹æ³•ï¼ŒJVM æ˜¯é€šè¿‡åˆ†æå¯¹è±¡çš„å¯è¾¾æ€§æ¥åˆ¤æ–­æ˜¯å¦åº”è¯¥å°†å…¶å›æ”¶çš„ã€‚å †ä¸­çš„å¯¹è±¡æ˜¯å¯ä»¥ç›¸äº’å¼•ç”¨çš„ï¼Œæ ¹æ®å¯¹è±¡ç±»å‹çš„ä¸åŒï¼Œå¼•ç”¨çš„ç›´æ¥è¡¨ç°å½¢å¼ä¹Ÿä¸åŒã€‚å¯¹äºæ™®é€šå¯¹è±¡è€Œè¨€ï¼Œå¼•ç”¨å°±æ˜¯å¯¹è±¡çš„å­—æ®µï¼Œè€Œå¯¹äºæ•°ç»„è€Œè¨€ï¼Œå¼•ç”¨å°±æ˜¯æ•°ç»„çš„å…ƒç´ ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›éšè—çš„å¼•ç”¨ï¼Œä¾‹å¦‚ï¼šæ¯ä¸ªå¯¹è±¡å®ä¾‹éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶ç±»å‹ï¼ˆå³å®ä¾‹å¯¹åº”çš„ Classï¼‰çš„å¼•ç”¨ï¼Œè€Œæ¯ä¸ª Class åˆåŒ…å«ä¸€ä¸ªæŒ‡å‘åŠ è½½å®ƒçš„ ClassLoader çš„å¼•ç”¨ã€‚\næˆ‘ä»¬å¯ä»¥å°†å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨å…³ç³»çœ‹ä½œæ˜¯ä¸€å¼ æœ‰å‘å›¾ï¼Œå›¾ä¸­çš„èŠ‚ç‚¹å°±æ˜¯å¯¹è±¡ï¼Œè€Œè¾¹å°±æ˜¯å¯¹è±¡é—´çš„å¼•ç”¨ã€‚ä»æºå¯¹è±¡å‡ºå‘ï¼Œè‹¥å­˜åœ¨ä¸€æ¡é€šå¾€ç›®æ ‡å¯¹è±¡çš„è·¯å¾„ï¼Œåˆ™ç›®æ ‡å¯¹è±¡å¯¹æºå¯¹è±¡æ¥è¯´æ˜¯å¯è¾¾çš„ï¼Œåä¹‹ç›®æ ‡å¯¹è±¡å¯¹æºå¯¹è±¡è€Œè¨€å°±æ˜¯ä¸å¯è¾¾çš„ã€‚\nGC Roots å¯è¾¾æ€§åˆ†æç®—æ³•çš„åŸºæœ¬æ€è·¯æ˜¯é€šè¿‡ä¸€ç³»åˆ—è¢«ç§°ä¸ºâ€œGC Rootsâ€çš„æ ¹å¯¹è±¡ä½œä¸ºèµ·å§‹èŠ‚ç‚¹é›†ï¼Œä»è¿™äº›ç»“ç‚¹å¼€å§‹ï¼Œæ ¹æ®å¼•ç”¨å…³ç³»å‘ä¸‹æœç´¢ï¼Œæœç´¢è·¯å¾„å³ä¸ºå¼•ç”¨é“¾ï¼ˆReference Chainï¼‰ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•è·¯å¾„å¯ä»¥åˆ°è¾¾ æŸä¸ªå¯¹è±¡ï¼Œåˆ™è¯´æ˜è¿™ä¸ªå¯¹è±¡ä¸å†è¢«ä½¿ç”¨ï¼Œå³ä¸ºåƒåœ¾ã€‚\nåœ¨ Java ä¸­ï¼ŒGC Root æ˜¯ä¸€ä¸ªå¯ä»¥ ä»å †å¤–è®¿é—® çš„å¯¹è±¡ï¼Œé€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å¯¹è±¡ï¼š\n JVM æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼Œæ¯”å¦‚çº¿ç¨‹æ–¹æ³•çš„å‚æ•°ã€å±€éƒ¨å˜é‡ã€ä¸´æ—¶å˜é‡ç­‰ï¼› æ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼Œæ¯”å¦‚ Java ç±»çš„å¼•ç”¨ç±»å‹çš„é™æ€å˜é‡ï¼› æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¼•ç”¨ï¼› Native æ–¹æ³•æ ˆä¸­ JNI å¼•ç”¨çš„å¯¹è±¡ï¼› JVM å†…éƒ¨çš„å¼•ç”¨ï¼Œæ¯”å¦‚åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„ Class å¯¹è±¡ã€ä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡ï¼ˆNullPointerExceptionã€OutOfMemeryError ç­‰ï¼‰ã€ç³»ç»Ÿç±»åŠ è½½å™¨ï¼› æ‰€æœ‰è¢«åŒæ­¥é”ï¼ˆsynchronizedï¼‰æŒæœ‰çš„å¯¹è±¡ï¼› åæ˜  JVM å†…éƒ¨æƒ…å†µçš„ JMXBeanã€JVMTI ä¸­æ³¨å†Œçš„å›è°ƒã€Native ä»£ç ç¼“å­˜ç­‰ï¼›  Eclipse çš„å†…å­˜åˆ†æå·¥å…·åˆ—ä¸¾å‡ºäº†å„ç§å…·ä½“çš„ GC Rootï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è¿›ä¸€æ­¥äº†è§£ã€‚\nå¯¹è±¡çš„äº”ç§å¯è¾¾æ€§ Java ä¸­çš„å¯¹è±¡å¯è¾¾æ€§æœ‰äº”ç§ä¸åŒçš„ç¨‹åº¦ï¼šå¼ºå¯è¾¾ï¼ˆstrongly reachableï¼‰ã€è½¯å¯è¾¾ï¼ˆsoftly reachableï¼‰ã€å¼±å¯è¾¾ï¼ˆweakly reachableï¼‰ã€è™šå¯è¾¾ï¼ˆphantom reachableï¼‰å’Œä¸å¯è¾¾ï¼ˆunreachableï¼‰ã€‚ä»¥ä¸‹å…³äºå¯è¾¾æ€§çš„æè¿°ï¼Œå–è‡ª java.lang.ref åŒ…çš„æ–‡æ¡£ï¼š\n Going from strongest to weakest, the different levels of reachability reflect the life cycle of an object. They are operationally defined as follows:\n  An object is strongly reachable if it can be reached by some thread without traversing any reference objects. A newly-created object is strongly reachable by the thread that created it.\n  An object is softly reachable if it is not strongly reachable but can be reached by traversing a soft reference.\n  An object is weakly reachable if it is neither strongly nor softly reachable but can be reached by traversing a weak reference. When the weak references to a weakly-reachable object are cleared, the object becomes eligible for finalization.\n  An object is phantom reachable if it is neither strongly, softly, nor weakly reachable, it has been finalized, and some phantom reference refers to it.\n  Finally, an object is unreachable, and therefore eligible for reclamation, when it is not reachable in any of the above ways.\n   å¼ºå¼•ç”¨ å¼ºå¼•ç”¨æŒ‡ç¨‹åºä»£ç ä¸­æ™®éå­˜åœ¨çš„å¼•ç”¨èµ‹å€¼ï¼ˆæ¯”å¦‚Object strongReference = new Object()è¿™ç§å…³ç³»ï¼‰ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å¼ºå¼•ç”¨çš„å…³ç³»è¿˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨å°±ä¸ä¼šå›æ”¶è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚å½“å†…å­˜ä¸è¶³æ—¶ï¼ŒJVM å®æ„¿æŠ›å‡º OutOfMemorryErrorï¼Œä¹Ÿä¸ä¼šå›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡ã€‚å½“ä¸€ä¸ªå¼ºå¼•ç”¨å¯¹è±¡ä¸å†ä½¿ç”¨æ—¶ï¼Œè‹¥è¦è®© GC å›æ”¶å®ƒï¼Œæˆ‘ä»¬éœ€è¦è®©å®ƒå˜å¾—ä¸å¯è¾¾ï¼ˆå®é™…ä¸Šï¼ŒGC ä¹Ÿåªå›æ”¶ä¸å¯è¾¾å¯¹è±¡ï¼‰ã€‚\nvoid test() { Object strongReference = new Object(); // å¼ºå¼•ç”¨  strongReference = null; // å¯¹è±¡å¯ä»¥è¢« GC å›æ”¶äº† } åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œnew Object() ä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè€ŒæŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„æ˜¯æ ˆä¸­çš„å¼•ç”¨ strongReferenceã€‚å½“æ–¹æ³•è°ƒç”¨å®Œæˆï¼Œæ–¹æ³•æ ˆé€€å‡ºï¼ŒstrongReference ä¸å¤å­˜åœ¨ï¼Œè¿™ä¸ªå¯¹è±¡å°±å¯ä»¥è¢«å›æ”¶äº†ã€‚è‹¥ strongReference æ˜¯å…¨å±€å˜é‡ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨å°†å…¶è®¾ç½®ä¸º nullï¼Œå»é™¤å…¶å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯¹è±¡æ‰èƒ½è¢«å›æ”¶ã€‚\nè½¯å¼•ç”¨ è¢«è½¯å¼•ç”¨å…³è”å¯¹è±¡å³è½¯å¯è¾¾å¯¹è±¡ï¼Œå®ƒä»¬æ˜¯ä¸€äº›è¿˜æœ‰ç”¨ä½†éå¿…é¡»çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºä¹‹å‰ï¼Œä¼šè¢«äºŒæ¬¡å›æ”¶ï¼Œå¦‚æœè¿™æ¬¡å›æ”¶ä¹‹åçš„å†…å­˜ä¾ç„¶ä¸å¤Ÿï¼ŒJVM æ‰ä¼šæŠ›å‡º OutOfMemoryErrorã€‚JVM ä¿è¯åœ¨æŠ›å‡º OutOfMemoryError ä¹‹å‰å›æ”¶æ‰€æœ‰è¢«è½¯å¼•ç”¨å…³è”çš„è½¯å¯è¾¾å¯¹è±¡ã€‚JDK 1.2 ä¹‹åæä¾›äº† SoftReference ç±»æ¥è¡¨ç¤ºè½¯å¼•ç”¨ã€‚\n Soft references are most often used to implement memory-sensitive caches.\n åˆ›å»ºè½¯å¼•ç”¨å¯¹è±¡çš„æ–¹æ³•æœ‰ä¸¤ç§ã€‚\nç¬¬ä¸€ç§æ˜¯åˆ›å»ºä¸ä¸ä»»ä½•å¼•ç”¨é˜Ÿåˆ—å…³è”çš„è½¯å¼•ç”¨å¯¹è±¡ï¼š\nObject referent = new Object(); SoftReference\u0026lt;Object\u0026gt; softReference = new SoftReference\u0026lt;\u0026gt;(referent); æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å¸¦ ReferenceQueue çš„æ„é€ å‡½æ•°ï¼Œå¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶ï¼ŒJVM å°±ä¼šè‡ªåŠ¨å°†è¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼š\nReferenceQueue\u0026lt;Object\u0026gt; referenceQueue = new ReferenceQueue\u0026lt;\u0026gt;(); SoftReference\u0026lt;Object\u0026gt; softReference = new SoftReference\u0026lt;\u0026gt;(obj, referenceQueue); Reference ç±»æä¾›çš„ get å’Œ clear æ–¹æ³•åˆ†åˆ«å¯ä»¥ç”¨æ¥è·å–å’Œé‡ç½®å¯¹åº”çš„å¼•ç”¨ï¼š\nObject referent = softReference.get(); softReference.clear(); Object referent2 = softReference.get(); // null å®é™…ä¸Šï¼Œç”±äºå¯¹è±¡å¯èƒ½è¢« GC å›æ”¶ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ get æ–¹æ³•è¿”å›çš„ referent è¿›è¡Œæ£€æŸ¥ï¼š\nObject referent = softReference.get(); if (referent != null) { // å¯¹è±¡è¿˜æ²¡æœ‰è¢« GC å›æ”¶  // ç”¨ä½œç¼“å­˜æ—¶ï¼Œå¯ç›´æ¥è¿”å›å¯¹è±¡ } else { // å¯¹è±¡å·²ç»è¢« GC å›æ”¶  // ç”¨ä½œç¼“å­˜æ—¶ï¼Œéœ€è¦é‡æ–°å®ä¾‹åŒ–å¼•ç”¨å¯¹è±¡ } å¼±å¼•ç”¨ è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡å³å¼±å¯è¾¾å¯¹è±¡ï¼Œå®ƒæè¿°çš„ä¹Ÿæ˜¯éå¿…é¡»å¯¹è±¡ï¼Œå…¶å¼ºåº¦æ¯”è½¯å¼•ç”¨æ›´å¼±ã€‚è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ï¼Œåªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶ã€‚å½“åƒåœ¾æ”¶é›†å™¨å¼€å§‹å·¥ä½œï¼Œæ— è®ºå½“å‰å†…å­˜æ˜¯å¦ä¸è¶³ï¼Œéƒ½ä¼šå›æ”¶æ‰è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚JDK 1.2 ä¹‹åæä¾›äº† WeakReference ç±»æ¥è¡¨ç¤ºå¼±å¼•ç”¨ã€‚\nå¼±å¼•ç”¨ä¸è½¯å¼•ç”¨ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šè¢«å¼±å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡åªåœ¨ä¸¤æ¬¡ GC ä¹‹é—´å­˜æ´»ï¼Œè€Œè¢«è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡åœ¨ JVM å†…å­˜ç´§å¼ çš„æ—¶å€™æ‰è¢«å›æ”¶ï¼Œå®ƒæ˜¯å¯ä»¥ç»å†å¤šæ¬¡ GC çš„ã€‚\n Weak references are most often used to implement canonicalizing mappings.\n åˆ›å»ºå¼±å¼•ç”¨å¯¹è±¡çš„æ–¹æ³•ä¹Ÿæœ‰ä¸¤ç§ï¼Œä¸å…³è”ä»»ä½•å¼•ç”¨é˜Ÿåˆ—çš„å’Œå…³è”å¼•ç”¨é˜Ÿåˆ—çš„ï¼š\nObject referent = new Object(); ReferenceQueue referenceQueue = new ReferenceQueue(); WeakReference weakReference1 = new WeakReference\u0026lt;\u0026gt;(referent); WeakReference weakReference2 = new WeakReference\u0026lt;\u0026gt;(referent, referenceQueue); å¼±å¼•ç”¨çš„å…¶å®ƒä½¿ç”¨ä¸è½¯å¼•ç”¨ç±»ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚\nJDK æä¾›äº†ä¸€ä¸ªåŸºäºå¼±å¼•ç”¨å®ç°çš„ HashMap é›†åˆâ€”â€” WeakHashMapï¼Œå…¶ä¸­çš„ Entry ç»§æ‰¿äº† WeakReferenceï¼ŒEntry ä¸­ä½¿ç”¨å¼±å¼•ç”¨æŒ‡å‘ Keyï¼Œä½¿ç”¨å¼ºå¼•ç”¨æŒ‡å‘ Valueã€‚å½“æ²¡æœ‰å¼ºå¼•ç”¨æŒ‡å‘ Key çš„æ—¶å€™ï¼ŒKey å¯ä»¥è¢« GC å›æ”¶ã€‚å½“å†æ¬¡æ“ä½œ WeakHashMap çš„æ—¶å€™ï¼Œå°±ä¼šéå†å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ï¼Œä» WeakHashMap ä¸­æ¸…ç†æ‰ç›¸åº”çš„ Entryã€‚\nè™šå¼•ç”¨ è™šå¼•ç”¨æ˜¯æœ€å¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ï¼Œåˆç§°â€œå¹½çµå¼•ç”¨â€æˆ–â€œå¹»å½±å¼•ç”¨â€ã€‚ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥è·å–ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ã€‚JDK 1.2 ä¹‹åæä¾›äº† PhantomReference ç±»æ¥è¡¨ç¤ºè™šå¼•ç”¨ã€‚è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢« GC å›æ”¶çš„æ´»åŠ¨ã€‚ è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼šè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚\nObject referent = new Object(); ReferenceQueue referenceQueue = new ReferenceQueue(); // åˆ›å»ºè™šå¼•ç”¨æ—¶ï¼Œå¿…é¡»å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ç›¸å…³è” PhantomReference phantomReference = new PhantomReference\u0026lt;\u0026gt;(referent, referenceQueue); å¼±å¼•ç”¨çš„å…¶å®ƒä½¿ç”¨ä¸è½¯å¼•ç”¨ç±»ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚\nå‚è€ƒèµ„æ–™  å‘¨å¿—æ˜. æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬3ç‰ˆï¼‰. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2019. Package java.lang.ref.  ","href":"/java/java_lang/references_and_reachability_in_java/","title":"Java ä¸­çš„å¼•ç”¨ä¸å¯¹è±¡å¯è¾¾æ€§"},{"content":"","href":"/tags/jdbc/","title":"JDBC"},{"content":"JDBCï¼ˆJava DataBase Connectivityï¼‰æ˜¯ Java ç¨‹åºä¸å…³ç³»å‹æ•°æ®åº“äº¤äº’çš„ç»Ÿä¸€ APIï¼Œå®ƒç”±ä¸¤éƒ¨åˆ† API ç»„æˆï¼š\n é¢å‘ Java å¼€å‘è€…çš„ Java APIï¼Œè¿™ä¸€éƒ¨åˆ† API ç‹¬ç«‹äºå„ä¸ªæ•°æ®åº“äº§å“çš„æ¥å£è§„èŒƒï¼Œæ˜¯æ ‡å‡†åˆç»Ÿä¸€çš„ Javaã€€APIã€‚ é¢å‘æ•°æ®åº“é©±åŠ¨ç¨‹åºå¼€å‘è€…çš„ APIï¼Œç”±æ•°æ®åº“å‚å•†å®ç°ï¼Œç”¨äºè¿æ¥å…·ä½“çš„æ•°æ®åº“äº§å“ã€‚  ä½¿ç”¨ JDBC æ“ä½œæ•°æ®åº“çš„æ ¸å¿ƒæ­¥éª¤ åœ¨å®é™…å¼€å‘ Java ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ JDBC è¿æ¥åˆ°æ•°æ®åº“ï¼Œå®Œæˆå„ç§æ•°æ®åº“æ“ä½œã€‚ä»¥ä¸‹å°±æ˜¯æ‰§è¡Œ SELECT è¯­å¥æ—¶å‘ç”Ÿçš„ JDBC æ“ä½œï¼š\n æ³¨å†Œæ•°æ®åº“é©±åŠ¨ç±»ï¼Œç»™å‡ºæ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼ˆæ•°æ®åº“åœ°å€ã€ç”¨æˆ·åã€å¯†ç ç­‰ï¼‰ åˆ›å»º Connection è¿æ¥åˆ°æ•°æ®åº“ï¼ˆè°ƒç”¨ DriverManager.getConnection() æ–¹æ³•ï¼‰ åˆ›å»º Statement å¯¹è±¡ï¼ˆè°ƒç”¨ Connection çš„ createStatement() æˆ– prepareStatement() æ–¹æ³•ï¼‰ é€šè¿‡ Statement å¯¹è±¡æ‰§è¡Œ SQLï¼Œå¾—åˆ° ResultSet å¯¹è±¡ï¼ˆæŸ¥è¯¢ç»“æœé›†ï¼‰ ä» ResultSet ä¸­è¯»å–æ•°æ® å…³é—­ ResultSetã€Statement åŠ Connection å¯¹è±¡  æ•°æ®åº“è¿æ¥æ±  ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ï¼Ÿæ•°æ®åº“è¿æ¥æ˜¯æ•´ä¸ªæœåŠ¡ä¸­æ¯”è¾ƒçè´µçš„èµ„æºä¹‹ä¸€ï¼Œå› ä¸ºå»ºç«‹æ•°æ®åº“è¿æ¥æ¶‰åŠé‰´æƒã€æ¡æ‰‹ç­‰ä¸€ç³»åˆ—ç½‘ç»œæ“ä½œã€‚ä½¿ç”¨æ± åŒ–æŠ€æœ¯ç¼“å­˜æ•°æ®åº“è¿æ¥å¸¦æ¥çš„å¥½å¤„è¿˜æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼š\n å®ç°è¿æ¥é‡ç”¨ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ æ§åˆ¶æ•°æ®åº“è¿æ¥æ•°é‡ä¸Šé™ï¼Œé˜²æ­¢è¿æ¥è¿‡å¤šé€ æˆæ•°æ®åº“å‡æ­» ç»Ÿä¸€è¿æ¥ç®¡ç†ï¼Œé¿å…è¿æ¥æ³„æ¼  è¿æ¥æ± çš„è¿æ¥æ•°é‡ä¸Šé™ä¸€å®šè¦æ ¹æ®å®é™…æƒ…å†µä»”ç»†é€‰å–ã€‚å¦‚æœè®¾ç½®å¾—è¿‡å¤§ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®åº“å› è¿æ¥è¿‡å¤šè€Œå‡æ­»æˆ–å´©æºƒï¼Œä»è€Œå½±å“æœåŠ¡çš„å¯ç”¨æ€§ã€‚å¦‚æœè®¾ç½®å¾—è¿‡å°ï¼Œåˆ™å¯èƒ½æ— æ³•è®©æ•°æ®åº“è¾¾åˆ°æœ€ä½³æ€§èƒ½ï¼Œé€ æˆèµ„æºæµªè´¹ã€‚\nORM æ¡†æ¶ ORM æ¡†æ¶çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ï¼šæ ¹æ®é…ç½®ï¼ˆä¸€èˆ¬æ˜¯é…ç½®æ–‡ä»¶æˆ–è€… Java æ³¨è§£ï¼‰å®ç°å¯¹è±¡æ¨¡å‹ï¼ˆJava ç¨‹åºï¼‰ä¸å…³ç³»æ¨¡å‹ï¼ˆæ•°æ®åº“ï¼‰ä¹‹é—´çš„æ˜ å°„ã€‚\nå¸¸è§çš„ ORM æ¡†æ¶ Hibernate Hibernate æ˜¯ä¸€ä¸ªè€ç‰Œçš„ ORM æ¡†æ¶ï¼Œåœ¨ Java ç”Ÿæ€ä¸­ä¹…è´Ÿç››åã€‚å®ƒæ”¯æŒå¤šç§å¼‚æ„æ•°æ®çš„æŒä¹…åŒ–ï¼Œæ”¯æŒå…¨æ–‡æœç´¢ï¼ˆHibernate Searchï¼‰å’Œæ•°æ®æ ¡éªŒï¼ˆvalidationï¼‰ï¼Œè¿˜æä¾›äº† NoSQL çš„è§£å†³æ–¹æ¡ˆï¼ˆHibernate OGMï¼‰ã€‚\nä½¿ç”¨ Hibernate ORM è¿›è¡Œ Java å¼€å‘æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ˜ å°„æ–‡ä»¶æˆ–æ³¨è§£å®šä¹‰ Java ç±»ä¸æ•°æ®åº“è¡¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œä½¿ç”¨åˆ°çš„æ˜ å°„å…³ç³»æ–‡ä»¶åç¼€ä¸º .hbm.xmlã€‚hbm.xml æ˜ å°„æ–‡ä»¶å°†æ•°æ®åº“è¡¨ä¸ Java å¯¹è±¡è¿›è¡Œå…³è”ï¼Œè®©æ•°æ®åº“è¡¨ä¸­çš„æ¯ä¸€è¡Œè®°å½•éƒ½å¯ä»¥è¢«è½¬æ¢ä¸ºä¸€ä¸ªå¯¹åº”çš„ Java å¯¹è±¡ã€‚è¿™æ ·ä¸€æ¥ï¼ŒJava å¼€å‘è€…åªéœ€è¦ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ€ç»´å°±å¯å®Œæˆæ•°æ®åº“çš„è®¾è®¡ã€‚\né™¤äº†å®Œæˆå¯¹è±¡æ¨¡å‹ä¸å…³ç³»æ¨¡å‹çš„åŒå‘æ˜ å°„å¤–ï¼ŒHibernate è¿˜å¯ä»¥å¸®åŠ©æˆ‘ä»¬å±è”½ä¸åŒæ•°æ®åº“ä¹‹é—´ SQL çš„å·®å¼‚ï¼ˆé€šè¿‡æ•°æ®åº“æ–¹è¨€å®ç°ï¼‰ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ Hibernate æä¾›çš„ API å°±å¯ä»¥å®Œæˆæ•°æ®åº“æ“ä½œï¼Œå¹¶ä¸éœ€è¦ç›´æ¥ç¼–å†™ SQL è¯­å¥ï¼Œå› ä¸º Hibernate å°è£…äº†æ•°æ®åº“å±‚é¢çš„å…¨éƒ¨æ“ä½œã€‚Hibernate æä¾›çš„ Criteria API æ˜¯ä¸€å¥—é¢å‘å¯¹è±¡çš„ APIï¼Œä½¿ç”¨å®ƒæ“ä½œæ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨è¿™å¥— API æœ¬èº«ä»¥åŠè¿”å›çš„ Java å¯¹è±¡ï¼Œå¹¶ä¸éœ€è¦è€ƒè™‘æ•°æ®åº“åº•å±‚å®ç°çš„å·®å¼‚ã€‚\né™¤äº† Criteria API ä¹‹å¤–ï¼ŒHibernate è¿˜æä¾›äº†ä¸€å¥—é¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€â€”â€”HQLï¼ˆHibernate Query Languageï¼‰ï¼Œå®ƒçš„è¯­å¥ç»“æ„ä¸ SQL è¯­å¥çš„ç»“æ„ååˆ†ç±»ä¼¼ï¼ŒäºŒè€…çš„æœ¬è´¨åŒºåˆ«åœ¨äºï¼šå‰è€…æ˜¯é¢å‘å¯¹è±¡çš„ï¼Œåè€…æ˜¯é¢å‘å…³ç³»å‹æ•°æ®åº“çš„ã€‚åœ¨ä½¿ç”¨ HQL æ—¶ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘åº•å±‚æ•°æ®åº“çš„å·®å¼‚ï¼ŒHibernate ä¼šè‡ªåŠ¨å°† HQL è½¬æ¢ä¸ºåˆæ³•çš„ SQL è¯­å¥ã€‚\nä¸ç®¡æ˜¯ Criteria APIï¼Œè¿˜æ˜¯ HQLï¼Œæœ€ç»ˆäºŒè€…éƒ½ä¼šè½¬åŒ–ä¸º SQLï¼Œç”±äº SQL æ˜¯ç”Ÿæˆå‡ºæ¥çš„ï¼Œæ‰€ä»¥å¤æ‚æƒ…å†µä¸‹ç”Ÿæˆçš„ SQL å¯èƒ½ä¼šéå¸¸éš¾äºç†è§£ã€‚\nHibernate é»˜è®¤æä¾›äº†ä¸€çº§ç¼“å­˜ï¼ˆé»˜è®¤å¼€å¯ï¼‰å’ŒäºŒçº§ç¼“å­˜ï¼ˆéœ€è¦é…ç½®å¼€å¯ï¼‰ï¼Œæ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œå¯ä»¥é¿å…æ— æ•ˆæŸ¥è¯¢ã€‚\nä¸è¿‡ï¼ŒHibernate æ— æ³•åœ¨é¢å‘å¯¹è±¡æ¨¡å‹ä¸­æ‰¾åˆ°æ•°æ®åº“ä¸­æ‰€æœ‰æ¦‚å¿µçš„æ˜ å°„ï¼Œä¾‹å¦‚ç´¢å¼•ã€å‡½æ•°ã€å­˜å‚¨è¿‡ç¨‹ç­‰ã€‚\nJPA JPAï¼ˆJava Persistence APIï¼‰ æ˜¯ JDK5.0 åæå‡ºçš„ Java æŒä¹…åŒ–è§„èŒƒï¼Œç›®çš„åœ¨äºæ•´åˆå¸‚é¢ä¸Šå·²æœ‰çš„ ORM æ¡†æ¶ã€‚JPA æœ¬èº«åªæ˜¯ä¸€ä¸ªè§„èŒƒï¼Œæ²¡æœ‰æä¾›å…·ä½“çš„å®ç°ï¼ŒHibernateã€OpenJPAã€EclipseLink ç­‰éƒ½æ˜¯ JPA è§„èŒƒçš„å…·ä½“å®ç°ã€‚JPA ç”±ä¸‰ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆï¼šORM æ˜ å°„å…ƒæ•°æ®ã€æ“ä½œå®ä½“å¯¹è±¡çš„ API å’Œé¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€ JPQLï¼Œä¸‰è€…çš„ä½œç”¨å’Œ Hibernate ä¸­çš„ hbm.xmlã€Criteria API å’Œ HQL éå¸¸ç±»ä¼¼ã€‚\nè™½ç„¶å¾ˆå¤š ORM æ¡†æ¶éƒ½å®ç°äº† JPA è§„èŒƒï¼Œä½†æ˜¯å®ƒä»¬å„è‡ªåœ¨ JPA çš„åŸºç¡€ä¸Šåˆæœ‰æ‰€ä¿®æ”¹ï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬åœ¨ä½¿ç”¨ JPA çš„æ—¶å€™ï¼Œæ— æ³•è¿›è¡Œåº•å±‚ ORM æ¡†æ¶çš„æ— ç¼åˆ‡æ¢ï¼Œä½†æ˜¯ Spring Data JPA å¯ä»¥å¸®æˆ‘ä»¬å®ç°æ— ç¼åˆ‡æ¢ã€‚\nMyBatis å¦ä¸€ä¸ªæµè¡Œçš„ ORM æ¡†æ¶æ˜¯ MyBatisï¼Œå®ƒçš„ä¸€ä¸ªé‡è¦åŠŸèƒ½æ˜¯å¸®åŠ© Java å¼€å‘è€…å°è£…é‡å¤æ€§çš„ JDBC ä»£ç â€”â€”é€šè¿‡ Mapper æ˜ å°„é…ç½®æ–‡ä»¶åŠç›¸å…³æ³¨è§£ï¼Œå°† ResultSet ç»“æœæ˜ å°„ä¸º Java å¯¹è±¡ã€‚å¾ˆå¤šäººå°† Hibernate ä¸ Mybatis è¿›è¡Œæ¯”è¾ƒï¼Œè®¤ä¸ºå‰è€…æ˜¯ä¸€ä¸ªå…¨è‡ªåŠ¨çš„ ORM æ¡†æ¶ï¼Œåè€…æ˜¯ä¸€ä¸ªåŠè‡ªåŠ¨çš„ ORM æ¡†æ¶ã€‚Mybatis å¹¶æ²¡æœ‰å®ç° JPAï¼Œä½†æ˜¯ç›¸å¯¹ Hibernate ä»¥åŠå„ç±» JPA æ¡†æ¶çš„å®ç°æ¥è¯´ï¼Œå®ƒæ›´åŠ çµæ´»ã€è½»é‡çº§å’Œå¯æ§ã€‚\næ­¤å¤–ï¼ŒMybatis è¿˜æä¾›äº†ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½â€”â€”åŠ¨æ€ SQLã€‚è¿™ä¸€ç‰¹æ€§å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°å¤„ç†å¯èƒ½åŠ¨æ€å˜åŒ–çš„å¤æ‚æŸ¥è¯¢æ¡ä»¶ï¼Œå‡å°‘å‡ºé”™ç‡ã€‚\nå®é™…å·¥ä½œä¸­å¯¹æŒä¹…å±‚æ¡†æ¶çš„é€‰æ‹© ä»æ€§èƒ½è§’åº¦æ¥çœ‹ï¼ŒHibernateã€Spring Data JPA å¯¹ SQL è¯­å¥çš„æŒæ¡ã€SQL æ‰‹å·¥è°ƒä¼˜ã€å¤šè¡¨è¿æ¥æŸ¥è¯¢ç­‰æ–¹é¢ä¸å¦‚ MyBatis ç›´æ¥ä½¿ç”¨åŸç”Ÿ SQL è¯­å¥é‚£ä¹ˆæ–¹ä¾¿ã€é«˜æ•ˆã€‚\nä»å¯ç§»æ¤æ€§è§’åº¦æ¥çœ‹ï¼ŒHibernate å¸®åŠ©æˆ‘ä»¬å±è”½äº†åº•å±‚æ•°æ®åº“æ–¹è¨€çš„å·®å¼‚ï¼ŒSpring Data JPA å¸®åŠ©æˆ‘ä»¬å±è”½äº† ORM çš„å·®å¼‚ï¼Œè€Œ MyBatis ç”±äºç›´æ¥æ‰‹å·¥ç¼–å†™åŸç”Ÿ SQLï¼Œä¼šä¸å…·ä½“çš„æ•°æ®åº“å®Œå…¨ç»‘å®šã€‚\nä»å¼€å‘æ•ˆç‡æ¥çœ‹ï¼ŒHibernateã€Spring Data JPA å¤„ç†ä¸­å°å‹é¡¹ç›®çš„æ•ˆç‡ç•¥é«˜äº MyBatisï¼Œä½†è¿™ä¸ªä¸»è¦è¦çœ‹éœ€æ±‚å’Œå¼€å‘è€…çš„æŠ€æœ¯æ ˆã€‚\nå‚è€ƒèµ„æ–™  Mybatis. Hibernate. JDBC 4.2 Specification. Spring Data JPA.  ","href":"/java/jdbc/jdbc/","title":"JDBC"},{"content":"","href":"/tags/mybatis/","title":"MyBatis"},{"content":"ä¹‹æ‰€ä»¥æ”¾åœ¨ Notebook ä¸­ï¼Œæ˜¯å› ä¸ºæœ¬æ–‡çš„ç»å¤§éƒ¨åˆ†å†…å®¹æ¥è‡ªæŸç½‘è¯¾ï¼Œåšç¬”è®°å¤‡å¿˜ï¼Œä¾¿äºä»¥åç¢°åˆ°ç›¸å…³é—®é¢˜æ›´å¿«åœ°å®šä½å’Œæ’æŸ¥é—®é¢˜ã€‚\nMyBatis ä¸‰å±‚æ¶æ„ MyBatis çš„æ•´ä½“æ¶æ„åˆ†ä¸ºä¸‰å±‚ï¼Œåˆ†åˆ«æ˜¯ï¼šåŸºç¡€æ”¯æ’‘å±‚ã€é€»è¾‘å¤„ç†å±‚ å’Œ æ¥å£å±‚ã€‚\nåŸºç¡€æ”¯æ’‘å±‚ åŸºç¡€æ”¯æ’‘å±‚ä¸ºæ•´ä¸ª MyBatis æ¡†æ¶æä¾›æœ€åŸºç¡€çš„åŠŸèƒ½ï¼Œåˆ†ä¸ºä¹ä¸ªåŸºç¡€æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—éƒ½å…·æœ‰å„è‡ªä¸åŒçš„èƒ½åŠ›ã€‚\nç±»å‹è½¬æ¢æ¨¡å—  åœ¨ä½¿ç”¨ JDBC æ“ä½œæ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬é¢ä¸´ç€ä¸‰ä¸ªä¸åŒå±‚æ¬¡çš„æ•°æ®ç±»å‹å·®å¼‚â€”â€”æ•°æ®åº“è‡ªå·±çš„æ•°æ®ç±»å‹ã€JDBC å®šä¹‰çš„æ•°æ®ç±»å‹å’Œ Java æ•°æ®ç±»å‹ã€‚JDBC åœ¨ä¸­é—´ï¼Œä½œä¸ºè§„èŒƒæ ‡å‡†ï¼Œå®ƒå¯ä»¥å±è”½åº•å±‚æ•°æ®çš„å·®å¼‚ï¼Œä½† JDBC ç±»å‹ä¸ Java ç±»å‹å¹¶ä¸æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œé€‚å½“çš„ç±»å‹è½¬æ¢ã€‚\n JDBC Spec 4.2 ä¸­å®šä¹‰äº† JDBC ç±»å‹åˆ° Java ç±»å‹çš„æ˜ å°„å…³ç³»ã€Java ç±»å‹åˆ° JDBC ç±»å‹çš„æ˜ å°„å…³ç³»ç­‰ç­‰ã€‚\nç±»å‹è½¬æ¢æ¨¡å—å®ç°äº† MyBatis ä¸­å®šä¹‰çš„ JDBC ç±»å‹ä¸ Java ç±»å‹ä¹‹é—´çš„ç›¸äº’è½¬æ¢ï¼š\n å½“ MyBatis åœ¨å°† SQL æ¨¡æ¿ä¸ç”¨æˆ·ä¼ å…¥çš„å‚æ•°ç›¸ç»‘å®šï¼ˆåœ¨æˆ‘ä»¬ä½¿ç”¨ PreparedStatement æ‰§è¡Œ SQL ä¹‹å‰ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ setInt()ã€setString() ç­‰æ–¹æ³•ç»‘å®šå‚æ•°ï¼‰æ—¶ï¼Œç±»å‹è½¬æ¢æ¨¡å—ä¼šå°† Java ç±»å‹æ•°æ®è½¬æ¢ä¸º JDBC ç±»å‹æ•°æ®ã€‚ å½“å–å¾—æŸ¥è¯¢ç»“æœåï¼Œç±»å‹è½¬æ¢æ¨¡å—ä¼šå°† ResultSet ä¸­çš„ JDBC ç±»å‹æ•°æ®è½¬æ¢ä¸º Java ç±»å‹æ•°æ®ã€‚  æ­¤å¤–ï¼Œç±»å‹è½¬æ¢æ¨¡å—è¿˜å®ç°äº†åˆ«åçš„åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ mybatis-config.xml é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ \u0026lt;typeAlias\u0026gt; æ ‡ç­¾ä¸º Java ç±»çš„å®Œæ•´åç§°å®šä¹‰ç›¸åº”çš„åˆ«åã€‚ç„¶ååœ¨åç»­ç¼–å†™ SQL è¯­å¥ã€å®šä¹‰ \u0026lt;resultMap\u0026gt; çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›åˆ«åæ›¿ä»£ç›¸åº”çš„ Java ç±»åï¼Œè¿™æ ·å°±éå¸¸æ˜“äºä»£ç çš„ç¼–å†™å’Œç»´æŠ¤ã€‚TypeAliasRegistry æ˜¯ç»´æŠ¤åˆ«åé…ç½®çš„æ ¸å¿ƒå®ç°ï¼Œå®ƒæä¾›äº†åˆ«åæ³¨å†Œã€åˆ«åæŸ¥è¯¢ç­‰åŸºæœ¬åŠŸèƒ½ã€‚\nTypeHandler MyBatis ä¸­çš„ç±»å‹è½¬æ¢æ¨¡å—åŒ…å«ä¼—å¤šç±»å‹è½¬æ¢å™¨ï¼Œè¿™äº›ç±»å‹è½¬æ¢å™¨éƒ½æœ‰ä¸€ä¸ªçˆ¶æ¥å£â€”â€”TypeHandlerã€‚æ•´ä¸ªè½¬æ¢å™¨çš„å±‚æ¬¡ç»“æ„å¦‚ä¸‹ï¼ˆä¸ºäº†ç®€å•ï¼Œå›¾ä¸­çœç•¥äº†ä¸å°‘ç±»å‹è½¬æ¢å™¨ï¼‰ï¼š\nå…¶ä¸­ï¼ŒBaseTypeHandler ä¸ä»…å®ç°äº†ä¸€äº› TypeHandler çš„å…¬å…±é€»è¾‘ï¼Œè¿˜å®ç°äº†æŠ½è±¡ç±» TypeReferenceã€‚\né™¤äº†è¿™äº›é»˜è®¤çš„ TypeHandler ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ mybatis-config.xml ä¸­ä½¿ç”¨æ ‡ç­¾é…ç½®è‡ªå®šä¹‰çš„ TypeHandler å®ç°ï¼Œä¹Ÿå¯ä»¥åœ¨å®šä¹‰ Mapper.xml çš„æ—¶å€™æŒ‡å®š typeHandler å±æ€§ã€‚ä¸ç®¡æ˜¯å“ªç§æ–¹å¼ï¼ŒMyBatis éƒ½ä¼šåœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œè·å–æ‰€æœ‰å·²çŸ¥çš„ TypeHandlerï¼Œåˆ›å»ºå¯¹åº”çš„å®ä¾‹å¹¶æ³¨å†Œåˆ° TypeHandlerRegistry ä¸­ï¼Œç”± TypeHandlerRegistry ç»Ÿä¸€ç®¡ç†æ‰€æœ‰çš„ TypeHandler å®ä¾‹ã€‚\næ—¥å¿—æ¨¡å— MyBatis æä¾›çš„æ—¥å¿—æ¨¡å—å¯ä»¥å¾ˆæ–¹ä¾¿åœ°é›†æˆå„ç§ç¬¬ä¸‰æ–¹ Java æ—¥å¿—æ¡†æ¶ï¼Œæ¯”å¦‚ Log4jã€Log4j2ã€slf4jã€java.util.logging ç­‰ã€‚ç”±äºè¿™äº›æ—¥å¿—æ¡†æ¶æ¥æºäºä¸åŒçš„å¼€æºç»„ç»‡ï¼Œç»™ç”¨æˆ·æš´éœ²çš„æ¥å£ä¹Ÿä¸å°½ç›¸åŒã€‚æ‰€ä»¥ MyBatis ä½¿ç”¨äº† é€‚é…å™¨æ¨¡å¼ï¼ˆè®¾è®¡æ¨¡å¼è¯»ä¹¦ç¬”è®°ä¹‹é€‚é…å™¨æ¨¡å¼ï¼‰å¯¹ç¬¬ä¸‰æ–¹æ—¥å¿—æ¡†æ¶æ¥å£è¿›è¡Œäº†ç»Ÿä¸€ã€‚\nMyBatis è‡ªå·±å®šä¹‰äº†ä¸€ä¸ª Log æ¥å£ï¼Œç„¶åä½¿ç”¨é€‚é…å™¨æ¨¡å¼é’ˆå¯¹ä¸åŒçš„æ—¥å¿—æ¡†æ¶è¿›è¡Œäº†é€‚é…ï¼Œå°†ç¬¬ä¸‰æ–¹æ—¥å¿—æ¡†æ¶çš„æ—¥å¿—æ¥å£è½¬åŒ–ä¸ºäº†å®ƒè‡ªå·±çš„ Log æ¥å£ï¼Œè¿™æ ·å°±æˆåŠŸé›†æˆäº†ç¬¬ä¸‰æ–¹æ—¥å¿—æ¡†æ¶çš„æ—¥å¿—æ‰“å°åŠŸèƒ½ã€‚\nLog æ¥å£åŠç›¸å…³é€‚é…å™¨å®ç°å‡ä½äº org.apache.ibatis.logging åŒ…ä¸­ã€‚æ•´ä½“ç»“æ„å¦‚ä¸‹ï¼š\nå…¶ä¸­ï¼ŒLoggFactory è´Ÿè´£åˆ›å»º Log å¯¹è±¡ï¼Œè¿™ä¸ªå·¥å‚ç±»ä¸­æœ‰ä¸€æ®µé™æ€ä»£ç å—ï¼Œä¼šä¾æ¬¡åŠ è½½å„ä¸ªç¬¬ä¸‰æ–¹æ—¥å¿—æ¡†æ¶çš„é€‚é…å™¨ã€‚\nBinding æ¨¡å— åœ¨ä½¿ç”¨ MyBatis æ—¶ï¼Œæˆ‘ä»¬æ— é¡»ç¼–å†™ Mapper æ¥å£çš„å…·ä½“å®ç°ï¼ŒBinding æ¨¡å—ä¼šè‡ªåŠ¨ç”Ÿæˆ Mapper æ¥å£çš„åŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡å¯ä»¥æ‰§è¡Œå…³è” Mapper.xml æ–‡ä»¶ï¼ˆæˆ– Mapper æ¥å£ä¸­çš„æ³¨è§£ï¼‰ä¸­çš„æ•°æ®åº“æ“ä½œã€‚Binding æ¨¡å—çš„æ ¸å¿ƒç±»å¦‚ä¸‹ï¼š\nMapperRegistryï¼ˆåœ¨ MyBatis åˆå§‹åŒ–è¿‡ç¨‹ä¸­æ„é€ ï¼‰ ä¸»è¦è´Ÿè´£ç»Ÿä¸€ç»´æŠ¤ Mapper æ¥å£ä»¥åŠè¿™äº› Mapper å¯¹åº”çš„ä»£ç†å¯¹è±¡å·¥å‚ MapperProxyFactoryã€‚MapperProxyFactory é€šè¿‡ JDK åŠ¨æ€ä»£ç†çš„æ–¹å¼åˆ›å»º Mapper æ¥å£çš„ä»£ç†å¯¹è±¡ MapperProxyï¼ŒMapperProxy å°è£…æ ¸å¿ƒä»£ç†é€»è¾‘ï¼Œå°†æ‹¦æˆªåˆ°çš„ç›®æ ‡æ–¹æ³•å§”æ‰˜ç»™ MapperMethod å¤„ç†ã€‚\nMapperProxy MapperProxy æ˜¯ç”Ÿæˆ Mapper æ¥å£ä»£ç†å¯¹è±¡çš„å…³é”®ï¼Œå®ƒå®ç°äº† InvocationHandler æ¥å£ã€‚Mapper ä»£ç†å¯¹è±¡çš„æ‰§è¡Œå…¥å£æ­£æ˜¯ MapperProxy çš„ invoke() æ–¹æ³•ã€‚è¯¥æ–¹æ³•å†…éƒ¨ä¼šé’ˆå¯¹æ‰€æœ‰çš„é Object æ–¹æ³•è°ƒç”¨ cachedInvoker() æ–¹æ³•è·å–å¯¹åº”çš„ MapperMethodInvoker å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶ invoke() æ–¹æ³•æ‰§è¡Œä»£ç†é€»è¾‘ä»¥åŠç›®æ ‡æ–¹æ³•ã€‚\nåœ¨ cachedInvoker() æ–¹æ³•ä¸­ï¼Œé¦–å…ˆä¼šæŸ¥è¯¢ methodCache ç¼“å­˜ï¼ˆç±»å‹ä¸º Map\u0026lt;Method, MapperMethodInvoker\u0026gt;ï¼‰ï¼Œå¦‚æœæŸ¥è¯¢çš„æ–¹æ³•ä¸º default æ–¹æ³•ï¼Œåˆ™ä¼šæ ¹æ®å½“å‰ä½¿ç”¨çš„ JDK ç‰ˆæœ¬ï¼Œè·å–å¯¹åº”çš„ MethodHandleï¼ˆç›¸å…³æ–‡æ¡£ï¼šMethodHandleï¼‰ å¹¶å°è£…æˆ DefaultMethodInvoker å¯¹è±¡å†™å…¥ç¼“å­˜å¤‡ç”¨ï¼›å¦‚æœæŸ¥è¯¢çš„æ–¹æ³•æ˜¯é default æ–¹æ³•ï¼Œåˆ™åˆ›å»º PlainMethodInvoker å¯¹è±¡å†™å…¥ç¼“å­˜å¤‡ç”¨ã€‚\nDefaultMethodInvoker ä¸ PlainMethodInvoker çš„å†…éƒ¨å®ç°ç¨æœ‰ä¸åŒï¼Œå‰è€…é€šè¿‡ MethodHandle å®Œæˆè°ƒç”¨ï¼Œè€Œåè€…é€šè¿‡ MapperMethod å®Œæˆè°ƒç”¨ã€‚\nMapperMethod MapperMethod è®°å½•äº† Mapper æ¥å£ä¸­çš„å¯¹åº”æ–¹æ³•ï¼Œä¹Ÿæ˜¯æœ€ç»ˆæ‰§è¡Œ SQL è¯­å¥çš„åœ°æ–¹ï¼ˆexecute()æ–¹æ³•ï¼‰ï¼Œexecute() æ–¹æ³•ä¼šæ ¹æ®è¦æ‰§è¡Œçš„ SQL è¯­å¥çš„å…·ä½“ç±»å‹æ‰§è¡Œ SqlSession çš„ç›¸åº”æ–¹æ³•å®Œæˆæ•°æ®åº“æ“ä½œã€‚\nåœ¨ MapperMethod ä¸­ï¼Œcommand å­—æ®µï¼ˆSqlCommand ç±»å‹ï¼Œå®ƒæ˜¯ MapperMethod çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼‰ç»´æŠ¤äº†å…³è” SQL è¯­å¥çš„ç›¸å…³ä¿¡æ¯ã€‚å…ˆç®€å•çœ‹ä¸€ä¸‹ SqlCommand ç±»ï¼š\npublic static class SqlCommand { private final String name; // å…³è” SQL è¯­å¥çš„å”¯ä¸€æ ‡è¯†  private final SqlCommandType type; // å…³è” SQL è¯­å¥çš„æ“ä½œç±»å‹  // ... } MyBatis ä¸­çš„ SQL è¯­å¥æœ‰äº”ç§ä¸åŒçš„æ“ä½œç±»å‹ï¼š\npublic enum SqlCommandType { UNKNOWN, INSERT, UPDATE, DELETE, SELECT, FLUSH } MapperMethod ä¸­çš„ method å­—æ®µï¼ˆMethodSignature ç±»å‹ï¼‰åˆ™æ˜¯ç»´æŠ¤äº† Mapper æ¥å£ä¸­æ–¹æ³•çš„ç›¸å…³ä¿¡æ¯ã€‚å®ƒä¾èµ– ParamNameResolver è¿™ä¸ªè§£ææ–¹æ³•å‚æ•°åˆ—è¡¨çš„å·¥å…·ç±»ã€‚è¿™é‡Œæœ‰å¿…è¦å•ç‹¬è¯´ä¸€ä¸‹è¿™ä¸ªå·¥å…·ç±»ã€‚\nParamNameResolver ä¸­æœ‰ä¸€ä¸ª name å­—æ®µè®°å½•äº†å„ä¸ªå‚æ•°å‚æ•°åœ¨å‚æ•°åˆ—è¡¨ä¸­çš„ä½ç½®ä»¥åŠå‚æ•°åç§°ï¼Œå…¶ä¸­ key æ˜¯å‚æ•°åœ¨å‚æ•°åˆ—è¡¨ä¸­çš„ä½ç½®ç´¢å¼•ï¼Œ value ä¸ºå‚æ•°çš„åç§°ã€‚\nprivate final SortedMap\u0026lt;Integer, String\u0026gt; names; æˆ‘ä»¬å¯ä»¥é€šè¿‡ @Param æ³¨è§£æŒ‡å®šä¸€ä¸ªå‚æ•°åç§°ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™é»˜è®¤ä½¿ç”¨å‚æ•°åˆ—è¡¨ä¸­çš„å˜é‡åç§°ä½œä¸ºå…¶åç§°ï¼Œè¿™ä¸ ParamNameResolver çš„ useActualParamName æœ‰å…³ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¨å±€é…ç½®ã€‚å¦‚æœå°†å…¶é…ç½®ä¸º falseï¼Œåˆ™ä½¿ç”¨å‚æ•°çš„ä¸‹æ ‡ç´¢å¼•ä½œä¸ºå…¶åç§°ã€‚æ­¤å¤–ï¼Œnames é›†åˆä¼šè·³è¿‡ç±»å‹ä¸º RowBounds å’Œ ResultHandler ç±»å‹çš„å‚æ•°ï¼Œå¦‚æœä½¿ç”¨ä¸‹æ ‡ä½œä¸ºç´¢å¼•ä½œä¸ºå‚æ•°åç§°çš„è¯ï¼Œè¿™æ—¶å°±ä¼šåœ¨ names é›†åˆä¸­å‡ºç° KV ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼š\naMethod(@Param(\u0026#34;M\u0026#34;) int a, @Param(\u0026#34;N\u0026#34;) int b) -\u0026gt; {{0, \u0026#34;M\u0026#34;}, {1, \u0026#34;N\u0026#34;}} aMethod(int a, int b) -\u0026gt; {{0, \u0026#34;0\u0026#34;}, {1, \u0026#34;1\u0026#34;}} aMethod(int a, RowBounds rb, int b) -\u0026gt; {{0, \u0026#34;0\u0026#34;}, {2, \u0026#34;1\u0026#34;}} èµ„æºåŠ è½½æ¨¡å— èµ„æºåŠ è½½æ¨¡å—ä¸»è¦æ˜¯å¯¹ç±»åŠ è½½å™¨è¿›è¡Œå°è£…ï¼Œç¡®å®šç±»åŠ è½½å™¨çš„ä½¿ç”¨é¡ºåºï¼Œå¹¶æä¾›äº†åŠ è½½ç±»æ–‡ä»¶ä»¥åŠå…¶ä»–èµ„æºæ–‡ä»¶çš„åŠŸèƒ½ã€‚\næ•°æ®æºæ¨¡å— æ•°æ®æºæ˜¯æŒä¹…å±‚æ¡†æ¶ä¸­æœ€æ ¸å¿ƒçš„ç»„ä»¶ä¹‹ä¸€ï¼ŒMyBatis ä¸ä»…æä¾›äº†ä¸€å¥—é»˜è®¤çš„æ•°æ®æºå®ç°ï¼Œè¿˜èƒ½å¤Ÿå¾ˆæ–¹ä¾¿åœ°é›†æˆç¬¬ä¸‰æ–¹æ•°æ®æºã€‚åœ¨ Java ä¸­ï¼Œæ•°æ®æºè¿™ä¸ªæŠ½è±¡ç”± javax.sql.DataSource æ¥å£è¡¨ç¤ºï¼ŒMyBatis è‡ªå¸¦çš„æ•°æ®æºå®ç°å°±å®ç°äº†è¯¥æ¥å£ã€‚MyBatis é»˜è®¤å®ç°äº†ä¸¤ç§ç±»å‹çš„æ•°æ®æºâ€”â€”UnpooledDataSource å’Œ PooledDataSourceã€‚\næ­¤å¤–ï¼Œå¯¹äºè¿™ä¸¤ç§ä¸åŒçš„æ•°æ®æºå®ç°ï¼ŒMyBatis è¿˜ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆè®¾è®¡æ¨¡å¼è¯»ä¹¦ç¬”è®°ä¹‹å·¥å‚æ–¹æ³•æ¨¡å¼ï¼‰æä¾›äº†ç›¸åº”çš„å·¥å‚ç±»ï¼š\nä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼çš„å¥½å¤„åœ¨äºï¼Œå¦‚æœéœ€è¦æ‰©å±•æ–°çš„æ•°æ®æºï¼Œåªéœ€è¦æ·»åŠ ç›¸åº”çš„ DataSourceFactory æ¥å£å®ç°ç±»å³å¯ã€‚è¿™é‡Œçš„ DataSource å³å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­çš„ Productã€‚DataSourceFactory å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼šsetProperties() ç”¨äºé…ç½®æ•°æ®æºå±æ€§ï¼ŒgetDataSource() ç”¨äºè¿”å›æ•°æ®æºå¯¹è±¡ã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒPooledDataSourceFactory å¹¶æ²¡æœ‰ç›´æ¥å®ç° DatasourceFactory æ¥å£ï¼Œè€Œæ˜¯ç›´æ¥ç»§æ‰¿äº† UnpooledDataSourceFactory ç±»ã€‚\nç¼“å­˜ç®¡ç†æ¨¡å— ç¼“å­˜æ˜¯ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½çš„å¸¸ç”¨æ‰‹æ®µä¹‹ä¸€ï¼Œæ­£ç¡®ä½¿ç”¨ç¼“å­˜å¯ä»¥å°†ä¸€éƒ¨åˆ†æ•°æ®åº“è¯·æ±‚æ‹¦æˆªåœ¨ç¼“å­˜å±‚ï¼Œå‡å°‘æ•°æ®åº“çš„å‹åŠ›ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚\nMyBatis å°±æä¾›äº†è®¸å¤šä¸åŒç­–ç•¥çš„ç¼“å­˜ï¼Œè¿™äº›ç¼“å­˜åˆ†ä¸ºä¸¤ä¸ªçº§åˆ«ï¼šä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Œå®ƒä»¬éƒ½å®ç°äº† Cache æ¥å£ã€‚\nCache æ¥å£å®šä¹‰äº† MyBatis ç¼“å­˜æœ€åŸºæœ¬ã€æœ€æ ¸å¿ƒçš„è¡Œä¸ºï¼Œå…¶ä¸­çš„æ ¸å¿ƒæ–¹æ³•ä¸»è¦æ˜¯ putObject()ã€getObject() å’Œ removeObject()ï¼Œåˆ†åˆ«ç”¨æ¥æ·»åŠ ã€æŸ¥è¯¢å’Œåˆ é™¤ç¼“å­˜æ•°æ®ã€‚MyBatis åœ¨å®ç°ç¼“å­˜æ¨¡å—æ—¶é‡‡ç”¨äº†è£…é¥°å™¨æ¨¡å¼ï¼ˆè®¾è®¡æ¨¡å¼è¯»ä¹¦ç¬”è®°ä¹‹è£…é¥°å™¨æ¨¡å¼ï¼‰ï¼Œå…¶ä¸­ PerpetualCache æ‰®æ¼”çš„æ­£æ˜¯è£…é¥°å™¨æ¨¡å¼ä¸­çš„ ConcretComponent çš„è§’è‰²ï¼Œå®ƒå®ç°äº† Cache æ¥å£ç¼“å­˜çš„åŸºæœ¬èƒ½åŠ›ã€‚é™¤ PerpetualCache ä»¥å¤–çš„å…¶å®ƒ Cache æ¥å£å®ç°éƒ½æ˜¯è£…é¥°å™¨ï¼Œæ‰®æ¼”çš„æ˜¯è£…é¥°å™¨æ¨¡å¼ä¸­çš„ ConcreteDecorator çš„è§’è‰²ï¼Œä¸åŒè£…é¥°å™¨æä¾›äº†ä¸åŒçš„åŠŸèƒ½æ‰©å±•ã€‚\nä¾‹å¦‚ï¼ŒBlockingCache åœ¨åŸæœ‰ç¼“å­˜å®ç°ä¹‹ä¸Šæ·»åŠ äº†é˜»å¡çº¿ç¨‹çš„ç‰¹æ€§ï¼ŒFifoCache æ·»åŠ äº†å…ˆè¿›å…ˆå‡ºçš„ç‰¹æ€§ï¼ŒLruCache æ·»åŠ äº†æœ€è¿‘æœ€å°‘é€‚ç”¨çš„æ·˜æ±°æœºåˆ¶ç­‰ç­‰ã€‚\nè§£æå™¨æ¨¡å— MyBatis ä¸­éœ€è¦è§£æçš„é…ç½®æ–‡ä»¶åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸€ä¸ªæ˜¯ mybatis-config.xml é…ç½®æ–‡ä»¶ï¼Œå¦ä¸€ä¸ªæ˜¯ Mapper.xml é…ç½®æ–‡ä»¶ã€‚è¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½æ˜¯ç”± MyBatis çš„è§£æå™¨æ¨¡å—è¿›è¡Œè§£æçš„ï¼Œå…¶ä¸­ä¸»è¦æ˜¯ä¾èµ– XPath å®ç° XML é…ç½®æ–‡ä»¶ä»¥åŠå„ç±»è¡¨è¾¾å¼çš„é«˜æ•ˆè§£æã€‚\näº‹åŠ¡ç®¡ç†æ¨¡å— MyBatis å¯¹æ•°æ®åº“ä¸­çš„äº‹åŠ¡è¿›è¡Œäº†ä¸€å±‚ç®€å•çš„æŠ½è±¡ï¼Œæä¾›äº†ç®€å•æ˜“ç”¨çš„äº‹åŠ¡æ¥å£å’Œå®ç°ã€‚åœ¨ MyBatis ä¸­ï¼Œæ•°æ®åº“äº‹åŠ¡è¢«æŠ½è±¡ä¸º Transaction æ¥å£ï¼Œå®ƒå®šä¹‰äº†æäº¤äº‹åŠ¡ã€å›æ»šäº‹åŠ¡ä»¥åŠè·å–åº•å±‚æ•°æ®åº“è¿æ¥çš„æ–¹æ³•ã€‚TransactionFactory åˆ™æ˜¯ç”¨äºåˆ›å»º Transaction å¯¹è±¡çš„å·¥å‚æ¥å£ã€‚\nåå°„å·¥å…·æ¨¡å— MyBatis åœ¨ Java åå°„çš„åŸºç¡€ä¸Šè¿›è¡Œäº†å°è£…ï¼Œä¸ºä¸Šå±‚ä½¿ç”¨æ–¹æä¾›äº†æ›´åŠ çµæ´»ã€æ–¹ä¾¿çš„ API æ¥å£ã€‚åå°„å·¥å…·ç®±çš„å…·ä½“ä»£ç ä½äº org.apache.ibatis.reflection åŒ…ä¸­ã€‚Reflector æ˜¯æ•´ä¸ªæ¨¡å—çš„åŸºç¡€ï¼Œåœ¨ä½¿ç”¨åå°„æ¨¡å—æ“ä½œä¸€ä¸ª Class ä¹‹å‰ï¼ŒMyBatis ä¼šå°† Class å°è£…æˆä¸€ä¸ª Reflectorï¼Œä¸ºäº†æé«˜åå°„æ‰§è¡Œçš„æ•ˆç‡ï¼ŒReflector ä¸­ç¼“å­˜äº† Class çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚\nReflector å°†ç±»çš„å±æ€§ä¸æ–¹æ³•ç­‰ä¿¡æ¯è®°å½•åœ¨è‡ªå·±çš„æ ¸å¿ƒå­—æ®µä¸­ï¼Œå®ƒçš„æ ¸å¿ƒå­—æ®µå¦‚ä¸‹æ‰€ç¤ºï¼š\nReflector çš„æ„é€ å‡½æ•°ä»¥ Class ä¸ºå‚æ•°ï¼Œåœ¨æ„é€ æ–¹æ³•å†…éƒ¨ä¼šè§£æä¼ å…¥çš„ Class å¯¹è±¡ï¼Œå¡«å……ä»¥ä¸Šå­—æ®µã€‚\nåŒæ ·ï¼Œä¸ºäº†æé«˜ Reflector çš„åˆå§‹åŒ–é€Ÿåº¦ï¼ŒMyBatis æä¾›äº† ReflectorFactory å·¥å‚æ¥å£ã€‚è¯¥æ¥å£çš„é»˜è®¤å®ç° DefaultReflectorFactory åœ¨å†…å­˜ä¸­é€šè¿‡ ConcurrentHashMap\u0026lt;Class\u0026lt;?\u0026gt;, Reflector\u0026gt;ï¼ˆå³ reflectorMapï¼‰å¯¹ Reflector å¯¹è±¡è¿›è¡Œäº†ç¼“å­˜ï¼Œè¯¥æ¥å£çš„æ ¸å¿ƒæ–¹æ³• findForClass(Class\u0026lt;?\u0026gt; type) å°±ä¼šæ ¹æ®ä¼ å…¥ Class æŸ¥æ‰¾ reflectorMap ç¼“å­˜ï¼Œè‹¥æŸ¥æ‰¾æˆåŠŸï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™åˆ›å»ºç›¸åº”çš„ Reflector å¯¹è±¡å¹¶æ”¾å…¥ç¼“å­˜ï¼Œä»¥ä¾¿ä¸‹æ¬¡ä½¿ç”¨ã€‚\nObjectFactory æ˜¯ MyBatis ä¸­çš„å¯¹è±¡åå°„å·¥å‚æ¥å£ï¼Œå®ƒæä¾›äº†ä¸¤ä¸ªä¸åŒçš„ create æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥åˆ›å»ºæŒ‡å®šç±»å‹çš„å¯¹è±¡ã€‚DefaultObjectFactory æ˜¯æ­¤æ¥å£çš„é»˜è®¤å®ç°ï¼Œåº•å±‚ä¼šåˆ©ç”¨åå°„æ ¹æ®å…¥å‚åˆ—è¡¨é€‰æ‹©åˆé€‚çš„æ„é€ å‡½æ•°å®ä¾‹åŒ–å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ mybatis-config.xml ä¸­é…ç½®è‡ªå®šä¹‰çš„ ObjectFactory æ¥å£çš„æ‰©å±•å®ç°ç±»ï¼Œè¾¾åˆ°è‡ªå®šä¹‰åŠŸèƒ½æ‰©å±•çš„ç›®çš„ã€‚\nåå°„æ¨¡å—å†…è¿˜æä¾›äº†å‡ ä¸ªç”¨äºè§£æå±æ€§çš„å·¥å…·ç±»ï¼š\n PropertyTokenizerï¼šè´Ÿè´£è§£æç”± . å’Œ [] æ„æˆçš„è¡¨è¾¾å¼ï¼Œæ”¯æŒå¯¹åµŒå¥—å¤šå±‚è¡¨è¾¾å¼çš„å¤„ç† PropertyCopier ç”¨äºå±æ€§æ‹·è´ PropertyNamer å¯ä»¥å°†æ–¹æ³•åè½¬æ¢ä¸ºå±æ€§åï¼Œäº¦èƒ½æ£€æµ‹ä¸€ä¸ªæ–¹æ³•æ˜¯å¦ä¸º setter æˆ– getter æ–¹æ³•  æ­¤å¤–ï¼Œåå°„æ¨¡å—è¿˜æœ‰ MetaClassï¼Œå®ƒå°è£…äº† Class çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œä»¥åŠ ObjectWrapperï¼Œå®ƒå°è£…äº†å¯¹è±¡çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚\næ ¸å¿ƒå¤„ç†å±‚ MyBatis çš„æ ¸å¿ƒå®ç°ï¼Œæ¶‰åŠ MyBatis çš„åˆå§‹åŒ–ä»¥åŠæ‰§è¡Œä¸€æ¡ SQL è¯­å¥çš„å…¨æµç¨‹ã€‚\né…ç½®è§£æ MyBatis ä¸­æœ‰ä¸‰å¤„å¯ä»¥æ·»åŠ é…ç½®ä¿¡æ¯çš„åœ°æ–¹ï¼šmybatis-config.xml é…ç½®æ–‡ä»¶ã€Mapper.xml é…ç½®æ–‡ä»¶ï¼Œä»¥åŠ Mapper æ¥å£ä¸­çš„æ³¨è§£ä¿¡æ¯ã€‚MyBatis ä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™åŠ è½½è¿™äº›é…ç½®ä¿¡æ¯ï¼Œå¹¶åœ¨è§£æå®Œæˆä¹‹åï¼Œå°†è§£æå¾—åˆ°çš„é…ç½®åˆ°å¯¹è±¡ä¿å­˜åˆ° Configuration å¯¹è±¡ä¸­ã€‚\né…ç½®è§£æè¿‡ç¨‹ä¸­ç”¨åˆ°äº†è®¾è®¡æ¨¡å¼ä¸­çš„å»ºé€ è€…æ¨¡å¼ï¼ˆè®¾è®¡æ¨¡å¼è¯»ä¹¦ç¬”è®°ä¹‹å»ºé€ è€…æ¨¡å¼ï¼‰ã€‚\nmybatis-config.xml è§£æ MyBatis åˆå§‹åŒ–çš„ç¬¬ä¸€ä¸ªæ­¥éª¤å°±æ˜¯åŠ è½½å’Œè§£æ mybatis-config.xml è¿™ä¸ªå…¨å±€é…ç½®æ–‡ä»¶ã€‚å…¥å£ä½äº XMLConfigBuilder è¿™ä¸ª Builder å¯¹è±¡ï¼Œå®ƒç”± SqlSessionFactoryBuilder.build() æ–¹æ³•åˆ›å»ºã€‚\nXMLConfigBuilder ä¼šå°† mybatis-config.xml è§£æä¸ºå¯¹åº”çš„ Configuration å…¨å±€é…ç½®å¯¹è±¡ï¼Œç„¶å SqlSessionFactoryBuilder ä¼šæ ¹æ®å¾—åˆ°çš„ Configuration å¯¹è±¡åˆ›å»ºä¸€ä¸ª DefaultSqlSessionFactory ä¾›ä¸Šå±‚ä½¿ç”¨ã€‚\nXMLConfigBuiler ç»§æ‰¿è‡ª BaseBuilder æŠ½è±¡ç±»ï¼Œè¯¥ç±»çš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š\nBaseBuilder æä¾›äº†ä¸‰æ–¹é¢çš„èƒ½åŠ›ï¼š\n å…³è” Configuration å¯¹è±¡ è§£æåˆ«å è§£æ TypeHandler  mybatis-config.xml æ–‡ä»¶çš„è§£ææ˜¯ç”± XMLConfigBuilder.parse() æ–¹æ³•è§¦å‘çš„ï¼Œå…¶ä¸­çš„ parseConfiguration() æ–¹æ³•å®šä¹‰äº†è§£æ mybatis-config.xml çš„å®Œæ•´æµç¨‹ã€‚å…¶æ ¸å¿ƒæ­¥éª¤å¦‚ä¸‹ï¼š\nMapper.xml è§£æ mybatis-config.xml ä¸­å¯ä»¥å®šä¹‰å¤šä¸ª \u0026lt;mapper\u0026gt; æ ‡ç­¾ï¼ŒæŒ‡å®š Mapper é…ç½®æ–‡ä»¶çš„ä½ç½®ã€‚MyBatis ä¼šä¸ºæ¯ä¸ª Mapepr.xml æ˜ å°„æ–‡ä»¶éƒ½åˆ›å»ºä¸€ä¸ª XMLMapperBuilder å®ä¾‹ï¼Œä»è€Œå®Œæˆç›¸å…³è§£æå·¥ä½œã€‚\nSQL è§£æä¸ scripting æ¨¡å— åŠ¨æ€ SQL æ˜¯ MyBatis æœ€å¤§çš„äº®ç‚¹ï¼Œè¿™ä¸ªæ¨¡å—è´Ÿè´£åŠ¨æ€ç”Ÿæˆ SQLã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä¼šæ ¹æ®è¿è¡Œæ—¶ç”¨æˆ·ä¼ å…¥çš„å®å‚è§£æåŠ¨æ€ SQL ä¸­çš„æ ‡ç­¾ï¼Œå¹¶å½¢æˆ SQL æ¨¡æ¿ï¼Œç„¶åå¤„ç† SQL æ¨¡æ¿ä¸­çš„å ä½ç¬¦ï¼Œç”¨å®å‚å¡«å……å ä½ç¬¦ï¼Œå¾—åˆ°çœŸæ­£å¯æ‰§è¡Œçš„ SQL è¯­å¥ã€‚\nscripting æ¨¡å—æ˜¯ MyBatis ä¸­åŠ¨æ€ç”Ÿæˆ SQL çš„æ ¸å¿ƒæ¨¡å—ï¼Œå®ƒä¼šæ ¹æ®ç”¨æˆ·ä¼ å…¥çš„å®å‚è§£æåŠ¨æ€ SQL ä¸­çš„æ ‡ç­¾ï¼Œå½¢æˆ SQL æ¨¡æ¿ï¼Œç„¶åç”¨è¿è¡Œæ—¶çš„å®å‚å¡«å……æ¨¡æ¿ä¸­çš„å ä½ç¬¦ï¼Œå¾—åˆ°çœŸæ­£å¯ä»¥åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œçš„ SQL è¯­å¥ã€‚\nDynamicContext MyBatis è§£æä¸€æ¡åŠ¨æ€ SQL è¯­å¥çš„æ•´ä¸ªæµç¨‹å¯èƒ½ä¼šéå¸¸é•¿ï¼Œå…¶ä¸­æ¶‰åŠå¤šå±‚æ–¹æ³•çš„è°ƒç”¨ã€æ–¹æ³•çš„é€’å½’ã€å¤æ‚çš„å¾ªç¯ç­‰ï¼Œå…¶ä¸­äº§ç”Ÿçš„ä¸­é—´ç»“æœéœ€è¦æœ‰ä¸€ä¸ªåœ°æ–¹è¿›è¡Œå­˜å‚¨ï¼Œé‚£å°±æ˜¯ DynamicContext ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚\nDynamicContext æœ‰ä¸¤ä¸ªæ ¸å¿ƒå±æ€§ï¼šä¸€ä¸ªæ˜¯ sqlBuilder å­—æ®µï¼ˆStringJoiner ç±»å‹ï¼‰ï¼Œç”¨æ¥è®°å½•è§£æä¹‹åçš„ SQL è¯­å¥ï¼›å¦ä¸€ä¸ªæ˜¯ bindings å­—æ®µï¼ˆContextMap ç±»å‹ï¼‰ï¼Œç”¨æ¥è®°å½•ä¸Šä¸‹æ–‡ä¸­çš„ä¸€äº› KV ä¿¡æ¯ã€‚ContextMap æ˜¯ DynamicContext å®šä¹‰çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œç”¨æ¥è®°å½•è¿è¡Œæ—¶ç”¨æˆ·ä¼ å…¥çš„ã€ç”¨æ¥æ›¿æ¢â€œ#{}â€å ä½ç¬¦çš„å®å‚ã€‚\nSqlNode MyBatis åœ¨å¤„ç†åŠ¨æ€ SQL è¯­å¥çš„æ—¶å€™ï¼Œä¼šå°†åŠ¨æ€ SQL æ ‡ç­¾è§£æä¸º SqlNode å¯¹è±¡ï¼Œå¤šä¸ª SqlNode å¯¹è±¡é€šè¿‡ç»„åˆæ¨¡å¼ï¼ˆè®¾è®¡æ¨¡å¼è¯»ä¹¦ç¬”è®°ä¹‹ç»„åˆæ¨¡å¼ï¼‰ç»„æˆæ ‘å½¢ç»“æ„ä¾›ä¸Šå±‚ä½¿ç”¨ã€‚SqlNode æ¥å£å……å½“çš„å°±æ˜¯ç»„åˆæ¨¡å¼ä¸­çš„ Component çš„è§’è‰²ï¼Œå®ƒçš„å®ç°ç±»éå¸¸å¤šï¼Œå¾ˆå¤šéƒ½å¯¹åº”ç€ä¸€ä¸ªåŠ¨æ€ SQL æ ‡ç­¾ï¼ˆç»„åˆæ¨¡å¼ä¸­çš„ Leaf è§’è‰²ï¼‰ï¼Œå°‘æ•°å®ç°ç±»æ‰®æ¼”ç€ç»„åˆæ¨¡å¼ä¸­çš„ Composite è§’è‰²ï¼ˆæ¯”å¦‚ MixedSqlNodeï¼‰ã€‚\n StaticTextSqlNodeç”¨äºè¡¨ç¤ºéåŠ¨æ€çš„ SQL ç‰‡æ®µï¼Œå…¶ä¸­ç»´æŠ¤äº†ä¸€ä¸ª text å­—æ®µï¼ˆString ç±»å‹ï¼‰ï¼Œç”¨äºè®°å½•éåŠ¨æ€ SQL ç‰‡æ®µçš„æ–‡æœ¬å†…å®¹ã€‚ MixedSqlNode åœ¨æ•´ä¸ª SqlNode æ ‘ä¸­å……å½“äº†æ ‘æèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ‰®æ¼”äº†ç»„åˆæ¨¡å¼ä¸­ Composite çš„è§’è‰²ï¼Œå…¶ä¸­ç»´æŠ¤çš„ List\u0026lt;SqlNode\u0026gt; é›†åˆäº†è®°å½• MixedSqlNode ä¸‹æ‰€æœ‰çš„å­ SqlNode å¯¹è±¡ã€‚ TextSqlNode æŠ½è±¡äº†åŒ…å« â€œ${}â€å ä½ç¬¦çš„åŠ¨æ€ SQL ç‰‡æ®µï¼Œå®ƒé€šè¿‡ä¸€ä¸ª text å­—æ®µï¼ˆString ç±»å‹ï¼‰æ¥è®°å½•åŒ…å«â€œ${}â€å ä½ç¬¦çš„ SQL æ–‡æœ¬å†…å®¹ã€‚ IfSqlNode å¯¹åº”äº†åŠ¨æ€ SQL è¯­å¥ä¸­çš„ \u0026lt;if\u0026gt; æ ‡ç­¾ï¼ŒMyBatis çš„ æ ‡ç­¾çš„ test å±æ€§å¯ä»¥æŒ‡å®šä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå½“è¡¨è¾¾å¼æˆç«‹æ—¶ï¼Œ\u0026lt;if\u0026gt; æ ‡ç­¾å†…çš„ SQL ç‰‡æ®µæ‰ä¼šå‡ºç°åœ¨å®Œæ•´çš„ SQL è¯­å¥ä¸­ã€‚ TrimSqlNode å¯¹åº” MyBatis åŠ¨æ€ SQL è¯­å¥ä¸­çš„ \u0026lt;trim\u0026gt; æ ‡ç­¾ã€‚åœ¨ä½¿ç”¨ \u0026lt;trim\u0026gt; æ ‡ç­¾çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®š prefix å’Œ suffix å±æ€§æ·»åŠ å‰ç¼€å’Œåç¼€ï¼Œä¹Ÿå¯ä»¥æŒ‡å®š prefixesToOverrides å’Œ suffixesToOverrides å±æ€§æ¥åˆ é™¤å¤šä¸ªå‰ç¼€å’Œåç¼€ï¼ˆä½¿ç”¨â€œ|â€åˆ†å‰²ä¸åŒå­—ç¬¦ä¸²ï¼‰ã€‚ ForeachSqlNode å¯¹åº” MyBatis åŠ¨æ€ SQL è¯­å¥ä¸­çš„ \u0026lt;foreach\u0026gt; æ ‡ç­¾ã€‚æˆ‘ä»¬å¯ä»¥åœ¨åŠ¨æ€ SQL è¯­å¥ä¸­ä½¿ç”¨ \u0026lt;foreach\u0026gt; æ ‡ç­¾å¯¹ä¸€ä¸ªé›†åˆè¿›è¡Œè¿­ä»£ã€‚åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥é€šè¿‡ index å±æ€§å€¼æŒ‡å®šçš„å˜é‡ä½œä¸ºå…ƒç´ çš„ä¸‹æ ‡ç´¢å¼•ï¼ˆè¿­ä»£ Map é›†åˆçš„è¯ï¼Œå°±æ˜¯ Key å€¼ï¼‰ï¼Œä½¿ç”¨ item å±æ€§å€¼æŒ‡å®šçš„å˜é‡ä½œä¸ºé›†åˆå…ƒç´ ï¼ˆè¿­ä»£ Map é›†åˆçš„è¯ï¼Œå°±æ˜¯ Value å€¼ï¼‰ã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ open å’Œ close å±æ€§åœ¨è¿­ä»£å¼€å§‹å‰å’Œç»“æŸåæ·»åŠ ç›¸åº”çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ separator å±æ€§è‡ªå®šä¹‰åˆ†éš”ç¬¦ã€‚ ChooseSqlNode å¯¹åº” MyBatis åŠ¨æ€ SQL è¯­å¥ä¸­çš„ \u0026lt;choose\u0026gt; æ ‡ç­¾ã€‚å…¶å†…éƒ¨çš„\u0026lt;when\u0026gt; æ ‡ç­¾ä¼šè¢«è§£ææˆ IfSqlNode å¯¹è±¡ï¼Œ\u0026lt;otherwise\u0026gt; æ ‡ç­¾ä¼šè¢«è§£ææˆ MixedSqlNode å¯¹è±¡ã€‚ VarDeclSqlNode æŠ½è±¡äº† \u0026lt;bind\u0026gt; æ ‡ç­¾ï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†ä¸€ä¸ª OGNL è¡¨è¾¾å¼çš„å€¼ç»‘å®šåˆ°ä¸€ä¸ªæŒ‡å®šçš„å˜é‡åä¸Šï¼Œå¹¶è®°å½•åˆ° DynamicContext ä¸­ã€‚  SqlSourceBuilder åŠ¨æ€ SQL è¯­å¥åœ¨è¢«è§£ææˆ SqlNode å¯¹è±¡åï¼Œä¼šç»ç”± SqlSourceBuilder è¿›ä¸€æ­¥å¤„ç†ã€‚SqlSourceBuilder çš„æ ¸å¿ƒæ“ä½œä¸»è¦æœ‰ä¸¤ä¸ªï¼š\n è§£æâ€œ#{}â€å ä½ç¬¦ä¸­æºå¸¦çš„å„ç§å±æ€§ã€‚ å°† SQL è¯­å¥ä¸­çš„â€œ#{}â€å ä½ç¬¦æ›¿æ¢æˆâ€œ?â€å ä½ç¬¦ï¼Œæ›¿æ¢ä¹‹åçš„ SQL è¯­å¥å°±å¯ä»¥æäº¤ç»™æ•°æ®åº“è¿›è¡Œç¼–è¯‘äº†ã€‚  SqlSourceBuilder å®Œæˆäº†â€œ#{}â€å ä½ç¬¦çš„è§£æå’Œæ›¿æ¢ä¹‹åï¼Œä¼šå°†æœ€ç»ˆçš„ SQL è¯­å¥ä»¥åŠå¾—åˆ°çš„ ParameterMapping é›†åˆå°è£…æˆä¸€ä¸ª StaticSqlSource å¯¹è±¡å¹¶è¿”å›ã€‚\nSqlSource åŠ¨æ€ SQL ç»è¿‡ SqlNode å’Œ SqlSourceBuilder ä¹‹åï¼Œæœ€ç»ˆä¼šç”± SqlSource è¿›è¡Œæœ€åçš„å¤„ç†ã€‚SqlSource æ¥å£ä¸­åªå®šä¹‰äº†ä¸€ä¸ª getBoundSql() æ–¹æ³•ï¼Œå®ƒæ§åˆ¶ç€åŠ¨æ€ SQL è¯­å¥è§£æçš„æ•´ä¸ªæµç¨‹ã€‚å®ƒä¼šæ ¹æ®ä» Mapper.xml æ˜ å°„æ–‡ä»¶ï¼ˆæˆ–æ³¨è§£ï¼‰è§£æåˆ°çš„ SQL è¯­å¥ä»¥åŠæ‰§è¡Œ SQL æ—¶ä¼ å…¥çš„å®å‚ï¼Œè¿”å›ä¸€æ¡å¯æ‰§è¡Œçš„ SQLã€‚æ¥å£ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š\nDynamicSqlSource DynamicSqlSource ä¸»è¦è´Ÿè´£è§£æåŠ¨æ€ SQL è¯­å¥ä»¥åŠâ€œ#{}â€å ä½ç¬¦ã€‚\nåŠ¨æ€ SQL çš„åˆ¤æ–­æ ‡å‡†ï¼šå¦‚æœæŸä¸ª SQL ç‰‡æ®µåŒ…å«äº†æœªè§£æçš„â€œ${}â€å ä½ç¬¦æˆ–åŠ¨æ€ SQL æ ‡ç­¾ï¼Œåˆ™ä¸ºåŠ¨æ€ SQL è¯­å¥ã€‚ä½†æ˜¯ï¼ŒåªåŒ…å«â€œ#{}â€å ä½ç¬¦çš„ SQL å¹¶ä¸æ˜¯åŠ¨æ€ SQLã€‚\nRawSqlSource ä¸ DynamicSqlSource ä¸åŒï¼ŒRawSqlSourc å¤„ç†çš„æ˜¯éåŠ¨æ€ SQL è¯­å¥ï¼Œå®ƒè§£æ SQL è¯­å¥çš„æ—¶æœºæ˜¯åœ¨åˆå§‹åŒ–æµç¨‹ä¸­ã€‚\nStaticSqlSource æ— è®ºæ˜¯ DynamicSqlSource è¿˜æ˜¯ RawSqlSourceï¼Œåº•å±‚éƒ½ä¾èµ– SqlSourceBuilder è§£æä¹‹åå¾—åˆ°çš„ StaticSqlSource å¯¹è±¡ã€‚StaticSqlSource ä¸­ç»´æŠ¤äº†è§£æä¹‹åçš„ SQL è¯­å¥ä»¥åŠâ€œ#{}â€å ä½ç¬¦çš„å±æ€§ä¿¡æ¯ã€‚\nSQL æ‰§è¡Œ åœ¨ MyBatis ä¸­ï¼Œæ‰§è¡Œä¸€æ¡ SQL çš„æ ¸å¿ƒç»„ä»¶æœ‰ Executorã€StatementHandlerã€ParameterHandler å’Œ ResultSetHandlerã€‚å…¶ä¸­ï¼ŒExecutor ä¼šè°ƒç”¨äº‹åŠ¡ç®¡ç†æ¨¡å—å®ç°äº‹åŠ¡çš„ç›¸å…³é€šçŸ¥ï¼ŒåŒæ—¶ä¼šé€šè¿‡ç¼“å­˜æ¨¡å—çš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ã€‚SQL è¯­å¥çš„çœŸæ­£æ‰§è¡Œç”± StatementHandler å®ç°ï¼Œå®ƒä¼šä¾èµ– ParameterHandler è¿›è¡Œ SQL æ¨¡æ¿çš„æ•°æ®ç»‘å®šï¼Œç„¶åä¼ åˆ°æ•°æ®åº“æ‰§è¡Œï¼Œä»æ•°æ®åº“æ‹¿åˆ° ResultSetã€‚æœ€åï¼ŒResultSetHandler ä¼šå°† ResultSet æ˜ å°„ä¸º Java å¯¹è±¡è¿”å›ç»™è°ƒç”¨æ–¹ã€‚ä¸‹å›¾å±•ç¤ºäº†ä¸€æ¡ SQL æ‰§è¡Œçš„å¤§è‡´è¿‡ç¨‹ï¼š\nExecutor MyBatis ä¸­æœ‰å¤šä¸ª Executor æ¥å£çš„å®ç°ç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nBaseExecutor BaseExecutor ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®ç°äº† Executor æ¥å£ä¸­çš„æ–¹æ³•ï¼Œå…¶ä¸­ï¼Œä¸å˜çš„éƒ¨åˆ†æ˜¯äº‹åŠ¡ç®¡ç†å’Œç¼“å­˜ç®¡ç†ä¸¤éƒ¨åˆ†çš„å†…å®¹ï¼Œç”± BaseExecutor å®ç°ï¼›å˜åŒ–çš„éƒ¨åˆ†åˆ™æ˜¯å…·ä½“çš„æ•°æ®åº“æ“ä½œï¼Œç”± BaseExecutor å­ç±»å®ç°ï¼Œæ¶‰åŠ doUpdate()ã€doQuery()ã€doQueryCursor() å’Œ doFlushStatement() è¿™å››ä¸ªæ–¹æ³•ã€‚\nSimpleExecutor SimpleExecutor æ˜¯ Executor æ¥å£æœ€ç®€å•çš„å®ç°ã€‚\nReuseExecutor é‡ç”¨ Statement å¯¹è±¡æ˜¯ä¸€ç§å¸¸è§çš„ä¼˜åŒ–æ‰‹æ®µï¼Œä¸ä»…å¯ä»¥å‡å°‘ SQL é¢„ç¼–è¯‘å¼€é”€ï¼Œè¿˜èƒ½é™ä½ Statement å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯é¢‘ç‡ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æå‡ç³»ç»Ÿæ€§èƒ½ã€‚ReuseExecutor å°±å®ç°äº†é‡ç”¨ Statement çš„ä¼˜åŒ–ã€‚\nReuseExecutor ä¸­çš„ do*() æ–¹æ³•å®ç°ä¸ SimpleExecutor å®ç°å®Œå…¨ä¸€æ ·ï¼Œä¸¤è€…å”¯ä¸€çš„åŒºåˆ«åœ¨äºå…¶ä¸­ä¾èµ–çš„ prepareStatement() æ–¹æ³•ï¼šSimpleExecutor æ¯æ¬¡éƒ½ä¼šåˆ›å»ºå…¨æ–°çš„ Statement å¯¹è±¡ï¼ŒReuseExecutor åˆ™æ˜¯å…ˆå°è¯•æŸ¥è¯¢ statementMap ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜å‘½ä¸­ï¼Œåˆ™ä¼šé‡ç”¨å…¶ä¸­çš„ Statement å¯¹è±¡ã€‚\nBatchExecutor æ‰¹å¤„ç†æ˜¯ JDBC ç¼–ç¨‹ä¸­çš„ä¸€ç§å¸¸è§ä¼˜åŒ–æ‰‹æ®µã€‚ä¸è¿‡ï¼Œæœ‰ä¸€ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼šæ¯æ¬¡å‘æ•°æ®åº“å‘é€çš„ SQL è¯­å¥çš„æ¡æ•°æ˜¯æœ‰ä¸Šé™çš„ï¼Œå¦‚æœæ‰¹é‡æ‰§è¡Œçš„æ—¶å€™è¶…è¿‡è¿™ä¸ªä¸Šé™å€¼ï¼Œæ•°æ®åº“å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‹’ç»æ‰§è¡Œè¿™ä¸€æ‰¹ SQL è¯­å¥ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ§åˆ¶æ‰¹é‡å‘é€ SQL è¯­å¥çš„æ¡æ•°å’Œé¢‘ç‡ã€‚BatchExecutor æ˜¯ç”¨äºå®ç°æ‰¹å¤„ç†çš„ Executor å®ç°ç±»ã€‚\nCachingExecutor CachingExecutor æ˜¯ä¸€ä¸ª Executor è£…é¥°å™¨å®ç°ï¼Œä¼šåœ¨å…¶ä»– Executor çš„åŸºç¡€ä¹‹ä¸Šæ·»åŠ äºŒçº§ç¼“å­˜çš„ç›¸å…³åŠŸèƒ½ã€‚\næ’ä»¶ æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„æ’ä»¶æ¥æ‰©å±• MyBatisï¼Œæˆ–è€…æ”¹å˜ MyBatis çš„é»˜è®¤è¡Œä¸ºã€‚æ’ä»¶æ¨¡å—ä¸­æœ€æ ¸å¿ƒçš„æ¥å£å°±æ˜¯ Interceptor æ¥å£ï¼Œæ‰€æœ‰ MyBatis æ’ä»¶éƒ½å¿…é¡»è¦å®ç°çš„è¿™ä¸ªæ¥å£ã€‚\næ¥å£å±‚ æ¥å£å±‚ä¸­çš„æ¥å£éƒ½æ˜¯ MyBatis æœ€å¸¸ä½¿ç”¨çš„ä¸€äº›æ¥å£ï¼Œæ¯”å¦‚ SqlSession å’Œ SqlSessionFactory ç­‰ï¼Œå…¶ä¸­æœ€æ ¸å¿ƒçš„æ¥å£æ˜¯ SqlSessionï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒè·å– Mapper ä»£ç†ã€æ‰§è¡Œ SQL è¯­å¥ã€æ§åˆ¶äº‹åŠ¡å¼€å…³ç­‰ã€‚\nSqlSession SqlSession æ˜¯ MyBatis å¯¹å¤–æä¾›çš„ä¸€ä¸ª API æ¥å£ï¼Œæ•´ä¸ª MyBatis æ¥å£å±‚ä¹Ÿæ˜¯å›´ç»• SqlSession æ¥å£å±•å¼€çš„ï¼ŒSqlSession æ¥å£ä¸­å®šä¹‰äº†ä¸‹é¢å‡ ç±»æ–¹æ³•ã€‚\n  select*() æ–¹æ³•ï¼šç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢æ“ä½œçš„æ–¹æ³•ï¼ŒSqlSession ä¼šå°†ç»“æœé›†æ˜ å°„æˆä¸åŒç±»å‹çš„ç»“æœå¯¹è±¡ï¼Œä¾‹å¦‚ï¼ŒselectOne() æ–¹æ³•è¿”å›å•ä¸ª Java å¯¹è±¡ï¼ŒselectList()ã€selectMap() æ–¹æ³•è¿”å›é›†åˆå¯¹è±¡ã€‚\n  insert()ã€update()ã€delete() æ–¹æ³•ï¼šç”¨æ¥æ‰§è¡Œ DML è¯­å¥ã€‚\n  commit()ã€rollback() æ–¹æ³•ï¼šç”¨æ¥æ§åˆ¶äº‹åŠ¡ã€‚\n  getMapper()ã€getConnection()ã€getConfiguration() æ–¹æ³•ï¼šåˆ†åˆ«ç”¨æ¥è·å–æ¥å£å¯¹åº”çš„ Mapper å¯¹è±¡ã€åº•å±‚çš„æ•°æ®åº“è¿æ¥å’Œå…¨å±€çš„ Configuration é…ç½®å¯¹è±¡ã€‚\n  MyBatis æä¾›äº†ä¸¤ä¸ª SqlSession æ¥å£çš„å®ç°ç±»ï¼Œè¿˜æä¾›äº† SqlSessionFactory æ¥åˆ›å»º SqlSession å¯¹è±¡ã€‚ç›¸å…³ç±»çš„å…³ç³»å¦‚ä¸‹ï¼š\nå…¶ä¸­ï¼ŒDefaultSqlSession æ˜¯ SqlSession çš„é»˜è®¤å®ç°ï¼Œå®ƒç»´æŠ¤äº†ä¸€ä¸ª Executor å¯¹è±¡ï¼Œç”¨æ¥å®Œæˆæ•°æ®åº“æ“ä½œä»¥åŠäº‹åŠ¡ç®¡ç†ã€‚\nDefaultSqlSessionFactory æ˜¯åˆ›å»º DefaultSqlSession çš„å…·ä½“å®ç°ã€‚\nSqlSessionManager åŒæ—¶å®ç°äº† SqlSession å’Œ SqlSessionFactory ä¸¤ä¸ªæ¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåŒæ—¶å…·å¤‡æ“ä½œæ•°æ®åº“çš„èƒ½åŠ›å’Œåˆ›å»º SqlSession çš„èƒ½åŠ›ã€‚\n","href":"/notebook/mybatis/","title":"Mybatis"},{"content":"","href":"/categories/notebook/","title":"Notebook"},{"content":"","href":"/tags/ostep/","title":"OSTEP"},{"content":"åœ°å€ç©ºé—´ æ“ä½œç³»ç»Ÿä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„ç‰©ç†å†…å­˜æŠ½è±¡ï¼Œè¿™ä¸ªæŠ½è±¡å«åš åœ°å€ç©ºé—´ï¼ˆaddress spaceï¼‰ã€‚åœ¨ç³»ç»Ÿä¸­ï¼Œåœ°å€ç©ºé—´æ˜¯è¿è¡Œçš„ç¨‹åºçœ‹åˆ°çš„å†…å­˜ã€‚\nä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´åŒ…å«è¿è¡Œçš„ç¨‹åºçš„æ‰€æœ‰å†…å­˜çŠ¶æ€ã€‚å½“ç¨‹åºè¿è¡Œæ—¶ï¼Œåˆ©ç”¨æ ˆï¼ˆstackï¼‰ä¿å­˜å½“å‰çš„å‡½æ•°è°ƒç”¨ä¿¡æ¯ï¼Œåˆ†é…ç©ºé—´ç»™å±€éƒ¨å˜é‡ã€ä¼ é€’å‚æ•°å’Œè¿”å›å€¼ã€‚æœ€åï¼Œå †ï¼ˆheapï¼‰ç”¨äºç®¡ç†åŠ¨æ€åˆ†é…çš„ã€ç”±ç”¨æˆ·ç®¡ç†çš„å†…å­˜ã€‚å½“ç„¶ï¼Œè¿˜æœ‰å…¶å®ƒçš„ä¸œè¥¿ï¼Œæ¯”å¦‚é™æ€åˆå§‹åŒ–å˜é‡ã€‚ä¸è¿‡æˆ‘ä»¬ç°åœ¨å¯ä»¥å‡è®¾åœ°å€ç©ºé—´åªæœ‰ä¸‰éƒ¨åˆ†ï¼šä»£ç ã€æ ˆå’Œå †ã€‚\nä¸Šå›¾å±•ç¤ºäº†ä¸€ä¸ªå°å‹åœ°å€ç©ºé—´ï¼ˆåªæœ‰ 16KBï¼‰çš„ä¾‹å­ã€‚å…¶ä¸­ç¨‹åºä»£ç ä½äºåœ°å€ç©ºé—´çš„é¡¶éƒ¨ã€‚åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œåœ°å€ç©ºé—´çš„å †ï¼ˆé¡¶éƒ¨ï¼‰å’Œæ ˆï¼ˆåº•éƒ¨ï¼‰ä¸¤ä¸ªåŒºåŸŸå¯èƒ½åŠ¨æ€å¢é•¿æˆ–æ”¶ç¼©ã€‚è¿™ç§ä¸¤ç«¯æ”¾ç½®çš„æ–¹æ³•åªæ˜¯ä¸€ç§çº¦å®šï¼Œå®é™…ä¸Šå¯ä»¥æŒ‰ç…§ä»»æ„æ–¹æ³•æ”¾ç½®ã€‚\nå½“æˆ‘ä»¬æè¿°åœ°å€ç©ºé—´æ—¶ï¼Œæˆ‘ä»¬æè¿°çš„æ˜¯æ“ä½œç³»ç»Ÿæä¾›ç»™è¿è¡Œç¨‹åºçš„æŠ½è±¡ã€‚ä»¥ä¸Šé¢ 16KB çš„åœ°å€ç©ºé—´ä¸ºä¾‹ï¼Œç¨‹åºå®é™…ä¸Šå¯èƒ½å¤„äºç‰©ç†å†…å­˜ä¸­çš„ä»»æ„ä½ç½®ï¼Œå¹¶ä¸ä¸€å®šåœ¨ 0-16KBä¹‹é—´ã€‚åœ°å€ç©ºé—´æè¿°çš„æ˜¯è™šæ‹Ÿå†…å­˜ï¼Œå®ƒä¸ç‰©ç†å†…å­˜æ˜¯ä¸åŒçš„ã€‚\n å…³é”®é—®é¢˜ï¼šå¦‚ä½•è™šæ‹ŸåŒ–å†…å­˜ï¼Ÿæ“ä½œç³»ç»Ÿå¦‚ä½•åœ¨å•ä¸€çš„ç‰©ç†å†…å­˜ä¸Šä¸ºå¤šä¸ªè¿›ç¨‹æ„å»ºå‡ºä¸€ä¸ªç§æœ‰çš„ã€å¯èƒ½æ— é™å¤§çš„åœ°å€ç©ºé—´çš„æŠ½è±¡ï¼Ÿ\n éš”ç¦»æ˜¯å»ºç«‹å¯é ç³»ç»Ÿçš„å…³é”®åŸåˆ™ã€‚å¦‚æœä¸¤ä¸ªå®ä½“ç›¸äº’éš”ç¦»ï¼Œåˆ™ä¸€ä¸ªå®ä½“çš„å¤±è´¥ä¸ä¼šå½±æ˜Ÿåˆ°å¦ä¸€ä¸ªå®ä½“ã€‚æ“ä½œç³»ç»Ÿå°½åŠ›è®©è¿›ç¨‹ä¹‹é—´å½¼æ­¤éš”ç¦»ï¼Œä»è€Œé˜²æ­¢ç›¸äº’ä¼¤å®³ã€‚\nè™šæ‹ŸåŒ–å†…å­˜çš„ç›®æ ‡ è™šæ‹Ÿå†…å­˜ç³»ç»Ÿæœ‰å‡ ä¸ªé‡è¦çš„ç›®æ ‡ï¼š\n é€æ˜ï¼ˆtransparencyï¼‰ï¼šè¿è¡Œçš„ç¨‹åºå¹¶ä¸ä¼šæ„ŸçŸ¥åˆ°å†…å­˜è¢«è™šæ‹ŸåŒ–çš„äº‹å®ï¼Œç¨‹åºçš„è¡Œä¸ºå°±å¥½åƒå®ƒæ‹¥æœ‰è‡ªå·±çš„ç§æœ‰ç‰©ç†å†…å­˜ã€‚èƒŒåæ˜¯æ“ä½œç³»ç»Ÿçš„è¾›å‹¤å·¥ä½œï¼Œæ“ä½œç³»ç»Ÿè®©ä¸åŒçš„ä»»åŠ¡å¤ç”¨å†…å­˜ï¼Œä»è€Œæä¾›è¿™ä¸ªå‡è±¡ã€‚ æ•ˆç‡ï¼ˆefficiencyï¼‰ï¼šæ“ä½œç³»ç»Ÿåº”è¯¥è®©è™šæ‹ŸåŒ–å°½å¯èƒ½åœ°é«˜æ•ˆã€‚ä¸ºæ­¤ï¼Œå¯èƒ½éœ€è¦åƒ TLB è¿™æ ·çš„ç¡¬ä»¶æ”¯æŒã€‚ ä¿æŠ¤ï¼ˆprotectionï¼‰ï¼šæ“ä½œç³»ç»Ÿåº”å½“ç¡®ä¿è¿›ç¨‹å’Œè‡ªå·±å—åˆ°ä¿æŠ¤ï¼Œä¸å—å…¶å®ƒè¿›ç¨‹å½±å“ã€‚ä¿æŠ¤è®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨è¿›ç¨‹ä¹‹é—´æä¾›éš”ç¦»çš„ç‰¹æ€§ï¼Œé¿å…æ¶æ„è¿›ç¨‹çš„ç ´åã€‚ä¿æŠ¤è®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨è¿›ç¨‹ä¹‹é—´æä¾›éš”ç¦»æœºåˆ¶ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½åº”è¯¥åœ¨è‡ªå·±ç‹¬ç«‹çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œé¿å…å…¶å®ƒå‡ºé”™æˆ–æ¶æ„è¿›ç¨‹çš„å½±å“ã€‚   C ç¨‹åºé‡Œé¢å¯ä»¥æ‰“å°æŒ‡é’ˆï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„å€¼æ˜¯è™šæ‹Ÿåœ°å€è€Œä¸æ˜¯ç‰©ç†åœ°å€ï¼ˆæˆ‘ä»¬çœ‹åˆ°çš„æ‰€æœ‰åœ°å€éƒ½ä¸æ˜¯çœŸçš„ï¼‰ã€‚è™šæ‹Ÿåœ°å€åªæ˜¯æä¾›åœ°å€å¦‚ä½•åœ¨å†…å­˜ä¸­åˆ†å¸ƒçš„å‡è±¡ï¼Œåªæœ‰æ“ä½œç³»ç»Ÿï¼ˆå’Œç¡¬ä»¶ï¼‰çŸ¥é“ç‰©ç†åœ°å€ã€‚è¿™ä¹Ÿåæ˜ å‡ºäº†ç”¨æˆ·ç¨‹åºå’Œæ“ä½œç³»ç»Ÿçœ‹åˆ°ä¸œè¥¿çš„ä¸åŒã€‚\n åœ°å€è½¬æ¢ å‰é¢æåˆ°è¿‡ï¼Œè¿è¡Œä¸­çš„ç¨‹åºçœ‹åˆ°çš„æ˜¯è™šæ‹Ÿåœ°å€ï¼Œè€Œæ•°æ®æ˜¯ä½äºç‰©ç†åœ°å€ä¸­çš„ã€‚ä¸ºäº†è¯»å–æ­£ç¡®çš„æ•°æ®ï¼Œéœ€è¦è¿›è¡Œè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢ã€‚\nåŸºäºç¡¬ä»¶çš„åœ°å€è½¬æ¢ï¼ˆhardware-based address translationï¼‰ç®€ç§°åœ°å€è½¬æ¢ï¼ˆaddress translationï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§é€šç”¨æŠ€æœ¯ã€‚æ¯å½“ç¨‹åºè¿›è¡Œå†…å­˜è®¿é—®ï¼ˆå–æŒ‡ä»¤ã€è¯»å†™æ•°æ®ï¼‰æ—¶ï¼Œåœ°å€è½¬æ¢å°†æŒ‡ä»¤ä¸­çš„è™šæ‹Ÿåœ°å€ï¼ˆvirtual addressï¼‰è½¬æ¢ä¸ºå®é™…çš„ç‰©ç†åœ°å€ï¼ˆphysical addressï¼‰ã€‚å› æ­¤ï¼Œåœ¨æ¯æ¬¡å†…å­˜å¼•ç”¨æ—¶ï¼Œç¡¬ä»¶éƒ½ä¼šè¿›è¡Œåœ°å€è½¬æ¢ï¼Œå°†åº”ç”¨ç¨‹åºçš„å†…å­˜å¼•ç”¨é‡å®šä½åˆ°å†…å­˜ä¸­çš„å®é™…ä½ç½®ã€‚\nä»…é ç¡¬ä»¶ä¸è¶³ä»¥å®ç°è™šæ‹Ÿå†…å­˜ï¼Œç¡¬ä»¶åªæ˜¯æä¾›äº†åº•å±‚æœºåˆ¶æ¥æé«˜åœ°å€è½¬æ¢çš„æ•ˆç‡ï¼Œå®ç°è™šæ‹Ÿå†…å­˜è¿˜éœ€è¦æ“ä½œç³»ç»Ÿåœ¨å…³é”®ä½ç½®ä»‹å…¥ã€‚å› æ­¤ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿç®¡ç†å†…å­˜ï¼Œè®°å½•å†…å­˜çš„ä½¿ç”¨æƒ…å†µã€‚\n ä»‹å…¥ï¼ˆinterposiitonï¼‰ æ˜¯ä¸€ç§å¾ˆå¸¸è§åˆå¾ˆæœ‰ç”¨çš„æŠ€æœ¯ã€‚åœ¨è™šæ‹Ÿå†…å­˜ä¸­ï¼Œç¡¬ä»¶å¯ä»¥ä»‹å…¥åˆ°æ¯æ¬¡å†…å­˜è®¿é—®ä¸­ï¼Œå°†è¿›ç¨‹æä¾›çš„è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºæ•°æ®å®é™…æ‰€åœ¨çš„ç‰©ç†åœ°å€ã€‚\n åŠ¨æ€ï¼ˆåŸºäºç¡¬ä»¶ï¼‰é‡å®šä½ åŸºäºç¡¬ä»¶çš„åœ°å€è½¬æ¢åœ¨æ—©æœŸçš„æ—¶å€™å¾ˆç®€å•ï¼šæ¯ä¸ª CPU éœ€è¦ä¸¤ä¸ªç¡¬ä»¶å¯„å­˜å™¨â€”â€”åŸºå€ï¼ˆbaseï¼‰å¯„å­˜å™¨ å’Œ ç•Œé™ï¼ˆboundï¼‰å¯„å­˜å™¨ï¼Œç•Œé™å¯„å­˜å™¨æœ‰æ—¶åˆç§°é™åˆ¶ï¼ˆlimitï¼‰å¯„å­˜å™¨ã€‚äºŒè€…çš„åˆä½œèƒ½ä¿è¯åœ°å€ç©ºé—´åœ¨ç‰©ç†å†…å­˜ä¸­çš„ä»»ä½•ä½ç½®ï¼ŒåŒæ—¶ç¡®ä¿è¿›ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„åœ°å€ç©ºé—´ã€‚\nå½“æˆ‘ä»¬ç¼–å†™å’Œç¼–è¯‘ç¨‹åºæ—¶ï¼Œå‡è®¾åœ°å€ç©ºé—´ä»é›¶å¼€å§‹ã€‚ä½†æ˜¯ï¼Œå½“ç¨‹åºçœŸæ­£æ‰§è¡Œæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå†³å®šå…¶åœ¨ç‰©ç†å†…å­˜ä¸­çš„å®é™…åœ°å€ï¼Œå¹¶å°†åŸºå€å¯„å­˜å™¨è®¾ç½®ä¸ºè¿™ä¸ªå€¼ã€‚å½“è¿›ç¨‹è¿è¡Œæ—¶ï¼Œç¡¬ä»¶ä¼šé€šè¿‡ä»¥ä¸‹æ–¹å¼è®¡ç®—å‡ºç‰©ç†åœ°å€å¹¶å‘ç»™å†…å­˜ç³»ç»Ÿï¼š\n$$ physical\\ address = virtual\\ address + base $$\nåœ°å€è½¬æ¢æŠ€æœ¯æŒ‡çš„æ­£æ˜¯å°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚ç¡¬ä»¶å–å¾—è¿›ç¨‹è®¤ä¸ºå®ƒè¦è®¿é—®çš„åœ°å€ï¼Œå°†å…¶è½¬æ¢ä¸ºæ•°æ®å®é™…ä½äºçš„ç‰©ç†åœ°å€ï¼Œç”±äºè¿™ç§é‡å®šä½æ˜¯åœ¨è¿è¡Œæ—¶å‘ç”Ÿçš„ï¼Œæ‰€ä»¥è¿™ç§æŠ€æœ¯ä¸€èˆ¬è¢«ç§°ä¸ºåŠ¨æ€é‡å®šä½ï¼ˆdynamic relocationï¼‰ã€‚\nåŸºå€å¯„å­˜å™¨è´Ÿè´£æ”¯æŒé‡å®šä½ï¼Œè€Œç•Œé™å¯„å­˜å™¨å°±è´Ÿè´£æä¾›å†…å­˜ä¿æŠ¤ï¼Œç¡®ä¿è¿›ç¨‹äº§ç”Ÿçš„åœ°å€éƒ½åœ¨è¿›ç¨‹åº”è¯¥å¤„äºçš„ç•Œé™ä¹‹ä¸­ã€‚ç•Œé™å¯„å­˜å™¨é€šå¸¸æœ‰ä¸¤ç§å·¥ä½œæ–¹å¼ï¼š\n è®°å½•åœ°å€ç©ºé—´çš„å¤§å°ï¼Œåœ¨ç¡¬ä»¶å°†è™šæ‹Ÿåœ°å€ä¸åŸºå€å¯„å­˜å™¨å†…å®¹æ±‚å’Œå‰æ£€æŸ¥è¿™ä¸ªç•Œé™ã€‚ è®°å½•åœ°å€ç©ºé—´ç»“æŸçš„ç‰©ç†åœ°å€ï¼Œåœ¨ç¡¬ä»¶å°†è™šæ‹Ÿåœ°å€è½¬æ¢æˆç‰©ç†åœ°å€ä¹‹åå»æ£€æŸ¥è¿™ä¸ªç•Œé™ã€‚  ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚å‡è®¾ä¸€ä¸ªè¿›ç¨‹æ‹¥æœ‰ 4KB å¤§å°çš„åœ°å€ç©ºé—´ï¼Œå®ƒè¢«åŠ è½½åˆ°ä» 16KB å¼€å§‹çš„ç‰©ç†å†…å­˜ä¸­ï¼Œä¸€äº›åœ°å€è½¬æ¢ç»“æœå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\n   è™šæ‹Ÿåœ°å€  ç‰©ç†åœ°å€     0 â†’ 16KB   1KB â†’ 17KB   3000 â†’ 19384   4400 â†’ é”™è¯¯ï¼ˆè¶Šç•Œï¼‰    æ“ä½œç³»ç»Ÿçš„èŒè´£ ä¸ºäº†æ”¯æŒåŠ¨æ€é‡å®šä½ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦å¤„ç†ä¸€äº›é—®é¢˜ï¼š\n å†…å­˜ç®¡ç†  ä¸ºæ–°è¿›ç¨‹åˆ†é…å†…å­˜ ä»ç»ˆæ­¢è¿›ç¨‹å›æ”¶å†…å­˜ ç®¡ç†å†…å­˜ä½¿ç”¨æƒ…å†µ   åŸºå€/ç•Œé™ç®¡ç†  å¿…é¡»åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶æ­£ç¡®è®¾ç½®åŸºå€/ç•Œé™å¯„å­˜å™¨   å¼‚å¸¸å¤„ç†  å½“å¼‚å¸¸å‘ç”Ÿæ—¶æ‰§è¡Œå¿…è¦çš„å¤„ç†é€»è¾‘    åˆ†æ®µ å¦‚æœç®€å•åœ°å°†è¿›ç¨‹çš„æ•´ä¸ªåœ°å€ç©ºé—´æ”¾å…¥ç‰©ç†å†…å­˜ï¼Œæ ˆå’Œå †ä¹‹é—´çš„ç©ºé—´å³ä½¿æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œä¹Ÿä¼šå ç”¨å®é™…çš„ç‰©ç†å†…å­˜ã€‚å› æ­¤ï¼Œç®€å•åœ°é€šè¿‡åŸºå€å¯„å­˜å™¨å’Œç•Œé™å¯„å­˜å™¨å®ç°çš„è™šæ‹Ÿå†…å­˜éå¸¸æµªè´¹ã€‚\nåˆ†æ®µï¼ˆsegmentationï¼‰å®é™…ä¸Šæ˜¯ä¸ºäº†æ”¯æŒæ›´å¤§çš„åœ°å€ç©ºé—´ã€‚å…¶æ€æƒ³æ˜¯ï¼šè®©åœ°å€ç©ºé—´å†…çš„æ¯ä¸ªé€»è¾‘æ®µéƒ½æœ‰ä¸€å¯¹åŸºå€å’Œç•Œé™å¯„å­˜å™¨ã€‚ä¸€ä¸ªæ®µï¼ˆsegmentï¼‰åªæ˜¯åœ°å€ç©ºé—´å†…çš„ä¸€ä¸ªè¿ç»­å®šé•¿çš„åŒºåŸŸã€‚åœ¨å…¸å‹çš„åœ°å€ç©ºé—´é‡Œæœ‰3ç§ä¸åŒçš„é€»è¾‘æ®µï¼šä»£ç æ®µã€æ ˆå’Œå †ã€‚åˆ†æ®µå¯ä»¥è®©æ“ä½œç³»ç»Ÿå°†ä¸åŒçš„æ®µæ”¾åˆ°ä¸åŒçš„ç‰©ç†å†…å­˜åŒºåŸŸï¼Œä»è€Œé¿å…è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­æœªä½¿ç”¨çš„éƒ¨åˆ†å ç”¨ç‰©ç†å†…å­˜ã€‚\næ®µé”™è¯¯æ˜¯æŒ‡åœ¨æ”¯æŒåˆ†æ®µçš„æœºå™¨ä¸Šå‘ç”Ÿäº†éæ³•çš„å†…å­˜è®¿é—®ã€‚\nå½“ç¡¬ä»¶åœ¨åœ°å€è½¬æ¢æ—¶ä½¿ç”¨æ®µå¯„å­˜å™¨æ—¶ï¼Œå®ƒå¦‚ä½•çŸ¥é“è™šæ‹Ÿåœ°å€å¼•ç”¨äº†é‚£ä¸ªæ®µï¼Œä»¥åŠæ®µå†…åç§»é‡å‘¢ï¼Ÿä¸€ç§å¸¸è§çš„æ–¹å¼æ˜¯ç”¨è™šæ‹Ÿåœ°å€çš„å‰å‡ ä½æ¥æ ‡è¯†ä¸åŒçš„æ®µï¼Œå‰©ä½™ä½ç”¨æ¥æ ‡è¯†åç§»é‡ã€‚è¿™ç§æ–¹å¼æ˜¾å¼åœ°ç»™å‡ºæ®µçš„ä½ç½®ï¼Œç¡¬ä»¶å¯ä»¥é€šè¿‡éšå¼æ–¹å¼è·çŸ¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ°å€ç”±ç¨‹åºè®¡æ•°å™¨äº§ç”Ÿï¼Œé‚£ä¹ˆåœ°å€ä½äºä»£ç æ®µï¼Œå¦‚æœåœ°å€åŸºäºæ ˆæˆ–è€…åŸºå€æŒ‡é’ˆï¼Œé‚£ä¹ˆåœ°å€ä½äºæ ˆæ®µï¼Œå…¶å®ƒæƒ…å†µåˆ™ä½äºå †æ®µã€‚\nç©ºé—²ç©ºé—´ç®¡ç† å¤–éƒ¨ç¢ç‰‡ï¼ˆexternal fragmentationï¼‰ï¼šç©ºé—²ç©ºé—´è¢«åˆ†å‰²æˆä¸åŒå¤§å°çš„å°å—ï¼Œæˆä¸ºç¢ç‰‡ï¼Œåç»­çš„å†…å­˜åˆ†é…è¯·æ±‚ä¼šç”±äºæ‰¾ä¸åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—²ç©ºé—´è€Œå¤±è´¥ï¼Œå³ä½¿è¿™æ—¶æ€»çš„ç©ºé—²ç©ºé—´è¶…å‡ºäº†è¯·æ±‚çš„å¤§å°ã€‚ å†…éƒ¨ç¢ç‰‡ï¼ˆinternal fragmentationï¼‰ï¼šå¦‚æœåˆ†é…ç¨‹åºåˆ†é…ç»™ç¨‹åºçš„å†…å­˜å—è¶…è¿‡äº†è¯·æ±‚çš„å¤§å°ï¼Œé‚£ä¹ˆè¶…å‡ºå¤§å°çš„éƒ¨åˆ†ï¼ˆæœªè¢«ä½¿ç”¨ï¼‰å°±ä¼šç§°ä¸ºå†…éƒ¨ç¢ç‰‡ï¼Œå³ç©ºé—´çš„æµªè´¹å‡ºç°åœ¨å·²åˆ†é…å•å…ƒçš„å†…éƒ¨ã€‚\nç©ºé—²é“¾è¡¨ï¼ˆfree listï¼‰æ˜¯ä¸€ç§ç®¡ç†ç©ºé—²ç©ºé—´çš„æ•°æ®ç»“æ„ï¼Œè¯¥ç»“æ„åŒ…å«äº†æ‰€ç®¡ç†å†…å­˜åŒºåŸŸä¸­æ‰€æœ‰ç©ºé—²å—çš„å¼•ç”¨ã€‚\nå¸¸è§çš„å†…å­˜åˆ†é…ç­–ç•¥æœ‰ï¼šæœ€ä¼˜åŒ¹é…ã€æœ€å·®åŒ¹é…ã€é¦–æ¬¡åŒ¹é…ã€ä¸‹æ¬¡åŒ¹é…ç­‰\nåˆ†ç¦»ç©ºé—²é“¾è¡¨ï¼šå¦‚æœæŸä¸ªç¨‹åºç»å¸¸ç”³è¯·ä¸€ç§æˆ–é›†ä¸­å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œé‚£å°±ç”¨ä¸€ä¸ªç‹¬ç«‹çš„åˆ—è¡¨æ¥ç®¡ç†è¿™äº›å¤§å°çš„å¯¹è±¡ï¼Œå…¶å®ƒå¤§å°çš„è¯·æ±‚äº¤ç»™é€šç”¨çš„å†…å­˜åˆ†é…ç¨‹åºã€‚ä¾‹å¦‚ Solaris çš„å†…å­˜åˆ†é…ç¨‹åºåšå—åˆ†é…ç¨‹åºï¼ˆslab allocatorï¼‰ã€‚\nåˆ†é¡µ åœ¨å†…å­˜ç®¡ç†æ–¹é¢ï¼Œæ“ä½œç³»ç»Ÿé€šå¸¸æœ‰ä¸¤ç§æ–¹æ³•ï¼š\n åˆ†æ®µï¼šå°†ç©ºé—´åˆ†å‰²æˆä¸åŒé•¿åº¦çš„åˆ†ç‰‡ï¼Œå°±åƒè™šæ‹Ÿå†…å­˜ç®¡ç†ä¸­çš„åˆ†æ®µã€‚ä½†æ˜¯ï¼Œå°†ç©ºé—´åˆ‡æˆä¸åŒé•¿åº¦çš„ç¢ç‰‡åï¼Œç©ºé—´æœ¬èº«ä¼šç¢ç‰‡åŒ–ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œåˆ†é…å†…å­˜ä¼šå˜å¾—æ¯”è¾ƒå›°éš¾ã€‚ åˆ†é¡µï¼šå°†ç©ºé—´åˆ†å‰²æˆå›ºå®šé•¿åº¦çš„åˆ†ç‰‡ã€‚æ¯ä¸ªåˆ†ç‰‡ä¸ºä¸€ä¸ªå•å…ƒï¼Œå³ä¸€é¡µï¼Œç§°ä¹‹ä¸ºé¡µå¸§ï¼ˆpage frameï¼‰ã€‚  é¡µè¡¨ ä¸ºäº†è®°å½•åœ°å€ç©ºé—´çš„æ¯ä¸ªè™šæ‹Ÿé¡µåœ¨ç‰©ç†å†…å­˜ä¸­æ‰€å¤„çš„ä½ç½®ï¼Œæ“ä½œç³»ç»Ÿé€šå¸¸ä¼šä¸ºæ¯ä¸ªè¿›ç¨‹ä¿å­˜ä¸€ä¸ªè¢«ç§°ä¸ºé¡µè¡¨ï¼ˆpage tableï¼‰çš„æ•°æ®ç»“æ„ã€‚é¡µè¡¨çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºæ¯ä¸ªè™šæ‹Ÿé¡µé¢ä¿å­˜åœ°å€è½¬æ¢ä¿¡æ¯ï¼Œä»è€Œè®©æˆ‘ä»¬çŸ¥é“æ¯ä¸ªé¡µåœ¨ç‰©ç†å†…å­˜ä¸­çš„ä½ç½®ã€‚\nè™šæ‹Ÿåœ°å€ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šè™šæ‹Ÿé¡µé¢å·ï¼ˆvirtual page numberï¼ŒVPNï¼‰å’Œé¡µå†…åç§»é‡ï¼ˆoffsetï¼‰ã€‚\nåœ¨è¿›è¡Œåœ°å€è½¬æ¢æ—¶ï¼Œå…ˆæ ¹æ® VPN æ£€ç´¢é¡µè¡¨ï¼Œæ‰¾å‡ºè™šæ‹Ÿé¡µå·å¯¹åº”çš„ç‰©ç†å¸§å·ï¼ˆPFNï¼‰æˆ–ç‰©ç†é¡µå·ï¼ˆPPNï¼‰ã€‚é€šè¿‡ç”¨ PFN æ›¿æ¢ VPN è½¬æ¢è™šæ‹Ÿåœ°å€ï¼Œé¡µå†…åç§»ä¿æŒä¸å˜ï¼ˆè™šæ‹Ÿé¡µå’Œç‰©ç†é¡µå¤§å°ç›¸ç­‰ï¼‰ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š\né¡µè¡¨çš„ä¿å­˜ é¡µè¡¨å¯ä»¥å˜å¾—éå¸¸å¤§ï¼Œä¸€ä¸ª 20 ä½çš„ VPN æ„å‘³ç€æ“ä½œç³»ç»Ÿå¿…é¡»ä¸ºæ¯ä¸ªè¿›ç¨‹ç®¡ç† 1M ï¼ˆå¤§çº¦ä¸€ç™¾ä¸‡ï¼‰ä¸ªåœ°å€è½¬æ¢ã€‚å‡è®¾æ¯ä¸ªé¡µè¡¨æ¡ç›®ï¼ˆPTEï¼‰å  4Bï¼Œåˆ™æ¯ä¸ªé¡µè¡¨å°±éœ€è¦ 4MB çš„å­˜å‚¨ç©ºé—´ã€‚å®é™…ä¸Šï¼Œæ“ä½œç³»ç»Ÿå°†æ¯ä¸ªè¿›ç¨‹çš„é¡µè¡¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œç”±äºå¾ˆå¤šæ“ä½œç³»ç»Ÿå†…å­˜æœ¬èº«ä¹Ÿå¯ä»¥è¢«è™šæ‹ŸåŒ–ï¼Œæ‰€ä»¥é¡µè¡¨ä¹Ÿå¯ä»¥å­˜å‚¨åœ¨æ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ä¸­ï¼ˆç”šè‡³å¯ä»¥è¢«äº¤æ¢åˆ°ç£ç›˜ä¸Šï¼‰ã€‚\nåˆ†é¡µçš„é—®é¢˜ æ™®é€šçš„åˆ†é¡µå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š\n é¡µè¡¨å¤ªå¤§ï¼Œå¯¼è‡´è®¿é—®æ…¢ã€‚ é¡µè¡¨å¤ªå¤§ï¼Œå¯¼è‡´æ¶ˆè€—çš„å†…å­˜å¤ªå¤šã€‚  TLB TLB æ˜¯ä¸ºäº†è§£å†³åˆ†é¡µé€Ÿåº¦æ…¢çš„é—®é¢˜ã€‚\nåŸºäºåˆ†é¡µçš„è™šæ‹Ÿå†…å­˜å¯èƒ½ä¼šå¸¦æ¥æ¯”è¾ƒé«˜çš„æ€§èƒ½å¼€é”€ï¼Œå› ä¸ºéœ€è¦å°†åœ°å€ç©ºé—´åˆ‡åˆ†ä¸ºå›ºå®šå¤§å°çš„é¡µï¼Œå¹¶è®°å½•è¿™äº›é¡µçš„åœ°å€æ˜ å°„ä¿¡æ¯ã€‚ç”±äºè¿™äº›ä¿¡æ¯ä¸€èˆ¬å­˜å‚¨åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œåœ°å€è½¬æ¢æ—¶ï¼Œåˆ†é¡µé€»è¾‘éœ€è¦ä¸€æ¬¡é¢å¤–çš„å†…å­˜è®¿é—®ã€‚æ¯æ¬¡è·å–æŒ‡ä»¤ã€åŠ è½½æˆ–ä¿å­˜æ•°æ®ï¼Œéƒ½éœ€è¦å¤šè¯»ä¸€æ¬¡å†…å­˜æ‰èƒ½å¾—åˆ°è½¬æ¢ä¿¡æ¯ï¼Œè¿™å›ä½¿å¾—æ€»ä½“çš„æ…¢éš¾ä»¥æ¥å—ã€‚ä¸ºäº†åŠ é€Ÿåœ°å€è½¬æ¢ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ç¡¬ä»¶çš„å¸®åŠ©ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ åœ°å€è½¬æ¢æ—è·¯ç¼“å†²ï¼ˆtranslation-lookaside bufferï¼ŒTLBï¼‰ã€‚\nå¯¹äºæ¯æ¬¡å†…å­˜è®¿é—®ï¼Œç¡¬ä»¶éƒ½ä¼šå…ˆæ£€æŸ¥ TLBï¼Œè‹¥å…¶ä¸­åŒ…å«æœŸæœ›çš„åœ°å€è½¬æ¢ï¼Œåˆ™ä¸éœ€è¦è®¿é—®é¡µè¡¨å°±èƒ½å®Œæˆè½¬æ¢ã€‚é¡µè¡¨ä¸­åŒ…å«å…¨éƒ¨çš„è½¬æ¢æ˜ å°„ï¼Œç›´æ¥èµ° TLB è€Œä¸æŸ¥è¯¢é¡µè¡¨ä¼šå¾ˆå¿«ï¼ŒTLB å› æ­¤èƒ½å¤Ÿå¸¦æ¥å·¨å¤§çš„æ€§èƒ½æå‡ã€‚\nTLB å’Œå…¶ä»–ç¼“å­˜ç±»ä¼¼ï¼Œå‰æéƒ½æ˜¯åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè½¬æ¢æ˜ å°„ä¼šåœ¨ç¼“å­˜ä¸­ï¼ˆå³TLBå‘½ä¸­ï¼‰ã€‚è‹¥æ˜¯å¦‚æ­¤ï¼Œåªéœ€è¦å¢åŠ å°‘é‡å¼€é”€å°±å¯ä»¥è¾¾åˆ°éå¸¸å¿«çš„è®¿é—®é€Ÿåº¦ï¼Œå› ä¸º TLB å°±åœ¨å¤„ç†å™¨é™„è¿‘ã€‚å¦‚æœ TLB æœªå‘½ä¸­ï¼Œå°±ä¼šäº§ç”Ÿå¾ˆå¤§çš„åˆ†é¡µå¼€é”€ï¼Œå¿…é¡»è®¿é—®é¡µè¡¨è·å–è½¬æ¢æ˜ å°„ï¼Œå¯¼è‡´é¢å¤–çš„å†…å­˜è®¿é—®ã€‚å¦‚æœç»å¸¸è¿™æ ·ï¼Œç¨‹åºçš„è¿è¡Œå°±ä¼šæ˜¾è‘—å˜æ…¢ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½åœ°é¿å… TLB ä¸å‘½ä¸­ã€‚\næ—¢ç„¶ç¼“å­˜è¿™ä¹ˆå¿«ï¼Œä¸ºä»€ä¹ˆä¸æŠŠå®ƒåšå¾—æ›´å¤§å‘¢ï¼ŸåŸå› æ˜¯å¦‚æœæƒ³è¦å¿«é€Ÿåœ°ç¼“å­˜ï¼Œå®ƒå°±å¿…é¡»å°ï¼Œå› ä¸ºå…‰é€Ÿå’Œå…¶å®ƒç‰©ç†é™åˆ¶ä¼šèµ·ä½œç”¨ã€‚å¤§çš„ç¼“å­˜æ³¨å®šæ…¢ï¼Œå› æ­¤æ— æ³•å®ç°ç›®çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥å…³æ³¨å¦‚ä½•åˆ©ç”¨å¥½ç¼“å­˜æ¥æé«˜æ€§èƒ½ã€‚\néšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆRandom-Access Memoryï¼ŒRAMï¼‰æš—ç¤ºä½ è®¿é—® RAM çš„ä»»æ„éƒ¨åˆ†éƒ½ä¸€æ ·å¿«ã€‚è™½ç„¶ ä¸€èˆ¬è¿™æ ·æƒ³ RAM æ²¡é”™ï¼Œä½†å› ä¸º TLB è¿™æ ·çš„ç¡¬ä»¶/æ“ä½œç³»ç»ŸåŠŸèƒ½ï¼Œè®¿é—®æŸäº›å†…å­˜é¡µçš„å¼€é”€è¾ƒå¤§ï¼Œå°¤å…¶æ˜¯ æ²¡æœ‰è¢« TLB ç¼“å­˜çš„é¡µã€‚å› æ­¤ï¼Œæœ€å¥½è®°ä½è¿™ä¸ªå®ç°çš„çªé—¨ï¼šRAM ä¸æ€»æ˜¯ RAMã€‚æœ‰æ—¶å€™éšæœºè®¿é—®åœ°å€ç©º é—´ï¼Œå°¤å…¶æ˜¯ TLB æ²¡æœ‰ç¼“å­˜çš„é¡µï¼Œå¯èƒ½å¯¼è‡´ä¸¥é‡çš„æ€§èƒ½æŸå¤±ã€‚\nè¾ƒå°çš„é¡µè¡¨  å…³é”®é—®é¢˜ï¼šç®€å•çš„çº¿æ€§é¡µè¡¨å¤ªå¤§ï¼Œå ç”¨è¿‡å¤šå†…å­˜ï¼Œå¦‚ä½•è®©å®ƒæ›´å°ï¼Ÿ\n ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨æ›´å¤§çš„é¡µï¼Œé¡µçš„æ•°é‡å°‘äº†ï¼Œé¡µè¡¨å› æ­¤å˜å°ã€‚ä½†æ˜¯ï¼Œæ›´å¤§çš„é¡µå®¹æ˜“å‡ºç°å†…éƒ¨ç¢ç‰‡ï¼Œé€ æˆå†…å­˜çš„æµªè´¹ã€‚\nå¦ä¸€ç§æ–¹æ³•æ˜¯æ··åˆä½¿ç”¨åˆ†æ®µå’Œåˆ†é¡µæ–¹æ³•ï¼Œæ¯ä¸ªåˆ†æ®µä¸€ä¸ªé¡µè¡¨ã€‚ä½†è¿™é¿ä¸å¼€åˆ†æ®µå¯èƒ½å¯¼è‡´çš„å¤–éƒ¨ç¢ç‰‡é—®é¢˜ã€‚\nè¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯é‡‡ç”¨å¤šçº§é¡µè¡¨ã€‚å¤šçº§é¡µè¡¨æ˜¯æ—¶é—´ä¸ç©ºé—´çš„æŠ˜ä¸­ã€‚\nåœ¨åå‘é¡µè¡¨ä¸­ï¼Œåªæœ‰ä¸€ä¸ªé¡µè¡¨ï¼Œå…¶ä¸­çš„é¡¹ä»£è¡¨ç³»ç»Ÿçš„æ¯ä¸ªç‰©ç†é¡µï¼Œè€Œä¸æ˜¯è¿›ç¨‹çš„é¡µè¡¨ã€‚é¡µè¡¨é¡¹å‘Šè¯‰æˆ‘ä»¬å“ªä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨æ­¤é¡µï¼Œä»¥åŠè¯¥è¿›ç¨‹çš„å“ªä¸ªè™šæ‹Ÿé¡µæ˜ å°„åˆ°äº†æ­¤ç‰©ç†é¡µã€‚\näº¤æ¢  å…³é”®é—®é¢˜ï¼šæ“ä½œç³»ç»Ÿå¦‚ä½•åˆ©ç”¨å¤§è€Œæ…¢çš„è®¾å¤‡ï¼Œé€æ˜åœ°æä¾›å·¨å¤§è™šæ‹Ÿåœ°å€ç©ºé—´çš„å‡è±¡ï¼Ÿ\n äº¤æ¢ç©ºé—´ ä¸ºäº†æä¾›å·¨å¤§è™šæ‹Ÿåœ°å€ç©ºé—´çš„å‡è±¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¡¬ç›˜ä¸Šå¼€è¾Ÿä¸€éƒ¨åˆ†ç©ºé—´ï¼ˆäº¤æ¢ç©ºé—´ï¼Œswap spaceï¼‰ç”¨äºç‰©ç†é¡µçš„ç§»å…¥å’Œç§»å‡ºã€‚åœ¨å¿…è¦çš„æ—¶å€™å°†å†…å­˜ä¸­çš„é¡µé¢äº¤æ¢å‡ºå»ï¼Œåœ¨éœ€è¦çš„æ—¶å€™åˆä»å…¶ä¸­äº¤æ¢å›æ¥ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œäº¤æ¢ç©ºé—´ä¸æ˜¯å”¯ä¸€çš„ç¡¬ç›˜äº¤æ¢ç›®çš„åœ°ã€‚\näº¤æ¢æ—¶æœº æ“ä½œç³»ç»Ÿä¸€èˆ¬ä¼šé¢„ç•™ä¸€å°éƒ¨åˆ†ç©ºé—²å†…å­˜ã€‚å¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½ä¼šè®¾ç½®é«˜æ°´ä½çº¿ï¼ˆHigh Watermarkï¼ŒHWï¼‰å’Œä½æ°´ä½çº¿ï¼ˆLow Watermarkï¼ŒLWï¼‰ï¼Œä»è€Œå¸®åŠ©å†³å®šä½•æ—¶ä»å†…å­˜ä¸­æ¸…æ¥šé¡µã€‚åŸç†å¾ˆç®€å•ï¼šå½“æ“ä½œç³»ç»Ÿå‘ç°æœ‰å°‘äº LW ä¸ªé¡µå¯ç”¨æ—¶ï¼Œåå°è´Ÿè´£é‡Šæ”¾å†…å­˜çš„çº¿ç¨‹å°±ä¼šå¼€å§‹è¿è¡Œï¼Œç›´åˆ°æœ‰ HW ä¸ªå¯ç”¨ç‰©ç†é¡µã€‚\né¡µç½®æ¢ç­–ç•¥ å†…å­˜å…¶å®åªåŒ…å«äº†ç³»ç»Ÿä¸­æ‰€æœ‰é¡µçš„å­é›†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºç³»ç»Ÿä¸­è™šæ‹Ÿå†…å­˜é¡µçš„ç¼“å­˜ã€‚ä»ç£ç›˜è·å–é¡µå°±æ˜¯ç¼“å­˜æœªå‘½ä¸­ï¼Œä»å†…å­˜ä¸­æ‰¾åˆ°å¾…è®¿é—®çš„é¡µå°±æ˜¯ç¼“å­˜å‘½ä¸­ã€‚\næœ€ä¼˜æ›¿æ¢ç­–ç•¥ï¼šæ›¿æ¢å†…å­˜ä¸­åœ¨æœ€è¿œå°†æ¥æ‰ä¼šè¢«è®¿é—®åˆ°çš„é¡µï¼Œè¿™æ ·èƒ½è¾¾åˆ°æœ€ä½çš„ç¼“å­˜å‘½ä¸­ç‡ã€‚\nFIFOï¼šå…ˆå…¥å…ˆå‡ºæ›¿æ¢ç­–ç•¥ã€‚\néšæœºç­–ç•¥ï¼šåœ¨å†…å­˜æ»¡çš„æ—¶å€™éšæœºé€‰æ‹©ä¸€ä¸ªé¡µè¿›è¡Œæ›¿æ¢ã€‚\nLRUï¼ˆLeast-Recently-Usedï¼‰ï¼šæ›¿æ¢æœ€è¿‘ä½¿ç”¨æœ€å°‘çš„é¡µé¢ã€‚\nLFUï¼ˆLeast-Frequently-Usedï¼‰ï¼šæ›¿æ¢æœ€è¿‘å˜´éƒ¨ç»å¸¸ä½¿ç”¨çš„é¡µé¢ã€‚\næŠ–åŠ¨ï¼ˆtrashingï¼‰ï¼šå½“å†…å­˜è¢«è¶…é¢è¯·æ±‚æ—¶ï¼Œæ“ä½œç³»ç»Ÿå°†ä¼šä¸æ–­åœ°è¿›è¡Œæ¢é¡µã€‚\n","href":"/notebook/reading_notes/ostep/virtualization-memory/","title":"å†…å­˜è™šæ‹ŸåŒ–"},{"content":"è¿›ç¨‹ è¿›ç¨‹å³è¿è¡Œä¸­çš„ç¨‹åºã€‚ç¨‹åºæœ¬èº«æ˜¯æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå®ƒåªæ˜¯å­˜åœ¨ç£ç›˜ä¸Šçš„ä¸€äº›æŒ‡ä»¤ï¼ˆä¹Ÿå¯èƒ½æ˜¯ä¸€äº›é™æ€æ•°æ®ï¼‰ã€‚äº‹å®è¡¨æ˜ï¼Œäººä»¬é€šå¸¸å¸Œæœ›åŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºã€‚\n å…³é”®é—®é¢˜ï¼šå¦‚ä½•æä¾›æœ‰è®¸å¤š CPU çš„å‡è±¡ï¼Ÿ\n æ“ä½œç³»ç»Ÿé€šè¿‡ CPU è™šæ‹ŸåŒ–æä¾›æœ‰è®¸å¤š CPU çš„å‡è±¡ï¼Œå…è®¸ä¸€ä¸ªè¿›ç¨‹è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œç„¶ååˆ‡æ¢åˆ°å…¶å®ƒè¿›ç¨‹ï¼Œè¿™å°±æ˜¯æ—¶åˆ†å…±äº«ï¼ˆtime sharingï¼‰æŠ€æœ¯ã€‚æ—¶åˆ†å…±äº«çš„æ½œåœ¨ç¼ºç‚¹å°±æ˜¯æ€§èƒ½æŸå¤±ï¼Œå› ä¸ºå¦‚æœ CPU å¿…é¡»å…±äº«ï¼Œé‚£ä¹ˆæ¯ä¸ªè¿›ç¨‹çš„è¿è¡Œå°±ä¼šæ…¢ä¸€ç‚¹ã€‚\nè¦å®ç°å¥½ CPU è™šæ‹ŸåŒ–ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ä¸€äº›åº•å±‚æœºåˆ¶ï¼ˆmechanismï¼‰å’Œé«˜çº§ç­–ç•¥ï¼ˆpolicyï¼‰ã€‚åº•å±‚æœºåˆ¶æ˜¯ä¸€äº›åº•å±‚æ–¹æ³•æˆ–åè®®ï¼Œå®ç°äº†æ‰€éœ€çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆcontext switchï¼‰ã€‚è€Œé«˜çº§ç­–ç•¥åˆ™æ˜¯åœ¨æ“ä½œç³»ç»Ÿå†…åšå‡ºæŸç§å†³å®šçš„ç®—æ³•ï¼Œæ¯”å¦‚è°ƒåº¦ç­–ç•¥ã€‚\næ“ä½œç³»ç»Ÿä¸ºæ­£åœ¨è¿è¡Œçš„ç¨‹åºæä¾›çš„æŠ½è±¡ï¼Œå°±æ˜¯æ‰€è°“çš„è¿›ç¨‹ï¼ˆprocessï¼‰ã€‚è¦ç†è§£æ„æˆè¿›ç¨‹çš„æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¿…é¡»ç†è§£è¿›ç¨‹çš„æœºå™¨çŠ¶æ€ï¼ˆmachine stateï¼‰ï¼šç¨‹åºåœ¨è¿è¡Œæ—¶å¯ä»¥è¯»å–æˆ–æ›´æ–°çš„å†…å®¹ã€‚å†…å­˜æ˜¯è¿›ç¨‹çš„æœºå™¨çŠ¶æ€çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼ŒæŒ‡ä»¤ä½äºå†…å­˜ä¸­ï¼Œç¨‹åºè¯»å†™çš„æ•°æ®ä¹Ÿåœ¨å†…å­˜ä¸­ï¼›è¿›ç¨‹çš„æœºå™¨çŠ¶æ€çš„å¦ä¸€éƒ¨åˆ†æ˜¯å¯„å­˜å™¨ï¼›ç”±äºç¨‹åºç»å¸¸è®¿é—®æŒä¹…å­˜å‚¨è®¾å¤‡ï¼Œæ­¤ç±» I/O ä¿¡æ¯å¯èƒ½åŒ…å«å½“å‰æ‰“å¼€çš„æ–‡ä»¶åˆ—è¡¨ã€‚\nè¿›ç¨‹çš„åˆ›å»º  æ“ä½œç³»ç»Ÿå¦‚ä½•å°†ç¨‹åºè½¬åŒ–ä¸ºè¿›ç¨‹ï¼Ÿ\n è¦å°†ç¨‹åºè½¬åŒ–ä¸ºè¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦å®Œæˆä»¥ä¸‹å·¥ä½œï¼š\n å°†ä»£ç å’Œæ‰€æœ‰é™æ€æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼ŒåŠ è½½åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ã€‚ ä¸ºç¨‹åºçš„è¿è¡Œæ—¶æ ˆåˆ†é…ä¸€äº›å†…å­˜ã€‚C è¯­è¨€ä¸­çš„æ ˆç”¨äºå­˜æ”¾å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°å’Œè¿”å›åœ°å€ã€‚ æ“ä½œç³»ç»Ÿä¹Ÿå¯èƒ½ä¸ºç¨‹åºçš„å †åˆ†é…ä¸€äº›å†…å­˜ã€‚C è¯­è¨€ä¸­çš„å †ç”¨äºæ˜¾å¼è¯·æ±‚çš„åŠ¨æ€åˆ†é…æ•°æ®ã€‚ æ‰§è¡Œå…¶å®ƒåˆå§‹åŒ–ä»»åŠ¡ï¼Œç‰¹åˆ«æ˜¯ä¸ I/O ç›¸å…³çš„ä»»åŠ¡ã€‚ å¯åŠ¨ç¨‹åºã€‚OS å°† CPU çš„æ§åˆ¶è½¬è½¬äº¤ç»™æ–°åˆ›å»ºçš„è¿›ç¨‹ï¼Œç¨‹åºå¼€å§‹è¿è¡Œã€‚  è¿›ç¨‹çŠ¶æ€ æ—©æœŸçš„è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹å¯ä»¥å¤„äºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼š\n è¿è¡Œï¼ˆrunningï¼‰ï¼šè¿›ç¨‹æ­£åœ¨å¤„ç†å™¨ä¸Šè¿è¡Œï¼Œè¿™æ„å‘³ç€è¿›ç¨‹æ­£åœ¨æ‰§è¡ŒæŒ‡ä»¤ã€‚ å°±ç»ªï¼ˆreadyï¼‰ã€‚è¿›ç¨‹å·²ç»å‡†å¤‡å¥½ï¼Œä½†ç”±äºæŸäº›åŸå› ï¼Œæ“ä½œç³»ç»Ÿé€‰æ‹©ä¸åœ¨æ­¤æ—¶è¿è¡Œè¯¥è¿›ç¨‹ã€‚ é˜»å¡ï¼ˆblockedï¼‰ï¼šè¿›ç¨‹ç­‰å¾…ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶æ‰ä¼šå‡†å¤‡è¿è¡Œï¼Œæ¯”å¦‚ç­‰å¾… I/O å®Œæˆã€‚  è¿›ç¨‹çš„æ•°æ®ç»“æ„ æ“ä½œç³»ç»Ÿä¹Ÿæ˜¯ä¸€ä¸ªç¨‹åºï¼Œå’Œå…¶å®ƒç¨‹åºä¸€æ ·ï¼Œå®ƒç»´æŠ¤äº†ä¸€äº›å…³é”®çš„æ•°æ®ç»“æ„ï¼Œç”¨æ¥è·Ÿè¸ªå„ç§ç›¸å…³çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ xv6 å†…æ ¸ä¸­çš„è¿›ç¨‹ç»“æ„ï¼š\n// the registers xv6 will save and restore // to stop and subsequently restart a process struct context { int eip; int esp; int ebx; int ecx; int edx; int esi; int edi; int ebp; }; // the different states a process can be in enum proc_state { UNUSED, EMBRYO, SLEEPING, RUNNABLE, RUNNING, ZOMBIE }; // the information xv6 tracks about each process // including its register context and state struct proc { char *mem; // Start of process memory  uint sz; // Size of process memory  char *kstack; // Bottom of kernel stack for this process  enum proc_state state; // Process state  int pid; // Process ID  struct proc *parent; // Parent process  void *chan; // If !zero, sleeping on chan  int killed; // If !zero, has been killed  struct file *ofile[NOFILE]; // Open files  struct inode *cwd; // Current directory  struct context context; // Switch here to run process  struct trapframe *tf; // Trap frame for the current interrupt }; Limited Direct Execution æ“ä½œç³»ç»Ÿé€šè¿‡è™šæ‹ŸåŒ– CPU è®©å¤šä¸ªä»»åŠ¡å…±äº«ç‰©ç† CPUï¼Œä½†æ˜¯åœ¨æ„å»ºè¿™æ ·çš„è™šæ‹ŸåŒ–æ—¶å­˜åœ¨ä¸€äº›æŒ‘æˆ˜ï¼šå…¶ä¸€æ˜¯æ€§èƒ½ï¼Œå…¶äºŒæ˜¯æ§åˆ¶æƒã€‚æ§åˆ¶æƒå¯¹äºæ“ä½œç³»ç»Ÿå°¤ä¸ºé‡è¦ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿè´Ÿè´£èµ„æºç®¡ç†ã€‚æ“ä½œç³»ç»Ÿåº”ä»¥é«˜æ€§èƒ½çš„æ–¹å¼è™šæ‹ŸåŒ– CPUï¼ŒåŒæ—¶ä¿æŒå¯¹ç³»ç»Ÿçš„æ§åˆ¶ã€‚\n å…³é”®é—®é¢˜ï¼šå¦‚ä½•é«˜æ•ˆã€å¯æ§åœ°è™šæ‹ŸåŒ– CPUï¼Ÿ\n å—é™ç›´æ¥æ‰§è¡Œï¼ˆLimited Direct Executionï¼‰æ˜¯æ“ä½œç³»ç»Ÿå¼€å‘äººå‘˜æƒ³å‡ºçš„ä¸€ç§æŠ€æœ¯ï¼Œç›®çš„æ˜¯è®©ç¨‹åºå°½å¯èƒ½å¿«åœ°è¿è¡Œã€‚â€œå—é™â€è¡¨ç¤ºæ“ä½œç³»ç»Ÿéœ€è¦å…·å¤‡æ§åˆ¶æƒï¼Œè¿›ç¨‹ä¼šå—åˆ°ä¸€å®šçš„é™åˆ¶ï¼Œâ€œç›´æ¥æ‰§è¡Œâ€å°±è¡¨ç¤ºåœ¨ CPU ä¸Šè¿è¡Œç¨‹åºã€‚\nå—é™åˆ¶çš„æ“ä½œ ç›´æ¥æ‰§è¡Œæœ‰ä¸€ä¸ªæ˜æ˜¾çš„ä¼˜åŠ¿â€”â€”å¿«é€Ÿï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘å½“è¿›ç¨‹å¸Œæœ›æ‰§è¡ŒæŸç§å—é™æ“ä½œæ—¶ï¼ˆæ¯”å¦‚ç£ç›˜ I/Oï¼‰è¯¥æ€ä¹ˆåŠï¼Ÿ\n å…³é”®é—®é¢˜ï¼šå¦‚ä½•æ‰§è¡Œå—é™åˆ¶çš„æ“ä½œï¼Ÿè¿›ç¨‹å¿…é¡»èƒ½å¤Ÿæ‰§è¡ŒI/Oç­‰å—é™æ“ä½œï¼Œä½†åˆä¸èƒ½å®Œå…¨è®©è¿›ç¨‹æ§åˆ¶ç³»ç»Ÿã€‚\n ç”¨æˆ·æ¨¡å¼ä¸å†…æ ¸æ¨¡å¼ æ“ä½œç³»ç»Ÿä¸ç¡¬ä»¶åä½œï¼Œç¡¬ä»¶æä¾›ä¸åŒçš„æ‰§è¡Œæ¨¡å¼ã€‚åœ¨ ç”¨æˆ·æ¨¡å¼ï¼ˆuser modeï¼‰ ä¸‹ï¼Œåº”ç”¨ç¨‹åºä¸èƒ½è®¿é—®å…¨éƒ¨çš„ç¡¬ä»¶èµ„æºï¼Œè€Œåœ¨ å†…æ ¸æ¨¡å¼ï¼ˆkernel modeï¼‰ ä¸‹ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥è®¿é—®æœºå™¨çš„å…¨éƒ¨èµ„æºã€‚\nåœ¨ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œè¿è¡Œçš„ä»£ç ä¼šå—åˆ°é™åˆ¶ã€‚åœ¨å†…æ ¸æ¨¡å¼ä¸‹ï¼Œè¿è¡Œçš„ä»£ç å¯ä»¥åšä»»ä½•äº‹ï¼Œæ“ä½œç³»ç»Ÿï¼ˆæˆ–å†…æ ¸ï¼‰å°±è¿è¡Œåœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ã€‚\nç³»ç»Ÿè°ƒç”¨å…è®¸å†…æ ¸å‘ç”¨æˆ·ç¨‹åºæš´éœ²æŸäº›å…³é”®åŠŸèƒ½ï¼Œè¦æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œç¨‹åºå¿…é¡»æ‰§è¡Œç‰¹æ®Šçš„ é™·é˜±ï¼ˆtrapï¼‰ æŒ‡ä»¤ã€‚è¯¥æŒ‡ä»¤åŒæ—¶è·³å…¥å†…æ ¸å¹¶å°†ç‰¹æƒçº§åˆ«æå‡åˆ°å†…æ ¸æ¨¡å¼ã€‚ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œå®Œæˆåï¼Œæ“ä½œç³»ç»Ÿè°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„ ä»é™·é˜±è¿”å›ï¼ˆreturn-from-trapï¼‰ æŒ‡ä»¤ï¼Œè¿”å›åˆ°å‘èµ·è°ƒç”¨çš„ç”¨æˆ·ç¨‹åºä¸­ï¼ŒåŒæ—¶å°†ç‰¹æƒçº§åˆ«é™ä½ï¼Œå›åˆ°ç”¨æˆ·æ¨¡å¼ã€‚\nåœ¨æ‰§è¡Œé™·é˜±æ—¶ï¼Œç¡¬ä»¶å¿…é¡»ç¡®ä¿ä¿å­˜è¶³å¤Ÿçš„è°ƒç”¨è€…å¯„å­˜å™¨ï¼Œä»¥ä¾¿åœ¨æ“ä½œç³»ç»Ÿå‘å‡ºä»é™·é˜±è¿”å›æŒ‡ä»¤æ—¶èƒ½æ­£ç¡®åœ°è¿”å›ã€‚é‚£ä¹ˆé™·é˜±å¦‚ä½•çŸ¥é“åœ¨ OS å†…è¿è¡Œå“ªäº›ä»£ç å‘¢ï¼Ÿå†…æ ¸é€šè¿‡åœ¨å¯åŠ¨æ—¶è®¾ç½® é™·é˜±è¡¨ï¼ˆtrap tableï¼‰ æ¥å‘ˆç°éœ€è¦åœ¨ OS å†…è¿è¡Œçš„ä»£ç ã€‚æ“ä½œç³»ç»Ÿå¯åŠ¨æ—¶åšçš„æœ‰ä¸€ä»¶äº‹æƒ…å°±æ˜¯å‘Šè¯‰ç¡¬ä»¶åœ¨å‘ç”ŸæŸäº›å¼‚å¸¸äº‹ä»¶æ—¶è¦è¿è¡Œå“ªäº›ä»£ç ã€‚\nä¸‹é¢çš„æ—¶é—´çº¿å¯¹é¦–å…ˆç›´æ¥è¿è¡Œåè®®è¿›è¡Œäº†æ€»ç»“ã€‚æ•´ä¸ªè¿‡ç¨‹å‡è®¾æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå†…æ ¸æ ˆï¼Œåœ¨è¿›å…¥å†…æ ¸æ—¶ä¿å­˜å¯„å­˜å™¨å†…å®¹ï¼Œåœ¨ç¦»å¼€å†…æ ¸æ—¶æ¢å¤å¯„å­˜å™¨å†…å®¹ã€‚\nLDE åè®®æœ‰ä¸¤ä¸ªé˜¶æ®µã€‚ç¬¬ä¸€ä¸ªé˜¶æ®µï¼ˆåœ¨ç³»ç»Ÿå¼•å¯¼æ—¶ï¼‰ï¼Œå†…æ ¸åˆå§‹åŒ–é™·é˜±è¡¨ï¼Œå¹¶ä¸” CPU è®°ä½å®ƒçš„ä½ç½®ä»¥ä¾›éšåä½¿ç”¨ã€‚å†…æ ¸é€šè¿‡ç‰¹æƒæŒ‡ä»¤æ¥æ‰§è¡Œæ­¤æ“ä½œï¼ˆæ‰€æœ‰ç‰¹æƒæŒ‡ä»¤å‡ä»¥ç²—ä½“çªå‡ºæ˜¾ç¤ºï¼‰ã€‚ç¬¬äºŒä¸ªé˜¶æ®µï¼ˆè¿è¡Œè¿›ç¨‹æ—¶ï¼‰ï¼Œåœ¨ä½¿ç”¨ä»é™·é˜±è¿”å›æŒ‡ä»¤å¼€å§‹æ‰§è¡Œè¿›ç¨‹ä¹‹å‰ï¼Œå†…æ ¸è®¾ç½®äº†ä¸€äº›å†…å®¹ï¼ˆä¾‹å¦‚ï¼Œåœ¨è¿›ç¨‹åˆ—è¡¨ä¸­åˆ†é…ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ†é…å†…å­˜ï¼‰ã€‚è¿™ä¼šå°† CPU åˆ‡æ¢åˆ°ç”¨æˆ·æ¨¡å¼å¹¶å¼€å§‹è¿è¡Œè¯¥è¿›ç¨‹ã€‚å½“è¿›ç¨‹å¸Œæœ›å‘å‡ºç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå®ƒä¼šé‡æ–°é™·å…¥æ“ä½œç³»ç»Ÿï¼Œç„¶åå†æ¬¡é€šè¿‡ä»é™·é˜±è¿”å›ï¼Œå°†æ§åˆ¶æƒè¿˜ç»™è¿›ç¨‹ã€‚è¯¥è¿›ç¨‹ç„¶åå®Œæˆå®ƒçš„å·¥ä½œï¼Œå¹¶ä» main()è¿”å›ã€‚è¿™é€šå¸¸ä¼šè¿”å›åˆ°ä¸€äº›å­˜æ ¹ä»£ç ï¼Œå®ƒå°†æ­£ç¡®é€€å‡ºè¯¥ç¨‹åºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡è°ƒç”¨ exit()ç³»ç»Ÿè°ƒç”¨ï¼Œè¿™å°†é™·å…¥ OS ä¸­ï¼‰ã€‚æ­¤æ—¶ï¼ŒOS æ¸…ç†å¹²å‡€ï¼Œä»»åŠ¡å®Œæˆäº†ã€‚\nè¿›ç¨‹åˆ‡æ¢  å…³é”®é—®é¢˜ï¼šæ“ä½œç³»ç»Ÿå¦‚ä½•é‡è· CPU çš„æ§åˆ¶æƒï¼Œä»¥ä¾¿å®ƒå¯ä»¥åœ¨è¿›ç¨‹é—´åˆ‡æ¢ï¼Ÿ\n åä½œæ–¹å¼ è¿‡å»æŸäº›ç³»ç»Ÿé‡‡ç”¨äº†ä¸€ç§è¢«ç§°ä¸ºåä½œï¼ˆcooperativeï¼‰çš„æ–¹å¼ï¼Œåœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œæ“ä½œç³»ç»Ÿç›¸ä¿¡è¿›ç¨‹ä¼šåˆç†è¿è¡Œï¼Œè¿è¡Œæ—¶é—´è¿‡ç¨‹çš„è¿›ç¨‹ä¼šå®šæœŸæ”¾å¼ƒ CPUï¼ˆé€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œä»¥ä¾¿æ“ä½œç³»ç»Ÿè¿è¡Œå…¶å®ƒä»»åŠ¡ã€‚\né€šå¸¸æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»å¤„ç†ç³»ç»Ÿä¸­çš„ä¸å½“è¡Œä¸ºï¼Œå¦‚æœæŸäº›è¿›ç¨‹æ‰§è¡Œäº†éæ³•æ“ä½œï¼Œæ“ä½œç³»ç»Ÿéœ€è¦é‡æ–°æ§åˆ¶ CPUã€‚åœ¨åä½œæ–¹å¼ä¸­ï¼ŒæŸä¸ªè¿›ç¨‹è‹¥å¼€å¯æ— é™å¾ªç¯ï¼Œå¹¶ä¸”ä¸è¿›è¡Œ yield ç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿåˆ™æ— æ³•åšä»»ä½•äº‹æƒ…ã€‚å”¯ä¸€çš„è§£å†³æ–¹å¼å°±æ˜¯é‡å¯ã€‚\néåä½œæ–¹å¼ é€šè¿‡ æ—¶é’Ÿä¸­æ–­ï¼ˆtimer interruptï¼‰ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥ä»¥éåä½œçš„æ–¹å¼è·å– CPU çš„æ§åˆ¶æƒã€‚æ—¶é’Ÿè®¾å¤‡å®šæ—¶äº§ç”Ÿä¸­æ–­ï¼Œäº§ç”Ÿä¸­æ–­æ—¶ï¼Œå½“å‰è¿è¡Œçš„ç¨‹åºåœæ­¢ï¼Œæ“ä½œç³»ç»Ÿé¢„å…ˆé…ç½®çš„ä¸­æ–­å¤„ç†ç¨‹åºä¼šè¿è¡Œã€‚æ­¤æ—¶ï¼Œæ“ä½œç³»ç»Ÿé‡æ–°è·å¾— CPU æ§åˆ¶æƒï¼Œå°±å¯ä»¥åšä»»ä½•äº‹æƒ…äº†ï¼Œæ¯”å¦‚åœæ­¢å½“å‰è¿›ç¨‹å¹¶å¯åŠ¨å¦ä¸€ä¸ªè¿›ç¨‹ã€‚\nåœ¨å‘ç”Ÿä¸­æ–­æ—¶ï¼Œç¡¬ä»¶éœ€è¦ä¸ºå½“å‰æ­£åœ¨è¿è¡Œçš„ç¨‹åºä¿å­˜è¶³å¤Ÿçš„çŠ¶æ€ï¼Œä»¥ä¾¿ä»é™·é˜±è¿”å›æŒ‡ä»¤èƒ½å¤Ÿæ­£ç¡®æ¢å¤è¯¥ç¨‹åºã€‚\nä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆcontext switchï¼‰ ï¼šæ“ä½œç³»ç»Ÿè¦åšçš„å°±æ˜¯ä¸ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ä¿å­˜ä¸€äº›å¯„å­˜å™¨çš„å€¼ï¼ˆä¾‹å¦‚ï¼Œåˆ°å®ƒçš„å†…æ ¸æ ˆï¼‰ï¼Œå¹¶ä¸ºå³å°†æ‰§è¡Œçš„è¿›ç¨‹æ¢å¤ä¸€äº›å¯„å­˜å™¨çš„å€¼ï¼ˆä»å®ƒçš„å†…æ ¸æ ˆï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ“ä½œç³»ç»Ÿå°±å¯ä»¥ç¡®ä¿æœ€åæ‰§è¡Œä»é™·é˜±è¿”å›æŒ‡ä»¤æ—¶ï¼Œä¸æ˜¯è¿”å›åˆ°ä¹‹å‰è¿è¡Œçš„è¿›ç¨‹ï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œå¦ä¸€ä¸ªè¿›ç¨‹ã€‚\nä¸‹é¢æ˜¯åŸºäºæ—¶é’Ÿçš„ LDE åè®®ï¼š\nè¿›ç¨‹è°ƒåº¦  å…³é”®é—®é¢˜ï¼šå¦‚ä½•å¼€å‘è°ƒåº¦ç­–ç•¥ï¼Ÿä»€ä¹ˆæ˜¯å…³é”®å‡è®¾ï¼Ÿå“ªäº›æŒ‡æ ‡éå¸¸é‡è¦ï¼Ÿ\n ç¡®å®šå·¥ä½œè´Ÿè½½ï¼ˆworkloadï¼‰æ˜¯æ„å»ºè°ƒåº¦ç­–ç•¥çš„å…³é”®éƒ¨åˆ†ã€‚å·¥ä½œè´Ÿè½½äº†è§£å¾—è¶Šå¤šï¼Œä½ çš„è°ƒåº¦ç­–ç•¥å°±èƒ½è¶Šä¼˜åŒ–ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›è°ƒåº¦æŒ‡æ ‡ï¼Œç”¨æ¥æ¯”è¾ƒä¸åŒçš„è°ƒåº¦ç­–ç•¥ã€‚ä¸€ä¸ªåŸºæœ¬çš„è°ƒåº¦æŒ‡æ ‡æ˜¯ å‘¨è½¬æ—¶é—´ï¼ˆturnround timeï¼‰ã€‚\nä»»åŠ¡çš„å‘¨è½¬æ—¶é—´å³ä»»åŠ¡å®Œæˆæ—¶é—´å‡å»ä»»åŠ¡åˆ°è¾¾ç³»ç»Ÿçš„æ—¶é—´ï¼š\n$$ T_{å‘¨è½¬æ—¶é—´} = T_{å®Œæˆæ—¶é—´} - T_{åˆ°è¾¾æ—¶é—´} $$\nå‘¨è½¬æ—¶é—´æ˜¯ä¸€ä¸ªæ€§èƒ½æŒ‡æ ‡ã€‚è¿˜æœ‰ä¸€ä¸ªæœ‰è¶£çš„æŒ‡æ ‡â€”â€” å…¬å¹³æ€§ï¼ˆfairnessï¼‰ã€‚æ€§èƒ½å’Œå…¬å¹³æ€§åœ¨è°ƒåº¦ç³»ç»Ÿä¸­å¾€å¾€æ˜¯çŸ›ç›¾çš„ã€‚\nå…ˆè¿›å…ˆå‡º å…ˆè¿›å…ˆå‡ºï¼ˆFirst In First Outï¼ŒFIFOï¼‰è°ƒåº¦æ˜¯ä¸€ç§åŸºæœ¬çš„ç®—æ³•ï¼Œæœ‰æ—¶å€™åˆç§°ä¸ºå…ˆæ¥å…ˆæœåŠ¡ï¼ˆFirst Come First Serviceï¼ŒFCFSï¼‰ã€‚FIFO çš„è°ƒåº¦æ€æƒ³æ˜¯ï¼šå…ˆè¿è¡Œæœ€å…ˆè¾¾åˆ°ç³»ç»Ÿçš„ä»»åŠ¡ï¼Œç„¶åæ˜¯ç¬¬äºŒåˆ°è¾¾çš„ï¼Œä»¥æ­¤ç±»æ¨ã€‚\nå‡è®¾ Aã€Bã€C ä¸‰ä¸ªä»»åŠ¡å‡ ä¹åŒæ—¶åˆ°è¾¾ç³»ç»Ÿï¼ˆA æ¯” B æ—©ä¸€ç‚¹ç‚¹ï¼ŒB æ¯” C æ—©ä¸€ç‚¹ç‚¹ï¼‰ï¼Œè‹¥é‡‡ç”¨ FIFO è°ƒåº¦ç­–ç•¥ï¼Œåˆ™è°ƒåº¦å™¨ä¼šå…ˆæ‰§è¡Œ Aï¼Œç„¶åæ‰§è¡Œ Bï¼Œæœ€åæ‰§è¡Œ Cã€‚ä»å›¾ FIFO 1 å¯ä»¥çœ‹å‡ºï¼šA åœ¨ 10s å®Œæˆï¼ŒB åœ¨ 20 ç§’å®Œæˆï¼ŒC åœ¨ 30 ç§’å®Œæˆã€‚é‚£ä¹ˆè¿™ä¸‰ä¸ªä»»åŠ¡çš„å¹³å‡å‘¨è½¬æ—¶é—´å°±æ˜¯ $\\frac {10 + 20 + 30}{30} = 20 $ã€‚ä½†æ˜¯ï¼Œè‹¥ä¸‰ä¸ªä»»åŠ¡çš„è¿è¡Œæƒ…å†µå¦‚å›¾ FIFO 2 æ‰€ç¤ºçš„è¯ï¼Œä¸‰ä¸ªä»»åŠ¡çš„å¹³å‡å‘¨è½¬æ—¶é—´å°±æ˜¯ $\\frac {100 + 110 + 120}{3} = 110$ã€‚\nç¬¬äºŒç§æƒ…å†µé€šå¸¸è¢«ç§°ä¸º æŠ¤èˆªæ•ˆåº”ï¼ˆconvoy effectï¼‰ï¼Œå³ä¸€äº›è€—æ—¶çŸ­è¾ƒå°‘çš„æ½œåœ¨èµ„æºæ¶ˆè€—è€…æ’åœ¨é‡é‡çº§çš„èµ„æºæ¶ˆè´¹è€…ä¹‹åã€‚è¿™å¯¹äºè€—æ—¶è¾ƒçŸ­çš„ä»»åŠ¡æ¥è¯´ï¼Œå¹¶ä¸å‹å¥½ã€‚\næœ€çŸ­ä»»åŠ¡ä¼˜å…ˆ æœ€çŸ­ä»»åŠ¡ä¼˜å…ˆï¼ˆShortest Job Firstï¼Œ SJFï¼‰æ˜¯å¦ä¸€ç§è°ƒåº¦ç®—æ³•ï¼Œè§£å†³äº† FIFO ç®—æ³•ä¸­è€—æ—¶è¾ƒçŸ­çš„ä»»åŠ¡ç­‰å¾…æ—¶é—´å¯èƒ½è¿‡é•¿çš„é—®é¢˜ã€‚SJF çš„è°ƒåº¦æ€æƒ³æ˜¯ï¼šå…ˆè¿è¡Œæœ€çŸ­çš„ä»»åŠ¡ï¼Œç„¶åæ˜¯è¯çŸ­çš„ä»»åŠ¡ï¼Œä»¥æ­¤ç±»æ¨ã€‚\nå‡è®¾ Aã€Bã€C åŒæ—¶åˆ°è¾¾ï¼ˆå›¾ SJF 1ï¼‰ï¼ŒæŒ‰ç…§ SJF åŸåˆ™ï¼Œç³»ç»Ÿä¼šå…ˆè¿è¡Œ Aï¼Œç„¶åè¿è¡Œ Bï¼Œæœ€åè¿è¡Œ Cã€‚å› æ­¤ï¼ŒSJF å¯ä»¥å°† 110s çš„å¹³å‡å‘¨è½¬æ—¶é—´é™ä½åˆ° $\\frac {10 + 20 + 120}{3} = 50$ã€‚äº‹å®ä¸Šï¼Œå½“æ‰€æœ‰ä»»åŠ¡åŒæ—¶åˆ°è¾¾ç³»ç»Ÿæ—¶ï¼ŒSJF è¢«è¯æ˜æ˜¯ä¸€ä¸ªæœ€ä¼˜çš„è°ƒåº¦ç®—æ³•ã€‚ä½†æ˜¯ SJF ç®—æ³•ä¹Ÿå­˜åœ¨é—®é¢˜ï¼Œå‡è®¾ A å…ˆåˆ°è¾¾ï¼Œ10s ä¹‹å Bã€C ä¹Ÿåˆ°è¾¾ï¼ˆå›¾ SJF 2ï¼‰äº†ï¼Œä¸‰ä¸ªä»»åŠ¡çš„å¹³å‡å‘¨è½¬æ—¶é—´åˆ™æ˜¯ $\\frac {100 + (110 - 10) + (120 - 10)}{3} = 103.33$ï¼Œä»ç„¶å‡ºç°äº†æŠ¤èˆªæ•ˆåº”ã€‚\næœ€çŸ­å®Œæˆæ—¶é—´ä¼˜å…ˆ SJF è°ƒåº¦ç®—æ³•æ˜¯éæŠ¢å å¼ï¼ˆnon-preemptiveï¼‰ï¼Œè€Œæœ€çŸ­å®Œæˆæ—¶é—´ä¼˜å…ˆï¼ˆShortest Time-to-Completion Firstï¼ŒSTCFï¼‰æˆ–æŠ¢å å¼æœ€çŸ­ä½œä¸šä¼˜å…ˆï¼ˆPreemptive Shortest Job Firstï¼ŒPSJFï¼‰æ˜¯ SJF çš„æŠ¢å å¼ç‰ˆæœ¬ã€‚æ¯å½“æ–°ä»»åŠ¡è¿›å…¥ç³»ç»Ÿæ—¶ï¼Œè°ƒåº¦ç¨‹åºå°±ä¼šè®¡ç®—å‰©ä½™ä»»åŠ¡å’Œæ–°ä»»åŠ¡ä¹‹é—´ï¼Œå“ªä¸ªä»»åŠ¡çš„å‰©ä½™æ—¶é—´æœ€çŸ­ï¼Œç„¶åè°ƒåº¦è¯¥ä»»åŠ¡ã€‚\nè¿˜æ˜¯ä¸Šä¸€ä¸ªä¾‹å­ï¼Œé‡‡ç”¨ STCF ç®—æ³•ï¼Œå¹³å‡å‘¨è½¬æ—¶é—´å¤§å¤§æé«˜ï¼š$\\frac {120 + (20 - 10) + (30 - 10)}{3} = 50$\nè½®è½¬ å‘¨è½¬æ—¶é—´å…³å¿ƒçš„æ˜¯ä»»åŠ¡å®Œæˆçš„å¿«æ…¢ï¼Œé€‚åˆæ‰¹å¤„ç†ç³»ç»Ÿã€‚è€Œåœ¨åˆ†æ—¶ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å°±åœ¨ç³»ç»Ÿå‰é¢ï¼ŒæœŸæœ›ç³»ç»Ÿå…·æœ‰è‰¯å¥½çš„äº¤äº’æ€§ã€‚å› æ­¤ï¼Œæ–°çš„è°ƒåº¦æŒ‡æ ‡â€”â€”å“åº”æ—¶é—´ï¼ˆresponse timeï¼‰ å‡ºç°äº†ã€‚å“åº”æ—¶é—´æŒ‡çš„æ˜¯ä»ä»»åŠ¡åˆ°è¾¾ç³»ç»Ÿåˆ°ç³»ç»Ÿé¦–æ¬¡è¿è¡Œå®ƒçš„æ—¶é—´ï¼Œå³\n$$T_{å“åº”æ—¶é—´} = T_{é¦–æ¬¡è¿è¡Œ} - T_{åˆ°è¾¾æ—¶é—´} $$\nåœ¨ STCF çš„ä¾‹å­ä¸­ï¼Œå‘¨è½¬æ—¶é—´å¾ˆå¥½ï¼Œä½†æ˜¯å“åº”æ—¶é—´å°±æ²¡é‚£ä¹ˆå¥½äº†ï¼Œå¦‚æœç”¨æˆ·åœ¨ç³»ç»Ÿå“åº”å‰ä¸å¾—ä¸ç­‰å¾… 10s,é‚£å°±å¤ªç³Ÿç³•äº†ï¼ç°åœ¨æ€è€ƒæ–°çš„é—®é¢˜ï¼Œå¦‚ä½•æ„å»ºå¯¹å“åº”æ—¶é—´æ•æ„Ÿçš„ç¨‹åºï¼Ÿ\næœ‰ä¸€ç§ç®€å•çš„è°ƒåº¦ç®—æ³•ï¼Œå«åšè½®è½¬ï¼ˆRound-Robinï¼ŒRRï¼‰ã€‚å®ƒçš„åŸºæœ¬æ€æƒ³å¾ˆç®€å•ï¼šRR åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡å†…è¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œç„¶ååˆ‡æ¢è‡³è¿è¡Œé˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œåå¤æ‰§è¡Œï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆã€‚æ—¶é—´ç‰‡ï¼ˆtime sliceï¼‰æœ‰æ—¶åˆç§°è°ƒåº¦é‡å­ï¼ˆscheduling quantumï¼‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šæ—¶é—´ç‰‡çš„é•¿åº¦å¿…é¡»æ˜¯æ—¶é’Ÿä¸­æ–­å‘¨æœŸçš„æ•´æ•°å€ã€‚\nå‡è®¾ Aã€Bã€C ä¸‰ä¸ªä»»åŠ¡åŒæ—¶åˆ°è¾¾ç³»ç»Ÿï¼Œå¹¶ä¸”éƒ½å¸Œæœ›è¿è¡Œ 10sã€‚SJF è°ƒåº¦ç¨‹åºå¿…é¡»åœ¨è¿è¡Œå®Œå½“å‰ä»»åŠ¡ä¹‹åæ‰å¯è¿è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼ˆå›¾ RR 1ï¼‰ï¼Œè€Œ 1s çš„æ—¶é—´ç‰‡å¯ä»¥è®© RR è°ƒåº¦ç¨‹åºè°ƒåº¦å„ä»»åŠ¡å¿«é€Ÿåœ°å¾ªç¯å·¥ä½œã€‚SJF çš„å¹³å‡å“åº”æ—¶é—´ä¸ºï¼š$\\frac {0 + 10 + 20}{3} = 10$ï¼Œè€Œ RR çš„å¹³å‡å“åº”æ—¶é—´ä¸ºï¼š$\\frac {0 + 1 + 2}{3} = 1$ã€‚\nå¯ä»¥å‘ç°ï¼Œæ—¶é—´ç‰‡é•¿åº¦ å¯¹ RR è‡³å…³é‡è¦ã€‚æ—¶é—´ç‰‡è¶ŠçŸ­ï¼ŒRR åœ¨å“åº”æ—¶é—´ä¸Šçš„è¡¨ç°å°±è¶Šå¥½ã€‚ç„¶è€Œï¼Œæ—¶é—´ç‰‡ä¹Ÿä¸æ˜¯è¶ŠçŸ­è¶Šå¥½ï¼šé¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å°†å½±å“ç³»ç»Ÿæ•´ä½“æ€§èƒ½ã€‚å› æ­¤ï¼Œç³»ç»Ÿè®¾è®¡è€…éœ€è¦è¡¡é‡æ—¶é—´ç‰‡çš„é•¿åº¦ï¼Œè®¾ç½®ä¸€ä¸ªè¶³å¤Ÿé•¿çš„å€¼ï¼Œä»¥ä¾¿åœ¨æ‘Šé”€ï¼ˆamortizeï¼‰ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬çš„åŒæ—¶ä¿æŒç³»ç»Ÿçš„å“åº”æ€§ã€‚\nå¤šçº§åé¦ˆé˜Ÿåˆ— å¤šçº§åé¦ˆé˜Ÿåˆ—ï¼ˆMulti-level Feedback Queueï¼ŒMLFQï¼‰æ˜¯ä¸€ç§åº”ç”¨äºå…¼å®¹æ—¶åˆ†å…±äº«ç³»ç»Ÿï¼ˆCompatible Time-Sharing Systemï¼‰çš„è°ƒåº¦ç®—æ³•ã€‚å®ƒæœ‰ä¸¤ä¸ªç›®æ ‡ï¼šå…¶ä¸€æ˜¯ä¼˜åŒ–å‘¨è½¬æ—¶é—´ï¼Œå…¶äºŒæ˜¯ç»™ç”¨æˆ·è‰¯å¥½çš„äº¤äº’ä½“éªŒï¼ˆé™ä½å“åº”æ—¶é—´ï¼‰ã€‚\n å…³é”®é—®é¢˜ï¼šæ²¡æœ‰å·¥ä½œé•¿åº¦çš„å…ˆéªŒçŸ¥è¯†ï¼Œå¦‚ä½•è®¾è®¡ä¸€ä¸ªèƒ½åŒæ—¶å‡å°‘å“åº”æ—¶é—´å’Œå‘¨è½¬æ—¶é—´çš„è°ƒåº¦ç¨‹åºã€‚\n æ–¹æ³•æ˜¯ ä»å†å²ä¸­å­¦ä¹ ã€‚MLFQ å°±æ˜¯ç”¨å†å²ç»éªŒé¢„æµ‹æœªæ¥çš„ä¸€ä¸ªå…¸å‹ä¾‹å­ã€‚\nMLFQ ä¸­æœ‰è®¸å¤šç‹¬ç«‹çš„é˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ã€‚ä»»ä½•æ—¶åˆ»ï¼Œä¸€ä¸ªä»»åŠ¡åªèƒ½å­˜åœ¨äºä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚MLFQ æ€»æ˜¯ä¼˜å…ˆæ‰§è¡Œè¾ƒé«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼ˆåœ¨è¾ƒé«˜çº§é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼‰ã€‚å½“ç„¶ï¼Œä¸€ä¸ªé˜Ÿåˆ—ä¸­å¯èƒ½ä¼šæœ‰å¤šä¸ªä»»åŠ¡ï¼ˆè¿™äº›ä»»åŠ¡çš„ä¼˜å…ˆçº§ç›¸åŒï¼‰ï¼Œè¿™æ—¶å¯ä»¥å¯¹å®ƒä»¬é‡‡ç”¨è½®è½¬è°ƒåº¦ã€‚å› æ­¤ï¼ŒMLFQ è°ƒåº¦ç­–ç•¥çš„å…³é”®åœ¨äº å¦‚ä½•è®¾ç½®ä¼˜å…ˆçº§ã€‚\nåŸºæœ¬è§„åˆ™ MLFQ çš„åŸºæœ¬è§„åˆ™ï¼š\n è§„åˆ™ 1ï¼šIf Priority(A) \u0026gt; Priority(B), A runs (B doesn\u0026rsquo;t). è§„åˆ™ 2ï¼šIf Priority(A) = Priority(B), A \u0026amp; B run in RR. è§„åˆ™ 3ï¼šWhen a job enters the system, it is placed at the highest priority (the topmost queue). è§„åˆ™ 4aï¼šIf a job uses up an entire time slice while running, its priority is reduced (i.e., it moves down one queue). è§„åˆ™ 4bï¼šIf a job gives up the CPU before the time slice is up, it stays at the same priority level. è§„åˆ™ 5ï¼šAfter some time period S, move all the jobs in the system to the topmost queue.  è§„åˆ™ 1 å’Œ è§„åˆ™ 2 æ˜¯æœ€åŸºæœ¬çš„ä¸¤æ¡è§„åˆ™ï¼Œç»™å‡ºäº†ä¸¤ä¸ªä»»åŠ¡åœ¨ç»™å®šä¼˜å…ˆçº§ä¸‹çš„æ‰§è¡Œé¡ºåºï¼Œä¼šå‡ºç°ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡é¥¥é¥¿çš„æƒ…å†µã€‚\nè§„åˆ™ 3ã€4aã€4b ç»™å‡ºäº†æ”¹å˜ä¼˜å…ˆçº§çš„è§„åˆ™ã€‚å®ƒèƒ½å¤Ÿæ ¹æ®è´Ÿè½½æƒ…å†µè°ƒæ•´ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œä½¿å¾—è€—æ—¶ä»»åŠ¡ä¹‹é—´å¯ä»¥å…¬å¹³åœ°å…±äº« CPUï¼Œå¹¶ä¸”çŸ­ä»»åŠ¡æˆ–äº¤äº’æ€§ä»»åŠ¡ä¹Ÿèƒ½å¾—åˆ°å¾ˆå¥½çš„å“åº”æ—¶é—´ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨é¥¥é¥¿çš„é—®é¢˜â€”â€”è¿‡å¤šçš„äº¤äº’ä»»åŠ¡ä¼šå¯¼è‡´è€—æ—¶ä»»åŠ¡é¥¥é¥¿ã€‚\nè§„åˆ™ 5 å®šæ—¶æ”¹å˜ä¼˜å…ˆçº§ï¼Œæ¶ˆé™¤äº†é¥¥é¥¿ï¼Œä¿è¯äº†ä»»åŠ¡çš„æ‰§è¡Œã€‚ä½†æ˜¯å¼•å…¥çš„æ—¶é—´æ®µ S åˆå¸¦æ¥äº†æ–°çš„é—®é¢˜â€”â€”S è¯¥å¦‚ä½•è®¾ç½®ï¼Ÿå¤ªé•¿ä¼šè®©è€—æ—¶ä»»åŠ¡ä¼šé¥¥é¥¿ï¼Œå¤ªçŸ­ä¼šè®©äº¤äº’å‹ä»»åŠ¡å¾—ä¸åˆ°åˆé€‚çš„ CPU æ—¶é—´ã€‚\nä¸€ä¸ªæ›´å¥½çš„è®¡æ—¶æ–¹å¼æ˜¯ä¿®æ”¹è§„åˆ™ 4aã€4bã€‚è®©è°ƒåº¦ç¨‹åºè®°å½•ä¸€ä¸ªè¿›ç¨‹åœ¨æŸä¸€ä¸ªé˜Ÿåˆ—ä¸­æ¶ˆè€—çš„æ€»æ—¶é—´ï¼Œè€Œä¸æ˜¯åœ¨è°ƒåº¦æ—¶é‡æ–°è®¡æ—¶ã€‚åªè¦è¿›ç¨‹ç”¨å®Œäº†è‡ªå·±çš„é…é¢ï¼Œå°±æŠŠå®ƒé™åˆ°ä½ä¸€ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸­å»ã€‚å› æ­¤ï¼Œé‡å†™è§„åˆ™ 4aã€4b ä¸ºè§„åˆ™ 4ï¼š\n è§„åˆ™ 4ï¼šOnce a job uses up its time allotment at a given level (regardless of how many times it has given up the CPU), its priority is reduced (i.e., it moves down one queue).  ä¸å…¶å®ƒè°ƒåº¦ç­–ç•¥çš„ä¸åŒ MLFQ ä¸åŒäº FCFSã€SJFã€STCFï¼Œå®ƒä¸éœ€è¦å¯¹ä»»åŠ¡çš„è¿ä½œæ–¹å¼æœ‰å…ˆéªŒçŸ¥è¯†ï¼Œè€Œæ˜¯é€šè¿‡è§‚å¯Ÿä»»åŠ¡çš„è¿è¡Œæƒ…å†µæ¥ç»™å‡ºå¯¹åº”çš„ä¼˜å…ˆçº§ã€‚\nMLFQ å¯ä»¥æ»¡è¶³å„ç§ä»»åŠ¡éœ€æ±‚ï¼šå¯¹è¿è¡Œæ—¶é—´çŸ­çš„äº¤äº’å‹ä»»åŠ¡ï¼Œå®ƒå¯ä»¥è·å¾—ç±»ä¼¼äº SJF/STCF çš„è¾ƒä¸é”™çš„å…¨å±€æ€§èƒ½ï¼ŒåŒæ—¶å¯¹äºè€—æ—¶çš„ CPU å¯†é›†å‹è´Ÿè½½ä¹Ÿå¯ä»¥å…¬å¹³åœ°ç¨³æ­¥å‘å‰ã€‚\næ¯”ä¾‹ä»½é¢ æ¯”ä¾‹ä»½é¢ï¼ˆproportional-shareï¼‰è°ƒåº¦ç¨‹åºæœ‰æ—¶ä¹Ÿç§°å…¬å¹³ä»½é¢ï¼ˆfair-shareï¼‰è°ƒåº¦ç¨‹åºï¼Œå…¶æ ¸å¿ƒæ€æƒ³ä¸ºï¼šè°ƒåº¦ç¨‹åºçš„æœ€ç»ˆç›®æ ‡æ˜¯ç¡®ä¿æ¯ä¸ªä»»åŠ¡è·å¾—ä¸€å®šæ¯”ä¾‹çš„ CPU æ—¶é—´ï¼Œè€Œä¸æ˜¯ä¼˜åŒ–å‘¨è½¬æ—¶é—´å’Œå“åº”æ—¶é—´ã€‚\nå½©ç¥¨è°ƒåº¦ å½©ç¥¨è°ƒåº¦ï¼ˆlottery schedulingï¼‰æ˜¯æ¯”ä¾‹ä»½é¢è°ƒåº¦ç¨‹åºçš„ä¸€ä¸ªä¼˜ç§€ä¾‹å­ã€‚åŸºæœ¬æ€æƒ³ä¸ºï¼šæ¯éš”ä¸€æ®µæ—¶é—´å°±ä¸¾è¡Œä¸€æ¬¡å½©ç¥¨æŠ½å¥–ï¼Œä»¥ç¡®å®šæ¥ä¸‹æ¥åº”è¯¥è¿è¡Œå“ªä¸ªè¿›ç¨‹ã€‚è¶Šæ˜¯åº”è¯¥é¢‘ç¹è¿è¡Œçš„è¿›ç¨‹ï¼Œè¶Šæ˜¯åº”è¯¥æ‹¥æœ‰æ›´å¤šèµ¢å¾—å½©ç¥¨çš„æœºä¼šã€‚\nå½©ç¥¨æ•°ï¼ˆticketï¼‰ æ˜¯å½©ç¥¨è°ƒåº¦èƒŒåçš„åŸºæœ¬æ¦‚å¿µï¼Œå®ƒä»£è¡¨äº†è¿›ç¨‹å æœ‰æŸä¸ªèµ„æºçš„ä»½é¢ã€‚ä¸€ä¸ªèµ„æºæ‹¥æœ‰çš„å½©ç¥¨æ•°å æ€»å½©ç¥¨æ•°çš„ç™¾åˆ†æ¯”ï¼Œå°±æ˜¯å®ƒå æœ‰çš„èµ„æºçš„ä»½é¢ã€‚é€šè¿‡ä¸æ–­åœ°å®šæ—¶æŠ½å–å½©ç¥¨ï¼Œå½©ç¥¨è°ƒåº¦ä» æ¦‚ç‡ ä¸Šè·å¾—è¿™ç§ä»½é¢æ¯”ä¾‹ã€‚\nå½©ç¥¨è°ƒåº¦æœ€ç²¾å½©çš„åœ°æ–¹åœ¨äºåˆ©ç”¨äº† éšæœºæ€§ã€‚éšæœºæ€§è‡³å°‘æœ‰ä¸‰ç‚¹ä¼˜åŠ¿ï¼š\n éšæœºæ–¹æ³•å¸¸å¸¸å¯ä»¥é¿å…å„ç§å¥‡æ€ªçš„è¾¹ç•Œæƒ…å†µã€‚ éšæœºæ–¹æ³•å¾ˆè½»é‡ï¼Œå‡ ä¹ä¸éœ€è¦è®°å½•ä»»ä½•çŠ¶æ€ã€‚ éšæœºæ–¹æ³•å¾ˆå¿«ï¼Œåªè¦èƒ½äº§ç”Ÿéšæœºæ•°ï¼Œå°±èƒ½åšå‡ºå†³ç­–ã€‚  å½©ç¥¨è°ƒåº¦è¿˜æä¾›äº†ä¸€äº›æœºåˆ¶ï¼Œå®ƒä»¬ä»¥ä¸åŒçš„æ–¹å¼æ¥è°ƒåº¦å½©ç¥¨ï¼š\n å½©ç¥¨è´§å¸ï¼ˆticket currencyï¼‰å…è®¸æ‹¥æœ‰ä¸€ç»„å½©ç¥¨çš„ç”¨æˆ·ä»¥è‡ªå·±å–œæ¬¢çš„æ–¹å¼å°†å½©ç¥¨åˆ†ç»™ä¸åŒçš„ä»»åŠ¡ã€‚ä¹‹åæ“ä½œç³»ç»Ÿå†è‡ªåŠ¨å°†è¿™ç§è´§å¸å…‘æ¢ä¸ºæ­£ç¡®çš„å…¨å±€å½©ç¥¨ã€‚ å½©ç¥¨è½¬è®©ï¼ˆticket transferï¼‰ã€‚é€šè¿‡è½¬è®©ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ä¸´æ—¶å°†è‡ªå·±çš„å½©ç¥¨äº¤ç»™å¦ä¸€ä¸ªè¿›ç¨‹ï¼ŒåŠ é€Ÿå®ƒçš„æ‰§è¡Œã€‚ å½©ç¥¨è†¨èƒ€ï¼ˆticket inflationï¼‰ã€‚åˆ©ç”¨è†¨èƒ€ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ä¸´æ—¶æå‡æˆ–é™ä½è‡ªå·±æ‹¥æœ‰çš„å½©ç¥¨æ•°é‡ã€‚ä¸€èˆ¬ç”¨äºè¿›ç¨‹é—´ç›¸äº’ä¿¡ä»»çš„ç¯å¢ƒã€‚  ç”±äºéšæœºæ€§ï¼Œå½©ç¥¨è°ƒåº¦åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶é—´å¾ˆçŸ­æ—¶ï¼Œå…¬å¹³åº¦éå¸¸å·®ã€‚åªæœ‰å½“ä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´ç‰‡éå¸¸å¤šæ—¶ï¼Œæ‰èƒ½å¾—å‡ºæƒ³è¦çš„ç»“æœã€‚è¿™ä¹Ÿæ˜¯åŸºäºæ¦‚ç‡çš„ç®—æ³•çš„ä¸€ä¸ªé€šç—…ã€‚\næ­¥é•¿è°ƒåº¦ æ­¥é•¿è°ƒåº¦ï¼ˆstride schedulingï¼‰è§£å†³äº†å½©ç¥¨è°ƒåº¦çš„ä¸ç¡®å®šæ€§é—®é¢˜ï¼Œå®ƒæ˜¯ä¸€ä¸ªç¡®å®šæ€§çš„å…¬å¹³åˆ†é…ç®—æ³•ã€‚åœ¨æ­¥é•¿è°ƒåº¦ä¸­ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æœ‰è‡ªå·±çš„æ­¥é•¿ï¼Œè¿™ä¸ªå€¼ä¸å½©ç¥¨æ•°é‡æˆåæ¯”ã€‚\nå¯¹äºæ¯ä¸€ä¸ªè¿›ç¨‹ï¼Œæ¯æ¬¡è¿è¡Œåï¼Œè®©è¿›ç¨‹çš„è®¡æ•°å™¨ï¼ˆç§°ä¸ºè¡Œç¨‹ï¼ˆpassï¼‰å€¼ï¼‰å¢åŠ å®ƒçš„æ­¥é•¿é‚£ä¹ˆå¤šçš„å¢é‡ï¼Œè®°å½•è¿›ç¨‹æ‰§è¡Œçš„æ€»ä½“è¿›åº¦ã€‚ä¹‹åï¼Œè°ƒåº¦ç¨‹åºä½¿ç”¨è¿›ç¨‹çš„æ­¥é•¿åŠè¡Œç¨‹å€¼æ¥ç¡®å®šè°ƒåº¦å“ªä¸ªè¿›ç¨‹ã€‚åŸºæœ¬æ€æƒ³å¾ˆç®€å•ï¼šå½“éœ€è¦è¿›è¡Œè°ƒåº¦æ—¶ï¼Œé€‰æ‹©ç›®å‰è¡Œç¨‹å€¼æœ€å°çš„è¿›ç¨‹ï¼Œè¿è¡Œå®ƒå¹¶åœ¨è¿è¡Œå®Œä¹‹åå°†è¯¥è¿›ç¨‹çš„è¡Œç¨‹å€¼å¢åŠ ä¸€ä¸ªæ­¥é•¿ã€‚\nLinux çš„å®Œå…¨å…¬å¹³è°ƒåº¦å™¨ Linux ä¸­çš„å®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼ˆCompletely Fair Schedulerï¼ŒCFSï¼‰ä¸ä»…å®ç°äº†å…¬å¹³ä»½é¢è°ƒåº¦ï¼Œè¿˜å…·æœ‰éå¸¸é«˜çš„æ•ˆç‡å’Œå¯æ‰©å±•æ€§ã€‚CFS çš„ç›®æ ‡æ˜¯ï¼šåœ¨æ‰€æœ‰ç›¸äº’ç«äº‰çš„è¿›ç¨‹ä¹‹é—´å…¬å¹³åœ°å‡åŒ€åˆ†é… CPUã€‚Linux æ˜¯é€šè¿‡ virtual time (vruntime) æŠ€æœ¯æ¥å®ç°çš„ã€‚\næ¯ä¸ªè¿›ç¨‹è¿è¡Œæ—¶éƒ½ä¼šç´¯è®¡ vruntime å€¼ã€‚æœ€å¸¸è§çš„æ˜¯ï¼Œæ¯ä¸ªè¿›ç¨‹çš„ vruntime éƒ½ä»¥ç›¸åŒçš„é€Ÿç‡ç´¯ç§¯ã€‚å½“éœ€è¦è¿›è¡Œè°ƒåº¦æ—¶ï¼ŒCFS ä¼šé€‰å–å…·æœ‰æœ€å° vruntime å€¼çš„è¿›ç¨‹è¿è¡Œã€‚è¿™é‡Œæœ‰ä¸€ä¸ªéœ€è¦è€ƒè™‘çš„ç‚¹â€”â€”è°ƒåº¦å™¨å¦‚ä½•çŸ¥é“è¯¥åœ¨ä½•æ—¶åœæ­¢å½“å‰è¿è¡Œçš„è¿›ç¨‹å¹¶è¿è¡Œä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼Ÿå¦‚æœ CFS åˆ‡æ¢å¾—è¿‡äºé¢‘ç¹ï¼Œå…¬å¹³æ€§å¢åŠ è€Œæ€§èƒ½é™ä½ï¼ˆæ›´å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰ï¼Œåä¹‹åˆ™å…¬å¹³æ€§é™ä½è€Œæ€§èƒ½å¢åŠ ï¼ˆæ›´å°‘çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰ã€‚\nCFS å…·ä½“æ˜¯é€šè¿‡ä¸€äº›æ§åˆ¶å‚æ•°æ¥ç®¡ç†è°ƒåº¦è¿‡ç¨‹çš„ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ sched_latencyï¼ŒCFS ç”¨å®ƒæ¥å†³å®šä¸€ä¸ªè¿›ç¨‹åœ¨åˆ‡æ¢å‰åº”å½“è¿è¡Œçš„æ—¶é•¿ï¼Œé€šå¸¸ä¸º 48msã€‚CFS ç”¨è¿›ç¨‹çš„æ•°é‡ n é™¤ sched_latency å¾—åˆ°å•ä¸ªè¿›ç¨‹çš„æ—¶é—´ç‰‡ï¼Œä»è€Œç¡®ä¿å®Œå…¨å…¬å¹³ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿›ç¨‹è¿‡å¤šæ€ä¹ˆåŠï¼Ÿæ—¶é—´ç‰‡ä¼šå› æ­¤å˜å¾—éå¸¸å°å—ï¼Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šæ›´åŠ é¢‘ç¹å—ï¼Ÿå¹¶ä¸ä¼šï¼ŒCFS ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç»™äº†æˆ‘ä»¬å¦ä¸€ä¸ªå‚æ•° min_granularityï¼Œè¿™ä¸ªå€¼é€šå¸¸ä¸º 6msã€‚CFS æ°¸è¿œä¸ä¼šå°†æ—¶é—´ç‰‡çš„å¤§å°è®¾ç½®ä¸ºå°äºè¿™ä¸ªå€¼çš„æ•°ã€‚\nCFS è¿˜æ”¯æŒæ§åˆ¶è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œå…è®¸ç”¨æˆ·èµ‹äºˆæŸäº›è¿›ç¨‹æ›´é«˜çš„ CPU ä»½é¢ã€‚è¿™å¹¶ä¸æ˜¯é€šè¿‡å½©ç¥¨æ•°å®ç°çš„ï¼Œè€Œæ˜¯é€šè¿‡ Linux ä¸­ç»å…¸çš„è¿›ç¨‹ nice å€¼å®ç°çš„ã€‚å¯¹äºä¸€ä¸ªè¿›ç¨‹è€Œè¨€ï¼Œå…¶ nice å€¼å¯ä»¥æ˜¯ [-20 , +19] ä¹‹é—´çš„ä»»ä¸€æ•´æ•°ï¼Œé»˜è®¤ä¸º 0ã€‚æ­£æ•°è¡¨ç¤ºæ›´ä½çš„ä¼˜å…ˆçº§ï¼Œè€Œè´Ÿæ•°è¡¨ç¤ºæ›´é«˜çš„ä¼˜å…ˆçº§ã€‚CFS ä¼šå°† nice å€¼æ˜ å°„ä¸ºæƒé‡ï¼š\nstatic const int prio_to_weight[40] = { /* -20 */ 88761, 71755, 56483, 46273, 36291, /* -15 */ 29154, 23254, 18705, 14949, 11916, /* -10 */ 9548, 7620, 6100, 4904, 3906, /* -5 */ 3121, 2501, 1991, 1586, 1277, /* 0 */ 1024, 820, 655, 526, 423, /* 5 */ 335, 272, 215, 172, 137, /* 10 */ 110, 87, 70, 56, 45, /* 15 */ 36, 29, 23, 18, 15, }; æœ‰äº†æƒé‡ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¡ç®—å‡ºæ¯ä¸ªè¿›ç¨‹çš„æ—¶é—´ç‰‡\n$$ time \\underline{\\ } slice_k = \\frac {weight_k}{\\sum_{i=0}^{n-1}(weight_i)} \\cdot sched \\underline{\\ } latency $$\næ­¤å¤–ï¼Œvruntime çš„è®¡ç®—æ–¹å¼ä¹Ÿæœ‰æ‰€æ”¹å˜ï¼š\n$$ vruntime_i = vruntime_i + \\frac {weight_0}{weight_i} \\cdot runtime_i $$\nå¤šå¤„ç†å™¨è°ƒåº¦  å…³é”®é—®é¢˜ï¼šæ“ä½œç³»ç»Ÿåº”è¯¥å¦‚ä½•åœ¨å¤š CPU ä¸Šè°ƒåº¦ä»»åŠ¡ï¼Ÿä¼šé‡åˆ°ä»€ä¹ˆæ–°é—®é¢˜ï¼Ÿå·²æœ‰æŠ€æœ¯æ˜¯å¦ä¾ç„¶é€‚ç”¨ï¼Ÿ\n ç¼“å­˜ å¤šå¤„ç†å™¨ä¸å• CPU ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äº ç¡¬ä»¶å¯¹ç¼“å­˜ï¼ˆcacheï¼‰çš„ä½¿ç”¨ï¼Œä»¥åŠå¤šå¤„ç†å™¨ä¹‹é—´å…±äº«æ•°æ®çš„æ–¹å¼ï¼š\nç¼“å­˜æ˜¯åŸºäº å±€éƒ¨æ€§ï¼ˆlocalityï¼‰ çš„ã€‚å±€éƒ¨æ€§åˆ†ä¸ºä¸¤ç§ï¼š\n æ—¶é—´å±€éƒ¨æ€§ï¼šå½“ä¸€ä¸ªæ•°æ®è¢«è®¿é—®åï¼Œå¥¹å¾ˆæœ‰å¯èƒ½åœ¨ä¸ä¹…çš„å°†æ¥å†æ¬¡è¢«è®¿é—®ã€‚ ç©ºé—´å±€éƒ¨æ€§ï¼šå½“ç¨‹åºè®¿é—®æŸä¸ªåœ°å€çš„æ•°æ®æ—¶ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šç´§æ¥ç€è®¿é—®è¯¥åœ°å€å‘¨å›´çš„æ•°æ®ã€‚  ç¼“å­˜å¯ä»¥æœ‰æ•ˆåœ°æå‡æ•°æ®çš„è®¿é—®é€Ÿåº¦ï¼Œä»è€ŒåŠ å¿«ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ã€‚CPU ä¼šå…ˆå°è¯•ä»ç¼“å­˜ä¸­æŸ¥æ‰¾æ•°æ®ï¼Œè‹¥ç¼“å­˜ä¸­æ²¡æœ‰éœ€è¦çš„æ•°æ®ï¼Œåˆ™è®¿é—®å†…å­˜ã€‚ç”±äºæ•°æ®æ›´æ–°çš„å­˜åœ¨ï¼Œæ‰€ä»¥åœ¨åœ¨å¤šå¤„ç†å™¨ä¸­ï¼Œä¼šå‡ºç° ç¼“å­˜ä¸€è‡´æ€§ï¼ˆcache coherenceï¼‰é—®é¢˜ã€‚\né€šè¿‡ç›‘æ§å†…å­˜è®¿é—®ï¼Œç¡¬ä»¶å¯ä»¥ä¿è¯è·å¾—æ­£ç¡®çš„æ•°æ®ï¼Œå¹¶ä¿è¯å…±äº«å†…å­˜çš„å”¯ä¸€æ€§ã€‚åœ¨åŸºäºæ€»çº¿çš„ç³»ç»Ÿä¸­ï¼Œä¸€ç§æ–¹å¼å°±æ˜¯ä½¿ç”¨æ€»çº¿çª¥æ¢ï¼ˆbus snoopingï¼‰ã€‚æ¯ä¸ªç¼“å­˜éƒ½é€šè¿‡ç›‘å¬é“¾æ¥åˆ°æ‰€æœ‰ç¼“å­˜å’Œå†…å­˜çš„æ€»çº¿ï¼Œæ¥å‘ç°å†…å­˜è®¿é—®ã€‚å¦‚æœ CPU å‘ç°å®ƒæ”¾åœ¨ç¼“å­˜ä¸­çš„æ•°æ®è¢«æ›´æ–°äº†ï¼Œå°±ä¼šä½œåºŸï¼ˆinvalidateï¼‰æœ¬åœ°çš„å‰¯æœ¬ï¼ˆä»ç¼“å­˜ä¸­ç§»é™¤ï¼‰æˆ–è€…æ›´æ–°å®ƒï¼ˆä¿®æ”¹ä¼šæ–°çš„å€¼ï¼‰ã€‚\nè™½ç„¶ç¼“å­˜åœ¨ä¸€è‡´æ€§æ–¹é¢åšäº†å¾ˆå¤šå·¥ä½œï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºè¿˜æ˜¯éœ€è¦å…³å¿ƒå…±äº«æ•°æ®çš„è®¿é—®ã€‚è·¨ CPU è®¿é—®ï¼ˆå°¤å…¶æ˜¯å†™å…¥ï¼‰å…±äº«æ•°æ®æˆ–æ•°æ®ç»“æ„æ—¶ï¼Œéœ€è¦ä½¿ç”¨ äº’æ–¥åŸè¯­ï¼ˆæ¯”å¦‚é”ï¼‰ï¼Œæ‰èƒ½ä¿è¯æ­£ç¡®æ€§ã€‚ä¸€äº›æ— é”çš„æ•°æ®ç»“æ„ä¹Ÿèƒ½è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä½†æ˜¯å®ƒä»¬éå¸¸å¤æ‚ï¼Œä½¿ç”¨å¾—ä¸æ˜¯å¤ªå¤šã€‚åŒæ­¥æ“ä½œå¯¹æ€§èƒ½æœ‰å½±å“ï¼Œéšç€ CPU æ•°é‡çš„å¢åŠ ï¼Œè®¿é—®åŒæ­¥å…±äº«çš„æ•°æ®ç»“æ„ä¼šå˜å¾—å¾ˆæ…¢ï¼Œå› ä¸ºéœ€è¦åšå¤§é‡çš„åŒæ­¥æ“ä½œã€‚\nå¤šå¤„ç†å™¨è°ƒåº¦ä¸­è¿˜éœ€è¦è€ƒè™‘ ç¼“å­˜äº²å’Œåº¦ï¼ˆcache affinityï¼‰ï¼šå½“è¿›ç¨‹åœ¨æŸä¸ª CPU ä¸Šè¿è¡Œæ—¶ï¼Œè¯¥ CPU çš„ç¼“å­˜å†…ä¼šç»´æŠ¤å¾ˆå¤šçŠ¶æ€ã€‚è‹¥ä¸‹æ¬¡è¯¥è¿›ç¨‹è¿˜åœ¨åŒä¸€ä¸ª CPU ä¸Šè¿è¡Œï¼Œå®ƒä¼šç”±äºç¼“å­˜ä¸­çš„æ•°æ®è€Œæ‰§è¡Œå¾—éå¸¸å¿«ã€‚ç›¸åï¼Œåœ¨ä¸åŒçš„ CPU ä¸Šæ‰§è¡ŒåŒä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œç”±äºéœ€è¦é‡æ–°åŠ è½½æ•°æ®ï¼Œæ‰€ä»¥ä¼šå˜å¾—å¾ˆæ…¢ã€‚å› æ­¤ï¼Œæœ€å¥½æ˜¯å°½å¯èƒ½è®©åŒä¸€ä¸ªè¿›ç¨‹åœ¨åŒä¸€ä¸ª CPU ä¸Šæ‰§è¡Œã€‚\nå¤šé˜Ÿåˆ—è°ƒåº¦ æœ‰äº›ç³»ç»Ÿé‡‡ç”¨äº†å¤šé˜Ÿåˆ—çš„è°ƒåº¦æ–¹æ¡ˆï¼Œæ¯”å¦‚æ¯ä¸ª CPU ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç§°ä¹‹ä¸ºå¤šé˜Ÿåˆ—å¤šå¤„ç†å™¨è°ƒåº¦ï¼ˆMulti-Queue Multiprocessor Schedulingï¼ŒMQMSï¼‰ã€‚\nåœ¨ MQMS ä¸­ï¼ŒåŸºæœ¬è°ƒåº¦æ¡†æ¶åŒ…å«å¤šä¸ªè°ƒåº¦é˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—å¯ä»¥ä½¿ç”¨ä¸åŒçš„è°ƒåº¦è§„åˆ™ã€‚å½“ä»»åŠ¡è¿›å…¥ç³»ç»Ÿåï¼Œç³»ç»Ÿä¼šæŒ‰ç…§ä¸€äº›å¯å‘æ€§è§„åˆ™å°†å…¶æ”¾å…¥åˆ°æŸä¸ªè°ƒåº¦é˜Ÿåˆ—ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ª CPU ä¹‹é—´çš„è°ƒåº¦ç›¸äº’ç‹¬ç«‹ï¼Œä¸éœ€è¦åŒæ­¥ã€‚\nMQMS å¤©ç”Ÿå…·æœ‰è‰¯å¥½çš„ç¼“å­˜äº²å’Œåº¦ã€‚æ‰€æœ‰çš„å·¥ä½œéƒ½ä¿æŒåœ¨å›ºå®šçš„ CPU ä¸Šï¼Œå› è€Œå¯ä»¥å¾ˆå¥½åœ°åˆ©ç”¨ç¼“å­˜æ•°æ®ã€‚ä½†è¿™åˆå­˜åœ¨ä¸€ä¸ªæ–°çš„é—®é¢˜â€”â€”è´Ÿè½½ä¸å‡ï¼ˆload imbalanceï¼‰ã€‚\nä¸ºäº†å®ç°è´Ÿè½½å‡è¡¡ã€‚æˆ‘ä»¬å¯ä»¥è®©ä»»åŠ¡è·¨ CPU ç§»åŠ¨ï¼Œè¿™ç§æŠ€æœ¯è¢«ç§°ä¸ºè¿ç§»ï¼ˆmigrationï¼‰ã€‚æœ‰å¾ˆå¤šç§è¿ç§»æ¨¡å¼ï¼Œä¸è¿‡æœ€æ£˜æ‰‹çš„éƒ¨åˆ†å°±æ˜¯å¦‚ä½•å†³å®šå‘èµ·è¿ç§»ï¼Ÿæœ‰ä¸€ä¸ªè¢«ç§°ä¸º å·¥ä½œçªƒå–ï¼ˆwork stealingï¼‰ çš„æŠ€æœ¯ï¼Œå·¥ä½œé‡è¾ƒå°‘çš„ï¼ˆæºï¼‰é˜Ÿåˆ—ä¸å®šæœŸâ€œå·çœ‹â€å…¶å®ƒï¼ˆç›®æ ‡ï¼‰é˜Ÿåˆ—çš„ä»»åŠ¡æƒ…å†µï¼Œå¦‚æœç›®æ ‡é˜Ÿåˆ—æ›´åŠ æ‹¥æŒ¤ï¼Œå°±ä»ç›®æ ‡é˜Ÿåˆ—â€œçªƒå–â€ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚åœ¨ä½¿ç”¨è¿™ç§æ–¹æ³•æ—¶ï¼Œéœ€è¦ç•™æ„ï¼šå¯¹å…¶å®ƒé˜Ÿåˆ—çš„æ£€æŸ¥ä¸èƒ½å¤ªé¢‘ç¹ï¼Œå¦åˆ™ä¼šå¸¦æ¥è¾ƒé«˜çš„å¼€é”€ï¼Œä½†æ£€æŸ¥é—´éš”åˆä¸èƒ½å¤ªé•¿ï¼Œå¦åˆ™å¯èƒ½å¸¦æ¥ä¸¥é‡çš„è´Ÿè½½ä¸å‡ã€‚æ‰€ä»¥éœ€è¦æ‰¾åˆ°åˆé€‚çš„é˜ˆå€¼ã€‚\nLinux ä¸Šçš„å¤šå¤„ç†å™¨è°ƒåº¦ æœ‰è¶£çš„æ—¶ï¼ŒLinux ç¤¾åŒºä¸€ç›´æ²¡æœ‰å°±æ„å»ºå¤šå¤„ç†å™¨è°ƒåº¦æˆéƒ½è¾¾æˆå…±è¯†ã€‚ä¸€ç›´ä»¥æ¥ï¼Œå­˜åœ¨ä¸‰ç§ä¸åŒçš„è°ƒåº¦ç¨‹åºï¼š\n O(1) è°ƒåº¦ç¨‹åº å®Œå…¨å…¬å¹³è°ƒåº¦ç¨‹åºï¼ˆCFSï¼‰ BF è°ƒåº¦ç¨‹åºï¼ˆBFSï¼‰ O(1) å’Œ CFS é‡‡ç”¨å¤šé˜Ÿåˆ—ï¼Œè€Œ BFS é‡‡ç”¨å•é˜Ÿåˆ—ã€‚  æœ‰å…³ BFS çš„æ›´å¤šä¿¡æ¯ï¼šhttp://ck.kolivas.org/patches/bfs/bfs-faq.txt\n","href":"/notebook/reading_notes/ostep/virtualization-cpu/","title":"CPU è™šæ‹ŸåŒ–"},{"content":"ç¨‹åºè¿è¡Œæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ\nä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºä¼šåšä¸€ä»¶éå¸¸ç®€å•çš„äº‹æƒ…ï¼šæ‰§è¡ŒæŒ‡ä»¤ã€‚CPU ä»å†…å­˜ä¸­å–å‡ºï¼ˆfetchï¼‰ä¸€æ¡æŒ‡ä»¤ï¼Œå¯¹å…¶è¿›è¡Œè¯‘ç ï¼ˆdecodeï¼‰ï¼Œç„¶åæ‰§è¡Œï¼ˆexecuteï¼‰å®ƒï¼Œä¿å­˜æ‰§è¡Œç»“æœï¼Œç´§æ¥ç€åˆå»å–æŒ‡ä»¤ï¼Œè¯‘ç ï¼Œæ‰§è¡ŒæŒ‡ä»¤â€¦â€¦ï¼Œå¦‚æ­¤å‘¨è€Œå¤å§‹ï¼Œåå¤å¾ªç¯ï¼Œä½¿å¾—è®¡ç®—æœºèƒ½å¤Ÿè‡ªåŠ¨åœ°å·¥ä½œã€‚é™¤éé‡åˆ°åœæœºæŒ‡ä»¤ï¼ˆç¨‹åºæ‰§è¡Œå®Œæˆï¼‰ï¼Œå¦åˆ™è¿™ä¸ªå¾ªç¯å°†ä¸€ç›´è¿›è¡Œä¸‹å»ã€‚\nè™šæ‹ŸåŒ–  å…³é”®é—®é¢˜ï¼šå¦‚ä½•å°†èµ„æºè™šæ‹ŸåŒ–ï¼Ÿ\n æ“ä½œç³»ç»Ÿè´Ÿè´£ç¡®ä¿æ—¢æ˜“ä½¿ç”¨åˆé«˜æ•ˆåœ°è¿è¡Œï¼Œä¸ºæ­¤ï¼Œå®ƒå°†ç‰©ç†èµ„æºï¼ˆå¤„ç†å™¨ã€å†…å­˜æˆ–ç£ç›˜ï¼‰è½¬æ¢ä¸ºæ›´é€šç”¨ã€æ›´å¼ºå¤§ä¸”æ›´æ˜“äºä½¿ç”¨çš„è™šæ‹Ÿå½¢å¼ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬æœ‰æ—¶ä¹Ÿå°†æ“ä½œç³»ç»Ÿç§°ä¸ºè™šæ‹Ÿæœºã€‚ä¸ºäº†è®©ç”¨æˆ·å¯ä»¥å‘Šè¯‰æ“ä½œç³»ç»Ÿè¦åšä»€ä¹ˆï¼Œæ“ä½œç³»ç»Ÿæä¾›äº†ä¸€äº› APIï¼ˆæˆ–è€…è¯´ç³»ç»Ÿè°ƒç”¨ï¼‰ä¾›ç¨‹åºè°ƒç”¨ã€‚ç”±äºæ“ä½œç³»ç»Ÿæä¾›è¿™äº›è°ƒç”¨æ¥è¿è¡Œç¨‹åºã€è®¿é—®å†…å­˜å’Œè®¾å¤‡ã€è¿›è¡Œå…¶å®ƒæ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰æ—¶ä¹Ÿä¼šè¯´æ“ä½œç³»ç»Ÿä¸ºåº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ª æ ‡å‡†åº“ï¼ˆstandard libraryï¼‰ã€‚\næ“ä½œç³»ç»Ÿæ—©æœŸè¢«ç§°ä¸º super visor æˆ– master control programã€‚å› ä¸ºè™šæ‹ŸåŒ–è®©è®¸å¤šç¨‹åºè¿è¡Œï¼ˆä»è€Œå…±äº« CPUï¼‰ï¼Œè®©è®¸å¤šç¨‹åºå¯ä»¥åŒæ—¶è®¿é—®è‡ªå·±çš„æŒ‡ä»¤å’Œæ•°æ®ï¼ˆä»è€Œå…±äº«å†…å­˜ï¼‰ï¼Œè®©è®¸å¤šç¨‹åºè®¿é—®è®¾å¤‡ï¼ˆä»è€Œå…±äº«ç£ç›˜ç­‰ï¼‰ï¼Œæ‰€ä»¥æ“ä½œç³»ç»Ÿåˆè¢«ç§°ä¸º èµ„æºç®¡ç†å™¨ï¼ˆresource managerï¼‰ã€‚æ¯ä¸ª CPUã€å†…å­˜å’Œç£ç›˜éƒ½æ˜¯ç³»ç»Ÿçš„èµ„æºï¼Œå› æ­¤æ“ä½œç³»ç»Ÿæ‰®æ¼”çš„ä¸»è¦è§’è‰²å°±æ˜¯ç®¡ç†è¿™äº›èµ„æºï¼Œåšåˆ°é«˜æ•ˆå…¬å¹³ï¼Œæˆ–å®ç°å…¶å®ƒé¢„å®šç›®æ ‡ã€‚\nåœ¨ç¡¬ä»¶çš„å¸®åŠ©ä¸‹ï¼Œæ“ä½œç³»ç»Ÿè´Ÿè´£æä¾›ç³»ç»Ÿæ‹¥æœ‰éå¸¸å¤šçš„è™šæ‹Ÿ CPU çš„å‡è±¡ã€‚å°†å•ä¸ª CPUï¼ˆæˆ–å…¶ä¸­ä¸€å°éƒ¨åˆ†ï¼‰è½¬æ¢æˆä¸ºçœ‹ä¼¼æ— é™æ•°é‡çš„ CPUï¼Œä»è€Œè®©è®¸å¤šç¨‹åºçœ‹ä¼¼åœ¨åŒæ—¶è¿è¡Œï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ è™šæ‹ŸåŒ– CPUã€‚\nå†…å­˜æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚è¦è¯»å–å†…å­˜ï¼Œå¿…é¡»æŒ‡å®šä¸€ä¸ªåœ°å€ï¼Œæ‰èƒ½è®¿é—®å­˜å‚¨åœ¨é‚£é‡Œçš„æ•°æ®ã€‚è¦å†™å…¥æˆ–æ›´æ–°å†…å­˜ï¼Œè¿˜å¿…é¡»æ‰§è¡Œè¦å‘ç»™å®šåœ°å€å†™å…¥çš„æ•°æ®ã€‚æ¯ä¸ªè¿›ç¨‹è®¿é—®è‡ªå·±çš„ç§æœ‰è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆæœ‰æ—¶ä¹Ÿç›´æ¥ç§°ä¸ºåœ°å€ç©ºé—´ï¼‰ï¼Œæ“ä½œç³»ç»Ÿä»¥æŸç§æ–¹å¼å°†è™šæ‹Ÿåœ°å€ç©ºé—´æ˜ å°„åˆ°æœºå™¨çš„ç‰©ç†å†…å­˜ä¸Šå»ã€‚ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºä¸­çš„å†…å­˜å¼•ç”¨ä¸ä¼šå½±å“åˆ°å…¶ä»–è¿›ç¨‹ï¼ˆæˆ–æ“ä½œç³»ç»Ÿæœ¬èº«ï¼‰çš„åœ°å€ç©ºé—´ã€‚å¯¹äºæ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œå®ƒå®Œå…¨æ‹¥æœ‰è‡ªå·±çš„ç‰©ç†å†…å­˜ã€‚è¿™å°±æ˜¯ è™šæ‹ŸåŒ–å†…å­˜ã€‚\nå¹¶å‘  å…³é”®é—®é¢˜ï¼šå¦‚ä½•æ„å»ºæ­£ç¡®çš„å¹¶å‘ç¨‹åºï¼Ÿ\n æŒä¹…åŒ–  å…³é”®é—®é¢˜ï¼šå¦‚ä½•æŒä¹…åŒ–åœ°å­˜å‚¨æ•°æ®ï¼Ÿ\n åœ¨ç³»ç»Ÿå†…å­˜ä¸­ï¼Œæ•°æ®å®¹æ˜“ä¸¢å¤±ï¼Œå› ä¸ºåƒ DRAM è¿™æ ·çš„è®¾å¤‡ä»¥æ˜“å¤±ï¼ˆvolatileï¼‰çš„æ–¹å¼å­˜å‚¨æ•°æ®ã€‚å¦‚æœæ–­ç”µæˆ–ç³»ç»Ÿå´©æºƒï¼Œå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šä¸¢å¤±ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç¡¬ä»¶å’Œè½¯ä»¶æ¥æŒä¹…åœ°å­˜å‚¨æ•°æ®ã€‚è¿™æ ·çš„å­˜å‚¨å¯¹äºæ‰€æœ‰ç³»ç»Ÿéƒ½å¾ˆé‡è¦ï¼Œå› ä¸ºç”¨æˆ·éå¸¸å…³å¿ƒä»–ä»¬çš„æ•°æ®ã€‚\næ“ä½œç³»ç»Ÿä¸­ç®¡ç†ç£ç›˜çš„è½¯ä»¶é€šå¸¸ä¸ºç§°ä¸ºæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒè´Ÿè´£å¯é é«˜æ•ˆåœ°å°†ç”¨æˆ·åˆ›å»ºçš„ä»»ä½•æ–‡ä»¶å­˜å‚¨åœ¨ç³»ç»Ÿçš„ç£ç›˜ä¸Šã€‚ä¸æƒ³æ“ä½œç³»ç»Ÿä¸º CPU å’Œå†…å­˜æä¾›çš„æŠ½è±¡ï¼Œæ“ä½œç³»ç»Ÿä¸ä¼šä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºåˆ›å»ºä¸“ç”¨çš„è™šæ‹Ÿç¡¬ç›˜ï¼Œç›¸åï¼Œå®ƒå‡è®¾ç”¨æˆ·ç»å¸¸éœ€è¦ å…±äº« æ–‡ä»¶ä¸­çš„ä¿¡æ¯ã€‚\næ“ä½œç³»ç»Ÿçš„è®¾è®¡ç›®æ ‡ æ“ä½œç³»ç»Ÿå–å¾— CPUã€å†…å­˜æˆ–ç£ç›˜ç­‰ç‰©ç†èµ„æºï¼ˆresourcesï¼‰ï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œè™šæ‹ŸåŒ–ï¼ˆvirtualizeï¼‰ã€‚å®ƒå¤„ç†ä¸å¹¶å‘ï¼ˆconcurrencyï¼‰æœ‰å…³çš„éº»çƒ¦äº‹å„¿ã€‚å®ƒæŒä¹…åœ°ï¼ˆpersistentlyï¼‰å­˜å‚¨æ–‡ä»¶ï¼Œä»è€Œä½¿å®ƒä»¬é•¿æœŸå®‰å…¨ã€‚æˆ‘ä»¬å¸Œæœ›å»ºç«‹è¿™æ ·ä¸€ä¸ªç³»ç»Ÿï¼Œæ‰€ä»¥è¦æœ‰ä¸€äº›ç›®æ ‡ï¼Œä»¥å¸®åŠ©æˆ‘ä»¬é›†ä¸­è®¾è®¡å’Œå®ç°ï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡ŒæŠ˜ä¸­ã€‚æ‰¾åˆ°åˆé€‚çš„æŠ˜ä¸­æ˜¯å»ºç«‹ç³»ç»Ÿçš„å…³é”®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç›®æ ‡ï¼š\n å»ºç«‹ä¸€äº›æŠ½è±¡ï¼Œè®©ç³»ç»Ÿæ–¹ä¾¿æ˜“ç”¨ã€‚ æä¾›é«˜æ€§èƒ½ï¼ˆæœ€å°åŒ–æ“ä½œç³»ç»Ÿçš„å¼€é”€ï¼‰ã€‚ åœ¨åº”ç”¨ç¨‹åºä¹‹é—´ä»¥åŠåœ¨ OS ä¸åº”ç”¨ç¨‹åºä¹‹é—´æä¾›ä¿æŠ¤ã€‚ä¿æŠ¤æ˜¯æ“ä½œç³»ç»Ÿå’Œæ ¸å¿ƒåŸç†ä¹‹ä¸€ï¼ˆå³éš”ç¦»ï¼‰ï¼Œè®©è¿›ç¨‹å½¼æ­¤éš”ç¦»æ˜¯ä¿æŠ¤çš„å…³é”®ã€‚  å‚è€ƒèµ„æ–™  CPUçš„å·¥ä½œè¿‡ç¨‹.  ","href":"/notebook/reading_notes/ostep/introduction_to_operating_systems/","title":"Introduction to Operating Systems"},{"content":"","href":"/tags/%E6%90%9C%E7%B4%A2/","title":"æœç´¢"},{"content":" äººç”Ÿä¸­ 99% çš„é—®é¢˜æ—©å·²æœ‰ç­”æ¡ˆï¼Œä½ åªè¦æœç´¢å°±å¥½ã€‚åªè¦ä½ å»æœç´¢ï¼Œå°±èƒ½ä¸€ç›´ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šå»å¯»æ±‚æ–°çªç ´ï¼Œåšå‡ºå¾®åˆ›æ–°ã€‚ â€”â€”æœ±ä¸¹\n å‰è¨€ æœ±ä¸¹è€å¸ˆçš„ã€Šè¶…çº§æœç´¢æœ¯ : å¸®ä½ æ‰¾åˆ°99%é—®é¢˜çš„ç­”æ¡ˆã€‹æ˜¯ä¸€æœ¬è®²æœç´¢æŠ€å·§çš„ä¹¦ï¼Œä¹Ÿæ˜¯ä¸€æœ¬ä»‹ç»å­¦ä¹ æŠ€å·§çš„ä¹¦ï¼Œå†…å®¹ä¸éš¾ï¼Œå´å¾ˆå®ç”¨ã€‚å¤§å­¦æœŸé—´ï¼Œç¬”è€…ä¸ºäº†è·å¾—è™«éƒ¨è½çš„é‚€è¯·ç ï¼Œç©è¿‡å¤šæœŸæœç´¢æ¸¸æˆï¼Œè¶£å‘³åè¶³ã€‚é‚£æ—¶å€™ï¼Œæˆ‘çš„æŠ€å·§è¿˜æ¯”è¾ƒæ•£ï¼Œä»æœªåƒè¿™æœ¬ä¹¦ä¸­è¿™ä¹ˆæˆä½“ç³»ï¼Œè¯»å®Œæœ¬ä¹¦å€’ä¹Ÿæœ‰äº†ä¸€ç§è±ç„¶å¼€æœ—çš„æ„Ÿè§‰ã€‚\nä¿¡æ¯ç´ å…»ï¼šå¯¹ä¿¡æ¯è¿›è¡Œæœç´¢ã€è·å–ã€åˆ¤æ–­å’Œåˆ©ç”¨ï¼Œä»è€Œäº†è§£é™Œç”Ÿäº‹ç‰©ï¼Œè§£å†³åˆ‡èº«é—®é¢˜ã€‚å…¶è¿‡ç¨‹åŒ…æ‹¬ä¿¡æ¯è·å–ã€ä¿¡æ¯è¾“å…¥ã€ä¿¡æ¯åŠ å·¥ä¸è¾“å‡ºç­‰ç¯èŠ‚ã€‚\nä¿¡æ¯ç´ å…»çš„å››å¤§èƒ½åŠ›ï¼šè¯†åˆ«éœ€æ±‚ã€è·å–ä¿¡æ¯ã€ç”„åˆ«ä¿¡æ¯å’Œè¿ç”¨ä¿¡æ¯ã€‚\næœç´¢è§£å†³é—®é¢˜çš„é—­ç¯è¡ŒåŠ¨æ¡†æ¶ï¼ˆ1-\u0026gt;2-\u0026gt;3-\u0026gt;4-\u0026gt;5-\u0026gt;1\u0026hellip;ï¼‰ï¼š\n åˆ†æé—®é¢˜ã€ç•Œå®šéœ€æ±‚ é€‰æ‹©æœç´¢å·¥å…· æ„é€ æ£€ç´¢å…¬å¼ ç­›é€‰æ£€ç´¢ç»“æœ ä¼˜åŒ–æ£€ç´¢ç­–ç•¥  \u0026hellip;\nè¯†åˆ«éœ€æ±‚ æ‰¾å¯¹é—®é¢˜â€”â€”6W2Hæ¨¡å‹ æ‰¾å¯¹é—®é¢˜çš„ç›®çš„åœ¨äºç²¾å‡†æŒ–æ˜éœ€æ±‚ã€‚6W2H æŒ‡çš„æ˜¯ä¸ºä»€ä¹ˆï¼ˆWhyï¼‰ã€æ˜¯ä»€ä¹ˆï¼ˆWhatï¼‰ã€ä»€ä¹ˆæ—¶å€™ï¼ˆWhenï¼‰ã€åœ¨å“ªé‡Œï¼ˆWhereï¼‰ã€æ˜¯è°ï¼ˆWhoï¼‰ã€å“ªä¸€ä¸ªï¼ˆWhichï¼‰ã€æ€ä¹ˆåšï¼ˆHowï¼‰å’Œæˆæœ¬å¦‚ä½•ï¼ˆHow muchï¼‰ã€‚\nåˆ†è§£é—®é¢˜â€”â€”æŸšå­æ¨¡å‹ åˆ†è§£é—®é¢˜çš„ç›®çš„åœ¨äºæ‰¾åˆ°çœŸæ­£çš„æ‰§è¡Œæ–¹æ¡ˆã€‚æŸšå­æœ‰ä¸‰å±‚ï¼Œå…ˆå‰¥å»é»„è‰²å¤–çš®ï¼Œå†å‰¥ç™½è‰²å†…çš®ï¼Œçœ‹è§ç¬¬ä¸‰å±‚æœè‚‰ï¼Œæ‰å¯é£Ÿä¹‹ã€‚å¤æ‚é—®é¢˜ä¸‹çš„ä¿¡æ¯æŒ–æ˜ç±»ä¼¼ï¼ŒæŒ–ç¬¬ä¸€å±‚å’Œç¬¬äºŒå±‚çš„æ—¶å€™è¿˜ä¸è¶³ä»¥è§£å†³å®é™…é—®é¢˜ï¼Œå½“æŒ–åˆ°ç¬¬ä¸‰å±‚çš„æ—¶å€™ï¼Œå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åˆ¶å®šæ–¹æ¡ˆå¼€å§‹è¡ŒåŠ¨äº†ã€‚\nèµ„æºè·å– æœç´¢æŒ‡ä»¤ æ­£ç¡®ä½¿ç”¨æœç´¢æŒ‡ä»¤æœ‰åˆ©äºè¿‡æ»¤åƒåœ¾ä¿¡æ¯ï¼Œæ›´å¿«æ›´å‡†ç¡®åœ°è·å–æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„æœç´¢æŒ‡ä»¤ï¼š\n   å…³é”®è¯ ä½œç”¨ ç”¨æ³•     site å°†æœç´¢ç»“æœé™å®šåœ¨æŸä¸ªç½‘ç«™ä¸­ å…³é”®è¯+ç©ºæ ¼+site+è‹±æ–‡å†’å·+æœç´¢èŒƒå›´æ‰€é™å®šçš„ç½‘ç«™   filetype å°†æœç´¢ç»“æœé™å®šä¸ºæŸç§æ–‡ä»¶ç±»å‹ å…³é”®è¯+ç©ºæ ¼+filetype+è‹±æ–‡å†’å·+æ–‡ä»¶æ ¼å¼   æ—¶é—´1..æ—¶é—´2 é™å®šæœç´¢ç»“æœçš„æ—¶é—´èŒƒå›´ å…³é”®è¯+ç©ºæ ¼+20xxå¹´+ä¸¤ä¸ªè‹±æ–‡å¥å·+20xxå¹´   intitle é™å®šæœç´¢æ ‡é¢˜ä¸­æ‰€åŒ…å«çš„å…³é”®è¯ å…³é”®è¯+ç©ºæ ¼+intitle+è‹±æ–‡å†’å·+éœ€è¦é™å®šçš„å…³é”®è¯   inurl é™å®šæœç´¢ç»“æœçš„ç½‘å€ä¸­åº”åŒ…å«çš„å­—æ®µ inurl:xxxã€‚å®ƒçš„ä½¿ç”¨èŒƒå›´æ¯” site è¦å¹¿ï¼Œå¯æ›¿ä»£ site ä½¿ç”¨   - è®©æœç´¢ç»“æœä¸­ä¸åŒ…å«æŸäº›è¯ å…³é”®è¯-è¿‡æ»¤è¯    æ­¤å¤–è¿˜æœ‰ä¸€äº›é«˜çº§æŒ‡ä»¤ï¼Œæ¯”å¦‚åŸºäºä¸æˆ–éçš„å¸ƒå°”è¡¨è¾¾å¼ç­‰ã€‚\né€šè¿‡æœç´¢æ‹“å±•äººè„‰ å¸¸è§æ¸ é“ï¼šå¾®åšã€åœ¨è¡Œã€çŸ¥ä¹ã€æœç´¢å¼•æ“ã€é‚®ä»¶ã€å¤©çœ¼æŸ¥ã€å‚ç›´é¢†åŸŸå¹³å°ã€å¾®ä¿¡QQç­‰ç¤¾äº¤å¹³å°ã€åœ¨çº¿æ–‡æ¡£ã€ç¤¾ç¾¤ç­‰ã€‚\nå¸¸è§æ–¹å¼ï¼šç§ä¿¡ã€é‚®ç®±ã€å¾®ä¿¡å·ã€é¢†è‹±è´¦å·ã€æ‰‹æœºå·ã€å…¬å¼€æé—®ã€ä¼ä¸šæ³•äººç­‰ã€‚\né€šè¿‡æœç´¢è·å–çŸ¥è¯† è·³æ§½ï¼šçœ‹å‡†ç½‘çœ‹å…¬å¸è¯„ä»·ã€é¢è¯•ç»éªŒã€å·¥èµ„æ°´å¹³å’Œå¤§ä½“èŒä½ï¼Œé€šè¿‡å…¬å¸å®˜ç½‘æˆ–å…¬ä¼—å·ç¡®è®¤ä¿¡æ¯è·Ÿè¸ªåŠ¨æ€ï¼Œäººè„‰æœç´¢åŠ©åŠ›ã€‚\nè€ƒç ”ï¼šè€ƒç ”è®ºå›ï¼Œè®¡ç®—æœºæœ‰ç‹é“è®ºå›ã€‚\næ–°é¢†åŸŸï¼šç™¾åº¦ç™¾ç§‘ã€ç»´åŸºç™¾ç§‘ã€æ·˜å®ã€ç™¾åº¦ç»éªŒã€wikiHow ç­‰ã€‚\nç”Ÿæ´»ç»éªŒï¼šæ”¯ä»˜å®å¾®ä¿¡çš„ä¾¿æ°‘æ¿å—ç­‰ã€‚\næ·±åº¦èµ„æºæœç´¢ ç½‘ç›˜æœç´¢ã€ç£åŠ›æœç´¢ã€‚\nåšå­¦æœ¯æœ‰ç™¾åº¦å­¦æœ¯ã€å¿…åº”å­¦æœ¯ã€ä¸­å›½çŸ¥ç½‘ã€ä¸‡æ–¹ç­‰ã€‚\næœç´¢å¼•æ“åŸç† ç®€å•æ¥è¯´ï¼Œæœç´¢å¼•æ“çš„å·¥ä½œåŸç†å¤§è‡´å¯åˆ†ä¸ºä»¥ä¸‹å››æ­¥ï¼š\n åˆ©ç”¨çˆ¬è™«çˆ¬å–æ•°æ® åˆ†ææ•°æ® å»ºç«‹ç´¢å¼• æŸ¥è¯¢ç»“æœ  æœç´¢å¼•æ“å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š\n å…¨æ–‡æœç´¢å¼•æ“ï¼šå³æˆ‘ä»¬ä¸€èˆ¬æ„ä¹‰ä¸Šè®¤ä¸ºçš„æœç´¢å¼•æ“ å…ƒæœç´¢å¼•æ“ï¼šå®ƒåœ¨æ¥æ”¶ç”¨æˆ·æŸ¥è¯¢ä¹‹åï¼ŒåŒæ—¶åœ¨å¤šä¸ªæœç´¢å¼•æ“ä¸Šæœç´¢ï¼Œç„¶åå°†ç»“æœè¿”ç»™ç”¨æˆ· å‚ç›´æœç´¢å¼•æ“ï¼šä¸“æ³¨äºæŸä¸€é¢†åŸŸçš„æœç´¢å¼•æ“  èµ„æºå˜ç° è¿™ä¸€éƒ¨åˆ†çš„æ ¸å¿ƒåœ¨äºâ€œæ‰¾å¯¹èµ„æºï¼Œå°‘èŠ±é’±â€ã€‚\næ•™è‚²èµ„æº å¯»æ‰¾ä¼˜è´¨æ•™è‚²èµ„æºï¼šinurl:edu å¯ä»¥æ‰¾å‡ºæ•™è‚²æœºæ„ã€‚\nè‡ªæˆ‘å……ç”µï¼šä¸­å›½å¤§å­¦MOOCã€å¤§å­¦ç”Ÿè‡ªå­¦ç½‘ã€ç½‘æ˜“å…¬å¼€è¯¾ã€Bilibiliç­‰ã€‚\nè¡Œä¸šæŠ€æœ¯è®ºå›ï¼šå¼€å‘è€…â€”â€”Githubã€äººåŠ›èµ„æºâ€”â€”ä¸­å›½äººåŠ›èµ„æºå¼€å‘ç½‘ã€åŒ»å­¦è®ºå›â€”â€”ä¸é¦™å›­ã€è€ƒå…¬åŠ¡å‘˜â€”â€”å°æœ¨è™«è®ºå›ç­‰ã€‚\nè¡Œä¸šæŠ¥å‘Šï¼šå’¨è¯¢è¡Œä¸šâ€”â€”éº¦è‚¯é”¡ã€BCGã€è´æ©ã€è‰¾ç‘ç½‘ï¼Œæ•°æ®å¹³å°è¡Œä¸šç ”ç©¶æŠ¥å‘Šâ€”â€”è…¾è®¯ä¼é¹…æ™ºåº“ã€é˜¿é‡Œç ”ç©¶é™¢ã€CBNDataç¬¬ä¸€è´¢ç»å•†ä¸šæ•°æ®ä¸­å¿ƒã€ä¸­å›½ç¤¾ä¼šç§‘å­¦é™¢ç­‰ã€‚\nåŒ»ç–—èµ„æº å¸¸è§ç—…æŸ¥è¯¢ï¼šä¸é¦™åŒ»ç”Ÿã€‚\nå¹³æ—¥ç”¨è¯ï¼šä¸é¦™å›­çš„ç”¨è¯åŠ©æ‰‹ã€ã€Šä¸–ç•Œå«ç”Ÿç»„ç»‡åŸºæœ¬è¯ç‰©æ ‡å‡†æ¸…å•ã€‹ã€‚\nè¯å“ä¸“åˆ©æœç´¢ï¼šå›½å®¶çŸ¥è¯†äº§æƒå±€ä¸“åˆ©æ£€ç´¢ç³»ç»Ÿã€‚\nä¸“ä¸šåŒ»ç–—å¥åº·ä¿¡æ¯è·å–ï¼šåŒ»å­¦å¯¼èˆªã€ä¸é¦™å›­ã€‚\nå¤§æ•°æ®è¾…åŠ©å†³ç­– å¯é çš„æ•°æ®æ¥æºï¼šå›½å®¶ç»Ÿè®¡å±€å®˜ç½‘ã€ä¸­å›½ç»æµä¿¡æ¯ç½‘ã€Windã€‚\næŒ‡æ•°ç ”ç©¶ï¼šç™¾åº¦æŒ‡æ•°ã€é˜¿é‡ŒæŒ‡æ•°ã€å¾®ä¿¡æŒ‡æ•°ã€å¾®æŒ‡æ•°ã€çŒ«çœ¼ç¥¨æˆ¿æŒ‡æ•°ã€çˆ±å¥‡è‰ºæŒ‡æ•°ç­‰ã€‚\nè´­ç‰© å†å²æ¯”ä»·ï¼šæ…¢æ…¢ä¹°ç­‰å†å²æ¯”è¾ƒå’Œå…¨ç½‘æ¯”ä»·ç½‘ç«™ã€‚\né¢†åˆ¸ï¼šçœé’±è¾¾äººã€åˆ¸è¾¾äºº\næŠ˜æ‰£ä¿¡æ¯ï¼šè‡ªåª’ä½“å®˜ç½‘ã€‚\næ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåˆ¤æ–­ä¸œè¥¿æ˜¯å¦ä¾¿å®œï¼Œç„¶åå¦‚ä½•æ‰èƒ½æ›´ä¾¿å®œã€‚\næ·±åº¦é˜…è¯» è¯»äº†è¿™ä¹ˆå¤šä¹¦ï¼Œè¿˜è¿‡ä¸å¥½ä¸€ç”Ÿï¼Œé‚£ä¹ˆè¯»ä¹¦åˆæœ‰ä½•ç”¨ï¼Ÿå…¶å®è¿™ä¸ªé—®é¢˜å­˜åœ¨çš„å…³é”®åœ¨äºï¼Œå¾ˆå¤šäººçš„é˜…è¯»æ²¡æœ‰å’Œç°å®ç»éªŒç»“åˆèµ·æ¥ã€‚æ­£å¦‚è‘—åæ¼«ç”»å®¶ Hugh MacLeod ç”»çš„ç¤ºæ„å›¾ä¸€æ ·ï¼š\nå›¾ä¸­çš„å°ç‚¹ç‚¹è¡¨ç¤ºæˆ‘ä»¬è¯»è¿‡çš„ä¹¦ï¼Œæˆ–è€…çœ‹è¿‡çš„æ–‡ç« ã€‚å¦‚æœä¸æŠŠè¿™äº›ç‚¹ä¸²è”èµ·æ¥ï¼Œé‚£ä¹ˆè¯»å†å¤šçš„ä¹¦ï¼ŒçŸ¥è¯†éƒ½æ˜¯ä¸€ç›˜æ•£æ²™ã€‚ç›¸äº’è¿æ¥çš„çŸ¥è¯†ï¼Œæ‰èƒ½æˆä¸ºæœ‰ç”¨çš„ç»éªŒã€‚æ‰€ä»¥ï¼Œå…³é”®ä¸æ˜¯æˆ‘ä»¬é˜…è¯»çš„æ–¹å¼ï¼Œä¹Ÿä¸åœ¨äºæˆ‘ä»¬åšç¬”è®°çš„æ–¹å¼ï¼Œè€Œæ˜¯ å¦‚ä½•ç”¨æŠ½è±¡çš„çŸ¥è¯†ï¼Œæ¥è§£å†³ç°å®ä¸­çš„é—®é¢˜ã€‚\næœ±ä¸¹è€å¸ˆè®¤ä¸ºåšåˆ°è¿™ä¸€ç‚¹çš„æ ¸å¿ƒåœ¨äºï¼šè”ç³»å®é™…ï¼ŒæŠŠé˜…è¯»å½“ä½œé«˜æ•ˆçš„çŸ¥è¯†æ£€ç´¢æ¥æ“ä½œã€‚å®Œæ•´çš„çŸ¥è¯†æ£€ç´¢åˆ†ä¸ºå››æ­¥ï¼šæœç´¢â€”â€”è¾“å…¥â€”â€”å¤„ç†â€”â€”è¾“å‡ºï¼Œå…¶å¯¹åº”åˆ°è¯»ä¹¦ä¸Šé¢å°±æ˜¯ æé—®â€”â€”é˜…è¯»â€”â€”æ€è€ƒâ€”â€”åº”ç”¨ï¼ˆç¬”è®°ï¼‰ã€‚\næœ‰äº†å¥½çš„é˜…è¯»æ–¹æ³•å’Œä¹¦æºï¼ŒåŠ ä¸Šæœç´¢èƒ½åŠ›ï¼Œå°±å¯ä»¥ç»™è‡ªå·±æ­å»ºä¸€ä¸ªé˜…è¯»é—­ç¯ï¼Œå…·ä½“æ“ä½œåŒ…æ‹¬ï¼šå¯»æ‰¾å¥½ä¹¦å•â€”â€”æœç´¢ä¹¦ç±â€”â€”é«˜æ•ˆé˜…è¯»â€”â€”å­¦ä¼šç”¨çŸ¥è¯†è§£å†³é—®é¢˜ã€‚\nä¿¡æ¯å¤„ç† å¤§è„‘ä¿¡æ¯åˆ†çº§ ä¿¡æ¯å°±æ˜¯èµ„æºã€‚ä¸ºäº†å¿«é€Ÿå­¦ä¹ å’Œè®¤çŸ¥å‡çº§ï¼Œæ›´æ–°ä¿¡æ¯é‡ï¼Œæˆ‘ä»¬éœ€è¦å…·å¤‡ä¸‰å¤§èƒ½åŠ›ï¼š\n å¿«é€Ÿç†è§£çš„èƒ½åŠ› æ·±å…¥æ€è€ƒçš„èƒ½åŠ› å¼ºå¤§çš„å­¦ä¹ èƒ½åŠ›  å€ŸåŠ©å„ç§æœç´¢æŠ€æœ¯ã€ç”µå­å·¥å…·ä»¥åŠç§‘å­¦çš„å­¦ä¹ æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹é«˜æ•ˆçš„ä¿¡æ¯å¤„ç†æµã€‚ä¸ç”¨å¤ªåœ¨ä¹è‡ªå·±èƒ½è®°å¾—å¤šå°‘ï¼Œè€Œæ˜¯è¦ç”¨æ›´åŠ é«˜çº§çš„æ–¹æ³•æ¥æ•´åˆä¿¡æ¯ã€æ·±å…¥æ€è€ƒã€‚æ¢å¥è¯è¯´ï¼Œæ›´é«˜è´¨é‡çš„ä¿¡æ¯æ¥æºã€æ›´å¼ºå¤§çš„ä¿¡æ¯å¤„ç†æ–¹æ³•å’Œæ›´ç²¾å‡†çš„æ€è€ƒæ–¹å¼ï¼Œä¸‰è€…é…åˆï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ„å»ºä¸€ä¸ªé«˜é€Ÿä¿¡æ¯å¤„ç†ç³»ç»Ÿã€‚ç³»ç»Ÿåˆ†ä¸ºæ™ºå›Šåº“ã€å¤–è„‘å’Œå†…è„‘ä¸‰ä¸ªå±‚æ¬¡ã€‚æ ¸å¿ƒè¦ç´ ï¼šç”¨æœç´¢è·å–æ›´å¤šä¿¡æ¯ï¼Œç”¨å·¥å…·é«˜æ•ˆæŒæ§çŸ¥è¯†ï¼Œç”¨ç§‘å­¦çš„æ–¹æ³•æå‡è„‘åŠ›ã€‚\næ™ºå›Šåº“ï¼šé«˜æ•ˆçš„æœç´¢èƒ½åŠ› é€šè¿‡æœç´¢æ‰“å¼€ä¿¡æ¯æ¸ é“ï¼Œè·å–æµ·é‡ä¿¡æ¯ï¼Œä½¿ç”¨åˆé€‚çš„å·¥å…·å’Œæ–¹æ³•å­˜æ”¾åˆæ­¥ç­›é€‰ä½†è¿˜æ²¡å®Œå…¨æ¶ˆåŒ–çš„ä¿¡æ¯ã€‚\nå¤–è„‘ï¼šæœ‰æ•ˆæ•´ç†åç‰‡ã€ç¬”è®°ã€ä¹¦ç±ç­‰ä¿¡æ¯ æˆ‘ä»¬çš„å¤§è„‘åº”è¯¥åªç”¨æ¥æ€è€ƒã€ç†æ¸…é—®é¢˜çš„å…³é”®éƒ¨åˆ†ã€‚å¾ˆå¤šçç¢çš„ä¿¡æ¯å¹¶ä¸éœ€è¦è£…è¿›å¤§è„‘ï¼Œæ‰¾ä¸ªåœ°æ–¹æ”¾ç€å°±å¥½äº†ã€‚æ‰“é€ ä¸€ä¸ªé«˜æ•ˆå¤–è„‘çš„æ–¹å¼ï¼š\n ä¸€å¥—é«˜æ•ˆæ•´é½çš„ä¿¡æ¯å½’çº³æ–¹æ³•ï¼Œç”¨æ¥æ•´ç†åç‰‡ã€æ–‡ç« ç­‰å®¹æ˜“å¼•èµ·æ··ä¹±çš„ä¿¡æ¯ æˆä½“ç³»ã€æœ‰é€»è¾‘çš„ç”µè„‘æ–‡æ¡£æ•´ç†ã€å½’çº³ã€è¿­ä»£ä½“ç³»ï¼Œç”¨æ¥è¾…åŠ©å·¥ä½œå‡èŒã€æŠ€èƒ½æå‡ç­‰ ç§‘å­¦ã€é«˜æ•ˆçš„ç¬”è®°ç³»ç»Ÿï¼Œç”¨æ¥æ•´åˆå…³é”®ä¿¡æ¯ï¼Œå¯¹æ¥å†…è„‘çš„å¸æ”¶å’Œæ€è€ƒ  å†…è„‘ï¼šé›†ä¸­æ€è€ƒ æŒ‰ç…§ä¿¡æ¯è¾“å…¥çš„æµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªé«˜æ•ˆçš„ä¿¡æ¯æµé€šé€šé“ï¼Œé€šé“ä¸­çš„æ¯ä¸ªæ­¥éª¤éƒ½å¯¹ä¿¡æ¯è¿›è¡Œæ•´ç†ã€åˆ å‡å’Œå½’æ¡£ï¼Œæœ€ååªéœ€è¦ä¿ç•™ç²¾åéƒ¨åˆ†è¿›å…¥æˆ‘ä»¬çš„å¤§è„‘ã€‚æˆ‘ä»¬åº”è¯¥ç”¨å†…è„‘åšä¸€äº›æ›´åŠ æ·±å…¥çš„å·¥ä½œï¼š\n ç³»ç»Ÿåœ°æ¢³ç†çŸ¥è¯†ä½“ç³»ï¼Œä¸è¦è®©ä¿¡æ¯ä¹±ä½œä¸€å›¢ æ€è€ƒæé—®ã€å¯»æ‰¾è§£å†³é—®é¢˜çš„æ–¹æ³• åšå†³å®šæˆ–åˆ›é€   æ•´åˆåº”ç”¨ å°†æœç´¢åˆ°çš„ä¿¡æ¯ä¸æˆ‘ä»¬ç°æœ‰çŸ¥è¯†ç»“åˆèµ·æ¥ æ¨¡å—åŒ–æ€ç»´ æ˜¯å¤„ç†å¤§é‡çŸ¥è¯†ä¸€ä¸ªæŠ€å·§ï¼Œå³ä»å¤§é‡çŸ¥è¯†ä¸­æç‚¼å‡ºæ ¸å¿ƒè¦ç‚¹ï¼Œå°†å…¶å‹ç¼©æˆä¸€ä¸ªç‹¬ç«‹çš„çŸ¥è¯†æ¨¡å—ï¼Œä¾¿äºå¿«é€Ÿå¤„ç†å’Œä¿å­˜ã€‚è¿ç”¨æ¨¡å—åŒ–æ€ç»´çš„ä¸¤ä¸ªæ­¥éª¤ï¼šç®€åŒ–å½’ç±»å’Œæ€»ç»“å‹ç¼©ã€‚\nç»æµå­¦ä¸­æœ‰ä¸€ä¸ªåŸºç¡€æ¦‚å¿µå«åšè¾¹é™…æ”¶ç›Šï¼Œå®ƒæŒ‡çš„æ˜¯æ¯å¤šæ‹¥æœ‰ä¸€ä¸ªå•†å“ï¼Œæ‰€å¢åŠ çš„æ”¶ç›Šæ˜¯é€’å‡çš„ã€‚ä½†æ˜¯å¯¹çŸ¥è¯†å’ŒæŠ€èƒ½çš„å­¦ä¹ è€Œè¨€ï¼Œå­¦ä¹ çš„è¾¹é™…æ”¶ç›Šå´æ˜¯é€’å¢çš„ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ çŸ¥è¯†é»åˆ æŠ€å·§è®©çŸ¥è¯†è·å–æœ€å¤§çš„è¾¹é™…æ”¶ç›Šï¼ŒçŸ¥è¯†é»åˆæŒ‡çš„æ˜¯ï¼šç›¸ä¼¼æˆ–ç›¸è¿‘çš„çŸ¥è¯†è¢«å¿«é€ŸæŒæ¡åï¼Œå¯ä»¥å½¢æˆæ›´å¤§çš„çŸ¥è¯†å—ã€çŸ¥è¯†ç½‘ã€‚\nSQ3R é˜…è¯»æ³• æ˜¯ç¾å›½æ•™è‚²å®¶ Francis Robinson ä¸ºäº†æå‡å†›äººçš„å­¦ä¹ èƒ½åŠ›è€Œå¼€å‘å‡ºæ¥çš„é˜…è¯»æ€è€ƒæ¨¡å¼ï¼Œåæ¥å¹¿æ³›ç”¨äºå­¦æ ¡æ•™è‚²å’Œæˆäººæ•™è‚²ç­‰é¢†åŸŸã€‚SQ3R å…·ä½“æŒ‡ Surveyï¼ˆçºµè§ˆï¼‰ã€Questionï¼ˆæé—®ï¼‰ã€Readingï¼ˆé˜…è¯»ï¼‰ã€Reciteï¼ˆå¤è¿°ï¼‰å’Œ Reviewï¼ˆå¤ä¹ ï¼‰è¿™äº”ä¸ªé˜¶æ®µï¼Œè¿™æ˜¯ä¸€ä¸ªä¸é”™çš„å­¦ä¹ å·¥å…·ã€‚\nèŠ±æœ€å°‘çš„åŠ›æ°”ï¼Œè·å¾—æœ€ç‰¢å›ºçš„çŸ¥è¯† åˆ†æ•£å­¦ä¹ ï¼šå¯¹äºä¸€ä¸ªå¤§ä»»åŠ¡ï¼Œå¦‚æœæŠŠå®ƒæ‹†åˆ†æˆä¸€ç»„å°ä»»åŠ¡ï¼Œåˆ™æ›´æœ‰å¯èƒ½å®ŒæˆåŸä»»åŠ¡ã€‚æ¯”å¦‚è®°å•è¯ã€ç»ƒå¬åŠ›å°±éå¸¸é€‚åˆåˆ©ç”¨ç¢ç‰‡åŒ–æ—¶é—´å­¦ä¹ ã€‚åˆ©ç”¨è¿™ç§è®°å¿†ï¼Œèƒ½ä¿æŒé«˜æ¶¨çš„è®°å¿†å…´è¶£ï¼Œä½¿å¤§è„‘å¤„åœ¨æ¸…é†’çš„è®°å¿†çŠ¶æ€ä¸­ï¼Œäº‹åŠåŠŸå€ã€‚\né—´éš”æ€§é‡å¤ æ˜¯ä¸€ç§åˆ†æ•£å­¦ä¹ ç­–ç•¥ï¼ŒæŒ‡çš„æ˜¯å°†å¤§çš„å­¦ä¹ ä»»åŠ¡æ‹†åˆ†ä¸ºå°æ®µï¼Œå°æ®µä¹‹é—´ç•™å‡ºå……è¶³çš„é—´éš”æ—¶é—´ä¾›å¤§è„‘ä¼‘æ•´ï¼Œæ¯ä¸ªä¸€æ®µæ—¶é—´è®°å¿†ä¸€æ¬¡ã€‚è¿™å…¶å®å°±æ˜¯ä¸€ä¸ªåå¤è®©çŸ¥è¯†å†™å…¥å¤§è„‘çš„è¿‡ç¨‹ã€‚\nç•ªèŒ„å·¥ä½œæ³•ï¼šè®¾å®šæ—¶é—´å•ä½â€”â€”è®°å½•ä»»åŠ¡å®Œæˆæƒ…å†µåŠä¸´æ—¶ä»»åŠ¡â€”â€”æ€»ç»“ã€‚\nè”æƒ³è¿ç§» é€šè¿‡ä¸²è”æ¢³ç†è·å¾—çŸ¥è¯†é“¾ï¼Œè¿è¡Œæ¯”å–»è”æƒ³å°†çŸ¥è¯†ä¸ç”Ÿæ´»ä¸­çš„äº‹ç‰©é…å¯¹ï¼Œé€šè¿‡åˆ†ç±»æ•´åˆå°†çŸ¥è¯†æ‰“åŒ…ï¼Œæ„é€ æƒ…å¢ƒè¾¹å­¦è¾¹æƒ³æ€ä¹ˆç”¨ã€‚\né€šè¿‡è¿ç§»æ‹“å±•å¿«é€ŸæŒæ¡å„ç§æŠ€èƒ½ æˆ‘å›½è‘—åå¿ƒç†å­¦å®¶å†¯å¿ è‰¯æŠŠæ“ä½œæŠ€èƒ½åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š\n ç¬¬ä¸€é˜¶æ®µï¼šç¡®å®šå­¦ä¹ å¯¹è±¡ ç¬¬äºŒé˜¶æ®µï¼šå¿«é€Ÿæ¨¡ä»¿å­¦ä¹ å¯¹è±¡çš„æ¼”ç¤ºå’Œæ“ä½œ ç¬¬ä¸‰é˜¶æ®µï¼šæ“ä½œæ•´åˆ ç¬¬å››é˜¶æ®µï¼šç†Ÿç»ƒç»ƒä¹ ã€‚å°†æ¨¡ä»¿å’Œæ“ä½œæ•´åˆä¸æ–­è¿›è¡Œé‡å¤ã€å½’çº³å’Œæ€»ç»“ï¼Œå¹¶æ³¨æ„ä¸¾ä¸€åä¸‰  æ“ä½œæŠ€èƒ½ä¹ å¾—è¦ç‚¹ï¼š\n åŠ å¼ºæ­£é¢è¿æ¥ï¼šå…³æ³¨æˆåŠŸï¼Œé¿å…å¤±è´¥ å»ºç«‹å¥–åŠ±æœºåˆ¶ å³ä½¿ç›‘æ§ï¼Œè°ƒæ•´éš¾åº¦  ä¿¡æ¯è¾“å‡ºï¼Œå»ºç«‹ä¸ªäººå“ç‰Œ æŒ–æ˜ä¸ªäººå“ç‰Œçš„ 5 ä¸ªåˆ‡å…¥ç‚¹ï¼Œå®ƒä»¬ä¹Ÿå¯ä½œä¸ºäººç”Ÿè§„åˆ’çš„å‚è€ƒï¼š\n ä»·å€¼è¿½æ±‚ã€‚å¤§åˆ°ä½ æƒ³æˆä¸ºä»€ä¹ˆæ ·çš„äººã€ä½ å¸Œæœ›é€šè¿‡ä»€ä¹ˆæ ·çš„äº‹æƒ…è·å¾—è®¤å¯ã€ä½ æœŸå¾…ä¸­çš„ç¾å¥½ä¸–ç•Œé•¿å•¥æ ·ã€ä½ å¦‚ä½•è®©è¿™ä¸ªä¸–ç•Œæ›´ç¾å¥½ï¼Œå°åˆ°ä½ ä¸è‡ªè§‰å…³æ³¨ä»€ä¹ˆæ ·çš„äº‹æƒ…ã€ä½ çš„å…´è¶£çˆ±å¥½ã€è®©ä½ ä»å¿ƒåº•é«˜å…´çš„äº‹æƒ…ç­‰ï¼Œå®ƒä»¬éƒ½å¯ä»¥å¸®ä½ æ‰¾å‡ºè‡ªå·±çš„ä»·å€¼è¿½æ±‚ã€‚ æ½œåŠ›æŒ–æ˜ã€‚å¯¹äºæ™®é€šäººï¼Œä»¥ä¸‹å‡ ç§èƒ½åŠ›å€¼å¾—æ€è€ƒå’ŒåŸ¹å…»ï¼šå†™ä½œèƒ½åŠ›ã€å®¡ç¾èƒ½åŠ›ã€è¯­è¨€è¡¨è¾¾èƒ½åŠ›ã€ä¿¡æ¯åŠ›ã€‚ å“ç‰Œå®šä½ã€‚å…ˆå¼„æ¸…æ¥šå¸‚åœºéœ€æ±‚ï¼Œæ‰¾å‡ºä»·å€¼æ”¾å¤§å™¨ã€‚ æˆé•¿è§„åˆ’ã€‚ä¸æ–­å­¦ä¹ æ–°æŠ€èƒ½ã€ç§¯ç´¯äººè„‰ã€‚ ç»™è‡ªå·±å†™ä¸€ä¸ªæ•…äº‹ã€‚æ•…äº‹æ˜¯æœ€å®¹æ˜“å½±å“äººçš„æ–¹æ³•ï¼Œæœ‰ä¸€ä¸ªæ„æˆå¥½æ•…äº‹çš„åŸºæœ¬å…¬å¼ï¼šå¥½æ•…äº‹ = æ„¿æœ› + è¡ŒåŠ¨ + æƒ…æ„Ÿ  å¹¶ä¸æ˜¯æœ‰äº†å“ç‰Œå°±å®Œäº‹å„¿ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å€ŸåŠ©ç½‘ç»œå¹³å°è¿›è¡Œä¸ªäººå“ç‰Œçš„ç»è¥ã€‚å¸¸è§çš„å¹³å°æœ‰ï¼šé¢†è‹±ã€å…¬ä¼—å·ã€çŸ¥ä¹ã€å¾®åšã€ç¤¾ç¾¤ã€‚\n","href":"/notebook/reading_notes/%E8%B6%85%E7%BA%A7%E6%90%9C%E7%B4%A2%E6%9C%AF/","title":"è¶…çº§æœç´¢æœ¯"},{"content":"1.1 Introduction The nature of computers is described in Stanford\u0026rsquo;s introductory course as:\nThe fundamental equation of computers is: computer = powerful + stupid.\nComputers are very powerful, looking at volumes of data very quickly. Computers can perform billions of operations per second, where each operation is pretty simple.\nComputers are also shockingly stupid and fragile. The operations that they can do are extremely rigid, simple, and mechanical. The computer lacks anything like real insight .. itâ€™s nothing like the HAL 9000 from the movies. If nothing else, you should not be intimidated by the computer as if itâ€™s some sort of brain. Itâ€™s very mechanical underneath it all.\nProgramming is about a person using their real insight to build something useful, constructed out of these teeny, simple little operations that the computer can do.\nâ€”Francisco Cai and Nick Parlante, Stanford CS101\nè°ƒè¯•æŠ€å·§ Learning to interpret errors and diagnose the cause of unexpected errors is called debugging. Some guiding principles of debugging are:\n Test incrementally: Every well-written program is composed of small, modular components that can be tested individually. Test everything you write as soon as possible to catch errors early and gain confidence in your components. Isolate errors: An error in the output of a compound program, expression, or statement can typically be attributed to a particular modular component. When trying to diagnose a problem, trace the error to the smallest fragment of code you can before trying to correct it. Check your assumptions: Interpreters do carry out your instructions to the letter \u0026mdash; no more and no less. Their output is unexpected when the behavior of some code does not match what the programmer believes (or assumes) that behavior to be. Know your assumptions, then focus your debugging effort on verifying that your assumptions actually hold. Consult others: You are not alone! If you donâ€™t understand an error message, ask a friend, instructor, or search engine. If you have isolated an error, but canâ€™t figure out how to correct it, ask someone else to take a look. A lot of valuable programming knowledge is shared in the context of team problem solving.  1.2 The Elements of Programming ç¼–ç¨‹è¯­è¨€ A programming language is more than just a means for instructing a computer to perform tasks. The language also serves as a framework within which we organize our ideas about processes. Programs serve to communicate those ideas among the members of a programming community. Thus, programs must be written for people to read, and only incidentally for machines to execute.\nå‡½æ•°ä¸æ•°æ® In programming, we deal with two kinds of elements: functions and data. Informally, data is stuff that we want to manipulate, and functions describe the rules for manipulating the data.\nç¯å¢ƒ A critical aspect of a programming language is the means it provides for using names to refer to computational objects. If a value has been given a name, we say that the name binds to the value.The possibility of binding names to values and later retrieving those values by name means that the interpreter must maintain some sort of memory that keeps track of the names, values, and bindings. This memory is called an environment. Names can also be bound to functions.\nEnvironments provide the context in which evaluation takes place, which plays an important role in our understanding of program execution.\nå‡½æ•° Pure functions. Functions have some input (their arguments) and return some output (the result of applying them). Pure functions have the property that applying them has no effects beyond returning a value.\nNon-pure functions. In addition to returning a value, applying a non-pure function can generate side effects, which make some change to the state of the interpreter or computer. A common side effect is to generate additional output beyond the return value.\nSignatures. Functions differ in the number of arguments that they are allowed to take. A description of the arguments that a function can take is called the functionâ€™s signature.\n1.6 Higher-Order Functions Functions that manipulate functions are called higher-order functions.\n","href":"/notebook/reading_notes/sicp_in_python/building_abstractions_with_functions/","title":"Building Abstractions with Functions"},{"content":"","href":"/tags/sicp/","title":"SICP"},{"content":"","href":"/tags/%E5%A4%9A%E5%A4%84%E7%90%86%E5%99%A8%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF/","title":"å¤šå¤„ç†å™¨ç¼–ç¨‹çš„è‰ºæœ¯"},{"content":"ä»»ä½•äº’æ–¥åè®®éƒ½ä¼šé¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼šå½“æ— æ³•è·å¾—é”æ—¶ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿæœ‰ä¸¤ç§æ–¹æ¡ˆï¼šä¸€ç§æ˜¯ç»§ç»­è¿›è¡Œå°è¯•ï¼Œè¿™ç§é”ç§°ä¸º è‡ªæ—‹é”ï¼ˆspin lockï¼‰ï¼Œåå¤æ£€æµ‹é”çš„è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºè‡ªæ—‹ï¼ˆspiningï¼‰æˆ–å¿™ç­‰å¾…ï¼ˆbusy waitingï¼‰ï¼Œå½“å¹³å‡è·å–é”æ‰€èŠ±æ—¶é—´è¾ƒçŸ­æ—¶ï¼Œéå¸¸é€‚åˆä½¿ç”¨è‡ªæ—‹é”ã€‚å¦å¤–ä¸€ç§æ–¹æ¡ˆæ˜¯æŒ‚èµ·è‡ªå·±ï¼Œè¯·æ±‚æ“ä½œç³»ç»Ÿå°†å¦ä¸€ä¸ªçº¿ç¨‹è°ƒåº¦åˆ°å½“å‰çš„å¤„ç†å™¨ä¸Šï¼Œè¿™ç§æ–¹å¼è¢«ç§°ä¸º é˜»å¡ï¼ˆblockingï¼‰ï¼Œç”±äºçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢äº§ç”Ÿçš„å¼€é”€å¾ˆå¤§ï¼Œæ‰€ä»¥é˜»å¡é€‚åˆåœ¨è·å–é”æ‰€èŠ±æ—¶é—´è¾ƒé•¿çš„åœºæ™¯ä¸­ä½¿ç”¨ã€‚\nTest-And-Set Locks java.util.concurrentåŒ…ä¸­çš„AtomicBooleanç±»æä¾›äº†ç”¨æ–°å€¼æ›¿æ¢æ—§å€¼å¹¶å°†æ—§å€¼è¿”å›çš„getAndSet(boolean newValue)æ–¹æ³•ï¼Œä¼ ç»Ÿçš„testAndSet()æŒ‡ä»¤å°±ç›¸å½“äºæ˜¯å¯¹getAndSet(true)çš„ä¸€æ¬¡è°ƒç”¨ã€‚TASLockç±»æè¿°äº†ä¸€ä¸ªåŸºäºtestAndSet()æŒ‡ä»¤çš„é”ç®—æ³•ï¼š\npublic class TASLock implements Lock { AtomicBoolean state = new AtomicBoolean(false); public void lock() { while (state.getAndSet(true)) {} } public void unlock() { state.set(false); } } ä¸ºäº†è¯´æ˜TASLockçš„ç¼ºé™·ï¼Œè€ƒè™‘ä¸€ç§åŸºäºæ€»çº¿è¿›è¡Œé€šä¿¡çš„å¤šå¤„ç†å™¨æ¶æ„ï¼šå¤„ç†å™¨å’Œå­˜å‚¨æ§åˆ¶å™¨éƒ½å¯ä»¥åœ¨æ€»çº¿ä¸Šå¹¿æ’­ï¼Œä½†æ˜¯ä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªå¤„ç†å™¨ï¼ˆæˆ–å­˜å‚¨æ§åˆ¶å™¨ï¼‰åœ¨æ€»çº¿ä¸Šå¹¿æ’­ã€‚æ‰€æœ‰çš„å¤„ç†å™¨ï¼ˆæˆ–å­˜å‚¨æ§åˆ¶å™¨ï¼‰éƒ½å¯ä»¥ç›‘å¬ã€‚æ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰ä¸€ä¸ªé«˜é€Ÿç¼“å­˜ï¼ˆcacheï¼‰ï¼Œå½“å¤„ç†å™¨è¯»å–æŸä¸ªåœ°å€çš„æ•°æ®æ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥è¯¥åœ°å€åŠå…¶æ‰€å­˜å‚¨çš„æ•°æ®æ˜¯å¦å·²åœ¨å®ƒçš„cacheä¸­ã€‚å¦‚æœcacheå‘½ä¸­ï¼Œå°±ç›´æ¥è¯»å–ï¼Œå¦è€…éœ€è¦åœ¨å…¶å®ƒå¤„ç†å™¨çš„cacheæˆ–å†…å­˜ä¸­æŸ¥æ‰¾è¿™ä¸ªæ•°æ®ã€‚ä¸ºäº†åœ¨å…¶å®ƒå¤„ç†å™¨çš„cacheä¸­æ‰¾åˆ°éœ€è¦çš„æ•°æ®ï¼Œå¤„ç†å™¨ä¼šåœ¨æ€»çº¿ä¸Šå¹¿æ’­è¿™ä¸ªåœ°å€ï¼Œå¦‚æœç›‘å¬æ€»çº¿çš„å¤„ç†å™¨ä¸­æœ‰ä¸€ä¸ªåœ¨è‡ªå·±çš„cacheä¸­å‘ç°äº†è¿™ä¸ªåœ°å€ï¼Œå°±ä¼šå¹¿æ’­è¯¥åœ°å€æ¥è¿›è¡Œå“åº”ã€‚å¦‚æœæ‰€æœ‰çš„å¤„ç†å™¨ä¸­éƒ½æ²¡æœ‰å‘ç°è¿™ä¸ªåœ°å€ï¼Œåˆ™ä¼šå»è¯»å–å†…å­˜ä¸­è¯¥åœ°å€æ‰€å¯¹åº”çš„å€¼ã€‚\nåœ¨TASLockä¸­ï¼Œæ¯ä¸ªgetAndSet()è°ƒç”¨ç›¸å½“äºæ€»çº¿ä¸Šçš„ä¸€æ¬¡å¹¿æ’­ï¼Œç”±äºæ‰€æœ‰çš„çº¿ç¨‹éƒ½éœ€è¦é€šè¿‡æ€»çº¿å’Œå†…å­˜æ¥è¿›è¡Œé€šä¿¡ï¼Œæ‰€ä»¥getAndSet()ä¼šå»¶è¿Ÿæ‰€æœ‰çš„çº¿ç¨‹ï¼ˆåŒ…æ‹¬é‚£äº›æ²¡æœ‰ç­‰å¾…è¿™ä¸ªé”çš„çº¿ç¨‹ï¼‰ã€‚æ›´åŠ ç³Ÿç³•çš„æ˜¯ï¼ŒgetAndSet()å¼ºåˆ¶å…¶å®ƒå¤„ç†å™¨ä¸¢å¼ƒè‡ªå·±cacheå†…é”çš„å‰¯æœ¬ï¼Œå› æ­¤æ¯ä¸ªè‡ªæ—‹çš„çº¿ç¨‹å‡ ä¹æ¯æ¬¡éƒ½ä¼šé­é‡cacheç¼ºå¤±ï¼Œç„¶åå¿…é¡»ä»æ€»çº¿è·å–æ–°çš„ä½†æœªæ”¹å˜çš„å€¼ã€‚å½“æŒæœ‰é”çš„çº¿ç¨‹å°è¯•é‡Šæ”¾é”æ—¶ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šå› æ€»çº¿è¢«å…¶å®ƒè‡ªæ—‹çš„çº¿ç¨‹ç‹¬å è€Œè¢«å»¶è¿Ÿã€‚\nTTASLockæ˜¯ä¸€ç§æ”¹è¿›åçš„ç®—æ³•ï¼Œå®ƒæ²¡æœ‰ç›´æ¥è°ƒç”¨getAndSet()ï¼Œè€Œæ˜¯ç”±çº¿ç¨‹åå¤åœ°æŸ¥è¯¢é”åœ°çŠ¶æ€ç›´åˆ°é”æ˜¯ç©ºé—²çš„ï¼ˆå³ç›´åˆ°get()è¿”å›falseï¼‰ï¼Œè¿™ç§æŠ€æœ¯è¢«ç§°ä¸ºï¼šTest-Test-And-Set:\npublic class TTASLock implements Lock { AtomicBoolean state = new AtomicBoolean(fasle); public void lock() { while (true) { while (state.get()) {} if (!state.getAndSet(true)) { return; } } } public void unlock() { state.set(false); } } TTASLockçš„æ€§èƒ½æ¯”TASLockè¦å¥½ï¼Œå½“é”è¢«çº¿ç¨‹AæŒæœ‰åï¼Œçº¿ç¨‹Båœ¨ç¬¬ä¸€æ¬¡æ£€æŸ¥é”çš„çŠ¶æ€æ—¶ä¼šå‘ç”Ÿcacheç¼ºå¤±ï¼Œä»è€Œé˜»å¡å¹¶ç­‰å¾…å€¼è¢«è½½å…¥å®ƒçš„cacheä¸­ã€‚åªè¦Aä¸é‡Šæ”¾é”ï¼ŒBå°±ä¼šä¸€ç›´è¯»å–åŒä¸€ä¸ªå€¼å¹¶ä¸”æ¯æ¬¡éƒ½å‘½ä¸­cacheï¼Œè¿™æ ·å°±ä¸ä¼šäº§ç”Ÿæ€»çº¿æµé‡ï¼Œä¹Ÿä¸ä¼šé™ä½å…¶å®ƒçº¿ç¨‹çš„å†…å­˜è®¿é—®é€Ÿåº¦ã€‚æ­¤å¤–ï¼Œé‡Šæ”¾é”çš„çº¿ç¨‹ä¹Ÿä¸ä¼šè¢«æ­£åœ¨è¯¥é”ä¸Šè‡ªæ—‹çš„çº¿ç¨‹åå»¶ã€‚\nç«äº‰ï¼ˆContentionï¼‰ å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶å°è¯•è·å–ä¸€ä¸ªé”æ—¶ï¼Œå°±ä¼šå‘ç”Ÿç«äº‰ã€‚åŒæ—¶äº‰æŠ¢åŒä¸€ä¸ªé”çš„çº¿ç¨‹è¶Šå¤šï¼Œç«äº‰å°±è¶Šæ¿€çƒˆï¼Œä¸ºäº†å‡è½»ç«äº‰ç¨‹åº¦ï¼Œå¯ä»¥è®©è·å–é”çš„çº¿ç¨‹ä¸»åŠ¨â€œæ²‰é»˜â€ä¸€æ®µæ—¶é—´ï¼Œç„¶åå†å°è¯•è·å–é”ã€‚é‚£ä¹ˆçº¿ç¨‹åº”è¯¥â€œæ²‰é»˜â€å¤šä¹…å‘¢ï¼Ÿæœ‰ä¸€ä¸ªå¥½çš„å‡†åˆ™ï¼šå°è¯•è·å–é”çš„å¤±è´¥æ¬¡æ•°è¶Šå¤šï¼Œç«äº‰å¯èƒ½å°±è¶Šæ¿€çƒˆï¼Œâ€œæ²‰é»˜â€çš„æ—¶é—´å°±åº”è¯¥è¶Šé•¿ã€‚\né˜Ÿåˆ—é”ï¼ˆQueue Locksï¼‰ åŸºäºTest-And-Setçš„é”å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š\n Cache-coherence Trafficï¼šæ‰€æœ‰åœ¨åŒä¸€ä¸ªå…±äº«ä½ç½®ä¸Šè‡ªæ—‹çš„çº¿ç¨‹åœ¨æˆåŠŸè®¿é—®é”ä¹‹åéƒ½ä¼šå¸¦æ¥cache-coherence trafficã€‚ Critical Section Underutilizationï¼šæ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¼šå‡ºç°ä¸å¿…è¦çš„å»¶è¿Ÿï¼Œè¿™å›å¯¼è‡´ä¸´ç•ŒåŒºèµ„æºåˆ©ç”¨ä¸è¶³ã€‚  å¯ä»¥å°†çº¿ç¨‹ç»„ç»‡ä¸ºä¸€ä¸ªé˜Ÿåˆ—æ¥å…‹æœè¿™äº›ç¼ºç‚¹ã€‚åœ¨é˜Ÿåˆ—ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹é€šè¿‡æ£€æµ‹å‰ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦å®Œæˆæ¥åˆ¤æ–­æ˜¯å¦è½®åˆ°è‡ªå·±ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨ä¸åŒçš„å­˜å‚¨å•å…ƒä¸Šè‡ªæ—‹ï¼Œé™ä½äº†cache-coherence trafficã€‚æ­¤å¤–ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸éœ€è¦ä¸»åŠ¨åˆ¤æ–­ä½•æ—¶è®¿é—®ä¸´ç•ŒåŒºï¼Œå› ä¸ºé˜Ÿåˆ—ä¸­çš„å‰ä¸€ä¸ªçº¿ç¨‹ä¼šé€šçŸ¥å®ƒï¼Œè¿™æé«˜äº†ä¸´ç•ŒåŒºèµ„æºçš„åˆ©ç”¨ç‡ã€‚\nåŸºäºæ•°ç»„çš„é˜Ÿåˆ—é” ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäºæ•°ç»„çš„ç®€å•é˜Ÿåˆ—é”ALockï¼š\npublic class ALock implements Lock { ThreadLocal\u0026lt;Integer\u0026gt; slotIndex = new ThreadLocal\u0026lt;Integer\u0026gt;(){ protected Integer initialValue() { return 0; } }; AtomicInteger tail; boolean[] flag; int size; public ALock(int capacity) { size = capacity; tail = new AtomicInteger(0); flag = new boolean[capacity]; flag[0] = true; } public void lock() { int slot = tail.getAndIncrement() % size; slotIndex.set(slot); while (!flag[slot]) {}; } public void unlock() { int slot = slotIndex.get(); flag[slot] = false; flag[(slot + 1) % size] = true; } } åœ¨ALockä¸­ï¼ŒtailåŸŸè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå…¶åˆå§‹å€¼ä¸º0ã€‚ä¸ºäº†è·å¾—é”ï¼Œæ¯ä¸ªçº¿ç¨‹åŸå­çš„å¢åŠ tailåŸŸï¼Œæ‰€å¾—ç»“æœå€¼ç§°ä¸ºæ§½ï¼Œæ§½å°†ä½œä¸ºå¸ƒå°”æ•°ç»„flagçš„ç´¢å¼•ã€‚è‹¥flag[slot]=trueï¼Œé‚£ä¹ˆæ§½ä¸ºslotçš„çº¿ç¨‹å°±æœ‰æƒè·å¾—é”ã€‚åˆå§‹çŠ¶æ€ä¸‹ï¼Œflag[0]=trueã€‚ä¸ºäº†è·å¾—é”ï¼Œçº¿ç¨‹ä¸æ–­è‡ªæ—‹ï¼Œç›´åˆ°å®ƒçš„æ§½åœ¨flagæ•°ç»„ä¸­å˜ä¸ºtrueã€‚é‡Šæ”¾é”æ—¶ï¼Œçº¿ç¨‹å°†å®ƒçš„æ§½åœ¨flagæ•°ç»„ä¸­å¯¹åº”çš„ä½ç½®è®¾ç½®ä¸ºfalseï¼Œå¹¶å°†ä¸‹ä¸€ä¸ªæ§½ä½åœ¨flagæ•°ç»„ä¸­çš„å¯¹åº”ä½ç½®è®¾ç½®ä¸ºtrueã€‚\nCLHé˜Ÿåˆ—é” ALockä¿è¯äº†å…ˆæ¥å…ˆæœåŠ¡çš„å…¬å¹³æ€§ï¼Œä½†ç©ºé—´åˆ©ç”¨ç‡å´ä¸æ€ä¹ˆå¥½ã€‚å®ƒè¦æ±‚äº‹å…ˆçŸ¥é“å¹¶å‘çº¿ç¨‹çš„æœ€å¤§æ•°é‡nï¼Œå¹¶ä¸”ä¸ºæ¯ä¸€ä¸ªé”éƒ½åˆ†é…ä¸€ä¸ªå¤§å°ä¸ºnçš„æ•°ç»„ã€‚å› æ­¤ï¼ŒåŒæ­¥Lä¸ªä¸åŒçš„å¯¹è±¡éœ€è¦O(Ln)çš„ç©ºé—´ï¼Œå³ä½¿ä¸€ä¸ªçº¿ç¨‹ä¸€æ¬¡åªè®¿é—®ä¸€æŠŠé”ä¹Ÿæ˜¯è¿™æ ·ã€‚\nCLHLockæ˜¯å¦ä¸€ç§ä¸åŒç±»å‹çš„é˜Ÿåˆ—é”ï¼Œå®ƒæé«˜äº†ç©ºé—´åˆ©ç”¨ç‡ï¼š\npublic class CLHLock implements Lock { AtomicReference\u0026lt;QNode\u0026gt; tail; ThreadLocal\u0026lt;QNode\u0026gt; prev; ThreadLocal\u0026lt;QNode\u0026gt; node; public CLHLock() { tail = new AtomicReference\u0026lt;QNode\u0026gt;(new QNode()); prev = new ThreadLocal\u0026lt;QNode\u0026gt;() { protected QNode initialValue() { return new QNode(); } }; node = new ThreadLocal\u0026lt;QNode\u0026gt;() { protected QNode initialValue() { return null; } }; } public void lock() { QNode qNode = node.get(); qNode.locked = true; QNode prevNode = tail.getAndSet(qNode); prev.set(prevNode); while (prevNode.locked) {} } public void unlock() { QNode qNode = node.get(); qNode.locked = false; node.set(prev.get()); } } ç±»ä¸­çš„QNodeå¯¹è±¡çš„å¸ƒå°”å‹lockedåŸŸä¸­è®°å½•äº†å¯¹åº”çº¿ç¨‹çš„çŠ¶æ€ï¼Œè‹¥ä¸ºtrueï¼Œåˆ™è¡¨ç¤ºç›¸åº”çš„çº¿ç¨‹è¦ä¹ˆå·²ç»è·å¾—é”ï¼Œè¦ä¹ˆæ­£åœ¨ç­‰å¾…é”ï¼Œè‹¥ä¸ºfalseï¼Œåˆ™è¡¨ç¤ºç›¸åº”çš„çº¿ç¨‹å·²ç»é‡Šæ”¾é”ã€‚é”æœ¬èº«è¢«è¡¨ç¤ºæˆä¸€ä¸ªç”±QNodeå¯¹è±¡æ„æˆçš„è™šæ‹Ÿé“¾è¡¨ã€‚è¿™é‡Œçš„é“¾è¡¨æ˜¯ éšå¼çš„ï¼šæ¯ä¸ªçº¿ç¨‹é€šè¿‡Threadlocalç±»å‹çš„prevå˜é‡å¼•ç”¨å…¶å‰é©±ï¼Œå…±äº«å˜é‡tailæŒ‡å‘çš„æ˜¯æœ€æ–°åŠ å…¥é˜Ÿåˆ—çš„èŠ‚ç‚¹ã€‚\nè‹¥è¦è·å¾—é”ï¼Œçº¿ç¨‹å°†å…¶QNodeçš„lockedåŸŸè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºè¯¥çº¿ç¨‹ä¸å‡†å¤‡é‡Šæ”¾é”ã€‚çº¿ç¨‹åœ¨tailåŸŸä¸Šæ‰§è¡ŒgetAndSet()å¹¶ä½¿è‡ªå·±çš„nodeæˆä¸ºé˜Ÿåˆ—ä¸­çš„tailï¼Œä¸æ­¤åŒæ—¶ï¼Œçº¿ç¨‹è¿˜ä¼šè·å¾—ä¸€ä¸ªæŒ‡å‘å‰é©±QNodeçš„å¼•ç”¨ã€‚æœ€åï¼Œçº¿ç¨‹ä¼šç›‘è§†å…¶å‰é©±ï¼Œåœ¨å…¶å‰é©±çš„QNodeçš„lockedåŸŸä¸Šè‡ªæ—‹ï¼Œç­‰å¾…é”è¢«é‡Šæ”¾ã€‚\nè‹¥è¦é‡Šæ”¾é”ï¼Œçº¿ç¨‹å°†å…¶nodeçš„lockedåŸŸè®¾ä¸ºfalseï¼Œè¿™æ ·çº¿ç¨‹çš„åç»§å°±èƒ½å¤Ÿè·å¾—é”äº†ã€‚ç„¶åå›æ”¶å‰é©±çš„QNodeï¼Œç­‰å¾…ä¸‹æ¬¡ä½¿ç”¨ã€‚\nå¦‚æœæœ‰Lä¸ªé”ï¼Œä¸”æ¯ä¸ªçº¿ç¨‹æ¯æ¬¡æœ€å¤šè®¿é—®ä¸€ä¸ªé”ï¼Œä¸ALockæ‰€éœ€è¦çš„O(Ln)ç©ºé—´ç›¸æ¯”ï¼ŒCLHLockåªéœ€è¦O(L+n)çš„ç©ºé—´ã€‚\nMCSé˜Ÿåˆ—é” MCSLockçš„é”ä¹Ÿè¢«è¡¨ç¤ºä¸ºQNodeå¯¹è±¡çš„é“¾è¡¨ï¼Œä¸CLHLockä¸åŒçš„æ˜¯ï¼ŒMCSLockä¸­çš„é“¾è¡¨ä¸æ˜¯éšå¼çš„ï¼šæ•´ä¸ªé“¾è¡¨é€šè¿‡QNodeå¯¹è±¡é‡Œçš„nextåŸŸè¿æ¥ã€‚\npublic class MCSLock implements Lock { AtomicReference\u0026lt;QNode\u0026gt; tail; ThreadLocal\u0026lt;QNode\u0026gt; node; public MCSLock() { tail = new AtomicReference\u0026lt;QNode\u0026gt;(null); node = new ThreadLocal\u0026lt;QNode\u0026gt;() { protected QNode initialValue() { return null; } }; } public void lock() { QNode qNode = node.get(); QNode prev = tail.getAndSet(qNode); if (prev != null) { qNode.locked = true; prev.next = qNode; while (qNode.locked) {} } } public void unlock() { QNode qNode = node.get(); if (qNode.next == null) { if (tail.compareAndSet(qNode, null)) return; while (qNode.next == null) {} } qNode.next.locked = false; node.next = null; } class QNode { boolean locked = false; QNode next = null; } } è‹¥è¦è·å¾—é”ï¼Œçº¿ç¨‹å°†è‡ªå·±çš„QNodeæ·»åŠ åˆ°é“¾è¡¨çš„å°¾éƒ¨ã€‚è‹¥é˜Ÿåˆ—åŸå…ˆä¸ä¸ºç©ºï¼Œåˆ™å°†å…¶å‰é©±QNodeçš„nextåŸŸè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹è‡ªå·±çš„QNodeï¼Œç„¶ååœ¨è‡ªå·±QNodeçš„lockedåŸŸä¸Šè‡ªæ—‹ç­‰å¾…ï¼Œç›´åˆ°å‰é©±å°†è¯¥åŸŸè®¾ä¸ºfalseä¸ºæ­¢ã€‚\né‡Šæ”¾é”æ—¶ï¼Œçº¿ç¨‹ä¼šå…ˆæ£€æŸ¥QNodeçš„nextåŸŸæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¡¨ç¤ºå½“å‰æ²¡æœ‰å…¶å®ƒçº¿ç¨‹æ­£åœ¨äº‰ç”¨è¯¥é”ï¼Œæˆ–å½“å‰å­˜åœ¨ä¸€ä¸ªäº‰ç”¨è¯¥é”çš„çº¿ç¨‹ï¼Œä½†è¿™ä¸ªçº¿ç¨‹è¿è¡Œå¾—å¾ˆæ…¢ã€‚ä¸ºäº†åŒºåˆ†è¿™ä¸¤ç§æƒ…å†µï¼Œä»¤qNodeä¸ºå½“å‰çº¿ç¨‹çš„QNodeï¼Œå¯¹tailåŸŸè°ƒç”¨compareAndSet(qNode, null)ï¼Œå¦‚æœè°ƒç”¨æˆåŠŸï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰å…¶å®ƒçº¿ç¨‹æ­£åœ¨è¯•å›¾è·å¾—é”ï¼Œæ–¹æ³•ä¼štailåŸŸä¼šè®¾ç½®ä¸ºnullåç›´æ¥è¿”å›ã€‚å¦åˆ™ï¼Œè¯´æ˜æ˜¯ç¬¬äºŒç§æƒ…å†µï¼Œæ–¹æ³•ä¼šè‡ªæ—‹ç­‰å¾…ï¼Œç›´è‡³ç»“æŸã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œä¸€æ—¦å‡ºç°äº†åç»§ï¼Œå°±å°†åç»§èŠ‚ç‚¹çš„lockedåŸŸè®¾ç½®ä¸ºfalseï¼Œè¡¨æ˜å½“å‰é”æ˜¯ç©ºé—²çš„ã€‚\nMCSLockå…·æœ‰CLHLockçš„ä¼˜ç‚¹ï¼Œç©ºé—´å¤æ‚åº¦ä¹Ÿä¸ºO(L+n)ã€‚å’ŒCLHLockç›¸æ¯”ï¼ŒMCSLockåœ¨é‡Šæ”¾é”æ—¶ä¹Ÿéœ€è¦è‡ªæ—‹ï¼ŒæŒ‡ä»¤æ¡æ•°ä¹Ÿæ›´å¤šã€‚\n","href":"/notebook/reading_notes/the_art_of_multiprocessor_programming/spinlock/","title":"è‡ªæ—‹é”"},{"content":"åŠ é€Ÿæ¯” : å¯¹äºæŸä¸€é¡¹å·¥ä½œï¼ŒåŠ é€Ÿæ¯”æŒ‡çš„æ˜¯ä¸€ä¸ªå¤„ç†å™¨å®Œæˆè¯¥å·¥ä½œæ‰€ç”¨çš„æ—¶é—´ä¸é‡‡ç”¨nä¸ªå¤„ç†å™¨å¹¶è¡Œå®Œæˆè¯¥å·¥ä½œæ‰€ç”¨æ—¶é—´çš„æ¯”å€¼ã€‚\nAmdahlå®šå¾‹ç»™å‡ºäº†nä¸ªå¤„ç†å™¨ååŒå®Œæˆä¸€é¡¹å·¥ä½œæ—¶å¯è·å¾—çš„æœ€å¤§åŠ é€Ÿæ¯” Sï¼Œå…¶ä¸­ **p**è¡¨ç¤ºçš„æ˜¯è¯¥å·¥ä½œä¸­å¯ä»¥è¢«å¹¶è¡Œæ‰§è¡Œçš„éƒ¨åˆ†ã€‚å‡è®¾å®Œæˆè¯¥å·¥ä½œéœ€è¦ **1**ä¸ªå•ä½çš„æ—¶é—´ï¼Œé‚£ä¹ˆä¸²è¡Œéƒ¨åˆ†æ‰€éœ€è¦çš„æ—¶é—´ä¸º 1-pï¼Œè€Œå¹¶è¡Œéƒ¨åˆ†éœ€è¦çš„æ—¶é—´ä¸º p/nã€‚å› æ­¤ï¼Œé‡‡ç”¨å¹¶è¡Œå¤„ç†ä¹‹åï¼Œå®Œæˆæ•´ä¸ªå·¥ä½œæ‰€éœ€è¦çš„æ—¶é—´ä¸ºï¼š\n$$ 1 - p + \\frac{p}{n} $$\nè¿›ä¸€æ­¥å¯ä»¥å¾—å‡ºåŠ é€Ÿæ¯”ï¼š\n$$ S = \\frac{1}{1 - p + \\frac{p}{n}} $$\nAmdahlå®šå¾‹å‘Šè¯‰æˆ‘ä»¬ï¼šå®Œæˆå¤æ‚å·¥ä½œå¯è·å¾—çš„åŠ é€Ÿæ¯”æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”å—é™äºè¿™ä¸ªå·¥ä½œä¸­å¿…é¡»è¢«ä¸²è¡Œæ‰§è¡Œçš„éƒ¨åˆ†ã€‚\nå¯¹äºä¸€ä¸ªç»™å®šçš„é—®é¢˜ä»¥åŠä¸€å°å…·æœ‰10ä¸ªå¤„ç†å™¨çš„æœºå™¨ï¼Œç”±Amdahlå®šå¾‹å¯çŸ¥ï¼Œå³ä½¿å…¶ä¸­çš„90%å¯ä»¥å¹¶è¡Œï¼Œæœ€ç»ˆä¹Ÿåªèƒ½è·å¾—5å€çš„åŠ é€Ÿæ¯”ï¼Œè€Œä¸æ˜¯10å€ï¼š\n$$ S = \\frac{1}{1 - p + \\frac{p}{n}} = \\frac{1}{1 - 0.9 + \\frac{0.9}{10}} = \\frac{1}{1-0.9+0.09} \\approx 5 $$\nå› æ­¤ï¼Œè¦è·å¾—æ›´é«˜çš„åŠ é€Ÿæ¯”ï¼Œå°±è¦å°½å¯èƒ½åœ°ä½¿å¾—ä¸²è¡Œéƒ¨åˆ†è¾¾åˆ°æœ€å¤§ç¨‹åº¦å¾—å¹¶è¡Œã€‚åœ¨å¹¶å‘ç¨‹åºè®¾è®¡é‡Œï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥åœ¨ä¿è¯ç¨‹åºæ­£ç¡®åœ°æƒ…å†µä¸‹å°½å¯èƒ½åœ°å‡å°‘ä¸²è¡Œéƒ¨åˆ†ï¼ˆ åŒæ­¥ä»£ç å—æ‰€åŒ…å«æŒ‡ä»¤æ•°é‡ï¼‰ã€‚\n","href":"/notebook/reading_notes/the_art_of_multiprocessor_programming/amdahls_law/","title":"Amdahlå®šå¾‹"},{"content":"","href":"/tags/tomcat/","title":"Tomcat"},{"content":" è¿™é‡Œè®°å½•äº†å°†Tomcatæºç å¯¼å…¥IDEAå¹¶å¯åŠ¨å®¹å™¨çš„è¿‡ç¨‹ã€‚\n å‡†å¤‡ç¯å¢ƒ ä¸ºäº†å°†Tomcatçš„æºç å¯¼å…¥IDEAï¼Œæˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡å¥½JDKã€Intellij IDEAå’ŒApache Antã€‚ä¸åŒç‰ˆæœ¬çš„Tomcatå¯¹JDKå’ŒAntçš„ç‰ˆæœ¬è¦æ±‚æœ‰æ‰€ä¸åŒï¼Œå…·ä½“çš„ç‰ˆæœ¬è¦æ±‚å¯ä»¥åœ¨Tomcatå®˜ç½‘çš„æ–‡æ¡£é‡Œæ‰¾åˆ°ï¼Œä¾‹å¦‚ï¼šTomcat 9å¯¹å·¥å…·çš„è¦æ±‚ã€‚\nåœ¨å®‰è£…å®ŒJDKå’ŒAntä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼š\n JAVA_HOMEï¼šæŒ‡å‘JDKçš„å®‰è£…ç›®å½•ã€‚ ANT_HOMEï¼šæŒ‡å‘Antçš„å®‰è£…ç›®å½•ã€‚  ä¸ºäº†ä½¿ç”¨javaå’Œantå‘½ä»¤ï¼Œæˆ‘è¿˜éœ€è¦å°†%JAVA_HOME%\\binå’Œ%ANT_HOME%\\binæ·»åŠ åˆ°Windowsç³»ç»Ÿçš„PATHç¯å¢ƒå˜é‡é‡Œå»ï¼Œæˆ–è€…å°†${JAVA_HOME}/binå’Œ${ANT_HOME}/binæ·»åŠ åˆ°Linuxç³»ç»Ÿçš„PATHç¯å¢ƒå˜é‡é‡Œå»ã€‚\nè·å–Tomcatæºç  æˆ‘æ‰€ç”¨çš„æºç æ˜¯ç›´æ¥ä»Githubä¸‹è½½çš„ï¼Œå¯¹åº”çš„æ˜¯masteråˆ†æ”¯ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥åˆ°Tomcatå®˜ç½‘ä¸‹è½½ç‰¹å®šç‰ˆæœ¬çš„æºç ã€‚\næ„å»ºTomcat é…ç½®æ„å»ºå‚æ•° å°†Tomcatæºä»£ç ç›®å½•ä¸­çš„build.properties.defaultå¤åˆ¶ä¸€ä»½ä¸ºbuild.propertieså¹¶æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚åœ¨æ„å»ºTomcatçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰å¾ˆå¤šçš„ä¾èµ–åº“è¢«ä¸‹è½½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›ä¾èµ–åº“å°†ä¼šè¢«ä¸‹è½½åˆ°ï¼š${user.home}/tomcat-build-libsä¸­ï¼Œè¿™ä¸ªä½ç½®å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®é¡¹base.pathçš„å€¼æ¥æ”¹å˜ã€‚æˆ‘æ²¡æœ‰å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œä¸€åˆ‡éƒ½æ˜¯ç”¨çš„é»˜è®¤å€¼ã€‚\næ„å»ºTomcat é¦–å…ˆåˆ‡æ¢åˆ°Tomcatæºä»£ç çš„æ ¹ç›®å½•ã€‚æˆ‘ä»¬å¯ä»¥ä»¥é»˜è®¤çš„æ–¹å¼æ„å»ºTomcatï¼Œåªéœ€è¦æ‰§è¡Œantå‘½ä»¤å³å¯ã€‚ä½†æ˜¯è¿™æ ·æ„å»ºå®Œä¹‹åç›´æ¥å¯¼å…¥IDEAæ˜¯ä¼šæœ‰é—®é¢˜çš„ã€‚ä¸ºäº†å°†ä»£ç å¯¼å…¥IDEAï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œant -buildfile build.xml ide-intellijã€‚è¿™å‘Šè¯‰Antå°†ide-intellijä½œä¸ºæ­¤æ¬¡æ„å»ºçš„ç›®æ ‡ã€‚æˆ‘ä»¬ä¸å¦¨æ¥çœ‹ä¸€ä¸‹ç›¸å…³å†…å®¹ï¼š\n\u0026lt;target name=\u0026#34;ide-intellij\u0026#34; depends=\u0026#34;download-compile, download-test-compile\u0026#34; description=\u0026#34;Creates project directory .idea for IntelliJ IDEA\u0026#34;\u0026gt; \u0026lt;copy todir=\u0026#34;${tomcat.home}/.idea\u0026#34;\u0026gt; \u0026lt;fileset dir=\u0026#34;${tomcat.home}/res/ide-support/idea\u0026#34;/\u0026gt; \u0026lt;/copy\u0026gt; \u0026lt;echo\u0026gt;IntelliJ IDEA project directory created. Please create PATH VARIABLES for ANT_HOME = ${ant.home} TOMCAT_BUILD_LIBS = ${base.path} \u0026lt;/echo\u0026gt; \u0026lt;/target\u0026gt; å‘½ä»¤æ‰§è¡Œå®Œä¹‹åï¼Œç»ˆç«¯ä¼šæé†’æˆ‘ä»¬åˆ›å»ºANT_HOMEå’ŒTOMCAT_BUILD_LIBSè¿™ä¸¤ä¸ªPATHå˜é‡ã€‚\nå°†æºç å¯¼å…¥IDEA æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æ„å»ºå®ŒTomcatä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å°†Tomcatæºç å¯¼å…¥IDEAäº†ã€‚\nè‹¥ä¸è®¾ç½®ANT_HOMEå’ŒTOMCAT_BUILD_LIBSï¼Œç›´æ¥æ„å»ºå·¥ç¨‹çš„ç»“æœå°±æ˜¯å„ç§æ‰¾ä¸åˆ°ä¾èµ–ã€‚æ‰“å¼€Project Structure -\u0026gt; Project Settings -\u0026gt; Modules -\u0026gt; tomcat -\u0026gt; Dependenciesä½ ä¼šå‘ç°è¿™é‡Œç½—åˆ—çš„ä¾èµ–é¡¹éƒ½æ˜¯çº¢è‰²çš„(IDEAæ‰¾ä¸åˆ°è¿™äº›ä¾èµ–)ã€‚\næ‰“å¼€File -\u0026gt; Settings -\u0026gt; Appearance \u0026amp; Behavior -\u0026gt; Path Variablesã€‚æ·»åŠ ANT_HOMEå’ŒTOMCAT_BUILD_LIBSä¸¤æ¡å˜é‡ï¼Œå€¼åˆ†åˆ«è®¾ç½®ä¸ºant.homeå’Œbase.pathçš„å®é™…å€¼ã€‚ç„¶åé‡æ–°æ„å»ºå°±OKäº†ã€‚\nå¯åŠ¨Tomcat Tomcatçš„å¯åŠ¨ç±»ä¸ºorg.apache.catalina.startup.Bootstrapã€‚ç›´æ¥è¿è¡Œæ˜¯ä¼šæŠ¥é”™çš„ã€‚\nå…¶å®åœ¨æ‰§è¡Œantå‘½ä»¤ä¹‹åï¼Œæºä»£ç æ ¹ç›®å½•ä¸‹é¢çš„outputçš„æ–‡ä»¶å¤¹ä¸‹ä¼šå‡ºç°ä¸€ä¸ªåä¸ºbuildçš„æ–‡ä»¶å¤¹ã€‚å®ƒçš„è·¯å¾„å°±æ˜¯è¿è¡Œ Bootstrap ç±»æ‰€éœ€è¦çš„catalina.homeå‚æ•°ã€‚ä¾‹å¦‚ï¼Œæˆ‘çš„æœºå™¨ä¸Šbuildçš„è·¯å¾„ä¸ºC:/Code/Apache/tomcat/output/buildã€‚æ‰€ä»¥å°†-Dcatalina.home=\u0026quot;C:/Code/Apache/tomcat/output/build\u0026quot;æ·»åŠ åˆ°VM optionsä¸­ä¹‹åï¼Œå°±å¯ä»¥æ­£å¸¸å¯åŠ¨Tomcatäº†ï¼Œç„¶åä½¿ç”¨æµè§ˆå™¨è®¿é—®http://127.0.0.1:8080å°±èƒ½çœ‹åˆ°é‚£åªçŒ«äº†ã€‚\nä¸è¿‡ä½ ä¼šå‘ç°ï¼Œåå°ä¼šå‡ºç°ä¸€å †ä¹±ç ã€‚è§£å†³æ€è·¯å¯ä»¥å‚è€ƒï¼šç¼–è¯‘Tomcat9æºç åŠtomcatä¹±ç é—®é¢˜è§£å†³ã€‚ä»–ä½¿ç”¨-Dfile.encoding=UTF8 -Duser.language=en -Duser.region=USè¿™ä¸‰ä¸ªå‚æ•°ç»•è¿‡äº†ä¹±ç çš„é—®é¢˜ã€‚\n","href":"/posts/getting_started/import_tomcat_source_code_into_intellij/","title":"å°†Tomcatæºç å¯¼å…¥IDEA"},{"content":"","href":"/categories/%E6%96%B0%E6%89%8B%E4%B8%8A%E8%B7%AF/","title":"æ–°æ‰‹ä¸Šè·¯"},{"content":"å®‰å…¨ç¯å¢ƒ å¨èƒ ä¿¡æ¯ç³»ç»Ÿçš„å®‰å…¨æ€§ç›®æ ‡é€šå¸¸å¯ä»¥åˆ†è§£ä¸ºä¸‰ä¸ªéƒ¨åˆ†:\n æœºå¯†æ€§(confidentiality)ï¼šæ˜¯æœºå¯†çš„æ•°æ®å¤„äºä¿å¯†çŠ¶æ€ã€‚ç³»ç»Ÿåº”è¯¥ä¿è¯æ•°æ®ä¸è¢«æœªç»æˆæƒçš„ç”¨æˆ·è®¿é—®ã€‚ å®Œæ•´æ€§(integrity)ï¼šæœªç»æˆæƒçš„ç”¨æˆ·æ— æ³•åœ¨æœªç»æ•°æ®æ‹¥æœ‰ç€æˆæƒçš„æƒ…å†µä¸‹ä¿®æ”¹ä»»ä½•æ•°æ®ã€‚è¿™é‡Œçš„æ•°æ®ä¿®æ”¹ä¸ä»…åŒ…æ‹¬ä¿®æ”¹æ•°æ®æœ¬èº«ï¼Œè¿˜åŒ…æ‹¬åˆ é™¤æˆ–æ·»åŠ é”™è¯¯æ•°æ®ã€‚ å¯ç”¨æ€§(availability)ï¼šæ²¡æœ‰äººå¯ä»¥æ‰°ä¹±ç³»ç»Ÿä½¿ä¹‹ä¸å¯ç”¨ã€‚  è¿™ä¸‰ä¸ªéƒ¨åˆ†é€šå¸¸è¢«ç§°ä¸ºCIAã€‚å®ƒä»¬å—åˆ°çš„å¨èƒå„ä¸ç›¸åŒï¼š\n   ç›®æ ‡ å¨èƒ     æ•°æ®æœºå¯†æ€§ æ•°æ®æš´éœ²   æ•°æ®å®Œæ•´æ€§ æ•°æ®ç¯¡æ”¹   ç³»ç»Ÿå¯ç”¨æ€§ æ‹’ç»æœåŠ¡    æ“ä½œç³»ç»Ÿå®‰å…¨ ä¸€èˆ¬è€Œè¨€ï¼Œæ”»å‡»å¯ä»¥åˆ†ä¸ºè¢«åŠ¨æ”»å‡»å’Œä¸»åŠ¨æ”»å‡»ã€‚è¢«åŠ¨æ”»å‡»è¯•å›¾çªƒå–ä¿¡æ¯ï¼Œè€Œä¸»åŠ¨æ”»å‡»ä¼šä½¿è®¡ç®—æœºè¡Œä¸ºå¼‚å¸¸ã€‚åŠ å¯†(cryptography) ä»¥æŸç§æ–¹å¼å¯¹æ¶ˆæ¯æˆ–æ–‡ä»¶è¿›è¡Œè½¬ç ï¼Œä½¿æ”»å‡»è€…åœ¨æ²¡æœ‰å¯†é’¥çš„æƒ…å†µä¸‹å¾ˆéš¾æ¢å¤å‡ºåŸå†…å®¹ã€‚åŠ å›º(hardening) æ˜¯æŒ‡åœ¨ç¨‹åºä¸­åŠ å…¥ä¿æŠ¤æœºåˆ¶ä»¥åŠ å¤§æ”»å‡»è€…ç ´åç¨‹åºçš„éš¾åº¦ã€‚\nå¯ä¿¡è®¡ç®—åŸº å¯ä¿¡ç³»ç»Ÿ(trusted systems) åœ¨å½¢å¼ä¸Šç”³æ˜äº†å®‰å…¨è¦æ±‚å¹¶æ»¡è¶³äº†è¿™äº›å®‰å…¨è¦æ±‚ã€‚æ¯ä¸€ä¸ªå¯ä¿¡ç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯æœ€å°çš„å¯ä¿¡è®¡ç®—åŸº(Trusted Computing Base, TCB)ï¼Œå®ƒåŒ…å«äº†å®æ–½æ‰€æœ‰å®‰å…¨è§„åˆ™æ‰€å¿…é¡»çš„ç¡¬ä»¶å’Œè½¯ä»¶ã€‚\nä¿æŠ¤æœºåˆ¶ ä¿æŠ¤åŸŸ è®¡ç®—æœºç³»ç»Ÿå†…æœ‰è®¸å¤šéœ€è¦ä¿æŠ¤çš„â€œå¯¹è±¡â€ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥æ˜¯ç¡¬ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯è½¯ä»¶ã€‚æƒé™ æ˜¯è¿›è¡ŒæŸä¸ªæ“ä½œçš„è®¸å¯ã€‚ä¸ºäº†è®¨è®ºä¸åŒçš„ä¿æŠ¤æœºåˆ¶ï¼Œéœ€è¦å¼•å…¥åŸŸçš„æ¦‚å¿µã€‚åŸŸ(domain) æ˜¯(å¯¹è±¡ï¼Œæƒé™)å¯¹çš„é›†åˆï¼Œæ¯ä¸€ä¸ª(å¯¹è±¡ï¼Œæƒé™)å¯¹éƒ½åˆ¶å®šäº†ä¸€ä¸ªå¯¹è±¡å’Œä¸€äº›å¯åœ¨å…¶ä¸Šè¿›è¡Œçš„æ“ä½œçš„å­é›†ã€‚\néœ€æ±‚å†³å®šå¯¹è±¡è¢«åˆ†é…åˆ°çš„åŸŸï¼Œä¸€ä¸ªåŸºæœ¬çš„åŸåˆ™å°±æ˜¯æœ€å°‘æƒé™åŸåˆ™(Principle of Least Authority, POLA)ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå½“æ¯ä¸ªåŸŸä¸­åªå«æœ‰å®Œæˆå…¶å·¥ä½œæ‰€éœ€è¦çš„ æœ€å°‘ çš„å¯¹è±¡å’Œæƒé™æ—¶ï¼Œå®‰å…¨æ€§æœ€å¥½ã€‚\nä¸ºäº†è·Ÿè¸ªå¯¹è±¡æ‰€å±çš„åŸŸï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªçŸ©é˜µï¼ŒçŸ©é˜µçš„è¡Œä»£è¡¨åŸŸï¼Œåˆ—ä»£è¡¨å¯¹è±¡ï¼Œç„¶ååœ¨çŸ©é˜µä¸­çš„æ¯ä¸ªå…ƒç´ ä¸­åˆ—å‡ºå¯¹è±¡åœ¨è¯¥åŸŸä¸­æ‰€åŒ…å«çš„æƒé™ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¡¨ä¸­å±•ç¤ºäº†ä¸‰ä¸ªåŸŸå’Œ8ä¸ªå¯¹è±¡ï¼š\n    File1 File2 File3 File4 File5 File6 Printer1 Plotter2     Domain 1 R RW         Domain 2   R RWX RW  W    Domain 3      RWX W W    åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¾ˆå°‘é‡‡ç”¨ä¸Šè¿°çŸ©é˜µçš„æ–¹å¼æ¥å­˜å‚¨æƒé™ä¿¡æ¯ï¼Œå› ä¸ºçŸ©é˜µè¿‡å¤§å¹¶ä¸”è¿‡äºç¨€ç–ï¼Œéå¸¸æµªè´¹ç©ºé—´ã€‚ä½†è¿˜æœ‰ä¸¤ç§å¯è¡Œæ–¹æ³•ï¼Œå®ƒä»¬é€šè¿‡æŒ‰è¡Œæˆ–æŒ‰åˆ—æ¥å­˜å‚¨è¿™ä¸ªçŸ©é˜µå¹¶åªä¿å­˜éç©ºå…ƒç´ ã€‚\nè®¿é—®æ§åˆ¶åˆ—è¡¨ å…ˆæ¥çœ‹æŒ‰åˆ—å­˜å‚¨ï¼Œä¸ºæ¯ä¸ªå¯¹è±¡å…³è”ä¸€ä¸ª(æœ‰åº)åˆ—è¡¨ï¼Œåˆ—è¡¨é‡Œé¢åŒ…å«äº†æ‰€æœ‰å¯è®¿é—®è¯¥å¯¹è±¡çš„æ‰€æœ‰åŸŸä»¥åŠè¿™äº›åŸŸè®¿é—®è¯¥å¯¹è±¡çš„æ–¹æ³•ã€‚è¿™ä¸ªåˆ—è¡¨å°±æ˜¯è®¿é—®æ§åˆ¶åˆ—è¡¨(Access Control List, ACL)ã€‚ä¾‹å¦‚ï¼šä¸‹å›¾å±•ç¤ºäº†ä¸‰ä¸ªè¿›ç¨‹Aã€Bã€Cï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½å±äºä¸åŒçš„åŸŸã€‚F1ã€F2ã€F3ä¸ºä¸‰ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªç›¸å…³è”çš„ACLã€‚è‹¥å‡è®¾ä¸€ä¸ªåŸŸç›¸å½“äºä¸€ä¸ªç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰ç”¨æˆ·Aã€Bã€Cï¼Œåœ¨å®‰å…¨æ€§è¯­è¨€é‡Œï¼Œç”¨æˆ·é€šå¸¸è¢«å«åšä¸»ä½“(subjectæˆ–principal)ï¼Œè€Œå®ƒä»¬æ‰€æ‹¥æœ‰çš„ä¸ºå¯¹è±¡(object)(æ¯”å¦‚æ–‡ä»¶)ã€‚\nå¾ˆå¤šç³»ç»Ÿä¸­ä¹Ÿæ”¯æŒ ç»„(group) çš„æ¦‚å¿µï¼Œç»„å¯ä»¥æœ‰è‡ªå·±çš„åå­—å¹¶åŒ…å«åœ¨ACLä¸­ã€‚åœ¨æŸäº›ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹é™¤äº†UIDå¤–ï¼Œè¿˜æœ‰GIDã€‚è¿™ç±»ç³»ç»Ÿä¸­çš„ACLå¯èƒ½é•¿è¿™æ ·ï¼šUID1, GID1: rights1; UID2, GID2: rights2; \u0026hellip;\nè¿™æ ·ï¼Œå½“å‡ºç°è®¿é—®å¯¹è±¡çš„è¯·æ±‚æ—¶ï¼Œå¿…é¡»åŒæ—¶æ£€æŸ¥è°ƒç”¨è€…çš„UIDå’ŒGIDã€‚å¦‚æœå®ƒä»¬éƒ½å‡ºç°åœ¨ACLä¸­ï¼Œæ‰€åˆ—å‡ºçš„æƒé™å°±æ˜¯å¯è¡Œçš„ï¼Œå¦åˆ™è®¿é—®ä¼šè¢«æ‹’ç»ã€‚ç»„ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯**è§’è‰²(role)**çš„æ¦‚å¿µã€‚\næƒèƒ½å­— ç°åœ¨æ¥çœ‹æŒ‰è¡Œå­˜å‚¨çš„æ–¹å¼ã€‚è¿™ä¸ªæ—¶å€™ä¸æ¯ä¸ªåŸŸ(æˆ–è¿›ç¨‹)å…³è”çš„æ˜¯å¯è®¿é—®çš„å¯¹è±¡åˆ—è¡¨ï¼Œä»¥åŠè¿›ç¨‹å¯åœ¨å¯¹è±¡ä¸Šæ‰§è¡Œçš„æ“ä½œã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ªè¿›ç¨‹å°±å…·æœ‰ä¸€ä¸ªæƒèƒ½å­—åˆ—è¡¨(capability list or C-list)ï¼Œé‡Œè¡¨ä¸­çš„æ¯ä¸ªå•ç‹¬çš„å…ƒç´ å°±æ˜¯ä¸€ä¸ªæƒèƒ½å­—(capobility)ã€‚ä¸‹å›¾å±•ç¤ºäº†Aã€Bã€Cä¸‰ä¸ªè¿›ç¨‹çš„æƒèƒ½å­—ï¼Œæ¯ä¸€ä¸ªæƒèƒ½å­—èµ‹äºˆæ‰€æœ‰è€…åœ¨ç‰¹å®šå¯¹è±¡ä¸Šçš„æƒé™ï¼š\nå¾ˆæ˜æ˜¾ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»é˜²æ­¢ç”¨æˆ·ç¯¡æ”¹æƒèƒ½å­—åˆ—è¡¨ã€‚å·²çŸ¥çš„ä¿æŠ¤æ–¹æ³•æœ‰ä¸‰ç§:\n å»ºç«‹å¸¦æ ‡è®°çš„ä½“ç³»ç»“æ„ã€‚åœ¨è¿™ç§ç¡¬ä»¶è®¾è®¡ä¸­ï¼Œæ¯ä¸ªå†…å­˜å­—å¿…é¡»æ‹¥æœ‰é¢å¤–çš„ä½(æˆ–æ ‡è®°ä½)æ¥åˆ¤æ–­è¯¥å­—æ˜¯å¦åŒ…å«äº†æƒèƒ½å­—ã€‚æ ‡è®°ä½ä¸èƒ½è¢«ç®—æœ¯ã€æ¯”è¾ƒç­‰æŒ‡ä»¤ä½¿ç”¨ï¼Œä»…å¯ä»¥è¢«åœ¨å†…æ ¸æ€ä¸‹è¿è¡Œçš„ç¨‹åºä¿®æ”¹ã€‚ åœ¨æ“ä½œç³»ç»Ÿå†…ä¿å­˜æƒèƒ½å­—åˆ—è¡¨ï¼Œéšåæ ¹æ®æƒèƒ½å­—åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®å¼•ç”¨æƒèƒ½å­—ã€‚ æŠŠæƒèƒ½å­—åˆ—è¡¨æ”¾åœ¨ç”¨æˆ·ç©ºé—´ä¸­ï¼Œå¹¶ç”¨åŠ å¯†çš„æ–¹æ³•è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·ç”¨æˆ·å°±ä¸èƒ½ç¯¡æ”¹å®ƒä»¬ã€‚è¿™ç§æ–¹æ³•æ¯”è¾ƒé€‚åˆåˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿã€‚  å¯†ç å­¦åŸç† åŠ å¯†çš„ç›®çš„æ˜¯é€šè¿‡æŸç§æ‰‹æ®µå°† æ˜æ–‡(plaintext) åŠ å¯†æˆ å¯†æ–‡(ciphertext)ï¼Œåªæœ‰è¢«æˆæƒçš„äººæ‰çŸ¥é“å¦‚ä½•å°†å¯†æ–‡æ¢å¤ä¸ºåŸæ¥çš„æ˜æ–‡ã€‚è€Œå¯¹äºæ— å…³çš„äººæ¥è¯´ï¼Œå¯†æ–‡å°±æ˜¯ä¸€æ®µæ— æ³•ç†è§£çš„ç¼–ç ã€‚\nåœ¨ç®—æ³•ä¸­ä½¿ç”¨çš„åŠ å¯†å‚æ•°å«åšå¯†é’¥(key)ã€‚å¦‚æœç”¨Pè¡¨ç¤ºæ˜æ–‡ï¼Œ $K_E$ è¡¨ç¤ºåŠ å¯†å¯†é’¥ï¼ŒCè¡¨ç¤ºå¯†æ–‡ï¼ŒEè¡¨ç¤ºåŠ å¯†ç®—æ³•ï¼Œé‚£ä¹ˆåŠ å¯†å°±å¯ä»¥å®šä¹‰ä¸ºï¼š$C = E(P, K_E)$ ã€‚è·å…°å¯†ç å­¦å®¶Kerckhoffsäº19ä¸–çºªæå‡ºäº†KerckhoffsåŸåˆ™ï¼Œè®¤ä¸ºï¼šåŠ å¯†ç®—æ³•æœ¬èº«åº”è¯¥å®Œå…¨å…¬å¼€ï¼Œè€ŒåŠ å¯†çš„å®‰å…¨æ€§ç”±ç‹¬ç«‹äºåŠ å¯†ç®—æ³•ä¹‹å¤–çš„å¯†é’¥å†³å®šã€‚\nåŒæ ·åœ°ï¼Œè‹¥ç”¨Dè¡¨ç¤ºè§£å¯†ç®—æ³•ï¼Œ $K_D$ è¡¨ç¤ºè§£å¯†å¯†é’¥ï¼Œåˆ™ $P = D(C, K_D)$ ã€‚åŠ å¯†ä¸è§£å¯†è¿ç®—åœ°å…³ç³»å¦‚ä¸‹ï¼š\nç§é’¥åŠ å¯†æŠ€æœ¯ æˆ– å¯¹ç§°åŠ å¯†æŠ€æœ¯ ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œè€Œ å…¬é’¥åŠ å¯†æŠ€æœ¯ ä¸­åœ°åŠ å¯†å¯†é’¥å’Œè§£å¯†å¯†é’¥æ˜¯ä¸åŒçš„ã€‚\nè®¤è¯ æ¯ä¸€ä¸ªå®‰å…¨çš„è®¡ç®—æœºç³»ç»Ÿä¸€å®šä¼šè¦æ±‚æ‰€æœ‰çš„ç”¨æˆ·åœ¨ç™»å½•çš„æ—¶å€™è¿›è¡Œèº«ä»½è®¤è¯ã€‚æœ€ç®€å•çš„è®¤è¯æ–¹å¼å°±æ˜¯é€šè¿‡å¯†ç è®¤è¯ï¼Œæ­¤å¤–è¿˜æœ‰åƒæ™ºèƒ½å¡è¿™æ ·çš„ç‰©ç†è®¤è¯ä»¥åŠåƒæŒ‡çº¹å’Œè™¹è†œè¿™æ ·çš„ç”Ÿç‰©è¯†åˆ«è®¤è¯ã€‚\nè½¯ä»¶æ¼æ´ å…¥ä¾µç”¨æˆ·è®¡ç®—æœºçš„ä¸»è¦æ–¹æ³•ä¹‹ä¸€å°±æ˜¯åˆ©ç”¨ç³»ç»Ÿä¸­è¿è¡Œçš„è½¯ä»¶çš„æ¼æ´ï¼Œä½¿å…¶åšä¸€äº›è¿èƒŒå¼€å‘è€…æœ¬æ„çš„äº‹æƒ…ã€‚ç¼“å†²åŒºæº¢å‡ºæ”»å‡»æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„åˆ©ç”¨è½¯ä»¶æ¼æ´å‘èµ·æ”»å‡»çš„æ–¹å¼ã€‚\næ¶æ„è½¯ä»¶ æ¶æ„è½¯ä»¶(malware) æ˜¯ä¸€ä¸ªç»Ÿç§°ï¼ŒåŒ…æ‹¬æœ¨é©¬ã€ç—…æ¯’ã€è •è™«ä¸€èµ·å…¶å®ƒèƒ½å¤Ÿäº§ç”Ÿæ¶æ„è¡Œä¸ºçš„è½¯ä»¶ã€‚\nç‰¹æ´›ä¼Šæœ¨é©¬ å¾ˆå¤šæ”»å‡»è€…ä¼šç¼–å†™ä¸€äº›æœ‰ç”¨çš„ç¨‹åºï¼Œå¹¶å°†æ¶æ„ä»£ç åµŒå…¥å…¶ä¸­ï¼Œç„¶åæä¾›å…è´¹ä¸‹è½½ã€‚å½“äººä»¬ä¸‹è½½å¹¶å®‰è£…è¿™äº›ç¨‹åºä¹‹åï¼Œæ¶æ„ä»£ç ä¹Ÿå°±å­˜åœ¨äºç”¨æˆ·çš„è®¡ç®—æœºä¸Šäº†ï¼Œè¿™ç§æ”»å‡»æ–¹å¼å«åšæœ¨é©¬æ”»å‡»(Torjan horse attack)ã€‚\nç—…æ¯’ ç—…æ¯’(virus) æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç¨‹åºï¼Œå®ƒå¯ä»¥é€šè¿‡å°†è‡ªå·±æ¤å…¥å…¶å®ƒåº”ç”¨ç¨‹åºä¸­æ¥è¿›è¡Œâ€œç¹æ®–â€ï¼Œå°±åƒç”Ÿç‰©ç•Œä¸­çœŸæ­£çš„ç—…æ¯’ä¸€æ ·ã€‚å¸¸è§çš„ç—…æ¯’æœ‰ä¸ƒç§ï¼š\n å…±äº‹è€…ç—…æ¯’(companion virus)å¹¶ä¸çœŸæ­£æ„ŸæŸ“ç¨‹åºï¼Œä½†å½“ç¨‹åºæ‰§è¡Œæ—¶å®ƒä¹Ÿæ‰§è¡Œã€‚ å¯æ‰§è¡Œç¨‹åºç—…æ¯’(executable program virus)ä¼šæ„ŸæŸ“å¯æ‰§è¡Œç¨‹åºã€‚å…¶ä¸­æœ€ç®€å•çš„ä¸€ç§å«åšè¦†ç›–ç—…æ¯’(overwriting virus)ï¼Œè¿˜æœ‰å¯„ç”Ÿç—…æ¯’(parasitic virus)ä»¥åŠç©ºè…”ç—…æ¯’(cavity virus)ã€‚ å†…å­˜é©»ç•™ç—…æ¯’(memory-resident virus)æ€»æ˜¯é©»ç•™åœ¨å†…å­˜ä¸­ã€‚ å¼•å¯¼æ‰‡åŒºç—…æ¯’(boot sector virus)å¯ä»¥è¦†ç›–ä¸»å¼•å¯¼è®°å½•æˆ–è€…å¼•å¯¼æ‰‡åŒºï¼Œå¹¶èƒ½é€ æˆç¾éš¾æ€§çš„åæœã€‚ è®¾å¤‡é©±åŠ¨ç—…æ¯’(device driver virus)ä¼šæ„ŸæŸ“è®¾å¤‡é©±åŠ¨ç¨‹åºã€‚ å®ç—…æ¯’(macro virus)åˆ©ç”¨å®æ–‡ä»¶æ‰§è¡Œæ¶æ„æ“ä½œã€‚ æºä»£ç ç—…æ¯’(source code virus)çš„ç§»æ¤æ€§æœ€å¼ºï¼Œå½“ç¨‹åºè¿è¡Œæ—¶ï¼Œç—…æ¯’ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚  è •è™« è •è™«(worm) æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè‡ªæˆ‘å¤åˆ¶çš„ç¨‹åºï¼Œèƒ½å¤Ÿåœ¨è¿…é€Ÿå®Œæˆè‡ªæˆ‘å¤åˆ¶ï¼Œç„¶åè¿…é€Ÿä¼ æŸ“åˆ°æ‰€æœ‰çš„æœºå™¨ã€‚\n","href":"/notebook/reading_notes/modern_operating_systems/security/","title":"Security"},{"content":"","href":"/tags/%E7%8E%B0%E4%BB%A3%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/","title":"ç°ä»£æ“ä½œç³»ç»Ÿ"},{"content":"","href":"/tags/os/","title":"OS"},{"content":"ä»è®¡ç®—æœºè¯ç”Ÿä¹‹æ—¥èµ·ï¼Œäººä»¬å°±æ— ä¼‘æ­¢åœ°è¿½æ±‚ç€æ›´å¼ºå¤§åœ°è®¡ç®—èƒ½åŠ›ã€‚è¿‡å»åœ°è§£å†³æ–¹æ¡ˆæ˜¯ä½¿æ—¶é’Ÿèµ°å¾—æ›´å¿«ï¼Œä½†æ˜¯ç°åœ¨æ—¶é’Ÿé€Ÿåº¦å·²ç»å¾ˆéš¾å†è¿›ä¸€æ­¥æå‡äº†ã€‚è®¡ç®—æœºè™½ç„¶å¯ä»¥å˜å¾—å¾ˆå°ï¼Œä½†æ˜¯ä¼šé‡åˆ°æ•£çƒ­é—®é¢˜ï¼šè®¡ç®—æœºè¿è¡Œå¾—è¶Šå¿«ï¼Œäº§ç”Ÿçš„çƒ­é‡å°±è¶Šå¤šï¼Œè€Œè®¡ç®—æœºè¶Šå°æ•£çƒ­è¶Šéš¾ã€‚æ€»è€Œè¨€ä¹‹ï¼Œå¯¹äºè®¡ç®—æœºçš„æ—¶é’Ÿæ¥è¯´ï¼šä»1MHzåˆ°1GHzéœ€è¦çš„æ˜¯æ›´å¥½çš„èŠ¯ç‰‡åˆ¶é€ å·¥è‰ºï¼Œè€Œä»1GHzåˆ°1THzéœ€è¦çš„æ˜¯å®Œå…¨ä¸åŒçš„æ–¹æ³•ã€‚\nè·å¾—æ›´å¼ºè®¡ç®—èƒ½åŠ›çš„å¦ä¸€ç§æ–¹æ³•æ˜¯å¤§é‡ä½¿ç”¨å¹¶è¡Œè®¡ç®—æœºã€‚è¿™äº›æœºå™¨éƒ½æ‹¥æœ‰å¾ˆå¤šCPUï¼Œè™½ç„¶æ¯ä¸ªCPUçš„é€Ÿåº¦éƒ½å’Œæ™®é€šçš„CPUä¸€æ ·ï¼Œä½†æ˜¯å®ƒä»¬æ€»ä½“çš„è®¡ç®—èƒ½åŠ›æ¯”å•ä¸ªCPUè¦å¼ºå¤§å¾—å¤šã€‚\nç”µå­éƒ¨ä»¶ä¹‹é—´çš„æ‰€æœ‰é€šä¿¡çš„æœ¬è´¨å°±æ˜¯å®ƒä»¬ä¹‹é—´å‘é€å…·æœ‰è‰¯å¥½ç»“æ„å®šä¹‰çš„ä½ä¸²ï¼Œå…¶å·®åˆ«åœ¨äºæ‰€æ¶‰åŠçš„æ—¶é—´èŒƒå›´ã€è·ç¦»èŒƒå›´å’Œé€»è¾‘ç»„ç»‡ã€‚ä¸Šå›¾å±•ç¤ºäº†ä¸‰ç§ä¸åŒçš„å¹¶è¡Œè®¡ç®—æœºç³»ç»Ÿæ¨¡å‹ï¼š\n (a)å›¾å±•ç¤ºäº†ä¸€ä¸ªæç«¯çš„ä¾‹å­ï¼Œç³»ç»Ÿä¸­çš„æ‰€æœ‰CPUé€šè¿‡å…±äº«å†…å­˜é€šä¿¡ï¼Œæ¯ä¸ªCPUéƒ½å¯ä»¥è¯»å†™æ•´ä¸ªç‰©ç†å­˜å‚¨å™¨ï¼Œè®¿é—®ä¸€ä¸ªå†…å­˜å­—é€šå¸¸éœ€è¦1~10nsã€‚ åœ¨(b)å›¾æ‰€ç¤ºçš„ç³»ç»Ÿä¸­ï¼Œè®¸å¤šCPU-å†…å­˜é€šè¿‡é«˜é€Ÿäº’è”ç½‘ç»œè¿æ¥åœ¨ä¸€èµ·ï¼Œè¿™ç§ç³»ç»Ÿè¢«ç§°ä¸ºæ¶ˆæ¯ä¼ é€’å‹è®¡ç®—æœºã€‚æ¯ä¸ªå†…å­˜éƒ½å±€éƒ¨å¯¹åº”ä¸€ä¸ªCPUï¼Œå¹¶ä¸”åªèƒ½è¢«è¯¥CPUè®¿é—®ã€‚è¿™äº›CPUé€šè¿‡äº’è”ç½‘ç»œå‘é€å¤šå­—ä¿¡æ¯é€šä¿¡ï¼Œä¸€æ¡çŸ­æ¶ˆæ¯é€šå¸¸å¯åœ¨10~50Î¼så†…å‘å‡ºï¼Œä½†æ˜¯å†…å­˜è®¿é—®æ—¶é—´ä»ç„¶æ¯”(a)ä¸­ç³»ç»Ÿè¦é•¿ã€‚ (c)ä¸­æ‰€æœ‰çš„è®¡ç®—æœºç³»ç»Ÿéƒ½é€šè¿‡ä¸€ä¸ªå¹¿åŸŸç½‘è¿æ¥ï¼Œå½¢æˆä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿã€‚æ¯å°è®¡ç®—æœºéƒ½æœ‰è‡ªå·±çš„å†…å­˜ï¼Œè®¡ç®—æœºä¹‹é—´é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ï¼Œæ¶ˆæ¯ä¼ é€’çš„æ—¶é—´é€šå¸¸ä¸º10~100msã€‚å¦‚æ­¤é•¿çš„å»¶è¿Ÿä¼šé€ æˆä½¿ç”¨è¿™ç±»æ¾è€¦åˆç³»ç»Ÿçš„æ–¹å¼å’Œ(b)ä¸­çš„ç´§è€¦åˆæ–¹å¼ä¸åŒã€‚  ä¸‰ç§ç±»å‹çš„ç³»ç»Ÿåœ¨é€šä¿¡å»¶è¿Ÿä¸Šå„ä¸ç›¸åŒï¼Œåˆ†åˆ«æœ‰ä¸‰ä¸ªæ•°é‡çº§çš„å·®åˆ«ã€‚\nå¤šå¤„ç†æœº(MULTIPROCESSORS) **å…±äº«å†…å­˜å¤šå¤„ç†æœº(shared-memory multiprocessor)**æ˜¯ä¸€ç§å¤šä¸ªCPUä»¥å®Œå…¨å…±äº«åœ°æ–¹å¼è®¿é—®åŒä¸€ä¸ªå…¬ç”¨RAMçš„è®¡ç®—æœºç³»ç»Ÿã€‚è¿è¡Œåœ¨ä»»ä½•ä¸€ä¸ªCPUä¸Šçš„ç¨‹åºéƒ½èƒ½çœ‹åˆ°ä¸€ä¸ªæ™®é€šçš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚\nå¤šå¤„ç†æœºç¡¬ä»¶ æ‰€æœ‰çš„å¤šå¤„ç†æœºä¸­çš„æ¯ä¸ªCPUéƒ½å¯ä»¥è®¿é—®å…¨éƒ¨çš„å…±äº«å†…å­˜ã€‚è‹¥æœºå™¨ä¸Šè¯»å–æ¯ä¸ªå†…å­˜å­—(memory word)çš„é€Ÿåº¦éƒ½æ˜¯ä¸€æ ·å¿«çš„ï¼Œåˆ™ç§°è¿™ç§æœºå™¨ä¸ºUMA(Uniform Memory Access)ï¼Œå¦åˆ™ç§°è¿™ç§æœºå™¨ä¸ºNUMA(Nonuniform Memory Access)ã€‚\nUMA åŸºäºæ€»çº¿çš„UMA ä¸‹å›¾å±•ç¤ºäº†ä¸‰ç§åŸºäºæ€»çº¿çš„UMA:\næœ€ç®€å•çš„å¤šå¤„ç†æœºæ˜¯åŸºäºå•æ€»çº¿çš„(å›¾(a))ã€‚å¤šä¸ªCPUä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ªå†…å­˜æ¨¡å—é€šè¿‡å…¬ç”¨çš„æ€»çº¿è¿›è¡Œé€šä¿¡ã€‚å½“ä¸€ä¸ªCPUéœ€è¦è¯»å–ä¸€ä¸ªå†…å­˜å­—æ—¶ï¼Œå®ƒä¼šå…ˆæ£€æŸ¥æ€»çº¿æ˜¯å¦ç©ºé—²ã€‚å¦‚æœæ€»çº¿å¿™ï¼Œå®ƒå°±ç­‰å¾…ç›´åˆ°æ€»çº¿ç©ºé—²ã€‚å½“æ€»çº¿ç©ºé—²æ—¶ï¼ŒCPUæŠŠæ‰€éœ€å­—çš„åœ°å€æ”¾åˆ°æ€»çº¿ä¸Šï¼Œå‘å‡ºæ§åˆ¶ä¿¡å·ï¼Œç„¶åç­‰å¾…å†…å­˜å°†å®ƒæ‰€éœ€çš„å­—æ”¾åˆ°æ€»çº¿ä¸Šã€‚è¿™ç§è®¾è®¡å­˜åœ¨é—®é¢˜ï¼Œå½“CPUæ•°é‡ä¸å¤šæ—¶ï¼Œæ€»çº¿çš„ä½¿ç”¨æƒæ˜¯å¾ˆå¥½ç®¡ç†çš„ï¼Œä¸€æ—¦CPUæ•°é‡è¿‡å¤šï¼Œæ€»çº¿çš„ç®¡ç†å°±å˜å¾—å¼‚å¸¸å¤æ‚ã€‚æ­¤å¤–ï¼Œæ€»çº¿æˆä¸ºäº†ç³»ç»Ÿçš„ç“¶é¢ˆï¼Œå¤šæ•°CPUåœ¨å¤§éƒ¨åˆ†æ—¶é—´å†…æ˜¯ç©ºé—²çš„ã€‚\nä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªCPUæ·»åŠ ä¸€ä¸ªé«˜é€Ÿç¼“å­˜(å›¾(b))ã€‚CPUå¯ä»¥ç›´æ¥ä»é«˜é€Ÿç¼“å­˜ä¸­è¯»å–æ•°æ®ï¼Œæ€»çº¿æµé‡å¤§å¤§å‡å°‘ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œé«˜é€Ÿç¼“å­˜çš„è¯»å–å•ä½ä¸å†æ˜¯å•ä¸ªå­—ï¼Œè€Œæ˜¯ä¸€ä¸ªé«˜é€Ÿç¼“å­˜è¡Œ(cache line)ã€‚ä¸ºäº†é˜²æ­¢æ•°æ®å‡ºç°ä¸ä¸€è‡´ç°è±¡ï¼Œéœ€è¦æ‰§è¡Œç¼“å­˜ä¸€è‡´æ€§åè®®ã€‚\nå›¾(c)ä¸­çš„æ¯ä¸ªCPUä¸ä»…æœ‰ä¸€ä¸ªé«˜é€Ÿç¼“å­˜ï¼Œè¿˜æœ‰ä¸€ä¸ªç§æœ‰å†…å­˜ã€‚CPUé€šè¿‡ä¸“é—¨çš„ç§æœ‰æ€»çº¿è®¿é—®è¿™ä¸ªç§æœ‰å†…å­˜ã€‚ä¸ºäº†åˆ©ç”¨è¿™ä¸€é…ç½®ï¼Œç¼–è¯‘å™¨åº”è¯¥æŠŠæ‰€æœ‰ç¨‹åºçš„ä»£ç ã€å­—ç¬¦ä¸²ã€å¸¸é‡ä»¥åŠå…¶å®ƒåªè¯»æ•°æ®æ”¾å…¥ç§æœ‰å†…å­˜ï¼Œè€Œå°†ç¨‹åºçš„å…±äº«å˜é‡æ”¾å…¥å…±äº«å†…å­˜ã€‚åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ç§é…ç½®å¯ä»¥æå¤§çš„å‡å°‘æ€»çº¿æµé‡ï¼Œä½†æ˜¯è¿™éœ€è¦ç¼–è¯‘å™¨çš„ç§¯æé…åˆã€‚\nå…¶å®ƒUMA é™¤äº†åŸºäºæ€»çº¿çš„UMAï¼Œè¿˜æœ‰åŸºäºäº¤å‰å¼€å…³å’Œå¤šçº§äº¤æ¢ç½‘ç»œçš„UMAã€‚\nè¿æ¥nä¸ªCPUå’Œkä¸ªå†…å­˜çš„æœ€ç®€å•çš„ç”µè·¯å°±æ˜¯äº¤å‰å¼€å…³(crossbar switch)ã€‚å°†nä¸ªCPUå’Œkä¸ªå†…å­˜æ’åˆ—æˆä¸€ä¸ªnÃ—kçš„çŸ©é˜µï¼ŒçŸ©é˜µä¸­çš„æ¯ä¸ªä½ç½®éƒ½æ˜¯ä¸€ä¸ªäº¤å‰ç‚¹(crosspoint)ã€‚äº¤å‰ç‚¹æ˜¯ä¸€ä¸ªå°çš„ç”µå­å¼€å…³ï¼Œå…¶å¼€å…³çŠ¶æ€å–å†³äºå¯¹åº”çš„CPUå’Œå†…å­˜æ˜¯å¦éœ€è¦è¿æ¥ã€‚äº¤å‰å¼€å…³æ˜¯ä¸€ä¸ªéé˜»å¡ç½‘ç»œï¼Œå³ä¸ä¼šå› ä¸ºæœ‰äº›äº¤å‰ç‚¹è¢«å æ®è€Œæ‹’ç»è¿æ¥ã€‚å½“ä¸¤ä¸ªCPUåŒæ—¶è®¿é—®åŒä¸€ä¸ªå†…å­˜æ—¶ï¼Œè¿˜æ˜¯å¯èƒ½å‡ºç°ç«äº‰çš„ã€‚ä¸è¿‡é€šè¿‡å°†å†…å­˜åˆ†ä¸ºkä¸ªå•å…ƒï¼Œç«äº‰çš„æ¦‚ç‡é™ä½åˆ°äº†1/kã€‚äº¤å‰å¼€å…³çš„ç¼ºç‚¹æ˜¯ï¼šäº¤å‰ç‚¹çš„æ•°é‡ä¼šä»¥nÃ—kçš„æ–¹å¼å¢é•¿ï¼Œå¯¹äºå¤§è§„æ¨¡çš„ç³»ç»Ÿå¹¶ä¸é€‚ç”¨ã€‚\n**å¤šçº§äº¤æ¢ç½‘ç»œ(multistage switching networks)**æ˜¯å¦å¤–ä¸€ç§å®Œå…¨ä¸åŒçš„è®¾è®¡ï¼Œç”±2Ã—2çš„äº¤å‰å¼€å…³æ„å»ºã€‚å¯¹äºä¸€ä¸ª2Ã—2çš„å¼€å…³(ä¸¤è¾“å…¥å’Œä¸¤è¾“å‡º)ï¼Œåˆ°è¾¾ä»»æ„ä¸€ä¸ªè¾“å…¥çš„æ¶ˆæ¯å¯ä»¥è¢«äº¤æ¢åˆ°ä»»æ„ä¸€ä¸ªè¾“å‡ºä¸Šã€‚omegaç½‘ç»œå°±æ˜¯å…¸å‹çš„å¤šçº§äº¤æ¢ç½‘ç»œã€‚\nNUMA å•æ€»çº¿çš„UMAå¤šå¤„ç†æœºé€šå¸¸åªé™äºæ‹¥æœ‰æ•°åä¸ªCPUçš„ç³»ç»Ÿï¼Œäº¤å‰å¼€å…³å’Œå¤šçº§äº¤æ¢ç½‘ç»œéœ€è¦å¤§é‡(æ˜‚è´µ)çš„ç¡¬ä»¶ï¼Œå¹¶ä¸”ä¹Ÿä¸èƒ½å¤ªå¤§ã€‚ä¸ºäº†æ”¯æŒ100ä¸ªåŠæ›´å¤šçš„CPUï¼Œå¿…é¡»åšä¸€äº›æ”¹å˜ï¼Œè¿™å°±å¯¼è‡´äº†NUMAçš„å‡ºç°ã€‚NUMAå’ŒUMAä¸€æ ·ï¼Œéƒ½ä¸ºæ‰€æœ‰çš„CPUæä¾›äº†è›‹ä¾çš„åœ°å€ç©ºé—´ï¼Œä½†æ˜¯åœ¨NUMAä¸­ï¼Œå¯¹å±€éƒ¨å†…å­˜æ¨¡å—çš„è®¿é—®è¦æ¯”è¿œç«¯å†…å­˜æ¨¡å—çš„è®¿é—®è¦å¿«ã€‚è™½ç„¶ä¸ºUMAç¼–å†™çš„ç¨‹åºå¯ä»¥ä¸ç»ä¿®æ”¹å°±åœ¨NUMAæœºå™¨ä¸Šè¿è¡Œï¼Œä½†æ˜¯å…¶æ•ˆç‡ä¼šæ¯”åœ¨UMAä¸Šå·®ã€‚\næ‰€æœ‰çš„NUMAæœºå™¨éƒ½å…·å¤‡ä¸€ä¸‹ä¸‰ç§å…³é”®ç‰¹æ€§ï¼Œä»–ä»¬ä¹Ÿæ˜¯NUMAä¸å…¶å®ƒå¤šå¤„ç†æœºçš„ä¸»è¦åŒºåˆ«ï¼š\n å…·æœ‰å¯¹æ‰€æœ‰CPUéƒ½å¯è§çš„å•ä¸ªåœ°å€ç©ºé—´ã€‚ é€šè¿‡LOADå’ŒSTOREæŒ‡ä»¤è®¿é—®è¿œç«¯å†…å­˜ã€‚ å¯¹è¿œç«¯å†…å­˜çš„è®¿é—®æ…¢äºå±€éƒ¨å†…å­˜ã€‚  è‹¥æœºå™¨å¿…é¡»è®¿é—®è¿œç«¯å†…å­˜(å› ä¸ºéœ€è¦çš„æ•°æ®æ²¡æœ‰è¢«ç¼“å­˜)ï¼Œç³»ç»Ÿè¢«ç§°ä¸ºNC-NUMA (Non Cache-coherent NUMA)ã€‚å½“cacheå¤„äºä¸€è‡´çŠ¶æ€æ—¶ï¼Œç³»ç»Ÿè¢«ç§°ä¸ºCC-NUMA (Cache-Coherent NUMA)ã€‚\nå¤šæ ¸èŠ¯ç‰‡ éšç€èŠ¯ç‰‡åˆ¶é€ æŠ€æœ¯çš„å‘å±•ï¼Œæ™¶ä½“ç®¡çš„ä½“ç§¯è¶Šæ¥è¶Šå°ï¼Œä»è€Œæœ‰å¯èƒ½å°†è¶Šæ¥è¶Šå¤šçš„æ™¶ä½“ç®¡æ”¾å…¥ä¸€ä¸ªèŠ¯ç‰‡ä¸­ã€‚éšåçš„é—®é¢˜æ˜¯ï¼šâ€œå¦‚ä½•åˆ©ç”¨è¿™äº›æ™¶ä½“ç®¡ï¼Ÿâ€ï¼Œå…¶ä¸­çš„ä¸€ä¸ªé€‰æ‹©æ—¶ç»™èŠ¯ç‰‡æ·»åŠ cacheã€‚å½“cacheçš„å¤§å°è¾¾åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œç»§ç»­å¢åŠ cacheçš„å¤§å°è™½ç„¶æœ‰å¯èƒ½æé«˜å‘½ä¸­ç‡ï¼Œå´ä¸èƒ½æ˜¾è‘—æå‡åº”ç”¨çš„æ€§èƒ½ã€‚å¦ä¸€ä¸ªé€‰æ‹©æ˜¯å°†ä¸¤ä¸ªæˆ–æ›´å¤šçš„CPU(é€šå¸¸ç§°ä¸ºæ ¸(core))æ”¾åˆ°åŒä¸€ä¸ªèŠ¯ç‰‡ä¸Šã€‚åœ¨å¤šæ ¸(multicore)èŠ¯ç‰‡ä¸­ï¼Œcacheä»ç„¶æ˜¯è‡³å…³é‡è¦çš„ï¼Œå¹¶ä¸”éå¸ƒæ•´ä¸ªèŠ¯ç‰‡ã€‚å¤šæ ¸èŠ¯ç‰‡é€šå¸¸è¢«ç§°ä¸ºç‰‡çº§å¤šå¤„ç†æœº(Chip-level MultiProcessors, CMP)ã€‚\nä¼—æ ¸èŠ¯ç‰‡ â€œå¤šæ ¸â€åªæ˜¯ç®€å•çš„è¡¨ç¤ºæ ¸çš„æ•°é‡å¤šäºä¸€ä¸ªï¼Œä½†æ˜¯å½“æ ¸çš„æ•°é‡æŒç»­å¢åŠ æ—¶ï¼Œå®ƒä»¬å°±å°±æœ‰äº†å¦ä¸€ä¸ªåç§°â€”â€”ä¼—æ ¸ã€‚**ä¼—æ ¸(manycore)**èŠ¯ç‰‡æ˜¯æŒ‡åŒ…æ‹¬å‡ åã€å‡ ç™¾ç”šè‡³æˆåƒä¸Šä¸‡ä¸ªæ ¸å¿ƒçš„å¤šæ ¸å¤„ç†å™¨ã€‚\nè¶…å¤§é‡æ ¸å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼šç”¨æ¥ä¿æŒç¼“å­˜ä¸€è‡´æ€§çš„æœºåˆ¶ä¼šå˜å¾—å¼‚å¸¸çš„å¤æ‚ã€‚å¾ˆå¤šå·¥ç¨‹å¸ˆæ‹…å¿ƒç¡¬ä»¶ä¸Šä¿æŒç¼“å­˜ä¸€è‡´æ€§çš„å¼€é”€ä¼šéå¸¸é«˜ï¼Œä»¥è‡³äºè¿™äº›æ–°å¢çš„æ ¸å¹¶ä¸èƒ½å¸¦æ¥å¤šå¤§çš„æ€§èƒ½æå‡ï¼Œå› ä¸ºå¤„ç†å™¨ä¸€ç›´å¿™äºç»´æŠ¤ç¼“å­˜çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚æ›´åŠ ç³Ÿç³•çš„æ˜¯ï¼Œä¿æŒç¼“å­˜ç›®å½•çš„ä¸€è‡´æ€§è¿˜å°†æ¶ˆè€—å¤§é‡çš„å†…å­˜ï¼Œè¿™å°±æ˜¯è‘—åçš„ä¸€è‡´æ€§å ¡å’(coherency wall)ã€‚\nGPUæ˜¯ç›®å‰æœ€å¸¸è§çš„ä¼—æ ¸å¤„ç†å™¨ï¼Œå®ƒæ‹¥æœ‰ä¸“ç”¨çš„å†…å­˜å’Œæˆåƒä¸Šä¸‡ä¸ªå¾®å°çš„æ ¸ã€‚\nå¤šå¤„ç†æœºæ“ä½œç³»ç»Ÿ æ¯ä¸ªCPUéƒ½æœ‰è‡ªå·±çš„æ“ä½œç³»ç»Ÿ ç»„ç»‡ä¸€ä¸ªå¤šå¤„ç†æœºæ“ä½œç³»ç»Ÿçš„æœ€ç®€å•åŠæ³•å¯èƒ½å°±æ˜¯ï¼šé™æ€çš„å°†å†…å­˜åˆ’åˆ†ä¸ºå’ŒCPUä¸€æ ·å¤šçš„éƒ¨åˆ†ï¼Œä¸ºæ¯ä¸ªCPUæä¾›ç§æœ‰å†…å­˜åŠç§æœ‰æ“ä½œç³»ç»Ÿå‰¯æœ¬ï¼Œä»¥nå„CPUnå„ç‹¬ç«‹è®¡ç®—æœºçš„å½¢å¼è¿è¡Œã€‚è¿™æ ·çš„ä¼˜ç‚¹æ˜¯ï¼šå…è®¸æ‰€æœ‰çš„CPUå…±äº«æ“ä½œç³»ç»Ÿçš„ä»£ç ï¼Œè€Œä¸”åªéœ€è¦æä¾›æ•°æ®çš„ç§æœ‰å‰¯æœ¬ã€‚\nè¿™ä¸€æœºåˆ¶æ¯”æœ‰nä¸ªåˆ†ç¦»çš„è®¡ç®—æœºè¦å¥½ï¼Œå› ä¸ºå®ƒå…è®¸æ‰€æœ‰çš„æœºå™¨å…±äº«åŒä¸€å¥—ç£ç›˜ã€å†…å­˜å’Œå…¶å®ƒI/Oè®¾å¤‡ã€‚ä½†è¿™ä¸€è®¾è®¡å­˜åœ¨ä¸å°‘æ½œåœ¨çš„é—®é¢˜ï¼šå› ä¸ºè¿›ç¨‹ä¸æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥å¯èƒ½å‡ºç°ä¸€ä¸ªCPUè¿‡è½½è€Œå…¶å®ƒCPUç©ºè½½ï¼›å› ä¸ºç‰©ç†é¡µä¹Ÿä¸æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥å¯èƒ½ä¸€ä¸ªCPUä¸æ–­åœ°è¿›è¡Œé¡µè°ƒåº¦è€Œå¦ä¸€ä¸ªCPUæœ‰å¤šä½™çš„é¡µï¼›ç”±äºæ“ä½œç³»ç»Ÿç‹¬ç«‹çš„ç»´æŠ¤è¿‘æœŸä½¿ç”¨è¿‡çš„ç£ç›˜å—çš„cacheï¼Œå¯èƒ½å‡ºç°æŸä¸€ä¿®æ”¹è¿‡çš„ç£ç›˜å—åŒæ—¶å‡ºç°åœ¨å¤šä¸ªcacheä¸­ï¼Œè¿™å›å¯¼è‡´ä¸ä¸€è‡´çš„ç»“æœã€‚é¿å…è¿™ä¸€é—®é¢˜çš„å”¯ä¸€é€”å¾„æ˜¯å–æ¶ˆcacheï¼Œä½†è¿™æ ·ä¼šæ˜¾è‘—é™ä½æ€§èƒ½ã€‚\nä¸»ä»å¤šå¤„ç†æœº ä¸‹é¢å±•ç¤ºçš„æ¨¡å‹æ˜¯ä¸»ä»æ¨¡å‹(master-slave)ï¼ŒCPU1ä¸ºä¸»CPUï¼Œå…¶å®ƒä¸ºä»CPUï¼š\nåœ¨è¿™ç§æ¨¡å‹ä¸‹ï¼Œæ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªå‰¯æœ¬åŠå…¶æ•°æ®éƒ½éƒ½åœ¨CPU1ä¸Šï¼Œç”¨æˆ·è¿›ç¨‹è¿è¡Œåœ¨å…¶å®ƒCPUä¸Šã€‚éšåæ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨éƒ½è¢«é‡å®šå‘åˆ°CPU1ä¸Šï¼Œå¦‚æœCPU1ä¸Šæœ‰å‰©ä½™çš„æ—¶é—´ç‰‡ï¼Œè¿˜å¯ä»¥è¿è¡Œç”¨æˆ·è¿›ç¨‹ã€‚\nä¸»ä»æ¨¡å‹è§£å†³äº†åˆ†åŒºæ¨¡å‹ä¸­çš„å¤šæ•°é—®é¢˜ï¼Œä½†æ˜¯ä¸»CPUæˆä¸ºäº†ç³»ç»Ÿçš„ç“¶é¢ˆï¼Œå› ä¸ºå®ƒè¦å¤„ç†æ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨ã€‚è¿™ç§æ¨¡å‹å¯¹å°å‹å¤šå¤„ç†æœºæ˜¯å¯è¡Œçš„ï¼Œä½†ä¸é€‚ç”¨äºå¤§å‹å¤šå¤„ç†æœºã€‚\nå¯¹ç§°å¤šå¤„ç†æœº å¯¹ç§°å¤šå¤„ç†æœº(Symmetric MultiProcessor, SMP) æ¶ˆé™¤äº†ä¸Šè¿°çš„ä¸å¯¹ç§°æ€§ï¼Œåœ¨å†…å­˜ä¸­æœ‰æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªå‰¯æœ¬ï¼Œä½†ä»»ä½•CPUéƒ½å¯ä»¥è¿è¡Œå®ƒã€‚å½“æœ‰ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œè¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„CPUé™·å…¥å†…æ ¸å¹¶è¿›è¡Œå¤„ç†ã€‚\nè¿™ä¸ªæ¨¡å‹åŠ¨æ€åœ°å¹³è¡¡è¿›ç¨‹å’Œå†…å­˜ï¼Œå› ä¸ºå®ƒåªæœ‰ä¸€å¥—æ“ä½œç³»ç»Ÿæ•°æ®è¡¨ã€‚å®ƒè¿˜æ¶ˆé™¤äº†ä¸»CPUå¸¦æ¥çš„ç“¶é¢ˆé—®é¢˜ã€‚å› ä¸ºæ²¡æœ‰ä¸»CPUï¼Œæ‰€ä»¥éœ€è¦è§£å†³å¤šä¸ªCPUå¯èƒ½åŒæ—¶è¿è¡Œæ“ä½œç³»ç»Ÿä»£ç çš„é—®é¢˜ã€‚æœ€ç®€å•çš„åŠæ³•å°±æ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨äº’æ–¥ä¿¡å·é‡ï¼Œå¦‚æœäº’æ–¥ä¿¡å·é‡è¢«é”ä½ï¼Œå°±ç­‰å¾…ã€‚æŒ‰ç…§è¿™ç§æ–¹å¼ï¼Œä»»ä½•CPUéƒ½å¯ä»¥è¿è¡Œæ“ä½œç³»ç»Ÿï¼Œä½†åœ¨ä»»ä¸€æ—¶åˆ»åªæœ‰é‚£ä¸ªè·å¾—é”çš„CPUå¯ä»¥è¿è¡Œæ“ä½œç³»ç»Ÿï¼Œè¿™ä¸€æ–¹æ³•è¢«ç§°ä¸ºå¤§å†…æ ¸é”(Big Kernel Lock, BLK)ã€‚\nå¤šå¤„ç†æœºè°ƒåº¦ äº²å’Œè°ƒåº¦(affinity scheduling)ï¼šå°½é‡ä½¿ä¸€ä¸ªçº¿ç¨‹åœ¨å®ƒå‰ä¸€æ¬¡è¿è¡Œè¿‡çš„åŒä¸€ä¸ªCPUä¸Šè¿è¡Œã€‚\nç¾¤è°ƒåº¦(Gang scheduling)ï¼šæŠŠä¸€ç»„ç›¸å…³çš„çº¿ç¨‹ä½œä¸ºä¸€ä¸ªå•ä½(ç¾¤, gang)ä¸€èµ·è°ƒåº¦ï¼Œä½¿ä¸€ä¸ªç¾¤å†…çš„æ‰€æœ‰çº¿ç¨‹åœ¨ä¸åŒçš„CPUä¸ŠåŒæ—¶è¿è¡Œï¼Œå¹¶ä¸”ç¾¤ä¸­çš„æ‰€æœ‰çº¿ç¨‹å…±åŒå¼€å§‹å’Œç»“æŸå…¶æ—¶é—´ç‰‡ã€‚\nå¤šè®¡ç®—æœº å¤šå¤„ç†æœºæä¾›äº†ä¸€ä¸ªç®€å•çš„é€šä¿¡æ¨¡å‹ï¼šæ‰€æœ‰çš„CPUå…±äº«ä¸€ä¸ªå…±ç”¨å†…å­˜ã€‚è¿›ç¨‹å¯ä»¥å‘å†…å­˜å†™æ¶ˆæ¯ï¼Œç„¶åæ¶ˆæ¯å¯ä»¥è¢«å…¶å®ƒè¿›ç¨‹è¯»å–ï¼Œå¯ä»¥ä½¿ç”¨äº’æ–¥é”ã€ä¿¡å·é‡ã€ç®¡ç¨‹å’Œå…¶å®ƒåˆé€‚çš„æŠ€æœ¯è¿›è¡ŒåŒæ­¥ã€‚å”¯ä¸€ç¾ä¸­ä¸è¶³çš„æ˜¯ï¼šå¤§å‹å¤šå¤„ç†æœºæ„é€ å›°éš¾ï¼Œé€ ä»·é«˜æ˜‚ã€‚\nä¸ºäº†è§£å†³CPUæ•°é‡ä¸æ–­å¢åŠ çš„é—®é¢˜ï¼Œäººä»¬åœ¨ å¤šè®¡ç®—æœº(multicomputers) é¢†åŸŸè¿›è¡Œäº†å¾ˆå¤šç ”ç©¶ã€‚å¤šè®¡ç®—æœºçš„CPUç´§è€¦åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”ä¸å…±äº«å†…å­˜ï¼Œæ¯ä¸ªCPUéƒ½æœ‰è‡ªå·±çš„ç§æœ‰å†…å­˜ï¼ŒCPUä¹‹é—´é€šè¿‡äº’è”ç½‘ç»œè¿æ¥ã€‚è¿™äº›ç³»ç»Ÿæ‹¥æœ‰å„ç§å…¶å®ƒçš„åç§°ï¼Œå¦‚æœºç¾¤è®¡ç®—æœº(cluster computers)ã€å·¥ä½œç«™æœºç¾¤(Clusters of Workstations, COWS)ã€‚\nå¤šè®¡ç®—æœºå¾ˆå®¹æ˜“æ„é€ ï¼Œå› ä¸ºå…¶åŸºæœ¬éƒ¨ä»¶åªæ˜¯ä¸€å°é…æœ‰é«˜æ€§èƒ½ç½‘å¡çš„PCè£¸æœºï¼Œä¸éœ€è¦é”®ç›˜ã€é¼ æ ‡æˆ–æ˜¾ç¤ºå™¨ã€‚\nå¤šè®¡ç®—æœºç¡¬ä»¶ ä¸€ä¸ªå¤šè®¡ç®—æœºç³»ç»Ÿçš„åŸºæœ¬èŠ‚ç‚¹åŒ…æ‹¬ä¸€ä¸ªCPUã€å†…å­˜ã€ä¸€ä¸ªç½‘å¡ã€æœ‰æ—¶è¿˜æœ‰ä¸€å—ç¡¬ç›˜ã€‚\näº’è¿æŠ€æœ¯ æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€å—ç½‘å¡ï¼Œé€šè¿‡ç”µç¼†æˆ–å…‰çº¤è¿æ¥åˆ°å…¶å®ƒçš„èŠ‚ç‚¹æˆ–è€…äº¤æ¢æœºä¸Šã€‚å¸¸è§çš„äº’è¿æ‹“æ‰‘ç»“æ„æœ‰ï¼šæ˜Ÿå‹ã€ç¯å‹ã€ç½‘æ ¼ã€åŒå‡¸é¢ã€ç«‹æ–¹ä½“å’Œå››ç»´è¶…ç«‹æ–¹ä½“ç­‰ã€‚\nåœ¨å¤šè®¡ç®—æœºä¸­å¯é‡‡ç”¨ä¸¤ç§äº¤æ¢æœºåˆ¶ï¼šå­˜å‚¨è½¬å‘åŒ…äº¤æ¢å’Œç”µè·¯äº¤æ¢ã€‚\nç½‘ç»œæ¥å£ åœ¨å¤šè®¡ç®—æœºä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€å—ç½‘å¡ï¼Œç½‘å¡ä¸Šä¸€èˆ¬ä¼šæœ‰ä¸€å—ç”¨æ¥å­˜å‚¨è¿›å‡ºåŒ…çš„RAMã€‚é€šå¸¸ï¼Œåœ¨åŒ…è¢«ä¼ é€åˆ°ç¬¬ä¸€ä¸ªäº¤æ¢æœºä¹‹å‰ï¼Œè¿™ä¸ªåŒ…å¿…é¡»è¢«å¤åˆ¶åˆ°ç½‘å¡çš„RAMä¸­ã€‚è¿™ä¹ˆåšçš„åŸå› æ˜¯è®¸å¤šäº’è¿ç½‘ç»œæ˜¯åŒæ­¥çš„ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦ä¸€ä¸ªåŒ…å¼€å§‹ä¼ é€ï¼Œæ¯”ç‰¹ç‡å°±å¿…é¡»ä»¥æ’å®šçš„é€Ÿç‡æŒç»­è¿›è¡Œã€‚å¦‚æœåŒ…åœ¨ä¸»RAMä¸­ï¼Œç”±äºå†…å­˜æ€»çº¿ä¸Šå…¶å®ƒçš„ä¿¡æ¯æµçš„å­˜åœ¨ï¼Œæ‰€ä»¥ä¸èƒ½ä¿ç•™é€åˆ°ç½‘ç»œä¸Šçš„æµæ˜¯è¿ç»­çš„ï¼Œè€Œç½‘å¡ä¸Šä¸“ç”¨çš„RAMå°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚åŒæ ·çš„é—®é¢˜ä¹Ÿå‡ºç°åœ¨åŒ…çš„æ¥æ”¶è¿‡ç¨‹ä¸­ã€‚\nåº•å±‚é€šä¿¡è½¯ä»¶ åœ¨å¤šè®¡ç®—æœºä¸­åŒ…çš„è¿‡åº¦å¤åˆ¶æ˜¯é«˜æ€§èƒ½é€šä¿¡æœ€å¤§çš„æ•Œäººã€‚åœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼ŒåŒ…åªéœ€è¦3æ¬¡å¤åˆ¶ï¼šæºRAMåˆ°æºç½‘å¡ã€æºç½‘å¡åˆ°ç›®çš„ç½‘å¡ã€ç›®çš„ç½‘å¡åˆ°ç›®çš„RAMï¼Œè¿™ä¸€è¿‡ç¨‹è¿˜å¿…é¡»ä¸æ¶‰åŠä»»ä½•çš„å­˜å‚¨è½¬å‘å¹¶ä¸”ç½‘å¡æ˜¯è¢«æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´çš„ã€‚å¦‚æœç½‘å¡è¢«æ˜ å°„åˆ°å†…æ ¸ç©ºé—´è€Œä¸æ˜¯ç”¨æˆ·ç©ºé—´ï¼Œé‚£ä¹ˆç”¨æˆ·è¿›ç¨‹åªèƒ½é€šè¿‡å‘å‡ºä¸€ä¸ªé™·å…¥åˆ°å†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨æ¥å®ŒæˆåŒ…çš„å¤åˆ¶ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒåŒ…å¤åˆ¶çš„æ¬¡æ•°å°±å˜æˆäº†5æ¬¡ã€‚\nç”¨æˆ·å±‚é€šä¿¡è½¯ä»¶ åœ¨å¤šè®¡ç®—æœºä¸­ï¼Œä¸åŒCPUä¸Šçš„è¿›ç¨‹é€šè¿‡äº’ç›¸å‘é€æ¶ˆæ¯æ¥é€šä¿¡ã€‚åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ¶ˆæ¯ä¼ é€æ˜¯æš´éœ²ç»™ç”¨æˆ·è¿›ç¨‹çš„ã€‚æ¢å¥è¯è¯´ï¼Œæ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ç§å‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„é€”å¾„ï¼Œè€Œåº“è¿‡ç¨‹è°ƒç”¨ä½¿å¾—è¿™äº›åº•å±‚çš„è°ƒç”¨å¯ä»¥è¢«ç”¨æˆ·è¿›ç¨‹ä½¿ç”¨ã€‚\nå‘é€å’Œæ¥æ”¶ è¿™æ˜¯æœ€ç®€åŒ–çš„æƒ…å½¢ï¼Œæ“ä½œç³»ç»Ÿæä¾›ä¸¤ä¸ªåº“è°ƒç”¨ç»™ç”¨æˆ·è¿›ç¨‹ï¼šä¸€ä¸ªç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå¦ä¸€ä¸ªç”¨äºæ¥æ”¶æ¶ˆæ¯ã€‚\né˜»å¡è°ƒç”¨å’Œéé˜»å¡è°ƒç”¨ é˜»å¡è°ƒç”¨æœ‰æ—¶å€™ç§°åŒæ­¥è°ƒç”¨ã€‚å½“ä¸€ä¸ªè¿›ç¨‹è°ƒç”¨å‘é€æ–¹æ³•æ—¶ï¼Œå®ƒä¼šé˜»å¡ç›´åˆ°æ¶ˆæ¯å®Œå…¨å‘é€å‡ºå»ï¼Œç„¶åç»§ç»­æ‰§è¡Œå‘é€æ–¹æ³•åé¢çš„æŒ‡ä»¤ã€‚æ¥æ”¶è¿‡ç¨‹ä¹Ÿç±»ä¼¼ã€‚\nç›¸å¯¹äºé˜»å¡è°ƒç”¨çš„å¦ä¸€ç§æ–¹å¼æ˜¯éé˜»å¡è°ƒç”¨ï¼Œåˆç§°å¼‚æ­¥è°ƒç”¨ã€‚ç”±äºè¿›ç¨‹åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½é‡å†™ç¼“å†²åŒºï¼Œéé˜»å¡è°ƒç”¨å¿…é¡»ä¿è¯ç¼“å†²åŒºçš„å®‰å…¨ã€‚æœ‰ä¸‰ç§è§£å†³æ–¹æ¡ˆï¼š\n è®©å†…æ ¸å¤åˆ¶æ¶ˆæ¯åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œç„¶åè®©è¿›ç¨‹ç»§ç»­ã€‚ åœ¨å‘é€æ¶ˆæ¯å®Œå…¨ä¹‹åä¸­æ–­å‘é€è€…ï¼Œå‘ŠçŸ¥å…¶ç¼“å†²åŒºåˆå¯ä»¥ä½¿ç”¨äº†ã€‚ è®©ç¼“å†²åŒºé‡‡ç”¨Copy-on-Writeçš„æ–¹å¼ã€‚  åˆ†å¸ƒå¼ç³»ç»Ÿ åˆ†å¸ƒå¼ç³»ç»Ÿ(distributed system) ä¸å¤šè®¡ç®—æœºç±»ä¼¼ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰è‡ªå·±çš„ç§æœ‰å†…å­˜ï¼Œæ•´ä¸ªç³»ç»Ÿä¸­æ²¡æœ‰å…±äº«çš„ç‰©ç†å†…å­˜ã€‚ä½†æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­èŠ‚ç‚¹çš„è€¦åˆåº¦æ¯”å¤šå¤„ç†æœºæ›´ä½ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿæ„å»ºåœ¨è®¡ç®—æœºç½‘ç»œçš„ä¸Šå±‚ï¼Œé€šè¿‡åœ¨æ“ä½œç³»ç»Ÿçš„é¡¶éƒ¨åŠ ä¸€å±‚å«åš ä¸­é—´ä»¶(middleware) çš„è½¯ä»¶æ¥å¤„ç†ä¸åŒç¡¬ä»¶ä¸æ“ä½œç³»ç»Ÿçš„å·®å¼‚ï¼Œä¸ºåº”ç”¨ç¨‹åºå’Œç”¨æˆ·æä¾›ä¸€è‡´çš„èŒƒå‹ã€‚ä»æŸç§ç¨‹åº¦ä¸Šæ¥çœ‹ï¼Œä¸­é—´ä»¶å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿã€‚\nåŸºäºæ–‡æ¡£çš„ä¸­é—´ä»¶ ä¸‡ç»´ç½‘(World Wide Web) å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿã€‚Webæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯-æœåŠ¡å™¨ç³»ç»Ÿï¼Œå…¶èƒŒåå¾—åŸå§‹èŒƒå‹å´éå¸¸ç®€å•ï¼šæ¯ä¸ªè®¡ç®—æœºå¯ä»¥æŒæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¢«ç§°ä¸º Webé¡µé¢(Web page) çš„æ–‡æ¡£ï¼Œæ¯ä¸ªé¡µé¢ä¸­æœ‰æ–‡æœ¬ã€å›¾åƒã€éŸ³è§†é¢‘ç­‰ï¼Œè¿˜æœ‰é“¾æ¥åˆ°å…¶å®ƒé¡µé¢çš„è¶…é“¾æ¥(hyperlink)ã€‚ç”¨æˆ·é€šè¿‡æµè§ˆå™¨å‘æœåŠ¡å™¨è¯·æ±‚Webé¡µé¢ï¼Œå¹¶å¯ä»¥é€šè¿‡é¡µé¢ä¸­çš„è¶…é“¾æ¥è·³è½¬åˆ°å…¶å®ƒé¡µé¢ã€‚ç”±äºè¶…é“¾æ¥çš„å­˜åœ¨ï¼ŒWebæœ¬èº«æˆä¸ºäº†ä¸€ä¸ªç”±æ–‡æ¡£æ„æˆçš„å·¨å¤§çš„æœ‰å‘å›¾ã€‚æ¯ä¸€ä¸ªWebé¡µé¢éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åœ°å€ï¼Œç§°ä¸ºç»Ÿä¸€èµ„æºå®šä½ç¬¦(Uniform Resource Locator, URL)ï¼Œå…¶å…·ä½“å½¢å¼ä¸ºprotocol://DNS-name/file-nameï¼Œå¸¸è§çš„åè®®æœ‰HTTPã€FTPç­‰ï¼ŒURLå”¯ä¸€æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ã€‚\nå½“ç”¨æˆ·åœ¨Webæµè§ˆå™¨ä¸­é”®å…¥ä¸€ä¸ªURLæ—¶ï¼Œæµè§ˆå™¨æŒ‰ç…§ä¸€å®šçš„æ­¥éª¤è°ƒå–æ‰€è¯·æ±‚çš„Webé¡µé¢ã€‚ä¾‹å¦‚ï¼Œå½“è®¿é—®http://www.minix3.org/getting-started/index.htmlæ—¶ï¼Œæµè§ˆå™¨æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å–å¾—æ‰€éœ€è¦çš„é¡µé¢ï¼š\n æµè§ˆå™¨å‘DNSè¯¢é—®www.minix3.orgçš„IPåœ°å€ã€‚ DNSå‘Šè¯‰æµè§ˆå™¨IPåœ°å€ä¸º66.147.238.215ã€‚ æµè§ˆå™¨å»ºç«‹ä¸€ä¸ªåˆ°66.147.238.215ä¸Šç«¯å£80çš„TCPè¿æ¥ã€‚ æµè§ˆå™¨å‘é€å¯¹æ–‡ä»¶getting-started/index.htmlçš„è¯·æ±‚ã€‚ www.minix3.orgæœåŠ¡å™¨å‘é€æ–‡ä»¶getting-started/index.htmlç»™æµè§ˆå™¨ã€‚ æµè§ˆå™¨å±•ç¤ºgetting-started/index.htmlä¸­çš„æ–‡æœ¬å†…å®¹ã€‚ åŒæ—¶ï¼Œæµè§ˆå™¨è·å–å¹¶å±•ç¤ºé¡µé¢ä¸Šçš„æ‰€æœ‰å›¾ç‰‡ã€‚ æµè§ˆå™¨é‡Šæ”¾TCPè¿æ¥ã€‚  åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„ä¸­é—´ä»¶ WebèƒŒåå¾—æ€æƒ³æ˜¯ä½¿ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçœ‹èµ·æ¥åƒä¸€ä¸ªå·¨å¤§çš„è¶…é“¾æ¥é›†åˆã€‚å¦ä¸€ç§å¤„ç†æ–¹å¼åˆ™æ˜¯ä½¿ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçœ‹èµ·æ¥åƒä¸€ä¸ªå·¨å¤§çš„æ–‡ä»¶ç³»ç»Ÿã€‚\né‡‡ç”¨æ–‡ä»¶ç³»ç»Ÿæ¨¡å‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ„å‘³ç€åªå­˜åœ¨ä¸€ä¸ªå…¨å±€æ–‡ä»¶ç³»ç»Ÿï¼Œç”¨æˆ·èƒ½å¤Ÿè¯»å–å…¶æƒé™é›†åˆå†…çš„æ–‡ä»¶ã€‚ä¸€ä¸ªè¿›ç¨‹å°†æ•°æ®å†™å…¥æ–‡ä»¶ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹ä»æ–‡ä»¶ä¸­è¯»å‡ºæ•°æ®ï¼Œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å°±å®ç°äº†ã€‚\nä¼ è¾“æ¨¡å‹ ä¸Šä¼ /ä¸‹è½½æ¨¡å‹(upload/download model) å’Œ è¿œç¨‹è®¿é—®æ¨¡å‹(remote-access model) æ˜¯ä¸åŒçš„ä¸¤ç§ä¼ è¾“æ¨¡å‹ã€‚\nåœ¨ç¬¬ä¸€ç§æ¨¡å‹ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡å°†è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°æ¥å®ç°å¯¹è¿œç¨‹æ–‡ä»¶çš„è®¿é—®ã€‚å¦‚æœåªæ˜¯è¯»æ–‡ä»¶ï¼Œè¯»å–æ“ä½œåœ¨æœ¬åœ°å®Œæˆä¹‹åå°±å®Œäº‹å„¿(ä¸ºäº†é«˜æ€§èƒ½)ã€‚è€Œå¦‚æœæ˜¯å†™æ–‡ä»¶çš„è¯ï¼Œå†™å…¥æ“ä½œä¹Ÿåœ¨æœ¬åœ°è¿›è¡Œï¼Œå½“æ“ä½œå®Œæˆåï¼Œæ–°çš„æ–‡ä»¶ä¼šè¢«ä¸Šä¼ å›æœåŠ¡å™¨ã€‚ä¸Šä¼ /ä¸‹è½½æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯ç®€å•ï¼Œè€Œä¸”ä¸€æ¬¡æ€§ä¼ é€æ•´ä¸ªæ–‡ä»¶æ¯”åªä¼ è¾“ä¸€å°å—æ›´æœ‰æ•ˆç‡ã€‚ç”±äºéœ€è¦åœ¨æœ¬åœ°å­˜æ”¾æ•´ä¸ªæ–‡ä»¶ï¼Œå®¢æˆ·ç«¯å¿…é¡»æ‹¥æœ‰è¶³å¤Ÿçš„ç©ºé—´ã€‚å³ä½¿åªéœ€è¦æ–‡ä»¶çš„ä¸€å°éƒ¨åˆ†ä¹Ÿéœ€è¦æ•´ä¸ªæ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ç§æµªè´¹ï¼Œä¹Ÿæ˜¯è¿™ç§æ¨¡å‹çš„ç¼ºç‚¹ã€‚\nåœ¨ç¬¬äºŒç§æ¨¡å‹ä¸­ï¼Œæ–‡ä»¶å§‹ç»ˆä½äºæœåŠ¡å™¨ä¸Šï¼Œå®¢æˆ·ç«¯é€šè¿‡å‘æœåŠ¡å™¨å‘é€ç›¸å…³æŒ‡ä»¤æ¥å®Œæˆå„é¡¹æ“ä½œã€‚\nåŸºäºå¯¹è±¡çš„ä¸­é—´ä»¶ å’Œå‰é¢çš„ä¸€åˆ‡çš†æ–‡æ¡£æˆ–ä¸€åˆ‡çš†æ–‡ä»¶ä¸åŒï¼ŒåŸºäºå¯¹è±¡çš„ä¸­é—´ä»¶çš„æ€æƒ³æ˜¯ä¸€åˆ‡çš†å¯¹è±¡ã€‚å¯¹è±¡æ˜¯å˜é‡çš„é›†åˆï¼Œè¿™äº›å˜é‡ä¸ä¸€å¥—è¢«ç§°ä¸ºæ–¹æ³•çš„è®¿é—®è¿‡ç¨‹ç»‘å®šåœ¨ä¸€èµ·ã€‚è¿›ç¨‹ä¸è¢«å…è®¸ç›´æ¥è®¿é—®è¿™äº›å˜é‡ï¼Œç›¸åï¼Œè¿›ç¨‹å¿…é¡»é€šè¿‡è°ƒç”¨æ–¹æ³•æ¥è®¿é—®å®ƒä»¬ã€‚\nC++å’ŒJavaè¿™ç±»ç¼–ç¨‹è¯­è¨€æ˜¯é¢å‘å¯¹è±¡çš„ï¼Œä½†è¿™é‡Œçš„å¯¹è±¡åªæ˜¯è¯­è¨€çº§åˆ«çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶åˆ»çš„å¯¹è±¡ã€‚CORBAå°±æ˜¯ä¸€ä¸ªçŸ¥åçš„åŸºäºè¿è¡Œæ—¶å¯¹è±¡çš„ç³»ç»Ÿã€‚\nåŸºäºåä½œçš„ä¸­é—´ä»¶ åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¿˜æœ‰ä¸€ä¸ªæ³›å‹å°±æ˜¯æ‰€è°“çš„ åŸºäºåä½œçš„ä¸­é—´ä»¶(coordination-based middleware)ã€‚Lindaå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºé€šä¿¡å’ŒåŒæ­¥çš„ç³»ç»Ÿã€‚\nå‘å¸ƒ/è®¢é˜…(publish/subscribe) å°±æ˜¯å—Lindaå¯å‘è€Œå‡ºç°çš„åŸºäºå†™ä½œçš„æ¨¡å‹ã€‚æ¨¡å‹ç”±å¤§é‡é€šè¿‡æŸç§æ–¹å¼äº’è”çš„è¿›ç¨‹ç»„æˆï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ˜¯æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œè¿˜æœ‰å¯èƒ½ä¸¤è€…éƒ½æ˜¯ã€‚ç”Ÿäº§è€…å°†ç”Ÿäº§çš„æ¶ˆæ¯æ”¾åˆ°ä¸€ä¸ªç‰¹å®šçš„åœ°æ–¹ï¼Œå®Œæˆæ¶ˆæ¯çš„å‘å¸ƒï¼Œè€Œæ¶ˆè´¹è€…é€šè¿‡è®¢é˜…å…¶æ„Ÿå…´è¶£çš„æ¶ˆæ¯ï¼Œä»¥è·å¾—å“åº”çš„é€šçŸ¥ã€‚\n","href":"/notebook/reading_notes/modern_operating_systems/multiple_processor_systems/","title":"å¤šå¤„ç†æœºç³»ç»Ÿ"},{"content":" Taken from Design Concepts for Engineers (Fifth Edition) 2020.11.22\n ç¬¬1ç«  å·¥ç¨‹æ˜¯ä»€ä¹ˆ ä½œä¸ºä¸€åæœ‰æŠ±è´Ÿçš„å·¥ç¨‹å¸ˆï¼Œä½ æœ‰å¾ˆå¤šéœ€è¦å­¦ä¹ çš„ä¸œè¥¿ã€‚ä½ å¿…é¡»æŒæ¡å·¥ç¨‹çš„åŸºç¡€çŸ¥è¯†ï¼šæ•°å­¦ã€ç‰©ç†ã€åŒ–å­¦å’Œç”Ÿç‰©ã€‚ä½ å¿…é¡»å­¦ä¹ æ‰€å­¦å­¦ç§‘çš„ä¸“ä¸šè¯¾ç¨‹ï¼Œä¾‹å¦‚ç”µè·¯ã€åŠ›å­¦ã€ç»“æ„ã€ææ–™å’Œè®¡ç®—ã€‚åŒæ—¶ï¼Œä½ å¿…é¡»å­¦ä¹ å¦‚ä½•é€šè¿‡ç»ˆç”Ÿå­¦ä¹ æ¥ä¿æŒæŠ€æœ¯è¿›æ­¥ã€‚åˆ¶é€ å‡ºçœŸæ­£æœ‰æ•ˆçš„äº§å“çš„èƒ½åŠ›æ˜¯å·¥ç¨‹å¸ˆçš„æ ‡å¿—ã€‚è®¾è®¡æŠ€èƒ½æ˜¯å·¥ç¨‹å¸ˆåŒºåˆ«äºå…¶å®ƒåŸºç¡€ç§‘å­¦ä¸“ä¸šäººå£«çš„èƒ½åŠ›ã€‚\nè®¾è®¡è¿‡ç¨‹æ˜¯å·¥ç¨‹ä¸“ä¸šçš„æœ¬è´¨ï¼Œå› æ­¤ä½ å¿…é¡»ç†Ÿç»ƒæŒæ¡å®ƒï¼Œæ‰èƒ½å¤Ÿé¡ºåˆ©èµ°å‘æˆåŠŸã€‚\nä¸€ä¸ªå¥½çš„å·¥ç¨‹å¸ˆé€šå¸¸éå¸¸ç†Ÿæ‚‰å…¶ä»–å­¦ç§‘å’Œä¸“ä¸šï¼Œå·¥ç¨‹å¸ˆæˆåŠŸçš„å…³é”®å°±åœ¨äºæ¥å—å¹¿æ³›çš„å¤šå­¦ç§‘çš„æ•™è‚²ã€‚\nåœ¨è®¡ç®—æœºè¡Œä¸šä¸­ï¼Œä¸“é—¨å¤„ç†å¤§è§„æ¨¡è½¯ä»¶ç³»ç»Ÿçš„äººç§°ä¸ºâ€œç³»ç»Ÿå·¥ç¨‹å¸ˆâ€ã€‚ç„¶è€Œï¼Œä¼ ç»Ÿçš„ç³»ç»Ÿå·¥ç¨‹å¸ˆåˆ™æ˜¯æŒ‡è®¾è®¡ä¸å®ç°å¤æ‚å·¥ç¨‹ç³»ç»Ÿçš„äººã€‚ç³»ç»Ÿå·¥ç¨‹å¸ˆä¸ä»…èƒ½å¤Ÿå®Œæˆé¡¹ç›®çš„åˆå§‹è®¾è®¡ï¼Œè¿˜èƒ½å¤Ÿå¤„ç†åå‹¤ã€å›¢é˜Ÿåä½œå’Œé¡¹ç›®ç›‘ç£ä¸­çš„å„ç§é—®é¢˜ã€‚\nè¦æˆä¸ºä¸€ä¸ªæˆåŠŸçš„å·¥ç¨‹å¸ˆï¼Œå¿…é¡»æ‹¥æœ‰æŠ€æœ¯ã€ç†è®ºå’Œå®è·µèƒ½åŠ›ï¼Œè¿˜å¿…é¡»å–„äºç»„ç»‡ã€æ²Ÿé€šå’Œå†™ä½œã€‚å·¥ç¨‹åŸºç¡€ä¸­3ä¸ªæœ€ä¸»è¦çš„æŠ€èƒ½åŒ…æ‹¬çŸ¥è¯†ã€ç»éªŒå’Œç›´è§‰ã€‚è¿™äº›æ‰èƒ½å¹¶ä¸æ˜¯å·¥ç¨‹å¸ˆæŠ€èƒ½çš„å…¨éƒ¨ï¼Œä½†æ˜¯å¯¹äºä¸€åå·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè¿™æ˜¯è‡³å…³é‡è¦çš„ã€‚\nè®¾è®¡çš„æ•ˆç‡å–å†³äºè‰¯å¥½çš„æ²Ÿé€šã€‚\nç¬¬2ç«  è®¾è®¡æ˜¯ä»€ä¹ˆ åˆ†æã€è®¾è®¡ä¸å¤åˆ¶ å·¥ç¨‹å¸ˆè¦å®Œæˆçš„æ˜¯è¯•å›¾æ»¡è¶³ä¸€ç»„é¢„å…ˆç¡®å®šçš„éœ€æ±‚ï¼Œè€Œä¸æ˜¯å»å‘ç°ç‰©ç†ç°è±¡èƒŒåçš„ç§˜å¯†ã€‚åˆ†æä¸è®¾è®¡ä¹‹é—´çš„ä¸åŒä¹Ÿè¡¨ç°åœ¨ä»¥ä¸‹çš„å½¢å¼ï¼šå¦‚æœç­”æ¡ˆæ˜¯é€šè¿‡ç±»ä¼¼æ‹¼å‡‘ç¢ç‰‡ç»„æˆæ‹¼å›¾çš„æ–¹å¼è·å¾—çš„ï¼Œé‚£ä¹ˆè¿™é¡¹æ´»åŠ¨å¾ˆæœ‰å¯èƒ½æ˜¯åˆ†æã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæœ‰å¤šä¸ªè§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”å¦‚æœå†³å®šä¸€ä¸ªåˆé€‚çš„è·¯å¾„éœ€è¦åˆ›é€ ã€é€‰æ‹©ã€æµ‹è¯•ã€è¿­ä»£ã€è¯„ä¼°å’Œé‡æ–°æµ‹è¯•ï¼Œé‚£ä¹ˆè¯¥æ´»åŠ¨å°±æ˜¯è®¾è®¡ã€‚åˆ†æé€šå¸¸ä¼šä½œä¸ºè®¾è®¡è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªæ­¥éª¤ï¼Œä½†æ˜¯è®¾è®¡è¿˜è¦åŒ…æ‹¬åˆ›é€ ã€é€‰æ‹©å’Œæµ‹è¯•ç­‰å…¶å®ƒå…³é”®å› ç´ ã€‚\nå¤åˆ¶æŒ‡çš„æ˜¯ä¸€ä¸ªé‡å»ºå·²å®Œæˆè®¾è®¡çš„è¿‡ç¨‹ï¼Œå®ƒæ˜¯å·¥ç¨‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæ˜¯åˆ¶é€ ä¸šçš„æ ¸å¿ƒã€‚\nå·¥ç¨‹å¸ˆä¸€å®šè¦å…·æœ‰è¿œè§å’Œåˆ›é€ åŠ›ã€‚\nè®¾è®¡å‘¨æœŸ ç”Ÿæˆæƒ³æ³• åˆ›æ„æ˜¯å°†è®¾è®¡ä¸åˆ†æå’Œå¤åˆ¶åŒºåˆ†å¼€æ¥çš„çªå‡ºç‰¹å¾ä¹‹ä¸€ã€‚ç”Ÿæˆæƒ³æ³•çš„æœ€å…¸å‹æ–¹æ³•ä¹‹ä¸€å°±æ˜¯å¤´è„‘é£æš´ã€‚\nå¤´è„‘é£æš´çš„åŸºæœ¬è§„åˆ™ å½“å›¢é˜Ÿå†³å®šè¿›è¡Œå¤´è„‘é£æš´æ—¶ï¼Œè¯¥å›¢é˜Ÿåº”è¯¥æå‰å°±ä¸€ç³»åˆ—è§„åˆ™è¾¾æˆä¸€è‡´ï¼Œåˆ›é€ ä¸€ä¸ªå‹å¥½çš„ã€æ²¡æœ‰å¨èƒçš„ã€é¼“åŠ±å¼€æ”¾æ€æƒ³çš„ç¯å¢ƒã€‚æ¯æ¬¡å¤´è„‘é£æš´éƒ½å¯ä»¥æœ‰å…¶å…·ä½“çš„è§„åˆ™ï¼Œä¸‹é¢å‡ æ¡å¯ä»¥ç”¨ä½œæŒ‡å—ï¼š\n ä¸è¦çŠ¹è±«ã€‚ä»»ä½•å¥½çš„æƒ³æ³•éšæ—¶å¯èƒ½å‡ºç°ã€‚ æ²¡æœ‰ç•Œé™ã€‚ä»»ä½•æƒ³æ³•æ°¸è¿œéƒ½ä¸ä¼šå¤ªè’è°¬æˆ–è€…å¤ªå‡ºæ ¼ã€‚ ä¸è¦æ‰¹è¯„ã€‚åœ¨è¿›å…¥æœ€åçš„å°ç»„è®¨è®ºé˜¶æ®µä¹‹å‰ï¼Œä¸è¦éšæ„æ‰¹è¯„ä¸€ä¸ªæƒ³æ³•ã€‚ ä¸è¦é€€ç¼©ã€‚åœ¨è¿›å…¥æœ€åçš„å°ç»„è®¨è®ºé˜¶æ®µä¹‹å‰ï¼Œä¸è¦å¯¹æƒ³æ³•æ‰“æŠ˜æ‰£ã€‚ æ²¡æœ‰é™åˆ¶ã€‚æƒ³æ³•æ°¸è¿œä¸ä¼šå«Œå¤šã€‚ æ²¡æœ‰çº¦æŸã€‚å‚ä¸è€…å¯ä»¥ä»ä»»ä½•ä¸“ä¸šé¢†åŸŸç”Ÿæˆæƒ³æ³•ã€‚  ä¸è¦å®³ç¾ã€‚å›¢é˜Ÿçš„å‚ä¸è€…åœ¨æå‡ºä¸€ä¸ªæƒ³æ³•çš„è¿‡ç¨‹ä¸­éƒ½ä¸ä¼šæ„Ÿåˆ°å±€ä¿ƒä¸å®‰ã€‚  ä¼˜ç§€çš„å·¥ç¨‹å¸ˆ vs ç³Ÿç³•çš„å·¥ç¨‹å¸ˆ    ä¼˜ç§€çš„å·¥ç¨‹å¸ˆ ç³Ÿç³•çš„å·¥ç¨‹å¸ˆ     ä»¥å¼€æ”¾çš„å¿ƒæ€å¬å–æ–°çš„æƒ³æ³• å¾ˆå°‘å¬åˆ«äººçš„æƒ³æ³•   åœ¨é€‰æ‹©è®¾è®¡æ–¹æ³•ä¹‹å‰ï¼Œè€ƒè™‘å„ç§è§£å†³æ–¹æ¡ˆ åªè¿½æ±‚æœ€æ–°çš„è®¾è®¡æ–¹æ³•   ä»…åœ¨æµ‹è¯•ï¼Œä¿®æ”¹å’Œé‡æ–°æµ‹è¯•ä¹‹åæ‰è€ƒè™‘å®Œç»“é¡¹ç›® ä¸€æ—¦å‡ºç°æˆåŠŸçš„è¿¹è±¡å°±è®¤ä¸ºå¤§åŠŸå‘Šæˆï¼›ä¸è¿›è¡Œå½»åº•çš„æµ‹è¯•å°±æäº¤äº§å“   ç»å¯¹ä¸èƒ½é€šè¿‡åå¤è¯•éªŒæ¥å¾—åˆ°ä¸€ç»„è®¾è®¡å‚æ•° è®¤ä¸ºçº¯ç²¹çš„è¯•é”™å°±æ˜¯å·¥ç¨‹è®¾è®¡   ä½¿ç”¨â€œæˆ‘éœ€è¦ç†è§£ä¸ºä»€ä¹ˆâ€å’Œâ€œè®©æˆ‘ä»¬è€ƒè™‘å‡ ç§å¯èƒ½æ€§â€è¿™æ ·çš„çŸ­è¯­ ä½¿ç”¨è¯¸å¦‚â€œè¶³å¤Ÿå¥½â€å’Œâ€œæˆ‘ä¸æ˜ç™½ä¸ºä»€ä¹ˆå®ƒä¸èµ·ä½œç”¨ï¼Œåæ­£å°±æ˜¯è¿™æ ·äº†â€çš„çŸ­è¯­     æˆ‘æ„è¯†åˆ°æˆ‘æ˜¯ä¸€ä¸ªç³Ÿç³•çš„å·¥ç¨‹å¸ˆï¼Œæˆ‘è¦åŠªåŠ›å˜å¾—ä¼˜ç§€ã€‚\n ç¬¬3ç«  é¡¹ç›®ç®¡ç†ä¸å›¢é˜Ÿåˆä½œæŠ€èƒ½ ä¸€ä¸ªå¥½çš„å·¥ç¨‹å¸ˆå¿…é¡»çŸ¥é“å¦‚ä½•åœ¨å›¢é˜Ÿä¸­å·¥ä½œï¼Œä¿æŒé¡¹ç›®è¿›åº¦ï¼Œä¿æŒè‰¯å¥½çš„æ–‡æ¡£ï¼Œå¤„ç†æ³•å¾‹é—®é¢˜ï¼Œå¹¶åœ¨ä¸€ä¸ªå®Œå–„çš„ç®¡ç†è®¡åˆ’ä¸­å·¥ä½œã€‚\nåœ¨å›¢é˜Ÿä¸­å·¥ä½œ æœ‰æ•ˆçš„å›¢é˜Ÿæ˜¯æŒ‡èƒ½å¤Ÿä¸€èµ·é«˜æ•ˆå·¥ä½œçš„å›¢é˜Ÿã€‚å®ƒå¯ä»¥æœ€å¤§æ½œåŠ›çš„å‘æŒ¥ä½œç”¨ï¼Œå¹¶åœ¨å…¶å„ä¸ªæˆå‘˜çš„ç‰¹ä¿—èƒ½åŠ›ä¸‹å…±ç”Ÿå…´æ—ºã€‚æœ‰æ•ˆå›¢é˜Ÿçš„ä¸€ä¸ªå…³é”®ç‰¹å¾å°±æ˜¯é˜Ÿå‹ä¹‹é—´è‰¯å¥½çš„æ”¯æŒæ€åº¦ã€‚ä»¥ä¸‹å‡†åˆ™æ˜¯å»ºç«‹æœ‰æ•ˆå›¢é˜Ÿçš„ä¸€ç§å¯èƒ½æ–¹æ³•ï¼š\n æ˜ç¡®é¢†å¯¼è§’è‰²ã€‚ è¾¾æˆä¸€è‡´çš„ç›®æ ‡ã€‚ å®šä¹‰æ˜ç¡®çš„è§’è‰²ã€‚ å®šä¹‰å·¥ä½œæµç¨‹ã€‚ åŸ¹å…»è‰¯å¥½çš„äººé™…å…³ç³»ã€‚  ç®¡ç†ä»»åŠ¡ï¼šä¿æŒé¡¹ç›®æ­£å¸¸è¿›è¡Œ æ—¶é—´ç®¡ç†å¯¹äºä»»ä½•å·¥ç¨‹é¡¹ç›®çš„æˆåŠŸéƒ½æ˜¯è‡³å…³é‡è¦çš„ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸ç”¨çš„æ—¶é—´ç®¡ç†å·¥å…·ï¼š\n æ¸…å•ã€‚ä¸€ä¸ªç®€å•çš„æ¸…å•èƒ½å¤Ÿèµ·åˆ°å¯¹ç‰¹å®šé¡¹ç›®çš„ç›¸å…³å·¥ç¨‹ä»»åŠ¡çš„ç›‘ç£ä½œç”¨ã€‚ æ—¶é—´è¡¨ã€‚æ—¶é—´è¡¨æ˜¯ç»´æŒé¡¹ç›®æŒ‰è®¡åˆ’è¿›è¡Œçš„å®è´µå·¥å…·ã€‚ ç”˜ç‰¹å›¾ã€‚å½“ä¸€ä¸ªé¡¹ç›®è®¾è®¡å¹¶è¡Œä»»åŠ¡å’Œè®¸å¤šå·¥ä½œäººå‘˜æ—¶ï¼Œç”˜ç‰¹å›¾æ¯”æ—¶é—´è¡¨æ›´é€‚åˆè¿›è¡Œæ—¶é—´ç®¡ç†ã€‚ PERTå›¾ã€‚ä¸€ç§ç”¨äºä¼˜åŒ–å’Œè°ƒåº¦å¤æ‚çš„ã€ç›¸äº’å…³è”çš„æ´»åŠ¨çš„æ–¹æ³•ã€‚  æ–‡æ¡£ï¼šé¡¹ç›®æˆåŠŸçš„å…³é”® å·¥ç¨‹è®¾è®¡ç»ä¸æ˜¯ç‹¬ç«‹è¿›è¡Œçš„ï¼Œå³ä½¿æ˜¯æœ€ç®€å•çš„é¡¹ç›®ä¹Ÿæ¶‰åŠè®¾è®¡å¸ˆå’Œæœ€ç»ˆç”¨æˆ·ã€‚å·¥ç¨‹å¸ˆå½¼æ­¤äº¤æµçš„ä¸€ç§æ–¹å¼ä»”ç»†åœ°ä¿å­˜è®°å½•ã€‚ä½œä¸ºä¸€åä¸“ä¸šçš„å·¥ç¨‹å¸ˆï¼Œä½ æœ‰è´£ä»»æ”¶é›†å¹¶ä¿å­˜è®¾è®¡æ¦‚å¿µã€è‰å›¾ã€è¯¦ç»†å›¾çº¸ã€æµ‹è¯•ç»“æœã€é‡æ–°è®¾è®¡ã€æŠ¥å‘Šå’ŒåŸç†å›¾ï¼Œæ— è®ºè¿™äº›å†…å®¹æ˜¯å¦èƒ½å¤Ÿåº”ç”¨äºç›¸å…³é¡¹ç›®ã€‚æ–‡æ¡£è·Ÿè¸ªæ˜¯å›¢é˜Ÿå…¶ä»–æˆå‘˜é‡è§†æˆ–éªŒè¯ä½ çš„å·¥ä½œæ—¶é‡è¦çš„ä¿¡æ¯ä¼ é€’å·¥å…·ã€‚åŒæ—¶ï¼Œæ–‡æ¡£ä¹Ÿæ˜¯ä¸è‡ªå·±æ²Ÿé€šçš„å¥½æ–¹æ³•ï¼Œè®¸å¤šå·¥ç¨‹å¸ˆç”±äºå¾ˆå°‘ä¿å­˜è®°å½•è€Œä¸èƒ½é‡ç°è®¾è®¡ç»“æœã€‚ä¸“ä¸šå·¥ç¨‹å¸ˆçš„æ ‡å¿—ä¹‹ä¸€å°±æ˜¯ä¿æŒæœ‰ç»„ç»‡ã€æ•´æ´ã€æœ€æ–°çš„ä¸“ä¸šæ–‡æ¡£è®°å½•ã€‚æ–‡æ¡£ç¼–åˆ¶ä¸åº”è¯¥äº‹åæ‰§è¡Œï¼Œå¦‚æœä¸€ä¸ªé¡¹ç›®è¢«ä¸€ä¸ªå›¢é˜Ÿæˆå‘˜æ‹–ç´¯ï¼Œä½†ç”±äºæ–‡æ¡£æ˜¯åŒæ­¥çš„ï¼Œå¦ä¸€ä¸ªå›¢é˜Ÿæˆå‘˜å¯ä»¥æ¯«ä¸æ‹–å»¶åœ°æ¢å¤è¯¥é¡¹ç›®ã€‚\nç¬¬4ç«  å·¥ç¨‹å·¥å…· å·¥ç¨‹å’Œä¼°è®¡æ€»æ˜¯é½å¤´å¹¶è¿›ã€‚å½“è€ƒè™‘ä¸€ä¸ªæ–°çš„è®¾è®¡ç­–ç•¥æ—¶ï¼Œé¦–å…ˆé€šè¿‡ç²—ç•¥è®¡ç®—é‡è¦çš„æŒ‡æ ‡å’Œå‚æ•°æ¥è¡¡é‡å…¶å¯è¡Œæ€§æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ–¹æ³•ã€‚\nç¬¬5ç«  äººæœºç•Œé¢ äººæœºç•Œé¢å®šä¹‰äº†äººä¸å·¥ç¨‹äº§å“ä¹‹é—´çš„äº¤äº’æ–¹å¼ã€‚ä¸€ä¸ªä¼˜ç§€çš„äº§å“è®¾è®¡å¸ˆä¸ä»…è¦å…³å¿ƒäº§å“çš„åŠŸèƒ½ï¼Œè¿˜è¦å…³å¿ƒäº§å“æ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ã€‚\nç»éªŒä¸°å¯Œçš„å·¥ç¨‹å¸ˆçŸ¥é“äººæœºç•Œé¢æ˜¯äº§å“å¼€å‘åˆæœŸåº”è¯¥è§£å†³çš„ç¬¬ä¸€ä»¶äº‹ã€‚\nç¬¬7ç«  å­¦ä¼šè¡¨è¾¾ã€ä¹¦å†™å’Œæ¼”è®² å·¥ä½œä¸­å·¥ç¨‹å¸ˆéœ€è¦å…·å¤‡çš„æœ€é‡è¦çš„æŠ€èƒ½æ˜¯ä»€ä¹ˆï¼Ÿå½“è¢«é—®åŠè¿™ä¸ªé—®é¢˜æ—¶ï¼Œå‡ ä¹æ¯ä¸€ä½é›‡ä¸»éƒ½ä¼šå¼ºè°ƒçš„ä¸€ç‚¹å°±æ˜¯æ²Ÿé€šæŠ€å·§ã€‚\nå‡†å¤‡æ­£å¼æ¼”è®² ä¸€äº›åˆçº§å·¥ç¨‹å¸ˆæ™®éçŠ¯çš„é”™è¯¯ä¹‹ä¸€å°±æ˜¯è®¤ä¸ºå¬ä¼—å®Œå…¨ç†Ÿæ‚‰ä»–ä»¬æ‰€è®²çš„ä¸»é¢˜ã€‚å³ä½¿å¬æŠ¥å‘Šçš„äººå¯¹æ‰€è®²çš„å†…å®¹ä¸€æ— æ‰€çŸ¥ï¼Œä»–ä»ç„¶ç”¨åŒæ ·ç®€çŸ­çš„æ–¹å¼ä»‹ç»èƒŒæ™¯ã€‚äº‹å®ä¸Šï¼Œå¯¹äºæ­£å¼æ¼”è®²æŠ¥å‘Šæ¥è¯´ï¼Œåº”è¯¥åƒå‡†å¤‡ä¹¦é¢æ–‡æ¡£çš„æ–¹å¼æ¥ç»„ç»‡ã€‚ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å°†å¸®åŠ©ä½ å‡†å¤‡ä¸€ä¸ªæœ‰è¶£çš„æŠ¥å‘Šï¼Œä»¥æ»¡è¶³æ­£å¼æ¼”è®²çš„éœ€è¦ï¼š\n é¦–å…ˆè¦äº†è§£å¬æŠ¥å‘Šçš„äººå‘˜çš„çŸ¥è¯†èƒŒæ™¯ï¼Œå¹¶æ ¹æ®å…·ä½“æƒ…å†µåˆ¶å®šé€‚åˆçš„æŠ¥å‘Šå†…å®¹ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®ä¸ä¼šè€…å¯¹æŠ¥å‘Šå†…å®¹çš„äº†è§£ç¨‹åº¦å’Œæ°´å¹³è°ƒæ•´æŠ¥å‘Šå†…å®¹ã€‚ å‡è®¾å‚ä¼šäººå‘˜ç¬¬ä¸€æ¬¡æ¥è§¦æŠ¥å‘Šçš„ä¸»é¢˜ã€‚ åœ¨å‚ä¼šäººå‘˜å…¥åœºå‰æ£€æŸ¥å¥½è§†å¬è®¾å¤‡ã€‚ ç©¿ç€å¾—ä½“ã€‚ åœ¨æœ€åˆçš„å‡ åˆ†é’Ÿå†…å¼•èµ·æŠ¥å‘Šçš„ç›®çš„ã€‚ å‘Šè¯‰å‚ä¼šäººå‘˜ä¸ºä»€ä¹ˆç”±ä½ æ¥ä½œæŠ¥å‘Šã€‚ åœ¨æŠ¥å‘Šå¼€å§‹æ—¶å±•ç¤ºå‡ºæŠ¥å‘Šçš„å†…å®¹å¤§çº²ï¼Œç»™å‡ºæŠ¥å‘Šå°†è¦ä»‹ç»çš„å†…å®¹æ¦‚è¿°ã€‚ åœ¨æ¼”è®²å¼€å§‹æ—¶æƒ³å‡ºä¸€ä¸ªç®€å•çš„æ–¹å¼æ¥æ‰“ç ´æŠ¥å‘Šå¼€å§‹æ—¶çš„å°´å°¬çŠ¶æ€ã€‚ä¸€ä¸ªç®€å•çš„è¶£äº‹å¯ä»¥å¸®åŠ©è§‚ä¼—è½»æ¾åœ°ä¸ä½ å»ºç«‹èæ´½çš„å…³ç³»ã€‚ æ¼”è®²æ–¹å¼ç®€å•æ˜“æ‡‚ã€‚ä½ å¯èƒ½å¾ˆå®¹æ˜“æ‰§ç€äºä»‹ç»æŠ€æœ¯ç»†èŠ‚ï¼Œè€Œæ²¡æœ‰è®©å¬ä¼—çœŸæ­£è·å¾—æŠ¥å‘Šçš„ä¸»è¦å…³é”®ç‚¹ã€‚å› æ­¤ï¼Œå¯ä»¥å°†æŠ€æœ¯ç»†èŠ‚çš„å†…å®¹ç•™åœ¨æŠ¥å‘Šåçš„è®¨è®ºç¯èŠ‚ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°±èƒ½å¤Ÿä¿è¯å¬ä¼—ä»ä¸­å¾—åˆ°ä»–çœŸæ­£æ„Ÿå…´è¶£çš„æŠ€æœ¯é—®é¢˜ã€‚ ä¿æŒæ¼”è®²çš„ç®€çŸ­ã€‚æ ¹æ®ä½ è¢«åˆ†é…çš„æ—¶é—´é•¿çŸ­æ¥å‡†å¤‡è®²ç¨¿ï¼Œæœ€å¥½åªç”¨æ‰é¢„è®¡æ—¶é—´çš„50%~60%ï¼Œä½ æ‰ä¼šæœ‰å¯èƒ½å‡†æ—¶ç»“æŸã€‚ è‡ªé—®è‡ªç­”ã€‚é€šè¿‡ä¸€äº›è§†è§‰è¾…åŠ©çš„æ–¹å¼ä½œä¸ºæŠ¥å‘Šçš„ä¸»è¦æ€è·¯çº¿ç´¢ã€‚åˆ‡è®°ä¸è¦å¯¹å¹»ç¯ç‰‡å†…å®¹é€å­—é€å¥åœ°è¯»ï¼ ä¸è¦ç»™è§‚ä¼—å±•ç¤ºå…¬å¼ã€‚å¬ä¼—å‡ ä¹æ²¡æœ‰æ—¶é—´å»ç†è§£å®ƒä»¬ã€‚å¶å°”å¿…è¦æ—¶ï¼Œå¯ä»¥åŠ å…¥å°‘é‡å…¬å¼ã€‚ ä»¥â€œè°¢è°¢ï¼Œè¿˜æœ‰å…¶å®ƒé—®é¢˜å—ï¼Ÿâ€æ¥ç»“æŸæŠ¥å‘Šã€‚æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ä¸€å¼ ç»“è®ºæ€§çš„å¹»ç¯ç‰‡æ¥ç»“æŸæŠ¥å‘Šå†…å®¹ï¼Œè®©è§‚ä¼—çŸ¥é“ä½ çš„æŠ¥å‘Šå·²ç»ç»“æŸã€‚ åœ¨æŠ¥å‘Šç»“æŸåçš„é—®ç­”é˜¶æ®µï¼Œå½“æœ‰å‚ä¼šäººå‘˜æå‡ºé—®é¢˜æ—¶ï¼Œè¦å¯¹å…¶é—®é¢˜è¿›è¡Œé‡å¤ï¼Œä»¥ä½¿å¾—æ‰€æœ‰å‚ä¼šäººå‘˜éƒ½èƒ½å¤Ÿå¬åˆ°ã€‚æ­¤å¤–ï¼Œé‡ç”³é—®é¢˜ä¹Ÿæœ‰åŠ©äºé˜æ˜å†…å®¹ï¼Œç»™è‡ªå·±äº‰å–åˆ°æ€è€ƒçš„æ—¶é—´ã€‚  ","href":"/notebook/reading_notes/design_concepts_for_engineers/","title":"Design concepts for engineers"},{"content":"","href":"/tags/%E5%B7%A5%E7%A8%8B%E6%80%9D%E7%BB%B4/","title":"å·¥ç¨‹æ€ç»´"},{"content":"","href":"/categories/os/","title":"OS"},{"content":"è™šæ‹ŸåŒ–çš„ä¸»è¦æ€æƒ³æ˜¯ è™šæ‹Ÿæœºç›‘è§†ç¨‹åº(Virtual Machine Monitor, VMM) åœ¨åŒä¸€ç‰©ç†æœºä¸Šåˆ›å»ºå‡ºæœ‰å¤šå°(è™šæ‹Ÿ)æœºå™¨çš„å‡è±¡ï¼ŒVMMåˆç§°è™šæ‹Ÿæœºç®¡ç†ç¨‹åº(hypervisor)ã€‚æˆ‘ä»¬å¯ä»¥å°†hypervisioråˆ†ä¸ºä¸¤ç±»ï¼šç¬¬ä¸€ç±»hypervisorå’Œç¬¬äºŒç±»hypervisorã€‚å‰è€…è¿è¡Œåœ¨è£¸æœºä¸Šï¼Œè€Œåè€…ä¸»è¦ä¾èµ–äºåº•å±‚æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡å’ŒæŠ½è±¡ã€‚æ— è®ºé‡‡ç”¨ä½•ç§æ–¹å¼ï¼Œè™šæ‹ŸåŒ–æŠ€æœ¯éƒ½å…è®¸åœ¨å•ä¸€è®¡ç®—æœºä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼Œå¹¶ä¸”è¿™äº›è™šæ‹Ÿæœºèƒ½è¿è¡Œä¸åŒçš„æ“ä½œç³»ç»Ÿã€‚\ntype 1 and type 2 hypervisors æœ‰ä¸¤ç§ç±»å‹çš„hypervisorï¼š\n Type 1 hypervisors (native/bare metal hypervisors). Type 2 hypervisors (hosted hypervisors).  Goldbergå¯¹ä¸¤ç±»è™šæ‹ŸåŒ–æŠ€æœ¯è¿›è¡Œäº†åŒºåˆ†ã€‚ä»æŠ€æœ¯çš„è§’åº¦çœ‹ï¼Œä¸€ç±»hypervisoræ›´åƒæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œå› ä¸ºå®ƒæ˜¯å”¯ä¸€ä¸€ä¸ªè¿è¡Œåœ¨æœ€é«˜ç‰¹æƒæ¨¡å¼ä¸‹çš„ç¨‹åºã€‚äºŒç±»hypervisoræ˜¯ä¸€ä¸ªä¾èµ–æ“ä½œç³»ç»Ÿåˆ†é…å’Œè°ƒåº¦èµ„æºçš„ç¨‹åºï¼Œå°±åƒæ˜¯ä¸€ä¸ªæ™®é€šçš„è¿›ç¨‹ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œå®ƒè¿˜æ˜¯ä¼ªè£…æˆäº†ä¸€ä¸ªå…·æœ‰CPUå’Œå„ç§è®¾å¤‡çš„å®Œæ•´è®¡ç®—æœºã€‚\nå‚è€ƒèµ„æ–™  ANDREW S. TANENBAUM, HERBERT BOS. Modern Operating Systems, 4th Edition. Pearson, 2015.  ","href":"/operating_systems/virtual_machines/","title":"è™šæ‹Ÿæœº"},{"content":"è™šæ‹ŸåŒ–æŠ€æœ¯å…è®¸åœ¨ä¸€å°ç‰©ç†æœºä¸Šåˆ›å»ºå¤šå°è™šæ‹Ÿæœºå™¨ã€‚è¿™äº›è™šæ‹Ÿæœºå™¨æœ¬èº«å¹¶ä¸æ‹¥æœ‰ç‰©ç†èµ„æºï¼Œä½†å®ƒä»¬å´å¯ä»¥åƒæ™®é€šçš„æœºå™¨ä¸€æ ·å®Œæˆä»»åŠ¡ï¼Œæ¯å°è™šæ‹Ÿå™¨éƒ½ä¸çŸ¥é“å…¶å®ƒè™šæ‹Ÿæœºçš„å­˜åœ¨ã€‚Hypervisoræ˜¯ä½äºåº•å±‚ç‰©ç†èµ„æºå’Œè™šæ‹Ÿç¯å¢ƒä¹‹é—´çš„ä¸€ä¸ªç®¡ç†å±‚ï¼Œå®ƒåˆ›å»ºå½¼æ­¤ç›¸äº’éš”ç¦»çš„è™šæ‹Ÿç¯å¢ƒå¹¶ä¸ºè™šæ‹Ÿç¯å¢ƒåˆ†é…ç‰©ç†èµ„æºã€‚Hypervisoråˆç§°è™šæ‹Ÿæœºç›‘è§†ç¨‹åº(Virtual Machine Monitor, VMM)ã€‚å®‰è£…æœ‰hypervisorçš„ç‰©ç†æœºè¢«ç§°ä¸ºå®¿ä¸»æœº(host machine)ï¼Œè€Œè¢«hypervisoråˆ›å»ºå¹¶ç®¡ç†çš„è™šæ‹Ÿèµ„æºå°±æ˜¯ è™šæ‹Ÿæœº(virtual machine) æˆ– å®¢æˆ·æœº(guest machine)ã€‚\nè™šæ‹ŸåŒ–çš„ç±»å‹ æ ¹æ®è™šæ‹Ÿæœºéš”ç¦»æƒ…å†µçš„ä¸åŒï¼Œæœ‰ä¸‰ç§è™šæ‹ŸåŒ–æ–¹å¼ï¼š\n å…¨è™šæ‹ŸåŒ–(full virtualization)ã€‚ åŠè™šæ‹ŸåŒ–(paravirtualization)ã€‚ æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–(operating system virtualization)ã€‚  å…¨è™šæ‹ŸåŒ– åœ¨å…¨è™šæ‹ŸåŒ–çš„è™šæ‹Ÿå¹³å°ä¸­ï¼ŒGuest OSå¹¶ä¸çŸ¥é“è‡ªå·±æ˜¯ä¸€å°è™šæ‹Ÿæœºï¼Œå®ƒä¼šè®¤ä¸ºè‡ªå·±æ˜¯è¿è¡Œåœ¨ç‰©ç†ç¡¬ä»¶è®¾å¤‡ä¸Šçš„Host OSã€‚å› ä¸ºhypervisorå°†æ“ä½œç³»ç»Ÿç®¡ç†çš„æ‰€æœ‰ç¡¬ä»¶è®¾å¤‡é€»è¾‘æŠ½è±¡ä¸ºè™šæ‹Ÿè®¾å¤‡ï¼Œç„¶åäº¤ç»™Guest OSä½¿ç”¨ã€‚å®é™…ä¸Šæ˜¯Hypervisorä¸ºGuest OSåˆ¶é€ äº†ä¸€ç§å‡è±¡ï¼Œè®©Guest OSè®¤ä¸ºåº•å±‚ç¡¬ä»¶å¹³å°å½’è‡ªå·±æ‰€æœ‰ã€‚\nå…¨è™šæ‹ŸåŒ–ä¸ºæ¯å°è™šæ‹Ÿæœºæä¾›äº†å®Œå…¨éš”ç¦»çš„è™šæ‹Ÿç¯å¢ƒï¼Œå¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½ç›´æ¥åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…ï¼Œè€Œä¸éœ€è¦ä»»ä½•ä¿®æ”¹ã€‚\nåŠè™šæ‹ŸåŒ– åŠè™šæ‹ŸåŒ–éœ€è¦åœ¨å¯¹Guest OSçš„å†…æ ¸ä»£ç è¿›è¡Œä¸€å®šçš„ä¿®æ”¹ä¹‹åï¼Œæ‰èƒ½ä½¿Guest OSåœ¨åŠè™šæ‹ŸåŒ–çš„hypervisorä¸­è¿è¡Œã€‚åŠè™šæ‹ŸåŒ–ä¸éœ€è¦è™šæ‹Ÿæœºé™·å…¥ç‰¹æƒæŒ‡ä»¤ï¼Œå› æ­¤å¯¹ç³»ç»Ÿçš„ä¾µå…¥æ›´å°ã€‚Guest OSç›´åˆ°hypervisorçš„å­˜åœ¨ï¼Œå¹¶é€šè¿‡hypercallç›´æ¥ä¸hypervisoräº¤æµã€‚\næ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ– æ“ä½œç³»ç»Ÿçº§åˆ«çš„è™šæ‹ŸåŒ–æ˜¯æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå†…æ ¸çŸ¥é“å¤šä¸ªç”¨æˆ·ç©ºé—´å®ä¾‹çš„å­˜åœ¨ã€‚æˆ‘ä»¬ç§°è¿™ç§è™šæ‹ŸåŒ–ä¸ºå®¹å™¨åŒ–(containerzation)ï¼Œè€Œå°†è¿™äº›ç”¨æˆ·ç©ºé—´çš„å®ä¾‹ç§°ä¸ºå®¹å™¨(container)ã€‚ç¨‹åºå¯ä»¥åœ¨å®¹å™¨å†…è¿è¡Œï¼Œä½†å®ƒä»¬åªèƒ½è®¿é—®å®¹å™¨å†…çš„å†…å®¹å’Œä½¿ç”¨åˆ†é…ç»™å®¹å™¨çš„è®¾å¤‡ã€‚å®¹å™¨è®¤ä¸ºè‡ªå·±æ‹¥æœ‰æ‰€æœ‰å¯ç”¨èµ„æºï¼Œå®é™…ä¸Šå®ƒä»¬åªèƒ½è®¿é—®åˆ†é…ç»™å®¹å™¨çš„é‚£äº›èµ„æºã€‚\nHypervisors è™šæ‹Ÿæœºéœ€è¦è¡¨ç°å¾—ä¸çœŸå®çš„æœºå™¨ä¸€æ ·ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬æ—¢èƒ½åƒå¯åŠ¨çœŸæœºä¸€æ ·å¯åŠ¨å®ƒï¼Œä¹Ÿèƒ½åœ¨å®ƒä¸Šé¢æŒ‰ç…§ä»»æ„çš„æ“ä½œç³»ç»Ÿâ€¦â€¦\nhypervisorçš„ä»»åŠ¡å°±æ˜¯é«˜æ•ˆå®ç°è¿™ç§å‡è±¡ï¼Œå®ƒéœ€è¦åœ¨ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢è¡¨ç°è‰¯å¥½ï¼š\n å®‰å…¨æ€§(safety)ï¼šhypervisoråº”è¯¥å…·æœ‰è™šæ‹ŸåŒ–èµ„æºçš„å®Œå…¨æ§åˆ¶æƒã€‚ ä¿çœŸæ€§(fidelity)ï¼šè™šæ‹Ÿæœºä¸Šçš„ç¨‹åºåº”è¯¥åŒå…¶åœ¨ç‰©ç†æœºä¸Šè¿è¡Œçš„è¡¨ç°ä¸€è‡´ã€‚ é«˜æ•ˆæ€§(efficiency)ï¼šè™šæ‹Ÿæœºä¸­è¿è¡Œçš„ç»å¤§éƒ¨åˆ†ä»£ç éƒ½ä¸åº”è¯¥å—åˆ°VMMçš„å¹²æ¶‰ã€‚  æ¯«æ— ç–‘é—®ï¼Œåœ¨**è§£é‡Šå™¨(interpreter)**ä¸­é€æ¡è€ƒæŸ¥å¹¶å‡†ç¡®æ‰§è¡Œæ¯ä¸€æ¡æŒ‡ä»¤æ˜¯å®‰å…¨çš„ã€‚æœ‰äº›æŒ‡ä»¤å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œè€Œå…¶å®ƒä¸èƒ½å®Œå…¨æ‰§è¡Œçš„æŒ‡ä»¤åˆ™éœ€è¦ç”±è§£é‡Šå™¨è¿›è¡Œæ¨¡æ‹Ÿ(ä½¿VMMä¸Šè¿è¡Œçš„æ“ä½œç³»ç»Ÿè®¤ä¸ºè‡ªå·±æ­£ç¡®çš„æ‰§è¡Œäº†æŒ‡ä»¤)ã€‚\nåœ¨æ—©æœŸçš„x86ä½“ç³»ç»“æ„ä¸Šï¼Œè™šæ‹ŸåŒ–ä¸€ç›´éƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚æ¯ä¸ªåŒ…å«å†…æ ¸æ€å’Œç”¨æˆ·æ€çš„CPUéƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æŒ‡ä»¤é›†ï¼Œå…¶ä¸­çš„æŒ‡ä»¤åœ¨å†…æ ¸æ€ä¸ç”¨æˆ·æ€ä¸‹çš„æ‰§è¡Œè¡Œä¸ºä¸åŒï¼Œè¿™äº›æŒ‡ä»¤åŒ…æ‹¬I/Oæ“ä½œå’Œä¿®æ”¹MMUè®¾ç½®çš„æŒ‡ä»¤ï¼Œç§°ä¸ºæ•æ„ŸæŒ‡ä»¤(sensitive instruction)ã€‚è¿˜æœ‰ä¸€ä¸ªæŒ‡ä»¤é›†ï¼Œå…¶ä¸­çš„æŒ‡ä»¤åœ¨ç”¨æˆ·æ€æ‰§è¡Œæ—¶ä¼šå¯¼è‡´é™·å…¥ï¼Œç§°ä¸ºç‰¹æƒæŒ‡ä»¤(privileged instruction)ã€‚Popekå’ŒGoldbergæŒ‡å‡ºæœºå™¨å¯è™šæ‹ŸåŒ–çš„ä¸€ä¸ªå¿…è¦æ¡ä»¶æ˜¯æ•æ„ŸæŒ‡ä»¤ä¸ºç‰¹æƒæŒ‡ä»¤çš„å­é›†ï¼Œå³ï¼šè‹¥è¦åœ¨ç”¨æˆ·æ€åšä¸åº”è¯¥åœ¨ç”¨æˆ·æ€åšçš„äº‹ï¼Œç¡¬ä»¶å¿…é¡»é™·å…¥ã€‚ä½†Intel 386ä¸å…·å¤‡è¿™ä¸€ç‰¹æ€§ï¼šå¾ˆå¤šIntel 386æ•æ„ŸæŒ‡ä»¤åœ¨ç”¨æˆ·æ€æ‰§è¡Œæ—¶è¦ä¹ˆè¢«å¿½ç•¥ï¼Œè¦ä¹ˆå…·æœ‰ä¸åŒçš„è¡Œä¸ºã€‚å› æ­¤ï¼Œé‚£æ—¶çš„386åŠå…¶åç»§ä¸èƒ½è¢«è™šæ‹ŸåŒ–ï¼Œä¹Ÿä¸èƒ½ç›´æ¥æ”¯æŒhypervisorã€‚é™¤äº†æ•æ„ŸæŒ‡ä»¤åœ¨ç”¨æˆ·æ€ä¸èƒ½é™·å…¥ä»¥å¤–ï¼Œ386è¿˜å­˜åœ¨å¯ä»¥åœ¨ç”¨æˆ·æ€è¯»å–æ•æ„ŸçŠ¶æ€è€Œä¸é€ æˆé™·å…¥çš„æŒ‡ä»¤ã€‚ä¾‹å¦‚ï¼šåœ¨2005å¹´å‰çš„x86å¤„ç†å™¨ä¸Šï¼Œç¨‹åºå¯ä»¥é€šè¿‡è¯»å–ä»£ç æ®µé€‰æ‹©ç¬¦åˆ¤æ–­è‡ªèº«æ—¶è¿è¡Œåœ¨å†…æ ¸æ€è¿˜æ˜¯ç”¨æˆ·æ€ï¼Œè‹¥è™šæ‹Ÿæœºä¸­çš„æ“ä½œç³»ç»Ÿè¿™ä¹ˆåšå¹¶å‘ç°è‡ªå·±è¿è¡Œåœ¨ç”¨æˆ·æ€ï¼Œå°±ä¼šåšå‡ºé”™è¯¯çš„å†³ç­–ã€‚\nä»2005å¹´èµ·ï¼ŒIntelå’ŒAMDå¼€å§‹åœ¨CPUä¸­å¼•å…¥è™šæ‹ŸåŒ–æ”¯æŒï¼Œä½¿è¿™ä¸ªé—®é¢˜æœ€ç»ˆå¾—åˆ°è§£å†³ã€‚è¿™é¡¹æŠ€æœ¯åœ¨Intel CPUä¸­è¢«ç§°ä½œVT(Virtualization Technology)ï¼Œè€Œåœ¨AMD CPUä¸­ç§°ä½œSVN(Secure Virtual Machine)ã€‚å®ƒä»¬çš„åŸºæœ¬æ€æƒ³ä½¿åˆ›å»ºå¯è¿è¡Œè™šæ‹Ÿæœºçš„å®¹å™¨ï¼Œå®¢æˆ·æ“ä½œç³»ç»Ÿåœ¨å®¹å™¨ä¸­å¯åŠ¨å¹¶æŒç»­è¿è¡Œï¼Œç›´åˆ°å‘ç”Ÿå¼‚å¸¸å¹¶é™·å…¥hypervisorã€‚è¿™å°±ä½¿å¾—åœ¨x86å¹³å°å®ç°ç»å…¸çš„ é™·å…¥æ¨¡æ‹Ÿ(trap-and-emulate) æˆä¸ºå¯èƒ½ã€‚\nHypervisoråˆ›å»ºå¹¶ç®¡ç†è™šæ‹Ÿç¯å¢ƒï¼Œåˆ†ä¸ºä¸¤ç§ï¼š\n Type 1 hypervisors (native/type metal hypervisors). Type 2 hypervisors (hosted hypervisors).  è™šæ‹Ÿæœºä¸€ç« è¯¦ç»†ä»‹ç»äº†ä¸¤ç±»hypervisorã€‚\nå‚è€ƒèµ„æ–™  ANDREW S. TANENBAUM, HERBERT BOS. Modern Operating Systems, 4th Edition. Pearson, 2015.  ","href":"/operating_systems/virtualization/","title":"è™šæ‹ŸåŒ–"},{"content":"æ“ä½œç³»ç»Ÿä¸­æœ€æ ¸å¿ƒçš„æ¦‚å¿µæ˜¯è¿›ç¨‹ï¼šå®ƒæ˜¯å¯¹æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„ä¸€ä¸ªæŠ½è±¡ã€‚è¿›ç¨‹é€šå¸¸éœ€è¦åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚æ¸¸æˆè¿è¡Œèµ·æ¥å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œæ¸¸æˆå†…éƒ¨éœ€è¦æ¸²æŸ“å›¾å½¢ã€å“åº”ç”¨æˆ·æ“ä½œã€è¿æ¥ç½‘ç»œç­‰ï¼Œä¸ºäº†ä¿éšœè‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œè¿™äº›åŠŸèƒ½ä¸èƒ½ç›¸äº’é˜»å¡ï¼Œå› æ­¤éœ€è¦å¤šçº¿ç¨‹ï¼›è¿›ç¨‹éœ€è¦ç©ºé—´å­˜å‚¨æŒ‡ä»¤å’Œæ•°æ®ï¼Œå› æ­¤ç”¨åˆ°äº†å†…å­˜ï¼›æœ‰æ—¶å€™ï¼Œè¿›ç¨‹éœ€è¦å°†ä¸€éƒ¨åˆ†æ•°æ®æŒä¹…åŒ–ä¿å­˜ï¼Œè¿™å°±ç”¨åˆ°äº†æ–‡ä»¶ç³»ç»Ÿâ€¦â€¦\nè¿›ç¨‹ è¿›ç¨‹ï¼ˆprocessï¼‰ æ˜¯å¯¹æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„ä¸€ä¸ªæŠ½è±¡ï¼Œä»£è¡¨ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„ç¨‹åºçš„å®ä¾‹ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨å’Œå˜é‡çš„å½“å‰å€¼ã€‚ä¹Ÿå¯ä»¥è¿™ä¹ˆè¯´ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºå¯åŠ¨ååœ¨å†…å­˜ä¸­åˆ›å»ºçš„ä¸€ä¸ªæ‰§è¡Œå‰¯æœ¬ã€‚\nè¿›ç¨‹çš„åˆ›å»º é€šå¸¸æœ‰ 4 ç§äº‹ä»¶ä¼šå¯¼è‡´è¿›ç¨‹çš„åˆ›å»ºï¼š\n ç³»ç»Ÿåˆå§‹åŒ–ã€‚ æ­£åœ¨è¿è¡Œçš„ç¨‹åºæ‰§è¡Œäº†åˆ›å»ºè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ã€‚ ç”¨æˆ·è¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ã€‚ ä¸€ä¸ªæ‰¹å¤„ç†ä½œä¸šçš„åˆå§‹åŒ–ã€‚  ä»æŠ€æœ¯ä¸Šçœ‹ï¼Œåœ¨æ‰€æœ‰è¿™äº›æƒ…å½¢ä¸­ï¼Œæ–°è¿›ç¨‹éƒ½æ˜¯ç”±äºä¸€ä¸ªå·²ç»å­˜åœ¨çš„è¿›ç¨‹æ‰§è¡Œäº†ä¸€ä¸ªç”¨äºåˆ›å»ºè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨è€Œå‡ºç°çš„ã€‚\nåœ¨ UNIX ç³»ç»Ÿä¸­ï¼Œåˆ›å»ºæ–°è¿›ç¨‹ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿè°ƒç”¨ forkï¼Œè€Œ Windows ä¸­åˆ™æ˜¯CreateProcess å‡½æ•°ã€‚åœ¨ UNIX å’Œ Windows ä¸­ï¼Œè¿›ç¨‹åˆ›å»ºä¹‹åï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹æœ‰å„è‡ªä¸åŒçš„åœ°å€ç©ºé—´ã€‚å¦‚æœå…¶ä¸­æŸä¸ªè¿›ç¨‹ä¿®æ”¹äº†å…¶åœ°å€ç©ºé—´å†…çš„ä¸€ä¸ªå­—ï¼Œå…¶å®ƒè¿›ç¨‹æ˜¯å¯Ÿè§‰ä¸åˆ°çš„ã€‚åœ¨ UNIX ä¸­ï¼Œå­è¿›ç¨‹çš„åˆå§‹åœ°å€ç©ºé—´æ˜¯çˆ¶è¿›ç¨‹åœ°å€ç©ºé—´çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œä½†è¿™é‡Œå…¶å®æœ‰æ¶‰åŠåˆ°ä¸¤ä¸ªä¸åŒçš„åœ°å€ç©ºé—´ã€‚ä¸å¯å†™çš„å†…å­˜æ˜¯å…±äº«çš„ã€‚ä¸€äº› UNIX ç³»ç»Ÿåœ¨çˆ¶å­è¿›ç¨‹ä¹‹é—´å…±äº«ç¨‹åºæ­£æ–‡ï¼Œå› ä¸ºç¨‹åºæ­£æ–‡æ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚å­è¿›ç¨‹ä¹Ÿå¯èƒ½ä¼šå…±äº«çˆ¶è¿›ç¨‹æ‰€æœ‰çš„å†…å­˜ï¼Œä½†è¿™ç§æƒ…å†µä¸‹é‡‡ç”¨çš„æ˜¯ copy-on-write è¿™ç§å…±äº«æ–¹å¼ï¼Œä¸€æ—¦æœ‰è¿›ç¨‹æƒ³è¦ä¿®æ”¹éƒ¨åˆ†å†…å­˜ï¼Œå°±å¿…é¡»å…ˆå¤åˆ¶è¿™å—åœ°å€ç©ºé—´ï¼Œä»¥ç¡®ä¿ä¿®æ”¹å‘ç”Ÿåœ¨ç§æœ‰åŒºåŸŸã€‚å¯å†™çš„å†…å­˜æ˜¯ä¸å¯å…±äº«çš„ã€‚åœ¨ Windows ä¸­ï¼Œçˆ¶è¿›ç¨‹çš„åœ°å€ç©ºé—´å’Œå­è¿›ç¨‹çš„åœ°å€ç©ºé—´ä»ä¸€å¼€å§‹å°±æ˜¯ä¸åŒçš„ã€‚\nè¿›ç¨‹çš„ç»ˆæ­¢ è¿›ç¨‹åœ¨åˆ›å»ºä¹‹åï¼Œå°±å¼€å§‹è¿è¡Œï¼Œå®Œæˆå…¶å·¥ä½œã€‚è¿›ç¨‹ä¼šåœ¨æŸäº›æ¡ä»¶ä¸‹ç»ˆæ­¢ï¼š\n æ­£å¸¸é€€å‡ºï¼ˆè‡ªæ„¿çš„ï¼‰ã€‚å¤šæ•°è¿›ç¨‹æ˜¯ç”±äºå®Œæˆäº†å®ƒä»¬å·¥ä½œè€Œç»ˆæ­¢ï¼Œè¿™ä¸ªæ—¶å€™å®ƒä»¬ä¼šæ‰§è¡Œä¸€ä¸ªç³»ç»Ÿè°ƒç”¨è€Œé€€å‡ºã€‚åœ¨ UNIX ä¸­è¯¥è°ƒç”¨æ˜¯ exitï¼ŒWindows ä¸­åˆ™æ˜¯ExitProcessã€‚ å‡ºé”™é€€å‡ºï¼ˆè‡ªæ„¿çš„ï¼‰ã€‚ä¾‹å¦‚éœ€è¦çš„æ–‡ä»¶ä¸å­˜åœ¨ã€‚ ä¸¥é‡é”™è¯¯ï¼ˆéè‡ªæ„¿ï¼‰ã€‚ä¾‹å¦‚æ‰§è¡Œäº†éæ³•æŒ‡ä»¤ã€å¼•ç”¨äº†ä¸å¯è®¿é—®çš„å†…å­˜ç­‰ã€‚ è¢«å…¶å®ƒè¿›ç¨‹æ€æ­»ï¼ˆéè‡ªæ„¿ï¼‰ã€‚æŸä¸ªè¿›ç¨‹æ‰§è¡Œä¸€ä¸ªç³»ç»Ÿè°ƒç”¨é€šçŸ¥è‰èµ°ç³»ç»Ÿæ€æ­»æŸä¸ªå…¶å®ƒè¿›ç¨‹ã€‚åœ¨ UNIX ä¸­ï¼Œè¿™ä¸ªè°ƒç”¨æ˜¯ killï¼ŒWindows ä¸­ï¼Œåˆ™æ˜¯ TerminateProcess å‡½æ•°ã€‚  è¿›ç¨‹çš„çŠ¶æ€ æ¯ä¸ªè¿›ç¨‹éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®ä½“ï¼Œæœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨å’Œå†…éƒ¨çŠ¶æ€ã€‚è¿›ç¨‹ä¹‹é—´ç»å¸¸ç›¸äº’ä½œç”¨ï¼Œä»è€Œå¯¼è‡´è¿›ç¨‹çŠ¶æ€çš„è¿ç§»ã€‚\nè¿›ç¨‹çš„å®ç° ä¸ºäº†å®ç°è¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿç»´æŠ¤ç€ä¸€å¼  è¿›ç¨‹è¡¨ï¼ˆprocess tableï¼‰ï¼Œåˆç§° è¿›ç¨‹æ§åˆ¶å—ï¼ˆprocess control blockï¼‰ã€‚æ¯ä¸ªè¿›ç¨‹å ç”¨ä¸€ä¸ªè¿›ç¨‹è¡¨é¡¹ã€‚è¿›ç¨‹è¡¨é¡¹åŒ…å«äº†è¿›ç¨‹çŠ¶æ€çš„é‡è¦ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€å †æ ˆæŒ‡é’ˆã€å†…å­˜åˆ†é…æƒ…å†µã€æ‰€æ‰“å¼€æ–‡ä»¶çš„çŠ¶æ€ã€è´¦å·å’Œè°ƒåº¦ä¿¡æ¯ï¼Œä»¥åŠå…¶å®ƒåœ¨è¿›ç¨‹ç”±è¿è¡Œæ€è½¬ä¸ºå°±ç»ªæˆ–é˜»å¡æ€æ—¶å¿…é¡»ä¿å­˜çš„ä¿¡æ¯ï¼Œä»è€Œä¿è¯è¯¥è¿›ç¨‹éšåèƒ½å†æ¬¡å¯åŠ¨ï¼Œå°±åƒä»æœªè¢«ä¸­æ–­è¿‡ä¸€æ ·ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½è¢«ä¸­æ–­æ•°åƒæ¬¡ï¼Œä½†æ¯å½“è¢«ä¸­æ–­çš„è¿›ç¨‹è¢«é‡æ–°è¢«æ‰§è¡Œæ—¶ï¼Œæ“ä½œç³»ç»Ÿéƒ½ä¼šå°†è¿›ç¨‹çŠ¶æ€æ¢å¤åˆ°ä¸­æ–­å‘ç”Ÿå‰è¿›ç¨‹çš„çŠ¶æ€ã€‚\nçº¿ç¨‹ çº¿ç¨‹ï¼ˆthreadï¼‰ å…·æœ‰å¾ˆå¤šè¿›ç¨‹çš„ç‰¹è´¨ï¼Œåˆè¢«ç§°ä¸º è½»é‡çº§è¿›ç¨‹ï¼ˆlightweight processï¼‰ã€‚è¿›ç¨‹æŠŠèµ„æºé›†ä¸­åœ¨ä¸€èµ·ï¼ˆèµ„æºç®¡ç†çš„å•ä½æ˜¯è¿›ç¨‹ï¼‰ï¼Œè€Œçº¿ç¨‹åˆ™æ˜¯åœ¨ CPU ä¸Šè¢«è°ƒåº¦æ‰§è¡Œçš„å®ä½“ã€‚ä¸€ä¸ªè¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªåœ°å€ç©ºé—´å’Œå…¶å®ƒèµ„æºã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œè€Œä¸€ä¸ªè¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹éƒ½æœ‰å®Œå…¨ä¸€æ ·çš„åœ°å€ç©ºé—´ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¹Ÿå…±äº«åŒæ ·çš„å…¨å±€å˜é‡ã€‚ç”±äºå„ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è®¿é—®è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„æ¯ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œæ‰€ä»¥ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¯»ã€å†™ã€ç”šè‡³æ¸…é™¤å¦ä¸€ä¸ªçº¿ç¨‹çš„å †æ ˆï¼Œçº¿ç¨‹ä¹‹é—´æ˜¯æ²¡æœ‰ä¿æŠ¤çš„ã€‚\næ¯ä¸ªè¿›ç¨‹çš„ä¸­å†…å®¹æœ‰ï¼šåœ°å€ç©ºé—´ã€å…¨å±€å˜é‡ã€æ‰“å¼€çš„æ–‡ä»¶ã€å­è¿›ç¨‹ã€æ—¶é’Ÿä¿¡æ¯ã€ä¿¡å·ä¸ä¿¡å·å¤„ç†ç¨‹åºã€è´¦æˆ·ä¿¡æ¯ã€‚è€Œæ¯ä¸ªçº¿ç¨‹ä¸­çš„å†…å®¹æœ‰ï¼šç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨ã€å †æ ˆã€çŠ¶æ€ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å †æ ˆï¼Œå †æ ˆä¸­çš„æ ˆå¸§ä¾›å„ä¸ªè¢«è°ƒç”¨ä½†æ˜¯è¿˜æ²¡æœ‰ä»ä¸­è¿”å›çš„è¿‡ç¨‹ä½¿ç”¨ï¼Œæ ˆå¸§ä¿å­˜äº†ç›¸åº”è¿‡ç¨‹çš„å±€éƒ¨å˜é‡ä»¥åŠè¿‡ç¨‹è°ƒç”¨å®Œä¹‹åä½¿ç”¨çš„è¿”å›åœ°å€ã€‚\nè¿›ç¨‹é—´é€šä¿¡ æœ‰æ—¶å€™ï¼Œè¿›ç¨‹ä¹‹é—´éœ€è¦ç›¸äº’é€šä¿¡ã€‚è¿›ç¨‹é—´é€šä¿¡éœ€è¦è§£å†³çš„ä¸‰ä¸ªé—®é¢˜ï¼š\n è¿›ç¨‹å¦‚ä½•æŠŠä¿¡æ¯ä¼ é€’ç»™å…¶å®ƒè¿›ç¨‹ã€‚ å¦‚ä½•ç¡®ä¿ä¸¤ä¸ªæˆ–æ›´å¤šçš„è¿›ç¨‹åœ¨å…³é”®æ´»åŠ¨ä¸­ä¸ä¼šå‡ºç°äº¤å‰ã€‚ å½“è¿›ç¨‹é—´å‡ºç°ä¾èµ–æ—¶ï¼Œå¦‚ä½•ä¿è¯æ­£ç¡®çš„é¡ºåºã€‚  ä¸´ç•ŒåŒº ç«äº‰æ¡ä»¶ï¼ˆrace conditionï¼‰ è¯´çš„æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å¯¹å…±äº«èµ„æºçš„è¯»å†™å­˜åœ¨ç«äº‰ï¼Œå½“æ‰€æœ‰çš„è¿›ç¨‹æ‰§è¡Œå®Œæˆåï¼Œå…±äº«èµ„æºçš„å€¼æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå› ä¸ºå®ƒå–å†³äºè¿›ç¨‹æ‰§è¡Œçš„ç²¾ç¡®é¡ºåºã€‚\né¿å…ç«äº‰æ¡ä»¶çš„å…³é”®åœ¨äºé˜»æ­¢å¤šä¸ªè¿›ç¨‹åŒæ—¶è¯»å†™å…±äº«èµ„æºã€‚æ¢è¨€ä¹‹ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ äº’æ–¥ï¼ˆmutual exclusionï¼‰ï¼Œå³ç¡®ä¿ä¸€ä¸ªè¿›ç¨‹åœ¨ä½¿ç”¨æŸä¸ªå…±äº«èµ„æºæ—¶ï¼Œå…¶å®ƒçš„è¿›ç¨‹ä¸èƒ½åšåŒæ ·çš„æ“ä½œã€‚ç¨‹åºä¸­è®¿é—®å…±äº«èµ„æºçš„é‚£ä¸€éƒ¨åˆ†ä»£ç ç§°ä¸º ä¸´ç•ŒåŒºåŸŸï¼ˆcritical regionï¼‰ æˆ– ä¸´ç•ŒåŒºï¼ˆcritical sectionï¼‰ï¼Œä¸´ç•ŒåŒºå†…å…±äº«èµ„æºçš„è®¿é—®æ“ä½œå¿…é¡»è¢«åŒæ­¥ï¼Œå¦åˆ™æ•°æ®çš„ä¸€è‡´æ€§å°±å¾—ä¸åˆ°ä¿è¯ã€‚\nå¦‚æœæˆ‘ä»¬ç²¾å¿ƒåœ°å®‰æ’è¿›ç¨‹çš„æ‰§è¡Œé¡ºåºï¼Œé˜²æ­¢å¤šä¸ªè¿›ç¨‹åŒæ—¶è¯»å†™ä¸´ç•ŒåŒºï¼Œå°±èƒ½é¿å…ç«äº‰æ¡ä»¶ã€‚ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆéœ€è¦æ»¡è¶³ä»¥ä¸‹ 4 ä¸ªæ¡ä»¶ï¼š\n ä¸ä¼šå‡ºç°ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶åœ¨ä¸´ç•ŒåŒºå†…çš„æƒ…å†µã€‚ ä¸å¯¹ CPU çš„é€Ÿåº¦å’Œæ•°é‡åšä»»ä½•å‡è®¾ã€‚ è¿è¡Œåœ¨ä¸´ç•ŒåŒºå¤–çš„è¿›ç¨‹ä¸åº”è¯¥é˜»å¡ä»»ä½•è¿›ç¨‹ã€‚ è¿›ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºå‰ä¸ä¼šæ— é™ç­‰å¾…ã€‚  ä»¥ä¸¤ä¸ªè¿›ç¨‹ä¸ºä¾‹ï¼Œæˆ‘ä»¬æœŸæœ›å®ƒä»¬çš„è¡Œä¸ºæ˜¯è¿™æ ·çš„ï¼š\nåŸºäºå¿™ç­‰å¾…çš„äº’æ–¥ æ¥ä¸‹æ¥ä¼šä»‹ç»å‡ ç§åŸºäºå¿™ç­‰å¾…å®ç°çš„äº’æ–¥æ–¹æ¡ˆã€‚åœ¨è¿™äº›æ–¹æ¡ˆä¸­ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹åœ¨ä¸´ç•ŒåŒºä¸­æ›´æ–°å…±äº«å†…å­˜æœŸé—´ï¼Œå…¶å®ƒè¿›ç¨‹ä¸ä¼šè¿›å…¥ä¸´ç•ŒåŒºï¼Œä¹Ÿä¸ä¼šå¸¦æ¥éº»çƒ¦ã€‚\nå±è”½ä¸­æ–­ åœ¨å•å¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿æ¯ä¸ªè¿›ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºåå°±ç«‹å³å±è”½æ‰€æœ‰ä¸­æ–­ï¼Œå¹¶åœ¨å°†è¦ç¦»å¼€ä¸´ç•ŒåŒºä¹‹å‰å†æ¬¡æ‰“å¼€ä¸­æ–­ã€‚å› ä¸ºCPUåªæœ‰åœ¨å‘ç”Ÿæ—¶é’Ÿä¸­æ–­æˆ–å…¶å®ƒä¸­æ–­æ—¶æ‰ä¼šè¿›è¡Œè¿›ç¨‹åˆ‡æ¢ï¼Œå±è”½ä¸­æ–­åCPUå°±ä¸ä¼šå†è¿›è¡Œè¿›ç¨‹åˆ‡æ¢äº†ã€‚äºæ˜¯ï¼Œä¸€æ—¦æŸä¸ªè¿›ç¨‹å±è”½ä¸­æ–­åï¼Œå®ƒå°±å¯ä»¥æ£€æŸ¥å’Œä¿®æ”¹å…±äº«å†…å­˜ï¼Œè€Œä¸å¿…æ‹…å¿ƒå…¶å®ƒè¿›ç¨‹ä»‹å…¥ã€‚\nè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ¡ˆï¼Œå¦‚æœæŸä¸ªè¿›ç¨‹å±è”½ä¸­æ–­åä¸å†æ‰“å¼€ä¸­æ–­ï¼Œé‚£ä¹ˆæ•´ä¸ªç³»ç»Ÿå¯èƒ½å› æ­¤è€Œç»ˆæ­¢ã€‚å¯¹äºå¤šå¤„ç†å™¨ç³»ç»Ÿï¼Œå±è”½ä¸­æ–­ä»…ä»…å¯¹äºæ‰§è¡Œ disable æŒ‡ä»¤çš„é‚£ä¸ª CPU æœ‰æ•ˆï¼Œå…¶å®ƒ CPU ä»ç»§ç»­è¿è¡Œï¼Œå¹¶å¯ä»¥è®¿é—®å…±äº«å†…å­˜ã€‚\nå¦ä¸€æ–¹é¢ï¼Œå¯¹å†…æ ¸æ¥è¯´ï¼Œå½“å®ƒåœ¨æ›´æ–°å˜é‡æˆ–åˆ—è¡¨çš„å‡ æ¡æŒ‡ä»¤æœŸé—´å°†ä¸­æ–­å±è”½æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚å±è”½ä¸­æ–­å¯¹æ“ä½œç³»ç»Ÿæœ¬èº«è€Œè¨€æ˜¯ä¸€é¡¹å¾ˆæœ‰ç”¨çš„æŠ€æœ¯ï¼Œä½†å¯¹äºç”¨æˆ·è¿›ç¨‹åˆ™ä¸æ˜¯ä¸€ç§åˆé€‚çš„é€šç”¨äº’æ–¥æœºåˆ¶ã€‚\né”å˜é‡ å‡è®¾æœ‰ä¸€ä¸ªå…±äº«ï¼ˆé”ï¼‰å˜é‡ï¼Œå…¶åˆå§‹å€¼ä¸º0ã€‚å½“ä¸€ä¸ªè¿›ç¨‹æƒ³è¿›å…¥å…¶ä¸´ç•ŒåŒºæ—¶ï¼Œå®ƒé¦–å…ˆæŸ¥çœ‹è¿™æŠŠé”ï¼Œå¦‚æœé”çš„å€¼ä¸º0ï¼Œå°±å°†å…¶è®¾ç½®ä¸º1å¹¶è¿›å…¥ä¸´ç•ŒåŒºã€‚è‹¥é”çš„å€¼ä¸º1ï¼Œåˆ™ä¸€ç›´ç­‰å¾…ç›´åˆ°é”çš„å€¼å˜ä¸º0ã€‚äºæ˜¯ï¼Œ0è¡¨ç¤ºä¸´ç•ŒåŒºå†…æ— è¿›ç¨‹ï¼Œè€Œ1è¡¨ç¤ºä¸´ç•ŒåŒºå†…æœ‰è¿›ç¨‹ã€‚\nä½†æ˜¯ï¼Œè¿™ç§æƒ³æ³•ä¹Ÿä¼šå‡ºç°ç«äº‰æ¡ä»¶ã€‚å‡è®¾ä¸€ä¸ªè¿›ç¨‹è¯»å‡ºé”å˜é‡çš„å€¼å¹¶å‘ç°å®ƒä¸º0ï¼Œè€Œæ°å¥½åœ¨å®ƒå°†é”çš„å€¼è®¾ç½®ä¸º1ä¹‹å‰ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹è¢«è°ƒåº¦è¿è¡Œï¼Œå°†é”å˜é‡çš„å€¼è®¾ç½®ä¸º1ã€‚å½“ç¬¬ä¸€ä¸ªè¿›ç¨‹å†æ¬¡è¿è¡Œæ—¶ï¼Œå®ƒåŒæ ·ä¹Ÿå°†é”çš„å€¼è®¾ç½®ä¸º1ï¼Œåˆ™æ­¤æ—¶æœ‰ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶åœ¨ä¸´ç•ŒåŒºå†…ã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬è·å–å¯ä»¥åœ¨æ”¹å˜é”å˜é‡çš„å€¼ä¹‹å‰å†æ¬¡æ£€æŸ¥é”å˜é‡çš„å€¼ï¼Œä½†å¦‚æœç¬¬äºŒä¸ªè¿›ç¨‹æ°å¥½åœ¨ç¬¬ä¸€ä¸ªè¿›ç¨‹æ£€æŸ¥å®Œä¹‹åä¿®æ”¹äº†é”å˜é‡çš„å€¼ï¼ŒåŒæ ·ä¼šå‡ºç°ç«äº‰æ¡ä»¶ã€‚\nä¸¥æ ¼è½®è½¬æ³• ä»¥ä¸‹å±•ç¤ºäº†ä¸€ç§ç”¨äºä¸¤ä¸ªè¿›ç¨‹äº’æ–¥çš„ç®—æ³•ã€‚ è¿›ç¨‹0ï¼š\nwhile ï¼ˆTRUEï¼‰ { while ï¼ˆturn != 0ï¼‰; // å¾ªç¯ç­‰å¾…  critical_regionï¼ˆï¼‰; turn = 1; noncritical_regionï¼ˆï¼‰; } è¿›ç¨‹1ï¼š\nwhile ï¼ˆTRUEï¼‰ { while ï¼ˆturn != 1ï¼‰; // å¾ªç¯ç­‰å¾…  critical_regionï¼ˆï¼‰; turn = 0; noncritical_regionï¼ˆï¼‰; } çº¿ç¨‹0å’Œçº¿ç¨‹1é€šè¿‡æ£€æŸ¥å…±äº«å˜é‡turnçš„å–å€¼æ¥å†³å®šæ˜¯å¦è¿›å…¥ä¸´ç•ŒåŒºã€‚å˜é‡turnçš„åˆå§‹å€¼ä¸º0ï¼Œè¡¨ç¤ºè¿›ç¨‹0å¯ä»¥è¿›å…¥ä¸´ç•ŒåŒºã€‚å¼€å§‹æ—¶ï¼Œè¿›ç¨‹0æ£€æŸ¥turnï¼Œå‘ç°ä¸º0ï¼Œäºæ˜¯è¿›å…¥ä¸´ç•ŒåŒºã€‚è¿›ç¨‹1ä¹Ÿå‘ç°turnä¸º0ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ä¸åœçš„æµ‹è¯•turnï¼Œç›´åˆ°å…¶å€¼å˜ä¸º1ã€‚è¿ç»­æµ‹è¯•ä¸€ä¸ªå˜é‡ç›´åˆ°æŸä¸ªå€¼å‡ºç°ä¸ºæ­¢ï¼Œç§°ä¸ºå¿™ç­‰å¾…ï¼ˆbusy waitingï¼‰ã€‚ç”±äºè¿™ç§æ–¹å¼ä¼šæµªè´¹CPUçš„æ—¶é—´ï¼Œæ‰€ä»¥é€šå¸¸åº”è¯¥é¿å…ã€‚åªæœ‰åœ¨æœ‰ç†ç”±è®¤ä¸ºç­‰å¾…æ—¶é—´éå¸¸çŸ­çš„æƒ…å½¢ä¸‹ï¼Œæ‰ä½¿ç”¨å¿™ç­‰å¾…ã€‚ç”¨äºå¿™ç­‰å¾…çš„é”ï¼Œç§°ä¸ºè‡ªæ—‹é”ï¼ˆspin lockï¼‰ã€‚\nè¿›ç¨‹0ç¦»å¼€ä¸´ç•ŒåŒºæ—¶ï¼Œå°†turnè®¾ç½®ä¸º1ï¼Œä»¥ä¾¿å…è®¸è¿›ç¨‹1è¿›å…¥ä¸´ç•ŒåŒºã€‚å‡è®¾è¿›ç¨‹1å¾ˆå¿«ä¾¿ç¦»å¼€äº†ä¸´ç•ŒåŒºï¼Œå®ƒå°†turnè®¾ç½®ä¸º0ï¼Œè¿™ä¸ªæ—¶å€™ä¸¤ä¸ªè¿›ç¨‹éƒ½å¤„äºä¸´ç•ŒåŒºå¤–ã€‚ç°åœ¨è¿›ç¨‹0å†æ¬¡è¿›å…¥å¤–å±‚å¾ªç¯ï¼Œå®ƒè¿›å…¥ä¸´ç•ŒåŒºåˆé€€å‡ºï¼Œturnçš„å€¼å˜ä¸º1ã€‚æ­¤æ—¶ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨ä¸´ç•ŒåŒºå¤–æ‰§è¡Œã€‚çªç„¶ï¼Œè¿›ç¨‹0å†æ¬¡å®Œæˆéä¸´ç•ŒåŒºçš„æ“ä½œè€Œå›åˆ°å¾ªç¯çš„å¼€å§‹ä½ç½®ï¼Œä½†è¿™ä¸ªæ—¶å€™å®ƒå¹¶ä¸èƒ½è¿›å…¥ä¸´ç•ŒåŒºï¼Œå› ä¸ºturnå½“å‰çš„å€¼ä¸º1ï¼Œå› ä¸ºæ­¤æ—¶è¿›ç¨‹1è¿˜åœ¨å¿™äºéä¸´ç•ŒåŒºçš„æ“ä½œï¼Œè¿›ç¨‹0åªæœ‰è‡ªæ—‹ç­‰å¾…ï¼Œç›´åˆ°è¿›ç¨‹1æŠŠturnå˜ä¸º0ä¸ºæ­¢ã€‚è¿™è¯´æ˜ï¼šåœ¨ä¸€ä¸ªè¿›ç¨‹æ¯”å¦ä¸€ä¸ªè¿›ç¨‹æ…¢äº†å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œè½®æµè¿›å…¥ä¸´ç•ŒåŒºå¹¶ä¸æ˜¯ä¸€ä¸ªå¥½åŠæ³•ã€‚\nè¯¥æ–¹æ¡ˆè¦æ±‚ä¸¤ä¸ªè¿›ç¨‹ä¸¥æ ¼åœ°è½®æµè¿›å…¥ä¸´ç•ŒåŒºï¼Œé¿å…äº†æ‰€æœ‰çš„ç«äº‰æ¡ä»¶ã€‚ç”±äºæ–¹æ¡ˆä¸­å‡ºç°äº†ä¸´ç•ŒåŒºå¤–çš„è¿›ç¨‹é˜»å¡å…¶å®ƒè¿›ç¨‹çš„æƒ…å†µï¼Œè¿åäº†æ¡ä»¶3ï¼Œæ‰€ä»¥ä¸èƒ½ä½œä¸ºä¸€ä¸ªå¾ˆå¥½çš„å¤‡é€‰æ–¹æ¡ˆã€‚\nPetersonç®—æ³• Petersonäº1981å¹´æå‡ºäº†ä¸€ç§æ–°çš„äº’æ–¥ç®—æ³•ï¼Œå…‹æœäº†ä¸¥æ ¼è½®è½¬æ³•çš„ç¼ºç‚¹ï¼š\n#define FALSE 0 #define TRUE 1 #define N 2 // è¿›ç¨‹æ•°é‡  int turn; // è°å¯ä»¥è¿›å…¥ä¸´ç•ŒåŒº int interested[N]; void enter_regionï¼ˆint processï¼‰ { // è¿›ç¨‹æ˜¯0æˆ–1  int other = 1 - process; // å¦ä¸€ä¸ªè¿›ç¨‹å·  interested[process] = TRUE; // è¡¨ç¤ºå‡†å¤‡è¿›å…¥ä¸´ç•ŒåŒº  turn = process; // è¡¨ç¤ºè°æ­£åœ¨ç­‰å¾…è¿›å…¥ä¸´ç•ŒåŒº  while ï¼ˆturn == process \u0026amp;\u0026amp; interested[other] == TRUEï¼‰; // å¾ªç¯ç­‰å¾… } void leave_regionï¼ˆint processï¼‰ { interested[process] = FALSE; // è¡¨ç¤ºç¦»å¼€ä¸´ç•ŒåŒº } åœ¨è¿›å…¥å…¶ä¸´ç•ŒåŒºä¹‹å‰ï¼Œå„ä¸ªè¿›ç¨‹ä½¿ç”¨è‡ªå·±è¿›ç¨‹å·0æˆ–1ä½œä¸ºenter_regionçš„å‚æ•°ã€‚è¯¥è°ƒç”¨åœ¨éœ€è¦æ—¶å°†ä½¿è¿›ç¨‹ç­‰å¾…ï¼Œç›´åˆ°èƒ½å®‰å…¨åœ°è¿›å…¥ä¸´ç•ŒåŒºã€‚åœ¨å®Œæˆå¯¹å…±äº«å˜é‡çš„æ“ä½œä¹‹åï¼Œè¿›ç¨‹å°†è°ƒç”¨leave_regionç¦»å¼€ä¸´ç•ŒåŒºã€‚è‹¥å…¶å®ƒè¿›ç¨‹å¸Œæœ›è¿›å…¥ä¸´ç•ŒåŒºï¼Œç°åœ¨å°±èƒ½è¿›å…¥ã€‚\nä¸€å¼€å§‹ï¼Œæ²¡æœ‰ä»»ä½•è¿›ç¨‹å¤„äºä¸´ç•ŒåŒºä¸­ï¼Œç°åœ¨è¿›ç¨‹0è°ƒç”¨enter_regionï¼Œå®ƒé€šè¿‡è®¾ç½®å…¶æ•°ç»„å…ƒç´ å’Œå°†turnç½®ä¸º0æ¥æ ‡è¯†å®ƒå¸Œæœ›è¿›å…¥ä¸´ç•ŒåŒºã€‚ç”±äºè¿›ç¨‹1å¹¶åœ¨ä¸´ç•ŒåŒºå†…ï¼Œæ‰€ä»¥enter_regionå¾ˆå¿«è¿”å›ï¼Œå¦‚æœè¿›ç¨‹1ç°åœ¨è°ƒç”¨enter_regionï¼Œè¿›ç¨‹1å°†åœ¨æ­¤å¤„å¾ªç¯ç­‰å¾…ç›´åˆ°interested[0]å˜æˆFASLEï¼Œè€Œè¿™åªæœ‰åœ¨è¿›ç¨‹0è°ƒç”¨leave_regioné€€å‡ºä¸´ç•ŒåŒºæ—¶æ‰ä¼šå‘ç”Ÿã€‚\nç°åœ¨è€ƒè™‘ä¸¤ä¸ªè¿›ç¨‹å‡ ä¹åŒæ—¶è°ƒç”¨enter_regionçš„æƒ…å†µï¼Œå®ƒä»¬å°†è‡ªå·±çš„è¿›ç¨‹å·å­˜å…¥turnï¼Œä½†æ—¶åªæœ‰åè®¾ç½®çš„è¿›ç¨‹å·æ‰ä¼šç”Ÿæ•ˆï¼Œå‰ä¸€ä¸ªå› ä¸ºè¢«é‡å†™è€Œä¸¢å¤±ã€‚å‡è®¾è¿›ç¨‹1æ˜¯åå­˜å…¥çš„ï¼Œåˆ™turnä¸º1ã€‚å½“ä¸¤ä¸ªè¿›ç¨‹éƒ½è¿è¡Œåˆ°whileè¯­å¥æ—¶ï¼Œè¿›ç¨‹0å°†å¾ªç¯0æ¬¡å¹¶è¿›å…¥ä¸´ç•ŒåŒºï¼Œè€Œè¿›ç¨‹1ç”±äºwhileæ¡ä»¶ä¸æ»¡è¶³è€Œä¸èƒ½è¿›å…¥ä¸´ç•ŒåŒºï¼Œå®ƒéœ€è¦ä¸€ç›´å¾ªç¯ç›´åˆ°è¿›ç¨‹0é€€å‡ºä¸´ç•ŒåŒºä¸ºæ­¢ã€‚turnå˜é‡å¯ä»¥ç†è§£ä¸ºï¼šç°åœ¨è½®åˆ°è°ï¼Œå³è°æ­£åœ¨ç­‰å¾…è¿›å…¥ä¸´ç•ŒåŒºã€‚\nåŸºäºç¡¬ä»¶çš„è§£å†³æ–¹æ¡ˆ åœ¨æŸäº›è®¡ç®—æœºä¸­ï¼Œç‰¹åˆ«æ˜¯é‚£äº›è®¾è®¡ä¸ºå¤šå¤„ç†å™¨çš„è®¡ç®—æœºï¼Œéƒ½æœ‰ä¸‹é¢ä¸€æ¡æŒ‡ä»¤ï¼š\nTSL RX, LOCK ç§°ä¸ºæµ‹è¯•å¹¶åŠ é”ï¼ˆtest and set lockï¼‰ã€‚å®ƒå°†ä¸€ä¸ªå†…å­˜å­—lockè¯»å–åˆ°å¯„å­˜å™¨RXä¸­ï¼Œç„¶ååœ¨è¯¥å†…å­˜åœ°å€ä¸Šå­˜ä¸€ä¸ªéé›¶å€¼ã€‚è¯»å­—å’Œå†™å­—æ“ä½œä¿è¯æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œå³è¯¥æŒ‡ä»¤ç»“æŸä¹‹å‰å…¶ä»–å¤„ç†å™¨å‡ä¸å…è®¸è®¿é—®è¯¥å†…å­˜å­—ã€‚æ‰§è¡ŒTSLæŒ‡ä»¤çš„CPUå°† é”ä½å†…å­˜æ€»çº¿ï¼Œä»¥ç¦æ­¢å…¶å®ƒCPUåœ¨è¯¥æŒ‡ä»¤ç»“æŸä¹‹å‰è®¿é—®å†…å­˜ã€‚\nä¸ºäº†ä½¿ç”¨TSLæŒ‡ä»¤ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªå…±äº«å˜é‡lockæ¥åè°ƒå¯¹å…±äº«å†…å­˜çš„è®¿é—®ã€‚å½“lockä¸º0æ—¶ï¼Œä»»ä½•è¿›ç¨‹éƒ½å¯ä»¥ä½¿ç”¨TSLæŒ‡ä»¤å°†å…¶è®¾ç½®ä¸º1å¹¶è¯»å†™å…±äº«å†…å­˜ã€‚å½“æ“ä½œç»“æŸæ—¶ï¼Œè¿›ç¨‹è°ƒç”¨ä¸€æ¡æ™®é€šçš„MOVEæŒ‡ä»¤å°†lockçš„å€¼é‡æ–°è®¾ç½®ä¸º0ã€‚\nenter_region: TSL REGISTER,LOCK | å°†LOCKä¸­çš„å€¼å¤åˆ¶åˆ°REGISTERå¹¶å°†LOCKçš„å€¼ç½®ä¸º1 CMP REGISTER,#0 | REGISTERä¸­çš„å€¼ä¸º0å—ï¼Ÿ  JNE enter_region | è‹¥éé›¶ï¼Œè¯´æ˜é”ä¸å¯ç”¨ï¼Œå¾ªç¯ RET | è¿”å›ï¼›è¿›å…¥ä¸´ç•ŒåŒº leave_region: MOVE LOCK,#0 | å°†LOCKçš„å€¼ç½®ä¸º0  RET | è¿”å› enter_regionçš„ç¬¬ä¸€æ¡æŒ‡ä»¤å°†lockçš„æ—§å€¼å¤åˆ¶åˆ°å¯„å­˜å™¨å¹¶å°†lockçš„æ–°å€¼è®¾ç½®ä¸º1ï¼Œéšåå°†lockçš„æ—§å€¼ä¸0ç›¸æ¯”è¾ƒï¼Œè‹¥é0ï¼Œåˆ™è¯´æ˜é”å·²è¢«ä½¿ç”¨ï¼Œåˆ™ç¨‹åºå›åˆ°å¼€å§‹å¹¶å†æ¬¡æµ‹è¯•ã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°lockçš„å€¼ä¸º0ï¼Œäºæ˜¯è¿‡ç¨‹è¿”å›ï¼ŒåŠ é”æˆåŠŸã€‚è¦æ¸…é™¤é”éå¸¸ç®€å•ï¼Œç¨‹åºåªéœ€è¦å°†0å­˜å…¥lockå³å¯ã€‚\nä¸€ä¸ªå¯ä»¥æ›¿ä»£TSLçš„æŒ‡ä»¤æ˜¯XCHGï¼Œå®ƒåŸå­çš„äº¤æ¢ä¸¤ä¸ªä½ç½®çš„å†…å®¹ã€‚ä»¥ä¸‹è§£æ³•å’ŒTSLè§£æ³•æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼š\nenter_region: MOVE REGISTER,#1 | å°†1å­˜å…¥REGISTER  XCHG REGISTER,LOCK | äº¤æ¢REGISTERä¸LOCKçš„å€¼ CMP REGISTER,#0 | REGISTERä¸­çš„å€¼ä¸º0å—ï¼Ÿ  JNE enter_region | è‹¥éé›¶ï¼Œè¯´æ˜é”ä¸å¯ç”¨ï¼Œå¾ªç¯ RET | è¿”å›ï¼›è¿›å…¥ä¸´ç•ŒåŒº leave_region: MOVE LOCK,#0 | å°†LOCKçš„å€¼ç½®ä¸º0  RET | è¿”å› è¿›ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰å…ˆè°ƒç”¨enter_regionï¼Œè¿™å°†å¯¼è‡´å¿™ç­‰å¾…ï¼Œç›´åˆ°é”ç©ºé—²ä¸ºæ­¢ï¼Œéšåè¿›ç¨‹è·å¾—é”å¹¶è¿”å›ã€‚è¿›ç¨‹ä»ä¸´ç•ŒåŒºè¿”å›æ—¶è°ƒç”¨leave_regionï¼Œå°†lockè®¾ç½®ä¸º0ã€‚ä¸å…¶å®ƒåŸºäºä¸´ç•ŒåŒºé—®é¢˜çš„è§£æ³•ä¸€æ ·ï¼Œè¿›ç¨‹å¿…é¡»åœ¨æ­£ç¡®çš„æ—¶é—´è°ƒç”¨enter_regionå’Œleave_regionï¼Œè§£æ³•æ‰èƒ½å¥æ•ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šä¸´ç•ŒåŒºèƒ½å¦å·¥ä½œå–å†³äºè¿›ç¨‹æ˜¯å¦éµå®ˆåå®šã€‚\nç¡çœ ä¸å”¤é†’ Petersonç®—æ³•å’ŒåŸºäºTSLæˆ–XCHGçš„è§£å†³æ–¹æ¡ˆéƒ½æ˜¯æ­£ç¡®çš„ï¼Œä½†å®ƒä»¬éƒ½æœ‰å¿™ç­‰å¾…çš„ç¼ºç‚¹ã€‚è¿™äº›è§£æ³•çš„æœ¬è´¨æ˜¯ï¼šå½“ä¸€ä¸ªè¿›ç¨‹æƒ³è¦è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œå…ˆæ£€æŸ¥æ˜¯å¦å…è®¸è¿›å…¥ï¼Œè‹¥ä¸å…è®¸ï¼Œåˆ™åŸåœ°è‡ªæ—‹ç­‰å¾…ï¼Œç›´åˆ°å…è®¸ä¸ºæ­¢ã€‚è¿™ç§æ–¹æ³•ä¸ä»…æµªè´¹CPUæ—¶é—´ï¼Œè€Œä¸”è¿˜å¯èƒ½å¼•å‘é¢„æƒ³ä¸åˆ°çš„é—®é¢˜ï¼Œä¾‹å¦‚ä¼˜å…ˆçº§åè½¬é—®é¢˜ã€‚\nç°åœ¨æ¥è€ƒå¯Ÿå¦ä¸€ç»„è¿›ç¨‹é—´é€šä¿¡åŸè¯­ï¼Œå®ƒä»¬åœ¨æ— æ³•è¿›å…¥ä¸´ç•ŒåŒºæ—¶å°†é˜»å¡ï¼Œè€Œä¸æ˜¯å¿™ç­‰å¾…ã€‚æœ€ç®€å•çš„å°±æ˜¯sleepå’Œwakeupã€‚sleepæ˜¯ä¸€ä¸ªå°†å¼•èµ·è°ƒç”¨è¿›ç¨‹é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå³è¿›ç¨‹è¢«æŒ‚èµ·ï¼Œç›´åˆ°å¦ä¸€ä¸ªè¿›ç¨‹å°†å…¶å”¤é†’ã€‚wakeupåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå³è¦è¢«å”¤é†’çš„è¿›ç¨‹ã€‚\nç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ä¹Ÿç§°å«æœ‰é™ç¼“å†²åŒºé—®é¢˜ã€‚ä¸¤ä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ªå…¬å…±çš„å›ºå®šå¤§å°çš„ç¼“å†²åŒºï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ç”Ÿäº§è€…ï¼Œå®ƒå°†æ¶ˆæ¯æ”¾å…¥ç¼“å†²åŒºï¼›å¦ä¸€ä¸ªæ˜¯æ¶ˆè´¹è€…ï¼Œå®ƒä»ç¼“å†²åŒºå†…å–å‡ºæ¶ˆæ¯ã€‚å½“ç¼“å†²åŒºå·²æ»¡ï¼Œç”Ÿäº§è€…å°†è¢«é˜»å¡ï¼Œç›´åˆ°æ¶ˆè´¹è€…ä»ç¼“å­˜åŒºä¸­å–èµ°æ•°æ®å¹¶å°†å…¶å”¤é†’ã€‚åŒæ ·çš„ï¼Œå½“æ¶ˆè´¹è€…è¯•å›¾ä»ç¼“å†²åŒºä¸­å–æ¶ˆæ¯è€Œå‘ç°ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…å°±ç¡çœ ï¼Œç›´åˆ°ç”Ÿäº§è€…å‘ç¼“å†²åŒºä¸­æ”¾å…¥æ¶ˆæ¯å¹¶å°†å…¶å”¤é†’ã€‚\næˆ‘ä»¬éœ€è¦ä¸€ä¸ªå˜é‡countæ¥è¿½è¸ªç¼“å†²åŒºä¸­æ¶ˆæ¯çš„æ•°é‡ã€‚å¦‚æœç¼“å†²åŒºçš„å®¹é‡ä¸ºNï¼Œåˆ™ç”Ÿäº§è€…å°†é¦–å…ˆæ£€æŸ¥countæ˜¯å¦è¾¾åˆ°äº†Nï¼Œè‹¥æ˜¯ï¼Œåˆ™ç”Ÿäº§è€…ç¡çœ ï¼›å¦åˆ™ç”Ÿäº§è€…å‘ç¼“å†²åŒºä¸­æ”¾å…¥ä¸€æ¡æ¶ˆæ¯å¹¶å°†countå€¼åŠ 1ã€‚æ¶ˆè´¹è€…é¦–å…ˆæµ‹è¯•countæ˜¯å¦ä¸º0ï¼Œè‹¥æ˜¯ï¼Œåˆ™ç¡çœ ï¼›å¦åˆ™å–èµ°ä¸€æ¡æ¶ˆæ¯å¹¶å°†countå‡1ã€‚æ¯ä¸ªè¿›ç¨‹åŒæ—¶ä¹Ÿä¼šæ£€æµ‹æ˜¯å¦éœ€è¦å”¤é†’å¦ä¸€ä¸ªè¿›ç¨‹ã€‚\n# define N 100; // ç¼“å†²åŒºå®¹é‡ int count = 0; // ç¼“å†²åŒºä¸­æ¶ˆæ¯çš„æ•°é‡  void producerï¼ˆvoidï¼‰ { while ï¼ˆTRUEï¼‰ { int item = product_itemï¼ˆï¼‰; // ç”Ÿäº§ä¸€æ¡æ¶ˆæ¯  if ï¼ˆcount == Nï¼‰ sleepï¼ˆï¼‰; // ç¼“å†²åŒºæ»¡äº†ï¼Œç¡çœ   putï¼ˆitemï¼‰; // æ”¾å…¥ä¸€æ¡æ¶ˆæ¯åˆ°ç¼“å†²åŒº  count++; // ç¼“å†²åŒºä¸­æ¶ˆæ¯æ•°é‡åŠ 1  if ï¼ˆcount == 1ï¼‰ wakeupï¼ˆconsumerï¼‰; // è‹¥æ”¾å…¥æ¶ˆæ¯ä¹‹å‰ç¼“å†²åŒºæ˜¯ç©ºçš„ï¼Œåˆ™å”¤é†’æ¶ˆè´¹è€…  } } void consumerï¼ˆvoidï¼‰ { while ï¼ˆTRUEï¼‰ { if ï¼ˆcount == 0ï¼‰ sleepï¼ˆï¼‰; // ç¼“å†²åŒºæ˜¯ç©ºçš„ï¼Œç¡çœ   int item = takeï¼ˆï¼‰; // å–èµ°ä¸€æ¡æ¶ˆæ¯  count--; // ç¼“å†²åŒºä¸­æ¶ˆæ¯æ•°é‡å‡1  if ï¼ˆcount == N - 1ï¼‰ wakeupï¼ˆproducerï¼‰; // å¦‚æœå–èµ°æ¶ˆæ¯å‰ç¼“å†²åŒºæ˜¯æ»¡çš„ï¼Œåˆ™å”¤é†’ç”Ÿäº§è€…  consumeï¼ˆitemï¼‰; // æ¶ˆè´¹  } } è¿™é‡Œå¯èƒ½å‡ºç°ç«äº‰æ¡ä»¶ï¼ŒåŸå› æ˜¯å¯¹countçš„è®¿é—®æœªåŠ é™åˆ¶ã€‚æœ‰å¯èƒ½å‡ºç°ä»¥ä¸‹æƒ…å†µï¼šç¼“å†²åŒºä¸ºç©ºï¼Œæ¶ˆè´¹è€…è¯»å–åˆ°çš„countå€¼ä¸º0ã€‚æ­¤æ—¶è°ƒåº¦ç¨‹åºå†³å®šæŒ‚èµ·æ¶ˆè´¹è€…å¹¶å¯åŠ¨ç”Ÿäº§è€…ï¼Œç”Ÿäº§è€…æ”¾å…¥ä¸€ä¸ªæ•°æ®é¡¹åˆ°ç¼“å†²åŒºï¼Œcountå˜ä¸º1ã€‚ç”Ÿäº§è€…æ¨æ–­è®¤ä¸ºç”±äºåˆšæ‰countä¸º0ï¼Œæ‰€ä»¥æ¶ˆè´¹è€…ä¸€å®šåœ¨ç¡çœ ï¼Œæ‰€ä»¥è°ƒç”¨wakeupå”¤é†’æ¶ˆè´¹è€…ã€‚ä½†æ˜¯ï¼Œæ¶ˆè´¹è€…æ­¤æ—¶å¹¶æ²¡æœ‰ç¡çœ ï¼Œæ‰€ä»¥wakeupä¿¡å·ä¸¢å¤±ã€‚å½“æ¶ˆè´¹è€…ä¸‹æ¬¡è¿è¡Œæ—¶ï¼Œå®ƒç»§ç»­æµ‹è¯•ä¹‹å‰è¯»åˆ°çš„countå€¼ï¼Œä¾æ—§ä¸ºæŒ‚èµ·ä¹‹å‰çš„å€¼0ï¼Œäºæ˜¯ç¡çœ ã€‚è¿™æ ·ä¸‹å»ï¼Œç”Ÿäº§è€…è¿Ÿæ—©ä¼šå¡«æ»¡æ•´ä¸ªç¼“å†²åŒºï¼Œç„¶åç¡çœ ï¼Œæœ€ç»ˆä¸¤ä¸ªè¿›ç¨‹éƒ½å°†æ°¸è¿œç¡çœ ä¸‹å»ã€‚\né—®é¢˜çš„å®è´¨åœ¨äºå‘ç»™ä¸€ä¸ªæœªç¡çœ è¿›ç¨‹çš„wakeupä¿¡å·ä¸¢å¤±äº†ã€‚ä¸€ç§å¿«é€Ÿçš„å¼¥è¡¥æ–¹æ³•å°±æ˜¯ä¿®æ”¹è§„åˆ™ï¼ŒåŠ ä¸Šä¸€ä¸ªå”¤é†’ç­‰å¾…ä½ã€‚å½“ä¸€ä¸ªwakeupä¿¡å·å‘ç»™ä¸€ä¸ªæ¸…é†’çš„è¿›ç¨‹æ—¶ï¼Œå°†è¯¥ä½ç½®1ï¼Œéšåå½“è¿›ç¨‹å°è¯•ç¡çœ æ—¶ï¼Œè‹¥å”¤é†’ç­‰å¾…ä½ä¸º1ï¼Œåˆ™å°†å…¶æ¸…é›¶ï¼Œå°±ä¸ç¡çœ è€Œæ˜¯ä¿æŒæ¸…é†’ã€‚\nä¿¡å·é‡ ä¿¡å·é‡ï¼ˆsemaphoreï¼‰ æ˜¯Dijkstraåœ¨1965å¹´æå‡ºçš„ä¸€ç§æ–¹æ³•ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªæ•´å‹å˜é‡è®°å½•å”¤é†’æ¬¡æ•°ï¼Œä¾›ä»¥åä½¿ç”¨ã€‚ä¸€ä¸ªä¿¡å·é‡çš„å–å€¼å¯ä»¥æ˜¯0ï¼ˆè¡¨ç¤ºå½“å‰æ²¡æœ‰ç¡çœ çš„è¿›ç¨‹ï¼‰æˆ–è€…ä¸ºæ­£å€¼ï¼ˆè¡¨ç¤ºå½“å‰æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å¤„äºç¡çœ çŠ¶æ€ï¼Œç­‰å¾…è¢«å”¤é†’ï¼‰ã€‚ä»¥ä¸‹çš„æ£€æŸ¥ä¿¡å·é‡çš„å€¼ã€ä¿®æ”¹ä¿¡å·é‡çš„å€¼å’Œç¡çœ æ“ä½œå‡éœ€è¦ä¿è¯æ˜¯åŸå­æ“ä½œã€‚\nä¿¡å·é‡æ”¯æŒä¸¤ç§æ“ä½œï¼šdownå’Œupï¼ˆåˆ†åˆ«å¯¹åº”äºå¹¿ä¹‰çš„sleepå’Œwakeupï¼‰ã€‚å¯¹ä¸€ä¸ªä¿¡å·é‡æ‰§è¡Œdownæ“ä½œæ—¶ï¼Œä¼šå…ˆæ£€æŸ¥å…¶å€¼æ˜¯å¦å¤§äº0ï¼Œè‹¥å¤§äº0ï¼Œåˆ™å°†å…¶å‡ä¸€ï¼ˆç”¨æ‰ä¸€ä¸ªå”¤é†’ä¿¡å·ï¼Œå³ç¡çœ è¿›ç¨‹çš„æ•°é‡å‡ä¸€ï¼‰å¹¶ç»§ç»­ï¼›è‹¥ä¿¡å·é‡çš„å€¼ä¸º0ï¼Œåˆ™è¿›ç¨‹å°†ç¡çœ ï¼Œè€Œä¸”æ­¤æ—¶downæ“ä½œæœªç»“æŸã€‚upæ“ä½œå¯¹ä¿¡å·é‡çš„å€¼åŠ 1ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿›ç¨‹åœ¨è¯¥ä¿¡å·é‡ä¸Šç¡çœ ï¼ˆå³å…ˆå‰çš„downæ“ä½œè¿˜æœªå®Œæˆï¼‰ï¼Œç³»ç»Ÿä¼šé€‰å–ä¸€ä¸ªè¿›ç¨‹å¹¶å…è®¸å®ƒå®Œæˆä¹‹å‰çš„down1=æ“ä½œã€‚äºæ˜¯ï¼Œå¯¹ä¸€ä¸ªæœ‰è¿›ç¨‹åœ¨å…¶ä¸Šç¡çœ çš„ä¿¡å·é‡æ¥è¯´ï¼Œæ‰§è¡Œä¸€æ¬¡upæ“ä½œä¹‹åï¼Œä¿¡å·é‡çš„å€¼ä¾æ—§ä¸º0ï¼Œåªæ˜¯åœ¨å…¶ä¸Šç¡çœ çš„è¿›ç¨‹å°‘äº†ä¸€ä¸ªã€‚\nç”¨ä¿¡å·é‡è§£å†³ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ ä¸ºç¡®ä¿ä¿¡å·é‡èƒ½æ­£ç¡®å·¥ä½œï¼Œéœ€è¦é‡‡ç”¨ä¸€ç§åŸå­çš„æ–¹å¼æ¥å®ç°å®ƒã€‚é€šå¸¸å°†upå’Œdownä½œä¸ºç³»ç»Ÿè°ƒç”¨æ¥å®ç°ï¼Œè€Œä¸”æ“ä½œç³»ç»Ÿåªéœ€è¦åœ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œæ—¶æš‚æ—¶å±è”½ä¸­æ–­ï¼šæµ‹è¯•ä¿¡å·é‡ã€æ›´æ–°ä¿¡å·é‡ä»¥åŠåœ¨éœ€è¦æ—¶ä½¿æŸä¸ªè¿›ç¨‹ç¡çœ ã€‚\nç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜çš„è§£å†³æ–¹æ¡ˆä½¿ç”¨äº†ä¸‰ä¸ªä¿¡å·é‡ï¼šfullè®°å½•æ»¡ç¼“å†²æ§½æ•°é‡ï¼Œemptyè®°å½•ç©ºç¼“å†²æ§½æ•°é‡ï¼Œmutexæ§åˆ¶å¯¹ä¸´ç•ŒåŒºçš„è®¿é—®ï¼Œç¡®ä¿ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸ä¼šåŒæ—¶è¿›å…¥ç¼“å†²åŒºã€‚mutexçš„åˆå€¼ä¸º1ï¼Œä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥è¿›å…¥ä¸´ç•ŒåŒºï¼Œç§°ä½œäºŒå…ƒä¿¡å·é‡ï¼ˆbinary semaphoreï¼‰ã€‚\n#define N 100 typedef int semaphore semaphore full = 0; // æ…¢ç¼“å†²æ§½æ•°é‡ semaphore empty = N; // ç©ºç¼“å†²æ§½æ•°é‡ semaphore mutex = 1; // æ§åˆ¶å¯¹ä¸´ç•ŒåŒºçš„è®¿é—®  void producerï¼ˆvoidï¼‰ { while ï¼ˆTRUEï¼‰ { int item = produce_itemï¼ˆï¼‰; // ç”Ÿäº§ä¸€æ¡æ¶ˆæ¯  downï¼ˆ\u0026amp;emptyï¼‰; // ç©ºæ§½æ•°é‡å‡1  downï¼ˆ\u0026amp;mutexï¼‰; // è¿›å…¥ä¸´ç•ŒåŒº  putï¼ˆitemï¼‰; // å°†æ¶ˆæ¯æ”¾åˆ°ç¼“å†²åŒº  upï¼ˆ\u0026amp;mutexï¼‰; // ç¦»å¼€ä¸´ç•ŒåŒº  upï¼ˆ\u0026amp;fullï¼‰; // æ»¡æ§½æ•°é‡åŠ 1  } } void consumerï¼ˆvoidï¼‰ { while ï¼ˆTRUEï¼‰ { downï¼ˆ\u0026amp;fullï¼‰; // æ»¡æ§½æ•°é‡å‡1  downï¼ˆ\u0026amp;mutexï¼‰; // è¿›å…¥ä¸´ç•ŒåŒº  int item = takeï¼ˆï¼‰; // ä»ç¼“å†²åŒºå–èµ°ä¸€æ¡æ•°æ®  upï¼ˆ\u0026amp;mutexï¼‰; // ç¦»å¼€ä¸´ç•ŒåŒº  upï¼ˆ\u0026amp;emptyï¼‰; // ç©ºæ§½æ•°é‡åŠ 1  consumeï¼ˆitemï¼‰; // æ¶ˆè´¹  } } ä»¥ä¸Šå±•ç¤ºäº†ä¿¡å·é‡çš„ä¸¤ç§ç”¨æ³•ï¼šmutexç”¨äºäº’æ–¥ï¼Œä¿è¯ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹è¯»å†™ç¼“å†²åŒºä¸­çš„å˜é‡ï¼Œè€Œemptyå’Œfullç”¨äºåŒæ­¥ï¼Œä¿è¯æŸäº›äº‹ä»¶çš„é¡ºåºå‘ç”Ÿæˆ–ä¸å‘ç”Ÿã€‚\näº’æ–¥é‡ å¦‚æœä¸éœ€è¦ä¿¡å·é‡çš„è®¡æ•°èƒ½åŠ›ï¼Œæœ‰æ—¶å€™å¯ä»¥ä½¿ç”¨ä¿¡å·é‡çš„ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬ï¼Œç§°ä¸ºäº’æ–¥é‡ï¼ˆmutexï¼‰ã€‚äº’æ–¥é‡ä»…é€‚ç”¨äºç®¡ç†ä¸€äº›å…±äº«èµ„æºæˆ–ä¸€å°æ®µä»£ç ã€‚å®ƒæ˜¯ä¸€ä¸ªåªæœ‰å¯èƒ½å¤„äºä¸¤ç§çŠ¶æ€ä¸­çš„ä¸€ç§çš„å˜é‡ï¼šè§£é”å’ŒåŠ é”ã€‚\nå½“ä¸€ä¸ªè¿›ç¨‹éœ€è¦è®¿é—®ä¸´ç•ŒåŒºæ—¶ï¼Œå®ƒè°ƒç”¨mutex_lockã€‚è‹¥mutexä¸º0ï¼Œè¡¨ç¤ºä¸´ç•ŒåŒºå†…æ— è¿›ç¨‹ï¼Œåˆ™è¿›å…¥ä¸´ç•ŒåŒºï¼›è‹¥mutexä¸º1ï¼Œè¡¨ç¤ºå½“å‰ä¸´ç•ŒåŒºå†…æœ‰è¿›ç¨‹ï¼Œè°ƒç”¨çº¿ç¨‹å°†è¢«é˜»å¡ï¼Œç›´åˆ°ä¸´ç•ŒåŒºä¸­çš„è¿›ç¨‹å®Œæˆå¹¶è°ƒç”¨mutex_unlocké‡Šæ”¾é”ã€‚å¦‚æœå¤šä¸ªè¿›ç¨‹åœ¨è¯¥äº’æ–¥é‡ä¸Šé˜»å¡ï¼Œå°†éšæœºé€‰æ‹©ä¸€ä¸ªè¿›ç¨‹å¹¶å…è®¸å®ƒè·å¾—é”ã€‚\nmutex_lock: TSL REGISTER,MUTEX | å…ˆå°†mutexçš„å€¼å¤åˆ¶åˆ°GEGISTERï¼Œç„¶åå°†mutexç½®ä¸º1 CMP REGISTER,#0 | æ£€æŸ¥REGISTERä¸­çš„å€¼æ˜¯å¦ä¸º0  JZE ok | è‹¥ä¸º0ï¼Œè¡¨ç¤ºæœªä¸Šé”ï¼ŒæˆåŠŸè·å¾—é”ï¼Œè¿”å› CALL thread_yield | è‹¥é0ï¼Œè°ƒåº¦å¦ä¸€ä¸ªçº¿ç¨‹è¿è¡Œ JMP mutex_lock | ç¨åé‡è¯• ok: RET | è¿”å›ï¼Œè¿›å…¥ä¸´ç•ŒåŒº mutex_unlock: MOVE REGISTER,#0 | å°†mutexç½®ä¸º0  RET | é‡Šæ”¾é”ï¼Œè¿”å› è¿™æ®µä»£ç ä¸ä¹‹å‰é‡‡ç”¨åŸºäºTSLçš„ç¡¬ä»¶è§£å†³æ–¹æ¡ˆä¸­çš„enter_regionçš„ä»£ç å¾ˆç›¸ä¼¼ï¼Œä½†æœ‰ä¸€ä¸ªå…³é”®åŒºåˆ«ï¼šå½“enter_regionè¿›å…¥ä¸´ç•ŒåŒºå¤±è´¥æ—¶ï¼Œå®ƒå§‹ç»ˆè‡ªæ—‹ç­‰å¾…ï¼›è€Œmutex_lockåœ¨è·å–é”å¤±è´¥æ—¶ï¼Œå®ƒè°ƒç”¨thread_yieldè®©å‡ºCPUçš„ä½¿ç”¨æƒï¼Œè¿™æ ·å°±æ²¡æœ‰å¿™ç­‰å¾…ã€‚å½“è¯¥è¿›ç¨‹å†æ¬¡è·å¾—CPUæ—¶ï¼Œå®ƒå°†å†æ¬¡å°è¯•è·å–é”ã€‚\nç®¡ç¨‹ ç®¡ç¨‹ï¼ˆmonitorï¼‰ æ˜¯ä¸€ç§é«˜çº§åŒæ­¥åŸè¯­ã€‚ä¸€ä¸ªç®¡ç¨‹æ˜¯ä¸€ä¸ªç”±è¿‡ç¨‹ã€å˜é‡ã€æ•°æ®ç»“æ„ç­‰ç»„æˆçš„ä¸€ä¸ªé›†åˆï¼Œä»–ä»¬ç»„æˆä¸€ä¸ªç‰¹æ®Šçš„æ¨¡å—æˆ–è½¯ä»¶åŒ…ã€‚è¿›ç¨‹å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„æ—¶å€™è°ƒç”¨ç®¡ç¨‹ä¸­çš„è¿‡ç¨‹ï¼Œä½†ä»–ä»¬ä¸èƒ½åœ¨ç®¡ç¨‹ä¹‹å¤–å£°æ˜çš„è¿‡ç¨‹ä¸­ç›´æ¥è®¿é—®ç®¡ç¨‹å†…çš„æ•°æ®ç»“æ„ã€‚\nç®¡ç¨‹æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ï¼Œå³ä»»ä¸€æ—¶åˆ»ç®¡ç¨‹ä¸­åªèƒ½æœ‰ä¸€ä¸ªæ´»è·ƒè¿›ç¨‹ï¼Œè¿™ä¸€ç‰¹æ€§ä½¿ç®¡ç¨‹èƒ½å¤Ÿæœ‰æ•ˆåœ°å®Œæˆäº’æ–¥ã€‚ç®¡ç¨‹æ˜¯ç¼–ç¨‹è¯­è¨€çš„ç»„æˆéƒ¨åˆ†ï¼Œè¿›å…¥ç®¡ç¨‹æ—¶çš„äº’æ–¥ç”±ç¼–è¯‘å™¨å®Œæˆï¼ŒCè¯­è¨€å¹¶ä¸æ”¯æŒç®¡ç¨‹ï¼Œè€ŒJavaæ”¯æŒç®¡ç¨‹ã€‚\næ¶ˆæ¯ä¼ é€’ æ¶ˆæ¯ä¼ é€’ï¼ˆmessage passingï¼‰ æ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡çš„æ–¹æ³•ï¼Œå®ƒä½¿ç”¨äº†ä¸¤æ¡åŸè¯­ï¼šsendå’Œreceiveã€‚sendç»™æ¥æ”¶æ–¹å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè€Œreceiveä»å‘é€æ–¹æ¥æ”¶ä¸€æ¡æ¶ˆæ¯ã€‚å¦‚æœæ²¡æœ‰æ¶ˆæ¯å¯ç”¨ï¼Œæ¥æ”¶æ–¹å¯èƒ½ä¼šé˜»å¡ç›´åˆ°æ¶ˆæ¯åˆ°è¾¾ï¼Œä¹Ÿå¯èƒ½å¸¦ä¸€ä¸ªé”™è¯¯ç ç«‹å³è¿”å›ã€‚\nä¸ºäº†é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹å¯ä»¥è¾¾æˆä»¥ä¸‹åè®®ï¼šä¸€æ—¦æ”¶åˆ°æ¶ˆæ¯ï¼Œæ¥æ”¶æ–¹é©¬ä¸Šä¼šé€ä¸€æ¡ç¡®è®¤æ¶ˆæ¯ã€‚å¦‚æœå‘é€æ–¹åœ¨ä¸€å®šæ—¶é—´å†…æœªæ”¶åˆ°ç¡®è®¤ï¼Œåˆ™é‡ä¼ è¯¥æ¶ˆæ¯ã€‚\nå±éšœ åœ¨æœ‰äº›åº”ç”¨ä¸­åˆ’åˆ†äº†è‹¥å¹²é˜¶æ®µï¼Œå¹¶ä¸”è§„å®šï¼Œé™¤éæ‰€æœ‰çš„è¿›ç¨‹éƒ½å‡†å¤‡å¥½è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼Œå¦åˆ™ä»»ä½•è¿›ç¨‹éƒ½ä¸èƒ½è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚å¯ä»¥é€šè¿‡åœ¨æ¯ä¸ªé˜¶æ®µçš„ç»“å°¾æ”¾ç½® å±éšœï¼ˆbarrierï¼‰ æ¥å®ç°è¿™ç§è¡Œä¸ºã€‚å½“ä¸€ä¸ªè¿›ç¨‹åˆ°è¾¾å±éšœï¼Œå®ƒä¼šè¢«å±éšœé˜»æ‹¦ï¼Œç›´åˆ°æ‰€æœ‰è¿›ç¨‹éƒ½åˆ°è¾¾è¯¥å±éšœæ‰ä¸€å¹¶æ”¾è¡Œã€‚å±éšœå¯ç”¨äºä¸€ç»„çº¿ç¨‹çš„åŒæ­¥ã€‚\né¿å…é”ï¼šè¯»-å¤åˆ¶-æ›´æ–° æœ€å¿«çš„é”å°±æ˜¯æ ¹æœ¬æ²¡æœ‰é”ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å…è®¸å†™æ“ä½œæ›´æ–°æ•°æ®ç»“æ„ï¼Œå³ä¾¿è¿˜æœ‰è¿›ç¨‹æ­£åœ¨ä½¿ç”¨å®ƒã€‚å…³é”®åœ¨äºç¡®ä¿æ¯ä¸ªè¯»æ“ä½œè¦ä¹ˆè¯»å–æ•°æ®çš„æ—§ç‰ˆæœ¬ï¼Œè¦ä¹ˆè¯»å–æ•°æ®çš„æ–°ç‰ˆæœ¬ï¼Œç»ä¸èƒ½æ˜¯æ–°æ—§ç‰ˆæœ¬æ•°æ®çš„ç»„åˆã€‚\nè¿›ç¨‹è°ƒåº¦ å½“ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶ç«äº‰ä¸€ä¸ª CPU æ—¶ï¼Œå¿…é¡»é€‰æ‹©å‡ºä¸€ä¸ªè¿›ç¨‹è®©å…¶è·å¾— CPUã€‚åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œå®Œæˆé€‰æ‹©å·¥ä½œçš„ç»„ä»¶è¢«ç§°ä¸º è°ƒåº¦ç¨‹åºï¼ˆschedulerï¼‰ï¼Œè°ƒåº¦ç¨‹åºå¯èƒ½æ ¹æ®å®é™…æƒ…å†µé‡‡ç”¨ä¸åŒçš„è°ƒåº¦ç®—æ³•ã€‚\næœ‰äº›è¿›ç¨‹ä¼šå°†ç»å¤§å¤šæ•°æ—¶é—´èŠ±åœ¨è®¡ç®—ä¸Šï¼Œè€Œæœ‰äº›è¿›ç¨‹ä¼šè¢«å¤§å¤šæ•°æ—¶é—´èŠ±åœ¨ I/O ä¸Šã€‚å‰è€…ç§°ä¸ºè®¡ç®—å¯†é›†å‹ï¼ˆcomputed-boundï¼‰ï¼Œåè€…ç§°ä¸ºI/O å¯†é›†å‹ï¼ˆI/O-boundï¼‰ï¼š\nè°ƒåº¦çš„ä¸€ä¸ªå…³é”®é—®é¢˜å°±æ˜¯åˆé€‚è¿›è¡Œè°ƒåº¦ï¼Œæœ‰å¤šç§æƒ…å½¢éœ€è¦è°ƒåº¦ã€‚ä¾‹å¦‚ï¼š\n åœ¨åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ä¹‹åï¼Œæ˜¯è¿è¡Œçˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹ã€‚ å½“ä¸€ä¸ªè¿›ç¨‹é€€å‡ºæ—¶ï¼Œå¿…é¡»ä»å°±ç»ªè¿›ç¨‹ä¸­é€‰å–ä¸€ä¸ªè¿è¡Œã€‚å¦‚æœæ²¡æœ‰å°±ç»ªè¿›ç¨‹ï¼Œé€šå¸¸ä¼šè¿è¡Œä¸€ä¸ªç³»ç»Ÿæä¾›çš„ç©ºé—²è¿›ç¨‹ã€‚ å½“ä¸€ä¸ªè¿›ç¨‹ç”±äº I/O æˆ–å…¶å®ƒåŸå› é˜»å¡æ—¶ï¼Œéœ€è¦é€‰æ‹©å¦ä¸€ä¸ªè¿›ç¨‹è¿è¡Œã€‚ å½“ä¸€ä¸ª I/O ä¸­æ–­å‘ç”Ÿæ—¶ï¼Œå¿…é¡»åšå‡ºè°ƒåº¦å†³ç­–ã€‚  è°ƒåº¦ç®—æ³• æ ¹æ®æ—¶é’Ÿä¸­æ–­æ—¶åšå‡ºçš„è°ƒåº¦å†³ç­–ï¼Œå¯ä»¥å°†è°ƒåº¦ç®—æ³•åˆ†ä¸ºä¸¤ç±»ï¼šéæŠ¢å å¼è°ƒåº¦ç®—æ³•æŒ‘é€‰ä¸€ä¸ªè¿›ç¨‹ï¼Œç„¶åè®©è¯¥è¿›ç¨‹è¿è¡Œè‡³é˜»å¡ï¼Œæˆ–è€…ç›´åˆ°è¯¥è¿›ç¨‹è‡ªåŠ¨é‡Šæ”¾CPUï¼Œè¯¥è¿›ç¨‹ä¸ä¼šè¢«å¼ºè¿«æŒ‚èµ·ã€‚æŠ¢å å¼è°ƒåº¦ç®—æ³•æŒ‘é€‰ä¸€ä¸ªè¿›ç¨‹ï¼Œè®©è¯¥è¿›ç¨‹è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œå¦‚æœæ—¶é—´åˆ°äº†ä¸”è¯¥è¿›ç¨‹ä»åœ¨è¿è¡Œï¼Œåˆ™å°†å®ƒæŒ‚èµ·å¹¶è¿è¡Œå…¶å®ƒå°±ç»ªè¿›ç¨‹ã€‚æŠ¢å å¼è°ƒåº¦ç®—æ³•ä¾èµ–æ—¶é’Ÿä¸­æ–­ï¼Œä»¥ä¾¿è°ƒåº¦ç¨‹åºèƒ½å¤Ÿè·å¾—CPUçš„æ§åˆ¶æƒã€‚\nè°ƒåº¦ç®—æ³•çš„ç›®æ ‡ å¯¹äºä¸åŒçš„æ“ä½œç³»ç»Ÿç¯å¢ƒï¼Œé‡‡å–çš„è°ƒåº¦ç®—æ³•ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œå¸¸è§çš„ç¯å¢ƒæœ‰ï¼šæ‰¹å¤„ç†ç³»ç»Ÿã€äº¤äº’å¼ç³»ç»Ÿã€å®æ—¶ç³»ç»Ÿã€‚ä¸ºäº†è®¾è®¡è°ƒåº¦ç®—æ³•ï¼Œæˆ‘ä»¬æœ‰å¿…è¦è€ƒè™‘ä»€ä¹ˆæ˜¯ä¸€ä¸ªå¥½çš„è°ƒåº¦ç®—æ³•ã€‚æŸäº›ç›®æ ‡å–å†³äºæ“ä½œç¯å¢ƒï¼Œè€ŒæŸäº›ç›®æ ‡åˆæ˜¯é€šç”¨çš„ã€‚\nåœ¨æ‰€æœ‰çš„æƒ…å½¢ä¸­ï¼Œå…¬å¹³æ˜¯å¾ˆé‡è¦çš„ã€‚ç›¸ä¼¼çš„è¿›ç¨‹åº”è¯¥å¾—åˆ°ç›¸è¿‘çš„å¯¹å¾…ï¼Œç»™å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹æ›´å¤šçš„ CPU ä»½é¢æ˜¯ä¸å…¬å¹³çš„ã€‚æ“ä½œç³»ç»Ÿå¯èƒ½éœ€è¦å¼ºåˆ¶æ–½è¡ŒæŸäº›ç­–ç•¥ä»¥ä¿è¯å…¬å¹³æ€§ã€‚å¦ä¸€ä¸ªå…±åŒç›®æ ‡æ˜¯ä¿æŒç³»ç»Ÿçš„æ‰€æœ‰éƒ¨åˆ†å°½å¯èƒ½åœ°å¿™ç¢Œï¼Œå®Œæˆå°½å¯èƒ½å¤šçš„å·¥ä½œã€‚\nå¯¹äºæ‰¹å¤„ç†ç³»ç»Ÿï¼Œé€šå¸¸ä½¿ç”¨ä»¥ä¸‹ 3 ä¸ªæŒ‡æ ‡æ¥è¡¡é‡ç³»ç»Ÿçš„å·¥ä½œçŠ¶æ€ï¼š\n ååé‡ã€‚ååé‡æŒ‡ç³»ç»Ÿæ¯å°æ—¶å®Œæˆçš„ä½œä¸šæ•°é‡ã€‚ å‘¨è½¬æ—¶é—´ã€‚å‘¨è½¬æ—¶é—´æŒ‡ä»ä¸€ä¸ªæ‰¹å¤„ç†ä½œä¸šæäº¤åˆ°å®Œæˆçš„å¹³å‡æ—¶é—´ã€‚ CPU åˆ©ç”¨ç‡ã€‚CPU åˆ©ç”¨ç‡ç”¨æ¥è¡¡é‡ CPU çš„ç¹å¿™ç¨‹åº¦ã€‚  å¯¹äºäº¤äº’å¼ç³»ç»Ÿï¼Œæœ€é‡è¦çš„å°±æ˜¯æœ€å°å“åº”æ—¶é—´ï¼Œå³ä»å‘å‡ºå‘½ä»¤åˆ°å¾—åˆ°å“åº”ä¹‹é—´çš„æ—¶é—´ã€‚\nå®æ—¶ç³»ç»Ÿæœ‰ç€ä¸äº¤äº’å¼ç³»ç»Ÿä¸åŒçš„ç‰¹æ€§ï¼Œæ‰€ä»¥æœ‰ç€ä¸åŒçš„è°ƒåº¦ç›®æ ‡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå®æ—¶ç³»ç»Ÿæˆ–å¤šæˆ–å°‘éƒ½å¿…é¡»æ»¡è¶³æˆªæ­¢æ—¶é—´ã€‚ä½œä¸ºä¸€ç§ä»¥æ—¶é—´ä¸ºä¸»å¯¼çš„ç³»ç»Ÿï¼Œå®æ—¶ç³»ç»Ÿå¯ä»¥åˆ†ä¸º ç¡¬å®æ—¶ï¼ˆhard real timeï¼‰ å’Œ è½¯å®æ—¶ï¼ˆsoft real timeï¼‰ã€‚å‰è€…è¡¨ç¤ºä»»åŠ¡å¿…é¡»æ»¡è¶³ç»å¯¹çš„æˆªæ­¢æ—¶é—´ï¼Œè€Œåè€…èƒ½å¤Ÿå®¹å¿ä»»åŠ¡å¶å°”è¶…è¿‡æˆªæ­¢æ—¶é—´ã€‚\nå¸¸è§çš„è°ƒåº¦ç®—æ³• æ‰¹å¤„ç†ç³»ç»Ÿä¸­å¸¸ç”¨çš„è°ƒåº¦ç®—æ³•æœ‰ï¼šå…ˆæ¥å…ˆæœåŠ¡ï¼ˆfirst-come first-servedï¼‰ã€æœ€çŸ­ä½œä¸šä¼˜å…ˆï¼ˆshortest job firstï¼‰å’Œæœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆï¼ˆshortest remaining time nextï¼‰ã€‚\nè½®è½¬è°ƒåº¦ï¼ˆround robinï¼‰ï¼šæ¯ä¸ªè¿›ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä¸ºæ—¶é—´ç‰‡ï¼ˆquantumï¼‰ï¼Œå³å…è®¸è¯¥è¿›ç¨‹åœ¨è¯¥æ—¶é—´ç‰‡å†…è¿è¡Œã€‚å¦‚æœåœ¨æ—¶é—´ç‰‡ç»“æŸæ—¶è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œå°†å‰¥å¤ºCPUå¹¶åˆ†é…ç»™å¦å¤–ä¸€ä¸ªè¿›ç¨‹ã€‚å¦‚æœè¯¥è¿›ç¨‹åœ¨æ—¶é—´ç‰‡ç»“æŸå‰é˜»å¡æˆ–ç»“æŸï¼ŒCPUä¹Ÿä¼šç«‹å³åˆ‡æ¢ã€‚æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ä¸­çš„æ—¶é—´ç‰‡å¤§å°å¾ˆé‡è¦ã€‚ä»ä¸€ä¸ªè¿›ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹æ˜¯éœ€è¦ä¸€å®šæ—¶é—´çš„â€”â€”ä¿å­˜å’Œè½½å…¥å¯„å­˜å™¨å€¼åŠå†…å­˜æ˜ åƒã€æ›´æ–°å„ç§è¡¨æ ¼å’Œåˆ—è¡¨ã€æ¸…é™¤å’Œé‡æ–°è°ƒå…¥ç¼“å­˜ç­‰ã€‚è¿›ç¨‹åˆ‡æ¢ï¼ˆprocess switchï¼‰ æœ‰æ—¶å€™ä¹Ÿç§° ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆcontext switchï¼‰ã€‚æ—¶é—´ç‰‡å¤ªçŸ­å®¹æ˜“å¯¼è‡´è¿‡å¤šçš„è¿›ç¨‹åˆ‡æ¢ï¼Œé™ä½CPUæ•ˆç‡ï¼›è€Œæ—¶é—´ç‰‡å¤ªé•¿å¯èƒ½å¯¼è‡´çŸ­äº¤äº’è¯·æ±‚çš„å“åº”æ—¶é—´å˜é•¿ã€‚å°†æ—¶é—´ç‰‡è®¾ä¸º20~50msé€šå¸¸æ˜¯ä¸€ä¸ªåˆç†çš„æŠ˜ä¸­é€‰æ‹©ã€‚è½®è½¬è°ƒåº¦ä¸€èˆ¬ç”¨äºäº¤äº’å¼ç³»ç»Ÿã€‚\nä¼˜å…ˆçº§è°ƒåº¦ï¼šä¼˜å…ˆçº§è°ƒåº¦çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šç»™æ¯ä¸ªè¿›ç¨‹æŒ‡å®šä¸€ä¸ªä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§è¶Šé«˜çš„è¿›ç¨‹è¶Šå…ˆè¿è¡Œã€‚è€Œè½®è½¬è°ƒåº¦ä¸­çš„æ¯ä¸ªè¿›ç¨‹çš„ä¼˜å…ˆçº§æ˜¯ä¸€æ ·çš„ã€‚\nOSTEP çš„è¯»ä¹¦ç¬”è®°ä¸­æœ‰æ›´å¤šçš„è°ƒåº¦ç®—æ³•ï¼Œè§ è¿›ç¨‹è°ƒåº¦ã€‚\nå‚è€ƒèµ„æ–™  ANDREW S. TANENBAUM, HERBERT BOS. Modern Operating Systems, 4th Edition. Pearson, 2015. Critical section.  ","href":"/operating_systems/processes_and_threads/","title":"è¿›ç¨‹ä¸çº¿ç¨‹"},{"content":"åœ¨å¤šé“ç¨‹åºè®¾è®¡ç¯å¢ƒä¸­ï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½ä¼šäº‰å¤ºæœ‰é™çš„èµ„æºã€‚çº¿ç¨‹å…ˆè¯·æ±‚èµ„æºï¼Œè‹¥è¯·æ±‚ä¸èƒ½è¢«ç«‹å³æ»¡è¶³ï¼Œçº¿ç¨‹å°±ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚æœ‰æ—¶å€™ï¼Œä¸¤ä¸ªçº¿ç¨‹å„è‡ªæŒæœ‰ä¸åŒçš„èµ„æºå¹¶ç­‰å¾…å¯¹æ–¹æ‰€æŒæœ‰çš„èµ„æºï¼Œè¿™ç§æƒ…å†µå¯èƒ½å¯¼è‡´ æ­»é”(deadlock)ã€‚æ­»é”çš„å®šä¹‰ä¸ºï¼ševery process in a set of processes is waiting for an event that can be caused only by another process in the setã€‚è™½ç„¶å®šä¹‰ä¸­ä½¿ç”¨äº†è¿›ç¨‹ï¼Œä½†è¿™ä¹Ÿé€‚ç”¨äºçº¿ç¨‹ã€‚\nèµ„æº å¤§éƒ¨åˆ†æ­»é”æ˜¯ç”±çº¿ç¨‹æ— æ³•è·å¾—äº’æ–¥èµ„æºå¼•èµ·çš„ï¼Œè¿™äº›èµ„æºå¯ä»¥æ˜¯å„ç§ç¡¬ä»¶è®¾å¤‡(å¦‚æ‰“å°æœº)ã€ä¹Ÿå¯ä»¥æ˜¯ä¸€æ®µä¿¡æ¯(å¦‚æ•°æ®åº“å†…çš„è®°å½•)ã€‚èµ„æºç§ç±»ç¹å¤šï¼Œä¸€ç±»èµ„æºå¯ä»¥å…·æœ‰è‹¥å¹²å®ä¾‹ï¼Œä»»ä½•ä¸€ä¸ªå®ä¾‹éƒ½å¯ä»¥æ»¡è¶³å¯¹è¯¥ç±»èµ„æºçš„è¯·æ±‚ã€‚ç®€è€Œè¨€ä¹‹ï¼Œèµ„æº(resource) å°±æ˜¯ä»»ä½•èƒ½å¤Ÿè¢«è·å–ã€ä½¿ç”¨å¹¶æœ€ç»ˆé‡Šæ”¾çš„ä¸œè¥¿ã€‚çº¿ç¨‹åœ¨ä½¿ç”¨æŸä¸ªèµ„æºå‰å¿…é¡»å…ˆè¯·æ±‚è¯¥èµ„æºï¼Œå¹¶ä¸”å¿…é¡»åœ¨ä½¿ç”¨å®Œä¹‹åé‡Šæ”¾å®ƒã€‚å¾ˆæ˜æ˜¾ï¼Œçº¿ç¨‹æ‰€è¯·æ±‚çš„èµ„æºæ•°é‡ä¸å¾—è¶…è¿‡ç³»ç»Ÿå†…èµ„æºçš„æ€»é‡ã€‚\nèµ„æºå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šå¯æŠ¢å çš„(preemptable) å’Œ ä¸å¯æŠ¢å çš„(nonpreepmptable)ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ­»é”å’Œä¸å¯æŠ¢å èµ„æºæœ‰å…³ã€‚å¯æŠ¢å èµ„æºä¸­æ½œåœ¨çš„æ­»é”å¯ä»¥é€šè¿‡èµ„æºçš„é‡åˆ†é…æ¥åŒ–è§£ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå’Œä½¿ç”¨èµ„æºæœ‰å…³çš„äº‹ä»¶å¦‚ä¸‹ï¼š\n è¯·æ±‚ã€‚çº¿ç¨‹è¯·æ±‚èµ„æºï¼Œè‹¥è¯·æ±‚ä¸èƒ½è¢«ç«‹å³æ»¡è¶³ï¼Œçº¿ç¨‹å¿…é¡»ç­‰å¾…ã€‚ ä½¿ç”¨ã€‚çº¿ç¨‹åœ¨èµ„æºä¸Šæ‰§è¡ŒæŸäº›æ“ä½œã€‚ é‡Šæ”¾ã€‚çº¿ç¨‹é‡Šæ”¾èµ„æºã€‚  èµ„æºçš„è¯·æ±‚å’Œé‡Šæ”¾å¯èƒ½æ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆçš„ã€‚ä¾‹å¦‚ï¼ŒæŸäº›ç³»ç»Ÿå¯èƒ½æä¾›äº†è¯¸å¦‚request()/release()ã€open()/close()æˆ–wait()/signal()ä¸€ç±»çš„ç³»ç»Ÿè°ƒç”¨ã€‚å¯¹äºè¢«å†…æ ¸ç®¡ç†çš„èµ„æºï¼Œæ“ä½œç³»ç»Ÿä¼šç»´æŠ¤ä¸€å¼ ç³»ç»Ÿè¡¨ï¼Œè¡¨ä¸­è®°å½•äº†æ¯ä¸ªèµ„æºæ˜¯ç©ºé—²çš„è¿˜æ˜¯å·²åˆ†é…çš„(è¿˜ä¼šè®°å½•èµ„æºè¢«åˆ†é…ç»™äº†å“ªä¸ªçº¿ç¨‹)ã€‚å¦‚æœçº¿ç¨‹è¯·æ±‚çš„èµ„æºå·²å°†è¢«åˆ†é…ç»™å…¶å®ƒçº¿ç¨‹ï¼Œå°±å°†å®ƒåŠ å…¥åˆ°å¯¹åº”èµ„æºçš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚\næ­»é”çš„ç‰¹å¾ æ­»é”çš„å¿…è¦æ¡ä»¶ å½“ä»¥ä¸‹å››ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶ï¼Œå°±ä¼šå‡ºç°æ­»é”ï¼š\n äº’æ–¥(Mutual exclusion)ã€‚èµ„æºè¦ä¹ˆå› å…¶å·²è¢«åˆ†é…ç»™æŸä¸ªçº¿ç¨‹è€Œä¸å¯ç”¨ï¼Œè¦ä¹ˆå°±æ˜¯å¯ç”¨çš„ã€‚ å æœ‰å¹¶ç­‰å¾…(Hold and wait)ã€‚çº¿ç¨‹æŒæœ‰è‡³å°‘ä¸€ä¸ªèµ„æºå¹¶ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ­£æŒæœ‰çš„èµ„æºã€‚ éæŠ¢å (No preemption)ã€‚åœ¨æŒæœ‰èµ„æºçš„çº¿ç¨‹å®Œæˆå‰ï¼Œè¯¥èµ„æºä¸å¯è¢«å…¶å®ƒçº¿ç¨‹æŠ¢å ã€‚ å¾ªç¯ç­‰å¾…(Circular wait)ã€‚ä¸€ç»„çº¿ç¨‹å½¢æˆç­‰å¾…ç¯è·¯ï¼Œç¯è·¯ä¸­çš„æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„èµ„æºã€‚  è™½ç„¶æ­»é”åªæœ‰åœ¨ä»¥ä¸Šå››ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶æ‰ä¼šå‡ºç°ï¼Œä½†è¿™å››ä¸ªæ¡ä»¶å¹¶ä¸æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚ä¾‹å¦‚ï¼Œå¾ªç¯ç­‰å¾…æ¡ä»¶æš—ç¤ºäº†å æœ‰å¹¶ç­‰å¾…æ¡ä»¶ã€‚\nèµ„æºåˆ†é…å›¾ ç³»ç»Ÿèµ„æºåˆ†é…å›¾(system resource-allocation graph, RAG) æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ï¼Œå®ƒå¯ä»¥ç²¾ç¡®çš„æè¿°æ­»é”ã€‚å®ƒç”±ä¸€ç»„é¡¶ç‚¹Vå’Œä¸€ç»„è¾¹Eæ„æˆï¼Œå…¶ä¸­ï¼ŒVåˆç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šç³»ç»Ÿä¸­çš„æ‰€æœ‰æ´»åŠ¨çº¿ç¨‹Tå’Œç³»ç»Ÿä¸­æ‰€æœ‰çš„èµ„æºç±»å‹R(æ³¨æ„æ˜¯èµ„æºç±»å‹è€Œä¸æ˜¯èµ„æºæ•°é‡)ï¼›Eæœ‰ä¸¤ç§ç±»å‹ï¼šrequest edgeå’Œassignment edgeï¼Œrequest edge $T_i \\to R_i$ è¡¨ç¤ºçº¿ç¨‹ $T_i$ è¯·æ±‚å¹¶ç­‰å¾…èµ„æº $R_j$ çš„å®ä¾‹ï¼Œè€Œassignment edge $R_j \\to T_i$ è¡¨ç¤ºçº¿ç¨‹ $T_i$ å·²ç»æŒæœ‰ä¸€ä¸ªèµ„æº $R_j$ çš„å®ä¾‹ã€‚ä¸ºäº†ä¾¿äºè¯†åˆ«ï¼Œæˆ‘ä»¬ç”¨åœ†å½¢è¡¨ç¤ºçº¿ç¨‹ï¼Œç”¨çŸ©å½¢è¡¨ç¤ºèµ„æºï¼Œåœ¨çŸ©å½¢å†…éƒ¨ç”¨ç‚¹è¡¨ç¤ºèµ„æºçš„å®ä¾‹ã€‚\nä¸Šå›¾å±•ç¤ºäº†è¿™æ ·ä¸€ä¸ªèµ„æºåˆ†é…æƒ…å†µã€‚ é›†åˆTã€Rã€Eï¼š\n $$T = {T_1, T_2, T_3}$$ $$R = {R_1, R_2, R_3, R_4}$$ $$E = {T_1 \\to R_1, T_2 \\to R_2, R_1 \\to T_2, R_2 \\to T_1, R_2 \\to T2, R_3 \\to T_3}$$  èµ„æºå®ä¾‹ï¼š\n 1ä¸ª $R_1$ å®ä¾‹ã€‚ 2ä¸ª $R_2$ å®ä¾‹ã€‚ 1ä¸ª $R_3$ å®ä¾‹ã€‚ 3ä¸ª $R_4$ å®ä¾‹ã€‚  çº¿ç¨‹çŠ¶æ€ï¼š\n çº¿ç¨‹ $T_1$ æŒæœ‰1ä¸ª $R_2$ å®ä¾‹å¹¶ç­‰å¾…ä¸€ä¸ª $R_1$ å®ä¾‹ã€‚ çº¿ç¨‹ $T_2$ æŒæœ‰1ä¸ª $R_1$ å®ä¾‹å’Œ1ä¸ª $R_2$ å®ä¾‹å¹¶ç­‰å¾…1ä¸ª $R_3$ å®ä¾‹ã€‚ çº¿ç¨‹ $T_3$ æŒæœ‰1ä¸ª $R_3$ å®ä¾‹ã€‚  å¦‚æœèµ„æºåˆ†é…å›¾ä¸­æ²¡æœ‰ç¯ï¼Œå°±è¯´æ˜çº¿ç¨‹ä¹‹é—´æ²¡æœ‰æ­»é”ï¼Œå¦åˆ™è¯´æ˜å¯èƒ½å­˜åœ¨æ­»é”ã€‚ç°åœ¨æ¥çœ‹æœ‰ç¯çš„æƒ…å†µï¼š\n å¦‚æœæ¯ç§èµ„æºéƒ½åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆå­˜åœ¨æ­»é”ã€‚ å¦‚æœç¯ä¸­åªåŒ…å«äº†èµ„æºç±»å‹çš„ä¸€ä¸ªå­é›†ï¼Œè‹¥å­é›†å†…çš„æ¯ç§èµ„æºåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆå­˜åœ¨æ­»é”ã€‚ å¦‚æœæ¯ç§èµ„æºæœ‰å¤šä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨æ­»é”ã€‚  ä¸‹é¢æ˜¯ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªç¯( $T_1 \\to R_1 \\to T_2 \\to R_3 \\to T_3 \\to R_2 \\to T_1 $ã€ $T_2 \\to R_3 \\to T_3 \\to R_2 \\to T_2$ )çš„èµ„æºåˆ†é…å›¾ã€‚çº¿ç¨‹ $T_1$ ã€ $T_2$ å’Œ $T_3$ æ­»é”äº†ï¼Œçº¿ç¨‹ $T_2$ åœ¨ç­‰ $T_3$ é‡Šæ”¾ $R_3$ ï¼Œè€Œ $T_3$ åœ¨ç­‰ $T_1$ æˆ– $T_2$ é‡Šæ”¾ $R_2$ ï¼Œ$T1$ ä¹Ÿåœ¨ç­‰ $T_2$ é‡Šæ”¾$R_1$ ã€‚\nåœ¨çœ‹ä¸‹é¢è¿™å¼ èµ„æºåˆ†é…å›¾ï¼Œè™½ç„¶å…¶ä¸­æœ‰ä¸€ä¸ªç¯( $T_1 \\to R_1 \\to T_2 \\to R_2 \\to T_1$ )ï¼Œä½†ä¸å­˜åœ¨æ­»é”ã€‚å› ä¸ºçº¿ç¨‹ $T_4$ å¯ä»¥é‡Šæ”¾ä¸€ä¸ªèµ„æº $R_2$ çš„å®ä¾‹ï¼Œ $T_3$ è·å¾—è¿™ä¸ªå®ä¾‹ä¹‹åå›¾ä¸­å°±ä¸å­˜åœ¨ç¯äº†ã€‚\næ­»é”çš„å¤„ç† ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬æœ‰å››ç§å¤„ç†æ­»é”çš„ç­–ç•¥ï¼š\n å¿½ç•¥æ­»é”ã€‚ ç ´åæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ä¹‹ä¸€ï¼Œé¢„é˜²æ­»é”çš„äº§ç”Ÿã€‚ è°¨æ…åˆ†é…èµ„æºï¼Œé¿å…æ­»é”çš„å‡ºç°ã€‚ æ£€æµ‹æ­»é”çš„å‘ç”Ÿå¹¶è®¾æ³•æ¢å¤ã€‚  é¸µé¸Ÿç®—æ³• é¸µé¸Ÿåœ¨é‡åˆ°å±é™©æ—¶ï¼Œä¼šå°†å¤´åŸ‹åœ¨æ²™å­é‡Œï¼Œå‡è£…çœ‹ä¸è§ã€‚è¿™æ˜¯æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œå³å¿½ç•¥æ­»é”ã€‚\næ­»é”é¢„é˜² æ­»é”è‹¥å‘ç”Ÿï¼Œå…¶å››ä¸ªå¿…è¦æ¡ä»¶å¿…é¡»åŒæ—¶æ»¡è¶³ã€‚å› æ­¤ï¼Œåªè¦èƒ½ç ´åæ­»é”å‘ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶ä¹‹ä¸€ï¼Œæˆ‘ä»¬å°±èƒ½é¢„é˜²æ­»é”ã€‚\nç ´åäº’æ–¥æ¡ä»¶ã€‚å› ä¸ºæ­»é”æ˜¯åœ¨è®¿é—®å…±äº«èµ„æºæ—¶å‘ç”Ÿçš„ï¼Œè‹¥èµ„æºä¸æ˜¯å…±äº«çš„ï¼Œé‚£å°±ä¸å¯èƒ½å‘ç”Ÿæ­»é”ã€‚å¦‚æœè®¿é—®å…±äº«èµ„æºæ—¶ä¸éœ€è¦äº’æ–¥(ä¾‹å¦‚åªè¯»æ–‡ä»¶)ï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿæ­»é”ã€‚\nç ´åå æœ‰å¹¶ç­‰å¾…æ¡ä»¶ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ç ´åå®ƒã€‚ä¸€ç§æ–¹æ³•æ˜¯åœ¨çº¿ç¨‹è¿è¡Œä¹‹å‰å°±ä¸ºå®ƒåˆ†é…å¥½éœ€è¦çš„æ‰€æœ‰èµ„æºï¼Œè¿™ä¸å¤ªå®ç”¨ï¼Œå› ä¸ºå¤§å¤šæ•°ç¨‹åºéƒ½æ˜¯åŠ¨æ€ç”³è¯·èµ„æºçš„ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯åªå…è®¸çº¿ç¨‹ä¸æŒæœ‰èµ„æºçš„æƒ…å†µä¸‹è¯·æ±‚èµ„æºã€‚ä»¥ä¸Šä¸¤ç§æ–¹æ³•éƒ½æœ‰ç¼ºé™·ï¼šèµ„æºçš„åˆ©ç”¨ç‡ä½ï¼Œè¿˜å¯èƒ½äº§ç”Ÿé¥¥é¥¿ç°è±¡ã€‚\nç ´åéæŠ¢å æ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå¹²ï¼šå¦‚æœçº¿ç¨‹åœ¨æŒæœ‰ä¸€äº›èµ„æºçš„æƒ…å†µä¸‹è¯·æ±‚å…¶å®ƒä¸èƒ½ç«‹å³å¾—åˆ°çš„èµ„æºï¼Œé‚£ä¹ˆè®©è¯¥çº¿ç¨‹å½“å‰æŒæœ‰çš„èµ„æºéƒ½å¯ä»¥è¢«æŠ¢å ã€‚æ¢å¥è¯è¯´ï¼Œçº¿ç¨‹å½“å‰æŒæœ‰çš„èµ„æºæ˜¯éšå¼é‡Šæ”¾äº†çš„ã€‚åŸçº¿ç¨‹å¯ä»¥åœ¨è¢«æŠ¢å çš„èµ„æºå½’è¿˜åé‡å¯ï¼Œå°±åƒè¿™äº›èµ„æºåˆšè¢«åˆ†é…ç»™å®ƒä¸€æ ·ã€‚\nå‰é¢ä¸‰ç§è§£å†³æ–¹æ¡ˆåœ¨å¤§å¤šæ•°æƒ…å½¢ä¸‹éƒ½ä¸å¤ªå®ç”¨ï¼Œæœ‰å¤šç§æ–¹æ³•å¯ä»¥ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ï¼Œå³é¿å…ç¯è·¯çš„å‡ºç°ã€‚ä¸€ç§æ–¹æ³•æ—¶ä¿è¯æ¯ä¸ªçº¿ç¨‹åœ¨ä»»ä½•æ—¶åˆ»åªèƒ½å ç”¨ä¸€ä¸ªèµ„æºï¼Œè‹¥è¦è¯·æ±‚å¦ä¸€ä¸ªèµ„æºï¼Œå°±å¿…é¡»é‡Šæ”¾å½“å‰æŒæœ‰çš„èµ„æºã€‚å¦ä¸€ç§æ–¹æ³•å°±æ˜¯å¯¹æ‰€æœ‰èµ„æºè¿›è¡Œç»Ÿä¸€ç¼–å·ï¼Œçº¿ç¨‹å¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»è¯·æ±‚èµ„æºï¼Œä½†æ‰€æœ‰çš„è¯·æ±‚å¿…é¡»æŒ‰ç…§èµ„æºç¼–å·çš„é¡ºåºæå‡ºï¼Œè¿™æ ·ä¸ä¼šå‡ºç°ç¯è·¯ã€‚åœ¨ä»»ä½•æ—¶å€™ï¼Œæ€»æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å·²åˆ†é…èµ„æºä¸­ç¼–å·æœ€å¤§çš„é‚£ä¸ªèµ„æº(å¦‚æœæœ‰èµ„æºè¢«åˆ†é…çš„è¯)ï¼Œè¿™ä¸ªçº¿ç¨‹ä¸èƒ½è¯·æ±‚å…¶å®ƒå·²åˆ†é…çš„å„ç§èµ„æº(ç¼–å·è‚¯å®šéƒ½å°äºå®ƒæŒæœ‰çš„é‚£ä¸ªæœ€å¤§ç¼–å·)ï¼Œå®ƒè¦ä¹ˆæ‰§è¡Œå®Œæ¯•ï¼Œè¦ä¹ˆå»è¯·æ±‚ç¼–å·æ›´é«˜çš„èµ„æº(æ€»æ˜¯å¯ç”¨çš„)ã€‚æœ€ç»ˆï¼Œå®ƒä¼šæ‰§è¡Œå®Œå¹¶é‡Šæ”¾å æœ‰çš„èµ„æºï¼Œè¿™æ˜¯å…¶å®ƒçš„çº¿ç¨‹ä¹Ÿå¯ä»¥ä»¥åŒæ ·çš„æ–¹å¼æ‰§è¡Œå®Œã€‚\næ­»é”é¿å… æ­»é”é¿å…ç®—æ³•é€šè¿‡åŠ¨æ€æ£€æŸ¥èµ„æºçš„åˆ†é…çŠ¶æ€æ¥ç¡®ä¿ä¸ä¼šå‘ç”Ÿå¾ªç¯ç­‰å¾…ã€‚èµ„æºåˆ†é…çŠ¶æ€åŒ…æ‹¬èµ„æºçš„å¯ç”¨æ•°é‡ã€å·²åˆ†é…æ•°é‡åŠçº¿ç¨‹è¯·æ±‚çš„æ•°é‡ã€‚\nå®‰å…¨çŠ¶æ€ å¦‚æœç³»ç»ŸæŒ‰ç…§æŸç§é¡ºåºä¸ºæ¯çº¿ç¨‹åˆ†é…èµ„æºï¼Œå¯ä»¥ä½¿å¾—æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½æ‹¿åˆ°èµ„æºå¹¶æ‰§è¡Œå®Œæˆï¼Œé‚£ä¹ˆè¿™æ ·çš„èµ„æºåˆ†é…é¡ºåºå°±æ˜¯å®‰å…¨åºåˆ—(safe sequence)ã€‚åªè¦ç³»ç»Ÿä¸­å­˜åœ¨è‡³å°‘ä¸€ä¸ªå®‰å…¨åºåˆ—ï¼Œç³»ç»Ÿå°±å¤„äºå®‰å…¨çŠ¶æ€(safe state)ã€‚åä¹‹ï¼Œç³»ç»Ÿå¤„äºä¸å®‰å…¨çŠ¶æ€ï¼Œå¯èƒ½å‡ºç°æ­»é”ã€‚è‹¥çº¿ç¨‹åºåˆ— $\u0026lt;T_1, T_2, \u0026hellip;, T_n\u0026gt;$ æ˜¯ä¸€ä¸ªå®‰å…¨åºåˆ—ï¼Œé‚£ä¹ˆå¯¹äºçº¿ç¨‹ $T_i$ è€Œè¨€ï¼Œ $T_i$ è¯·æ±‚çš„èµ„æºæ•°é‡ä¸å¤§äºå½“å‰å¯ç”¨èµ„æºåŠ ä¸Šæ‰€æœ‰ $T_j(j \u0026lt; i)$ çº¿ç¨‹æ‰€å ç”¨çš„èµ„æºä¹‹å’Œ(å½“ $T_j$ æ‰§è¡Œå®Œæˆåï¼Œä¼šé‡Šæ”¾å…¶å ç”¨çš„èµ„æº)ã€‚\nèµ„æºåˆ†é…å›¾ç®—æ³• åœ¨æ¯ç§ç±»å‹çš„èµ„æºéƒ½åªæœ‰ä¸€ä¸ªå®ä¾‹çš„å‰æä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨RAGæ¥é¿å…æ­»é”çš„å‡ºç°ã€‚å…·ä½“åšæ³•æ˜¯ï¼šå¼•å…¥ä¸€ç§æ–°çš„è¾¹â€”â€”claim edgeã€‚claim edge $T_i \\to R_j$ è¡¨ç¤ºçº¿ç¨‹ $T_i$ åœ¨å°†æ¥å¯èƒ½ä¼šè¯·æ±‚èµ„æº $R_j$ (claim edgeåœ¨RAGä¸­ç”¨è™šçº¿è¡¨ç¤º)ã€‚å½“çº¿ç¨‹ $T_i$ è¯·æ±‚èµ„æº $R_j$ æ—¶ï¼Œå°±å°†claim edge $T_i \\to R_j$ è½¬åŒ–ä¸ºrequest edge $T_i \\to R_j$ ï¼›å½“èµ„æº $R_j$ è¢«çº¿ç¨‹ $T_i$ é‡Šæ”¾æ—¶ï¼Œå°±å°†assignment edge $R_j \\to T_i$ è½¬åŒ–ä¸ºclaim edge $T_i \\to R_j$ ã€‚\nä¸ºäº†ä½¿RAGç®—æ³•æ­£ç¡®å·¥ä½œï¼Œåªæœ‰åœ¨çº¿ç¨‹çš„æ‰€æœ‰claim edgeè¢«æ·»åŠ åˆ°RAGä¸­ä¹‹åï¼Œè¯¥çº¿ç¨‹æ‰èƒ½è¢«å…è®¸è¯·æ±‚èµ„æºã€‚æˆ–è€…ï¼Œçº¿ç¨‹å¯ä»¥è¯·æ±‚å·²ç»è®¾ç½®å¥½çš„claim edgeè¾¹å…³è”çš„èµ„æºï¼Œå¹¶ä¸”ä¸å…è®¸åœ¨çº¿ç¨‹æŒæœ‰èµ„æºçš„æƒ…å†µä¸‹æ·»åŠ claim edgeåˆ°RAGã€‚claim edgeå®é™…ä¸Šèµ·åˆ°äº†å»¶è¿ŸRAGä¸­ç¯è·¯å‡ºç°ä½œç”¨ã€‚\nä¸ºäº†æ›´å¥½çš„è¯´æ˜RAGç®—æ³•ï¼Œè€ƒè™‘ä¸‹å›¾ï¼Œå‡è®¾çº¿ç¨‹ $T_1$ è¯·æ±‚èµ„æº $R_2$ ï¼Œå°½ç®¡ $R_2$ å½“å‰æœªè¢«å ç”¨ï¼Œä½†æˆ‘ä»¬ä¹Ÿä¸èƒ½æŠŠå®ƒåˆ†é…ç»™ $T_1$ ã€‚å› ä¸ºè¿™ä¸ªä¸¾åŠ¨å°†å¯¼è‡´RAGä¸­å‡ºç°ç¯è·¯ï¼Œç³»ç»Ÿå°†è¿›å…¥ä¸å®‰å…¨çŠ¶æ€ã€‚å¦‚æœ $T_2$ è¯·æ±‚ $R_2$ ï¼Œå¹¶ä¸” $T_1$ è¯·æ±‚ $R_1$ ï¼Œå°±ä¼šå‡ºç°æ­»é”ã€‚\né“¶è¡Œå®¶ç®—æ³• å½“èµ„æºæœ‰å¤šä¸ªå®ä¾‹æ—¶ï¼ŒRAGç®—æ³•å°±æ— æ³•ä½¿ç”¨äº†ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨é“¶è¡Œå®¶ç®—æ³•(banker\u0026rsquo;s algorithm)ã€‚ç®—æ³•è¦åšçš„å°±æ˜¯åˆ¤æ–­æ»¡è¶³çº¿ç¨‹çš„èµ„æºè¯·æ±‚æ˜¯å¦ä¼šå¯¼è‡´ç³»ç»Ÿè¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œè‹¥æ˜¯ï¼Œåˆ™æ‹’ç»è¯·æ±‚ï¼Œå¦åˆ™äºˆä»¥åˆ†é…ï¼Œç³»ç»Ÿç»§ç»­å¤„äºå®‰å…¨çŠ¶æ€ã€‚\nä¸ºäº†å®ç°é“¶è¡Œå®¶ç®—æ³•ï¼Œæˆ‘ä»¬éœ€è¦ç»´æŠ¤å‡ ä¸ªå’Œèµ„æºåˆ†é…çŠ¶æ€æœ‰å…³çš„æ•°æ®ç»“æ„ï¼Œå…¶ä¸­nä»£è¡¨çº¿ç¨‹æ•°ï¼Œmä»£è¡¨èµ„æºç§ç±»æ•°ï¼š\n Availableã€‚mç»´å‘é‡ï¼Œå…¶ä¸­Available[i]è¡¨ç¤ºèµ„æº $R_i$ çš„å¯ç”¨å®ä¾‹æ•°ã€‚ Maxã€‚n x mç»´çŸ©é˜µï¼Œå…¶ä¸­Max[i][j]è¡¨ç¤ºçº¿ç¨‹ $T_i$ å¯¹èµ„æº $R_j$ çš„æœ€å¤§éœ€æ±‚æ•°ã€‚ Allocationã€‚n x mç»´çŸ©é˜µï¼Œå…¶ä¸­Allocation[i][j]è¡¨ç¤ºçº¿ç¨‹ $T_i$ å½“å‰æŒæœ‰èµ„æº $R_j$ çš„å®ä¾‹æ•°ã€‚ Needã€‚n x mç»´çŸ©é˜µï¼Œå…¶ä¸­Need[i][j]è¡¨ç¤ºçº¿ç¨‹ $T_i$ è¦å®Œæˆå·¥ä½œè¿˜éœ€è¦çš„èµ„æº $R_j$çš„å®ä¾‹æ•°ã€‚æ³¨æ„ï¼šNeed[i][j] = Max[i][j] - Allocation[i][j]ã€‚  ä¸ºäº†ç®€åŒ–ç®—æ³•çš„è¡¨ç¤ºï¼Œæˆ‘ä»¬å®šä¹‰ï¼Œå¯¹äºé•¿åº¦ä¸ºnçš„å‘é‡Aå’Œå‘é‡Bï¼ŒA â‰¤ B if and only if A[i] â‰¤ B[i] for all i = 1,2,...,nã€‚\nå®‰å…¨æ€§ç®—æ³• ä¸ºäº†ä½¿ç”¨é“¶è¡Œå®¶ç®—æ³•ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å¤„äºå®‰å…¨çŠ¶æ€ã€‚æ£€æµ‹ç³»ç»Ÿæ˜¯å¦å¤„äºå®‰å…¨çŠ¶æ€çš„ç®—æ³•å¦‚ä¸‹ï¼š\n è®¾Workå’ŒFinishåˆ†åˆ«æ˜¯é•¿åº¦ä¸ºmå’Œnçš„å‘é‡ã€‚Workä¸ºå¯ç”¨èµ„æºçš„ä¸€ä¸ªå·¥ä½œå‰¯æœ¬ï¼Œå®ƒå¯ä»¥åœ¨åˆ†æè¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ï¼Œåˆå§‹å€¼ä¸ºAvailableã€‚Finishæ˜¯ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å‘é‡ï¼Œç”¨æ¥è¡¨ç¤ºæŸä¸ªçº¿ç¨‹æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œå®Œæˆï¼Œå…¶æ‰€æœ‰å…ƒç´ å‡åˆå§‹åŒ–ä¸ºfalseã€‚ æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³Finish[i] == false \u0026amp;\u0026amp; Need[i] â‰¤ Workçš„iã€‚æ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹è¿˜æœªå®Œæˆï¼Œä½†å¯ä»¥ä¸ºå…¶åˆ†é…èµ„æºã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„iï¼Œè·³è½¬åˆ°æ­¥éª¤4ã€‚ Work = Work + Allocation[i]ï¼ŒFinish[i] = trueã€‚è¿™è¡¨ç¤ºçº¿ç¨‹iæ‰§è¡Œå®Œæˆå¹¶å°†å…¶å ç”¨çš„èµ„æºå½’è¿˜åˆ°å·¥ä½œæ± ã€‚è·³è½¬åˆ°æ­¥éª¤2ã€‚ å¦‚æœæ‰€æœ‰çš„iéƒ½æ»¡è¶³Finish[i] == trueï¼Œé‚£ä¹ˆç³»ç»Ÿå½“å‰å¤„äºå®‰å…¨çŠ¶æ€ï¼Œå› ä¸ºæˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªå®‰å…¨åºåˆ—ã€‚  ä¸ºäº†åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å¤„äºå®‰å…¨çŠ¶æ€ï¼Œç®—æ³•å¯èƒ½éœ€è¦æ‰§è¡Œ $m \\times n^2$ æ¬¡ã€‚\nèµ„æºè¯·æ±‚ç®—æ³•(é“¶è¡Œå®¶ç®—æ³•) èµ„æºè¯·æ±‚ç®—æ³•(Resource-Request Algorithm) ç”¨æ¥åˆ¤æ–­æŸä¸ªè¯·æ±‚çš„å®‰å…¨æ€§ï¼Œåªæœ‰ä¸€ä¸ªè¯·æ±‚æ˜¯å®‰å…¨çš„ï¼Œæ‰ä¸ºå…¶åˆ†é…èµ„æºã€‚è‹¥æ»¡è¶³æŸä¸ªè¯·æ±‚åç³»ç»Ÿä»å¤„äºå®‰å…¨çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å°±æ˜¯å®‰å…¨çš„ã€‚ç”¨Request[i][j]è¡¨ç¤ºçº¿ç¨‹ $T_i$ è¯·æ±‚èµ„æº $R_j$ çš„å®ä¾‹æ•°ï¼Œå½“çº¿ç¨‹ $T_i$ å‘å‡ºä¸€ä¸ªèµ„æºè¯·æ±‚æ—¶ï¼Œå°†æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å¤„ç†ï¼š\n è‹¥Request[i] â‰¤ Need[i]ï¼Œè·³è½¬æ­¥éª¤2ã€‚å¦åˆ™æŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºçº¿ç¨‹è¯·æ±‚çš„èµ„æºæ•°è¶…è¿‡äº†å®ƒéœ€è¦çš„æœ€å¤§å€¼ã€‚ è‹¥Request[i] â‰¤ Availableï¼Œè·³è½¬æ­¥éª¤3ã€‚å¦åˆ™ï¼Œç”±äºèµ„æºä¸å¤Ÿï¼Œçº¿ç¨‹ $T_i$ å¿…é¡»ç­‰å¾…ã€‚ æ£€æŸ¥æ˜¯å¦å¯ä»¥å®‰å…¨åœ°æ»¡è¶³Request[i]ã€‚å…ˆå‡è£…è¯·æ±‚çš„èµ„æºå·²è¢«æˆäºˆï¼Œç„¶åè¿è¡Œå®‰å…¨æ€§ç®—æ³•æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦ä»ç„¶å¤„äºå®‰å…¨çŠ¶æ€ã€‚è‹¥æ˜¯ï¼Œæ»¡è¶³Request[i]ï¼Œå¦åˆ™çº¿ç¨‹ $T_i$ å¿…é¡»ç­‰å¾…ç›´åˆ°Request[i]å˜æˆå®‰å…¨çš„ã€‚å‡è£…åˆ†é…èµ„æºçš„ä¼ªä»£ç ä¸ºï¼š  å¯ç”¨èµ„æºå‡å°‘ï¼šAvailable = Available - Request[i]; å·²åˆ†é…èµ„æºå¢åŠ ï¼šAllocation[i] = Allocaion[i] + Request[i]; èµ„æºéœ€æ±‚é‡å‡å°‘ï¼šNeed[i] = Need[i] - Request[i]ã€‚    ä¸€ä¸ªä¾‹å­ å‡è®¾ç³»ç»Ÿä¸­æœ‰5ä¸ªçº¿ç¨‹ï¼Œ10ä¸ªèµ„æºAå®ä¾‹ã€5ä¸ªèµ„æºBå®ä¾‹å’Œ7ä¸ªèµ„æºCå®ä¾‹ï¼Œç³»ç»Ÿå½“å‰çš„å¿«ç…§çŠ¶æ€å¦‚ä¸‹ï¼š\n   çº¿ç¨‹ Allocation(A, B, C) Max(A, B, C) Available(A, B, C) Need(A, B, C)     $$T_0$$ (0, 1, 0) (7, 5, 3) (3, 3, 2) (7, 4, 3)   $$T_1$$ (2, 0, 0) (3, 2, 2)  (1, 2, 2)   $$T_2$$ (3, 0, 2) (9, 0, 2)  (6, 0, 0)   $$T_3$$ (2, 1, 1) (2, 2, 2)  (0, 1, 1)   $$T_4$$ (0, 0, 2) (4, 3, 3)  (4, 3, 1)    è¿è¡Œé“¶è¡Œå®¶ç®—æ³•å¯ä»¥å‘ç°å½“å‰ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€ï¼Œå› ä¸ºå­˜åœ¨ä¸€ä¸ªå®‰å…¨åºåˆ— $\u0026lt;T_1, T_3, T_4, T_2, T_0\u0026gt;$ ã€‚\nå‡è®¾ç°åœ¨çº¿ç¨‹ $T_1$ éœ€è¦è¯·æ±‚1ä¸ªèµ„æºAå’Œ2ä¸ªèµ„æºCï¼Œå³Request[1] = (1, 0, 2)ã€‚ä¸ºäº†åˆ¤æ–­Request[1]æ˜¯å¦æ˜¯å®‰å…¨çš„ï¼Œæˆ‘ä»¬å…ˆæ£€æŸ¥Request[i] â‰¤ Availableï¼Œæ¡ä»¶æˆç«‹ï¼Œç°åœ¨å‡è£…Request[1]å·²è¢«æ»¡è¶³ï¼Œç³»ç»Ÿå°†è¿›å…¥ä¸€ä¸ªæ–°çš„çŠ¶æ€ï¼š\n   çº¿ç¨‹ Allocation(A, B, C) Max(A, B, C) Available(A, B, C) Need(A, B, C)     $$T_0$$ (0, 1, 0) (7, 5, 3) (2, 3, 0) (7, 4, 3)   $$T_1$$ (3, 0, 2) (3, 2, 2)  (0, 2, 0)   $$T_2$$ (3, 0, 2) (9, 0, 2)  (6, 0, 0)   $$T_3$$ (2, 1, 1) (2, 2, 2)  (0, 1, 1)   $$T_4$$ (0, 0, 2) (4, 3, 3)  (4, 3, 1)    ç°åœ¨æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å¤„äºå®‰å…¨çŠ¶æ€ï¼Œè¿è¡Œå®‰å…¨æ€§ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å®‰å…¨åºåˆ— $\u0026lt;T_1, T_3, T_4, T_0, T_2\u0026gt;$ ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ç«‹å³æ»¡è¶³çº¿ç¨‹ $T_1$ çš„è¯·æ±‚ã€‚æ»¡è¶³çº¿ç¨‹ $T_1$ çš„è¯·æ±‚ä¹‹åï¼Œå‡è®¾çº¿ç¨‹ $T_0$ åˆæ¥è¯·æ±‚èµ„æºï¼ŒRequest[0] = (0, 2, 0)ï¼Œå› ä¸º(0, 2, 0) â‰¤ ï¼ˆ2, 3, 0)ï¼Œæ‰€ä»¥æˆ‘ä»¬å‡è£…èµ„æºå·²åˆ†é…ï¼Œç³»ç»Ÿçš„çŠ¶æ€å¦‚ä¸‹ï¼š\n   çº¿ç¨‹ Allocation(A, B, C) Max(A, B, C) Available(A, B, C) Need(A, B, C)     $$T_0$$ (0, 3, 0) (7, 5, 3) (2, 1, 0) (7, 2, 3)   $$T_1$$ (3, 0, 2) (3, 2, 2)  (0, 2, 0)   $$T_2$$ (3, 0, 2) (9, 0, 2)  (6, 0, 0)   $$T_3$$ (2, 1, 1) (2, 2, 2)  (0, 1, 1)   $$T_4$$ (0, 0, 2) (4, 3, 3)  (4, 3, 1)    è¿è¡Œå®‰å…¨æ€§ç®—æ³•ä¼šå‘ç°ï¼Œæˆ‘ä»¬æ‰¾ä¸åˆ°ä»»ä½•å®‰å…¨åºåˆ—ï¼Œæ‰€ä»¥ä¸èƒ½æ»¡è¶³çº¿ç¨‹ $T_0$ çš„è¿™ä¸ªè¯·æ±‚ã€‚\næ­»é”æ£€æµ‹ä¸æ¢å¤ å½“ç³»ç»Ÿæ—¢ä¸èƒ½é¢„é˜²ä¹Ÿä¸èƒ½é¿å…æ­»é”ï¼Œé‚£æ­»é”å°±æœ‰å¯èƒ½å‡ºç°ã€‚è¿™ä¸ªæ—¶å€™ï¼Œç³»ç»Ÿå¯èƒ½å°±éœ€è¦å…·å¤‡æ£€æµ‹æ­»é”çš„å­˜åœ¨å¹¶ä»æ­»é”æ¢å¤çš„èƒ½åŠ›äº†ã€‚\næ­»é”æ£€æµ‹ æ¯ç±»èµ„æºåªæœ‰ä¸€ä¸ªå®ä¾‹çš„æ­»é”æ£€æµ‹ å½“RAGä¸­å­˜åœ¨ç¯è·¯æ—¶ï¼Œå¯èƒ½å­˜åœ¨æ­»é”ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ£€æµ‹RAGä¸­æ˜¯å¦å­˜åœ¨ç¯è·¯å³å¯ã€‚\næ¯ç±»èµ„æºæœ‰å¤šä¸ªå®ä¾‹çš„æ­»é”æ£€æµ‹ å½“æ¯ç±»èµ„æºæœ‰å¤šä¸ªå®ä¾‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨é“¶è¡Œå®¶ç®—æ³•ä¸­çš„æ•°æ®ç»“æ„å¹¶ç¨å¾®ä¿®æ”¹å®‰å…¨æ€§ç®—æ³•æ¥æ£€æµ‹æ­»é”çš„å­˜åœ¨ã€‚ç®—æ³•å¦‚ä¸‹ï¼š\n è®¾Workå’ŒFinishåˆ†åˆ«æ˜¯é•¿åº¦ä¸ºmå’Œnçš„å‘é‡ã€‚Workä¸ºå¯ç”¨èµ„æºçš„ä¸€ä¸ªå·¥ä½œå‰¯æœ¬ï¼Œå®ƒå¯ä»¥åœ¨åˆ†æè¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ï¼Œåˆå§‹å€¼ä¸ºAvailableã€‚Finishæ˜¯ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å‘é‡ï¼Œç”¨æ¥è¡¨ç¤ºæŸä¸ªçº¿ç¨‹æ˜¯å¦å·²ç»å®Œæˆã€‚è‹¥Available[i] = 0ï¼Œåˆ™Finish[i] = trueï¼Œå¦åˆ™Finish[i] = falseã€‚ æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³Finish[i] == false \u0026amp;\u0026amp; Request[i] â‰¤ Workçš„iã€‚æ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹è¿˜æœªå®Œæˆï¼Œä½†å¯ä»¥ä¸ºå…¶åˆ†é…èµ„æºã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„iï¼Œè·³è½¬åˆ°æ­¥éª¤4ã€‚ Work = Work + Allocation[i]ï¼ŒFinish[i] = trueã€‚è¿™è¡¨ç¤ºçº¿ç¨‹iæ‰§è¡Œå®Œæˆå¹¶å°†å…¶å ç”¨çš„èµ„æºå½’è¿˜åˆ°å·¥ä½œæ± ã€‚è·³è½¬åˆ°æ­¥éª¤2ã€‚ è‹¥å­˜åœ¨iï¼Œä½¿Finish[i] == falseï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­å­˜åœ¨æ­»é”ã€‚Finish[i] == falseçš„çº¿ç¨‹å°±æ˜¯å·²ç»å‘ç”Ÿæ­»é”çš„çº¿ç¨‹ã€‚  å‡è®¾ç³»ç»Ÿä¸­æœ‰5ä¸ªçº¿ç¨‹ï¼Œ7ä¸ªèµ„æºAå®ä¾‹ã€2ä¸ªèµ„æºBå®ä¾‹å’Œ6ä¸ªèµ„æºCå®ä¾‹ï¼Œç³»ç»Ÿå½“å‰çš„å¿«ç…§çŠ¶æ€å¦‚ä¸‹ï¼š\n   çº¿ç¨‹ Allocation(A, B, C) Request(A, B, C) Available(A, B, C)     $$T_0$$ (0, 1, 0) (0, 0, 0) (0, 0, 0)   $$T_1$$ (2, 0, 0) (2, 0, 2)    $$T_2$$ (3, 0, 3) (0, 0, 0)    $$T_3$$ (2, 1, 1) (1, 0, 0)    $$T_4$$ (0, 0, 2) (0, 0, 2)     è¿è¡Œæ­»é”æ£€æµ‹ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å®‰å…¨åºåˆ— $\u0026lt;T_0, T_2, T_3, T_1, T_4\u0026gt;$ ä½¿å¾—Finishä¸­æ‰€æœ‰å…ƒç´ å‡ä¸ºtrueï¼Œå› æ­¤å½“å‰ç³»ç»Ÿä¸­æ²¡æœ‰æ­»é”ã€‚è‹¥å½“å‰ç³»ç»Ÿçš„çŠ¶æ€ä¸º(çº¿ç¨‹ $T_2$ å¤šè¯·æ±‚äº†ä¸€ä¸ªèµ„æºC)ï¼š\n   çº¿ç¨‹ Allocation(A, B, C) Request(A, B, C) Available(A, B, C)     $$T_0$$ (0, 1, 0) (0, 0, 0) (0, 0, 0)   $$T_1$$ (2, 0, 0) (2, 0, 2)    $$T_2$$ (3, 0, 3) (0, 0, 1)    $$T_3$$ (2, 1, 1) (1, 0, 0)    $$T_4$$ (0, 0, 2) (0, 0, 2)     è¿™ä¸ªæ—¶å€™ç³»ç»Ÿå°±å­˜åœ¨æ­»é”äº†ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥å›æ”¶çº¿ç¨‹ $T_0$ å ç”¨çš„èµ„æºï¼Œä½†ä¹Ÿæ— æµäºäº‹ï¼Œçº¿ç¨‹ $T_1$ ã€ $T_2$ ã€ $T_3$ å’Œ $T_4$ æ­»é”äº†ã€‚\næ­»é”æ£€æµ‹ç®—æ³•çš„ä½¿ç”¨ ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰æ­»é”æ£€æµ‹ç®—æ³•äº†ï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ä½•æ—¶å»æ£€æµ‹å®ƒä»¬ã€‚ä¸€ç§æ–¹æ³•æ˜¯æ¯å½“æœ‰èµ„æºè¯·æ±‚æ—¶å°±å»æ£€æµ‹ï¼Œè™½ç„¶è¶Šæ—©å‘ç°æ­»é”è¶Šå¥½ï¼Œä½†è¿™å¯èƒ½å ç”¨å¤§é‡çš„CPUæ—¶é—´ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯æ¯éš”ä¸€æ®µæ—¶é—´å°±æ£€æŸ¥ä¸€æ¬¡ï¼Œæˆ–è€…å½“CPUä½¿ç”¨ç‡é™åˆ°ä¸€å®šé˜ˆå€¼ä»¥ä¸‹æ—¶å»æ£€æŸ¥ã€‚è€ƒè™‘åˆ°CPUçš„ä½¿ç”¨æ•ˆç‡ï¼Œå¦‚æœæ­»é”çº¿ç¨‹è¾¾åˆ°äº†ä¸€å®šæ•°é‡ï¼Œå°±æ²¡å¤šå°‘çº¿ç¨‹å¯ä»¥è¿è¡Œäº†ï¼Œæ‰€ä»¥CPUä¼šç»å¸¸ç©ºé—²ã€‚\nä»æ­»é”æ¢å¤ å½“æˆ‘ä»¬æˆåŠŸæ£€æµ‹åˆ°äº†æ­»é”ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯é‡‡å–ä¸€äº›æ–¹æ³•ä½¿ç³»ç»Ÿé‡æ–°æ­£å¸¸å·¥ä½œï¼š\n åˆ©ç”¨æŠ¢å æ¢å¤ã€‚ä¸´æ—¶å°†èµ„æºä»ä¸€ä¸ªçº¿ç¨‹æŠ¢å åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨å®Œå°±é€å›åŸçº¿ç¨‹ã€‚ å›æ»šã€‚å‘¨æœŸæ€§çš„åˆ›å»ºæ£€æŸ¥ç‚¹ï¼Œå½“æ£€æµ‹åˆ°æ­»é”æ—¶ï¼Œå›é€€åˆ°æŸä¸ªä¹‹å‰çš„æ£€æŸ¥ç‚¹ç»§ç»­ã€‚ æ€æ­»è¿›ç¨‹ã€‚æ€æ­»ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ï¼Œä½¿ä¹‹é‡Šæ”¾èµ„æºï¼Œä¾¿äºå…¶å®ƒçº¿ç¨‹æ­£å¸¸è¿è¡Œã€‚  å’Œæ­»é”ç›¸å…³çš„å…¶å®ƒé—®é¢˜ æ´»é” æ´»é”(livelock) ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œä½†çº¿ç¨‹ä¹Ÿä¸èƒ½ç»§ç»­æ‰§è¡Œï¼Œå› ä¸ºçº¿ç¨‹å°†ä¸æ–­é‡å¤æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œè€Œä¸”æ€»ä¼šå¤±è´¥ã€‚è¿™å°±åƒä¸¤ä¸ªè¿‡äºç¤¼è²Œçš„äººåœ¨åŠè·¯ä¸Šé¢å¯¹é¢åœ°ç›¸é‡ï¼šä»–ä»¬å½¼æ­¤éƒ½ç»™å¯¹æ–¹è®©è·¯ï¼Œç„¶ååˆåœ¨å¦ä¸€æ¡è·¯ä¸Šç›¸é‡äº†ï¼Œå¹¶ä¸”ä»–ä»¬å°±è¿™æ ·åå¤åœ°é¿è®©ä¸‹å»ã€‚å¯ä»¥åœ¨é‡è¯•æœºåˆ¶ä¸­å¼•å…¥ éšæœºæ€§ æ¥è§£å†³é—®é¢˜ï¼Œè¿™æ ·èƒ½å‡å°‘å†²çªã€‚\né¥¥é¥¿ å½“çº¿ç¨‹ç”±äºæ— æ³•è®¿é—®å®ƒæ‰€éœ€è¦çš„èµ„æºè€Œä¸èƒ½ç»§ç»­æ‰§è¡Œæ—¶ï¼Œå°±å‘ç”Ÿäº†é¥¥é¥¿(Starvation)ã€‚ä¾‹å¦‚ï¼šJavaåº”ç”¨ç¨‹åºå¯¹çº¿ç¨‹çš„ä¼˜å…ˆçº§è®¾ç½®ä¸å½“ï¼Œå¯¼è‡´éƒ¨åˆ†çº¿ç¨‹æ— æ³•è·å–CPUæ—¶é’Ÿå‘¨æœŸã€‚å¯ä»¥é€šè¿‡FIFOç­–ç•¥æ¥é¿å…é¥¥é¥¿ï¼Œä¹Ÿå¯ä»¥åœ¨å¼•å…¥è€åŒ–æœºåˆ¶ï¼ŒåŠ¨æ€çš„è°ƒæ•´çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œä½¿æ¯ä¸ªçº¿ç¨‹çš„ä¼˜å…ˆçº§éƒ½æœ‰æœºä¼šå˜æˆæœ€é«˜çš„ã€‚\nå‚è€ƒèµ„æ–™  ANDREW S. TANENBAUM, HERBERT BOS. Modern Operating Systems, 4th Edition. Pearson, 2015. Abraham Silberschatz, Greg Gagne, Peter B. Galvin. Operating System Concepts, 10th Edition. Wiley, 2018.  ","href":"/operating_systems/deadlocks/","title":"æ­»é”"},{"content":"ç‰©ç†åœ°å€ä¸è™šæ‹Ÿåœ°å€ Computer Systems: A Programmer\u0026rsquo;s Perspective ä¸€ä¹¦ä¸­æ˜¯è¿™ä¹ˆæè¿°ç‰©ç†åœ°å€çš„ï¼šè®¡ç®—æœºç³»ç»Ÿçš„ä¸»å­˜è¢«ç»„ç»‡æˆä¸€ä¸ªç”± M ä¸ªè¿ç»­çš„å­—èŠ‚å¤§å°çš„å•å…ƒç»„æˆçš„æ•°ç»„ï¼Œæ¯ä¸ªå­—èŠ‚éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ ç‰©ç†åœ°å€ï¼ˆPhysical Addressï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç‰©ç†åœ°å€è¡¨ç¤ºçš„æ˜¯æ•°æ®åœ¨ä¸»å­˜ä¸­çš„ç‰©ç†ä½ç½®ã€‚\næ—©æœŸçš„è®¡ç®—æœºä¸­æ²¡æœ‰å­˜å‚¨å™¨æŠ½è±¡ï¼Œæ¯ä¸€ä¸ªç¨‹åºéƒ½ç›´æ¥è®¿é—®ç‰©ç†åœ°å€ï¼Œæˆ‘ä»¬æŠŠ CPU ç›´æ¥è®¿é—®ç‰©ç†åœ°å€çš„è¿™ç§å¯»å€æ–¹å¼ç§°ä¸º ç‰©ç†å¯»å€(physical addressing)ã€‚è€Œ è™šæ‹Ÿåœ°å€(Virtual Address) æ˜¯ CPU åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ç”Ÿæˆçš„ä¸€ä¸ªåœ°å€ï¼Œè™šæ‹Ÿåœ°å€åˆå«é€»è¾‘åœ°å€ï¼ˆLogical Addressï¼‰ï¼Œè™šæ‹Ÿå¯»å€ï¼ˆvirtual addressingï¼‰ æ˜¯ç°ä»£è®¡ç®—æœºæ‰€é‡‡ç”¨çš„å¯»å€å½¢å¼ã€‚å†…å­˜ç®¡ç†å•å…ƒï¼ˆMemory Management Unit, MMUï¼‰ æ˜¯ CPU ä¸Šçš„ä¸€ä¸ªä¸“ç”¨ç¡¬ä»¶ï¼Œè´Ÿè´£å®Œæˆè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš åœ°å€ç¿»è¯‘ï¼ˆaddress translationï¼‰ã€‚\nä¸Šå›¾å·¦è¾¹å±•ç¤ºäº†ä¸€ä¸ªç‰©ç†å¯»å€çš„ç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹å±•ç¤ºäº†ä¸€æ¡æŒ‡ä»¤ï¼Œå®ƒä»ç‰©ç†åœ°å€ 4 å¼€å§‹è¯»å– 4 ä¸ªå­—èŠ‚ã€‚å½“ CPU æ‰§è¡Œè¿™æ¡æŒ‡ä»¤æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªç‰©ç†åœ°å€ï¼ŒCPU é€šè¿‡å†…å­˜æ€»çº¿å°†ç‰©ç†åœ°å€ 4 ä¼ ç»™ä¸»å­˜ã€‚ä¸»å­˜ä»ç‰©ç†åœ°å€ 4 å¼€å§‹å–å‡º 4 ä¸ªå­—èŠ‚ï¼Œå¹¶å°†å®ƒè¿”ç»™ CPUã€‚è€Œä¸Šå›¾å³è¾¹å±•ç°äº†ä¸€ä¸ªè™šæ‹Ÿå¯»å€çš„ä¾‹å­ï¼ŒCPU åœ¨æ‰§è¡ŒæŒ‡ä»¤æ—¶æ‹¿åˆ°çš„æ˜¯ä¸€ä¸ªè™šæ‹Ÿåœ°å€ 4100ï¼Œå®ƒå°†è¿™ä¸ªè™šæ‹Ÿåœ°å€ä¼ ç»™ MMUï¼ŒMMU å°†è¿™ä¸ªè™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç‰©ç†åœ°å€ 4ï¼Œç„¶åå°†ç‰©ç†åœ°å€ä¼ ç»™ä¸»å­˜ã€‚\nä½¿ç”¨ç‰©ç†åœ°å€å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼šé¦–å…ˆï¼Œç”¨æˆ·ç¨‹åºå¯ä»¥è®¿é—®ä»»æ„åœ°å€ï¼Œå®¹æ˜“ç ´åæ“ä½œç³»ç»Ÿã€‚æ­¤å¤–ï¼Œä½¿ç”¨ç‰©ç†åœ°å€ä¼šè®©åŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºå˜å¾—å¾ˆå›°éš¾ã€‚\nåœ°å€ç©ºé—´ è¦ä½¿å¤šä¸ªåº”ç”¨ç¨‹åºåŒæ—¶å¤„äºå†…å­˜ä¸­å¹¶ä¸”ä¸äº’ç›¸å½±å“ï¼Œå°±éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼šä¿æŠ¤å’Œé‡å®šä½ã€‚åœ°å€ç©ºé—´ï¼ˆaddress spaceï¼‰ æ˜¯ä¸€ä¸ªåœ°å€é›†åˆï¼Œè¿›ç¨‹å¯ç”¨å®ƒåœ¨å†…å­˜ä¸­å¯»å€ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿›ç¨‹å„è‡ªçš„åœ°å€ç©ºé—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚\nè®¡ç®—æœºçš„ç‰©ç†å†…å­˜æ€»æ˜¯æœ‰é™çš„ï¼Œè€Œæ‰€æœ‰è¿›ç¨‹æ‰€éœ€çš„ RAM æ€»é‡é€šå¸¸æ¯”å†…å­˜è¦å¤§å¾—å¤šã€‚æœ‰ä¸¤ç§å¤„ç†å†…å­˜è¶…è½½çš„é€šç”¨æ–¹æ³•ï¼šäº¤æ¢ï¼ˆswappingï¼‰ å’Œ è™šæ‹Ÿå†…å­˜ï¼ˆvirtual memoryï¼‰ã€‚äº¤æ¢æŠ€æœ¯å°†ä¸€ä¸ªè¿›ç¨‹å®Œæ•´åœ°è½½å…¥å†…å­˜ï¼Œè¿è¡Œä¸€æ®µæ—¶é—´ï¼Œç„¶åå†å°†å®ƒå­˜å›ç¡¬ç›˜ã€‚ç©ºé—²è¿›ç¨‹ä¸»è¦å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šï¼Œæ‰€ä»¥åªè¦å®ƒä»¬ä¸è¿è¡Œå°±ä¸ä¼šå ç”¨å†…å­˜ã€‚è™šæ‹Ÿå†…å­˜èƒ½å¤Ÿä½¿ç¨‹åºåœ¨åªæœ‰ä¸€éƒ¨åˆ†è¢«è½½å…¥å†…å­˜çš„æƒ…å†µä¸‹è¿è¡Œã€‚\nç©ºé—²å†…å­˜ç®¡ç† æ“ä½œç³»ç»Ÿå¿…é¡»å¯¹åŠ¨æ€åˆ†é…çš„å†…å­˜è¿›è¡Œç®¡ç†ã€‚è¿½è¸ªå†…å­˜çš„ä½¿ç”¨æƒ…å†µçš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼šä½å›¾ï¼ˆbitmapï¼‰ å’Œ ç©ºé—²é“¾è¡¨ï¼ˆfree listï¼‰ã€‚\nä½å›¾ ä½¿ç”¨ä½å›¾æ—¶ï¼Œå†…å­˜è¢«åˆ’åˆ†ä¸ºåˆ†é…å•å…ƒï¼ˆåˆ†é…å•å…ƒçš„å¤§å°æ ¹æ®å®é™…æƒ…å†µç¡®å®šï¼Œå°åˆ°å‡ ä¸ªå­—ï¼Œå¤§åˆ°å‡ åƒä¸ªå­—èŠ‚ï¼‰ï¼Œæ¯ä¸ªåˆ†é…å•å…ƒå¯¹åº”äºä½å›¾ä¸­çš„ä¸€ä½ã€‚ä½å›¾ä¸­ç”¨ 1 è¡¨ç¤ºç©ºé—²ï¼Œ0 è¡¨ç¤ºå·²è¢«ä½¿ç”¨ï¼›ä¹Ÿå¯ä»¥ç”¨ 0 è¡¨ç¤ºç©ºé—²ï¼Œ1 è¡¨ç¤ºå·²ä½¿ç”¨ã€‚å› æ­¤ï¼Œä½å›¾åˆç§° ä½å‘é‡ï¼ˆbit vectorï¼‰ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾å†…å­˜ä¸­å‰ 32 ä¸ªåˆ†é…å•å…ƒçš„ç¬¬2ã€3ã€4ã€5ã€8ã€9ã€10ã€11ã€12ã€13ã€17ã€18ã€25ã€26å’Œ27ä¸ªåˆ†é…å•å…ƒæ˜¯ç©ºé—²çš„ï¼Œè€Œå…¶å®ƒçš„å·²è¢«ä½¿ç”¨ã€‚è‹¥ç”¨1è¡¨ç¤ºåˆ†é…å•å…ƒå·²è¢«ä½¿ç”¨ï¼Œåˆ™ç©ºé—²å†…å­˜å¯ä»¥è¡¨ç¤ºä¸ºï¼š11000011000000111001111110001111...ã€‚\nåˆ†é…å•å…ƒçš„å¤§å°æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„è®¾è®¡å› ç´ ã€‚åˆ†é…å•å…ƒè¶Šå°ï¼Œä½å›¾è¶Šå¤§ã€‚ä½å›¾çš„å¤§å°åŒæ—¶å–å†³äºå†…å­˜çš„å¤§å°å’Œåˆ†é…å•å…ƒçš„å¤§å°ã€‚ä½¿ç”¨ä½å›¾çš„ä¸»è¦é—®é¢˜æ˜¯ï¼šåœ¨å†³å®šæŠŠä¸€ä¸ªå ç”¨kä¸ªåˆ†é…å•å…ƒçš„è¿›ç¨‹è°ƒå…¥å†…å­˜æ—¶ï¼Œå†…å­˜ç®¡ç†å™¨å¿…é¡»æœç´¢ä½å›¾ï¼Œåœ¨ä½å›¾ä¸­æ‰¾å‡ºkä¸ªè¿ç»­çš„ç©ºé—²å—ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆè€—æ—¶çš„æ“ä½œã€‚\nç©ºé—²é“¾è¡¨ ä½¿ç”¨ç©ºé—²é“¾è¡¨æ—¶ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªè®°å½•å·²åˆ†é…å†…å­˜æ®µå’Œç©ºé—²å†…å­˜æ®µçš„é“¾è¡¨ï¼Œå…¶ä¸­é“¾è¡¨ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹è¦ä¹ˆä¿æŠ¤ä¸€ä¸ªè¿›ç¨‹ï¼Œè¦ä¹ˆè¡¨ç¤ºä¸¤ä¸ªè¿›ç¨‹é—´çš„ç©ºé—²åŒºã€‚é“¾è¡¨ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æœ‰èŠ‚ç‚¹æ ‡è¯†(ä¾‹å¦‚ç”¨H(hole)æ ‡è¯†ç©ºé—²ï¼ŒP(process)è¡¨ç¤ºè¿›ç¨‹)ã€èµ·å§‹åœ°å€ã€é•¿åº¦å’Œä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚ä¸Šå›¾å°±å±•ç¤ºäº†ä¸€ä¸ªæŒ‰åœ°å€é¡ºåºæ’åˆ—çš„å•é“¾è¡¨ç»“æ„ï¼Œæœ‰æ—¶å€™åŒå‘é“¾è¡¨å¯èƒ½æ›´åˆé€‚ã€‚\nå½“åˆ›å»ºæ–°è¿›ç¨‹æˆ–ä»ç¡¬ç›˜æ¢å…¥çš„è¿›ç¨‹æ—¶ï¼Œæœ‰å‡ ç§ç®—æ³•å¯ä»¥ä¸ºå…¶åˆ†é…å†…å­˜ï¼š\n é¦–æ¬¡é€‚é…ï¼ˆfirst fitï¼‰ï¼šå†…å­˜ç®¡ç†å™¨ä»ç©ºé—²é“¾è¡¨å¤´è¿›è¡Œæœç´¢ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªèƒ½å¤Ÿå®¹çº³ä¸‹è¿›ç¨‹çš„ç©ºé—²åŒºï¼Œè‹¥ç©ºé—²åŒºå¤§äºè¿›ç¨‹æ‰€éœ€å†…å­˜çš„å¤§å°ï¼Œåˆ™å°†ç©ºé—²åŒºåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸€éƒ¨åˆ†ä¾›è¿›ç¨‹ä½¿ç”¨ï¼Œå¦ä¸€éƒ¨åˆ†å½¢æˆæ–°çš„ç©ºé—²åŒºã€‚é¦–æ¬¡é€‚é…ç®—æ³•çš„é€Ÿåº¦éå¸¸å¿«ï¼Œå› ä¸ºå®ƒå°½å¯èƒ½å°‘çš„æœç´¢èŠ‚ç‚¹ã€‚ ä¸‹æ¬¡é€‚é…ï¼ˆnext fitï¼‰ï¼šå·¥ä½œæ–¹å¼å’Œé¦–æ¬¡é€‚é…ç›¸åŒï¼Œä¸åŒç‚¹åœ¨äºæ¯æ¬¡æ‰¾åˆ°åˆé€‚çš„ç©ºé—²åŒºåå°±è®°å½•å½“å‰ä½ç½®ï¼Œä¸‹æ¬¡å¯»æ‰¾ç©ºé—²åŒºæ—¶å°±ä»ä¹‹å‰è®°å½•çš„ä½ç½®å¼€å§‹æœç´¢ã€‚ æœ€ä½³é€‚é…ï¼ˆbest fitï¼‰ï¼šä»å¤´åˆ°å°¾æœç´¢æ•´ä¸ªé“¾è¡¨ï¼Œæ‰¾åˆ°èƒ½å®¹çº³è¿›ç¨‹çš„æœ€å°ç©ºé—²åŒºã€‚å› ä¸ºè¦æœç´¢æ•´ä¸ªé“¾è¡¨ï¼Œæ‰€ä»¥æœ€ä½³é€‚é…ç®—æ³•çš„é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œè€Œä¸”å®¹æ˜“äº§ç”Ÿå¤§é‡æ— ç”¨çš„å°ç©ºé—²åŒºã€‚ æœ€å·®é€‚é…ï¼ˆworst fitï¼‰ï¼šæœ€ä½³é€‚é…ç®—æ³•ä¼šäº§ç”Ÿå¾ˆå¤šéå¸¸å°çš„ç©ºé—²åŒºï¼Œä¸ºäº†é¿å…è¿™ä¸€é—®é¢˜ï¼Œæœ€å·®é€‚é…ç®—æ³•æ€»æ˜¯ç»™è¿›ç¨‹åˆ†é…æœ€å¤§çš„å¯ç”¨ç©ºé—²åŒºï¼Œä½¿æ–°å½¢æˆçš„ç©ºé—²åŒºè¾ƒå¤§è€Œå¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚ å¿«é€Ÿé€‚é…ï¼ˆquick fitï¼‰ï¼šä¸ºå¸¸ç”¨å¤§å°çš„ç©ºé—²åŒºå•ç‹¬ç»´æŠ¤ä¸€ä¸ªé“¾è¡¨ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¯»æ‰¾ä¸€ä¸ªæŒ‡å®šå¤§å°çš„ç©ºé—²åŒºæ˜¯ååˆ†è¿…é€Ÿçš„ã€‚  è™šæ‹Ÿå†…å­˜ ä¸ºäº†è§£å†³è¿›ç¨‹æ‰€éœ€ç©ºé—´æ¯”ç‰©ç†å†…å­˜å¤§çš„è¿™ä¸ªé—®é¢˜ï¼ŒMMU å°†ä¸€éƒ¨åˆ†ç¡¬ç›˜ç©ºé—´ä½œä¸º RAM çš„è¡¥å……ï¼Œå½¢æˆ è™šæ‹Ÿå†…å­˜ï¼ˆvirtual memoryï¼‰ã€‚è™šæ‹Ÿå†…å­˜çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šæ¯ä¸ªç¨‹åºéƒ½æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œè¿™ä¸ªåœ°å€ç©ºé—´è¢«åˆ’åˆ†ä¸ºäº†å¾ˆå¤šè¢«ç§°ä¸º é¡µï¼ˆpageï¼‰ çš„å—ã€‚æ¯ä¸€é¡µéƒ½æ˜¯ä¸€ä¸ªè¿ç»­çš„åœ°å€åŒºé—´ã€‚é¡µè¢«æ˜ å°„åˆ°ç‰©ç†å†…å­˜ä¸Šé¢ï¼Œè¿è¡Œç¨‹åºå¹¶ä¸éœ€è¦æ‰€æœ‰çš„é¡µéƒ½åœ¨ç‰©ç†å†…å­˜ä¸­ã€‚å½“ç¨‹åºå¼•ç”¨äº†å…¶åœ°å€ç©ºé—´çš„æŸä¸€éƒ¨åˆ†æ—¶ï¼Œè‹¥è¿™ä¸€éƒ¨åˆ†è¿™ç‰©ç†å†…å­˜å†…ï¼Œåˆ™ç¡¬ä»¶æ‰§è¡Œå¿…è¦çš„æ˜ å°„ï¼Œå¦åˆ™æ“ä½œç³»ç»Ÿéœ€è¦å°†ä¸åœ¨ç‰©ç†å†…å­˜ä¸­çš„é‚£ä¸€éƒ¨åˆ†åœ°å€è½½å…¥ç‰©ç†å†…å­˜å¹¶é‡æ–°æ‰§è¡Œå¤±è´¥çš„æŒ‡ä»¤ã€‚\nè™šæ‹Ÿå†…å­˜é€‚åˆåœ¨å¤šé“ç¨‹åºè®¾è®¡ç³»ç»Ÿä¸­ä½¿ç”¨ï¼ŒåŒä¸€æ—¶åˆ»ç‰©ç†å†…å­˜ä¸­å­˜æœ‰å¤šä¸ªç¨‹åºçš„é¡µï¼Œå½“ä¸€ä¸ªç¨‹åºç­‰å¾…å…¶é¡µé¢è¢«è½½å…¥å†…å­˜æ—¶ï¼ŒCPU å¯ä»¥è¢«å¦ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚è™šæ‹Ÿå†…å­˜æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œç¡¬ç›˜ä¸Šå¿…é¡»æœ‰ä¸€ä¸ªè¯¥åœ°å€ç©ºé—´çš„å®Œæ•´å‰¯æœ¬ã€‚\né¡µå¼ç®¡ç† å¤§éƒ¨åˆ†è™šæ‹Ÿå†…å­˜ç³»ç»Ÿä¸­éƒ½ä¼šä½¿ç”¨ä¸€ç§è¢«ç§°ä¸º åˆ†é¡µï¼ˆpagingï¼‰ çš„æŠ€æœ¯ã€‚è™šæ‹Ÿåœ°å€ç©ºé—´è¢«åˆ’åˆ†ä¸ºè‹¥å¹²å›ºå®šå¤§å°çš„å•å…ƒï¼Œè¿™é‡Œçš„å•å…ƒç§°ä¸º é¡µï¼ˆpageï¼‰ã€‚ç‰©ç†å†…å­˜ä¹Ÿè¢«åˆ’åˆ†ä¸ºè‹¥å¹²å›ºå®šå¤§å°çš„å•å…ƒï¼Œä¸è¿‡ç»„æˆç‰©ç†å†…å­˜çš„å•å…ƒè¢«ç§°ä¸º é¡µæ¡†ï¼ˆpage frameï¼‰ã€‚é¡µå’Œé¡µæ¡†çš„å¤§å°é€šå¸¸æ˜¯ä¸€æ ·çš„ã€‚\nè™šæ‹Ÿåœ°å€æ˜¯ä¸€ç§è§£å†³å†…å­˜è¶…è½½çš„æ–¹æ³•ï¼Œè¿™æ„å‘³ç€è™šæ‹Ÿåœ°å€ç©ºé—´å¤§äºç‰©ç†åœ°å€ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“é¡µå’Œé¡µæ¡†çš„å¤§å°ç›¸åŒæ—¶ï¼Œé¡µçš„æ•°é‡å°†å¤šä½™é¡µæ¡†çš„æ•°é‡ã€‚ä¹Ÿå°±æ„å‘³ç€ï¼Œæœ‰ä¸€éƒ¨åˆ†é¡µæ²¡æœ‰è¢«æ˜ å°„åˆ°é¡µæ¡†ã€‚å½“ç¨‹åºè®¿é—®äº†ä¸€ä¸ªæœªæ˜ å°„çš„é¡µï¼Œå³ç‰©ç†å†…å­˜ä¸­æ²¡æœ‰è¯¥é¡µå¯¹åº”çš„é¡µæ¡†ï¼Œå°±ä¼šå‘ç”Ÿ é¡µé”™è¯¯ï¼ˆpage faultï¼‰ã€‚è¿™ä¸ªæ—¶å€™ï¼ŒMMUä¼šå‘å‡ºä¸€ä¸ªç¼ºé¡µä¸­æ–­ï¼Œä½¿ CPU é™·å…¥æ“ä½œç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿå…ˆå°†ä¸€ä¸ªé¡µæ¡†å¯¹åº”çš„é¡µæ¢å‡ºåˆ°ç¡¬ç›˜ï¼ŒæŠŠéœ€è¦è®¿é—®çš„é¡µä»ç¡¬ç›˜æ¢å…¥åˆ°è¿™ä¸ªé¡µæ¡†ä¸­ï¼Œä¿®æ”¹æ˜ å°„å…³ç³»ï¼Œé‡æ–°å¯åŠ¨è¢«ä¸­æ–­çš„æŒ‡ä»¤ã€‚\nåˆ†é¡µç›¸å…³å·¥ä½œ æ“ä½œç³»ç»Ÿåœ¨ä»¥ä¸‹å››æ®µæ—¶é—´å†…éœ€è¦åšå’Œåˆ†é¡µæœ‰å…³çš„å·¥ä½œï¼šè¿›ç¨‹åˆ›å»ºæ—¶ã€è¿›ç¨‹æ‰§è¡Œæ—¶ã€å‘ç”Ÿé¡µé”™è¯¯æ—¶å’Œè¿›ç¨‹ç»ˆæ­¢æ—¶ã€‚\nå½“åœ¨åˆ†é¡µç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»å†³å®šå‡ºç¨‹åºå’Œæ•°æ®æ‰€å çš„åˆå§‹ç©ºé—´å¤§å°å¹¶ä¸ºå®ƒä»¬åˆ›å»ºé¡µè¡¨ã€‚æ“ä½œç³»ç»Ÿéœ€è¦åœ¨å†…å­˜ä¸­ä¸ºé¡µè¡¨åˆ†é…ç©ºé—´å¹¶åˆå§‹åŒ–ã€‚å½“è¿›ç¨‹è¢«æ¢å‡ºæ—¶ï¼Œé¡µè¡¨ä¸éœ€è¦é©»ç•™åœ¨å†…å­˜ä¸­ï¼Œä½†æ˜¯åœ¨è¿›ç¨‹è¿è¡Œæ—¶ï¼Œé¡µè¡¨å¿…é¡»åœ¨å†…å­˜ä¸­ã€‚æ­¤å¤–ï¼Œæ“ä½œç³»ç»Ÿè¿˜éœ€è¦å†ç¡¬ç›˜ä¸Šçš„äº¤æ¢åˆ†åŒºä¸­åˆ†é…ç©ºé—´ï¼Œä»¥ä¾¿é¡µè¢«æ¢å‡ºæ—¶æœ‰åœ°æ–¹å­˜æ”¾ã€‚äº¤æ¢åˆ†åŒºä¹Ÿå¿…é¡»ç”¨ç¨‹åºæ­£æ–‡å’Œæ•°æ®åˆå§‹åŒ–ï¼Œä»¥ä¾¿æ–°è¿›ç¨‹åœ¨å¯åŠ¨ä¸­é‡åˆ°é¡µé”™è¯¯æ—¶å¯ä»¥è½½å…¥éœ€è¦çš„é¡µã€‚é¡µè¡¨å’Œäº¤æ¢åˆ†åŒºçš„ä¿¡æ¯å¿…é¡»è¢«è®°å½•åœ¨è¿›ç¨‹è¡¨ä¸­ã€‚\nå½“è¿›ç¨‹è¢«è°ƒåº¦æ‰§è¡Œæ—¶ï¼ŒMMU ä¼šè¢«é‡ç½®ï¼ŒTLB ä¼šè¢«æ¸…ç©ºï¼Œè¿™æ ·å°±æ¸…é™¤äº†ä¸Šä¸€ä¸ªè¿›ç¨‹çš„ç—•è¿¹ã€‚æ–°è¿›ç¨‹çš„é¡µè¡¨æˆä¸ºå½“å‰é¡µè¡¨ã€‚\nå½“é¡µé”™è¯¯å‘ç”Ÿæ—¶ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»è¯»å–ç¡¬ä»¶å¯„å­˜å™¨å¹¶æ‰¾å‡ºå¯¼è‡´é”™è¯¯çš„é‚£ä¸ªè™šæ‹Ÿåœ°å€ï¼Œç„¶åè®¡ç®—å‡ºæ‰€éœ€è¦çš„é¡µå¹¶åœ¨ç¡¬ç›˜ä¸Šæ‰¾åˆ°å®ƒã€‚ä¹‹åï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ä¸ºæ–°é¡µæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„é¡µæ¡†å¹¶å°†æ–°é¡µæ”¾è¿›å»ã€‚æœ€åï¼Œå›é€€ç¨‹åºè®¡æ•°å™¨ï¼Œä½¿å®ƒæŒ‡å‘å¼•èµ·é¡µé”™è¯¯çš„æŒ‡ä»¤ï¼Œå¹¶é‡æ–°æ‰§è¡Œè¯¥æŒ‡ä»¤ã€‚\nå½“è¿›ç¨‹é€€å‡ºæ—¶ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»é‡Šæ”¾è¿›ç¨‹çš„é¡µè¡¨ã€é¡µå’Œé¡µåœ¨ç¡¬ç›˜ä¸Šæ‰€å ç”¨çš„ç©ºé—´ã€‚å¦‚æœæŸäº›é¡µæ˜¯å…±äº«çš„ï¼Œåªæœ‰å½“ä½¿ç”¨è¿™ä¸ªé¡µçš„æœ€åä¸€ä¸ªè¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œæ‰å¯ä»¥é‡Šæ”¾ç›¸åº”çš„ç©ºé—´ã€‚\né¡µè¡¨ æ¯ä¸ªç”±CPUç”Ÿæˆçš„è™šæ‹Ÿåœ°å€è¢«åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸€ä¸ª é¡µå·ï¼ˆpage numberï¼‰ å’Œä¸€ä¸ª é¡µåç§»ï¼ˆpage offsetï¼‰ã€‚å¦‚æœè™šæ‹Ÿåœ°å€ç©ºé—´çš„å¤§å°ä¸º $ 2^m $ å¹¶ä¸”é¡µçš„å¤§å°ä¸º $ 2^n $ å­—èŠ‚ï¼Œé‚£ä¹ˆè™šæ‹Ÿåœ°å€çš„é«˜m-nä½å°±è¢«ç”¨ä½œé¡µå·ï¼Œè€Œè™šæ‹Ÿåœ°å€çš„ä½nä½è¢«ç”¨ä½œé¡µåç§»ã€‚å› æ­¤ï¼Œè™šæ‹Ÿåœ°å€å¯ä»¥è¢«è¡¨ç¤ºæˆä¸‹é¢è¿™æ ·ï¼š\né¡µå·è¢«ç”¨æ¥ç´¢å¼•é¡µè¡¨ï¼ˆpage tableï¼‰ï¼Œä»¥å¾—åˆ°è™šæ‹Ÿé¡µå¯¹åº”çš„é¡µæ¡†å·ï¼Œé¡µåç§»åˆ™ä¸ºè™šæ‹Ÿåœ°å€åœ¨å¯¹åº”é¡µæ¡†ä¸­çš„ä½ç½®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé¡µè¡¨ä¸­åŒ…å«äº†æ¯ä¸ªé¡µæ¡†çš„èµ·å§‹åœ°å€ï¼Œé¡µæ¡†çš„èµ·å§‹åœ°å€åŠ ä¸Šåç§»é‡å°±å¾—åˆ°äº†ç‰©ç†åœ°å€ã€‚\nMMUé€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥å®Œæˆè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„ç¿»è¯‘ï¼š\n ä»è™šæ‹Ÿåœ°å€ä¸­å–å‡ºé¡µå·på¹¶å°†å…¶ç”¨ä½œé¡µè¡¨çš„ç´¢å¼•ã€‚ ä»é¡µè¡¨ä¸­å–å¾—på¯¹åº”çš„é¡µæ¡†å·fã€‚ å°†è™šæ‹Ÿåœ°å€ä¸­çš„é¡µå·pæ›¿æ¢ä¸ºé¡µæ¡†å·fã€‚  ç”±äºé¡µåç§»dæ²¡æœ‰è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥é¡µæ¡†å·få’Œé¡µåç§»då°±æ„æˆäº†çœŸæ­£çš„ç‰©ç†åœ°å€ã€‚\nåˆ†é¡µç³»ç»Ÿé¢ä¸´çš„é—®é¢˜ åœ¨ä»»ä½•åˆ†é¡µç³»ç»Ÿä¸­ï¼Œéƒ½é¢ä¸´ä¸¤ä¸ªé—®é¢˜ï¼š\n è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„å¿…é¡»éå¸¸å¿«ã€‚ å¦‚æœè™šæ‹Ÿåœ°å€ç©ºé—´å¾ˆå¤§ï¼Œé‚£ä¹ˆé¡µè¡¨ä¹Ÿä¼šå¾ˆå¤§ã€‚  ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ç”±äºæ¯æ¬¡è®¿é—®å†…å­˜éƒ½éœ€è¦è¿›è¡Œè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ï¼Œæ‰€æœ‰çš„æŒ‡ä»¤æœ€ç»ˆéƒ½å¿…é¡»æ¥è‡ªå†…å­˜ï¼Œå¹¶ä¸”å¾ˆå¤šæŒ‡ä»¤ä¹Ÿä¼šè®¿é—®å†…å­˜ä¸­çš„æ“ä½œæ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šæ¯æ¡æŒ‡ä»¤éƒ½è‡³å°‘éœ€è¦è®¿é—®ä¸€æ¬¡æˆ–ä¸¤æ¬¡é¡µè¡¨ã€‚\nç¬¬äºŒä¸ªé—®é¢˜å’Œç°ä»£è®¡ç®—æœºä½¿ç”¨çš„è™šæ‹Ÿåœ°å€å¤§å°æœ‰å…³ã€‚å¯¹äºä¸€ä¸ª32ä½çš„è™šæ‹Ÿåœ°å€ï¼Œå‡è®¾é¡µå¤§å°ä¸º4KBï¼Œå°†å¾—åˆ°è¶…è¿‡100ä¸‡é¡µï¼Œè¿™æ„å‘³ç€é¡µè¡¨å°†åŒ…å«è¶…è¿‡100ä¸‡ä¸ªè¡¨é¡¹ã€‚å¦‚æœæ¯ä¸ªé¡µè¡¨é¡¹å¤§å°ä¸º4å­—èŠ‚ï¼Œæ¯ä¸ªè¿›ç¨‹å°±éœ€è¦4MBçš„ç‰©ç†åœ°å€ç©ºé—´æ¥å­˜æ”¾é¡µè¡¨ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½éœ€è¦æœ‰è‡ªå·±çš„é¡µè¡¨ï¼Œå› ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚\nå¤§è€Œå¿«é€Ÿçš„é¡µæ˜ å°„éœ€æ±‚æˆä¸ºäº†æ„å»ºè®¡ç®—æœºçš„ä¸€ä¸ªå·¨å¤§çº¦æŸã€‚ä»æ¦‚å¿µä¸Šçœ‹ï¼Œæœ€ç®€å•çš„è®¾è®¡å°±æ˜¯ä½¿ç”¨ä¸€ç»„å¿«é€Ÿçš„ ç¡¬ä»¶å¯„å­˜å™¨ ç»„æˆçš„å•ä¸ªé¡µè¡¨ï¼Œè¡¨ä¸­çš„æ¯ä¸€é¡¹éƒ½å¯¹åº”ä¸€ä¸ªè™šæ‹Ÿé¡µã€‚å½“å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œæ“ä½œç³»ç»Ÿå°†è¯¥è¿›ç¨‹åœ¨å†…å­˜ä¸­çš„é¡µè¡¨çš„å‰¯æœ¬åŠ è½½åˆ°è¿™ç»„å¯„å­˜å™¨ä¸­ï¼Œä¹‹åè¿›ç¨‹è¿è¡ŒæœŸé—´å°±ä¸å†éœ€è¦åˆ°å†…å­˜ä¸­è®¿é—®é¡µè¡¨äº†ã€‚è¿™ä¸ªæ–¹æ³•çš„ä¼˜åŠ¿åœ¨äºç®€å•ï¼Œåœ°å€æ˜ å°„è¿‡ç¨‹ä¸­ä¹Ÿä¸éœ€è¦è®¿é—®å†…å­˜ã€‚ç¼ºç‚¹æ˜¯åœ¨é¡µè¡¨å¾ˆå¤§æ—¶ï¼Œä»£ä»·é«˜æ˜‚ï¼Œå¤šæ•°æƒ…å†µä¸‹å¹¶ä¸å®ç”¨ã€‚æ­¤å¤–ï¼Œæ¯æ¬¡è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œéƒ½éœ€è¦é‡æ–°è½½å…¥æ•´ä¸ªé¡µè¡¨ï¼Œæ€§èƒ½ä½ä¸‹ã€‚è¿˜æœ‰ä¸€ç§æç«¯çš„æ–¹æ³•å°±æ˜¯å°†æ•´ä¸ªé¡µè¡¨éƒ½ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚ç¡¬ä»¶åªéœ€è¦ä¸€ä¸ªå¯„å­˜å™¨ï¼Œå¯„å­˜å™¨ä¸­å­˜æ”¾é¡µè¡¨å¼€å§‹ä½ç½®çš„æŒ‡é’ˆã€‚å½“è¿›ç¨‹å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œåªéœ€è¦é‡æ–°è£…è½½è¿™ä¸ªå¯„å­˜å™¨ã€‚è¿™ç§åšæ³•çš„ç¼ºç‚¹æ˜¯ï¼šåœ¨æ¯æ¡æŒ‡ä»¤æ‰§è¡ŒæœŸé—´ï¼Œéƒ½éœ€è¦è®¿é—®ä¸€æ¬¡æˆ–å¤šæ¬¡å†…å­˜ä»¥è¯»å–é¡µè¡¨ï¼Œé€Ÿåº¦éå¸¸æ…¢ã€‚\nTLB é€šè¿‡åŠ å¿«è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„è¿‡ç¨‹è§£å†³äº†æ˜ å°„é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼Œè€Œå¤šçº§é¡µè¡¨å’Œåå‘é¡µè¡¨æä¾›äº†å·¨å¤§è™šæ‹Ÿåœ°å€ç©ºé—´çš„è§£å†³æ–¹æ¡ˆã€‚\nTLB ä¸ºäº†åŠ é€Ÿå®Œæˆåœ°å€æ˜ å°„ï¼Œå‡å°‘åˆ°å†…å­˜è®¿é—®é¡µè¡¨çš„æ¬¡æ•°ï¼ŒTLB(Translation Lookaside Buffer) å‡ºç°äº†ã€‚å®ƒæ˜¯ä¸€ä¸ªå°å‹çš„ç¡¬ä»¶è®¾å¤‡ï¼ŒåŒ…å«äº†å°‘é‡é¡µå’Œé¡µæ¡†çš„æ˜ å°„å…³ç³»ï¼Œå¯ä»¥è®© MMU åœ¨ä¸è®¿é—®å†…å­˜çš„æƒ…å†µä¸‹å®Œæˆè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ã€‚TLB é€šå¸¸åœ¨ CPU å½“ä¸­ï¼Œå®ƒå¾ˆå°ï¼Œå…¶åŒ…å«çš„è¡¨é¡¹æ•°é€šå¸¸åœ¨ 32 å’Œ 1024 ä¹‹é—´ã€‚MMU åœ¨æ”¶åˆ° CPU ç”Ÿæˆçš„è™šæ‹Ÿåœ°å€åï¼Œä¼šé¦–å…ˆæ£€æŸ¥é¡µå·æ˜¯å¦å­˜åœ¨äº TLB ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±å¯ä»¥ç«‹é©¬å¾—åˆ°é¡µæ¡†å·ã€‚å¦‚æœé¡µå·ä¸åœ¨ TLB ä¸­(å‘ç”Ÿ TLBç¼ºå¤±ï¼ˆTLB missï¼‰ )ï¼Œå°±å¿…é¡»å»è®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨ï¼Œè·å–åˆ°é¡µæ¡†å·ä¹‹åï¼Œå†å»è®¿é—®å†…å­˜ã€‚ç„¶åï¼Œå°†åˆšæ‰æ‰€ç”¨çš„é¡µå·å’Œé¡µæ¡†å·æ·»åŠ åˆ° TLB ä¸­ï¼Œä»¥ä¾¿åŠ é€Ÿä¸‹æ¬¡è®¿é—®ã€‚å¦‚æœ TLB å·²ç»æ»¡äº†ï¼Œå°±å¿…é¡»é‡‡ç”¨æŸç§ç½®æ¢ç­–ç•¥ï¼ˆæ¯”å¦‚ LRUï¼‰ä» TLB æ·˜æ±°ä¸€ä¸ªè¡¨é¡¹ï¼Œå¹¶ç”¨æ–°æ‰¾åˆ°çš„é¡µè¡¨é¡¹æ›¿æ¢å®ƒã€‚å½“ TLB ä»é¡µè¡¨åŠ è½½æ—¶ï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½æ¥è‡ªäºå†…å­˜ã€‚\nTLB çš„å®Œæ•´å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š\nTLB ç¼“å­˜æ˜ å°„ TLB ä¸­çš„æ˜ å°„å…³ç³»æ˜¯ä¸€å¯¹ä¸€çš„ï¼Œè¿™ç§åŸºäºç¼“å­˜è¡Œçš„æ˜ å°„æ–¹æ¡ˆä¸»è¦æœ‰ 3 ç§ï¼š\n å…¨ç›¸è”æ˜ å°„ï¼ˆFully Associative Mappingï¼‰ ç›´æ¥æ˜ å°„ï¼ˆDirect Mappingï¼‰ ï¼ˆnè·¯ï¼‰ç»„ç›¸è”æ˜ å°„ï¼ˆ(n-way) Set-Associative Mappingï¼‰  ç›¸è”ï¼ˆAssociativeï¼‰æŒ‡çš„æ˜¯ç¼“å­˜çš„é”®ä¸å€¼ä¹‹é—´çš„æ˜ å°„èŒƒå›´ã€‚å…¨ç›¸è”æ˜ å°„ä¸­ï¼Œä¸€ä¸ªé”®å¯ä»¥æ˜ å°„åˆ°æ‰€æœ‰å€¼ï¼Œè€Œç»„ç›¸è”æ˜ å°„ä¸­ä¸€ä¸ªé”®ä»…å¯ä»¥æ˜ å°„åˆ°ä¸€ç»„å€¼ã€‚\nè‹¥é‡‡ç”¨å…¨ç›¸è”æ˜ å°„å®ç° TLBï¼Œé‚£ä¹ˆåœ¨æ ¹æ®é¡µå·æŸ¥æ‰¾é¡µæ¡†å·æ—¶ï¼Œå°±éœ€è¦éå†æ‰€æœ‰çš„ç¼“å­˜æ¡ç›®ï¼Œåœ¨ç¼“å­˜æ¡ç›®è¾ƒå¤šæ—¶æŸ¥è¯¢é€Ÿåº¦ä¼šä¸‹é™ï¼Œè¿™ç§æ–¹æ¡ˆæœ‰ç€æ˜æ˜¾çš„æ€§èƒ½ç¼ºé™·ã€‚\nç›´æ¥æ˜ å°„æœ‰ç‚¹ç±»ä¼¼äºå“ˆå¸Œå‡½æ•°ï¼Œå‡è®¾ TLB æœ‰ 64 ä¸ªæ¡ç›®ï¼Œé‚£ä¹ˆé€šè¿‡ page number % 64 å°±å¯ä»¥ç›´æ¥è®¡ç®—å‡ºé¡µæ¡†å·çš„ä½ç½®ã€‚ä½†è¿™ç§æ–¹å¼åœ¨ç¼“å­˜å‘½ä¸­ç‡æ–¹é¢åˆä¼šæœ‰é—®é¢˜ã€‚å½“æˆ‘ä»¬éœ€è¦è¿›è¡Œé¡µç½®æ¢æ—¶ï¼Œåªæœ‰å”¯ä¸€çš„é¡µé¢å¯ä¾›é€‰æ‹©ï¼ˆå› ä¸ºç»™å®šè™šæ‹Ÿåœ°å€ï¼Œé¡µæ¡†å°±ç¡®å®šä¸‹æ¥äº†ï¼‰ï¼Œå› ä¸ºç›´æ¥æ˜ å°„å¯¹å„ç§é¡µé¢ç½®æ¢ç®—æ³•å¾ˆä¸å‹å¥½ã€‚\nè‹¥ä¸€ä¸ªé¡µå·å¯ä»¥æ˜ å°„åˆ°å¤šä¸ªï¼ˆæ•°é‡ä¸å¤ªå¤šï¼‰é¡µæ¡†å·ï¼Œåˆ™å¯ä»¥æœ‰æ•ˆé¿å…å…¨ç›¸è”æ˜ å°„çš„æ€§èƒ½é—®é¢˜ï¼Œè¿˜èƒ½è®©é«˜é¢‘ä½¿ç”¨çš„é¡µæ¡†è¢«ä¿ç•™ä¸‹æ¥ï¼Œè¿™å°±æ˜¯ç»„ç›¸è”æ˜ å°„ã€‚ä¾‹å¦‚ï¼Œå› ç‰¹å°” i7 CPU çš„ L1 TLB é‡‡ç”¨ 4-way 64 æ¡ç›®çš„è®¾è®¡ï¼ŒL2 TLB åˆ™é‡‡ç”¨ 8-way 1024 æ¡ç›®çš„è®¾è®¡ã€‚\nå¤§å†…å­˜åˆ†é¡µ å¤šçº§é¡µè¡¨ å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ª32ä½çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œé¡µå¤§å°ä¸º4KBï¼Œé¡µè¡¨é¡¹å¤§å°ä¸º4Bï¼Œé‚£ä¹ˆå³ä½¿ç¨‹åºæ‰€å¼•ç”¨çš„åªæ˜¯è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­å¾ˆå°çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿæ€»æ˜¯éœ€è¦ä¸€ä¸ª4MB($2^{32}\\div2^{12}\\times2^2=2^{22}$)çš„é¡µè¡¨é©»ç•™åœ¨å†…å­˜ä¸­ã€‚å¯¹äº64ä½åœ°å€ç©ºé—´ï¼Œé—®é¢˜å°†å˜çš„æ›´åŠ å¤æ‚ã€‚å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›åœ¨å†…å­˜ä¸­åˆ’å‡ºè¿™ä¹ˆå¤§ä¸€å—è¿ç»­çš„åŒºåŸŸç”¨æ¥å­˜å‚¨é¡µè¡¨ã€‚å¤šçº§é¡µè¡¨çš„ç§˜è¯€å°±åœ¨äºï¼šé¿å…è®©æ•´ä¸ªé¡µè¡¨ä¸€ç›´é©»ç•™åœ¨å†…å­˜ä¸­ï¼Œå°¤å…¶ä¸åº”è¯¥ä¿ç•™é‚£äº›ç”¨ä¸ä¸Šçš„é¡µã€‚\nå¯¹äºäºŒçº§é¡µè¡¨è€Œè¨€ï¼Œé¡µè¡¨æœ¬èº«ä¹Ÿè¢«åˆ†æˆäº†å¾ˆå¤šé¡µã€‚è€ƒè™‘ä¸€ä¸ª32ä½çš„åœ°å€ç©ºé—´ï¼Œè‹¥é¡µå¤§å°ä¸º4KBï¼Œåˆ™è™šæ‹Ÿåœ°å€è¢«åˆ†æˆ20ä½é¡µå·å’Œ12ä½é¡µåç§»ã€‚å› ä¸ºæˆ‘ä»¬ä¹Ÿå¯¹é¡µè¡¨åˆ†é¡µï¼Œæ‰€ä»¥é¡µå·è¿›ä¸€æ­¥è¢«åˆ’åˆ†ä¸º10ä½é¡µå·å’Œ10ä½é¡µåç§»ã€‚å› æ­¤ï¼Œè™šæ‹Ÿåœ°å€å¯ä»¥è¡¨ç¤ºæˆä¸‹é¢è¿™æ ·ï¼š\nåœ¨ä¸Šé¢çš„è™šæ‹Ÿåœ°å€ä¸­ï¼Œp1ç´¢å¼•å¤–å±‚é¡µè¡¨ï¼Œp2ç´¢å¼•å†…å±‚é¡µè¡¨ï¼Œdä¸ºé¡µåç§»ã€‚è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„ç¿»è¯‘è¿‡ç¨‹å¦‚ä¸‹ï¼š\nä¸€çº§é¡µè¡¨ä¸­çš„æ¯ä¸ªè¡¨é¡¹è´Ÿè´£æ˜ å°„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸€ä¸ª4MBçš„å—ï¼Œè€ŒäºŒçº§é¡µè¡¨ä¸­çš„æ¯ä¸ªè¡¨é¡¹éƒ½è´Ÿè´£æ˜ å°„ä¸€ä¸ª4KBçš„è™šæ‹Ÿå†…å­˜é¡µé¢ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ª32ä½çš„è™šæ‹Ÿåœ°å€0x00403004(åè¿›åˆ¶ä¸º4206596)ï¼Œè¿™ä¸ªè™šæ‹Ÿåœ°å€å¯¹åº”p1=1, p2=3, d=4ã€‚MMUé¦–å…ˆä½¿ç”¨p1æ¥ç´¢å¼•ä¸€çº§é¡µè¡¨å¾—åˆ°è¡¨é¡¹1ï¼Œå®ƒå¯¹åº”åœ°å€4M ~ 8M-1(ç¬¬1ä¸ª4Må—)ã€‚ç„¶åä½¿ç”¨p2æ¥ç´¢å¼•äºŒçº§é¡µè¡¨å¾—åˆ°è¡¨é¡¹2ï¼Œå®ƒå¯¹åº”çš„è™šæ‹Ÿåœ°å€èŒƒå›´æ˜¯å®ƒæ‰€åœ¨4Må—å†…çš„12288 ~ 16383(ç¬¬3ä¸ª4Kå—)ï¼Œå¯¹åº”ç»å¯¹åœ°å€4206592 ~ 4210687ï¼Œï¼Œè¿™ä¸ªè¡¨é¡¹å°±å«æœ‰è™šæ‹Ÿåœ°å€0x00403004çš„é¡µæ¡†å·ã€‚\näºŒçº§é¡µè¡¨ä»ä¸¤ä¸ªæ–¹é¢å‡å°‘äº†å†…å­˜å ç”¨ï¼š\n å¦‚æœä¸€çº§é¡µè¡¨ä¸­çš„æŸä¸ªè¡¨é¡¹æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆç›¸åº”çš„äºŒçº§é¡µè¡¨å°±æ ¹æœ¬ä¸å­˜åœ¨ã€‚ åªæœ‰ä¸€çº§é¡µè¡¨æ‰éœ€è¦å¸¸é©»å†…å­˜ï¼Œç³»ç»Ÿå¯ä»¥åœ¨éœ€è¦æ—¶åˆ›å»ºã€æ¢å…¥æˆ–æ¢å‡ºäºŒçº§é¡µè¡¨ã€‚åªæœ‰æœ€å¸¸ä½¿ç”¨çš„äºŒçº§é¡µè¡¨æ‰éœ€è¦ç¼“å­˜åœ¨ä¸»å­˜ä¸­ã€‚  ä»¥ä¸Šæ‰€è¯´çš„äºŒçº§é¡µè¡¨å¯ä»¥æ‰©å……ä¸ºä¸‰çº§ã€å››çº§ç”šè‡³æ›´å¤šçº§ã€‚çº§æ•°è¶Šå¤šï¼Œçµæ´»æ€§è¶Šå¤§ã€‚\nå“ˆå¸Œé¡µè¡¨ å¯¹äº32ä½çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå¤šçº§é¡µè¡¨å¯ä»¥å·¥ä½œå¾—å¾ˆå¥½ã€‚ä½†å¯¹äºæ›´å¤§çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå¤šçº§é¡µè¡¨å°±ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„äº†ï¼Œè¿™ä¸ªæ—¶å€™ä¸€èˆ¬ä½¿ç”¨ å“ˆå¸Œé¡µè¡¨ï¼ˆhashed page tableï¼‰ã€‚ å“ˆå¸Œé¡µè¡¨å¯¹è™šæ‹Ÿé¡µå·è¿›è¡Œå“ˆå¸Œå¾—åˆ°å“ˆå¸Œå€¼ï¼Œå“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸ªè¡¨é¡¹éƒ½åŒ…æ‹¬ä¸€ä¸ªé“¾è¡¨(è§£å†³å“ˆå¸Œå†²çª)ï¼Œé“¾è¡¨çš„èŠ‚ç‚¹åŒ…å«3ä¸ªå­—æ®µï¼šè™šæ‹Ÿé¡µå·ã€è™šæ‹Ÿé¡µå·æ˜ å°„çš„é¡µæ¡†å·å’ŒæŒ‡å‘ä¸‹ä¸€èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚\nç®—æ³•é¦–å…ˆå°†è™šæ‹Ÿåœ°å€ä¸­çš„è™šæ‹Ÿé¡µå·å“ˆå¸Œåˆ°å“ˆå¸Œè¡¨ï¼Œç„¶åå°†è™šæ‹Ÿé¡µå·å’Œå“ˆå¸Œè¡¨ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„è™šæ‹Ÿé¡µå·ç›¸æ¯”ï¼Œè‹¥ç›¸åŒï¼Œåˆ™ä½¿ç”¨è¯¥å…ƒç´ ä¸­çš„é¡µæ¡†å·å»ç”Ÿæˆç‰©ç†åœ°å€ï¼Œå¦åˆ™æ²¿ç€é“¾è¡¨ç»§ç»­æœç´¢ã€‚\nåå‘é¡µè¡¨ åå‘é¡µè¡¨ï¼ˆinverted page tableï¼‰ æ˜¯å¤šçº§é¡µè¡¨çš„ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆã€‚åå‘é¡µè¡¨ä¸­ï¼Œæ¯ä¸€ä¸ªè¡¨é¡¹å¯¹åº”çš„æ˜¯ä¸€ä¸ªé¡µæ¡†ï¼Œè€Œä¸å†æ˜¯é¡µã€‚å¦‚æœè¯´å¤šçº§é¡µè¡¨æ˜¯ä¸ºè™šæ‹Ÿåœ°å€ç©ºé—´è®¾è®¡çš„ï¼Œé‚£ä¹ˆåå‘é¡µè¡¨å°±æ˜¯ä¸ºç‰©ç†åœ°å€ç©ºé—´è®¾è®¡çš„ã€‚åå‘é¡µè¡¨ä¸­çš„æ¯ä¸ªè¡¨é¡¹éƒ½è®°å½•äº†è¯¥é¡µæ¡†å¯¹åº”çš„è™šæ‹Ÿé¡µå’Œæ‹¥æœ‰è¯¥è™šæ‹Ÿé¡µçš„è¿›ç¨‹çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ªé¡µè¡¨ï¼Œå¹¶ä¸”å¯¹äºæ¯ä¸ªé¡µæ¡†æ¥è¯´ï¼Œåªæœ‰ä¸€ä¸ªè¡¨é¡¹å’Œå®ƒå¯¹åº”ã€‚\nå› ä¸ºæ˜¯æ‰€æœ‰è¿›ç¨‹å…¬ç”¨ä¸€ä¸ªé¡µè¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åŒºåˆ†å‡ºä¸åŒè¿›ç¨‹ï¼Œä¸Šå›¾åœ¨æŸ¥æ‰¾é¡µè¡¨æ—¶ä½¿ç”¨è¿›ç¨‹idã€‚å½“éœ€è¦è®¿é—®å†…å­˜æ—¶ï¼Œå†…å­˜å­ç³»ç»Ÿä¼šä½¿ç”¨è¿›ç¨‹idå’Œè™šæ‹Ÿé¡µå·æ¥æœç´¢é¡µè¡¨ï¼Œå¦‚æœåœ¨è¡¨é¡¹iå¤„æ‰¾åˆ°äº†ç¬¦åˆè¦æ±‚çš„ä¿¡æ¯ï¼Œåˆ™ä½¿ç”¨iå’Œdç”Ÿæˆç‰©ç†åœ°å€ã€‚è‹¥æœç´¢å¤±è´¥ï¼Œåˆ™è¯´æ˜è¿™æ˜¯ä¸€ä¸ªéæ³•çš„åœ°å€è®¿é—®ã€‚\nå°½ç®¡åå‘é¡µè¡¨èŠ‚çœäº†å¤§é‡ç©ºé—´ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸¥é‡çš„ç¼ºé™·ï¼šä»è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢å˜å¾—éå¸¸å›°éš¾ã€‚å½“è¿›ç¨‹è®¿é—®é¡µé¢pæ—¶ï¼Œç¡¬ä»¶ä¸èƒ½å†é€šè¿‡å°†pä½œä¸ºé¡µè¡¨ç´¢å¼•æ¥æŸ¥æ‰¾ç‰©ç†é¡µæ¡†ï¼Œè€Œæ˜¯å¿…é¡»æœç´¢æ•´ä¸ªåå‘é¡µè¡¨æ¥æŸ¥æ‰¾æ»¡è¶³è¦æ±‚çš„è¡¨é¡¹ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªå†…å­˜è®¿é—®æ“ä½œéƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡æœç´¢æ“ä½œã€‚\nTLBèƒ½å¤Ÿå¸®åŠ©ç¼“è§£æ–¹å‘é¡µè¡¨çš„ç¼ºé™·ï¼Œå¦‚æœTLBèƒ½å¤Ÿè®°å½•æ‰€æœ‰é¢‘ç¹è®¿é—®çš„é¡µï¼Œåœ°å€è½¬æ¢å°±å¯èƒ½å˜å¾—åƒå¾€å¸¸çš„é¡µè¡¨ä¸€æ ·å¿«ã€‚ä½†æ˜¯å½“TLBæœªå‘½ä¸­æ—¶ï¼Œéœ€è¦ä½¿ç”¨è½¯ä»¶æœç´¢æ•´ä¸ªåå‘é¡µè¡¨ï¼Œä¸€ä¸ªå¯è¡Œçš„æ–¹æ³•æ˜¯å»ºç«‹ä¸€å¼ å“ˆå¸Œè¡¨ï¼Œç”¨è™šæ‹Ÿåœ°å€æ¥å“ˆå¸Œï¼Œå°†å†…å­˜ä¸­å…·æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„è™šæ‹Ÿé¡µé“¾æ¥åœ¨ä¸€ä¸ªé“¾è¡¨ä¸Šã€‚ä¸€æ—¦æ–°çš„é¡µæ¡†å·è¢«æ‰¾åˆ°ï¼Œå°±æ›´æ–°TLBã€‚\nå¤§é¡µè¡¨ è‹¥æœ‰ä¸€ä¸ªè¿›ç¨‹éœ€è¦ 1G çš„å†…å­˜ï¼Œè€Œé»˜è®¤åˆ†é¡µå¤§å°ä¸º 4Kï¼Œè¿™æ—¶è¯¥è¿›ç¨‹å°±éœ€è¦ $1G / 4K = 262144$ ä¸ªé¡µã€‚å³ä½¿æ˜¯æ‹¥æœ‰ 1024 ä¸ªæ¡ç›®çš„ i7 L2 TLB ä¹Ÿä¼š $262144 / 1024 = 256$ ä¸ªé¡µå¤ç”¨ 1 ä¸ªç¼“å­˜è¡Œçš„æƒ…å†µï¼Œå¾ˆå®¹æ˜“å†²çªï¼Œè¿™æ˜¯å¯ä»¥è€ƒè™‘é‡‡ç”¨å¤§å†…å­˜åˆ†é¡µï¼ˆLarge Page æˆ– Huge Pageï¼‰ã€‚è‹¥æ“ä½œç³»ç»Ÿæä¾› 4M å¤§å°çš„é¡µï¼Œåˆ™åªéœ€è¦ 256 ä¸ªé¡µï¼Œè¿™èƒ½å¤§å¤§æé«˜ TLB çš„æŸ¥è¯¢æ€§èƒ½ã€‚Linux å†…æ ¸è‡³ 2.6 ç‰ˆæœ¬èµ·å°±æä¾›äº† HugePage çš„åŠŸèƒ½ï¼Œé»˜è®¤ä¸å¼€å¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ç³»ç»Ÿé…ç½®é¡¹æ¥å¼€å¯å®ƒï¼Œå…·ä½“æ“ä½œæ–¹æ³•å¯ä»¥å‚è€ƒ Debian çš„ wikiã€‚\né¡µé¢ç½®æ¢ç®—æ³• å½“ç¼ºé¡µä¸­æ–­å‡ºç°æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»ä»å†…å­˜ä¸­æ¢å‡ºä¸€ä¸ªé¡µï¼Œä»¥ä¾¿ä¸ºå³å°†è°ƒå…¥çš„é¡µè…¾å‡ºç©ºé—´ã€‚å¦‚æœè¢«æ¢å‡ºçš„é¡µåœ¨é©»ç•™å†…å­˜æœŸé—´è¢«ä¿®æ”¹è¿‡ï¼Œåˆ™å¿…é¡»æ›´æ–°å…¶åœ¨ç¡¬ç›˜ä¸Šçš„å‰¯æœ¬ã€‚ä½†æ˜¯å¦‚ä½•é€‰æ‹©è¦æ¢å‡ºçš„é¡µå‘¢ï¼Œä¸åŒçš„é¡µé¢ç½®æ¢ç®—æ³•é‡‡ç”¨äº†ä¸åŒçš„ç½®æ¢ç­–ç•¥ã€‚TLB ä½œä¸ºé¡µè¡¨çš„é«˜é€Ÿç¼“å­˜ï¼Œå®ƒåº”è¯¥å°½å¯èƒ½åœ°å°†æœªæ¥ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„æ•°æ®ä¿ç•™ä½ï¼Œå¹¶æ¢å‡ºæœªæ¥ä½¿ç”¨é¢‘ç‡æœ€ä½çš„æ•°æ®ã€‚\nå½“æˆ‘ä»¬è®¿é—®ç¼“å­˜æŸ¥æ‰¾æ•°æ®æ—¶ï¼Œè¦ä¹ˆå‘½ä¸­ï¼ˆHitï¼‰ï¼Œè¦ä¹ˆç¼ºå¤±ï¼ˆMissï¼‰ã€‚å‡è®¾è®¿é—®ç¼“å­˜çš„æ—¶é—´ï¼ˆå»¶è¿Ÿï¼‰æ˜¯ Lï¼Œè®¿é—®ç¼“å­˜æ•°æ®ç¼ºå¤±çš„æ¦‚ç‡ä¸º Mï¼Œç¼ºå¤±çš„å¹³å‡ä»£ä»·æ˜¯ Cï¼ˆå³ç¼“å­˜ç¼ºå¤±åè·å–æ•°æ®çš„å¹³å‡æ—¶é—´ï¼‰ï¼Œåˆ™ç¼“å­˜çš„å¹³å‡å“åº”æ—¶é—´ä¸ºï¼š\n$$ (1 - M) \\times L + M \\times C = L + (C - L) \\times M $$\nL é€šå¸¸æ˜¯ä¸ä¼šå˜çš„ï¼Œå®ƒæœ‰ç¼“å­˜æœ¬èº«å†³å®šã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•é™ä½ C å’Œ Mï¼Œé¡µé¢ç½®æ¢ç®—æ³•ä¸»è¦è€ƒè™‘çš„å°±æ˜¯å¦‚ä½•æé«˜ç¼“å­˜å‘½ä¸­ç‡ã€‚\næœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³• æœ€ä¼˜ï¼ˆoptimal, OPTï¼‰ é¡µé¢ç½®æ¢ç®—æ³•çš„æ€æƒ³æ˜¯ï¼šè€ƒå¯Ÿæ¯é¡µæ¥ä¸‹æ¥ä¸è¢«è®¿é—®çš„æ—¶é—´ï¼Œç½®æ¢æ‰ä¸è¢«è®¿é—®æ—¶é—´æœ€é•¿çš„é‚£ä¸ªé¡µã€‚\nå¯¹å›ºå®šæ•°é‡çš„é¡µæ¡†æ¥è¯´ï¼Œæœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•èƒ½å¤Ÿä¿è¯æœ€ä½çš„é¡µé”™è¯¯ç‡ã€‚è¯¥ç®—æ³•éš¾ä»¥å®ç°ï¼Œå› ä¸ºç®—æ³•éœ€è¦çŸ¥é“é¡µåœ¨æœªæ¥çš„ä½¿ç”¨æƒ…å†µã€‚\næœ€è¿‘æœªä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³• ä»æ¦‚ç‡ä¸Šè¯´ï¼Œæœ€è¿‘æ²¡æœ‰ä½¿ç”¨çš„æ•°æ®ï¼Œæœªæ¥ä½¿ç”¨çš„æ¦‚ç‡ä¼šæ¯”æœ€è¿‘ç»å¸¸ä½¿ç”¨çš„æ•°æ®ä½ã€‚ æ“ä½œç³»ç»Ÿå¯ä»¥ä¸ºæ¯ä¸€é¡µè®¾ç½®ä¸€ä¸ªä¸¤ä¸ªæ ‡å¿—ä½ï¼šR è¡¨ç¤ºé¡µæœ€è¿‘çš„è®¿é—®æƒ…å†µï¼ŒM è¡¨ç¤ºé¡µæœ€è¿‘çš„ä¿®æ”¹æƒ…å†µï¼Œè®¿é—®é¡µæ—¶ï¼Œå°† R ä½è®¾ä¸º 1ï¼Œä¿®æ”¹é¡µæ—¶ï¼Œå°† M ä½è®¾ä¸º 1ã€‚å°†å‡ºç° 4 ç±»ç»„åˆï¼š\n 00ï¼šæœªè®¿é—®ï¼Œæœªä¿®æ”¹ã€‚ 01ï¼šæœªè®¿é—®ï¼Œå·²ä¿®æ”¹ã€‚ 10ï¼šå·²è®¿é—®ï¼Œæœªä¿®æ”¹ã€‚ 11ï¼šå·²è®¿é—®ï¼Œå·²ä¿®æ”¹ã€‚  æœ€è¿‘æœªä½¿ç”¨ï¼ˆNot Recently Used, NRUï¼‰ é¡µé¢ç½®æ¢ç®—æ³•åœ¨å‘ç”Ÿé¡µé”™è¯¯æ—¶ï¼Œéšæœºä» RM å€¼æœ€å°çš„é¡µä¸­é€‰å–ä¸€ä¸ªæ·˜æ±°ã€‚ç®—æ³•éšå«çš„æ„æ€æ˜¯ï¼šåœ¨æœ€è¿‘ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ï¼Œæ·˜æ±°ä¸€ä¸ªæ²¡æœ‰è¢«è®¿é—®ä½†å·²ä¿®æ”¹çš„é¡µæ¯”æ·˜æ±°ä¸€ä¸ªè¢«é¢‘ç¹è®¿é—®ä½†æœªä¿®æ”¹çš„é¡µè¦å¥½ã€‚\nå…ˆè¿›å…ˆå‡ºé¡µé¢ç½®æ¢ç®—æ³• æ“ä½œç³»ç»Ÿç»´æŠ¤ä¸€ä¸ªæ‰€æœ‰å½“å‰åœ¨å†…å­˜ä¸­çš„é¡µçš„é“¾è¡¨ï¼Œæœ€æ–°æ¢å…¥çš„é¡µæ”¾åœ¨é“¾è¡¨å°¾ï¼Œè€Œæœ€æ—©æ¢å…¥çš„é¡µåœ¨é“¾è¡¨å¤´ã€‚å½“å‘ç”Ÿé¡µé”™è¯¯æ—¶ï¼Œå…ˆè¿›å…ˆå‡ºï¼ˆFirst-In First-Out, FIFOï¼‰ é¡µé¢ç½®æ¢ç®—æ³•ä¼šæ·˜æ±°é“¾è¡¨å¤´éƒ¨çš„é¡µé¢ï¼Œå¹¶å°†æ–°æ¢å…¥çš„é¡µé¢æ”¾åœ¨é“¾è¡¨å°¾ã€‚ç®—æ³•æœ¬èº«å¾ˆç®€å•ï¼Œä½†æ²¡æœ‰åˆ©ç”¨åˆ°ç¼“å­˜çš„å±€éƒ¨æ€§åŸç†ï¼Œå¯èƒ½å°†ç»å¸¸ä½¿ç”¨çš„é¡µæ¢å‡ºã€‚\nç¬¬äºŒæ¬¡æœºä¼šé¡µé¢ç½®æ¢ç®—æ³• ä¸ºäº†é¿å… FIFO ç®—æ³•å¯èƒ½å°†å¸¸ç”¨é¡µé¢æ¢å‡ºè¿™ä¸€é—®é¢˜ï¼Œç¬¬äºŒæ¬¡æœºä¼šï¼ˆsecond chanceï¼‰ ç®—æ³•æ£€æŸ¥æœ€è€é¡µçš„ R ä½ï¼Œå¦‚æœä¸º 0ï¼ˆè¿™ä¸ªé¡µé¢æœªè¢«è®¿é—®ï¼‰ï¼Œç«‹å³æ¢å‡ºï¼›å¦‚æœä¸º1ï¼Œå°±å°†Rä½çš„å€¼é‡ç½®ä¸º0ï¼Œå¹¶å°†è¯¥é¡µæ”¾åˆ°é“¾è¡¨å°¾ï¼Œä¿®æ”¹è½½å…¥æ—¶é—´ä½¿å¾—å®ƒçœ‹èµ·æ¥å°±åƒæ˜¯åˆšè¢«åŠ è½½åˆ°å†…å­˜çš„ä¸€æ ·ï¼Œç„¶åç»§ç»­æœç´¢ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæœªè®¿é—®ï¼ˆR=0ï¼‰çš„é¡µã€‚è‹¥æ‰€æœ‰çš„é¡µéƒ½è¢«è®¿é—®è¿‡ï¼Œç¬¬äºŒæ¬¡æœºä¼šç®—æ³•å°±é€€åŒ–æˆäº†çš„ FIFO ç®—æ³•ï¼Œç®—æ³•å°†æŠŠæ‰€æœ‰çš„é¡µéƒ½è®¿é—®ä¸€éå¹¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é‡ç½® R ä½ï¼Œæœ€ç»ˆç”±å›åˆ°ç¬¬ä¸€ä¸ª R ä½è¢«é‡ç½®çš„é¡µï¼Œå¹¶å°†å…¶æ·˜æ±°ï¼Œæ‰€ä»¥ç®—æ³•æ€»æ˜¯å¯ä»¥ç»“æŸçš„ã€‚\næ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³• å°½ç®¡ç¬¬äºŒæ¬¡æœºä¼šç®—æ³•å¾ˆåˆç†ï¼Œä½†å®ƒç»å¸¸éœ€è¦åœ¨é“¾è¡¨ä¸­ç§»åŠ¨é¡µï¼Œè¿™ä¸€æ“ä½œå¯èƒ½ä¸æ˜¯å¾ˆæœ‰å¿…è¦ï¼Œè¿˜é™ä½äº†æ•ˆç‡ã€‚ä¸€ä¸ªæ›´å¥½çš„åŠæ³•æ˜¯å°†æ‰€æœ‰çš„é¡µéƒ½ä¿å­˜åœ¨ä¸€ä¸ªç±»ä¼¼äºé’Ÿé¢çš„ç¯å½¢é“¾è¡¨ä¸­ï¼Œå¹¶ç”¨ä¸€ä¸ªè¡¨é’ˆæŒ‡å‘æœ€è€çš„é¡µé¢ã€‚å½“å‘ç”Ÿé¡µé”™è¯¯æ—¶ï¼Œç®—æ³•é¦–å…ˆæ£€æŸ¥è¡¨é’ˆæŒ‡å‘çš„é¡µï¼Œæ ¹æ®è¯¥é¡µçš„Rä½è¿›è¡Œæ“ä½œï¼šè‹¥ä¸º0ï¼Œåˆ™æ·˜æ±°è¯¥é¡µé¢ï¼Œå¦åˆ™æ¸…é™¤Rä½å¹¶å‘å‰ç§»åŠ¨è¡¨é’ˆï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªRä½ä¸º0çš„é¡µå¹¶å°†å…¶æ¢å‡ºã€‚è¿™å°±æ˜¯ æ—¶é’Ÿï¼ˆclockï¼‰ ç®—æ³•ã€‚\næœ€è¿‘æœ€å°‘ä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³• åŸºäºå±€éƒ¨æ€§åŸç†ï¼Œåœ¨å‰é¢å‡ æ¡æŒ‡ä»¤ä¸­é¢‘ç¹ä½¿ç”¨çš„é¡µå¾ˆæœ‰å¯èƒ½åœ¨åé¢çš„å‡ æ¡æŒ‡ä»¤ä¸­è¢«ä½¿ç”¨ã€‚å½“å‘ç”Ÿé¡µé”™è¯¯æ—¶ï¼Œç½®æ¢æœªä½¿ç”¨æ—¶é—´æœ€é•¿çš„é¡µï¼Œè¿™å°±æ˜¯ æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLeast Recently Used, LRUï¼‰ ç®—æ³•ã€‚å’Œ NRU ç›¸æ¯”ï¼ŒLRU ä¼šè€ƒè™‘ä¸€ä¸ªæ—¶é—´èŒƒå›´å†…çš„æ•°æ®ï¼Œæ•°æ®çš„å‚è€ƒèŒƒå›´æ›´å¤§ã€‚LRU çš„æ€æƒ³æ˜¯ï¼šæœ€è¿‘ä¸€æ®µæ—¶é—´æœ€å°‘ä½¿ç”¨åˆ°çš„æ•°æ®åº”è¯¥è¢«æ·˜æ±°ï¼Œç©ºé—´åº”è¯¥ç•™ç»™æœ€è¿‘é¢‘ç¹ä½¿ç”¨çš„æ•°æ®ã€‚\nLRU æ˜¯ä¸€ä¸ªä¸é”™çš„ç®—æ³•ï¼Œä¸»è¦çš„é—®é¢˜å°±æ˜¯å¦‚ä½•å®ç° LRU ç®—æ³•ã€‚ç®—æ³•çš„å®ç°å¯èƒ½éœ€è¦ç¡¬ä»¶çš„æ”¯æŒï¼Œé—®é¢˜å°±åœ¨äºå¦‚ä½•å¿«é€Ÿæ‰¾åˆ°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é‚£ä¸ªé¡µã€‚å¸¸è§çš„å®ç°æœ‰ä¸¤ç§ï¼š\n ä½¿ç”¨è®¡æ•°å™¨ã€‚ä¸ºé¡µè¡¨ä¸­çš„æ¯ä¸ªè¡¨é¡¹éƒ½å…³è”ä¸€ä¸ªä¸Šæ¬¡ä½¿ç”¨æ—¶é—´ï¼ˆtime-of-useï¼‰çš„å­—æ®µå’Œä¸€ä¸ªè®¡æ•°å™¨ï¼ˆè®°å½•é€»è¾‘ä¸Šé¡µçš„ä¸Šæ¬¡è®¿é—®æ—¶é—´ï¼‰ã€‚å½“é¡µè¢«è®¿é—®æ—¶ï¼Œè®¡æ•°å™¨åŠ ä¸€ï¼Œç„¶åå°†è®¡æ•°å™¨çš„å€¼æ›´æ–°åˆ°å¯¹åº”çš„ time-of-use ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ¢å‡º time-of-use å€¼æœ€å°çš„é¡µã€‚è¿™ç§å®ç°åœ¨æ¯æ¬¡è®¿é—®å†…å­˜æ—¶éƒ½éœ€è¦åœ¨é¡µè¡¨ä¸­æœç´¢ LRU é¡µå¹¶ä¿®æ”¹è¯¥é¡µçš„ time-of-use å€¼ã€‚ ä½¿ç”¨é˜Ÿåˆ—ã€‚ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—å°è¯•å–ç¬¬ä¸€æ¡æŒ‡ä»¤æ—¶ï¼Œå°†è§¦å‘ç¼ºé¡µä¸­æ–­ï¼Œè¿«ä½¿æ“ä½œç³»ç»Ÿå°†åŒ…å«ç¬¬ä¸€æ¡æŒ‡ä»¤çš„é¡µè£…å…¥åˆ°å†…å­˜ã€‚ç”±å…¨å±€å˜é‡å’Œæ ˆå¼•èµ·çš„é¡µé”™è¯¯é€šå¸¸ä¹Ÿä¼šæ¥è¸µè€Œè‡³ã€‚ä¸€æ®µæ—¶é—´åï¼Œè¿›ç¨‹éœ€è¦çš„å¤§éƒ¨åˆ†é¡µéƒ½åœ¨å†…å­˜ä¸­äº†ï¼Œè¿›ç¨‹å¼€å§‹åœ¨é¡µé”™è¯¯å‘ç”Ÿé¢‘ç‡è¾ƒä½çš„æƒ…å†µä¸‹è¿è¡Œã€‚è¿™ä¸ªç­–ç•¥è¢«ç§°ä¸ºè¯·æ±‚è°ƒé¡µï¼ˆdemand pagingï¼‰ï¼Œå› ä¸ºé¡µæ˜¯æŒ‰éœ€è½½å…¥ï¼Œè€Œä¸æ˜¯é¢„å…ˆè½½å…¥ã€‚  å¤§éƒ¨åˆ†è¿›ç¨‹åœ¨å·¥ä½œæ—¶éƒ½ä¼šè¡¨ç°å‡ºä¸€ç§ å±€éƒ¨æ€§è®¿é—®ï¼ˆlocality of referenceï¼‰ è¡Œä¸ºï¼Œå³è¿›ç¨‹ä¸ä¼šå‡åŒ€åœ°è®¿é—®å®ƒçš„åœ°å€ç©ºé—´ï¼Œè®¿é—®å¾€å¾€æ˜¯é›†ä¸­äºä¸€å°éƒ¨åˆ†é¡µä¸Šã€‚ä¸€ä¸ªè¿›ç¨‹å½“å‰æ­£åœ¨ä½¿ç”¨çš„é¡µçš„é›†åˆè¢«ç§°ä¸ºå®ƒçš„ å·¥ä½œé›†ï¼ˆworking setï¼‰ï¼Œå¦‚æœæ•´ä¸ªå·¥ä½œé›†éƒ½åœ¨å†…å­˜ä¸­ï¼Œé‚£ä¹ˆè¿›ç¨‹å¾ˆå°‘ä¼šé‡åˆ°é¡µé”™è¯¯ã€‚è‹¥å†…å­˜å¤ªå°è€Œæ— æ³•å®¹çº³æ•´ä¸ªå·¥ä½œé›†ï¼Œè¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å°±ä¼šé‡åˆ°å¤§é‡çš„é¡µé”™è¯¯ï¼Œè¿›è€Œå‡æ…¢è¿›ç¨‹çš„è¿è¡Œé€Ÿåº¦ã€‚å¦‚æœç¨‹åºæ¯æ‰§è¡Œå‡ æ¡æŒ‡ä»¤å°±äº§ç”Ÿä¸€ä¸ªé¡µé”™è¯¯ï¼Œé‚£ä¹ˆå°±ç§°è¿™ä¸ªç¨‹åºå‡ºç°äº†é¢ ç°¸ï¼ˆtrashingï¼‰ã€‚\nä¸å°‘åˆ†é¡µç³»ç»Ÿéƒ½ä¼šè®¾æ³•è¿½è¸ªè¿›ç¨‹çš„å·¥ä½œé›†ï¼Œä»¥ç¡®ä¿è¿›ç¨‹çš„å·¥ä½œé›†åœ¨è¿›ç¨‹è¿è¡Œå‰å°±åœ¨å†…å­˜ä¸­ï¼Œè¿™ç§æ–¹æ³•è¢«ç§°ä¸º å·¥ä½œé›†æ¨¡å‹ï¼ˆworking set modelï¼‰ï¼Œç›®çš„åœ¨äºå¤§å¤§é™ä½é¡µé”™è¯¯ç‡ã€‚åœ¨è¿›ç¨‹è¿è¡ŒæœŸé¢„å…ˆè½½å…¥å…¶å·¥ä½œé›†ä¹Ÿå« é¢„å…ˆè°ƒé¡µï¼ˆprepagingï¼‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿›ç¨‹çš„å·¥ä½œé›†æ˜¯éšæ—¶é—´å˜åŒ–çš„ã€‚å·¥ä½œé›†ç®—æ³•çš„æ€æƒ³å°±æ˜¯ï¼šå½“å‘ç”Ÿé¡µé”™è¯¯æ—¶ï¼Œæ·˜æ±°ä¸€ä¸ªä¸åœ¨å·¥ä½œé›†ä¸­çš„é¡µï¼Œå¦‚æœé¡µè¡¨ä¸­æ‰€æœ‰çš„é¡µéƒ½åœ¨å·¥ä½œé›†ä¸­ï¼Œå°±æ·˜æ±°ç”Ÿå­˜æ—¶é—´æœ€é•¿çš„é‚£ä¸ªã€‚\nå·¥ä½œé›†æ—¶é’Ÿé¡µé¢ç½®æ¢ç®—æ³• å·¥ä½œé›†ç®—æ³•å…¶å®æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œå› ä¸ºå½“é¡µé”™è¯¯å‘ç”Ÿæ—¶ï¼Œå¯èƒ½éœ€è¦æ‰«ææ•´ä¸ªé¡µè¡¨æ‰èƒ½ç¡®å®šè¢«æ·˜æ±°çš„é¡µã€‚æœ‰ä¸€ç§æ”¹è¿›çš„ç®—æ³•ï¼Œå®ƒåŸºäºæ—¶é’Ÿç®—æ³•ï¼Œåˆä½¿ç”¨äº†å·¥ä½œé›†ä¿¡æ¯ï¼Œç§°ä¸º WSClockã€‚\nä¹Ÿæ—¶é’Ÿç®—æ³•ä¸€æ ·ï¼ŒWSClock ä¹Ÿéœ€è¦ä¸€ä¸ªå¾ªç¯é“¾è¡¨ã€‚ä¸€å¼€å§‹ï¼Œé“¾è¡¨æ˜¯ç©ºçš„ã€‚å½“ç¬¬ä¸€ä¸ªé¡µè¢«è½½å…¥åï¼Œå®ƒä¹Ÿè¢«åŠ åˆ°é“¾è¡¨ä¸­ã€‚éšç€è¶Šæ¥è¶Šå¤šçš„é¡µåŠ å…¥åˆ°é“¾è¡¨ï¼Œå®ƒä»¬ä¼šå½¢æˆä¸€ä¸ªç¯ã€‚ä¾ç„¶ä½¿ç”¨ä¸€ä¸ªè¡¨é’ˆæŒ‡å‘æœ€è€çš„é¡µé¢ï¼Œå½“å‘ç”Ÿé¡µé”™è¯¯æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¡¨é’ˆæŒ‡å‘çš„é¡µï¼Œå¦‚æœRä½ä¸º1ï¼Œè¯´æ˜è¯¥é¡µæœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œä¸é€‚åˆè¢«æ·˜æ±°ï¼Œäºæ˜¯å°†è¯¥é¡µçš„Rä½é‡ç½®ï¼ŒæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€é¡µï¼›è‹¥Rä½ä½0ï¼Œå…ˆæ£€æŸ¥è¿™ä¸ªé¡µæ˜¯å¦è¢«ä¿®æ”¹ï¼Œå¦‚æœæœªè¢«ä¿®æ”¹ï¼Œç½®æ¢å®ƒï¼Œå¦åˆ™è¡¨é’ˆç»§ç»­å‰ç§»(é¿å…ç”±äºè°ƒåº¦ç¡¬ç›˜å†™æ“ä½œå¼•èµ·çš„è¿›ç¨‹åˆ‡æ¢ï¼Œå› ä¸ºå†…å­˜ä¸­è¢«ä¿®æ”¹è¿‡çš„é¡µåœ¨æ¢å‡ºå‰éœ€è¦è¢«åŒæ­¥å›ç¡¬ç›˜)ï¼ŒæœŸæœ›æ‰¾åˆ°ä¸€ä¸ªæœªè®¿é—®ä¸”æœªä¿®æ”¹çš„é¡µã€‚\næ®µå¼ç®¡ç† æ®µï¼ˆsegmentationï¼‰ æŒ‡ä¸€æ®µå›ºå®šé•¿åº¦çš„ï¼Œè¿ç»­çš„åœ°å€ç©ºé—´ã€‚ä¾‹å¦‚å°†ä¸€ä¸ªç¨‹åºåˆ†ä¸ºä»£ç æ®µã€æ•°æ®æ®µã€å †æ ˆæ®µç­‰ï¼Œæ¯ä¸ªæ®µéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚æœ‰ä¸¤ç§ç±»å‹çš„æ®µï¼š\n è™šæ‹Ÿå†…å­˜æ®µï¼ˆvirtual memory segmentationï¼‰ï¼šä¸€ä¸ªè¿›ç¨‹è¢«åˆ’åˆ†ä¸ºå¾ˆå¤šæ®µï¼Œä¸éœ€è¦æ‰€æœ‰çš„æ®µåŒæ—¶å¤„äºå†…å­˜ä¸­ã€‚ ç®€å•æ®µï¼ˆsimple segmentationï¼‰ï¼šä¸€ä¸ªè¿›ç¨‹è¢«åˆ’åˆ†ä¸ºå¾ˆå¤šæ®µï¼Œè¿›ç¨‹è¿è¡Œæ—¶æ‰€æœ‰çš„æ®µéƒ½åœ¨å†…å­˜ä¸­ã€‚  æ®µè¡¨ æ®µè¡¨ï¼ˆsegment tableï¼‰ è¢«ç”¨æ¥å®ŒæˆäºŒç»´è™šæ‹Ÿåœ°å€åˆ°ä¸€ç»´ç‰©ç†åœ°å€çš„æ˜ å°„ï¼Œæ¯ä¸€ä¸ªè¡¨é¡¹åŒ…å«è¯¥æ®µåœ¨å†…å­˜ä¸­çš„èµ·å§‹ç‰©ç†åœ°å€å’Œæ®µçš„é•¿åº¦ã€‚CPUç”Ÿæˆçš„é€»è¾‘åœ°å€ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæ®µå·(s)å’Œæ®µåç§»(d)ã€‚MMUä½¿ç”¨æ®µå·æŸ¥æ‰¾æ®µè¡¨ï¼Œå¾—åˆ°æ®µçš„èµ·å§‹åœ°å€å’Œæ®µé•¿ï¼Œå¦‚æœæ®µåç§»å¤§äºæ®µé•¿ï¼Œåˆ™è¯´æ˜è¿™æ˜¯ä¸€ä¸ªè¶Šç•Œè®¿é—®ï¼Œå°†å¯¼è‡´æ®µé”™è¯¯ï¼ˆsegmentation faultï¼‰ï¼›å¦åˆ™ä½¿ç”¨æ®µåœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€åŠ ä¸Šæ®µåç§»ï¼Œå¾—åˆ°ç‰©ç†åœ°å€ã€‚\né¡µå¼ç®¡ç† vs æ®µå¼ç®¡ç† é¡µå¼ç®¡ç†å’Œæ®µå¼ç®¡ç†çš„ä¸»è¦åŒºåˆ«ï¼š\n   å…³é”®ç‚¹ é¡µå¼ç®¡ç† æ®µå¼ç®¡ç†     å¤§å° å›ºå®šå¤§å°çš„é¡µå’Œé¡µæ¡†ï¼Œç¡¬ä»¶å†³å®š å¯å˜å¤§å°çš„æ®µï¼Œä½¿ç”¨è€…å†³å®š   ç¢ç‰‡ å¯èƒ½äº§ç”Ÿå†…éƒ¨ç¢ç‰‡ å¯èƒ½äº§ç”Ÿå¤–éƒ¨ç¢ç‰‡   è¡¨ MMUä»é¡µè¡¨å¾—çŸ¥é¡µçš„ä½ç½®å’ŒçŠ¶æ€ï¼Œé€Ÿåº¦æ¯”æ®µè¡¨æ…¢ï¼Œä½†å¯ä»¥ä½¿ç”¨TLBåŠ é€Ÿ æ®µè¡¨åŒ…å«æ®µIDå’Œç›¸å…³ä¿¡æ¯ï¼Œæ¯”é¡µè¡¨å¿«    é¡µå¼ç®¡ç†çš„ä¼˜ç‚¹ï¼š\n ä¸ä¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡ã€‚ é¡µæ¡†ä¸éœ€è¦æ˜¯è¿ç»­çš„ã€‚  é¡µå¼ç®¡ç†çš„ç¼ºç‚¹ï¼š\n å¯èƒ½äº§ç”Ÿå†…éƒ¨ç¢ç‰‡ã€‚ æ¯”æ®µå¼ç®¡ç†æ›´é•¿çš„å†…å­˜æŸ¥æ‰¾æ—¶é—´ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡TLBè¡¥æ•‘ã€‚  æ®µå¼ç®¡ç†çš„ä¼˜ç‚¹ï¼š\n ä¸ä¼šäº§ç”Ÿå†…éƒ¨ç¢ç‰‡ã€‚ æ®µè¡¨æ¯”é¡µè¡¨å°ï¼Œå› æ­¤æ›´èŠ‚çœå†…å­˜ã€‚ æ®µçš„å¹³å‡å¤§å°é€šå¸¸æ¯”å¤§å¤šæ•°é¡µå¤§ï¼Œä¸€ä¸ªæ®µå¯ä»¥å­˜å‚¨æ›´å¤šçš„è¿›ç¨‹æ•°æ®ã€‚ æ¯”é¡µå¼ç®¡ç†æ›´å°çš„å¼€é”€ã€‚  æ®µå¼ç®¡ç†çš„ç¼ºç‚¹ï¼š\n å¯èƒ½äº§ç”Ÿå¤–éƒ¨ç¢ç‰‡ã€‚  æ®µé¡µå¼ç®¡ç† ä¸€äº›ç°ä»£è®¡ç®—æœºé‡‡ç”¨äº† æ®µé¡µå¼ï¼ˆsegmented pagingï¼‰ çš„å†…å­˜ç®¡ç†æ–¹æ¡ˆã€‚ä¸»å­˜å…ˆè¢«åˆ’åˆ†ä¸ºè‹¥å¹²å¯å˜å¤§å°çš„æ®µï¼Œæ¯ä¸ªæ®µè¿›ä¸€æ­¥è¢«åˆ’åˆ†ä¸ºè‹¥å¹²å›ºå®šå¤§å°çš„é¡µã€‚æ¯ä¸ªæ®µåŒ…å«ä¸€ä¸ªé¡µè¡¨ï¼Œå› æ­¤ä¸€ä¸ªè¿›ç¨‹å¯èƒ½æœ‰å¤šä¸ªé¡µè¡¨ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä¸€ä¸ªè™šæ‹Ÿåœ°å€åˆä¸‰éƒ¨åˆ†ç»„æˆï¼šæ®µå·ã€æ®µå†…é¡µå·å’Œé¡µåç§»ã€‚å½“è¿›è¡Œå†…å­˜è®¿é—®æ—¶ï¼Œå…ˆé€šè¿‡æ®µè¡¨æ‰¾åˆ°å¯¹åº”çš„æ®µï¼Œç„¶åé€šè¿‡æ®µå†…é¡µè¡¨æ‰¾åˆ°å¯¹åº”çš„é¡µï¼Œæœ€åæ ¹æ®é¡µåç§»æ‰¾åˆ°ç‰©ç†åœ°å€ã€‚\nå‚è€ƒèµ„æ–™  ANDREW S. TANENBAUM, HERBERT BOS. Modern Operating Systems, 4th Edition. Pearson, 2015. Randal E. Bryant, David R. Oâ€™Hallaron. Computer Systems: A Programmer\u0026rsquo;s Perspective, 3th Edition. Pearson, 2016. Abraham Silberschatz, Greg Gagne, Peter B. Galvin. Operating System Concepts, 10th Edition. Wiley, 2018. Translation lookaside buffer. Hugepages.  ","href":"/operating_systems/main_memory/","title":"ä¸»å­˜"},{"content":"è®¡ç®—æœºç³»ç»Ÿç”±ç¡¬ä»¶ç³»ç»Ÿå’Œè½¯ä»¶ç³»ç»Ÿä¸¤å¤§éƒ¨åˆ†ç»„æˆã€‚ç¡¬ä»¶åŒ…æ‹¬å¤„ç†å™¨ã€ä¸»å­˜ã€ç£ç›˜ã€æ‰“å°æœºã€é”®ç›˜ã€é¼ æ ‡ã€æ˜¾ç¤ºå™¨ã€ç½‘ç»œæ¥å£ä»¥åŠå„ç§è¾“å…¥/è¾“å‡ºè®¾å¤‡ç­‰ã€‚æ“ä½œç³»ç»Ÿç®¡ç†è¿™äº›ç¡¬ä»¶èµ„æºï¼Œå¹¶ä¸ºç”¨æˆ·ç¨‹åºæä¾›äº†ä¸€ä¸ªæ›´ç®€å•çš„è®¡ç®—æœºæ¨¡å‹ã€‚è½¯ä»¶ç³»ç»ŸåŒ…æ‹¬ç³»ç»Ÿè½¯ä»¶å’Œåº”ç”¨è½¯ä»¶ï¼Œæ“ä½œç³»ç»Ÿå±äºç³»ç»Ÿè½¯ä»¶ã€‚\nå¤§å¤šæ•°è®¡ç®—æœºæœ‰ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼šå†…æ ¸æ€(kernel mode)å’Œç”¨æˆ·æ€(user mode)ã€‚æ“ä½œç³»ç»Ÿè¿è¡Œåœ¨å†…æ ¸æ€ï¼Œåœ¨å†…æ ¸æ€æ¨¡å¼ä¸‹ï¼Œæ“ä½œç³»ç»Ÿå…·æœ‰å¯¹æ‰€æœ‰ç¡¬ä»¶çš„å®Œå…¨è®¿é—®æƒï¼Œå¯ä»¥æ‰§è¡Œæœºå™¨èƒ½å¤Ÿè¿è¡Œçš„ä»»ä½•æŒ‡ä»¤ã€‚è½¯ä»¶ç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†è¿è¡Œåœ¨ç”¨æˆ·æ€ã€‚åœ¨ç”¨æˆ·æ€ä¸‹ï¼Œåªèƒ½ä½¿ç”¨æœºå™¨æŒ‡ä»¤çš„ä¸€ä¸ªå­é›†ï¼Œä¾‹å¦‚ç”¨æˆ·æ€ä¸‹ä¸èƒ½ä½¿ç”¨æœ‰å…³ I/O å’Œå†…å­˜ä¿æŠ¤çš„æŒ‡ä»¤ã€‚ä¸ºäº†ä»æ“ä½œç³»ç»Ÿä¸­è·å¾—æœåŠ¡ï¼Œç”¨æˆ·ç¨‹åºå¿…é¡»ä½¿ç”¨ ç³»ç»Ÿè°ƒç”¨(system call) ä»¥é™·å…¥å†…æ ¸å¹¶è°ƒç”¨æ“ä½œç³»ç»Ÿï¼ŒTRAP æŒ‡ä»¤æŠŠç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€å¹¶å¯ç”¨æ“ä½œç³»ç»Ÿï¼Œå½“æœ‰å…³å·¥ä½œå®Œæˆåï¼Œåœ¨ç³»ç»Ÿè°ƒç”¨åé¢çš„æŒ‡ä»¤æŠŠæ§åˆ¶æƒè¿”å›ç»™ç”¨æˆ·ç¨‹åºã€‚\næ“ä½œç³»ç»Ÿè¿è¡Œåœ¨è£¸æœºä¹‹ä¸Šï¼Œä¸ºæ‰€æœ‰å…¶å®ƒçš„è½¯ä»¶æä¾›åŸºç¡€çš„è¿è¡Œç¯å¢ƒã€‚å®ƒæœ‰ä¸¤ä¸ªåŸºæœ¬ç‹¬ç«‹çš„ä»»åŠ¡ï¼šä¸ºåº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªèµ„æºé›†çš„æ¸…æ™°æŠ½è±¡ï¼Œç®¡ç†ç¡¬ä»¶èµ„æºã€‚\nç”¨æˆ·æ¥å£ç¨‹åºä¸€èˆ¬æŒ‡ shell æˆ– GUI(Graphical User Interface)ï¼Œå®ƒè¿è¡Œåœ¨ç”¨æˆ·æ€çš„æœ€åº•å±‚ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ä»–ä»¬è¿è¡Œå…¶å®ƒç¨‹åºï¼Œè¯¸å¦‚ Web æµè§ˆå™¨ã€éŸ³ä¹æ’­æ”¾å™¨ç­‰ã€‚æˆ‘ä»¬å¸¸è§çš„ bash(Bourne Again SHell)å°±æ˜¯å¤§å¤šæ•° Linux ç³»ç»Ÿé»˜è®¤çš„ shell ç¨‹åºã€‚é™¤äº†ç”¨æˆ·å¯ç›´æ¥ä½¿ç”¨çš„ shell å’Œ GUI å¤–ï¼Œæ“ä½œç³»ç»Ÿä¸€èˆ¬è¿˜æä¾›äº†ä¾›ç¼–ç¨‹äººå‘˜è°ƒç”¨çš„ APIã€‚\næŠ½è±¡æ˜¯ç®¡ç†å¤æ‚æ€§çš„ä¸€ä¸ªå…³é”®ã€‚å¥½çš„æŠ½è±¡å¯ä»¥æŠŠä¸€ä¸ªå‡ ä¹ä¸å¯èƒ½ç®¡ç†çš„ä»»åŠ¡åˆ’åˆ†ä¸ºä¸¤ä¸ªå¯ç®¡ç†çš„éƒ¨åˆ†ï¼šç¬¬ä¸€éƒ¨åˆ†æ˜¯æœ‰å…³æŠ½è±¡çš„å®šä¹‰å’Œå®ç°ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯éšæ—¶ä½¿ç”¨è¿™äº›æŠ½è±¡è§£å†³é—®é¢˜ã€‚æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªä¸»è¦ä»»åŠ¡å°±æ˜¯éšè—ç¡¬ä»¶ï¼Œåˆ›å»ºå¥½æŠ½è±¡ï¼Œå¹¶å®ç°å’Œç®¡ç†å®ƒæ‰€åˆ›å»ºçš„æŠ½è±¡å¯¹è±¡ï¼Œæœ€ç»ˆå‘ˆç°ç»™åº”ç”¨ç¨‹åº(ä»¥åŠç¨‹åºå‘˜)è‰¯å¥½ã€æ¸…æ™°ã€ä¸€è‡´çš„æŠ½è±¡ã€‚\nå‚è€ƒèµ„æ–™  ANDREW S. TANENBAUM, HERBERT BOS. Modern Operating Systems, 4th Edition. Pearson, 2015.  ","href":"/operating_systems/operating_systems/","title":"æ“ä½œç³»ç»Ÿæ‰€å¤„çš„ä½ç½®"},{"content":" è¿™ç¯‡ç¬”è®°çš„ä¸»è¦å†…å®¹æ¥è‡ªMemory Management in the Java HotSpot VMã€‚å…¶ä¸»è¦è®²çš„æ˜¯J2SE 5.0ä¸­HotSpot VMçš„å†…å­˜ç®¡ç†ï¼Œæ–‡ç« ä¸­æè¿°äº†J2SE5.0ä¸­çš„åƒåœ¾æ”¶é›†å™¨ï¼Œå¹¶åœ¨å¦‚ä½•é€‰æ‹©å’Œé…ç½®åƒåœ¾æ”¶é›†å™¨ã€è®¾ç½®è¢«ç®¡ç†å†…å­˜çš„åŒºåŸŸå¤§å°ç­‰æ–¹é¢æå‡ºäº†ä¸€äº›å»ºè®®ã€‚\n å†…å­˜ç®¡ç†ç³»ç»Ÿéœ€è¦è€ƒè™‘ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š\n å¦‚ä½•åˆ†é…å†…å­˜ã€‚ å¦‚ä½•è¯†åˆ«å­˜æ´»å¯¹è±¡ã€‚ å¦‚ä½•å›æ”¶æ­»äº¡å¯¹è±¡å æ®çš„ç©ºé—´ï¼Œä»¥ä¾¿å°†æ¥ä½¿ç”¨ã€‚  æ˜¾å¼å†…å­˜é‡Šæ”¾ vs è‡ªåŠ¨å†…å­˜ç®¡ç† åŠ¨æ€å†…å­˜åˆ†é… å‡ ä¹æ‰€æœ‰çš„ç°ä»£ç¼–ç¨‹è¯­è¨€éƒ½é‡‡ç”¨åŠ¨æ€å†…å­˜åˆ†é…(dynamic momory allocation)ï¼Œå³å…è®¸è¿›ç¨‹åœ¨è¿è¡Œæ—¶åˆ†é…æˆ–é‡Šæ”¾é‚£äº›æ— æ³•åœ¨ç¼–è¯‘æœŸé—´ç¡®å®šå¤§å°çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯¹è±¡çš„å­˜æ´»æ—¶é—´å¯ä»¥è¶…è¿‡åˆ›å»ºå®ƒä»¬çš„å­ç¨‹åºçš„å­˜æ´»æ—¶é—´ã€‚åŠ¨æ€åˆ†é…çš„å¯¹è±¡å¹¶ä¸ä½äºäºæ ˆ(åˆ†é…å¯¹è±¡çš„ç¨‹åºçš„ æ´»åŠ¨è®°å½•ï¼ˆactivation recordï¼‰ æˆ– æ ˆå¸§ï¼ˆstack frameï¼‰ )ä¸Šï¼Œä¹Ÿæ²¡æœ‰è¢«é™æ€å‚¨å­˜ï¼ˆå¯¹è±¡çš„åå­—è¢«ç»‘å®šåˆ°ç¼–è¯‘æˆ–é“¾æ¥æœŸé—´æ‰€ç¡®å®šçš„å­˜å‚¨ä½ç½®ï¼‰ï¼Œè€Œæ˜¯ä½äºå †ï¼ˆheapï¼‰ä¸­ã€‚åœ¨å †ä¸­åˆ†é…å¯¹è±¡æœ‰ä¸€äº›å¥½å¤„ï¼Œå®ƒå…è®¸ç¨‹åºå‘˜ï¼š\n åŠ¨æ€é€‰æ‹©æ–°å¯¹è±¡çš„å¤§å°ï¼Œä»è€Œé¿å…ç¨‹åºè¿è¡Œä¸­å‡ºç°å› ç¡¬ç¼–ç è€Œå‡ºç°çš„ä¸€äº›é”™è¯¯ã€‚ å®šä¹‰å’Œä½¿ç”¨åƒ listã€treeã€map è¿™æ ·çš„é€’å½’æ•°æ®ç»“æ„ã€‚ å°†æ–°åˆ›å»ºçš„å¯¹è±¡è¿”å›ç»™çˆ¶ç¨‹åºã€‚ä¾‹å¦‚å·¥å‚æ–¹æ³•ã€‚ å°†å‡½æ•°ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›ç»“æœã€‚ä¾‹å¦‚ä¸€äº›å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­çš„ closure å’Œ suspensionã€‚  å †ä¸­åˆ†é…çš„å¯¹è±¡æ˜¯é€šè¿‡ å¼•ç”¨(reference) æ¥è®¿é—®çš„ã€‚é€šå¸¸ï¼Œå¼•ç”¨æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆï¼Œå³å¯¹è±¡åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚ç„¶è€Œï¼Œå¼•ç”¨ä¹Ÿå¯èƒ½é—´æ¥åœ°æŒ‡å‘å¯¹è±¡ï¼Œä¾‹å¦‚å¼•ç”¨æŒ‡å‘ å¥æŸ„(handle)ï¼Œå¥æŸ„å†æŒ‡å‘å¯¹è±¡ã€‚å¥æŸ„çš„ä¼˜ç‚¹æ˜¯ï¼šåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶ï¼Œåªéœ€è¦æ›´æ–°å¥æŸ„ä¸­åˆ°å¯¹è±¡çš„æŒ‡é’ˆï¼Œè€Œä¸éœ€è¦æ›´æ–°ç¨‹åºä¸­æ‰€æœ‰å…¶å®ƒå¯¹è¯¥å¯¹è±¡(æˆ–å¥æŸ„)çš„å¼•ç”¨ã€‚\næ˜¾å¼å†…å­˜é‡Šæ”¾ åœ¨ä¸€äº›ç¼–ç¨‹è¯­è¨€é‡Œï¼Œç¨‹åºå‘˜éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜ã€‚æ‰‹åŠ¨ç®¡ç†å†…å­˜ä¸€ä»¶éå¸¸å¤æ‚çš„å·¥ä½œï¼Œå¹¶å¯èƒ½å‡ºç°å¾ˆå¤šé”™è¯¯ï¼Œè¿™äº›é”™è¯¯å¯èƒ½å¯¼è‡´ç¨‹åºå¼‚å¸¸ç”šè‡³å´©æºƒã€‚å› æ­¤ï¼Œç»å¤§éƒ¨åˆ†å¼€å‘æ—¶é—´éƒ½è¢«ç”¨åœ¨äº†è°ƒè¯•å¹¶å°è¯•è§£å†³è¿™äº›é—®é¢˜ä¸Šã€‚æ‰‹åŠ¨å›æ”¶å¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š\n æ‚¬æŒ‚æŒ‡é’ˆ(dangling pointer)ã€‚å½“ä¸€ä¸ªå¯¹è±¡è¿˜è¢«å…¶å®ƒå¯¹è±¡å¼•ç”¨æ—¶ï¼Œè‹¥è¯¥å¯¹è±¡å ç”¨çš„å†…å­˜è¢«å›æ”¶ï¼Œé‚£äº›æŒ‡å‘å®ƒçš„å¼•ç”¨å°±ä¼šç§°ä¸ºæ‚¬æŒ‚æŒ‡é’ˆã€‚æ‚¬æŒ‚æŒ‡é’ˆä¸€æ—¦å‡ºç°ï¼Œç¨‹åºçš„è¡Œä¸ºå°±ä¼šå˜å¾—ä¸å¯é¢„æµ‹ã€‚å› ä¸ºï¼Œå½“å°è¯•é€šè¿‡æ‚¬æŒ‚æŒ‡é’ˆè®¿é—®åŸå¯¹è±¡æ—¶ï¼Œè¢«å¼•ç”¨çš„å†…å­˜ç©ºé—´å¯èƒ½æ—©å·²åˆ†é…ç»™å…¶å®ƒå¯¹è±¡ã€‚ å†…å­˜æ³„æ¼(memory leak)ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†é‡Šæ”¾ä¸€ä¸ªå•é“¾è¡¨æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬éœ€è¦å›æ”¶é“¾è¡¨ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè‹¥åªå›æ”¶äº†å¤´èŠ‚ç‚¹ï¼Œå…¶å®ƒèŠ‚ç‚¹å°±æ— æ³•å†è¢«è®¿é—®ï¼Œå®ƒä»¬å æ®çš„å†…å­˜ç©ºé—´ä¹Ÿå°±æ— æ³•è¢«å›æ”¶ã€‚å†…å­˜æ³„æ¼ä¼šä¸æ–­çš„æ¶ˆè€—å¯ç”¨å†…å­˜ï¼Œç›´è‡³å†…å­˜æ¯ç«­ã€‚  è‡ªåŠ¨å†…å­˜ç®¡ç† è‡ªåŠ¨åŒ–å†…å­˜ç®¡ç†è§£å†³äº†æ˜¾å¼å†…å­˜ç®¡ç†ä¸­çš„å¾ˆå¤šé—®é¢˜ã€‚åƒåœ¾æ”¶é›†å™¨(Garbage Collector, GC) é˜²æ­¢å¯ä»¥é˜²æ­¢æ‚¬æŒ‚æŒ‡é’ˆçš„å‡ºç°ï¼Œå› ä¸ºåªæœ‰å½“ä¸€ä¸ªå¯¹è±¡ä¸è¢«ä»»ä½•å…¶å®ƒå¯¹è±¡å¼•ç”¨æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡æ‰èƒ½è¢«å›æ”¶ã€‚åŸåˆ™ä¸Šè®²ï¼ŒGCä¼šå›æ”¶æ‰€æœ‰ä¸å¯è¾¾å¯¹è±¡ï¼Œä½†æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š\n è¿½è¸ªå¼å›æ”¶(tracing collection) å¼•å…¥äº†â€œåƒåœ¾â€è¿™ä¸€å®šä¹‰æ˜ç¡®çš„æ¦‚å¿µï¼Œä½†â€œåƒåœ¾â€å¹¶ä¸ä¸€å®šåŒ…æ‹¬æ‰€æœ‰ä¸å†è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚ å‡ºäºæ•ˆç‡åŸå› ï¼ŒæŸäº›å¯¹è±¡å¯èƒ½ä¸ä¼šè¢«å›æ”¶ã€‚  GCè¿˜è§£å†³äº†å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒä¼šè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚\nä»€ä¹ˆæ˜¯åƒåœ¾æ”¶é›† ç®€è€Œè¨€ä¹‹ï¼Œåƒåœ¾æ”¶é›†å™¨è´Ÿè´£ï¼š\n ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ã€‚ ä¿è¯ä¸å›æ”¶è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ å›æ”¶é‚£äº›ä¸å†å¯è¾¾å¯¹è±¡çš„æ‰€å æ®å†…å­˜ç©ºé—´ã€‚  åƒåœ¾æ”¶é›†æ˜¯æŒ‡å‘ç°åƒåœ¾å¹¶å›æ”¶çš„è¿™ä¸€è¿‡ç¨‹ã€‚é‚£ä¹ˆä½•æ—¶ä¼šå‘ç”Ÿåƒåœ¾æ”¶é›†å‘¢ï¼Œè¿™è¦çœ‹ä½¿ç”¨ä½•ç§åƒåœ¾æ”¶é›†å™¨(æˆ–åƒåœ¾æ”¶é›†ç®—æ³•)äº†ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“å †æˆ–å †çš„ä¸€éƒ¨åˆ†å·²æ»¡ï¼Œæˆ–å·²åˆ†é…çš„ç©ºé—´è¶…è¿‡äº†æŸä¸ªé˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œåƒåœ¾æ”¶é›†ã€‚\nåƒåœ¾æ”¶é›†å™¨çš„ç‰¹ç‚¹ ä¸€ä¸ªç†æƒ³çš„åƒåœ¾æ”¶é›†å™¨åº”è¯¥å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n æ—¢ å®‰å…¨ï¼ˆsafeï¼‰ï¼Œåˆ å®Œå–„ï¼ˆcomprehensiveï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå­˜æ´»å¯¹è±¡ä¸èƒ½è¢«é”™è¯¯çš„å›æ”¶ï¼Œå¹¶ä¸”ä¸€ä¸ªåƒåœ¾ä¸åº”è¯¥åœ¨ç»è¿‡å‡ è½®å›æ”¶ä¹‹åä¾ç„¶å­˜åœ¨ã€‚ é«˜æ•ˆï¼ˆefficientï¼‰ï¼Œå®ƒä¸ä¼šé•¿æ—¶é—´æš‚åœåº”ç”¨ç¨‹åºã€‚ å‡å°‘ç”šè‡³æ¶ˆé™¤å†…å­˜ç¢ç‰‡ã€‚æ•´ç†ï¼ˆcompactionï¼‰ å°±æ˜¯ä¸€ç§æ¶ˆé™¤ç¢ç‰‡çš„æ–¹å¼ã€‚ å¯ä¼¸ç¼©ï¼ˆscalableï¼‰ã€‚å¯¹äºå¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šçš„å¤šçº¿ç¨‹åº”ç”¨æ¥è¯´ï¼Œå†…å­˜çš„åˆ†é…ä¸å›æ”¶éƒ½ä¸åº”è¯¥æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚  è®¾è®¡é€‰æ‹© å½“è®¾è®¡æˆ–é€‰æ‹©åƒåœ¾å›æ”¶ç®—æ³•æ—¶ï¼Œéœ€è¦è€ƒè™‘å¾ˆå¤šç‚¹ï¼š\n Serial vs Parallelã€‚ä¸²è¡Œç®€å•ä½†æ…¢ï¼Œå¹¶è¡Œå¿«ä½†æ›´å¤æ‚å¹¶ä¸”å¯èƒ½å¯¼è‡´å†…å­˜ç¢ç‰‡ã€‚ Concurrent vs Stop-the-worldã€‚å¹¶å‘å¤æ‚ä½†æš‚åœåº”ç”¨æ—¶é—´çŸ­ä¸”å¯èƒ½å½±å“ç¨‹åºæ€§èƒ½ï¼ŒSTW ç®€å•ä½†æš‚åœåº”ç”¨æ—¶é—´é•¿ã€‚ Compacting vs Non-compacting vs Copyingã€‚æ•´ç†å¼æ”¶é›†å™¨å°†æ‰€æœ‰å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°ä¸€èµ·å¹¶å®Œå…¨å›æ”¶å…¶å®ƒå†…å­˜ï¼Œä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ç®€å•åˆå¿«é€Ÿã€‚éæ•´ç†å¼æ”¶é›†å™¨åŸåœ°é‡Šæ”¾åƒåœ¾å¯¹è±¡çš„ç©ºé—´ï¼Œä¸ç§»åŠ¨å¯¹è±¡ï¼Œå®ƒæ›´å¿«ä½†å¯èƒ½å¯¼è‡´å†…å­˜ç¢ç‰‡ï¼Œè¿˜å¯èƒ½åŠ å¤§ä¸ºå¤§å¯¹è±¡å¯»æ‰¾åˆé€‚å†…å­˜ç©ºé—´çš„éš¾åº¦ã€‚å¤åˆ¶å¼æ”¶é›†å™¨å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ä¸€ä¸ªä¸åŒçš„å†…å­˜åŒºåŸŸï¼Œæºç©ºé—´å¯ä»¥ç›´æ¥è¢«è®¤ä¸ºæ˜¯å®Œå…¨ç©ºé—²çš„ï¼Œæ¥ä¸‹æ¥å¯ä»¥ç›´æ¥åœ¨å®ƒä¸Šé¢ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ï¼Œè¿™æ—¢ç®€å•åˆè¿…é€Ÿï¼Œä½†éœ€è¦é¢å¤–çš„æ—¶é—´æ¥å¤åˆ¶å¯¹è±¡ä»¥åŠé¢å¤–çš„ç©ºé—´æ¥å­˜å‚¨å¤åˆ¶åçš„å¯¹è±¡ã€‚  æ€§èƒ½æŒ‡æ ‡ æœ‰å¾ˆå¤šæŒ‡æ ‡å¯ä»¥ç”¨æ¥è¡¡é‡åƒåœ¾æ”¶é›†å™¨çš„æ€§èƒ½ï¼š\n ååé‡ï¼ˆThroughputï¼‰ï¼šéåƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚ åƒåœ¾æ”¶é›†å¼€é”€ï¼ˆGarbage collection overheadï¼‰ï¼šåƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚ æš‚åœæ—¶é—´ï¼ˆPause timeï¼‰ï¼šåº”ç”¨æ‰§è¡ŒæœŸå†…å› åƒåœ¾æ”¶é›†è€Œæš‚åœçš„æ€»æ—¶é—´ã€‚ æ”¶é›†é¢‘ç‡ï¼ˆFrequency of collectionï¼‰ï¼šåƒåœ¾æ”¶é›†å¤šé•¿æ—¶é—´å‘ç”Ÿä¸€æ¬¡ã€‚ å†…å­˜å ç”¨ï¼ˆFootprintï¼‰ï¼šGC è¿è¡Œæ—¶å ç”¨çš„å†…å­˜å¤§å°ã€‚ åŠæ—¶æ€§ï¼ˆPromptnessï¼‰ï¼šä»å¯¹è±¡æˆä¸ºåƒåœ¾åˆ°è¯¥å¯¹è±¡å ç”¨ç©ºé—´å¯ç”¨æ‰€ç»å†çš„æ—¶é—´ã€‚  ä¸åŒç±»å‹çš„åº”ç”¨éœ€è¦ä¸åŒçš„æ€§èƒ½æŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼Œäº¤äº’å¼åº”ç”¨å¯èƒ½è¦æ±‚è¾ƒçŸ­çš„æš‚åœæ—¶é—´ï¼Œå®æ—¶åº”ç”¨å¯èƒ½è¦æ±‚æš‚åœæ—¶é—´ä¸å¾—è¶…è¿‡æŸä¸ªä¸Šç•Œï¼Œè€ŒåµŒå…¥å¼åº”ç”¨å¯èƒ½æ›´å…³æ³¨å†…å­˜å ç”¨ã€‚\nåˆ†ä»£æ”¶é›† åœ¨ åˆ†ä»£æ”¶é›†ï¼ˆgenerational collectionï¼‰ ç®—æ³•ä¸­ï¼Œå†…å­˜è¢«åˆ’ä¸ºä¸ºä¸åŒçš„ä»£ï¼Œä¸åŒä»£ä¿å­˜ä¸åŒå¹´é¾„çš„å¯¹è±¡ã€‚æ”¶é›†å™¨æ ¹æ®ä¸åŒä»£ä¸Šå¯¹è±¡çš„ç‰¹ç‚¹é‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ã€‚åˆ†ä»£åƒåœ¾æ”¶é›†åˆ©ç”¨äº† å¼±åˆ†ä»£å‡è¯´ï¼ˆweak generational hypothesisï¼‰ï¼Œå³ï¼š\n å¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ã€‚ å­˜åœ¨å°‘é‡å¹´è€ä»£å¯¹è±¡åˆ°å¹´è½»ä»£å¯¹è±¡çš„å¼•ç”¨ã€‚  å’Œå¹´è€ä»£ç›¸æ¯”ï¼Œå¹´è½»ä»£ä¸Šåƒåœ¾æ”¶é›†æ›´åŠ é¢‘ç¹ã€‚ç”±äºå¹´è½»ä»£ç©ºé—´é€šå¸¸å¾ˆå°å¹¶ä¸”å¾ˆå¯èƒ½åŒ…å«å¤§é‡æ­»äº¡å¯¹è±¡ï¼Œæ‰€ä»¥å¹´è½»ä»£ä¸Šçš„åƒåœ¾æ”¶é›†é€šå¸¸å¾ˆå¿«ã€‚\nå½“å¹´è½»ä»£ä¸Šçš„å¯¹è±¡ç†¬è¿‡ä¸€å®šæ¬¡æ•°çš„åƒåœ¾æ”¶é›†ä¹‹åï¼Œå®ƒä»¬å°±ä¼šè¢« æå‡ï¼ˆpromptï¼‰ åˆ°å¹´è€ä»£ã€‚å¹´è€ä»£é€šå¸¸æ¯”å¹´è½»ä»£å¤§å¾ˆå¤šï¼Œä½†å¹´è€ä»£ä¸Šçš„ç©ºé—´å ç”¨çš„å¢é•¿é€Ÿåº¦æ¯”å¹´è½»ä»£è¦æ…¢ã€‚å› æ­¤ï¼Œå¹´è€ä»£ä¸Šçš„åƒåœ¾æ”¶é›†çš„å‘ç”Ÿé¢‘ç‡æ›´ä½ï¼Œä½†èŠ±è´¹çš„æ—¶é—´æ›´å¤šã€‚\nJ2EE 5.0 HotSpot JVMä¸­çš„åƒåœ¾æ”¶é›†å™¨ J2EE 5.0 å¯¹åº”çš„ HotSpot VM ä¸­åŒ…å«äº† 4 ç§åƒåœ¾æ”¶é›†å™¨ï¼ˆå®ƒä»¬éƒ½æ˜¯åˆ†ä»£æ”¶é›†å™¨ï¼‰ã€‚\nHotSpot ä¸­çš„åˆ†ä»£ HotSpot VM ä¸­çš„å†…å­˜ç”±ä¸‰ä¸ªåˆ†ä»£ç»„æˆï¼š\n å¹´è½»ä»£ï¼ˆyoung generationï¼‰ã€‚å¤§å¤šæ•°å¯¹è±¡ä¸€å¼€å§‹ä¼šè¢«åˆ†é…åœ¨å¹´è½»ä»£ã€‚ å¹´è€ä»£ï¼ˆold generationï¼‰ã€‚å¹´è€ä»£ä¸­åŒ…å«äº†é‚£äº›åœ¨å¹´è½»ä»£ä¸­ç†¬è¿‡äº†ä¸€å®šæ¬¡æ•°åƒåœ¾æ”¶é›†çš„å¯¹è±¡ï¼Œä¸€äº›å¤§å¯¹è±¡ä¹Ÿå¯èƒ½ç›´æ¥è¢«åˆ†é…åˆ°å¹´è€ä»£ã€‚ æ°¸ä¹…ä»£ï¼ˆpermanent generationï¼‰ã€‚æ°¸ä¹…ä»£ä¸»è¦å­˜æ”¾æè¿°ç±»ä¸æ–¹æ³•çš„é‚£äº›å¯¹è±¡ï¼Œä»¥åŠç±»ä¸æ–¹æ³•æœ¬èº«ã€‚  å¹´è½»ä»£ç”±ä¸€ä¸ª Eden åŒº å’Œä¸¤ä¸ª Survivor ç©ºé—´ ç»„æˆã€‚å¤§å¤šæ•°å¯¹è±¡ä¸€å¼€å§‹è¢«åˆ†é…åˆ° Eden åŒºï¼Œå°‘æ•°å¯¹è±¡ç›´æ¥åˆ†é…åˆ°å¹´è€ä»£ã€‚Survivor ç©ºé—´ä¿å­˜äº†é‚£äº›è‡³å°‘ç»å†è¿‡ä¸€æ¬¡åƒåœ¾æ”¶é›†çš„å¯¹è±¡ï¼Œåœ¨ä»»ä½•æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ª Survivor ç©ºé—´ä¼šä¿å­˜è¿™äº›å¯¹è±¡ï¼Œè€Œå¦ä¸€ä¸ª Survivor ç©ºé—´æ˜¯ç©ºç€çš„å¹¶ä¸”åœ¨ä¸‹æ¬¡åƒåœ¾æ”¶é›†ä¹‹å‰éƒ½ä¸ä¼šè¢«ä½¿ç”¨ã€‚\nåƒåœ¾æ”¶é›†çš„ç§ç±» å½“å¹´è½»ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œå¹´è½»ä»£ä¸Šçš„åƒåœ¾æ”¶é›†å°±ä¼šå‘ç”Ÿï¼Œå¹´è½»ä»£ä¸Šçš„åƒåœ¾æ”¶é›†åˆç§° å°å‹ GCï¼ˆminor GCï¼‰ã€‚å½“å¹´è€ä»£æˆ–æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œå®Œå…¨ GCï¼ˆFull GCï¼‰ ï¼ˆæœ‰æ—¶å€™åˆç§° å¤§å‹ GCï¼ˆmajor GCï¼‰ ï¼‰å°±ä¼šå‘ç”Ÿï¼ŒFull GC ä¼šåœ¨æ‰€æœ‰çš„åˆ†ä»£ä¸Šè¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œå³å›æ”¶æ•´ä¸ªå †ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåƒåœ¾å›æ”¶ä¼šå…ˆå‘ç”Ÿå¹´è½»ä»£ä¸Šï¼Œç„¶åæ‰æ˜¯å¹´è€ä»£å’Œæ°¸ä¹…ä»£ï¼Œä¸åŒåˆ†ä»£ä¸Šé‡‡ç”¨çš„ç®—æ³•ä¸åŒã€‚å¦‚æœå›æ”¶è¿‡ç¨‹ä¸­éœ€è¦æ•´ç†å†…å­˜ï¼Œå„ä¸ªåˆ†ä»£ä¸Šçš„æ•´ç†ä¹Ÿæ˜¯å•ç‹¬å‘ç”Ÿçš„ã€‚\næœ‰æ—¶å€™ï¼Œå½“å¹´è½»ä»£ä¸Šçš„åƒåœ¾æ”¶é›†å…ˆå‘ç”Ÿæ—¶ï¼Œä¸€äº›å¯¹è±¡éœ€è¦è¢«ä»å¹´è½»ä»£æå‡åˆ°å¹´è€ä»£æ—¶ï¼Œè€Œå¹´è€ä»£çš„å‰©ä½™ç©ºé—´å¯èƒ½ä¸è¶³ä»¥å®¹çº³ä¸‹æ‰€æœ‰çš„è¿™äº›å¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äºé™¤ CMS ä»¥å¤–çš„æ”¶é›†å™¨æ¥è¯´ï¼šå¹¶ä¸ä¼šè¿è¡Œå¹´è½»ä»£ä¸Šçš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œè€Œæ˜¯ä¼šå°†å¹´è€ä»£ä¸Šçš„åƒåœ¾å›æ”¶ç®—æ³•åº”ç”¨äºæ•´ä¸ªå †ã€‚CMS æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼Œå®ƒåªèƒ½å›æ”¶å¹´è€ä»£è€Œä¸èƒ½å›æ”¶å¹´è½»ä»£ã€‚\nå¿«é€Ÿå†…å­˜åˆ†é… é¡ºåºåˆ†é… é¡ºåºåˆ†é…ï¼ˆsequential allocationï¼‰ ä½¿ç”¨çš„æ˜¯ä¸€å¤§å—å†…å­˜ï¼Œæ¯æ¬¡ä»ç©ºé—²å—çš„ä¸€ç«¯å¼€å§‹åˆ†é…æ‰€è¯·æ±‚å¤§å°ç©ºé—´çš„å†…å­˜ã€‚é¡ºåºåˆ†é…æ‰€éœ€è¦çš„æ•°æ®ç»“æ„éå¸¸ç®€å•ï¼šåªéœ€è¦ä¸€ä¸ª free æŒ‡é’ˆå’Œä¸€ä¸ª limit æŒ‡é’ˆã€‚ä¾‹å¦‚ï¼Œä¸‹å›¾å±•ç¤ºäº†ä¸ºä¸€ä¸ªå¤§å°ä¸º n çš„å¯¹è±¡åˆ†é…å†…å­˜çš„è¿‡ç¨‹ä¸­ free æŒ‡é’ˆçš„å˜åŒ–æƒ…å†µï¼š\nå½“éœ€è¦ä¸ºä¸€ä¸ªæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œåªéœ€è¦æ£€æŸ¥å‰©ä½™ç©ºé—´æ˜¯å¦è¶³å¤Ÿå®¹çº³ä¸‹è¿™ä¸ªå¯¹è±¡ã€‚å¦‚æœèƒ½ï¼Œå°±æ›´æ–° free æŒ‡é’ˆå¹¶åˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡ã€‚\né¡ºåºåˆ†é…åˆè¢«ç§°ä¸ºé˜¶è·ƒæŒ‡é’ˆåˆ†é…ï¼ˆbump pointer allocationï¼‰ï¼Œå› ä¸º free æŒ‡é’ˆæ˜¯é˜¶è·ƒå¼çš„ã€‚æ­£å› ä¸ºè¿™ä¸ªç‰¹ç‚¹ï¼Œfree æŒ‡é’ˆåˆç§° é˜¶è·ƒæŒ‡é’ˆï¼ˆbump pointerï¼‰ã€‚æ­¤å¤–ï¼Œé¡ºåºåˆ†é…ä¹Ÿè¢«ç§°ä¸ºçº¿æ€§åˆ†é…ï¼Œå› ä¸ºåˆ†é…çš„å†…å­˜åœ°å€åœ¨ä¸€ä¸ªæŒ‡å®šçš„å†…å­˜å—ä¸Šæ˜¯çº¿æ€§çš„ã€‚é¡ºåºåˆ†é…æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n éå¸¸ç®€å•ã€‚ éå¸¸é«˜æ•ˆã€‚ ä¸ç©ºé—²é“¾è¡¨åˆ†é…ç›¸æ¯”ï¼Œé¡ºåºåˆ†é…çš„ç¼“å­˜å±€éƒ¨æ€§æ›´å¥½ï¼Œå°¤å…¶æ˜¯åœ¨ç§»åŠ¨å¼åƒåœ¾æ”¶é›†å™¨ä¸­ã€‚ å¯¹äºéç§»åŠ¨å¼åƒåœ¾æ”¶é›†å™¨ï¼Œé¡ºåºåˆ†é…å°±æ²¡ç©ºé—²é“¾è¡¨åˆ†é…é‚£ä¹ˆåˆé€‚äº†ï¼Œå› ä¸ºå®ƒæœ‰å¯èƒ½å¯¼è‡´å†…å­˜ç¢ç‰‡ã€‚  åœ¨ ç©ºé—²é“¾è¡¨åˆ†é…ï¼ˆfree-list allocationï¼‰ ä¸­ï¼Œæœ‰ä¸€ç§æ•°æ®ç»“æ„è®°å½•ç€ç©ºé—²å†…å­˜å•å…ƒçš„ä½ç½®å’Œå¤§å°ã€‚ç©ºé—²å†…å­˜å•å…ƒçš„ç»„ç»‡æ–¹å¼å¹¶éä¸€å®šæ˜¯é“¾è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒçš„å½¢å¼ã€‚\nTLAB åœ¨å¤šçº¿ç¨‹åº”ç”¨ä¸­ï¼Œåˆ†é…æ“ä½œéœ€è¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨ JVM ä¸­ï¼Œå¯¹è±¡åˆ›å»ºæ˜¯éå¸¸é¢‘ç¹çš„è¡Œä¸ºï¼Œå³ä½¿ä»…ä»…ä¿®æ”¹ä¸€ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„ä½ç½®ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹ä¹Ÿå¯èƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯èƒ½å‡ºç°æ­£åœ¨ç»™å¯¹è±¡ A åˆ†é…å†…å­˜ï¼ŒæŒ‡é’ˆè¿˜æ²¡æ¥å¾—åŠä¿®æ”¹ï¼Œå¯¹è±¡ B åˆä½¿ç”¨äº†åŸæ¥å‡†å¤‡åˆ†é…ç»™å¯¹è±¡ A çš„å†…å­˜çš„æƒ…å†µã€‚æœ‰ä¸¤ç§æ–¹æ¡ˆå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š\n å¯¹å†…å­˜åˆ†é…åŠ¨ä½œè¿›è¡ŒåŒæ­¥å¤„ç†ã€‚å®é™…ä¸Š JVM é‡‡ç”¨ CAS + å¤±è´¥é‡è¯•çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§ï¼› æŠŠå†…å­˜åˆ†é…åŠ¨ä½œæŒ‰ç…§çº¿ç¨‹åˆ’åˆ†åœ¨ä¸åŒçš„ç©ºé—´è¿›è¡Œï¼Œå³é¢„å…ˆä¸ºæ¯ä¸ªçº¿ç¨‹åœ¨å †ä¸­åˆ†é…ä¸€å°å—å†…å­˜â€”â€”TLABï¼ˆThread-Local Allocation Bufferï¼‰ã€‚TLAB åŠ ä¸Šé˜¶è·ƒæŒ‡é’ˆï¼Œåˆ†é…é€Ÿåº¦å¯ä»¥éå¸¸å¿«ã€‚å½“éœ€è¦ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œé¦–å…ˆå°è¯•åœ¨ TLAB ä¸­åˆ†é…å†…å­˜ï¼Œè‹¥ TLAB ä¸Šåˆ†é…å¤±è´¥ï¼Œå°±éœ€è¦é‡‡ç”¨åŒæ­¥çš„æ–¹å¼å¤„ç†äº†ã€‚  ä¸²è¡Œæ”¶é›†å™¨ å½“ä½¿ç”¨ ä¸²è¡Œæ”¶é›†å™¨ï¼ˆSerial Collectorï¼‰ æ—¶ï¼Œå¹´è½»ä»£å’Œå¹´è€ä»£ä¸Šçš„åƒåœ¾æ”¶é›†éƒ½æ˜¯ä¸²è¡Œå‘ç”Ÿçš„ï¼ˆä½¿ç”¨å•æ ¸ CPUï¼‰ã€‚åœ¨å›æ”¶è¿‡ç¨‹ä¸­ï¼Œæ•´ä¸ªåº”ç”¨æ˜¯è¢«å®Œå…¨æš‚åœçš„ï¼ˆstop-the-worldï¼‰ã€‚\nå¹´è½»ä»£ä¸Šçš„ä¸²è¡Œæ”¶é›†å™¨ ä¸Šå›¾å±•ç¤ºäº†ä½¿ç”¨ä¸²è¡Œæ”¶é›†å™¨åœ¨å¹´è½»ä»£ä¸Šçš„æ“ä½œï¼šEden åŒºä¸­å­˜æ´»çš„å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°æœ€åˆä¸ºç©ºçš„é‚£ä¸€ä¸ª Survivor ç©ºé—´ï¼ˆå³ç›®æ ‡ç©ºé—´ Toï¼‰ã€‚ä½†æ˜¯æœ‰äº›åœ¨ Eden åŒºä¸­å­˜æ´»çš„å¯¹è±¡å¯èƒ½éå¸¸å¤§(å¤§åˆ°ç›®æ ‡ç©ºé—´æ— æ³•å®¹çº³ä¸‹)ï¼Œå®ƒä»¬ä¼šè¢«ç›´æ¥å¤åˆ¶åˆ°å¹´è€ä»£ã€‚æœ€åˆä¸ä¸ºç©ºçš„é‚£ä¸ª Survivor ç©ºé—´ï¼ˆå³æºç©ºé—´ Fromï¼‰ä¸­çš„å­˜æ´»å¯¹è±¡ä¹Ÿä¼šè¢«å¤åˆ¶åˆ°ç›®æ ‡ç©ºé—´ï¼Œå…¶ä¸­è¶³å¤Ÿè€çš„å¯¹è±¡ä¼šç›´æ¥è¢«å¤åˆ¶åˆ°å¹´è€ä»£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå½“ç›®æ ‡ç©ºé—´å·²æ»¡ï¼Œè€Œ Eden åŒºå’Œæºç©ºé—´å†…è¿˜æœ‰å­˜æ´»å¯¹è±¡æ—¶ï¼Œè¿™äº›å­˜æ´»å¯¹è±¡ä¸è®ºå¹´é¾„å¤šå¤§éƒ½ä¼šè¢«ç›´æ¥å¤åˆ¶åˆ°å¹´è€ä»£ã€‚å¤åˆ¶æ“ä½œå®Œæˆä¹‹åï¼ŒEden åŒºå’Œæºç©ºé—´å†…æ‰€æœ‰å‰©ä½™å¯¹è±¡éƒ½è¢«è®¤ä¸ºæ˜¯å·²ç»æ­»äº¡çš„ï¼Œæ”¶é›†å™¨ä¼šç›´æ¥æ¸…ç©º Eden åŒºå’Œæºç©ºé—´ã€‚æœ€åï¼Œåªæœ‰å…ˆå‰çš„ç›®æ ‡ç©ºé—´åŒ…å«å­˜æ´»å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°†ä¸¤ä¸ª Survivor ç©ºé—´çš„è§’è‰²äº’æ¢ï¼Œä¸ºä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†åšå¥½å‡†å¤‡ã€‚ä¸²è¡Œæ”¶é›†å™¨æ‰§è¡Œå®Œä¹‹åï¼Œå¹´è½»ä»£å°±æˆäº†ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š\nå¹´è€ä»£ä¸Šçš„ä¸²è¡Œæ”¶é›†å™¨ åœ¨å¹´è€ä»£å’Œæ°¸ä¹…ä»£ä¸Šï¼Œä¸²è¡Œæ”¶é›†å™¨é‡‡ç”¨çš„æ˜¯ æ ‡è®°-æ¸…é™¤-æ•´ç†ï¼ˆmark-sweep-compactionï¼‰ ç®—æ³•ã€‚åœ¨æ ‡è®°é˜¶æ®µï¼Œæ”¶é›†å™¨è¯†åˆ«å‡ºæ‰€æœ‰ä¾ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚åœ¨æ¸…é™¤é˜¶æ®µï¼Œæ”¶é›†å™¨å¹¶ä¸ä¼šçœŸæ­£è¿›è¡Œæ¸…é™¤åƒåœ¾ï¼ˆéå­˜æ´»å¯¹è±¡ï¼‰çš„æ“ä½œï¼Œè€Œæ˜¯ç®€å•åœ°è¯†åˆ«å‡ºè¿™äº›åƒåœ¾ã€‚æœ€åï¼Œæ”¶é›†å™¨ä¼šæ•´ç†å †ï¼Œå°†æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡å…¨éƒ¨æ»‘åŠ¨åˆ°å¹´è€ä»£çš„ä¸€ç«¯ï¼ˆæ°¸ä¹…ä»£ç±»ä¼¼ï¼‰ã€‚è¿™ä¹ˆåšä»¥åï¼Œå¹´è€ä»£çš„å¦ä¸€ç«¯å°±æ˜¯ä¸€ä¸ªè¿ç»­ç©ºé—²å—ï¼Œéšåå°±å¯ä»¥é‡‡ç”¨é˜¶è·ƒæŒ‡é’ˆå¿«é€Ÿä¸ºæ–°å¯¹è±¡åˆ†é…ç©ºé—´ã€‚ä¸‹å›¾å±•ç¤ºäº†æ•´ç†å‰åå¹´è€ä»£çš„æƒ…å†µï¼š\nå¹¶è¡Œæ”¶é›†å™¨ å¹¶è¡Œæ”¶é›†å™¨ï¼ˆParallel Collectorï¼‰ åˆç§° ååé‡æ”¶é›†å™¨ï¼ˆthroughput collectorï¼‰ï¼Œå®ƒä¸»è¦æ˜¯ä¸ºäº†å……åˆ†åˆ©ç”¨æ‹¥æœ‰å¤šå¤„ç†å™¨çš„æœºå™¨ä¸Šçš„å¤šä¸ª CPUã€‚\nå¹¶è¡Œæ”¶é›†å™¨å…¶å®æ˜¯ä¸²è¡Œæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚åœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¹¶è¡Œæ”¶é›†å™¨åœ¨å¹´è½»ä»£å’Œå¹´è€ä»£ä¸Šéƒ½é‡‡ç”¨äº†å’Œä¸²è¡Œæ”¶é›†å™¨ä¸€æ ·çš„ç®—æ³•ï¼Œå¹¶ä¸”éƒ½ä¼šæš‚åœæ•´ä¸ªåº”ç”¨ã€‚ä¸åŒçš„æ˜¯ï¼Œå¹¶è¡Œæ”¶é›†å™¨ä¼šåœ¨åº”ç”¨æš‚åœæœŸé—´ä½¿ç”¨å¤šä¸ªçº¿ç¨‹å¹¶è¡Œåœ°è¿›è¡Œå›æ”¶å·¥ä½œï¼Œå›æ”¶é€Ÿåº¦æ›´å¿«ã€‚åº”ç”¨çš„ååé‡å› æ­¤è€Œæå‡ã€‚\nå¹¶è¡Œæ•´ç†æ”¶é›†å™¨ å¹¶è¡Œæ•´ç†æ”¶é›†å™¨ï¼ˆParallel Compacting Collectorï¼‰ æ˜¯ J2SE 5.0 update 6 ä¸­æ–°å¼•å…¥çš„æ”¶é›†å™¨ã€‚å®ƒå’Œå¹¶è¡Œæ”¶é›†å™¨çš„ä¸åŒä¹‹å¤„åœ¨äºï¼šå®ƒåœ¨å¹´è€ä»£ä¸Šä½¿ç”¨äº†æ–°çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå¹´è½»ä»£ä¸Šçš„åƒåœ¾å›æ”¶ç®—æ³•å’Œä¹‹å‰ä¸€æ ·ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¹¶è¡Œæ•´ç†æ”¶é›†å™¨æœ€ç»ˆä¼šå–ä»£å¹¶è¡Œæ”¶é›†å™¨ã€‚\nåœ¨å›æ”¶å¹´è€ä»£å’Œæ°¸ä¹…ä»£æ—¶ï¼Œå¹¶è¡Œæ•´ç†æ”¶é›†å™¨è¿˜æ˜¯ä¼šæš‚åœæ•´ä¸ªç¨‹åºï¼Œä½†æ»‘åŠ¨æ•´ç†æ“ä½œå¤§éƒ¨åˆ†æ˜¯å¹¶è¡Œçš„ã€‚æ¯ä¸ªåˆ†ä»£åœ¨é€»è¾‘ä¸Šè¢«åˆ’åˆ†ä¸ºè‹¥å¹²å›ºå®šå¤§å°çš„ åŒºåŸŸï¼ˆregionï¼‰ã€‚æ•´ä¸ªæ”¶é›†è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š\n æ ‡è®°é˜¶æ®µï¼ˆmarking phaseï¼‰ã€‚ä»åº”ç”¨ä»£ç ï¼ˆGC Rootsï¼‰å‡ºå‘ï¼Œç›´æ¥å¯è¾¾çš„å­˜æ´»å¯¹è±¡ï¼ˆåˆå§‹å­˜æ´»å¯¹è±¡é›†åˆï¼‰ä¼šè¢«åˆ†ç»™ä¸åŒçš„åƒåœ¾æ”¶é›†çº¿ç¨‹ï¼Œç„¶åå¹¶è¡Œæ ‡è®°æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡ã€‚å½“å‘ç°ä¸€ä¸ªå¯¹è±¡ä¾ç„¶å­˜æ´»æ—¶ï¼Œå°±ä¼šç”¨è¿™ä¸ªå¯¹è±¡çš„å¤§å°å’Œä½ç½®ä¿¡æ¯æ¥æ›´æ–°å…¶æ‰€åœ¨åŒºåŸŸçš„æ•°æ®ã€‚ æ±‡æ€»é˜¶æ®µï¼ˆsummary phaseï¼‰ ã€‚æ±‡æ€»é˜¶æ®µæ“ä½œçš„æ˜¯åŒºåŸŸï¼Œè€Œä¸æ˜¯å¯¹è±¡ã€‚ç”±äºå‰é¢å‡ æ¬¡åƒåœ¾æ”¶é›†çš„æ•´ç†æ“ä½œï¼Œæ¯ä¸ªåˆ†ä»£å·¦è¾¹éƒ¨åˆ†åŒ…å«çš„å­˜æ´»å¯¹è±¡æ¯”è¾ƒå¤šï¼Œé€šè¿‡æ•´ç†å›æ”¶çš„ç©ºé—´ä¹Ÿæ¯”è¾ƒå°‘ï¼Œå› æ­¤ä¸å€¼å¾—åœ¨å®ƒä¸Šé¢è¿›è¡Œæ•´ç†ã€‚æ‰€ä»¥æ±‡æ€»é˜¶æ®µæ‰€åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ä»å·¦è¾¹éƒ¨åˆ†å¼€å§‹æ£€æŸ¥åŒºåŸŸçš„å¯†åº¦(å­˜æ´»å¯¹è±¡æ‰€å çš„ç©ºé—´æ¯”ä¾‹)ï¼Œç›´åˆ°ç¢°åˆ°ä¸€ä¸ªå¯†åº¦è¾ƒå°ï¼Œå€¼å¾—èŠ±æ—¶é—´å»æ•´ç†çš„åŒºåŸŸï¼Œç„¶åä»è¿™ä¸ªåŒºåŸŸå¼€å§‹ï¼Œä¸ºå…¶åçš„æ¯ä¸ªåŒºåŸŸè®¡ç®—å¹¶ä¿å­˜å­˜æ´»æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ–°ä½ç½®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæ±‡æ€»é˜¶æ®µå½“å‰çš„å®ç°æ˜¯ä¸²è¡Œçš„ã€‚ æ•´ç†é˜¶æ®µï¼ˆcompaction phaseï¼‰ ã€‚æ”¶é›†å™¨åˆ©ç”¨æ±‡æ€»é˜¶æ®µçš„æ•°æ®è¯†åˆ«å‡ºéœ€è¦è¢«å¡«å……çš„åŒºåŸŸï¼Œç„¶åå¹¶è¡Œçš„å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°è¿™äº›åŒºåŸŸä¸­ã€‚æœ€ç»ˆï¼Œå †çš„ä¸€ç«¯ä¸­åŒ…å«äº†å¤§é‡å­˜æ´»å¯¹è±¡ï¼Œè€Œå¦ä¸€ç«¯æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„ç©ºé—²å—ã€‚  å¹¶å‘æ ‡è®°æ¸…é™¤æ”¶é›†å™¨ å¯¹äºé‚£äº›éœ€è¦å¿«é€Ÿçš„å“åº”æ—¶é—´çš„åº”ç”¨ï¼Œååé‡å°±ä¸å†é‚£ä¹ˆé‡è¦äº†ã€‚å¹´è½»ä»£ä¸Šçš„ GC é€šå¸¸ä¸ä¼šå¯¼è‡´é•¿æ—¶é—´çš„åœé¡¿ï¼Œè€Œå¹´è€ä»£ä¸Šçš„ GC æ‰§è¡Œè™½ç„¶æ²¡é‚£ä¹ˆé¢‘ç¹ï¼Œä½†å¯èƒ½å¯¼è‡´é•¿æ—¶é—´çš„åœé¡¿ï¼ˆå°¤å…¶æ˜¯å½“å †å¾ˆå¤§æ—¶ï¼‰ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHotSpot å¼•å…¥äº† å¹¶å‘æ ‡è®°æ¸…é™¤ï¼ˆConcurrent Mark-Sweep, CMSï¼‰æ”¶é›†å™¨ ã€‚CMS æ”¶é›†å™¨åˆå« ä½å»¶è¿Ÿæ”¶é›†å™¨ï¼ˆlow-latency collectorï¼‰ã€‚\nCMS æ”¶é›†å™¨åœ¨å¹´è½»ä»£ä¸Šä½¿ç”¨çš„æ”¶é›†å™¨å’Œä¸²è¡Œæ”¶é›†å™¨ç›¸åŒã€‚\nä½¿ç”¨ CMS æ”¶é›†å™¨æ—¶ï¼Œå¹´è€ä»£ä¸Šçš„å¤§éƒ¨åˆ†æ”¶é›†æ“ä½œéƒ½æ˜¯åœ¨åº”ç”¨æ‰§è¡ŒæœŸé—´å¹¶å‘è¿›è¡Œçš„ã€‚CMS æ”¶é›†å™¨å°†æ”¶é›†è¿‡ç¨‹åˆ†ä¸ºäº† 4 ä¸ªé˜¶æ®µï¼š\n åˆå§‹æ ‡è®°ï¼ˆinitial markï¼‰ã€‚æš‚åœåº”ç”¨ï¼Œç„¶åæ ‡è®°åº”ç”¨ä»£ç ï¼ˆGC Rootsï¼‰ç›´æ¥å¯è¾¾çš„å­˜æ´»å¯¹è±¡ã€‚ å¹¶å‘æ ‡è®°ï¼ˆconcurrent markï¼‰ã€‚ä» GC Roots ç›´æ¥å¯è¾¾çš„å¯¹è±¡å‡ºå‘ï¼Œå¹¶å‘çš„æ ‡è®°æ‰€æœ‰é—´æ¥å¯è¾¾çš„å­˜æ´»å¯¹è±¡ã€‚ç”±äºåº”ç”¨åœ¨è¿è¡Œï¼Œå¯¹è±¡ä¹‹é—´çš„å¼•ç”¨å…³ç³»ä¼šåœ¨å¹¶å‘æ ‡è®°æœŸé—´æœ‰æ‰€å˜åŒ–ï¼Œæ‰€ä»¥åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸæ—¶ï¼Œä¸èƒ½ä¿è¯æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡éƒ½è¢«æ ‡è®°ã€‚ é‡æ–°æ ‡è®°ï¼ˆremarkï¼‰ã€‚ä¸ºäº†é˜²æ­¢å¹¶å‘æ ‡è®°é˜¶æ®µé”™æ ‡ï¼Œæ”¶é›†å™¨ä¼šæš‚åœæ•´ä¸ªåº”ç”¨ï¼Œç„¶åå¹¶å‘åœ°æ ‡è®°é‚£äº›åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µå¼•ç”¨å…³ç³»å‘ç”Ÿå˜åŒ–çš„å¯¹è±¡ã€‚è¿™ä¸€é˜¶æ®µè€—æ—¶æ¯”åˆå§‹é˜¶æ®µé•¿ï¼Œä½†åˆè¿œçŸ­äºå¹¶å‘æ ‡è®°é˜¶æ®µã€‚ å¹¶å‘æ¸…é™¤ï¼ˆconcurrent sweepï¼‰ã€‚ç»è¿‡é‡æ–°æ ‡è®°é˜¶æ®µï¼Œå †ä¸­æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å·²è¢«æ ‡è®°ã€‚å¹¶å‘æ¸…é™¤é˜¶æ®µä¼šå›æ”¶é‚£äº›æœªè¢«æ ‡è®°çš„å¯¹è±¡ã€‚  ä¸‹å›¾å±•ç¤ºäº†å¹´è€ä»£ä¸Šçš„ä¸²è¡Œæ”¶é›†å™¨ä¸ CMS æ”¶é›†å™¨çš„åŒºåˆ«ï¼š\nCMS æ”¶é›†å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªä¸å¯¹å †è¿›è¡Œæ•´ç†çš„æ”¶é›†å™¨ã€‚å³åœ¨é‡Šæ”¾æ­»äº¡å¯¹è±¡å ç”¨çš„ç©ºé—´åï¼Œå®ƒä¸ä¼šå°†ç§»åŠ¨å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°å¹´è€ä»£çš„ä¸€ç«¯ã€‚è¿™ä¹ˆåšèŠ‚çœäº†æ—¶é—´ï¼Œä½†ä¼šå¯¼è‡´ç©ºé—²ç©ºé—´å˜å¾—ä¸è¿ç»­ï¼Œå› æ­¤éœ€è¦é‡‡ç”¨ç©ºé—²é“¾è¡¨æ¥ç®¡ç†ç©ºé—²å†…å­˜ã€‚CMS æ”¶é›†å™¨çš„å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼šå®ƒè¦æ±‚çš„å †ç©ºé—´æ¯”å…¶å®ƒåƒåœ¾æ”¶é›†å™¨éƒ½è¦å¤§ã€‚å› ä¸ºåº”ç”¨å¯ä»¥åœ¨æ ‡è®°é˜¶æ®µè¿è¡Œå¹¶å¯èƒ½ç»§ç»­åˆ†é…å†…å­˜ï¼Œè¿›è€Œé—´æ¥åœ°æ¶ˆè€—äº†å¹´è€ä»£çš„ç©ºé—²ç©ºé—´ã€‚æ­¤å¤–ï¼Œå°½ç®¡ CMS æ”¶é›†å™¨ä¿è¯åœ¨æ ‡è®°é˜¶æ®µè¯†åˆ«å‡ºæ‰€æœ‰å­˜æ´»å¯¹è±¡ï¼Œä½†ä¸€äº›å­˜æ´»å¯¹è±¡å¯èƒ½åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆä¸ºåƒåœ¾å¹¶ä¸”ä¸ä¼šè¢«å›æ”¶ï¼Œè€Œæ˜¯è¦ç­‰åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ‰ä¼šè¢«å›æ”¶ã€‚è¿™äº›å¯¹è±¡è¢«ç§°ä¸º æµ®åŠ¨åƒåœ¾ï¼ˆfloating garbageï¼‰ã€‚æœ€åï¼Œç”±äºç¼ºä¹æ•´ç†ï¼Œå †ä¸­å¯èƒ½å‡ºç°ç¢ç‰‡ã€‚ä¸ºäº†å¤„ç†è¿™ä¸ªé—®é¢˜ï¼ŒCMS æ”¶é›†å™¨ä¼šè·Ÿè¸ªå¸¸ç”¨å¯¹è±¡å¤§å°ï¼Œä¼°ç®—æœªæ¥çš„åˆ†é…è¯·æ±‚ï¼Œå¯èƒ½è¿˜ä¼šæ‹†åˆ†æˆ–åˆå¹¶ç©ºé—²å—ä»¥æ»¡è¶³è¦æ±‚ã€‚\nä¸åŒäºå…¶å®ƒæ”¶é›†å™¨ï¼ŒCMS æ”¶é›†å™¨å¹¶ä¸æ˜¯åœ¨å¹´è€ä»£è¢«å¡«æ»¡ä¹‹åæ‰è¿›è¡Œæ”¶é›†ï¼Œè€Œæ˜¯å°½å¯èƒ½æ—©çš„å¼€å§‹å›æ”¶ï¼Œä»¥ä¾¿å®ƒå¯ä»¥åœ¨å¹´è€ä»£è¢«å¡«æ»¡ä¹‹å‰èƒ½å®Œæˆå›æ”¶å·¥ä½œã€‚å¦åˆ™ï¼ŒCMS æ”¶é›†å™¨ä¼šä½¿ç”¨ä¸€ä¸ªæ›´åŠ è€—æ—¶å¹¶ä¸”ä¼šæš‚åœæ•´ä¸ªåº”ç”¨çš„æ ‡è®°-æ¸…é™¤-æ•´ç†ç®—æ³•ï¼ˆå³å¹¶è¡Œå’Œä¸²è¡Œæ”¶é›†å™¨é‡‡ç”¨çš„ç®—æ³•ï¼‰è¿›è¡Œå›æ”¶ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒCMS æ”¶é›†å™¨ä¼šç»Ÿè®¡ä¸€äº›åƒåœ¾å›æ”¶çš„æ•°æ®ï¼Œç„¶ååŸºäºè¿™äº›æ•°æ®åœ¨æ°å½“çš„æ—¶å€™è§¦å‘å›æ”¶æ“ä½œã€‚å½“å¹´è€ä»£çš„ç©ºé—´å ç”¨ç‡è¶…è¿‡æŸä¸ªå€¼æ—¶ï¼ŒCMS æ”¶é›†å™¨ä¹Ÿä¼šå¯åŠ¨å›æ”¶æ“ä½œã€‚è¿™ä¸ªåŸŸå€¼å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•° -XX:CMSInitiatingOccupancyFraction=n æ¥æŒ‡å®šï¼Œå…¶ä¸­çš„ n ä»£è¡¨å å¹´è€ä»£çš„ç™¾åˆ†æ¯”ï¼Œé»˜è®¤ä¸º 68ã€‚\næ€»ä¹‹ï¼Œå’Œå¹¶è¡Œæ”¶é›†å™¨ç›¸æ¯”ï¼ŒCMS æ”¶é›†å™¨ç¼©çŸ­äº†å¹´è€ä»£ä¸Šåƒåœ¾æ”¶é›†å¯¼è‡´çš„æš‚åœæ—¶é—´ï¼Œä½†å´ä»˜å‡ºäº†ä¸€äº›ä»£ä»·ï¼šå›æ”¶å¹´è½»ä»£çš„é€Ÿåº¦å˜æ…¢äº†ï¼Œååé‡é™ä½äº†ï¼Œæ¶ˆè€—çš„å †ç©ºé—´æ›´å¤§äº†ã€‚\nå‚è€ƒèµ„æ–™  Memory Management in the Java HotSpot VM. Richard Jones, Antony Hosking, Eliot Moss. The Garbage Collection Handbook: The Art of Automatic Memory Management. Chapman and Hall/CRC, 2011.  ","href":"/java/jvm/memory_management_in_javase5/","title":"HotSpot VMä¸­çš„å†…å­˜ç®¡ç†(J2SE 5.0)"},{"content":" è¿™ç¯‡ç¬”è®°ä¸»è¦æ¥è‡ªäºThe Java HotSpot Performance Engine Architectureï¼Œæ„Ÿè§‰ä¸»è¦æ˜¯åœ¨è®² JDK8ä¸­ HotSpot VM çš„æ•´ä½“æ¶æ„ã€‚\n Java HotSpot VM åŸæ¥æ˜¯ Sun å…¬å¸ä¸º Java å¹³å°å®ç°çš„é«˜æ€§èƒ½è™šæ‹Ÿæœºï¼Œæ˜¯ Java SE çš„åŸºç¡€ç»„æˆéƒ¨åˆ†ã€‚ä¸ºäº†ä½¿ Java åº”ç”¨è¾¾åˆ°è¾¾åˆ°æœ€ä½³çš„æ€§èƒ½ï¼ŒHotSpot é‡‡ç”¨äº†å¾ˆå¤šé«˜çº§æŠ€æœ¯ï¼ŒåŒ…æ‹¬å…ˆè¿›çš„å†…å­˜æ¨¡å¼ã€åƒåœ¾æ”¶é›†å™¨å’Œè‡ªé€‚åº”ä¼˜åŒ–å™¨ã€‚\nHotSpot VMæ¶æ„ å†…å­˜æ¨¡å‹ï¼ˆMemory Modelï¼‰ å¯¹è±¡çš„è®¿é—®å®šä½ Java ç¨‹åºé€šè¿‡æ ˆä¸Šçš„å¼•ç”¨ï¼ˆreferenceï¼‰æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚åœ¨æ—©æœŸ JVM ä¸­ï¼Œæ¯”å¦‚ Classic VMï¼Œå¯¹è±¡çš„è®¿é—®å®šä½æ˜¯é€šè¿‡ é—´æ¥å¥æŸ„ï¼ˆindirect handleï¼‰ å®ç°çš„ã€‚ç”±äºå¼•ç”¨ä¸­å­˜æ”¾çš„æ˜¯å¥æŸ„çš„åœ°å€ï¼Œæ‰€ä»¥åœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶ï¼Œåªéœ€è¦æ”¹å˜å¥æŸ„ä¸­åˆ°å¯¹è±¡å®ä¾‹æ•°æ®çš„æŒ‡é’ˆå³å¯ã€‚è¿™ä¸€ç‚¹è™½ç„¶å¯ä»¥ç®€åŒ–åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­å¯¹è±¡çš„é‡å®šä½è¿‡ç¨‹ï¼Œä½†å´æˆä¸ºäº†æ€§èƒ½ç“¶é¢ˆï¼Œå› ä¸ºåœ¨ Java ä¸­é€šè¿‡å¥æŸ„è®¿é—®å®ä¾‹å˜é‡éœ€è¦è¿›è¡Œ ä¸¤æ¬¡ é—´æ¥è®¿é—®ã€‚\nåœ¨ HotSopt VM ä¸­ï¼Œå¯¹è±¡çš„è®¿é—®å®šä½æ˜¯é€šè¿‡ ç›´æ¥æŒ‡é’ˆï¼ˆdirect pointersï¼‰ æ¥å®ç°çš„ï¼Œåªéœ€è¦ ä¸€æ¬¡ è®¿é—®å°±å¯ä»¥è·å–åˆ°å®ä¾‹å˜é‡ã€‚å½“å¯¹è±¡åœ¨å†…å­˜å›æ”¶è¿‡ç¨‹ä¸­è¢«ç§»åŠ¨æ—¶ï¼Œåƒåœ¾æ”¶é›†å™¨éœ€è¦è´Ÿè´£æ‰¾åˆ°å¹¶æ›´æ–°æ‰€æœ‰åˆ°è¯¥å¯¹è±¡çš„å¼•ç”¨ã€‚\nä¸¤å­—ï¼ˆTwo-Wordï¼‰çš„å¯¹è±¡å¤´ HotSpot VM ä¸­çš„å¯¹è±¡å¤´å¤§å°ä¸ºä¸¤ä¸ªæœºå™¨å­—ï¼Œè€Œ Classic VM ä¸­çš„å¯¹è±¡å¤´ä¸ºä¸‰ä¸ªå­—ã€‚é€šå¸¸ï¼ŒJava å¯¹è±¡éƒ½å¾ˆå°ï¼Œæ‰€ä»¥å¯¹è±¡å¤´çš„å¤§å°å¯¹ç©ºé—´æ¶ˆè€—çš„å½±å“è¿˜æ˜¯å¾ˆå¤§çš„ã€‚å¯¹è±¡å¤´çš„ç¬¬ä¸€ä¸ªå­—ï¼ˆmark wordï¼‰åŒ…å«äº† hashCode å’Œ GC çš„çŠ¶æ€ç­‰ä¿¡æ¯ï¼Œè€Œç¬¬äºŒä¸ªå­—ï¼ˆkclass pointerï¼‰æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡æ‰€å±ç±»ï¼ˆclassï¼‰çš„æŒ‡é’ˆã€‚åªæœ‰æ•°ç»„å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­æœ‰ç¬¬ä¸‰ä¸ªéƒ¨åˆ†â€”â€”è¿™ä¸€éƒ¨åˆ†è®°å½•äº†æ•°ç»„çš„å¤§å°ã€‚\nä»¥å¯¹è±¡è¡¨ç¤ºçš„åå°„æ•°æ® ç±»ã€æ–¹æ³•å’Œå…¶å®ƒå†…éƒ¨åå°„æ•°æ®éƒ½ç›´æ¥è¢«è¡¨ç¤ºæˆå †ä¸Šçš„å¯¹è±¡ã€‚è¿™æ—¢ç®€åŒ–äº† VM å†…éƒ¨çš„å¯¹è±¡æ¨¡å‹ï¼Œä¹Ÿå…è®¸ç±»è¢«ä¸ºå…¶å®ƒå¯¹è±¡è®¾è®¡çš„åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚\næ”¯æŒåŸç”Ÿçº¿ç¨‹ æ¯ä¸ªçº¿ç¨‹çš„æ–¹æ³•æ´»åŠ¨æ ˆéƒ½æ˜¯ä½¿ç”¨å®¿ä¸»æ“ä½œç³»ç»Ÿçš„æ ˆå’Œçº¿ç¨‹æ¨¡å‹è¡¨ç¤ºçš„ã€‚Java æ–¹æ³•å’ŒåŸç”Ÿæ–¹æ³•ä½¿ç”¨çš„æ˜¯åŒæ ·çš„æ ˆï¼Œå› æ­¤ C å’Œ Java ä¹‹é—´çš„è°ƒç”¨æ›´å¿«ã€‚é€šè¿‡ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦æœºåˆ¶ï¼ŒJava çº¿ç¨‹æ˜¯å®Œå…¨å¯æŠ¢å çš„ã€‚ä½¿ç”¨åŸç”Ÿæ“ä½œç³»ç»Ÿçº¿ç¨‹å’Œè°ƒåº¦æœºåˆ¶çš„ä¸€ä¸ªä¸»è¦ä¼˜ç‚¹å°±æ˜¯å¯ä»¥é€æ˜åœ°åˆ©ç”¨åŸæ“ä½œç³»ç»Ÿçš„å¤šå¤„ç†æœºåˆ¶ã€‚\nåƒåœ¾æ”¶é›†ï¼ˆGarbage Collectionï¼‰ HotSpot VM çš„å†…å­˜ç³»ç»Ÿæ˜¯åˆ†ä»£çš„ï¼Œè¿™ä¸ºä¸åŒåº”ç”¨åœºæ™¯ä¸‹é€‰æ‹©ä¸åŒåƒåœ¾æ”¶é›†å™¨æä¾›äº†æå¤§çš„çµæ´»æ€§ã€‚ä¸ºäº†æ»¡è¶³ä¸åŒçš„åœé¡¿æ—¶é—´å’Œååé‡è¦æ±‚ï¼ŒHotSpot æ”¯æŒé€‰æ‹©ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ã€‚\nå‡†ç¡®æ€§ HotSpot åƒåœ¾æ”¶é›†å™¨æ˜¯ä¸€ä¸ªå®Œå…¨å‡†ç¡®çš„åƒåœ¾æ”¶é›†å™¨ã€‚ç›¸åï¼Œå¾ˆå¤šå…¶å®ƒçš„åƒåœ¾æ”¶é›†å™¨éƒ½æ˜¯ä¿å®ˆçš„ï¼ˆconservativeï¼‰æˆ–éƒ¨åˆ†å‡†ç¡®çš„ã€‚ä¿å®ˆå¼åƒåœ¾å›æ”¶å¸å¼•äººçš„ä¸€ç‚¹åœ¨äºï¼Œå®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«æ·»åŠ åˆ°ä¸æ”¯æŒåƒåœ¾æ”¶é›†çš„ç³»ç»Ÿä¸­ï¼Œä½†å®ƒå®¹æ˜“å‡ºç°å†…å­˜æ³„æ¼ï¼Œè¿˜å¯èƒ½å¯¼è‡´å †ä¸Šç¢ç‰‡ã€‚\nä¿å®ˆå¼æ”¶é›†å™¨å¹¶ä¸ç¡®åˆ‡çš„çŸ¥é“æ‰€æœ‰å¯¹è±¡å¼•ç”¨çš„ä½ç½®ã€‚å› æ­¤ï¼Œå®ƒå¿…é¡»å‡è®¾ä¸€ä¸ªå¯èƒ½å¼•ç”¨æŸä¸ªå¯¹è±¡çš„å†…å­˜å­—å°±çœŸçš„æ˜¯å¯¹è±¡å¼•ç”¨ã€‚è¿™æ„å‘³ç€å®ƒå¯èƒ½ä¼šçŠ¯ä¸€äº›é”™è¯¯ï¼Œä¾‹å¦‚ï¼šå½“ä¸€ä¸ªæ•´æ•°å½“ä½œæ˜¯ä¸€ä¸ªå¯¹è±¡æŒ‡é’ˆã€‚çœ‹èµ·æ¥åƒæŒ‡é’ˆçš„å†…å­˜å•å…ƒè¢«è®¤ä¸ºæ˜¯çœŸçš„æŒ‡é’ˆï¼ŒGC å°±å˜å¾—ä¸å‡†ç¡®äº†ã€‚è¿™ä¼šå¸¦æ¥ä¸€äº›è´Ÿé¢å½±å“ï¼šç¬¬ä¸€ï¼Œå¯èƒ½å‘ç”Ÿæ— æ³•å¤ç°æˆ–è°ƒè¯•çš„å†…å­˜æ³„æ¼ã€‚ç¬¬äºŒï¼Œå› ä¸ºä¿å®ˆå¼æ”¶é›†å™¨å¯èƒ½çŠ¯é”™ï¼Œå› æ­¤å®ƒå¿…é¡»è¿™ä¹ˆåšï¼šè¦ä¹ˆä½¿ç”¨å¥æŸ„æ¥é—´æ¥å¼•ç”¨å¯¹è±¡ï¼ˆè¿™é™ä½äº†æ€§èƒ½ï¼‰ï¼Œè¦ä¹ˆé¿å…ç§»åŠ¨å¯¹è±¡ï¼ˆå› ä¸ºç§»åŠ¨å¯¹è±¡éœ€è¦æ›´æ–°æ‰€æœ‰åœ¨è¯¥å¯¹è±¡ä¸Šçš„å¼•ç”¨ï¼Œè¿™åœ¨æ”¶é›†å™¨ä¸èƒ½ç¡®åˆ‡çŸ¥é“ä¸€ä¸ªè¡¨é¢ä¸Šçš„å¼•ç”¨æ˜¯å¦æ˜¯çœŸçš„å¼•ç”¨çš„æƒ…å†µä¸‹æ˜¯æ— æ³•åšåˆ°çš„ï¼‰ã€‚ç”±äºç¼ºä¹ç§»åŠ¨å¯¹è±¡çš„èƒ½åŠ›ï¼Œä¿å®ˆå¼æ”¶é›†å™¨å¯èƒ½å¯¼è‡´å†…å­˜ç¢ç‰‡ï¼Œä¹Ÿæ— æ³•ä½¿ç”¨ä¸€äº›é«˜çº§çš„åˆ†ä»£å¤åˆ¶æ”¶é›†ç®—æ³•ã€‚\nåˆ†ä»£å¤åˆ¶æ”¶é›†ï¼ˆGenerational Copying Collectionï¼‰ åˆ†ä»£åƒåœ¾æ”¶é›†å™¨åˆ©ç”¨äº†ä¸€ä¸ªäº‹å®ï¼šåœ¨å¤§å¤šæ•°ç¨‹åºä¸­ï¼Œç»å¤§å¤šæ•°ï¼ˆé€šå¸¸è¶…è¿‡95%ï¼‰å¯¹è±¡çš„å­˜æ´»æ—¶é—´éƒ½éå¸¸çŸ­ã€‚é€šè¿‡å°†æ–°ç”Ÿå¯¹è±¡æ”¾ç½®åœ¨ä¸€ä¸ªå•ç‹¬çš„ç©ºé—´é‡Œï¼Œåˆ†ä»£æ”¶é›†å™¨å¯ä»¥å®ç°ï¼š\n å› ä¸ºæ–°ç”Ÿå¯¹è±¡çš„ç©ºé—´æ˜¯è¿ç»­åˆ†é…åœ¨ä¸€ä¸ªå•ç‹¬çš„ç©ºé—´é‡Œçš„ï¼Œåˆ†é…é€Ÿåº¦æ˜¯éå¸¸å¿«çš„ï¼Œå› ä¸ºè¿™åªéœ€è¦æ›´æ–°ä¸€ä¸ªæŒ‡é’ˆå¹¶åšä¸€æ¬¡è¯¥ç©ºé—´æ˜¯å¦ç”¨å°½çš„æ£€æŸ¥ã€‚ åœ¨è¯¥ç©ºé—´ç”¨å°½ä¹‹å‰ï¼Œå…¶ä¸­çš„å¤§å¤šæ•°å¯¹è±¡éƒ½å·²ç»æ­»äº¡äº†ã€‚è¿™ä¸ªæ—¶å€™æ”¶é›†å™¨åªéœ€è¦ç®€å•åœ°å°†å°‘æ•°å­˜æ´»çš„å¯¹è±¡ç§»åŠ¨åˆ°å…¶å®ƒåœ°æ–¹ï¼Œä¸å†éœ€è¦ä¸ºè¯¥ç©ºé—´å†…çš„æ­»äº¡å¯¹è±¡åšå…¶å®ƒå›æ”¶æ“ä½œã€‚  å¹¶è¡Œå¹´è½»ä»£æ”¶é›†å™¨ï¼ˆParallel Young Generation Collectorï¼‰ ä¸Šé¢æè¿°çš„å•çº¿ç¨‹å¤åˆ¶æ”¶é›†å™¨é€‚ç”¨äºå¾ˆå¤šåœºåˆï¼Œä½†å®ƒä¼šæˆä¸ºå¹¶å‘ç¨‹åºä¸­çš„ç“¶é¢ˆã€‚ä¸ºäº†å……åˆ†åˆ©ç”¨å¤šå¤„ç†å™¨ä¸Šçš„å¤šä¸ª CPUï¼ŒHotSpot VM è¿˜ä¸ºå¹´è½»ä»£æä¾›äº†ä¸€ä¸ªå¯é€‰çš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼Œå…¶ä¸­ä½¿ç”¨äº†å¤šä¸ªå¹¶è¡Œå·¥ä½œçš„çº¿ç¨‹æ¥å®Œæˆå­˜æ´»å¯¹è±¡çš„è¿½è¸ªå’Œå¤åˆ¶ã€‚è¿™å‡å°‘äº†æ”¶é›†å¹´è½»ä»£ç©ºé—´çš„æš‚åœæ—¶é—´ï¼Œå¹¶æœ€å¤§åŒ–äº†åƒåœ¾æ”¶é›†çš„ååé‡ã€‚\nå½“ç§»åŠ¨å¯¹è±¡æ—¶ï¼Œå¹¶è¡Œæ”¶é›†å™¨åŠªåŠ›ä½¿ç›¸å…³å¯¹è±¡åœ¨ä¸€èµ·ï¼Œä»è€Œæé«˜å†…å­˜çš„å±€éƒ¨æ€§ä»¥åŠç¼“å­˜çš„åˆ©ç”¨ç‡ï¼Œå¹¶æé«˜äº†åˆ†é…å™¨çš„æ€§èƒ½ã€‚è¿™æ˜¯é€šè¿‡é‡‡ç”¨ æ·±åº¦ä¼˜å…ˆçš„é¡ºåº å¤åˆ¶å¯¹è±¡æ¥å®ç°çš„ã€‚\næ ‡è®°-æ•´ç†æ”¶é›†å™¨ï¼ˆMark-Compact Collectorï¼‰ å°½ç®¡åˆ†ä»£å¤åˆ¶å›æ”¶å™¨å¯ä»¥é«˜æ•ˆåœ°æ”¶é›†å¤§å¤šæ•°æ­»äº¡å¯¹è±¡ï¼Œä½†é•¿æœŸå­˜æ´»çš„å¯¹è±¡ä»ç„¶åœ¨å¹´è€å¯¹è±¡åŒºåŸŸèšé›†ã€‚æœ‰æ—¶å€™ï¼Œç”±äºå¯ç”¨å†…å­˜è¿‡ä½æˆ–è€…æ˜¾å¼è¦æ±‚ï¼Œå¹´è€å¯¹è±¡ä¸Šçš„åƒåœ¾æ”¶é›†å¿…é¡»è¿›è¡Œã€‚HotSpot VM é»˜è®¤ä½¿ç”¨æ ‡å‡†çš„æ ‡è®°-æ•´ç†å›æ”¶ç®—æ³•æ¥è¿›è¡Œå¹´è€å¯¹è±¡åŒºåŸŸçš„åƒåœ¾æ”¶é›†ï¼Œç®—æ³•ä» RC Roots å¼€å§‹éå†æ•´ä¸ªå­˜æ´»å¯¹è±¡å›¾ï¼Œç„¶åè¿›è¡Œæ¸…ç†ï¼Œæ•´ç†æ­»äº¡å¯¹è±¡ç•™ä¸‹çš„ç©ºéš™ã€‚é€šè¿‡å‹å®å †ä¸­çš„ç©ºéš™è€Œä¸æ˜¯å°†å®ƒä»¬æ”¶é›†åˆ°ç©ºé—²é“¾è¡¨ä¸­ï¼Œå¯ä»¥é¿å…å†…å­˜ç¢ç‰‡ã€‚\nå¹¶å‘æ ‡è®°-æ¸…é™¤æ”¶é›†å™¨ï¼ˆConcurrent Mark-Sweep Collectorï¼‰ å¯¹äºé‚£äº›ä½¿ç”¨å¤§é‡å †ç©ºé—´çš„åº”ç”¨ï¼Œé»˜è®¤çš„å¹´è€ä»£æ ‡è®°-æ•´ç†æ”¶é›†å™¨å¯èƒ½å¼•èµ·ç¨‹åºä¸­æ–­ï¼Œå› ä¸ºåº”ç”¨çº¿ç¨‹è¢«æš‚åœçš„æ—¶é—´å’Œå †çš„å¤§å°æˆæ¯”ä¾‹ã€‚åœ¨åº”ç”¨çº¿ç¨‹è¢«æš‚åœçš„éå¸¸çŸ­æš‚çš„æ—¶é—´å†…ï¼ŒHotSpot VM ä¸ºå¹´è€å¯¹è±¡ç©ºé—´å®ç°äº†ä¸€ä¸ªå¯ä»¥åˆ©ç”¨å¤„ç†å™¨çš„ç©ºé—²æ—¶é’Ÿå‘¨æœŸï¼ˆæˆ–ç©ºé—²å¤„ç†å™¨ï¼‰æ¥æ”¶é›†å¤§å †çš„å¹¶å‘æ”¶é›†å™¨ã€‚å½“åº”ç”¨çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œæ”¶é›†å™¨ä¼šè¿›è¡Œè¿½è¸ªå’Œæ¸…ç†å·¥ä½œã€‚æœ‰æ—¶ï¼Œè¿™ä¼šé™ä½åº”ç”¨çš„æœ€å¤§ååé‡ï¼Œå› ä¸ºä¸€äº›å¤„ç†å™¨çš„æ—¶é’Ÿå‘¨æœŸè¢«ç”¨æ¥è¿›è¡Œå¹¶å‘æ”¶é›†ã€‚ç„¶è€Œï¼Œåœ¨å¹³å‡å’Œæœ€åçš„æƒ…å†µä¸‹ï¼Œåƒåœ¾æ”¶é›†çš„æš‚åœæ¬¡æ•°é€šå¸¸é™ä½äº†1~2ä¸ªæ•°é‡çº§ï¼Œè¿™ä½¿åº”ç”¨çš„å“åº”æ—¶é—´å˜å¾—æ›´åŠ çš„å¹³æ»‘ï¼Œä¸ä¼šå‡ºç°é»˜è®¤çš„åŒæ­¥æ ‡è®°-æ•´ç†ç®—æ³•åœ¨å¤§å †ä¸Šå¯èƒ½å‘ç”Ÿçš„çªå‘ã€‚\nå¹¶è¡Œå¹´è€ä»£æ”¶é›†å™¨ï¼ˆParallel Old Generation Collectorï¼‰ ä¸ºäº†æé«˜å ç”¨é‚£äº›ä½¿ç”¨å·¨å¤§å †ç©ºé—´åº”ç”¨çš„å¯æ‰©å±•æ€§ï¼ŒHotSpot VM ä¸ºå¹´è€ä»£å®ç°äº†ä¸€ä¸ªå¹¶è¡Œçš„æ ‡è®°-æ•´ç†æ”¶é›†å™¨ã€‚CMS æ”¶é›†å™¨ä¸»è¦å…³æ³¨çš„æ˜¯å¦‚ä½•é™ä½æš‚åœæ—¶é—´ï¼Œè€Œå¹¶è¡Œå¹´è€ä»£æ”¶é›†å™¨å…³æ³¨çš„æ˜¯å¦‚ä½•åœ¨æš‚åœæ•´ä¸ªåº”ç”¨ï¼ˆstop-the-worldï¼‰çš„æƒ…å†µä¸‹åŒæ—¶ä½¿ç”¨å¤šä¸ªçº¿ç¨‹ä»¥æé«˜ååé‡ã€‚\nè¶…å¿«çš„ï¼ˆUltra-Fastï¼‰çš„çº¿ç¨‹åŒæ­¥ Java æä¾›äº†è¯­è¨€çº§åˆ«çš„çº¿ç¨‹åŒæ­¥ï¼Œä½¿å¾—å®ƒèƒ½å¤Ÿéå¸¸å®¹æ˜“åœ°ç”¨ç»†ç²’åº¦é”æ¥è¡¨è¾¾å¤šçº¿ç¨‹ç¨‹åºã€‚è€Œ Classic VM ç­‰æ—©æœŸ JVM ä¸­ï¼ŒåŒæ­¥çš„å®ç°å’Œå…¶å®ƒæ“ä½œæ¯”èµ·æ¥éå¸¸ä½æ•ˆï¼Œç»†ç²’åº¦åŒæ­¥å› æ­¤æˆäº†ä¸»è¦çš„æ€§èƒ½ç“¶é¢ˆã€‚\nHotSpot VM é‡‡ç”¨è‡ªé€‚åº”è‡ªæ—‹æŠ€æœ¯å®ç°ç«äº‰æ€§åŒæ­¥ï¼Œé‡‡ç”¨è¶…å¿«çš„å¸¸é‡æ—¶é—´æŠ€æœ¯å®ç°éç«äº‰æ€§åŒæ­¥ï¼Œæå¤§çš„æå‡äº†åŒæ­¥æ€§èƒ½ã€‚\n64 ä½æ¶æ„ æ—©æœŸçš„ HotSpot VM çš„å¯»å€ç©ºé—´è¢«é™åˆ¶ä¸º 4GB å†…å­˜ï¼Œå³ä½¿åœ¨ 64 ä½æ“ä½œç³»ç»Ÿä¸­ä¹Ÿæ˜¯è¿™æ ·ã€‚è€Œåœ¨ 64 ä½çš„ JVM ä¸­ï¼ŒJava ç¨‹åºå¯ä»¥ä½¿ç”¨æ‰€æœ‰çš„å†…å­˜ã€‚\nHotSpot ç¼–è¯‘å™¨ ä¸ºäº†æå‡ç¨‹åºçš„æ€§èƒ½ï¼Œå¾ˆå¤šä¸ºä¼ ç»Ÿè¯­è¨€å¼€å‘çš„ç¼–è¯‘æŠ€æœ¯ä¹Ÿè¢«åº”ç”¨åˆ°äº† Java ä¸­ã€‚JITï¼ˆjust-in-timeï¼‰ç¼–è¯‘å™¨å°† Java å­—èŠ‚ç è¿…é€Ÿç¿»è¯‘æˆæœºå™¨ç ã€‚ç„¶è€Œï¼ŒJITç¼–è¯‘å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š\n ç”±äºç¼–è¯‘å™¨åœ¨ç”¨æˆ·æ—¶é—´å†…è¿è¡Œï¼Œå®ƒçš„ç¼–è¯‘é€Ÿåº¦éå¸¸é‡è¦ï¼šå¦‚æœå®ƒä¸æ˜¯éå¸¸å¿«ï¼Œç”¨æˆ·ä¼šåœ¨å¯åŠ¨ç¨‹åºæ—¶å¯Ÿè§‰åˆ°æ˜æ˜¾çš„å»¶è¿Ÿã€‚å› ä¸ºé«˜çº§ä¼˜åŒ–é€šå¸¸ä¼šæ˜¾è‘—å‡æ…¢ç¼–è¯‘é€Ÿåº¦ï¼Œæ‰€ä»¥è¿›è¡Œé«˜çº§ä¼˜åŒ–éå¸¸å›°éš¾ã€‚ å³ä½¿ JIT æœ‰æ—¶é—´è¿›è¡Œæ‰€æœ‰çš„ä¼˜åŒ–ï¼ŒJava ä¹Ÿè¿˜æ˜¯æ²¡æœ‰ C æˆ– C++ é‚£æ ·é«˜æ•ˆã€‚åŸå› æœ‰å¾ˆå¤šï¼š  Java æ˜¯åŠ¨æ€å®‰å…¨çš„ï¼Œè¿™æ„å‘³ç€ Java ç¨‹åºä¸ä¼šè¿åè¯­è¨€çš„è¯­ä¹‰ï¼Œä¹Ÿä¸ä¼šç›´æ¥è®¿é—®ä»»æ„å†…å­˜ã€‚å› æ­¤ï¼ŒJava ä¸­çš„åŠ¨æ€ç±»å‹æ£€æŸ¥å¿…é¡»éå¸¸é¢‘ç¹çš„æ‰§è¡Œã€‚ Java åœ¨å †ä¸Šåˆ†é…æ‰€æœ‰å¯¹è±¡ï¼Œè€Œ C++ ä¸­çš„å¤šæ•°å¯¹è±¡æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„ã€‚è¿™æ„å‘³ç€å¯¹è±¡çš„åˆ†é…é€Ÿåº¦åœ¨ Java ä¸­æ¯”åœ¨ C++ ä¸­æ›´é«˜ã€‚æ­¤å¤–ï¼ŒJava æ”¯æŒè‡ªåŠ¨åƒåœ¾æ”¶é›†ï¼Œå®ƒå’Œ C++ çš„å†…å­˜åˆ†é…å¼€é”€ï¼ˆåŒ…æ‹¬æ½œåœ¨çš„æ¸…é™¤å†™å±éšœçš„å¼€é”€ï¼‰æˆªç„¶ä¸åŒã€‚ Java ä¸­çš„å¤§å¤šæ•°æ–¹æ³•è°ƒç”¨éƒ½æ˜¯è™šçš„ï¼ˆvirtualï¼‰ï¼Œå¹¶ä¸”æ¯” C++ æ›´åŠ é¢‘ç¹ã€‚è¿™ä¸ä»…æ„å‘³ç€æ–¹æ³•è°ƒç”¨æ€§èƒ½æ›´æ˜¾è‘—ï¼Œè¿˜æ„å‘³ç€å †æ–¹æ³•è°ƒç”¨è¿›è¡Œé™æ€ç¼–è¯‘ä¼˜åŒ–æ›´åŠ å›°éš¾ã€‚ ç”±äºæ”¯æŒç±»çš„åŠ¨æ€åŠ è½½ï¼ŒJava ç¨‹åºå¯ä»¥è¿…é€Ÿè¢«æ”¹å˜ã€‚è¿™ä½¿å¾—ä¸€äº›å…¨å±€ä¼˜åŒ–éš¾ä»¥è¿›è¡Œã€‚    ä¸ºäº†è§£å†³Javaè¯­è¨€çš„æ€§èƒ½é—®é¢˜ï¼ŒHotSpot é‡‡ç”¨äº†è‡ªé€‚åº”ä¼˜åŒ–æŠ€æœ¯ã€‚\nçƒ­ç‚¹æ£€æµ‹ï¼ˆHot Spot Detectionï¼‰ å‡ ä¹æ‰€æœ‰çš„ç¨‹åºéƒ½å°†ç»å¤§éƒ¨åˆ†æ‰§è¡Œæ—¶é—´èŠ±åœ¨äº†æ‰§è¡Œå°‘æ•°ä»£ç ä¸Šã€‚åŸºäºè¿™ä¸€ç‚¹ï¼Œè‡ªé€‚åº”ä¼˜åŒ–æŠ€æœ¯è§£å†³äº† JIT ç¼–è¯‘ä¸­çš„é—®é¢˜ã€‚ä¸å…¶é€æ–¹æ³•è¿›è¡Œå³æ—¶ç¼–è¯‘ï¼ŒHotSpot VM ä½¿ç”¨è§£é‡Šå™¨ç«‹å³è¿è¡Œç¨‹åºï¼Œå¹¶åˆ†ææ‰§è¡Œçš„ä»£ç ä»¥æ£€æµ‹çƒ­ç‚¹ä»£ç ç‰‡æ®µã€‚ç„¶åï¼Œä¸“å¿ƒä½¿ç”¨å…¨å±€åŸç”Ÿä»£ç ç¼–è¯‘å™¨ç¼–è¯‘çƒ­ç‚¹ä»£ç ã€‚é€šè¿‡é¿å…ç¼–è¯‘ä¸å¸¸æ‰§è¡Œçš„ä»£ç ï¼ŒHotSpot ç¼–è¯‘å™¨å¯ä»¥æ›´åŠ é‡è§†ç¨‹åºä¸­çš„å¯¹æ€§èƒ½è‡³å…³é‡è¦çš„éƒ¨åˆ†ï¼Œè€Œä¸å¿…å¢åŠ å…¨éƒ¨çš„ç¼–è¯‘æ—¶é—´ã€‚\næ–¹æ³•å†…è”ï¼ˆMethod Inliningï¼‰ Java ä¸­è™šæ–¹æ³•è°ƒç”¨çš„é¢‘ç‡æ˜¯ä¸€ä¸ªé‡è¦çš„ä¼˜åŒ–ç“¶é¢ˆã€‚HotSpot çš„è‡ªé€‚åº”ä¼˜åŒ–å™¨ä¸€æ—¦æ”¶é›†åˆ°äº†çƒ­ç‚¹ä»£ç çš„ä¿¡æ¯ï¼Œå®ƒä¸ä»…ä¼šæŠŠçƒ­ç‚¹ä»£ç ç¼–è¯‘æˆåŸç”Ÿä»£ç ï¼Œè¿˜ä¼šåœ¨å…¶ä¸Šè¿›è¡Œå¤§é‡çš„æ–¹æ³•å†…è”ã€‚\nå†…è”å¯ä»¥é™ä½æ–¹æ³•è°ƒç”¨çš„åŠ¨æ€é¢‘ç‡ï¼Œè¿™å°±èŠ‚çœäº†ç›¸å…³æ–¹æ³•è°ƒç”¨çš„æ—¶é—´ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå†…è”ä¼šä¸ºä¼˜åŒ–å™¨æä¾›æ›´å¤§çš„ä»£ç å—ï¼Œæ˜¯ä¼ ç»Ÿç¼–è¯‘å™¨ä¼˜åŒ–æ›´åŠ é«˜æ•ˆã€‚\nåŠ¨æ€å»ä¼˜åŒ–ï¼ˆDynamic Deoptimizationï¼‰ å†…è”åŸºäºæŸç§å½¢å¼å…¨å±€åˆ†æï¼Œè€ŒåŠ¨æ€åŠ è½½æ˜¯ä¸ä¹‹å†²çªçš„ï¼Œå› ä¸ºåŠ¨æ€åŠ è½½ä¼šæ”¹å˜ç¨‹åºä¸­çš„å…¨å±€å…³ç³»ã€‚å› æ­¤ï¼ŒHotSpot VM å¿…é¡»èƒ½å¤ŸåŠ¨æ€çš„åä¼˜åŒ–ä¹‹å‰å·²ä¼˜åŒ–çš„çƒ­ç‚¹ä»£ç ã€‚\nå‚è€ƒèµ„æ–™  The Java HotSpot Performance Engine Architecture.  ","href":"/java/jvm/hotspot_engine_architecture/","title":"HotSpotå¼•æ“æ¶æ„"},{"content":" è¿™ç¯‡ç¬”è®°åœ°ä¸»è¦å†…å®¹æ¥è‡ªJava Platform, Standard Edition HotSpot Virtual Machine Garbage Collection Tuning Guideã€‚æ–‡ç« ä¸­ä»‹ç»äº†ä¸€äº›è°ƒä¼˜ç›®æ ‡ä»¥åŠ JDK 8ä¸­ Hotspot VM æä¾›çš„ä¸€äº›åƒåœ¾æ”¶é›†å™¨ï¼Œå¹¶æå‡ºäº†å¾ˆå¤šè°ƒä¼˜å»ºè®®ã€‚\n GCï¼ˆGarbage Collectorï¼‰ æ˜¯ä¸€ä¸ªå†…å­˜ç®¡ç†å·¥å…·ï¼Œå®ƒé€šè¿‡ä»¥ä¸‹æ“ä½œå®ç°äº†è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼š\n å°†æ–°ç”Ÿå¯¹è±¡åˆ†é…åˆ° å¹´è½»ä»£ï¼ˆYoung Generationï¼‰ï¼Œå¹¶å°†è¶³å¤Ÿè€çš„å¯¹è±¡æå‡åˆ° å¹´è€ä»£ï¼ˆOld Generationï¼‰ã€‚ é€šè¿‡å¹¶å‘ï¼ˆæˆ–å¹¶è¡Œï¼‰æ ‡è®°é˜¶æ®µæ‰¾å‡ºå¹´è€ä»£ä¸­çš„å­˜æ´»å¯¹è±¡ã€‚å½“æ•´ä¸ª Java å †çš„ç©ºé—´ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼ŒHotSpot VM å°±ä¼šè§¦å‘æ ‡è®°é˜¶æ®µã€‚ é€šè¿‡å¹¶è¡Œå¤åˆ¶æ•´ç†å­˜æ´»å¯¹è±¡ï¼Œä»¥é‡Šæ”¾å †ç©ºé—´ï¼Œæ¢å¤å¯ç”¨å†…å­˜ã€‚  Ergonomics  Ergonomics is the process by which the Java Virtual Machine (JVM) and garbage collection tuning, such as behavior-based tuning, improve application performance.\n JVM ä¼šæ ¹æ®æ‰€è¿è¡Œå¹³å°é€‰æ‹©é»˜è®¤çš„ GCã€å †å¤§å°å’Œè¿è¡Œæ—¶ç¼–è¯‘å™¨ç­‰ã€‚æ­¤å¤–ï¼ŒåŸºäºè¡Œä¸ºçš„è°ƒä¼˜ä¼šåŠ¨æ€åœ°è°ƒæ•´å †å¤§å°ä»¥æ»¡è¶³ä¸åŒåº”ç”¨çš„è¦æ±‚ã€‚\nåŸºäºè¡Œä¸ºçš„è°ƒä¼˜ Java SE ä¸º å¹¶è¡Œæ”¶é›†å™¨ æä¾›äº†ä¸¤ä¸ªå‚æ•°ä»¥å®ç°ä¸åŒçš„åº”ç”¨è¡Œä¸ºï¼šæœ€å¤§æš‚åœæ—¶é—´ï¼ˆmaximum pause time goalï¼‰ å’Œ ååé‡ï¼ˆapplication throughput goalï¼‰ã€‚è¿™ä¸¤ä¸ªå‚æ•°åœ¨å…¶å®ƒæ”¶é›†å™¨ä¸­æ˜¯ä¸å¯ç”¨çš„ã€‚åœ¨æŸäº›æ—¶å€™ï¼Œé¢„æœŸè¡Œä¸ºå¯èƒ½ä¸ä¼šå‡ºç°ï¼Œå› ä¸ºåº”ç”¨éœ€è¦ä¸€ä¸ªè‡³å°‘èƒ½å­˜æ”¾ä¸‹æ‰€æœ‰å­˜æ´»å¯¹è±¡çš„å †ç©ºé—´ã€‚å¯¹å †ç©ºé—´çš„æœ€å°è¦æ±‚å¯èƒ½ä¼šå¦¨ç¢è¾¾æˆé¢„æœŸç›®æ ‡ã€‚\næœ€å¤§æš‚åœæ—¶é—´ æš‚åœæ—¶é—´æŒ‡çš„æ˜¯ GC åœæ­¢åº”ç”¨å¹¶å›æ”¶å†…å­˜æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚GC ä¼šç»´æŠ¤ä¸€ä¸ªå¹³å‡æš‚åœæ—¶é—´ä»¥åŠè¿™ä¸ªå¹³å‡æš‚åœæ—¶é—´ä¸Šçš„æ–¹å·®ï¼Œå¹³å‡æš‚åœæ—¶é—´æ˜¯åŠ æƒçš„ï¼Œè¶Šæ™šå‘ç”Ÿçš„åœé¡¿æƒé‡è¶Šå¤§ã€‚å½“å¹³å‡æš‚åœæ—¶é—´ä¸æ–¹å·®ä¹‹å’Œå¤§äºæœ€å¤§æš‚åœæ—¶é—´æ—¶ï¼ŒHotSpotå°±è®¤ä¸ºGCæ²¡æœ‰æ»¡è¶³æœ€å¤§æš‚åœæ—¶é—´çš„è¦æ±‚ã€‚\næœ€å¤§æš‚åœæ—¶é—´ç›®æ ‡æ˜¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•° -XX:MaxGCPauseMillis=\u0026lt;nnn\u0026gt; æ¥æŒ‡å®šï¼Œå®ƒå‘Šè¯‰ GC æœŸæœ›çš„æš‚åœæ—¶é—´ä¸åº”è¯¥è¶…è¿‡ \u0026lt;nnn\u0026gt; æ¯«ç§’ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼ŒGC ä¼šè°ƒæ•´å †çš„å¤§å°ä»¥åŠå…¶å®ƒç›¸å…³å‚æ•°ï¼Œè¿™äº›è°ƒæ•´å¯èƒ½ä¼šè®© GC çš„æ‰§è¡Œæ›´åŠ é¢‘ç¹ï¼Œä»è€Œæœ‰å¯èƒ½é™ä½ç¨‹åºçš„ååé‡ã€‚GC ä¼šä¼˜å…ˆæ»¡è¶³æœ€å¤§æš‚åœæ—¶é—´ç›®æ ‡è€Œä¸æ˜¯ååé‡ç›®æ ‡ï¼Œä½†æœ‰æ—¶å€™å¯èƒ½è¿æš‚åœæ—¶é—´ç›®æ ‡ä¹Ÿæ»¡è¶³ä¸äº†ã€‚\nååé‡ ååé‡æ˜¯ç”¨ GC æ—¶é—´å’Œé GC æ—¶é—´(åº”ç”¨æ—¶é—´)æ¥è¡¡é‡çš„ï¼Œç›¸å…³çš„å‘½ä»¤è¡Œå‚æ•°æ˜¯ -XX:GCTimeRatio=\u0026lt;nnn\u0026gt;ã€‚GC æ—¶é—´ä¸åº”ç”¨æ—¶é—´çš„æ¯”å€¼ä¸º 1/(1 + \u0026lt;nnn\u0026gt;)ã€‚ä¾‹å¦‚ï¼Œ-XX:GCTimeRatio=19 è¡¨ç¤º GC æ—¶é—´å æ€»æ—¶é—´çš„ 5%ã€‚\nGC æ—¶é—´ä¸ºå¹´è½»ä»£ä¸å¹´è€ä»£ GC æ—¶é—´çš„æ€»å’Œã€‚å¦‚æœååé‡ç›®æ ‡æ²¡æœ‰æ»¡è¶³ï¼ŒGC ä¼šå¢å¤§åˆ†ä»£çš„å¤§å°ï¼Œä»è€Œä½¿åº”ç”¨èƒ½åœ¨ä¸¤æ¬¡åƒåœ¾æ”¶é›†ä¹‹é—´çš„æ‰§è¡Œæ›´ä¹…ã€‚\nå†…å­˜å ç”¨ å½“æœ€å¤§æš‚åœæ—¶é—´å’Œååé‡éƒ½è¾¾åˆ°è¦æ±‚åï¼ŒGC ä¼šç¼©å°æ•´ä¸ªå †ç©ºé—´ç›´åˆ°æŸä¸ªç›®æ ‡ï¼ˆå½“å‰ç‰ˆæœ¬ JVM ä¸­æ€»æ˜¯æŒ‡ååé‡ï¼‰ä¸å†æ»¡è¶³ï¼Œç„¶åå†å°è¯•æ»¡è¶³é‚£ä¸ªç›®æ ‡ã€‚\nè°ƒä¼˜ç­–ç•¥  é™¤éä½ çŸ¥é“ä½ æ‰€éœ€è¦çš„å †ç©ºé—´æ¯”é»˜è®¤æœ€å¤§å †å¤§å°è¿˜è¦å¤§ï¼Œå¦åˆ™ä¸è¦è®¾ç½®æœ€å¤§å †å†…å­˜ï¼Œè€Œæ˜¯ä¸ºä½ çš„åº”ç”¨è®¾ç½®ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ååé‡ç›®æ ‡ã€‚ ä¸ºäº†ä½¿åº”ç”¨è¾¾åˆ°æœŸæœ›çš„ååé‡ï¼Œå †çš„é€šå¸¸ä¼šè‡ªåŠ¨æ‰©å®¹å’Œç¼©å®¹ã€‚åº”ç”¨è¡Œä¸ºçš„æ”¹å˜ä¹Ÿå¯èƒ½å¯¼è‡´å †å®¹é‡çš„æ”¹å˜ã€‚ å¦‚æœå †å·²ç»è¾¾åˆ°äº†æœ€å¤§å€¼ï¼Œè€Œååé‡ä»ç„¶ä½äºæœŸæœ›å€¼ï¼Œé‚£ä¹ˆä½ çš„æœ€å¤§å †å†…å­˜å°±è®¾ç½®å¾—å¤ªå°äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°†æœ€å¤§å †å†…å­˜è®¾ç½®ä¸ºä¸€ä¸ªç¨å°äºæ€»ç‰©ç†å†…å­˜çš„å€¼ï¼Œå†æ¬¡è¿è¡Œåº”ç”¨ï¼Œå¦‚æœååé‡è¿˜æ˜¯ä½äºæœŸæœ›å€¼ï¼Œé‚£ä¹ˆä½ çš„ååé‡ç›®æ ‡å°±å®šå¾—å¤ªé«˜äº†ï¼ˆå·²ç»è¶…è¿‡ç‰©ç†å†…å­˜æ‰€èƒ½æä¾›çš„æœ€å¤§ååé‡äº†ï¼‰ã€‚ å¦‚æœååé‡ç›®æ ‡è¾¾åˆ°äº†ï¼Œä½†åº”ç”¨çš„æš‚åœæ—¶é—´å¤ªé•¿äº†ï¼Œå°±è®¾ç½®ä¸€ä¸ªæœ€å¤§æš‚åœæ—¶é—´ç›®æ ‡ã€‚ä¸ºäº†è¾¾åˆ°æœ€å¤§æš‚åœæ—¶é—´ç›®æ ‡ï¼ŒæœŸæœ›çš„ååé‡å¯èƒ½åˆæ— æ³•è¾¾åˆ°äº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦è¿›è¡Œæƒè¡¡ï¼Œé€‰æ‹©ä¸€ä¸ªæŠ˜ä¸­çš„ç›®æ ‡ã€‚ GC ä¸ºäº†è¾¾åˆ°è®¾ç½®çš„ç›®æ ‡ï¼Œé€šå¸¸ä¼šå¼•èµ·å †å¤§å°çš„æŒ¯è¡ï¼Œå³ä½¿åº”ç”¨å·²ç»å¤„äºä¸€ä¸ªç¨³å®šçŠ¶æ€ä¹Ÿä¸€æ ·ã€‚æœ€å¤§ååé‡ç›®æ ‡ä¸æœ€å¤§æš‚åœæ—¶é—´ç›®æ ‡å’Œå†…å­˜å ç”¨ç›®æ ‡æ—¶ç›¸äº’ç«äº‰çš„ï¼Œå› ä¸ºå‰è€…å¯èƒ½éœ€è¦æ›´å¤§çš„å †ï¼Œè€Œåä¸¤è€…å¯èƒ½éœ€è¦çš„æ˜¯æ›´å°çš„å †ã€‚  åˆ†ä»£ äººä»¬ä»ç»éªŒä¸­å‘ç°ï¼Œç»å¤§å¤šæ•°åº”ç”¨éƒ½å…·å¤‡ä¸€äº›å…±åŒçš„ç‰¹ç‚¹ã€‚ä¸ºäº†ä½¿åƒåœ¾å›æ”¶è¿‡ç¨‹æ›´åŠ é«˜æ•ˆï¼Œåˆ†ä»£æ”¶é›†åˆ©ç”¨äº†è¿™äº›ç‰¹ç‚¹ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸€æ¡å°±æ˜¯ å¼±åˆ†ä»£å‡è¯´ï¼ˆweak generational hypothesisï¼‰ â€”â€”å¤§å¤šæ•°å¯¹è±¡çš„å­˜æ´»æ—¶é—´éƒ½éå¸¸çŸ­ã€‚å†…å­˜ä»¥ä»£çš„å½¢å¼è¿›è¡Œç®¡ç†ï¼Œä»£å®é™…ä¸Šæ˜¯ä¸€ä¸ªå­˜æ”¾æœ‰ä¸åŒå¹´é¾„å¯¹è±¡çš„å†…å­˜æ± ã€‚å½“æŸä¸ªä»£è¢«å¡«æ»¡æ—¶ï¼Œè¯¥ä»£ä¸Šé¢çš„åƒåœ¾å›æ”¶å°±ä¼šå‘ç”Ÿã€‚\nä¸‹å›¾å±•ç¤ºäº† GC ä¸­ï¼ˆä¸åŒ…æ‹¬å¹¶è¡Œæ”¶é›†å™¨å’Œ G1ï¼‰é»˜è®¤çš„å †å¸ƒå±€:\nè®¾ç½®åˆ†ä»£å¤§å° æœ‰å¾ˆå¤šå‚æ•°å¯ä»¥å½±å“å †çš„å¤§å°ã€‚ä¸‹å›¾å±•ç¤ºäº†å †ä¸­ å·²æäº¤ç©ºé—´ï¼ˆcommitted spaceï¼‰ ä¸ è™šæ‹Ÿç©ºé—´ï¼ˆvirtual spaceï¼‰ çš„åŒºåˆ«ï¼š\n-Xmx ç”¨æ¥æŒ‡å®šå †çš„ä¿ç•™ç©ºé—´ï¼Œå¦‚æœ -Xms å‚æ•°çš„å€¼æ¯”å®ƒå°ï¼Œé‚£ä¹ˆå¹¶ä¸æ˜¯æ‰€æœ‰çš„ä¿ç•™ç©ºé—´éƒ½ä¼šè¢«ç«‹å³æäº¤ç»™ JVMï¼Œå…¶ä¸­æœªæäº¤çš„éƒ¨åˆ†å°±æ˜¯ä¸Šå›¾ä¸­ç”¨Virtual æ ‡å‡ºæ¥çš„é‚£ä¸€éƒ¨åˆ†ã€‚å †çš„ä¸åŒéƒ¨åˆ†ï¼ˆå¹´è½»ä»£å’Œå¹´è€ä»£ï¼‰å¯ä»¥æŒ‰éœ€æ‰©å¼ ï¼Œç›´åˆ°è¾¾åˆ°è™šæ‹Ÿç©ºé—´çš„ä¸Šé™ã€‚\næ•´ä¸ªå † ä¸‹é¢æ‰€è®¨è®ºçš„å †å®¹é‡çš„æ‰©å¼ ä¸æ”¶ç¼©å’Œé»˜è®¤å †å¤§å°å¹¶ä¸é€‚ç”¨äºå¹¶è¡Œæ”¶é›†å™¨ï¼Œç„¶è€Œæ§åˆ¶å †å¤§å°å’Œåˆ†ä»£å¤§å°çš„å‚æ•°å´æ˜¯é€‚ç”¨äºå¹¶è¡Œæ”¶é›†å™¨çš„ã€‚æœ€å½±å“åƒåœ¾å›æ”¶æ€§èƒ½çš„å› ç´ å°±æ˜¯å¯ç”¨å†…å­˜çš„æ€»å¤§å°ï¼Œå› ä¸ºåƒåœ¾æ”¶é›†åœ¨å †è¢«å¡«æ»¡æ—¶æ‰å‘ç”Ÿï¼Œæ‰€ä»¥åƒåœ¾å›æ”¶çš„ååé‡ä¸å¯ç”¨å†…å­˜æ€»å¤§å°æˆåæ¯”ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼ŒJVM ä¼šåœ¨æ¯æ¬¡è¿›è¡Œåƒåœ¾å›æ”¶æ—¶æ‰©å¼ æˆ–ç¼©å‡å †çš„å®¹é‡ï¼Œä»¥ä¾¿å°†ç©ºé—²ç©ºé—´ä¸å­˜æ´»å¯¹è±¡çš„æ¯”å€¼é™åˆ¶åœ¨ä¸€ä¸ªç‰¹å®šèŒƒå›´ï¼ˆç™¾åˆ†æ¯”ï¼‰å†…ï¼Œè¿™ä¸ªèŒƒå›´æ˜¯é€šè¿‡å‚æ•° -XX:MinHeapFreeRatio=\u0026lt;minimun\u0026gt; å’Œ -XX:MaxHeapFreeRatio=\u0026lt;maximum\u0026gt; æ¥è®¾ç½®çš„ï¼Œè€Œæ•´ä¸ªå †çš„å¤§å°è¾¹ç•Œæ˜¯é€šè¿‡å‚æ•° -Xms\u0026lt;min\u0026gt; å’Œ -Xmx\u0026lt;max\u0026gt; æ¥ç¡®å®šçš„ã€‚å¦‚æœæŸä¸ªåˆ†ä»£ä¸­ç©ºé—²ç©ºé—´çš„æ¯”ä¾‹ä½äº \u0026lt;minimum\u0026gt;ï¼Œè¯¥åˆ†ä»£å°±ä¼šæ‰©å¼ ï¼Œä»è€Œå°†ç©ºé—²ç©ºé—´çš„æ¯”ä¾‹ä¿æŒåœ¨ \u0026lt;minimum\u0026gt;ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœç©ºé—²ç©ºé—´çš„æ¯”ä¾‹é«˜äº \u0026lt;maximum\u0026gt;ï¼Œè¯¥åˆ†ä»£å°±ä¼šè¢«æ”¶ç¼©ï¼Œä»è€Œå°†ç©ºé—²ç©ºé—´çš„æ¯”ä¾‹ä¿æŒåœ¨ \u0026lt;maximum\u0026gt;ï¼Œä¸è¿‡è¿™å—é™äºåˆ†ä»£çš„æœ€å°å®¹é‡ã€‚\nä¸‹é¢æ˜¯ä¸€äº›æœåŠ¡ç«¯åº”ç”¨ä¸­æœ‰å…³å †å¤§å°çš„é€šç”¨å‡†åˆ™ï¼š\n é™¤éæš‚åœæ—¶é—´æˆä¸ºäº†ä½ çš„æœ€å¤§é—®é¢˜ï¼Œå°±å°è¯•åˆ†é…å°½å¯èƒ½å¤šçš„å†…å­˜ç»™ JVMã€‚é»˜è®¤å€¼é€šå¸¸éƒ½å¤ªå°äº†ã€‚ å°† -Xms å’Œ -Xmx è®¾ä¸ºç›¸åŒå€¼ï¼Œä»è€Œé¿å… JVM å¯¹å †è¿›è¡Œæ‰©å®¹æˆ–ç¼©å®¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ çš„è®¾ç½®ä¸å½“çš„è¯ï¼ŒJVM æ˜¯ä¸ä¼šå¸®ä½ æ•‘ä½ çš„ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ å¢åŠ å¤„ç†å™¨æ—¶ï¼Œä½ ä¹Ÿåº”è¯¥å¢åŠ å¯ç”¨å†…å­˜ï¼Œå› ä¸ºå†…å­˜åˆ†é…å¯ä»¥æ˜¯å¹¶è¡Œçš„ã€‚  å¹´è½»ä»£ é™¤å¯ç”¨å†…å­˜å¤§å°ä¹‹å¤–ï¼Œç¬¬äºŒä¸ªæœ€å½±å“åƒåœ¾å›æ”¶æ€§èƒ½çš„å°±æ˜¯å¹´è½»ä»£å å †ç©ºé—´çš„æ¯”ä¾‹äº†ã€‚é€šå¸¸ï¼Œå¹´è½»ä»£è¶Šå¤§ï¼Œminor GC å‘ç”Ÿçš„é¢‘ç‡å°±è¶Šä½ã€‚ç„¶è€Œï¼Œåœ¨æœ‰é™çš„å †ç©ºé—´ä¸‹ï¼Œå¹´è½»ä»£è¶Šå¤§å°±æ„å‘³ç€å¹´è€ä»£è¶Šå°ã€‚è€Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå¹´è€ä»£è¶Šå°ï¼Œmajor GC å°±è¶Šé¢‘ç¹ã€‚å› æ­¤ï¼Œæœ€ä¼˜çš„è®¾ç½®å–å†³äºåº”ç”¨ä¸­å¯¹è±¡å­˜æ´»æ—¶é—´çš„åˆ†å¸ƒæƒ…å†µã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œå¹´è½»ä»£çš„å¤§å°ç”±å‚æ•° NewRatio æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œ-XX:NewRatio=3 è¡¨ç¤ºå¹´è½»ä»£ä¸å¹´è€ä»£çš„æ¯”ä¾‹ä¸º 1:3ï¼Œå³å¹´è½»ä»£å æ•´ä¸ªå †ç©ºé—´çš„ 1/4ã€‚NewSize å’Œ MaxNewSize å‚æ•°ç”¨æ¥æŒ‡å®šå¹´è½»ä»£å®¹é‡çš„ä¸‹é™ä¸ä¸Šé™ï¼Œä¸¤è€…çš„å€¼ç›¸åŒä¼šä½¿å¹´è½»ä»£çš„å¤§å°ä¿æŒä¸å˜ã€‚\nè°ƒæ•´ Survivor ç©ºé—´çš„å¤§å° æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SurvivorRatio å‚æ•°æ¥è°ƒæ•´ Survivor ç©ºé—´çš„å¤§å°ï¼Œä½†è¿™é€šå¸¸ä¸ä¼šç»™æ€§èƒ½å¸¦æ¥å¤šå¤§çš„å½±å“ã€‚ä¾‹å¦‚ï¼Œ-XX:SurvivorRatio=6 è¡¨ç¤ºä¸€ä¸ª Survivor ç©ºé—´ä¸ Eden åŒºå¤§å°ä¹‹æ¯”ä¸º 1:6ï¼Œå³æ¯ä¸ª Survivor ç©ºé—´çš„å¤§å°ä¸º Eden åŒºçš„ 1/6ï¼Œä¸ºå¹´è½»ä»£çš„ 1/8ã€‚\nè‹¥ Survivor ç©ºé—´è¿‡å°ï¼Œå¤åˆ¶å›æ”¶æ—¶æº¢å‡ºçš„å¯¹è±¡å°±ä¼šç›´æ¥è¢«æå‡åˆ°å¹´è€ä»£ï¼›è‹¥ Survivor ç©ºé—´è¿‡å¤§ï¼Œå°±ä¼šé€ æˆç©ºé—´çš„æµªè´¹ã€‚åœ¨æ¯æ¬¡åƒåœ¾å›æ”¶ä¸­ï¼ŒJVMéƒ½ä¼šé€‰æ‹©ä¸€ä¸ªé˜ˆå€¼ï¼ˆå¯¹è±¡åœ¨è¢«æå‡åˆ°å¹´è€ä»£ä¹‹å‰å¯ä»¥è¢«å¤åˆ¶çš„æ¬¡æ•°ï¼‰ï¼Œè¿™ä¸ªé˜ˆå€¼çš„ç›®çš„æ˜¯å°† Survivor ç©ºé—´çš„å ç”¨ç‡ä¿æŒåœ¨ 50%ã€‚\nå¯¹æœåŠ¡ç«¯åº”ç”¨è€Œè¨€ï¼Œä¸‹é¢æ˜¯ä¸€äº›é€šç”¨å‡†åˆ™ï¼š\n å…ˆå†³å®šèƒ½å¤Ÿåˆ†é…ç»™ JVM çš„æœ€å¤§å †å†…å­˜ï¼Œç„¶åæ‰¾å‡ºå¹´è½»ä»£çš„æœ€ä½³è®¾ç½®å€¼ã€‚  æ³¨æ„ï¼šæœ€å¤§å †å†…å­˜åº”è¯¥æ€»æ˜¯å°äºæœºå™¨å·²å®‰è£…å†…å­˜ï¼Œè¿™æ ·å¯ä»¥é¿å…è¿‡å¤šçš„é¡µé”™è¯¯å’Œé¢ ç°¸ã€‚   å¦‚æœå †å¤§å°æ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆå¢å¤§å¹´è½»ä»£å°±ä¼šç¼©å°å¹´è€ä»£ã€‚å°†å¹´è€ä»£çš„å¤§å°ä¿æŒåœ¨ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å€¼ï¼Œä»¥ä¾¿å®ƒåœ¨ä»»ä½•æ—¶å€™éƒ½èƒ½å®¹çº³ä¸‹åº”ç”¨ä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€äº›æ¾å¼›ç©ºé—´ï¼ˆ10% åˆ° 20% ç”šè‡³æ›´å¤šï¼‰ã€‚ åœ¨ä¹‹å‰æ‰€é™ˆè¿°çš„æ°¸ä¹…ä»£çš„çº¦æŸæ¡ä»¶ä¸‹ï¼š  ä¸ºå¹´è½»ä»£åˆ†é…è¶³å¤Ÿçš„å†…å­˜ã€‚ å½“ä½ å¢åŠ å¤„ç†å™¨æ—¶ï¼Œä½ ä¹Ÿåº”è¯¥å¢åŠ å¹´è½»ä»£çš„å¤§å°ï¼Œå› ä¸ºå†…å­˜åˆ†é…å¯ä»¥æ˜¯å¹¶è¡Œçš„ã€‚    å¯ç”¨æ”¶é›†å™¨ Java HotSpot VM åŒ…å«ä¸‰ç§ä¸åŒç±»å‹çš„ GCï¼Œæ¯ç§ GC éƒ½æœ‰ä¸åŒçš„æ€§èƒ½ç‰¹å¾ï¼š\n ä¸²è¡Œæ”¶é›†å™¨ï¼ˆserial collectorï¼‰ ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å®Œæˆæ‰€æœ‰çš„å›æ”¶å·¥ä½œï¼Œç”±äºä¸å­˜åœ¨çº¿ç¨‹é—´é€šä¿¡çš„å¼€é”€ï¼Œå®ƒè¿˜æ˜¯ç›¸å¯¹é«˜æ•ˆçš„ã€‚ä¸²è¡Œæ”¶é›†å™¨æœ€é€‚åˆç”¨åœ¨å•å¤„ç†å™¨æœºå™¨ä¸Šï¼Œå› ä¸ºå®ƒæ— æ³•åˆ©ç”¨å¤šå¤„ç†å™¨æœºå™¨ä¸Šçš„å¤šä¸ª CPUï¼Œå°½ç®¡å®ƒå¯¹å¤šå¤„ç†å™¨ä¸Šè¿è¡Œçš„å°å‹åº”ç”¨ï¼ˆå†…å­˜æœ€å¤§çº¦100MBï¼‰æ¥è¯´è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä¸²è¡Œæ”¶é›†å™¨åœ¨æŸäº›ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿé…ç½®ä¸‹ä¼šé»˜è®¤å¯ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ -XX:+UseSerialGC é€‰é¡¹æ˜¾å¼ä½¿ç”¨å®ƒã€‚ å¹¶è¡Œæ”¶é›†å™¨ï¼ˆparallel collectorï¼‰ åˆç§° ååé‡æ”¶é›†å™¨ï¼ˆthroughput collectorï¼‰ï¼Œå®ƒå¹¶è¡Œçš„è¿›è¡Œ minor GCï¼Œè¿™èƒ½æ˜¾è‘—é™ä½ GC çš„å¼€é”€ã€‚å®ƒæ˜¯ä¸ºè¿è¡Œåœ¨å¤šå¤„ç†å™¨ç¡¬ä»¶ä¸Šçš„ä¸­å¤§å‹åº”ç”¨å‡†å¤‡çš„ã€‚å¹¶è¡Œæ”¶é›†å™¨ä¹Ÿæ˜¯æŸäº›ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿé…ç½®ä¸‹çš„é»˜è®¤ GCï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ -XX:+UseParallelGC é€‰é¡¹æ˜¾å¼ä½¿ç”¨å®ƒã€‚  å¹¶è¡Œæ•´ç†ï¼ˆparallel compactionï¼‰ ä½¿å¹¶è¡Œæ”¶é›†å™¨èƒ½å¤Ÿå¹¶è¡Œè¿›è¡Œ major GCã€‚å¦‚æœæ²¡æœ‰å¹¶è¡Œæ•´ç†ï¼Œmajor GC å°±ä¼šä½¿ç”¨å•çº¿ç¨‹ä»¥ä¸²è¡Œåœ°æ–¹å¼è¿›è¡Œï¼Œè¿™æå¤§çš„é™åˆ¶äº†åº”ç”¨åœ°å¯ä¼¸ç¼©æ€§ã€‚å½“ -XX:+UseParallelGC é€‰é¡¹è¢«ä½¿ç”¨æ—¶ï¼Œå¹¶è¡Œæ•´ç†ä¼šè¢«é»˜è®¤å¯ç”¨ã€‚è‹¥è¦å…³é—­å®ƒï¼Œå¯ä»¥ä½¿ç”¨ -XX:-UseParallelOldGC é€‰é¡¹ã€‚   å¹¶å‘æ”¶é›†å™¨ï¼ˆmostly concurrent collectorï¼‰ çš„å¤§éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯å¹¶å‘è¿›è¡Œçš„ï¼Œä»è€Œä½¿åº”ç”¨è¢«æš‚åœçš„æ—¶é—´ä¿æŒåœ¨ä¸€ä¸ªè¾ƒçŸ­çš„èŒƒå›´å†…ã€‚å¹¶å‘æ”¶é›†å™¨ä¸ºé‚£äº›å“åº”æ—¶é—´ä¼˜äºååé‡çš„ä¸­å¤§å‹åº”ç”¨è®¾è®¡çš„ï¼Œå› ä¸ºç”¨æ¥å‡å°æš‚åœæ—¶é—´çš„æŠ€æœ¯åŒæ—¶ä¼šé™ä½ååé‡ã€‚HotSpot VM æä¾›äº†ä¸¤ä¸ªæœ€å¤§å¹¶å‘æ”¶é›†å™¨ï¼š  CMSï¼šé€šè¿‡ -XX:+UseConcMarkSweepGC å¯ç”¨ã€‚ G1ï¼šé€šè¿‡ -XX:+UseG1GC å¯ç”¨ã€‚    å¦‚ä½•é€‰æ‹© GC é™¤éä½ çš„åº”ç”¨å¯¹æš‚åœæ—¶é—´æœ‰éå¸¸ä¸¥è‹›çš„è¦æ±‚ï¼Œå¦åˆ™å…ˆè¿è¡Œåº”ç”¨å¹¶è®© JVM è‡ªå·±é€‰æ‹©ä¸€ä¸ª GCã€‚æŒ‰éœ€è°ƒæ•´å †çš„å¤§å°ä»¥æé«˜æ€§èƒ½ï¼Œå¦‚æœæœŸæœ›çš„æ€§èƒ½æ— æ³•æ»¡è¶³ï¼Œå°±ä½¿ç”¨ä¸‹é¢çš„å‡†åˆ™é€‰æ‹© GCï¼š\n å¦‚æœåº”ç”¨å¾ˆå°ï¼ˆå †ç©ºé—´ä¸è¶…è¿‡ 100MBï¼‰ï¼Œä½¿ç”¨ -XX:+UseSerialGC é€‰æ‹©ä¸²è¡Œæ”¶é›†å™¨ã€‚ å¦‚æœåº”ç”¨è¿è¡Œåœ¨å•å¤„ç†å™¨ä¸Šä¸”å¯¹æš‚åœæ—¶é—´æ— è¦æ±‚ï¼Œå°±è®© JVM è‡ªå·±é€‰æ‹© GCï¼Œæˆ–è€…é€‰æ‹©ä¸²è¡Œæ”¶é›†å™¨ï¼ˆ-XX:+UseSerialGCï¼‰ã€‚ å¦‚æœåº”ç”¨çš„å³°å€¼æ€§èƒ½æœ€ä¸ºé‡è¦ï¼Œä¸”å¯¹æš‚åœæ—¶é—´æ— è¦æ±‚æˆ–æš‚åœ 1 ç§’åŠä»¥ä¸Šæ—¶é—´æ˜¯å¯æ¥å—çš„ï¼Œå°±é€‰æ‹©å¹¶è¡Œæ”¶é›†å™¨ï¼ˆ-XX:+UseParallelGC ï¼‰ã€‚ å¦‚æœå“åº”æ—¶é—´æ¯”æ€»ååé‡æ›´é‡è¦ï¼Œä¸”æš‚åœæ—¶é—´å¿…é¡»ä¿æŒåœ¨çº¦ 1 ç§’å†…ï¼Œå°±é€‰æ‹©å¹¶å‘æ”¶é›†å™¨ï¼ˆ-XX:+UseConcMarkSweepGC æˆ– -XX:+UseG1GCï¼‰ã€‚  å¦‚æœé‡‡ç”¨äº†æ¨èçš„ GCï¼Œä½†åº”ç”¨è¿˜æ˜¯è¾¾ä¸åˆ°æœŸæœ›çš„æ€§èƒ½ï¼Œå…ˆå°è¯•è°ƒæ•´åˆ†ä»£çš„å¤§å°ã€‚å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œå°±å†å°è¯•ä¸åŒ GCï¼šåœ¨å¤šå¤„ç†å™¨ä¸Šï¼Œç”¨å¹¶å‘æ”¶é›†å™¨å‡å°æš‚åœæ—¶é—´ï¼Œç”¨å¹¶è¡Œæ”¶é›†å™¨æå‡ååé‡ã€‚\nå¹¶è¡Œæ”¶é›†å™¨ å¹¶è¡Œæ”¶é›†å™¨å’Œä¸²è¡Œæ”¶é›†å™¨ç±»ä¼¼ï¼Œä¸»è¦ä¸åŒåœ¨äºå®ƒé‡‡ç”¨äº†å¤šä¸ªçº¿ç¨‹ä»¥åŠ é€Ÿå›æ”¶åƒåœ¾ã€‚GC çº¿ç¨‹çš„æ•°é‡å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•° -XX:ParallelGCThreads=\u0026lt;N\u0026gt; æ¥æŒ‡å®šã€‚\nåˆ†ä»£ ä¹‹å‰æœ‰æåˆ°ï¼Œå¹¶è¡Œæ”¶é›†å™¨ä¸­çš„å †å¸ƒå±€å’Œæ™®é€šçš„ä¸²è¡Œæ”¶é›†å™¨æ˜¯ä¸åŒçš„ã€‚ä¸‹å›¾å±•ç¤ºäº†å¹¶è¡Œæ”¶é›†å™¨ä¸­çš„åˆ†ä»£å¸ƒå±€ï¼š\nParallel Collector Ergonomics ç›®æ ‡ä¼˜å…ˆçº§ å½“ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨æ—¶ï¼ŒHotSpot VM é»˜è®¤ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºå®ç°è°ƒä¼˜ç›®æ ‡ï¼š\n æœ€å¤§æš‚åœæ—¶é—´ç›®æ ‡ã€‚ ååé‡ç›®æ ‡ã€‚ æœ€å°å†…å­˜å ç”¨ç›®æ ‡ã€‚  é¦–å…ˆæ»¡è¶³æš‚åœæ—¶é—´ç›®æ ‡ï¼Œç„¶åæ‰ä¼šè€ƒè™‘ååé‡ã€‚å½“å‰é¢ä¸¤ä¸ªéƒ½æ»¡è¶³æ—¶ï¼Œæ‰ä¼šè€ƒè™‘å†…å­˜å ç”¨ã€‚\nè°ƒæ•´åˆ†ä»£å¤§å° æ”¶é›†å™¨ä¼šè®°å½•å¹¶åœ¨æ¯æ¬¡åƒåœ¾æ”¶é›†ä¹‹åæ›´æ–°ä¸€äº›ç»Ÿè®¡æ•°æ®(å¦‚å¹³å‡æš‚åœæ—¶é—´)ï¼Œè¿™äº›ç»Ÿè®¡æ•°æ®ä¼šå¸®åŠ©GCåˆ¤æ–­æ˜¯å¦å·²ç»è¾¾åˆ°è°ƒä¼˜ç›®æ ‡æˆ–åšå‡ºä¸€äº›è°ƒæ•´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæ”¶é›†å™¨å¹¶ä¸ä¼šä½¿ç”¨æ˜¾å¼åœ°è¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆä¾‹å¦‚ System.gc()ï¼‰æ—¶å½¢æˆçš„æ•°æ®ã€‚\nåˆ†ä»£å®¹é‡çš„å¢é•¿å’Œç¼©å‡æ˜¯ä»¥å›ºå®šç™¾åˆ†æ¯”è¿›è¡Œçš„ï¼Œå¹¶ä¸”å¢é•¿ç‡å’Œç¼©å‡ç‡ä¸åŒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ†ä»£ä¼šä»¥ 20% çš„å¢é‡æ‰©å®¹ï¼Œè€Œä»¥ 5% çš„å¢é‡å‹ç¼©ã€‚å¹´è½»ä»£ä¸å¹´è€ä»£å®¹é‡æ‰©å®¹çš„å¢é‡å¯ä»¥é€šè¿‡ -XX:YoungGenerationSizeIncrement=\u0026lt;Y\u0026gt; ä¸ -XX:TenuredGenerationSizeIncrement=\u0026lt;T\u0026gt; æ¥æŒ‡å®šï¼Œè€Œç¼©å®¹çš„å¢é‡æ˜¯é€šè¿‡ -XX:AdaptiveSizeDecrementScaleFactor=\u0026lt;D\u0026gt; æŒ‡å®šçš„ã€‚å¦‚æœæ‰©å®¹çš„å¢é‡ä¸ºXä¸ªç™¾åˆ†æ¯”ï¼Œåˆ™ç¼©å®¹çš„å¢é‡ä¸º X/D ä¸ªç™¾åˆ†æ¯”ã€‚\nå¹¶å‘æ”¶é›†å™¨ HotSpot VM æä¾›äº†ä¸¤ä¸ª å¹¶å‘æ”¶é›†å™¨ï¼ˆmostly concurrent collectorï¼‰ï¼š\n Concurrent Mark Sweep (CMS) Collectorï¼šé€‚ç”¨äºé‚£äº›åçˆ±æ›´çŸ­çš„æš‚åœæ—¶é—´å¹¶ä¸”å¯ä»¥æ¥å—åŒ GC åˆ†äº« CPU çš„åº”ç”¨ã€‚ Garbage-First (G1) Collectorï¼šä¸ºæ‹¥æœ‰å¤§å†…å­˜çš„å¤šå¤„ç†æœºè®¾è®¡çš„é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„æ”¶é›†å™¨ã€‚å®ƒå°è¯•åœ¨å®ç°é«˜ååé‡çš„åŒæ—¶å¤§æ¦‚ç‡æ»¡è¶³åº”ç”¨å¯¹æš‚åœæ—¶é—´çš„è¦æ±‚ã€‚  CMS æ”¶é›†å™¨ é€šå¸¸æƒ…å†µä¸‹ï¼Œé‚£äº›æœ‰ç€ç›¸å¯¹è¾ƒå¤§çš„å¹´è€ä»£å¹¶ä¸”è¿è¡Œåœ¨æ‹¥æœ‰ 2 ä¸ªæˆ–æ›´å¤šå¤„ç†å™¨çš„æœºå™¨ä¸Šçš„åº”ç”¨å¾€å¾€ä¼šä» CMS æ”¶é›†å™¨ä¸­è·ç›Šã€‚å¯¹äºé‚£äº›è¦æ±‚æš‚åœæ—¶é—´éå¸¸çŸ­çš„åº”ç”¨æ¥è¯´ï¼ŒCMS ä¹Ÿæ˜¯éå¸¸é€‚åˆçš„ã€‚å¯ç”¨ CMS æ”¶é›†å™¨çš„å‘½ä»¤è¡Œå‚æ•°ä¸º -XX:+UseConcMarkSweepGCã€‚\nå’Œå…¶å®ƒçš„ GC ç±»ä¼¼ï¼ŒCMS æ”¶é›†å™¨ä¹Ÿæ˜¯åŸºäºåˆ†ä»£çš„ï¼Œå› æ­¤ minor GC å’Œ major GC éƒ½ä¼šå‘ç”Ÿã€‚CMS æ”¶é›†å™¨è¯•å›¾é€šè¿‡ä½¿ç”¨ç‹¬ç«‹çš„ GC çº¿ç¨‹åœ¨åº”ç”¨çº¿ç¨‹æ‰§è¡ŒæœŸé—´å¹¶å‘åœ°è¿½è¸ªå¯è¾¾å¯¹è±¡æ¥è¾ƒå°‘ major GC å¼•èµ·çš„åº”ç”¨æš‚åœæ—¶é—´ã€‚åœ¨æ¯æ¬¡ major GC ä¸­ï¼ŒCMS ä¼šåœ¨æ”¶é›†å¼€å§‹æ—¶ï¼ˆæ ‡è®° GC Roots ç›´æ¥å¯è¾¾çš„å­˜æ´»å¯¹è±¡ï¼‰çŸ­æš‚æš‚åœæ‰€æœ‰åº”ç”¨çº¿ç¨‹ï¼Œç„¶ååœ¨æ”¶é›†è¿‡ç¨‹ä¸­å†æ¬¡æš‚åœï¼ˆé‡æ–°æ ‡è®°é‚£äº›åœ¨å¹¶å‘æ ‡è®°ä¸­ç”±äºå¼•ç”¨æ›´æ–°è€Œæ¼æ ‡çš„å¯¹è±¡ï¼‰æ‰€æœ‰åº”ç”¨çº¿ç¨‹ã€‚ç¬¬äºŒæ¬¡æš‚åœé€šå¸¸æ¯”ç¬¬ä¸€æ¬¡æš‚åœæ—¶é—´è¦é•¿ï¼Œåœ¨æ¯æ¬¡æš‚åœæœŸé—´ï¼Œéƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œåƒåœ¾æ”¶é›†ç›¸å…³å·¥ä½œã€‚å…¶ä½™é˜¶æ®µï¼ˆåŒ…æ‹¬è¿½è¸ªå­˜æ´»å¯¹è±¡å’Œæ¸…é™¤ä¸å¯è¾¾å¯¹è±¡ï¼‰ä¸­ï¼ŒGC çº¿ç¨‹éƒ½æ˜¯åœ¨åº”ç”¨æ‰§è¡ŒæœŸé—´å¹¶å‘æ‰§è¡Œçš„ã€‚Minor GC å¯ä»¥ä¸æ­£åœ¨è¿›è¡Œçš„ major GC é‡å ï¼Œå·¥ä½œæ–¹å¼ä¹Ÿä¸å¹¶è¡Œæ”¶é›†å™¨ï¼Œä½†å¹¶è¡Œæ”¶é›†å™¨åœ¨ minor GC æœŸé—´ä¼šæš‚åœæ‰€æœ‰åº”ç”¨çº¿ç¨‹ã€‚\nå¹¶å‘æ¨¡å¼å¤±è´¥ å½“ CMS æ”¶é›†å™¨æ— æ³•åœ¨å¹´è€ä»£ç©ºé—´è€—å°½ä¹‹å‰å®Œæˆå›æ”¶ä¸å¯è¾¾å¯¹è±¡æ‰€å ç”¨çš„ç©ºé—´æ—¶ï¼Œæˆ–è€…å½“ èµ‹å€¼å™¨ï¼ˆmutatorï¼‰ æ— æ³•ä»å¹´è€ä»£ä¸­ä¸ºå¯¹è±¡åˆ†é…ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç©ºé—²å—æ—¶ï¼Œåº”ç”¨å°±ä¼šè¢«æš‚åœï¼ŒGCä¼šåœ¨æ‰€æœ‰åº”ç”¨æš‚åœçš„æƒ…å†µä¸‹å®Œæˆå›æ”¶å·¥ä½œã€‚å¹¶å‘æ¨¡å¼å¤±è´¥ï¼ˆConcurrent Mode Failureï¼‰ æŒ‡çš„å°±æ˜¯ GC æ— æ³• å¹¶å‘åœ° å®Œæˆåƒåœ¾å›æ”¶å·¥ä½œï¼Œè¿™æš—ç¤ºæˆ‘ä»¬è¯¥å¯¹ CMS æ”¶é›†å™¨è¿›è¡Œè°ƒä¼˜äº†ã€‚\nGC æ—¶é—´è¿‡é•¿ä¸ OutOfMemoryError CMS æ”¶é›†å™¨ä¼šåœ¨ GC æ—¶é—´è¿‡é•¿æ—¶æŠ›å‡º OutOfMemoryErrorï¼Œå³ï¼šå½“åƒåœ¾å›æ”¶è€—è´¹çš„æ—¶é—´è¶…è¿‡äº†æ€»æ—¶é—´çš„ 98%ï¼Œå¹¶ä¸”å›æ”¶çš„ç©ºé—´å°‘äº 2% æ—¶ï¼ŒOutOfMemoryError å°±ä¼šè¢«æŠ›å‡ºã€‚è¿™ä¸ªç‰¹æ€§æ˜¯ç”¨æ¥é˜²æ­¢ç”±äºå †å¤ªå°è€Œå¯¼è‡´åº”ç”¨è¿è¡Œæ—¶é—´å¤ªé•¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ -XX:-UseGCOverheadLimit ç¦ç”¨å®ƒã€‚\næµ®åŠ¨åƒåœ¾ ç”±äºåº”ç”¨çº¿ç¨‹ä¼šåœ¨ major GC ä¹‹é—´å¹¶å‘åœ°æ‰§è¡Œï¼ŒGC è¿½è¸ªåˆ°çš„å­˜æ´»å¯¹è±¡å¯èƒ½åœ¨åƒåœ¾æ”¶é›†ç»“æŸä¹‹å‰å˜å¾—ä¸å†å¯è¾¾ï¼Œè¿™ç±»å¯¹è±¡åœ¨å½“å‰è¿›è¡Œçš„è¿™ä¸€æ¬¡å›æ”¶è¿‡ç¨‹ä¸­å¹¶ä¸ä¼šè¢«å›æ”¶ï¼Œå®ƒä»¬è¢«ç§°ä¸º æµ®åŠ¨åƒåœ¾ï¼ˆfloating garbageï¼‰ã€‚æµ®åŠ¨åƒåœ¾çš„æ•°é‡å–å†³äºå¹¶å‘æ”¶é›†çš„æŒç»­æ—¶é—´ä»¥åŠå¯¹è±¡å¼•ç”¨æ›´æ–°çš„é¢‘ç‡ï¼Œä¸è¿‡è¿™äº›æµ®åŠ¨åƒåœ¾ä¼šåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­è¢«å›æ”¶æ‰ã€‚\nå¹¶å‘å›æ”¶ä½•æ—¶å¼€å§‹ ä¸²è¡Œæ”¶é›†å™¨ä¼šåœ¨å¹´è€ä»£è¢«å¡«æ»¡ä¹‹åæš‚åœåº”ç”¨å¹¶è¿›è¡Œ major GCã€‚ä¸æ­¤ç›¸åï¼Œå¹¶å‘æ”¶é›†çš„å¼€å§‹æ—¶é—´å¿…é¡»æå‰ç¡®å®šï¼Œä»¥ä¾¿æ”¶é›†å·¥ä½œåœ¨å¹´è€ä»£ç©ºé—´è€—å°½ä¹‹å‰å®Œæˆã€‚å¦åˆ™ï¼Œåº”ç”¨ä¼šç”±äºå¹¶å‘æ¨¡å¼å¤±è´¥è€Œè¢«é•¿æ—¶é—´æš‚åœã€‚æœ‰å‡ ç§å¼€å§‹å¹¶å‘æ”¶é›†çš„æ–¹å¼ï¼š\n åŸºäºå†å²æ•°æ®ï¼ŒCMS æ”¶é›†å™¨ä¼šé¢„ä¼°å¹´è€ä»£è¿˜æœ‰å¤šä¹…è¢«è€—å°½ä»¥åŠä¸€æ¬¡ major GC ä¼šèŠ±å¤šé•¿æ—¶é—´ã€‚CMS ä¼šä»¥åœ¨å¹´è€ä»£ç©ºé—´è€—å°½ä¹‹å‰å®Œæˆæ”¶é›†å·¥ä½œä¸ºç›®æ ‡å¼€å§‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè¿™äº›ä¼°ç®—æ—¶é—´é€šå¸¸æ˜¯ä¿å®ˆçš„ï¼Œå› ä¸ºå¹¶å‘æ¨¡å¼å¤±è´¥çš„ä»£ä»·å¤ªé«˜äº†ã€‚ å½“å¹´è€ä»£ä¸­è¢«å ç”¨çš„å®¹é‡è¶…è¿‡ä¸€ä¸ªé˜ˆå€¼æ—¶ï¼Œåƒåœ¾æ”¶é›†å·¥ä½œä¹Ÿä¼šå¼€å§‹ã€‚è¿™ä¸ªé˜ˆå€¼é»˜è®¤çº¦ä¸º 92%ï¼ˆå¯èƒ½åœ¨ä¸åŒå‘è¡Œç‰ˆæœ¬ä¸­åšè°ƒæ•´ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ XX:CMSInitiatingOccupancyFraction=\u0026lt;N\u0026gt; æ¥æŒ‡å®šè¿™ä¸ªé˜ˆå€¼ï¼Œå…¶ä¸­ \u0026lt;N\u0026gt; ä¸ºä¸€ä¸ªèŒƒå›´åœ¨ (1, 100) é—´çš„æ•´æ•°ã€‚  å¢é‡æ¨¡å¼  æ³¨æ„ï¼šå¢é‡æ¨¡å¼åœ¨ Java SE 8 ä¸­æ­£è¢«å¼ƒç”¨ï¼Œå°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šç§»é™¤ã€‚\n G1 æ”¶é›†å™¨ Garbage-Firstï¼ˆG1ï¼‰ æ”¶é›†å™¨æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„æ”¶é›†å™¨ï¼Œç›®æ ‡ä¸ºæ‹¥æœ‰å¤§å†…å­˜çš„å¤šå¤„ç†æœºã€‚å®ƒå°è¯•åœ¨å®ç°é«˜ååé‡çš„åŒæ—¶å¤§æ¦‚ç‡æ»¡è¶³åº”ç”¨å¯¹æš‚åœæ—¶é—´çš„è¦æ±‚ï¼Œè¿™è¯´æ˜ G1 å¹¶ä¸æ˜¯ä¸€ä¸ªå®æ—¶ GCã€‚\nG1 å°†å †åˆ†æˆè‹¥å¹²ä¸ªå¤§å°ç›¸ç­‰çš„ åŒºåŸŸï¼ˆregionï¼‰ï¼Œæ¯ä¸€ä¸ªåŒºåŸŸéƒ½æ˜¯ä¸€ä¸ªè¿ç»­çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚G1 é€šè¿‡å¹¶å‘æ ‡è®°é˜¶æ®µç¡®å®šæ•´ä¸ªå †ä¸­å¯¹è±¡çš„å­˜æ´»æ€§ï¼Œå¹¶å‘æ ‡è®°é˜¶æ®µå®Œæˆåï¼ŒG1 å°±çŸ¥é“å“ªäº›åŒºåŸŸä¸­çš„å­˜æ´»å¯¹è±¡æ¯”è¾ƒå°‘äº†ã€‚å®ƒä¼šå…ˆå›æ”¶è¿™äº›å­˜æ´»å¯¹è±¡å°‘çš„åŒºåŸŸï¼Œè€Œè¿™é€šå¸¸å¯ä»¥ä¸ºåº”ç”¨æä¾›å¤§é‡çš„ç©ºé—²ç©ºé—´ï¼Œè¿™å°±æ˜¯ G1ï¼ˆGarbage-Firstï¼‰åå­—çš„æ¥æºï¼Œå³ï¼šG1 ä¸“æ³¨äºæ”¶é›†å’Œæ•´ç†é‚£äº›å·®ä¸å¤šè¢«å¯å›æ”¶å¯¹è±¡ï¼ˆåƒåœ¾ï¼‰å æ»¡çš„åŒºåŸŸã€‚\nG1 ä¼šå°†å †ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªåŒºåŸŸä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å †ä¸­çš„å•ä¸ªåŒºåŸŸï¼Œå¤åˆ¶è¿‡ç¨‹ä¸­ä¹Ÿä¼šå®Œæˆæ•´ç†å’Œé‡Šæ”¾ç©ºé—²å†…å­˜çš„å·¥ä½œã€‚ä¸ºäº†é™ä½æš‚åœæ—¶é—´å¹¶æå‡ååé‡ï¼Œæ¸…ç©ºåŒºåŸŸçš„æ“ä½œåœ¨å¤šå¤„ç†æœºä¸Šæ˜¯å¹¶è¡Œè¿›è¡Œçš„ã€‚G1 é‡‡ç”¨çš„æ˜¯â€œåŒ–æ•´ä¸ºé›¶â€çš„ç­–ç•¥ï¼Œåœ¨æ•´ç†ä¸Šæ¯”å…¶å®ƒ GC æŠ€é«˜ä¸€ç­¹ï¼šCMS æ”¶é›†å™¨ä¸ä¼šæ•´ç†å †ï¼Œå› è€Œä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡ï¼›å¹¶è¡Œæ”¶é›†å™¨ä¸­çš„å¹¶è¡Œå‹ç¼©è¿‡ç¨‹æ˜¯åœ¨æ•´ä¸ªå †ä¸Šè¿›è¡Œçš„ï¼Œé‚£ä¼šä½¿æš‚åœæ—¶é—´å¾ˆå¯è§‚ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼šG1 å¹¶ä¸æ˜¯ä¸€æ¬¾å®æ—¶æ”¶é›†å™¨ï¼Œå®ƒå¤§æ¦‚ç‡ä¼šæ»¡è¶³æš‚åœæ—¶é—´çš„è¦æ±‚ï¼Œä½†å¹¶ä¸æ˜¯ä¸€å®šä¼šæ»¡è¶³ã€‚åˆ©ç”¨ä»å·²å‘ç”Ÿçš„åƒåœ¾å›æ”¶ä¸­é‡‡é›†çš„æ•°æ®ï¼ŒG1 ä¼šä¼°è®¡ç›®æ ‡æ—¶é—´å†…èƒ½å¤Ÿå›æ”¶åŒºåŸŸçš„æ•°é‡ã€‚G1 æœ€å…³æ³¨çš„æ˜¯å¦‚ä½•ä¸ºé‚£äº›å ç”¨å†…å­˜å¤§ä¸”å¯¹ GC å»¶è¿Ÿæœ‰è¦æ±‚çš„åº”ç”¨æä¾›è§£å†³æ–¹æ¡ˆï¼Œè¿™äº›åº”ç”¨çš„é€šå¸¸å ç”¨ä¸ä½äº 6GB çš„å †ç©ºé—´ï¼Œå¹¶ä¸”è¦æ±‚å»¶è¿Ÿæ—¶é—´ä½äº 0.5 ç§’ã€‚\nHotSpot å¼€å‘å›¢é˜Ÿå¸Œæœ›ç”¨ G1 æ¥ä»£æ›¿ CMS æ”¶é›†å™¨ï¼Œå®ƒä¸ CMS çš„ä¸»è¦ä¸åŒç‚¹åœ¨äºï¼šG1 æ˜¯ä¸€æ¬¾æ•´ç†å¼æ”¶é›†å™¨ã€‚å’Œ CMS ä¸€æ ·ï¼ŒG1 ä¹Ÿæ˜¯ä¸ºé‚£äº›è¦æ±‚ä½ GC å»¶è¿Ÿçš„åº”ç”¨è®¾è®¡çš„ã€‚\nä¸‹å›¾å±•ç¤ºäº† G1 æ˜¯å¦‚ä½•åˆ’åˆ†å †çš„ï¼š\nå †è¢«åˆ’åˆ†ä¸ºè‹¥å¹²å›ºå®šå¤§å°çš„åŒºåŸŸï¼ˆå›¾ä¸­çš„ç°è‰²æ ¼å­ï¼‰ã€‚ä»é€»è¾‘ä¸Šæ¥è®²ï¼ŒG1ä¸­ä¾ç„¶æœ‰åˆ†ä»£çš„æ¦‚å¿µã€‚ä¸€ç»„ç©ºé—²åŒºåŸŸè¢«æŒ‡å®šä¸ºé€»è¾‘å¹´è½»ä»£ï¼ˆå›¾ä¸­æµ…è“è‰²éƒ¨åˆ†ï¼‰ï¼Œåˆ†é…æ“ä½œå°±æ˜¯ä»è¿™ä¸ªé€»è¾‘å¹´è½»ä»£å¼€å§‹çš„ã€‚å½“å¹´è½»ä»£æ»¡äº†ä¹‹åï¼Œè¿™ç»„åŒºåŸŸä¸Šçš„åƒåœ¾æ”¶é›†å°±ä¼šå‘ç”Ÿã€‚æœ‰æ—¶å€™ï¼Œè¿™ç»„åŒºåŸŸä»¥å¤–çš„åŒºåŸŸï¼ˆå¹´è€åŒºåŸŸï¼Œæ·±è“è‰²ï¼‰ä¸Šçš„åƒåœ¾æ”¶é›†ä¹Ÿä¼šåŒæ—¶è¿›è¡Œï¼Œè¿™è¢«ç§°ä¸º æ··åˆæ”¶é›†ï¼ˆmixed collectionï¼‰ã€‚ä¸Šå›¾å±•ç¤ºçš„æ­£æ˜¯æ··åˆæ”¶é›†ï¼Œå› ä¸ºå¹´è½»åŒºåŸŸå’Œå¹´è€åŒºåŸŸéƒ½æ­£åœ¨è¢«å›æ”¶ï¼Œè¢«æ”¶é›†çš„åŒºåŸŸåœ¨å›¾ä¸­ç”¨çº¢è‰²æ ¼å­æ ‡å‡ºã€‚æ ¹æ®å¹´é¾„ï¼Œå­˜æ´»å¯¹è±¡å¯èƒ½è¢«å¤åˆ¶åˆ° Survivor åŒºåŸŸï¼ˆæ ‡æœ‰\u0026quot;S\u0026quot;ï¼‰ï¼Œä¹Ÿå¯èƒ½è¢«å¤åˆ¶åˆ°å¹´è€åŒºåŸŸï¼ˆå›¾ä¸­æœªå±•ç¤ºï¼‰ã€‚å›¾ä¸­æ ‡æœ‰ \u0026ldquo;H\u0026rdquo; çš„é‚£äº›åŒºåŸŸåŒ…å«çš„æ˜¯é‚£äº›å¤§å°è¶…è¿‡åŒºåŸŸçš„ä¸€åŠæˆ–éœ€è¦ç‰¹æ®Šå¯¹å¾…çš„å¤§å¯¹è±¡ã€‚\næµ®åŠ¨åƒåœ¾ å¯¹è±¡å¯èƒ½åœ¨G1å›æ”¶çš„è¿‡ç¨‹ä¸­æ­»äº¡å¹¶æœªè¢«å›æ”¶ã€‚ä¸ºäº†ä¿è¯æ‰¾åˆ°æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡ï¼ŒG1ä½¿ç”¨äº†ä¸€é¡¹å«åš SATBï¼ˆsnapshot-at-the-beginningï¼‰ çš„æŠ€æœ¯ã€‚SATBè§„å®šï¼šä»»ä½•åœ¨å¹¶å‘æ ‡è®°å¼€å§‹çš„æ—¶å€™å­˜æ´»çš„å¯¹è±¡åœ¨æ•´ä¸ª GC è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯è¢«è®¤ä¸ºæ˜¯å­˜æ´»çš„ã€‚å› æ­¤ï¼ŒG1 ä¸­ä¹Ÿä¼šå‡ºç°æµ®åŠ¨åƒåœ¾ã€‚\nå¡è¡¨ å¦‚æœ GC ä¸æ”¶é›†æ•´ä¸ªå †ï¼ŒGC å°±å¿…é¡»çŸ¥é“å“ªé‡Œæœ‰ä»å †ä¸­æœªæ”¶é›†éƒ¨åˆ†æŒ‡å‘æ­£è¢«æ”¶é›†éƒ¨åˆ†çš„æŒ‡é’ˆã€‚è¿™åœ¨åˆ†ä»£ GC ä¸­å¾ˆå…¸å‹ï¼šæœªæ”¶é›†éƒ¨åˆ†é€šå¸¸æ˜¯å¹´è€ä»£ï¼Œæ­£è¢«æ”¶é›†éƒ¨åˆ†æ˜¯å¹´è½»ä»£ã€‚è®°å¿†é›†ï¼ˆremembered setï¼‰ å°±æ˜¯ä¿å­˜è¿™äº›ä¿¡æ¯ï¼ˆå¹´è€ä»£åˆ°å¹´è½»ä»£çš„æŒ‡é’ˆï¼‰çš„æ•°æ®ç»“æ„ã€‚å¡è¡¨ï¼ˆcard tableï¼‰ æ˜¯è®°å¿†é›†çš„ä¸€ç§å…·ä½“å®ç°ï¼ŒHotSpot VM ä¸­ç”¨ä¸€ä¸ªå­—èŠ‚æ•°ç»„æ¥è¡¨ç¤ºå¡è¡¨ï¼Œæ¯ä¸€ä¸ªå­—èŠ‚éƒ½è¢«ç§°ä¸ºä¸€å¼ å¡ï¼Œæ¯å¼ å¡éƒ½å¯¹åº”äº†å †ä¸­çš„ä¸€ä¸ªåœ°å€ç©ºé—´ã€‚\nå‚è€ƒèµ„æ–™  Java Platform, Standard Edition HotSpot Virtual Machine Garbage Collection Tuning Guide.  ","href":"/java/jvm/garbage_collection_tuning_guide_in_javase8/","title":"åƒåœ¾å›æ”¶è°ƒä¼˜æŒ‡å—(Java SE 8)"},{"content":"çº¿ç¨‹æ± æ˜¯ç®¡ç†ä¸€ç»„åŒæ„å·¥ä½œçº¿ç¨‹çš„èµ„æºæ± ï¼Œå†…éƒ¨ä¸»è¦åˆ†ä¸ºå››éƒ¨åˆ†ï¼š\n çº¿ç¨‹æ± ç®¡ç†å™¨ï¼šè´Ÿè´£çº¿ç¨‹æ± çš„åˆ›å»ºã€é”€æ¯ã€æ·»åŠ ä»»åŠ¡ç­‰ç®¡ç†å·¥ä½œã€‚ å·¥ä½œé˜Ÿåˆ—ï¼ˆWork Queueï¼‰ï¼šä¿å­˜æ‰€æœ‰ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚ å·¥ä½œè€…çº¿ç¨‹ï¼ˆWorker Threadï¼‰ï¼šä»å·¥ä½œé˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªä»»åŠ¡å¹¶æ‰§è¡Œï¼Œç„¶åè¿”å›çº¿ç¨‹æ± å¹¶ç­‰å¾…ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚ ä»»åŠ¡ï¼ˆTaskï¼‰ï¼šå®ç°äº†ç»Ÿä¸€çš„æ¥å£ï¼Œè¢«å·¥ä½œè€…çº¿ç¨‹å¤„ç†å’Œæ‰§è¡Œã€‚  ä¸â€œä¸ºæ¯ä¸ªä»»åŠ¡éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹â€ç›¸æ¯”ï¼Œä½¿ç”¨çº¿ç¨‹æ± ä¸ä»…å¯ä»¥å¹³æ‘Šçº¿ç¨‹åœ¨åˆ›å»ºå’Œé”€æ¯è¿‡ç¨‹ä¸­äº§ç”Ÿçš„å·¨å¤§å¼€é”€ï¼Œè¿˜èƒ½æé«˜ç¨‹åºçš„å“åº”æ€§ï¼ˆå½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå·¥ä½œçº¿ç¨‹é€šå¸¸å·²ç»å­˜åœ¨ï¼Œå¯ä»¥èŠ‚çœåˆ›å»ºçº¿ç¨‹çš„æ—¶é—´ï¼‰ã€‚é€šè¿‡è°ƒæ•´çº¿ç¨‹æ± çš„å¤§å°ï¼Œä¸ä»…å¯ä»¥åˆ›å»ºè¶³å¤Ÿå¤šçš„çº¿ç¨‹ä»¥ä½¿ CPU ä¿æŒå¿™ç¢ŒçŠ¶æ€ï¼Œè¿˜å¯ä»¥é˜²æ­¢å¤šçº¿ç¨‹ç›¸äº’ç«äº‰èµ„æºè€Œä½¿åº”ç”¨ç¨‹åºè€—å°½å†…å­˜æˆ–å¤±è´¥ã€‚æœ€åï¼Œçº¿ç¨‹æ± å¯ä»¥ç»Ÿä¸€ç®¡ç†èµ„æºï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹ä»»åŠ¡è¿›è¡Œç®¡ç†ç­‰ã€‚\nè®¾ç½®çº¿ç¨‹æ± çš„å¤§å° æˆ‘ä»¬è°ƒæ•´çº¿ç¨‹æ± å¤§å°çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å……åˆ†åˆ©ç”¨ CPU å’Œå†…å­˜ç­‰èµ„æºï¼Œä»è€Œæœ€å¤§é™åº¦åœ°æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚çº¿ç¨‹æ± çš„ç†æƒ³å¤§å°å–å†³äºè¢«æäº¤çš„ä»»åŠ¡çš„ç±»å‹ä»¥åŠæ‰€éƒ¨ç½²ç³»ç»Ÿçš„ç‰¹æ€§ã€‚é€šå¸¸ä¸åº”è¯¥åœ¨ä»£ç ä¸­å›ºå®šçº¿ç¨‹æ± çš„å¤§å°ï¼Œè€Œåº”è¯¥é€šè¿‡æŸç§é…ç½®æœºåˆ¶æ¥æä¾›ï¼Œæˆ–è€…æ ¹æ® Runtime.getRuntime().availableProcessors() æ¥è·å–å¯ç”¨å¤„ç†å™¨çš„æ•°é‡ä¹‹ååŠ¨æ€è®¡ç®—ã€‚\nå¦‚æœçº¿ç¨‹æ± è¿‡å¤§ï¼Œé‚£ä¹ˆå¤§é‡çš„çº¿ç¨‹å°†åœ¨ç›¸å¯¹å¾ˆå°‘çš„ CPU å’Œå†…å­˜èµ„æºä¸Šå‘ç”Ÿç«äº‰ï¼Œè¿™ä¸ä»…ä¼šå¯¼è‡´æ›´é«˜çš„å†…å­˜ä½¿ç”¨é‡ï¼Œè€Œä¸”è¿˜å¯èƒ½è€—å°½èµ„æºã€‚å¦‚æœçº¿ç¨‹æ± è¿‡å°ï¼Œé‚£ä¹ˆå°†å¯¼è‡´è®¸å¤šç©ºé—²çš„å¤„ç†å™¨æ— æ³•æ‰§è¡Œå·¥ä½œï¼Œä»è€Œé™ä½ååç‡ã€‚\nJava Concurrency in Practice ä¸€ä¹¦å»ºè®®æˆ‘ä»¬ï¼šå¯¹äºè®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œåœ¨æ‹¥æœ‰ N ä¸ªå¤„ç†å™¨çš„ç³»ç»Ÿä¸Šï¼Œå½“çº¿ç¨‹æ± çš„å¤§å°ä¸º N+1 æ—¶ï¼Œé€šå¸¸èƒ½å®ç°æœ€ä¼˜çš„åˆ©ç”¨ç‡ï¼ˆå³ä½¿å½“è®¡ç®—å¯†é›†å‹çš„çº¿ç¨‹å¶å°”ç”±äºç¼ºé¡µæ•…éšœæˆ–è€…å…¶ä»–åŸå› è€Œæš‚åœæ—¶ï¼Œè¿™ä¸ªâ€œé¢å¤–â€çš„çº¿ç¨‹ä¹Ÿèƒ½ç¡®ä¿ CPU çš„æ—¶é’Ÿå‘¨æœŸä¸è¢«æµªè´¹ï¼‰ã€‚å¯¹äºåŒ…å«I/Oæ“ä½œæˆ–å…¶å®ƒé˜»å¡æ“ä½œçš„ä»»åŠ¡ï¼Œç”±äºçº¿ç¨‹å¹¶ä¸ä¼šä¸€ç›´æ‰§è¡Œï¼Œå› æ­¤çº¿ç¨‹æ± çš„è§„æ¨¡åº”è¯¥æ›´å¤§ã€‚è¦æ­£ç¡®çš„è®¾ç½®çº¿ç¨‹æ± çš„å¤§å°ï¼Œå¿…é¡»ä¼°ç®—å‡ºä»»åŠ¡çš„ç­‰å¾…æ—¶é—´ä¸è®¡ç®—æ—¶é—´çš„æ¯”å€¼ã€‚ä¹¦ä¸­è¿˜ç»™äº†æˆ‘ä»¬å¦ä¸€ä¸ªè®¡ç®—çº¿ç¨‹æ•°çš„å…¬å¼ã€‚\nå‡è®¾ï¼š\n$$N_{cpu} = number\\ of\\ CPUs$$ $$U_{cpu} = target\\ CPU\\ utilization, 0\\ \\le \\ U_{cpu} \\le \\ 1$$ $$\\frac{W}{C} = ratio\\ of\\ wait\\ time\\ to\\ compute\\ time$$\nè‹¥è¦ä½¿å¤„ç†å™¨è¾¾åˆ°æœŸæœ›çš„ä½¿ç”¨ç‡ï¼Œçº¿ç¨‹æ± çš„æœ€æœ‰å¤§å°ç­‰äºï¼š\n$$N_{threads} = N_{cpu} * U_{cpu} * (1 + \\frac{W})$$\nåˆ›å»ºçº¿ç¨‹æ±  æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ThreadPoolExecutor æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼š\npublic ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue\u0026lt;Runnable\u0026gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) { if (corePoolSize \u0026lt; 0 || maximumPoolSize \u0026lt;= 0 || maximumPoolSize \u0026lt; corePoolSize || keepAliveTime \u0026lt; 0) throw new IllegalArgumentException(); if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime); this.threadFactory = threadFactory; this.handler = handler; } ThreadPoolExecutor çš„æ„é€ å‡½æ•°åŒ…å«7ä¸ªæ ¸å¿ƒå‚æ•°ï¼š\n corePoolSizeï¼šçº¿ç¨‹æ± çš„å¸¸é©»æ ¸å¿ƒçº¿ç¨‹æ•°é‡ã€‚å¦‚æœè®¾ç½®è¿‡å°ï¼Œå¯èƒ½å¯¼è‡´é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œå¦‚æœè®¾ç½®è¿‡å¤§ï¼Œåˆä¼šé€ æˆç³»ç»Ÿèµ„æºçš„æµªè´¹ï¼Œå¼€å‘è€…åº”è¯¥æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯æ¥è°ƒæ•´æ­¤å€¼ã€‚ maximumPoolSizeï¼šæ± å†…æ‰€å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚ keepAliveTimeï¼šå½“æ± å†…çº¿ç¨‹æ•°é‡å¤§äº corePoolSize æˆ–å½“allowCoreThreadTimeOut è®¾ç½®ä¸º true æ—¶ï¼Œç©ºé—²çº¿ç¨‹åœ¨è¢«é”€æ¯å‰çš„æœ€å¤§å­˜æ´»æ—¶é—´ã€‚ unitï¼šæŒ‡å®š keepAliveTime å‚æ•°çš„å•ä½ã€‚ workQueueï¼šçº¿ç¨‹æ± æ‰§è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—ã€‚å½“çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨å¤„ç†ä»»åŠ¡æ—¶ï¼Œæ–°åˆ°æ¥çš„ä»»åŠ¡å°±ä¼šåœ¨ workQueue ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œã€‚å¸¸ç”¨çš„ä»»åŠ¡é˜Ÿåˆ—æœ‰ï¼šæœ‰ç•Œé˜Ÿåˆ— ArrayBlockingQueueã€æ— ç•Œé˜Ÿåˆ— LinkedBlockingQueue å’ŒåŒæ­¥é˜Ÿåˆ— SynchronousQueueï¼ˆå†…éƒ¨æ²¡æœ‰ç¼“å†²åŒºï¼‰ã€‚ threadFactoryï¼šæ‰§è¡Œå™¨åˆ›å»ºæ–°çº¿ç¨‹æ—¶æ‰€ä½¿ç”¨çš„å·¥å‚ï¼Œæ± ä¸­æ‰€æœ‰çš„çº¿ç¨‹éƒ½ç”±å®ƒåˆ›å»ºï¼ˆé€šè¿‡ addWorker() æ–¹æ³•ï¼‰ã€‚é»˜è®¤çš„çº¿ç¨‹å·¥å‚æ˜¯ DefaultThreadFactoryï¼Œå®ƒä¸ºçº¿ç¨‹æŒ‡å®šäº†åå­—å’Œä¼˜å…ˆçº§ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç° ThreadFactory æ¥å£æ¥å®ç°æ›´å¤šè‡ªå®šä¹‰æ“ä½œã€‚ handlerï¼šç”¨æ¥æ‰§è¡Œçº¿ç¨‹æ± çš„æ‹’ç»ï¼ˆé¥±å’Œï¼‰ç­–ç•¥ã€‚å½“ workQueue æ»¡äº†å¹¶ä¸”çº¿ç¨‹æ± ä¸èƒ½å†åˆ›å»ºçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡æ—¶ï¼Œå°±ä¼šå¯¹æ–°ä»»åŠ¡æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚æ‹’ç»ç­–ç•¥å…¶å®æ˜¯ä¸€ç§é™æµä¿æŠ¤æœºåˆ¶ã€‚  çº¿ç¨‹æ± çš„åŸºæœ¬å¤§å°ï¼ˆcorePoolSizeï¼‰ã€æœ€å¤§å¤§å°ï¼ˆmaximumPoolSizeï¼‰ä»¥åŠå­˜æ´»æ—¶é—´ï¼ˆkeepAliveTimeï¼‰ç­‰å› ç´ å…±åŒè´Ÿè´£çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯ã€‚åŸºæœ¬å¤§å°ä¹Ÿæ˜¯çº¿ç¨‹æ± çš„ç›®æ ‡å¤§å°ï¼Œå³åœ¨æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶çº¿ç¨‹æ± çš„å¤§å°ï¼Œå¹¶ä¸”åªæœ‰åœ¨å·¥ä½œé˜Ÿåˆ—æ»¡äº†çš„æƒ…å†µä¸‹æ‰ä¼šåˆ›å»ºè¶…å‡ºè¿™ä¸ªæ•°é‡çš„çº¿ç¨‹ã€‚çº¿ç¨‹æ± çš„æœ€å¤§å¤§å°è¡¨ç¤ºå¯ä»¥åŒæ—¶æ´»åŠ¨çš„çº¿ç¨‹æ•°é‡çš„ä¸Šé™ã€‚å¦‚æœæŸä¸ªçº¿ç¨‹çš„ç©ºé—²æ—¶é—´è¶…è¿‡äº†å­˜æ´»æ—¶é—´ï¼Œé‚£ä¹ˆå°†è¢«æ ‡è®°ä¸ºå¯å›æ”¶çš„ï¼Œå½“çº¿ç¨‹æ± çš„å½“å‰å¤§å°è¶…è¿‡äº†åŸºæœ¬å¤§å°æ—¶ï¼Œè¿™ä¸ªçº¿ç¨‹å°†è¢«ç»ˆæ­¢ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼šåœ¨åˆ›å»º TreadPoolExecutor çš„åˆæœŸï¼Œçº¿ç¨‹å¹¶ä¸ä¼šç«‹å³å¯åŠ¨ï¼Œè€Œæ˜¯ç­‰åˆ°æœ‰ä»»åŠ¡æäº¤æ—¶æ‰ä¼šå¯åŠ¨ï¼Œé™¤éè°ƒç”¨ prestartCoreThreads()ã€‚\né€šè¿‡ Executors å¿«é€Ÿåˆ›å»ºçº¿ç¨‹æ±  Javaç±»åº“ä¸­çš„ Executors æä¾›äº†ä¸å°‘åˆ›å»ºçº¿ç¨‹æ± çš„é™æ€å·¥å‚æ–¹æ³•ï¼š\n  newFixedThreadPool()ã€‚åˆ›å»ºä¸€ä¸ªå›ºå®šå®¹é‡çš„çº¿ç¨‹æ± ï¼Œæ¯æäº¤ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œç›´åˆ°è¾¾åˆ°çº¿ç¨‹æ± çš„å®¹é‡ï¼Œè¿™æ—¶çº¿ç¨‹æ± çš„è§„æ¨¡å°†ä¸å†å˜åŒ–ï¼ˆåœ¨çº¿ç¨‹æ± å…³é—­ä¹‹å‰ï¼Œè‹¥æœ‰çº¿ç¨‹å› æ•…ç»ˆæ­¢ï¼Œçº¿ç¨‹æ± å°†è¡¥å……æ–°çš„çº¿ç¨‹ï¼‰ã€‚è¿™ç§çº¿ç¨‹æ± ä¸€èˆ¬é€‚ç”¨äºä»»åŠ¡æ•°é‡ä¸å‡åŒ€ã€å¯¹å†…å­˜å‹åŠ›ä¸æ•æ„Ÿä½†å¯¹ç³»ç»Ÿè´Ÿè½½æ¯”è¾ƒæ•æ„Ÿçš„åœºæ™¯ã€‚\n  newCachedThreadPool()ã€‚åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± çš„å½“å‰è§„æ¨¡è¶…è¿‡äº†å¤„ç†éœ€æ±‚æ—¶ï¼Œå°±å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè€Œå½“éœ€æ±‚å¢åŠ æ—¶ï¼Œå°±æ·»åŠ æ–°çš„çº¿ç¨‹ã€‚å®ƒçš„ç‰¹ç‚¹åœ¨äºçº¿ç¨‹æ± çš„è§„æ¨¡å‡ ä¹å¯ä»¥æ— é™å¢åŠ ï¼ˆå®é™…ä¸Šæœ€å¤§å¯ä»¥è¾¾åˆ° 2^32 - 1ï¼‰ï¼Œéå¸¸é€‚åˆç”¨æ¥æ‰§è¡Œè¦æ±‚ä½å»¶è¿Ÿçš„çŸ­æœŸä»»åŠ¡ã€‚\n  newSingleTreadExecutor()ã€‚åˆ›å»ºå•ä¸ªå·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœè¿™ä¸ªçº¿ç¨‹å¼‚å¸¸ç»“æŸï¼Œåˆ™ä¼šåˆ›å»ºå¦ä¸€ä¸ªçº¿ç¨‹æ¥æ›¿ä»£ã€‚å®ƒèƒ½ç¡®ä¿ä»»åŠ¡æŒ‰ç…§æŸç§é¡ºåºä¸²è¡Œæ‰§è¡Œï¼ˆä¾‹å¦‚ FIFOã€LIFOã€ä¼˜å…ˆçº§ï¼‰ã€‚\n  newScheduledTreadPool()ã€‚åˆ›å»ºå›ºå®šå®¹é‡çš„çº¿ç¨‹æ± ï¼Œå¹¶ä¸”ä»¥å»¶è¿Ÿæˆ–è€…å®šæ—¶ä»»åŠ¡çš„æ–¹å¼æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå…·ä½“çš„å®ç°ä¸»è¦æœ‰ 3 ç§ï¼š\nScheduledExecutorServiceÂ serviceÂ =Â Executors.newScheduledThreadPool(10); service.schedule(newÂ Task(),Â 10,Â TimeUnit.SECONDS); service.scheduleAtFixedRate(newÂ Task(),Â 10,Â 10,Â TimeUnit.SECONDS); service.scheduleWithFixedDelay(newÂ Task(),Â 10,Â 10,Â TimeUnit.SECONDS);  schedule æ¯”è¾ƒç®€å•ï¼Œè¡¨ç¤ºå»¶è¿ŸæŒ‡å®šæ—¶é—´åæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼Œä»¥ä¸Šå³ 10 ç§’åæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡å°±ç»“æŸã€‚ scheduleAtFixedRate è¡¨ç¤ºä»¥å›ºå®šé¢‘ç‡æ‰§è¡Œä»»åŠ¡ï¼Œä»¥ä¸Šå³è¡¨ç¤ºç¬¬ä¸€æ¬¡å»¶è¿Ÿ 10 ç§’åæ¯éš” 10 ç§’æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ã€‚ scheduleWithFixedDelay å’Œç¬¬äºŒç§ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºå¯¹å‘¨æœŸçš„å®šä¹‰ã€‚sheculeAtFixedRate ä»¥ä»»åŠ¡å¼€å§‹çš„æ—¶é—´ä¸ºèµ·ç‚¹è®¡æ—¶ï¼Œæ—¶é—´åˆ°å°±æ‰§è¡Œä¸‹ä¸€æ¬¡ä»»åŠ¡ï¼Œè€Œä¸ç®¡ä»»åŠ¡æ‰§è¡Œè¦å¤šä¹…ã€‚è€Œ scheduleWithFixedDelay ä»¥ä»»åŠ¡ç»“æŸæ—¶é—´ä¸ºä¸‹ä¸€æ¬¡å¾ªç¯çš„æ—¶é—´ä¸ƒç‚¹å¼€å§‹è®¡æ—¶ã€‚    newSingleThreadScheduledExecutor()ã€‚ä¸ newScheduledTreadPool() éå¸¸ç›¸ä¼¼ï¼Œå®ƒåªæ˜¯ ScheduledThreadPool çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå†…éƒ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚\n  newWorkStealingPool() ç”¨äºåˆ›å»º ForkJoinPoolã€‚ForkJoinPool ä¹Ÿæ˜¯çº¿ç¨‹æ± ï¼Œä½†å®ƒä¸ ThreadPoolExecutor æœ‰ç€å¾ˆå¤§ä¸åŒã€‚å®ƒéå¸¸é€‚åˆç”¨æ¥æ‰§è¡Œå¯ä»¥äº§ç”Ÿå­ä»»åŠ¡çš„ä»»åŠ¡ï¼ˆå°¤å…¶æ˜¯ä»»åŠ¡æ‰§è¡Œæ—¶é•¿ä¸å‡åŒ€çš„åœºæ™¯ï¼‰ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸»è¦æ¶‰åŠä¸¤ä¸ªæ­¥éª¤ï¼šé¦–å…ˆæ˜¯æ‹†åˆ†ä»»åŠ¡ï¼ˆForkï¼‰ä¸ºå­ä»»åŠ¡ï¼Œç„¶åæ˜¯æ±‡æ€»ï¼ˆJoinï¼‰å­ä»»åŠ¡çš„ç»“æœå¾—åˆ°ä»»åŠ¡çš„ç»“æœã€‚æ­¤å¤–ï¼ŒForkJoinPool çš„å†…éƒ¨ç»“æ„ä¹Ÿä¸ ThreadPoolExecutor å¤§ä¸ç›¸åŒï¼šåœ¨ ForkJoinPool ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä»»åŠ¡é˜Ÿåˆ—ï¼ˆæ˜¯ä¸€ä¸ª Dequeï¼Œç”¨äºå­˜å‚¨åˆ†è£‚å‡ºæ¥çš„å­ä»»åŠ¡ï¼‰ï¼Œè€Œ ThreadPoolExecutor ä¸­æ‰€æœ‰çº¿ç¨‹å…±ç”¨ä¸€ä¸ªé˜Ÿåˆ—ã€‚\n  é˜¿é‡Œå·´å·´çš„ã€ŠJavaå¼€å‘æ‰‹å†Œã€‹ä¸­ä¸ºäº†è§„é¿èµ„æºè€—å°½çš„é£é™©ï¼Œç¦æ­¢ä½¿ç”¨ Executors ç±»å»åˆ›å»ºçº¿ç¨‹æ± ã€‚è¿™æ˜¯å› ä¸º Executors åˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹æ± æœ‰ä¸€äº›å¼Šç«¯ï¼š\n newFixedThreadPool() å’Œ newSingleThreadPool() åˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹æ± å…è®¸çš„è¯·æ±‚é˜Ÿåˆ—ï¼ˆworkQueueï¼‰é•¿åº¦ä¸º Integer.MAX_VALUEã€‚å¦‚æœçº¿ç¨‹æ± ä¸­ä»»åŠ¡çš„å¤„ç†æ¯”è¾ƒæ…¢ï¼Œé‚£ä¹ˆéšç€è¯·æ±‚çš„å¢å¤šï¼Œé˜Ÿåˆ—ä¸­å¯èƒ½å †ç§¯å¤§é‡çš„ä»»åŠ¡ï¼Œè¿›è€Œå ç”¨å¤§é‡å†…å­˜ï¼Œå¯¼è‡´ OOMã€‚ newCachedThreadPool() å’Œ newScheduledThreadPool() åˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹æ± å…è®¸çš„çº¿ç¨‹çš„æœ€å¤§æ•°é‡ï¼ˆmaximumPoolSizeï¼‰ä¸º Inteter.MAX_VALUEï¼Œå½“ä»»åŠ¡æ•°é‡ç‰¹åˆ«å¤šæ—¶ï¼Œå°±å¯èƒ½å¯¼è‡´å¤§é‡çš„çº¿ç¨‹è¢«åˆ›å»ºï¼Œæœ€ç»ˆå› è¶…è¿‡æ“ä½œç³»ç»Ÿçš„ä¸Šé™è€Œæ— æ³•å†åˆ›å»ºæ–°çº¿ç¨‹ï¼Œæˆ–è€…å¼•å‘ OOMã€‚  é™¤äº† ForkJoinPool å¦å¤–äº”ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•éƒ½å¯ä»¥è®¤ä¸ºæ˜¯åˆ©ç”¨ ThreadPoolExecutor æ¥å®ç°çš„ï¼ŒåŒºåˆ«å°±åœ¨äºä¼ å…¥çš„å‚æ•°ä¸åŒè€Œå·²ã€‚\n   çº¿ç¨‹æ±  corePoolSize maximumPoolSize keepAliveTime workQueue\u0026mdash;\u0026mdash;\u0026ndash;     newFixedThreadPool æ„é€ å‡½æ•°ä¼ å…¥ åŒ corePoolSize 0 LinkedBlockingQueue   newCachedThreadPool 0 Integer.MAX_VALUE 60s SynchronousQueue   newSingleTreadExecutor 1 1 0 LinkedBlockingQueue   newScheduledTreadPool æ„é€ å‡½æ•°ä¼ å…¥ Integer.MAX_VALUE 0 DelayedWorkQueue   newSingleThreadScheduledExecutor 1 Integer.MAX_VALUE 0 DelayedWorkQueue    å…³é—­çº¿ç¨‹æ±  æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨çº¿ç¨‹æ± çš„ shutdown() æˆ– shutdownNow() æ–¹æ³•æ¥å…³é—­çº¿ç¨‹æ± ã€‚å®ƒä»¬çš„åŸç†ä¸€æ ·ï¼šéƒ½æ˜¯é€šè¿‡éå†çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹ï¼Œç„¶åè°ƒç”¨çº¿ç¨‹çš„ interrup() æ–¹æ³•æ¥ä¸­æ–­çº¿ç¨‹ï¼Œæ‰€ä»¥æ— æ³•å“åº”ä¸­æ–­çš„ä»»åŠ¡å¯èƒ½æ°¸è¿œæ— æ³•ç»ˆæ­¢ã€‚ä½†å®ƒä»¬ä¹‹é—´å­˜åœ¨ä¸€å®šçš„åŒºåˆ«ï¼š shutdown() æ–¹æ³•å°†æ‰§è¡Œ å¹³ç¼“ çš„å…³é—­è¿‡ç¨‹ï¼šä¸å†æ¥å—æ–°ä»»åŠ¡ï¼ŒåŒæ—¶ç­‰å¾…å·²ç»æäº¤çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼ˆåŒ…æ‹¬å·²æäº¤ä½†è¿˜æœªæ‰§è¡Œçš„ä»»åŠ¡ï¼‰ã€‚shutdownNow() æ–¹æ³•å°†æ‰§è¡Œç²—æš´çš„å…³é—­è¿‡ç¨‹ï¼šå°è¯•å–æ¶ˆæ‰€æœ‰è¿è¡Œä¸­çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¸å†å¯åŠ¨é˜Ÿåˆ—ä¸­å°šæœªå¼€å§‹æ‰§è¡Œçš„ä»»åŠ¡ã€‚ç­‰æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆåï¼Œçº¿ç¨‹æ± å°±è½¬å…¥ Terminated(å·²ç»ˆæ­¢) çŠ¶æ€ã€‚\nJavaçº¿ç¨‹æ± çš„å¤ç”¨åŸç† ThreadPoolExecutor é€šè¿‡ execute(Runnable command) æ–¹æ³•æ¥æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ï¼š\npublic void execute(Runnable command) { if (command == null) throw new NullPointerException(); int c = ctl.get(); if (workerCountOf(c) \u0026lt; corePoolSize) { if (addWorker(command, true)) return; c = ctl.get(); } if (isRunning(c) \u0026amp;\u0026amp; workQueue.offer(command)) { int recheck = ctl.get(); if (! isRunning(recheck) \u0026amp;\u0026amp; remove(command)) reject(command); else if (workerCountOf(recheck) == 0) addWorker(null, false); } else if (!addWorker(command, false)) reject(command); } å½“æäº¤ä¸€ä¸ªæ–°ä»»åŠ¡åˆ°çº¿ç¨‹æ± æ—¶ï¼Œçº¿ç¨‹æ± çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š\n å¦‚æœçº¿ç¨‹æ± ä¸­æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ•°å°‘äºçº¿ç¨‹æ± çš„åŸºæœ¬å¤§å°ï¼ˆcorePoolSizeï¼‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦åˆ™ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ã€‚ å°è¯•å‘å¾€å·¥ä½œé˜Ÿåˆ—é‡ŒåŠ å…¥ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœå·¥ä½œé˜Ÿåˆ—æ»¡äº†ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ã€‚ å°è¯•åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™é‡‡ç”¨ç»™å®šçš„é¥±å’Œç­–ç•¥æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡ã€‚  execute() æ–¹æ³•å†…éƒ¨è°ƒç”¨äº† addWorker(Runnable firstTask, boolean core) æ–¹æ³•ï¼Œå®ƒçš„å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š\n firstTaskï¼šçº¿ç¨‹åº”é¦–å…ˆè¿è¡Œçš„ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰åˆ™å¯ä»¥è®¾ç½®ä¸º nullï¼› coreï¼šåˆ¤æ–­æ˜¯å¦å¯ä»¥åˆ›å»ºçº¿ç¨‹æ•°é‡çš„æœ€å¤§å€¼ï¼Œå¦‚æœç­‰äº true åˆ™è¡¨ç¤ºä½¿ç”¨ corePoolSize ä½œä¸ºä¸Šé™å€¼åˆ›å»º workerï¼Œfalse åˆ™è¡¨ç¤ºä½¿ç”¨ maximumPoolSize ä½œä¸ºä¸Šé™åˆ›å»º workerã€‚  æ‹’ç»ç­–ç•¥ å½“çº¿ç¨‹æ± æ— æ³•æ¥æ”¶æ–°çš„ä»»åŠ¡æ—¶ï¼Œå®ƒä¼šæŒ‰ç…§æˆ‘ä»¬æä¾›çš„æ‹’ç»ç­–ç•¥æ¥æ‹’ç»ä»»åŠ¡ã€‚é€šå¸¸æœ‰ä¸¤ç§æƒ…å†µï¼š\n çº¿ç¨‹æ± å†…çš„å·¥ä½œå·²ç»é¥±å’Œï¼ˆå³ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼Œè¿è¡Œä¸­çš„çº¿ç¨‹æ•°ä¹Ÿè¾¾åˆ°äº† maximumPoolSizeï¼‰ï¼Œçº¿ç¨‹æ± æ²¡æœ‰èƒ½åŠ›ç»§ç»­å¤„ç†æ–°æäº¤çš„ä»»åŠ¡ çº¿ç¨‹æ± è¢«å…³é—­ï¼ˆæ¯”å¦‚è°ƒç”¨ shutdown() æ–¹æ³•ï¼‰ã€‚å³ä¾¿æ­¤æ—¶çº¿ç¨‹æ± å†…éƒ¨ä¾ç„¶æ²¡æœ‰æ‰§è¡Œå®Œæˆçš„ä»»åŠ¡æ­£åœ¨æ‰§è¡Œï¼Œä½†çº¿ç¨‹æ± ä¹Ÿä¸ä¼šæ¥æ”¶ä»»ä½•æ–°çš„ä»»åŠ¡  ä½¿ç”¨è€…å¯ä»¥é€šè¿‡è°ƒç”¨ ThreadPoolExecutor çš„ setRejectedExecutionHandler(RejectedExecutionHandler handler) æ¥ä¿®æ”¹å…¶é¥±å’Œç­–ç•¥ã€‚JDK è‡ªå¸¦äº†å‡ ç§ä¸åŒçš„ RejectedExecutionHandler å®ç°ï¼Œæ¯ç§å®ç°éƒ½å¯¹åº”ç€æœ‰ä¸åŒçš„é¥±å’Œç­–ç•¥ï¼š\n AbortPolicyï¼šç»ˆæ­¢ç­–ç•¥ã€‚è¿™æ˜¯é»˜è®¤çš„ç­–ç•¥ï¼Œè¯¥ç­–ç•¥ç›´æ¥ä¼šæŠ›å‡º RejectedExecutionExceptionã€‚è°ƒç”¨è€…å¯ä»¥å°†å…¶æ•è·ï¼Œç„¶åæ ¹æ®å®é™…éœ€æ±‚ç¼–å†™å¤„ç†ä»£ç ã€‚ DiscardPolicyï¼šä¸¢å¼ƒç­–ç•¥ã€‚æ–°æäº¤çš„ä»»åŠ¡è¢«ç›´æ¥ä¸¢å¼ƒï¼Œè°ƒç”¨è€…ä¸ä¼šæ”¶åˆ°ä»»ä½•é€šçŸ¥ã€‚è¿™æ˜¯æœ‰ä¸€å®šé£é™©çš„ï¼Œå¯èƒ½é€ æˆæ•°æ®ä¸¢å¤±ã€‚ DiscardOldestPolicyï¼šä¸¢å¼ƒæœ€è€çš„ä»»åŠ¡ã€‚ä¸¢å¼ƒä¸‹ä¸€ä¸ªå°†è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶åå°è¯•é‡æ–°æäº¤æ–°çš„ä»»åŠ¡ã€‚è¿™ä¹Ÿå­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚ CallerRunsPolicyï¼šç”±è°ƒç”¨è€…æ‰§è¡Œã€‚ä¸ä¸¢å¼ƒä»»åŠ¡ï¼Œä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯å°†ä»»åŠ¡é€€å›ç»™è°ƒç”¨è€…ã€‚å®ƒä¸ä¼šåœ¨çº¿ç¨‹æ± ä¸­çš„æŸä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨äº†execute(Runnable command)æ–¹æ³•çš„çº¿ç¨‹ï¼ˆè°ƒç”¨è€…çº¿ç¨‹ï¼‰ä¸­ç»§ç»­æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ä»»åŠ¡ä¸ä¼šè¢«ä¸¢å¼ƒï¼Œä½†æ˜¯ä¼šå‡ç¼“ä»»åŠ¡æäº¤çš„é€Ÿåº¦ï¼Œç»™äº†çº¿ç¨‹æ± ä¸€å®šçš„ç¼“å†²æœŸã€‚  å‚è€ƒèµ„æ–™  Brian Goetz, Tim Peierls, Joshua Bloch, Joseph Bowbeer, David Holmes, and Doug Lea. Java Concurrency in Practice. Addison-Wesley Professional, 2006. æ–¹è…¾é£, é­é¹, ç¨‹æ™“æ˜. Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2015.  ","href":"/java/concurrency/java_thread_pool/","title":"Java çº¿ç¨‹æ± "},{"content":"è¿›ç¨‹ï¼ˆprocessï¼‰æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•å…ƒï¼Œè€Œçº¿ç¨‹ï¼ˆthreadï¼‰æ˜¯ç¨‹åºæ‰§è¡Œçš„åŸºæœ¬å•å…ƒã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«è¿›ç¨‹çš„èµ„æºã€‚å’Œè¿›ç¨‹ç›¸æ¯”ï¼Œçº¿ç¨‹æ›´åŠ è½»é‡åŒ–ï¼Œæ‰€ä»¥çº¿ç¨‹åˆå«è½»é‡çº§è¿›ç¨‹ã€‚\nåˆ›å»ºçº¿ç¨‹ ç½‘ä¸Šå¥½å¤šèµ„æ–™éƒ½è¯´æœ‰ä¸‰ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼š\n ç»§æ‰¿Threadç±»ï¼Œé‡å†™run()æ–¹æ³•ã€‚ å®ç°Runnableæ¥å£ã€‚ å®ç°Callableæ¥å£ã€‚  ä½†æœ¬è´¨ä¸Šåªæœ‰ä¸€ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼Œé‚£å°±æ˜¯æ„é€ ä¸€ä¸ª Thread ç±»ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸Šé¢å‡ ç§æ–¹å¼çš„å®é™…ä½¿ç”¨æƒ…å†µï¼š\nç»§æ‰¿ Thread ç±» public class ExtendsThread extends Thread { @Override public void run() { System.out.println(\u0026#34;é€šè¿‡ç»§æ‰¿ Thread ç±»æ¥å®ç°çº¿ç¨‹\u0026#34;); } } é€šè¿‡ç»§æ‰¿ Thread ç±»æ¥å®ç°çº¿ç¨‹æœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯ä»£ç æœªæ¥çš„å¯æ‰©å±•æ€§è¢«é™åˆ¶ã€‚Java æ˜¯ä¸æ”¯æŒå¤šç»§æ‰¿çš„ï¼Œä¸€æ—¦æˆ‘ä»¬çš„ç±»ç»§æ‰¿äº† Thread ç±»ï¼Œé‚£ä¹ˆå®ƒå°±ä¸èƒ½å†ç»§æ‰¿å…¶å®ƒç±»äº†ã€‚\nå®ç° Runnable æ¥å£ class RunnableThread implements Runnable { @Override public void run() { System.out.println(\u0026#34;é€šè¿‡å®ç° Runnable æ¥å£æ¥å®ç°çº¿ç¨‹\u0026#34;); } Thread æœ¬èº«ä¹Ÿå®ç°äº† Runnable æ¥å£ã€‚\nå®ç° Callable æ¥å£ class CallableTask implements Callable\u0026lt;Long\u0026gt; { @Override public Long call() throws Exception { System.out.println(\u0026#34;é€šè¿‡å®ç° Callable æ¥å£æ¥å®ç°çº¿ç¨‹\u0026#34;); return System.currentTimeMillis(); } } Executors.newSingleThreadExecutor().submit(new CallableTask()); å®ç° Callable æ¥å£ä¸å®ç° Runnable æ¥å£æœ€å¤§çš„åŒºåˆ«åœ¨äºè¿”å›å€¼ï¼šå‰è€…æœ‰è¿”å›å€¼çš„ï¼Œè€Œåè€…æ— è¿”å›å€¼ã€‚\n The Callable interface is similar to Runnable, in that both are designed for classes whose instances are potentially executed by another thread. A Runnable, however, does not return a result and cannot throw a checked exception.\n ä½†æ˜¯ï¼Œä¸ç®¡æ˜¯ Runnable è¿˜æ˜¯ Callableï¼Œå®ƒä»¬éƒ½è¡¨ç¤º è¢«çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå®ƒä»¬æœ¬èº«å¹¶ä¸æ˜¯çº¿ç¨‹ã€‚æ¥å£çš„ä¸åŒå®ç°åªæ˜¯æ„å‘³ç€äº¤ç»™çº¿ç¨‹æ‰§è¡Œçš„å†…å®¹ä¸åŒè€Œå·²ã€‚\nä½¿ç”¨çº¿ç¨‹æ±  æˆ‘ä»¬å¯èƒ½è¿˜ä¼šæƒ³åˆ°çº¿ç¨‹æ± ï¼Œä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œè²Œä¼¼ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹ã€‚é‚£ä¹ˆçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¦‚ä½•åˆ›å»ºçš„å‘¢ï¼Ÿå®é™…ä¸Šï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ ThreadFactory åˆ›å»ºçš„ï¼Œä¸è¿‡æœ€ç»ˆçš„çº¿ç¨‹è¿˜æ˜¯é€šè¿‡ new Thread() åˆ›å»ºå‡ºæ¥çš„ã€‚æˆ‘ä»¬å¯ä»¥æ¥çœ‹ä¸€ä¸‹ ThreadFactory çš„é»˜è®¤å®ç° DefaultThreadFactory çš„æºç ï¼š\nprivate static class DefaultThreadFactory implements ThreadFactory { private static final AtomicInteger poolNumber = new AtomicInteger(1); private final ThreadGroup group; private final AtomicInteger threadNumber = new AtomicInteger(1); private final String namePrefix; DefaultThreadFactory() { SecurityManager s = System.getSecurityManager(); group = (s != null) ? s.getThreadGroup() : Thread.currentThread().getThreadGroup(); namePrefix = \u0026#34;pool-\u0026#34; + poolNumber.getAndIncrement() + \u0026#34;-thread-\u0026#34;; } public Thread newThread(Runnable r) { Thread t = new Thread(group, r, namePrefix + threadNumber.getAndIncrement(), 0); if (t.isDaemon()) t.setDaemon(false); if (t.getPriority() != Thread.NORM_PRIORITY) t.setPriority(Thread.NORM_PRIORITY); return t; } } çº¿ç¨‹çš„å¯åŠ¨ çº¿ç¨‹çš„å¯åŠ¨å¾ˆç®€å•ï¼Œè°ƒç”¨ Thread ç±»çš„ start() æ–¹æ³•å³å¯ã€‚start() æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨ Runnable çš„ run() æ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡ã€‚\n@Override public void run() { if (target != null) { target.run(); } } é‚£ä¹ˆï¼Œstart() ä¸ run() æœ‰ä½•ä¸åŒå‘¢ï¼Ÿé¦–å…ˆï¼Œrun() æ–¹æ³•æ˜¯é€šè¿‡å®ç° Runnable æ¥å£å¾—æ¥çš„ï¼Œè€Œ start() æ˜¯ Thread ç±»è‡ªèº«çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå¯åŠ¨å½“å‰çº¿ç¨‹ï¼š\n/** * Causes this thread to begin execution; the Java Virtual Machine * calls the {@code run} method of this thread. * \u0026lt;p\u0026gt; * The result is that two threads are running concurrently: the * current thread (which returns from the call to the * {@code start} method) and the other thread (which executes its * {@code run} method). * \u0026lt;p\u0026gt; * It is never legal to start a thread more than once. * In particular, a thread may not be restarted once it has completed * execution. */ public synchronized void start() { /** * This method is not invoked for the main method thread or \u0026#34;system\u0026#34; * group threads created/set up by the VM. Any new functionality added * to this method in the future may have to also be added to the VM. * * A zero status value corresponds to state \u0026#34;NEW\u0026#34;. */ if (threadStatus != 0) throw new IllegalThreadStateException(); /* Notify the group that this thread is about to be started * so that it can be added to the group\u0026#39;s list of threads * and the group\u0026#39;s unstarted count can be decremented. */ group.add(this); boolean started = false; try { start0(); started = true; } finally { try { if (!started) { group.threadStartFailed(this); } } catch (Throwable ignore) { /* do nothing. If start0 threw a Throwable then it will be passed up the call stack */ } } } å¦å¤–ï¼Œstart() æ–¹æ³•é€šè¿‡ synchronized æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸”åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œè¿˜ä¼šå½±å“çº¿ç¨‹çš„çŠ¶æ€ï¼ˆç”±NEWå˜ä¸ºRUNNABLEï¼‰ï¼Œè€Œ run() åªæ˜¯ä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œå¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼Œå¹¶ä¸”ä¸ä¼šæ”¹å˜çº¿ç¨‹çš„çŠ¶æ€ã€‚\nåœæ­¢çº¿ç¨‹ é€šå¸¸ï¼Œæˆ‘ä»¬ä¸ä¼šæ‰‹åŠ¨åœæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯è®©çº¿ç¨‹è¿è¡Œåˆ°ç»“æŸï¼Œè‡ªç„¶åœæ­¢ã€‚ä½†æ˜¯æœ‰è®¸å¤šç‰¹æ®Šçš„æƒ…å†µéœ€è¦æˆ‘ä»¬æå‰åœæ­¢çº¿ç¨‹ï¼Œæ¯”å¦‚ï¼šç”¨æˆ·çªç„¶å…³é—­ç¨‹åºï¼Œæˆ–ç¨‹åºè¿è¡Œå‡ºé”™é‡å¯ç­‰ã€‚\nè¢«å¼ƒç”¨çš„åœæ­¢æ–¹æ³• Java åœ¨ Thread ç±»ä¸­æä¾›äº† stop() æ–¹æ³•ï¼Œç”¨äºå¼ºè¡Œåœæ­¢å½“å‰çº¿ç¨‹ã€‚ä½†è¿™ä¸ªæ–¹æ³•è‡ª JDK1.2 å¼€å§‹å°±è¢«æ ‡è®°ä¸º @Deprecatedï¼Œä¸€åŒè¢«æ ‡è®°çš„è¿˜æœ‰ suspend() å’Œ resume() æ–¹æ³•ã€‚é‚£ä¹ˆï¼Œä¸ºä½• JDK è¦å¼ƒç”¨è¿™äº›æ–¹æ³•å‘¢ï¼Ÿå› ä¸º stop() ä¼šç›´æ¥åœæ­¢å½“å‰çº¿ç¨‹ï¼Œçº¿ç¨‹å°±æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´æ¥å¤„ç†åœæ­¢å‰éœ€è¦å®Œæˆçš„å·¥ä½œï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„å®Œæ•´æ€§ç­‰é—®é¢˜ã€‚ suspend() å’Œ resume() çš„é—®é¢˜åˆ™åœ¨äºï¼šè°ƒç”¨ suspend() çš„çº¿ç¨‹ä¸é‡Šæ”¾é”å°±ç›´æ¥è¿›å…¥ä¼‘çœ ï¼Œè¿™å¯èƒ½å¯¼è‡´æ­»é”ï¼Œå› ä¸ºå¦‚æœçº¿ç¨‹åœ¨ä¼‘çœ æœŸé—´æŒæœ‰é”çš„è¯ï¼Œè¿™æŠŠé”åœ¨çº¿ç¨‹è¢« resume() ä¹‹å‰æ˜¯ä¸ä¼šè¢«é‡Šæ”¾çš„ã€‚\næ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼šå‡è®¾çº¿ç¨‹ A è°ƒç”¨ suspend() è®©çº¿ç¨‹ B æŒ‚èµ·ï¼Œçº¿ç¨‹ B è¿›å…¥ä¼‘çœ ï¼Œè€Œçº¿ç¨‹ B åˆšå¥½æŒæœ‰é” Lã€‚å‡è®¾æ­¤æ—¶çº¿ç¨‹ A æƒ³è¦è®¿é—®çº¿ç¨‹ B æŒæœ‰çš„é” Lï¼Œç”±äºçº¿ç¨‹ B æ²¡é‡Šæ”¾é” L å°±ä¼‘çœ äº†ï¼Œæ‰€ä»¥çº¿ç¨‹ A æ˜¯æ‹¿ä¸åˆ°é” L çš„ï¼Œå®ƒå°±ä¼šé™·å…¥é˜»å¡ã€‚è¿™æ ·ä¸€æ¥ï¼Œçº¿ç¨‹ A å’Œçº¿ç¨‹ B éƒ½æ— æ³•ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚\nJava SE çš„ API æ–‡æ¡£é‡Œé¢å…¶å®ä¹Ÿç»™å‡ºäº†è¿™ä¸‰ä¸ªæ–¹æ³•è¢«å¼ƒç”¨çš„åŸå› ï¼ˆWhy are Thread.stop, Thread.suspend and Thread.resume Deprecated?ï¼‰ï¼Œå¹¶ç»™å‡ºäº†ç›¸å…³çš„æ›¿ä»£æ–¹æ¡ˆã€‚\nä½¿ç”¨çŠ¶æ€æ ‡è®° å¯¹äºå¤§å¤šæ•°æƒ…å†µï¼ŒJDK å»ºè®®æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªçŠ¶æ€å˜é‡æ¥æŒ‡ç¤ºç›®æ ‡çº¿ç¨‹æ˜¯å¦åº”è¯¥åœæ­¢è¿è¡Œã€‚ç›®æ ‡çº¿ç¨‹å‘¨æœŸæ€§åœ°æ£€æŸ¥è¿™ä¸ªçŠ¶æ€å˜é‡çš„å€¼ï¼Œå½“çŠ¶æ€å˜é‡æš—ç¤ºè¦åœæ­¢ç›®æ ‡çº¿ç¨‹æ—¶ï¼Œå°±ä» run() æ–¹æ³•è¿”å›ã€‚ä¸ºäº†ç¡®ä¿åœæ­¢è¯·æ±‚çš„åŠæ—¶ä¼ æ’­ï¼Œè¿™ä¸ªçŠ¶æ€å˜é‡åº”è¯¥è¢« volatile ä¿®é¥°ï¼Œæˆ–è€…å¯¹è¯¥å˜é‡çš„è®¿é—®è¿›è¡ŒåŒæ­¥å¤„ç†ã€‚\nprivate volatile Thread blinker; public void stop() { blinker = null; } public void run() { Thread thisThread = Thread.currentThread(); while (blinker == thisThread) { try { Thread.sleep(interval); } catch (InterruptedException e){ } repaint(); } } ç„¶è€Œï¼Œå¹¶ä¸æ˜¯ä»…ä»…ä½¿ç”¨ volatile æ ‡è®°çŠ¶æ€å˜é‡å°±ç™¾åˆ†ç™¾æ²¡é—®é¢˜äº†ï¼Œæˆ‘ä»¬è¿˜å¾—å€åŠ å°å¿ƒã€‚ä¸‹é¢æ˜¯ç½‘ä¸Šçš„ä¸€ä¸ªä¾‹å­ï¼š\npublic class VolatileCannotStop { // ç”Ÿäº§è€…  static class Producer implements Runnable { public volatile boolean canceled = false; private BlockingQueue\u0026lt;Integer\u0026gt; storage; public Producer(BlockingQueue\u0026lt;Integer\u0026gt; storage) { this.storage = storage; } @Override public void run() { int num = 0; try { while (num \u0026lt;= 100000 \u0026amp;\u0026amp; !canceled) { if (num % 50 == 0) { storage.put(num); // é˜»å¡æ“ä½œ  System.out.println(num + \u0026#34;æ˜¯50çš„å€æ•°ï¼Œæ”¾å…¥ä»“åº“\u0026#34;); } num++; } } catch (InterruptedException e) { e.printStackTrace(); } finally { System.out.println(\u0026#34;ç”Ÿäº§è€…ç»“æŸè¿è¡Œ\u0026#34;); } } } // æ¶ˆè´¹è€…  static class Consumer { BlockingQueue storage; public Consumer(BlockingQueue storage) { this.storage = storage; } public boolean needMoreNums() { return Math.random() \u0026gt; 0.97; } } public static void main(String[] args) throws InterruptedException { BlockingQueue storage = new ArrayBlockingQueue(8); Producer producer = new Producer(storage); new Thread(producer).start(); Thread.sleep(500); Consumer consumer = new Consumer(storage); while (consumer.needMoreNums()) { System.out.println(consumer.storage.take() + \u0026#34;è¢«æ¶ˆè´¹äº†\u0026#34;); Thread.sleep(100); // è¿™æ®µæ—¶é—´å†…æ¶ˆè´¹è€…åˆå¯ä»¥å°† storage å¡æ»¡ï¼Œç„¶åé˜»å¡  } System.out.println(\u0026#34;æ¶ˆè´¹è€…ä¸éœ€è¦æ›´å¤šæ•°æ®äº†\u0026#34;); // ä¸€æ—¦æ¶ˆè´¹è€…ä¸éœ€è¦æ›´å¤šæ•°æ®äº†ï¼Œæˆ‘ä»¬å°±åº”è¯¥è®©ç”Ÿäº§è€…åœä¸‹æ¥ï¼Œç„¶è€Œå®é™…æƒ…å†µå´æ˜¯ç”Ÿäº§è€…åœä¸ä¸‹ç±»  producer.canceled = true; System.out.println(producer.canceled); } } ç›´æ¥çœ‹ main() æ–¹æ³•ï¼Œé¦–å…ˆåˆ›å»ºäº†ç”Ÿäº§è€…/æ¶ˆè´¹è€…å…±ç”¨çš„ä»“åº“Â storageï¼Œä»“åº“å®¹é‡æ˜¯ 8ï¼Œç„¶ååˆ›å»ºç”Ÿäº§è€…å¹¶å¯åŠ¨ç”Ÿäº§è€…çº¿ç¨‹ï¼Œç´§æ¥ç€ä¸»çº¿ç¨‹è¿›è¡Œ 500 æ¯«ç§’çš„ä¼‘çœ ï¼Œä¿éšœç”Ÿäº§è€…æœ‰è¶³å¤Ÿçš„æ—¶é—´æŠŠä»“åº“å¡æ»¡ï¼Œä»“åº“è¢«å¡æ»¡åç”Ÿäº§è€…å°±ä¼šé˜»å¡ï¼Œ500 æ¯«ç§’åæ¶ˆè´¹è€…ä¹Ÿè¢«åˆ›å»ºå‡ºæ¥ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨æ›´å¤šçš„æ•°å­—ï¼Œç„¶åæ¯æ¬¡æ¶ˆè´¹åä¼‘çœ  100 æ¯«ç§’ï¼Œè¿™æ ·çš„ä¸šåŠ¡é€»è¾‘æ˜¯æœ‰å¯èƒ½å‡ºç°åœ¨å®é™…ç”Ÿäº§ä¸­çš„ã€‚\nå½“æ¶ˆè´¹è€…ä¸å†éœ€è¦æ•°æ®ï¼Œå°±ä¼šå°† canceled çš„æ ‡è®°ä½è®¾ç½®ä¸º trueï¼Œç†è®ºä¸Šæ­¤æ—¶ç”Ÿäº§è€…ä¼šè·³å‡º while å¾ªç¯ï¼Œå¹¶æ‰“å°è¾“å‡ºç”Ÿäº§è€…è¿è¡Œç»“æŸã€‚ç„¶è€Œç»“æœå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è±¡çš„é‚£æ ·ï¼Œå°½ç®¡å·²ç»æŠŠ canceled è®¾ç½®æˆ trueï¼Œä½†ç”Ÿäº§è€…ä»ç„¶æ²¡æœ‰åœæ­¢ï¼Œè¿™æ˜¯å› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…åœ¨æ‰§è¡Œ storage.put(num)Â æ—¶ä¼šè¢«é˜»å¡ï¼Œåœ¨å®ƒè¢«å«é†’ä¹‹å‰æ˜¯æ²¡æœ‰åŠæ³•è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯åˆ¤æ–­Â canceledÂ çš„å€¼çš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ç”¨ volatile æ˜¯æ²¡æœ‰åŠæ³•è®©ç”Ÿäº§è€…åœä¸‹æ¥çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨ interrupt() æ¥ä¸­æ–­çº¿ç¨‹ã€‚å³ä½¿ç”Ÿäº§è€…å¤„äºé˜»å¡çŠ¶æ€ï¼Œå®ƒä»ç„¶èƒ½å¤Ÿæ„Ÿå—åˆ°ä¸­æ–­ä¿¡å·ï¼Œå¹¶ä½œå‡ºå“åº”ã€‚\nä½¿ç”¨ interrupt åœ¨ Java ä¸­ï¼Œåœæ­¢çº¿ç¨‹çš„æ­£ç¡®å§¿åŠ¿æ˜¯ä½¿ç”¨Â interrupt()ã€‚ä½† interrupt() ä»…ä»…èµ·åˆ°é€šçŸ¥è¢«åœæ­¢çº¿ç¨‹çš„ä½œç”¨ã€‚è€Œå¯¹äºè¢«åœæ­¢çš„çº¿ç¨‹è€Œè¨€ï¼Œå®ƒæ‹¥æœ‰å®Œå…¨çš„è‡ªä¸»æƒï¼Œå¯ä»¥é€‰æ‹©ç«‹å³åœæ­¢ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸€æ®µæ—¶é—´ååœæ­¢ï¼Œç”šè‡³å¯ä»¥é€‰æ‹©ä¸åœæ­¢ã€‚ä¸é‡‡ç”¨å¼ºåˆ¶åœæ­¢çš„åšæ³•çš„åŸå› æ˜¯ï¼šè´¸ç„¶å¼ºè¡Œåœæ­¢çº¿ç¨‹å¯èƒ½é€ æˆä¸€äº›å®‰å…¨é—®é¢˜ï¼Œè‹¥è¦é¿å…è¿™äº›é—®é¢˜ï¼Œå°±éœ€è¦ç»™ç›®æ ‡çº¿ç¨‹ä¸€äº›æ—¶é—´è¿›è¡Œæ”¶å°¾å·¥ä½œã€‚\nwhileÂ (!Thread.currentThread().isInterrupted()Â \u0026amp;\u0026amp;Â (has moreÂ workÂ toÂ do))Â { doÂ moreÂ work } è°ƒç”¨æŸä¸ªçº¿ç¨‹çš„ interrupt() æ–¹æ³•ä¹‹åï¼Œè¿™ä¸ªçº¿ç¨‹çš„ä¸­æ–­æ ‡è®°ä½å°±ä¼šè¢«è®¾ç½®æˆ trueã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è¿™æ ·çš„æ ‡è®°ä½ï¼Œå½“çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œåº”è¯¥å®šæœŸæ£€æŸ¥è¿™ä¸ªæ ‡è®°ä½ï¼Œå¦‚æœæ ‡è®°ä½è¢«è®¾ç½®æˆ trueï¼Œå°±è¯´æ˜æœ‰ç¨‹åºæƒ³ç»ˆæ­¢è¯¥çº¿ç¨‹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼š\npublic class StopThread { public static void main(String[] args) throws InterruptedException { Thread t = new Thread(new Runnable() { @Override public void run() { int count = 0; while (!Thread.currentThread().isInterrupted() \u0026amp;\u0026amp; count \u0026lt; 1000) { System.out.println(\u0026#34;count = \u0026#34; + (count++)); } } }); t.start(); Thread.sleep(5); t.interrupt(); } } ç¨‹åºè¿˜æ²¡æ‰“å°å®Œ 1000 ä¸ªæ•°å°±ä¼šåœä¸‹æ¥ï¼Œå› ä¸ºå¯¹åº”çš„çº¿ç¨‹è¢« interrupt äº†ã€‚\nä¼‘çœ ä¸­çš„çº¿ç¨‹æ˜¯å¯ä»¥æ„Ÿå—åˆ°ä¸­æ–­ä¿¡å·çš„ï¼Œè¢«ä¸­æ–­çš„çº¿ç¨‹ä¼šæŠ›å‡ºä¸€ä¸ª InterruptedExceptionï¼ŒåŒæ—¶æ¸…é™¤ä¸­æ–­ä¿¡å·ï¼Œå°†ä¸­æ–­æ ‡è®°ä½è®¾ç½®æˆ falseã€‚è°ƒç”¨æ–¹å¯ä»¥æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œè¿›è¡Œå¤„ç†ï¼Œè¿˜å¯ä»¥å†æ¬¡ä¸­æ–­çº¿ç¨‹ã€‚å†æ¬¡ä¸­æ–­åï¼Œåç»­æ‰§è¡Œçš„æ–¹æ³•ä¾ç„¶å¯ä»¥æ£€æµ‹åˆ°è°ƒç”¨è¿‡ç¨‹å‘ç”Ÿè¿‡ä¸­æ–­ï¼Œå¯ä»¥åšå‡ºç›¸åº”çš„å¤„ç†ï¼Œæ•´ä¸ªçº¿ç¨‹å¯ä»¥æ­£å¸¸é€€å‡ºã€‚\nçº¿ç¨‹çš„çŠ¶æ€ Javaçº¿ç¨‹åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­å¯èƒ½å¤„äº6ç§çŠ¶æ€ï¼ˆè¿™6ç§çŠ¶æ€æŒ‡çš„çº¿ç¨‹åœ¨ JVM ä¸­çš„çŠ¶æ€ï¼Œå¹¶ä¸æ˜¯æ“ä½œç³»ç»Ÿä¸­çº¿ç¨‹çš„çŠ¶æ€ï¼‰ï¼ŒåŒä¸€æ—¶åˆ»ï¼Œçº¿ç¨‹åªèƒ½å¤„äºå…¶ä¸­çš„ä¸€ä¸ªçŠ¶æ€ã€‚\n   çŠ¶æ€ è¯´æ˜     NEW A thread that has not yet started is in this state.   RUNNABLE A thread executing in the Java virtual machine is in this state.   BLOCKED A thread that is blocked waiting for a monitor lock is in this state.   WAITING A thread that is waiting indefinitely for another thread to perform a particular action is in this state.   TIMED_WAITING A thread that is waiting for another thread to perform an action for up to a specified waiting time is in this state.   TERMINATED A thread that has exited is in this state.    ä»¥ä¸‹æ˜¯çº¿ç¨‹ä¹‹é—´çš„çŠ¶æ€è¿ç§»å›¾ï¼š\nwait() ä¸ notify() è‹¥ synchronized å…³é”®å­—ä¿®é¥°çš„æŸä¸ªå…±äº«èµ„æº R çš„é”å·²ç»è¢«çº¿ç¨‹ T1 è·å¾—ï¼Œå…¶å®ƒéœ€è¦èµ„æº R çš„é”æ‰èƒ½è¿è¡Œçš„çº¿ç¨‹å°±ä¼šè¢«é˜»å¡ç›´è‡³ T1 é‡Šæ”¾ R ä¸Šçš„é”ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé”æ˜¯åœ¨åŒæ­¥ä»£ç å—æ‰§è¡Œå®Œæ‰è¢«é‡Šæ”¾çš„ã€‚\nä½†æ˜¯åœ¨åŒæ­¥ä»£ç å—æ‰§è¡ŒæœŸé—´ï¼Œå·²æŒæœ‰é”çš„çº¿ç¨‹ T1 å¯ä»¥è°ƒç”¨èµ„æº R çš„ wait() æ–¹æ³•é‡Šæ”¾é”ï¼Œç„¶åè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå½“å‰çº¿ç¨‹è¢«æŒ‚èµ·ã€‚é”çš„æŒæœ‰è€…å¯ä»¥è°ƒç”¨ notify() æ–¹æ³•éšæœºå”¤é†’ä¸€ä¸ªå¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œæˆ– notifyAll() æ–¹æ³•å»å”¤é†’æ‰€æœ‰å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ã€‚\nåªæœ‰æŒæœ‰ä¸å…±äº«èµ„æº R ç›¸å…³è”çš„ monitor çš„é”çš„çº¿ç¨‹æ‰åº”è¯¥å»è°ƒç”¨ notify() æˆ– notifyAll() æ–¹æ³•ã€‚ä¸€ä¸ªçº¿ç¨‹å¯ä»¥é€šè¿‡3ç§æ–¹å¼è·å¾—ä¸èµ„æº R ç›¸å…³è”çš„ monitor çš„é”ï¼Œè¿™ä¸‰ç§æ–¹å¼åˆšå¥½å¯¹åº”äºåŒæ­¥ä»£ç å—çš„ä¸‰ç§å½¢å¼ã€‚å› ä¸ºåªæœ‰æŒæœ‰ monitor çš„é”ï¼Œæ‰èƒ½è¿›å…¥åŒæ­¥ä»£ç å—ã€‚\nsleep() ä¸ wait() sleep() ä¸ wait() éƒ½å¯ä»¥æš‚åœçº¿ç¨‹æ‰§è¡Œï¼Œä½†å®ƒä»¬è¿˜æœ‰ä¸€äº›åŒºåˆ«ï¼š\n åŸç†ä¸åŒã€‚sleep() æ˜¯ Thread ç±»çš„é™æ€æ–¹æ³•ï¼Œæ˜¯çº¿ç¨‹è‡ªå·±ç”¨æ¥æ§åˆ¶è‡ªèº«æ‰§è¡Œçš„ï¼Œå®ƒå¯ä»¥ä½¿çº¿ç¨‹è‡ªå·±æš‚åœä¸€æ®µæ—¶é—´ï¼ŒæŠŠæ‰§è¡Œçš„æœºä¼šè®©ç»™å…¶å®ƒçº¿ç¨‹ï¼Œç­‰ç¡çœ æ—¶é—´ä¸€åˆ°ï¼Œä¾¿ä¼šè‡ªåŠ¨â€œé†’æ¥â€ã€‚è€Œ wait() æ˜¯ Object ç±»çš„æ–¹æ³•ï¼Œç”¨äºçº¿ç¨‹é—´çš„é€šä¿¡ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šä½¿å½“å‰æŒæœ‰å¯¹è±¡é”çš„çº¿ç¨‹é‡Šæ”¾é”å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´è‡³å…¶å®ƒçº¿ç¨‹è°ƒç”¨å¯¹è±¡çš„ notify() æˆ– notifyAll() æ–¹æ³•æ‰ä¼šé†’æ¥ã€‚wait() æ–¹æ³•ä¹Ÿæ”¯æŒè®¾ç½®è¶…æ—¶æ—¶é—´ã€‚ å¯¹é”çš„å¤„ç†æœºåˆ¶ä¸åŒã€‚è°ƒç”¨ sleep() æ–¹æ³•åªæ˜¯è®©å½“å‰çº¿ç¨‹æš‚åœä¸€æ®µæ—¶é—´ï¼Œä¸æ¶‰åŠçº¿ç¨‹é—´é€šä¿¡ï¼Œä¹Ÿä¸ä¼šé‡Šæ”¾é”ã€‚è€Œè°ƒç”¨ wait() æ–¹æ³•ä¼šé‡Šæ”¾é”ã€‚ ä½¿ç”¨åŒºåŸŸä¸åŒã€‚sleep() æ–¹æ³•å¯ä»¥åœ¨ä»»ä½•åŒºåŸŸä½¿ç”¨ã€‚è€Œç”±äºè°ƒç”¨ wait() æ–¹æ³•å‰å¿…é¡»å…ˆè·å¾—å¯¹è±¡é”ï¼Œå› æ­¤åªèƒ½åœ¨åŒæ­¥ä»£ç å—å†…ä½¿ç”¨ã€‚ å¯¹å¼‚å¸¸çš„å¤„ç†æ–¹å¼ä¸åŒã€‚è°ƒç”¨ sleep() æ–¹æ³•æ—¶å¿…é¡»å¤„ç† InterruptedException å¼‚å¸¸ã€‚è€Œè°ƒç”¨ wait() æ–¹æ³•æ—¶ä¸ç”¨å…³å¿ƒå¼‚å¸¸å¤„ç†ã€‚  sleep() ä¸ yield() sleep()æ–¹æ³•ä¸yield()æ–¹æ³•éƒ½å±äºThreadç±»ï¼Œå®ƒä»¬çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ï¼š\n å‰è€…è¢«è°ƒç”¨åä¼šç«‹é©¬è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œåœ¨ä¸€æ®µæ—¶é—´å†…ä¸ä¼šå†æ‰§è¡Œã€‚è€Œåè€…åªæ˜¯ä½¿å½“å‰çº¿ç¨‹é‡æ–°å›åˆ°RUNNABLEçŠ¶æ€ï¼Œå› æ­¤å¯èƒ½é©¬ä¸Šåˆè¢«æ‰§è¡Œã€‚ å‰è€…åœ¨æ–¹æ³•å£°æ˜ä¸ŠæŠ›å‡ºäº†InterruptedExceptionå¼‚å¸¸ï¼Œè€Œåè€…æ²¡æœ‰å£°æ˜ä»»ä½•å¼‚å¸¸ã€‚  join() JDKä¸­å¯¹join()æ–¹æ³•çš„è§£é‡Šä¸ºï¼šWaits for this thread to die.\nå®é™…ä¸Šï¼Œå½“çº¿ç¨‹Aè°ƒç”¨äº†çº¿ç¨‹Bçš„join()æ–¹æ³•åï¼Œçº¿ç¨‹Aä¼šè®©å‡ºCPUçš„æ‰§è¡Œæƒç»™çº¿ç¨‹Bã€‚ç›´åˆ°çº¿ç¨‹Bæ‰§è¡Œå®Œæˆæˆ–è€…è¿‡äº†è¶…æ—¶æ—¶é—´ï¼Œçº¿ç¨‹Aæ‰ä¼šç»§ç»­æ‰§è¡Œã€‚\nå¤šçº¿ç¨‹åŒæ­¥ åŒæ­¥çš„å®ç° Java æä¾›äº†å¤šç§å¤šçº¿ç¨‹åŒæ­¥çš„æ–¹æ³•ï¼š\n ä½¿ç”¨ synchronized å…³é”®å­—ã€‚è§Synchronizedå…³é”®å­—ã€‚ ä½¿ç”¨ wait() ä¸ notify() æ–¹æ³•ã€‚ ä½¿ç”¨ Lockã€‚è§Locksã€‚  çº¿ç¨‹ä¼˜å…ˆçº§ Thread ç±»å®šä¹‰äº†ä¸‰ä¸ªå’Œçº¿ç¨‹ä¼˜å…ˆçº§æœ‰å…³çš„å±æ€§ï¼š\n/** * The minimum priority that a thread can have. */ public static final int MIN_PRIORITY = 1; /** * The default priority that is assigned to a thread. */ public static final int NORM_PRIORITY = 5; /** * The maximum priority that a thread can have. */ public static final int MAX_PRIORITY = 10; ä¼˜å…ˆçº§è¶Šé«˜çš„çº¿ç¨‹è·å¾— CPU æ—¶é—´ç‰‡çš„æ¦‚ç‡è¶Šå¤§ï¼Œä½†è¿™å¹¶ä¸æ˜¯æ„å‘³ç€ä¼˜å…ˆçº§è¶Šé«˜çš„çº¿ç¨‹ä¸€å®šè¶Šå…ˆæ‰§è¡Œã€‚åœ¨ Java ä¸­ï¼Œè®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§æ–¹æ³•æ˜¯ setPriority(int newPriority)ï¼Œæœ‰æ•ˆçš„ä¼˜å…ˆçº§èŒƒå›´ä¸ºï¼š1-10ã€‚\nå‚è€ƒèµ„æ–™  Brian Goetz, Tim Peierls, Joshua Bloch, Joseph Bowbeer, David Holmes, and Doug Lea. Java Concurrency in Practice. Addison-Wesley Professional, 2006. æ–¹è…¾é£, é­é¹, ç¨‹æ™“æ˜. Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2015. Java Thread Primitive Deprecation.  ","href":"/java/concurrency/java_thread/","title":"Java çº¿ç¨‹"},{"content":"Javaè¯­è¨€æä¾›äº†å¤šç§çº¿ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼ˆåŒæ­¥ã€whileè½®è¯¢ã€ç­‰å¾…/é€šçŸ¥ã€ç®¡é“ç­‰ç­‰ï¼‰ï¼Œå…¶ä¸­æœ€åŸºç¡€çš„é€šä¿¡æ–¹å¼å°±æ˜¯ åŒæ­¥ï¼ˆsynchronizationï¼‰ã€‚Javaä¸­çš„åŒæ­¥æ˜¯é€šè¿‡monitoræ¥å®ç°çš„ï¼Œæ¯ä¸ªJavaå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å…³è”çš„monitorï¼Œçº¿ç¨‹å¯ä»¥åœ¨å…¶ä¸Šè¿›è¡ŒåŠ é”å’Œé‡Šæ”¾é”çš„æ“ä½œã€‚åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰æŸä¸ªmonitorçš„é”ï¼Œä»»ä½•å…¶å®ƒå°è¯•ç»™è¯¥monitoråŠ é”çš„çº¿ç¨‹åœ¨è·å¾—é”ä¹‹å‰éƒ½ä¼šè¢«é˜»å¡ã€‚ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡ç»™æŸä¸ªmonitoråŠ é”ï¼Œè¿™å°±æ˜¯é”çš„é‡å…¥ï¼Œå¤šæ¬¡åŠ é”å¯¹åº”ç€å¤šæ¬¡è§£é”ï¼Œå› ä¸ºæ¯æ¬¡unlockæ“ä½œåªä¼šæ¶ˆé™¤ä¸€æ¬¡lockçš„æ•ˆåº”ã€‚\nSynchronized å…³é”®å­— Javaæä¾›äº†ä¸€ç§å†…ç½®çš„é”æœºåˆ¶æ¥æ”¯æŒåŸå­æ€§ï¼šåŒæ­¥ä»£ç å—ï¼ˆSynchronized Blockï¼‰ã€‚åŒæ­¥ä»£ç å—å°±æ˜¯ç”¨ synchronized å…³é”®å­—ä¿®é¥°çš„ä»£ç å—ï¼Œå®ƒåŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šä½œä¸ºé”çš„å¯¹è±¡å¼•ç”¨å’Œç”±è¿™ä¸ªé”ä¿æŠ¤çš„ä»£ç å—ã€‚\nç”¨å…³é”®å­— synchronized ä¿®é¥°çš„æ–¹æ³•æ˜¯ä¸€ç§æ¨ªè·¨æ•´ä¸ªæ–¹æ³•ä½“çš„åŒæ­¥ä»£ç å—ï¼Œå…¶ä¸­è¯¥åŒæ­¥ä»£ç å—çš„é”å°±æ˜¯å’Œè¯¥æ–¹æ³•ç›¸å…³çš„å¯¹è±¡ï¼ˆæ–¹æ³•æ‰§è¡ŒæœŸé—´ this å…³é”®å­—æ‰€ä»£è¡¨çš„å¯¹è±¡ï¼‰ã€‚é™æ€ synchronized æ–¹æ³•ä»¥ Class å¯¹è±¡ä¸ºé”ï¼š\nstatic synchronized void staticMethod() { // do something } ä»¥ä¸‹æ˜¯ä»¥ lock å¯¹è±¡ä¸ºé”ï¼š\nsynchronizedï¼ˆlockï¼‰{ // access or modify the shared state that is protected by the lock } è€Œä»¥ä¸‹æ˜¯ä»¥è°ƒç”¨åŒæ­¥æ–¹æ³•çš„å®ä¾‹æœ¬èº«ä¸ºé”ï¼š\nsynchronized void instanceMethod() { // do somehing ... } åŒæ­¥ä»£ç å—æ˜¯å¯é‡å…¥çš„ã€‚\nJavaå¯¹è±¡å¤´ The JavaÂ® Virtual Machine Specification (Java SE 11 Edition) æœ¬èº«å¹¶æ²¡æœ‰è§„å®šç¨‹åºè¿è¡Œæ—¶å¯¹è±¡çš„å…·ä½“å†…å­˜å¸ƒå±€ï¼Œå› æ­¤åœ¨ä¸åŒçš„è™šæ‹Ÿæœºå®ç°ä¸­ï¼Œå¯¹è±¡å’Œæ•°ç»„çš„å†…å­˜å¸ƒå±€å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ä¸‹é¢ä¸»è¦å…³æ³¨ HotSpot VM è¿™ä¸€ JVM å®ç°ã€‚\nHotSpot VM ä½¿ç”¨äº†ä¸€ç§åä¸º OOPs(Ordinary Object Pointers) çš„æ•°æ®ç»“æ„è¡¨ç¤ºæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆã€‚è™šæ‹Ÿæœºä½¿ç”¨ oopDesc è¿™ä¸ªç‰¹æ®Šçš„æ•°æ®ç»“æ„æ¥æè¿°æ‰€æœ‰çš„æŒ‡é’ˆï¼ˆåŒ…æ‹¬å¯¹è±¡å’Œæ•°ç»„ï¼‰ã€‚æ¯ä¸ª oopDesc éƒ½åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š\n mark wordã€‚è¿™ä¸€ç±»ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œæ¯”å¦‚ HashCodeã€GC åˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹ IDã€åå‘æ—¶é—´æˆ³ç­‰ï¼Œåœ¨è¿è¡ŒæœŸé—´ï¼ŒMark Work é‡Œé¢å­˜å‚¨çš„æ•°æ®ä¼šéšç€é”æ ‡å¿—çš„å˜åŒ–è€Œå˜åŒ–ã€‚ klass wordã€‚è¿™ä¸€éƒ¨åˆ†ä¸»è¦åŒ…å«çš„æ˜¯è¯­è¨€çº§åˆ«çš„ç±»ä¿¡æ¯ï¼ˆæ¯”å¦‚ç±»åã€ä¿®é¥°ç¬¦ã€çˆ¶ç±»ä¿¡æ¯ç­‰ï¼‰ï¼Œå³ç±»å‹çš„å…ƒæ•°æ®ï¼ŒJava é€šè¿‡è¿™ä¸ªæŒ‡é’ˆç¡®å®šå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚è¯¥éƒ¨åˆ†å¯èƒ½è¢«å‹ç¼©ã€‚  å¯¹äº Java å¯¹è±¡ï¼ˆç”¨ instanceOop è¡¨ç¤ºï¼‰è€Œè¨€ï¼Œå¯¹è±¡å¤´åŒ…æ‹¬ mark wordã€klass wordï¼Œå¯èƒ½è¿˜æœ‰å¯¹é½å¡«å……ã€‚\nå¯¹äº Java æ•°ç»„ï¼ˆç”¨ arrayOop è¡¨ç¤ºï¼‰è€Œè¨€ï¼Œå¯¹è±¡å¤´åŒ…æ‹¬ mark wordã€klass wordã€ sizeof(int) å¤§å°ï¼ˆä¸€èˆ¬ä¸º 4 å­—èŠ‚ï¼‰çš„æ•°ç»„é•¿åº¦ï¼Œå¯èƒ½è¿˜æœ‰å¯¹é½å¡«å……ã€‚æ•°ç»„çš„å¯¹è±¡å¤´ä¸­è¿˜å¿…é¡»æœ‰ä¸€å—ç”¨äºè®°å½•æ•°ç»„é•¿åº¦çš„æ•°æ®ï¼Œå› ä¸º JVM å¯ä»¥é€šè¿‡æ™®é€š Java å¯¹è±¡çš„å…ƒæ•°æ®ä¿¡æ¯ç¡®å®š Java å¯¹è±¡çš„å¤§å°ï¼Œä½†æ˜¯æ•°ç»„çš„é•¿åº¦æ˜¯ä¸ç¡®å®šçš„ã€‚\né”çš„çŠ¶æ€çº§å‡çº§è¿‡ç¨‹ é”ä¸€å…±æœ‰4ç§çŠ¶æ€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜åˆ†åˆ«æ˜¯ï¼šæ— é”ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚é”çš„çŠ¶æ€åªæ”¯æŒå‡çº§ï¼Œä¸æ”¯æŒé™çº§ã€‚\nä»¥ä¸‹æ˜¯é”çš„å››ç§çŠ¶æ€ä¸‹ markd word çš„ç®€è¦å†…å®¹ï¼š\n   é”çŠ¶æ€ å­˜å‚¨å†…å®¹ æœ€åä¸¤ä½ï¼ˆé”æ ‡å¿—ï¼‰     æ— é” hashCodeã€GCåˆ†ä»£å¹´é¾„ã€æ˜¯å¦åå‘é”ï¼ˆ0ï¼‰ 01   åå‘é” åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ã€GCåˆ†ä»£å¹´é¾„ã€æ˜¯å¦åå‘é”ï¼ˆ1ï¼‰ 01   è½»é‡çº§é” æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ 00   é‡é‡çº§é” æŒ‡å‘äº’æ–¥é‡ï¼ˆé‡é‡çº§é”ï¼‰çš„æŒ‡é’ˆ 10    mark word çš„å…·ä½“ç»†èŠ‚å¯ä»¥æŸ¥çœ‹ OpenJDK æºç ï¼Œ32 ä½å’Œ 64 ä½æ¨¡å¼ä¸‹å­˜å‚¨çš„å†…å®¹æ˜¯ä¸ä¸€æ ·çš„ã€‚\næ— é” ä¸å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®å¹¶ä¿®æ”¹å…±äº«èµ„æºï¼Œä½†æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸã€‚\nåœ¨æ— é”çŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹ä¼šä¸æ–­å°è¯•ä¿®æ”¹å…±äº«èµ„æºã€‚å¦‚æœæ²¡æœ‰å†²çªï¼Œå°±ä¿®æ”¹æˆåŠŸå¹¶é€€å‡ºï¼Œå¦åˆ™ ç»§ç»­å¾ªç¯å°è¯•ç›´åˆ°ä¿®æ”¹æˆåŠŸã€‚\nåå‘é” å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯è¢«åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å¾—ã€‚åå‘é”å°±æ˜¯æŒ‡åŒä¸€ä¸ªåŒæ­¥ä»£ç å—ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°±ä¼šè‡ªåŠ¨èƒ½å¤Ÿè·å–é”ï¼Œè¿™èƒ½é™ä½è·å–é”çš„ä»£ä»·ã€‚\nå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§çš„é”è®°å½•é‡Œé¢å­˜å‚¨åå‘çš„çº¿ç¨‹IDï¼Œä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥ä»£ç å—æ—¶ä¸éœ€è¦è¿›è¡ŒCASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œåªéœ€è¦ç®€å•çš„æ£€æµ‹ä¸€ä¸‹å¯¹è±¡å¤´çš„Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¦‚æœæµ‹è¯•æˆåŠŸï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»è·å¾—äº†é”ï¼Œå¦è€…åˆ™éœ€è¦å†æ£€æµ‹ Mark Word ä¸­åå‘é”çš„æ ‡è¯†æ˜¯å¦ä¸º1ï¼ˆå¦‚æœæœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨ CAS ç«äº‰é”ï¼Œå¦åˆ™å°è¯•ä½¿ç”¨ CAS å°†å¯¹è±¡å¤´çš„åå‘é”æŒ‡å‘å½“å‰çº¿ç¨‹ï¼‰ã€‚\nåå‘é”ä½¿ç”¨äº†ä¸€ç§ç­‰åˆ°ç«äº‰å‡ºç°æ‰é‡Šæ”¾é”çš„æœºåˆ¶ï¼Œæ‰€ä»¥å½“å…¶å®ƒçº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ã€‚åå‘é”çš„æ’¤é”€éœ€è¦ç­‰åˆ°å…¨å±€å®‰å…¨ç‚¹ï¼ˆè¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç ï¼‰ä¸Šæ‰èƒ½è¿›è¡Œã€‚å®ƒä¼šå…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºè¢«é”å®šçš„çŠ¶æ€ã€‚æ’¤é”€åå‘é”åæ¢å¤åˆ°æ— é”æˆ–è½»é‡çº§é”çŠ¶æ€ã€‚\nç”±äºéš¾ä»¥ç»´æŠ¤ï¼ŒJava 15 å·²ç»å‡†å¤‡å¼ƒç”¨åå‘é”äº†ã€‚\nè½»é‡çº§é” å½“åå‘é”è¢«å…¶å®ƒçº¿ç¨‹è®¿é—®æ—¶ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶å®ƒçº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„æ–¹å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ã€‚\nå½“çº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—æ—¶ï¼Œè‹¥åŒæ­¥å¯¹è±¡çš„é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ŒJVM ä¼šå†å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸º Lock Record çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨å¯¹è±¡ç›®å‰çš„ Mark Word çš„å‰¯æœ¬ï¼Œç„¶åå°†å¯¹è±¡å¤´ä¸­çš„ Mark Word å¤åˆ¶è¿›å»ã€‚å¤åˆ¶æˆåŠŸåï¼ŒJVM ä¼šä½¿ç”¨ CAS æ“ä½œå°è¯•å°†å¯¹è±¡çš„ Mark Word æ›´æ–°ä¸ºæŒ‡å‘ Lock Record çš„æŒ‡é’ˆï¼Œå¹¶å°† Lock Record é‡Œçš„ owner æŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„ Mark Wordã€‚å¦‚æœæ›´æ–°æˆåŠŸï¼Œè¯¥çº¿ç¨‹å°±è·å¾—äº†é”ï¼Œå¯¹è±¡å¤´ä¸­çš„ Mark Word ä¼šè¢«è®¾ç½®ä¸º 00ï¼Œè¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”çŠ¶æ€ã€‚è‹¥æ›´æ–°å¤±è´¥ï¼ŒJVM ä¼šæ£€æŸ¥å¯¹è±¡å¤´çš„ Mark Word æ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯å°±è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰é”ï¼Œå°±ç›´æ¥è¿›å…¥åŒæ­¥ä»£ç å—ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è¯´æ˜æœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç«äº‰è¯¥é”ã€‚\nè‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™è¯¥ç­‰å¾…çº¿ç¨‹ä¼šä»¥è‡ªæ—‹çš„æ–¹å¼è¿›è¡Œç­‰å¾…ã€‚å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šæ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è‡ªæ—‹ï¼Œç¬¬ä¸‰ä¸ªçº¿ç¨‹åˆæ¥è®¿é—®æ—¶ï¼Œè½»é‡çº§é”ä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚\né‡é‡çº§é” å½“é”å‡çº§ä¸ºé‡é‡çº§é”æ—¶ï¼ŒMark Word å­˜å‚¨çš„æ—¶æŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚\né”å‡çº§å°ç»“ åå‘é”é€šè¿‡æ¯”å¯¹ Mark Word æ¥è§£å†³åŠ é”é—®é¢˜ï¼Œé¿å… CAS æ“ä½œï¼›è½»é‡çº§é”é€šè¿‡ CAS æ“ä½œå’Œè‡ªæ—‹è§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…çº¿ç¨‹é˜»å¡å’Œå”¤é†’å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼›é‡é‡çº§é”åˆ™é˜»å¡æ‹¥æœ‰é”çš„çº¿ç¨‹ä»¥å¤–çš„æ‰€æœ‰çº¿ç¨‹ã€‚\nä»JVMè§†è§’çœ‹åŒæ­¥ JVMä¸­çš„åŒæ­¥æ“ä½œæ˜¯é€šè¿‡ monitor çš„è¿›å…¥ä¸é€€å‡ºæ¥å®ç°çš„ã€‚å…¶å®ç°æ–¹å¼åˆå¯åˆ†ä¸ºæ˜¾å¼ï¼ˆé€šè¿‡ä½¿ç”¨ monitorenter å’Œ monitorexit æŒ‡ä»¤ï¼‰å’Œéšå¼ï¼ˆé€šè¿‡æ–¹æ³•çš„è°ƒç”¨ä¸è¿”å›æŒ‡ä»¤ï¼‰ä¸¤ç§ã€‚æ ¹æ®è¢«ä¿®é¥°çš„ä»£ç å—çš„å½¢å¼ä¸åŒï¼Œsynchronized å…³é”®å­—çš„ä½¿ç”¨å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼šåŒæ­¥æ–¹æ³•ï¼ˆsynchronized ä¿®é¥°çš„æ˜¯é™æ€æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•ï¼‰å’ŒåŒæ­¥è¯­å¥ï¼ˆsynchronized ä¿®é¥°çš„æ˜¯ä¸€ä¸ªä»£ç å—ï¼‰ã€‚\nåŒæ­¥æ–¹æ³• æ–¹æ³•çº§åˆ«çš„åŒæ­¥æ“ä½œæ˜¯éšå¼å®ç°çš„ï¼Œä¸æ¶‰åŠ monitorenter å’Œ monitorexit æŒ‡ä»¤çš„ä½¿ç”¨ï¼ŒåŒæ­¥å°±æ˜¯æ–¹æ³•è°ƒç”¨ä¸è¿”å›çš„ä¸€éƒ¨åˆ†ã€‚åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„ method_info ç»“æ„ä¸­ï¼Œæœ‰ä¸€ä¸ªå«åš ACC_SYNCHRONIZED çš„æ ‡å¿—ä½ã€‚æ–¹æ³•è°ƒç”¨æŒ‡ä»¤ä¼šå»æ£€æŸ¥è¿™ä¸ªæ ‡å¿—ä½ï¼Œå½“ä¸€ä¸ªè®¾ç½®äº† ACC_SYNCHRONIZED çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæ‰§è¡Œçº¿ç¨‹ä¼šå…ˆè¿›å…¥ monitorï¼Œç„¶åè°ƒç”¨æ–¹æ³•æœ¬èº«ï¼Œæœ€åä¸ç®¡æ–¹æ³•æ˜¯å¦æ­£å¸¸æ‰§è¡Œå®Œæˆéƒ½ä¼šé€€å‡º monitorã€‚åœ¨æ‰§è¡Œçº¿ç¨‹æ‹¥æœ‰ monitor çš„æ—¶é—´æ®µå†…ï¼Œå…¶å®ƒçº¿ç¨‹æ˜¯ä¸å¯èƒ½å†è¿›å…¥è¯¥ monitor çš„ã€‚\nä¸‹é¢çš„ SyncMethodDemo ä¸­åŒ…å«ä¸¤ä¸ªåŒæ­¥æ–¹æ³•ï¼Œå…¶ä¸­ staticMethod æ˜¯ä½œç”¨äºç±»çš„é™æ€åŒæ­¥æ–¹æ³•ï¼ŒinstanceMethod æ˜¯ä½œç”¨äºå¯¹è±¡å®ä¾‹çš„åŒæ­¥æ–¹æ³•ï¼š\npublic class SyncMethodDemo { static synchronized void staticMethod() { System.out.println(\u0026#34;static synchronized method\u0026#34;); } synchronized void instanceMethod() { System.out.println(\u0026#34;synchronized instance method\u0026#34;); } } ä½¿ç”¨ javap -v -c SyncMethodDemo.class å¾—åˆ°ä¸¤ä¸ªæ–¹æ³•çš„å­—èŠ‚ç å¦‚ä¸‹ï¼š\nstatic synchronized void staticMethod(); descriptor: ()V flags: (0x0028) ACC_STATIC, ACC_SYNCHRONIZED Code: stack=2, locals=0, args_size=0 0: getstatic #2 // Field java/lang/System.out:Ljava/io/PrintStream; 3: ldc #3 // String static synchronized method 5: invokevirtual #4 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 8: return LineNumberTable: line 3: 0 line 4: 8 synchronized void instanceMethod(); descriptor: ()V flags: (0x0020) ACC_SYNCHRONIZED Code: stack=2, locals=1, args_size=1 0: getstatic #2 // Field java/lang/System.out:Ljava/io/PrintStream; 3: ldc #5 // String synchronized instance method 5: invokevirtual #4 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 8: return LineNumberTable: line 7: 0 line 8: 8 LocalVariableTable: Start Length Slot Name Signature 0 9 0 this LSyncMethodDemo; å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å­—èŠ‚ç ä¸­ï¼Œæ–¹æ³•åŠ äº†ä¸€ä¸ª ACC_SYNCHRONIZED æ ‡å¿—ã€‚é™æ€åŒæ­¥æ–¹æ³• staticMethod å’Œ instanceMethod åŒºåˆ«ä¸å¤§ï¼Œåªä¸è¿‡æ˜¯å¤šäº†ä¸€ä¸ª ACC_STATIC æ ‡å¿—ã€‚\nåŒæ­¥ä»£ç å— ä¸‹é¢æ˜¯ JVMS11 ä¸­ç»™å‡ºçš„ä¸€ä¸ªä¾‹å­ã€‚åŒæ­¥ä»£ç å—\nvoid onlyMe(Foo f) { synchronized(f) { doSomething(); } } ä¼šè¢«ç¼–è¯‘æˆä»¥ä¸‹å­—èŠ‚ç ï¼š\nMethod void onlyMe(Foo) 0 aload_1 // Push f 1 dup // Duplicate it on the stack 2 astore_2 // Store duplicate in local variable 2 3 monitorenter // Enter the monitor associated with f 4 aload_0 // Holding the monitor, pass this and... 5 invokevirtual #5 // ...call Example.doSomething()V 8 aload_2 // Push local variable 2 (f) 9 monitorexit // Exit the monitor associated with f 10 goto 18 // Complete the method normally 13 astore_3 // In case of any throw, end up here 14 aload_2 // Push local variable 2 (f) 15 monitorexit // Be sure to exit the monitor! 16 aload_3 // Push thrown value... 17 athrow // ...and rethrow value to the invoker 18 return // Return in the normal case Exception table: From To Target Type 4 10 13 any 13 16 13 any ä¸ç®¡æ–¹æ³•æ­£å¸¸é€€å‡ºè¿˜æ˜¯å¼‚å¸¸é€€å‡ºï¼Œç¼–è¯‘å™¨éƒ½ä¼šç¡®ä¿æ¯æ¡ monitorenter æŒ‡ä»¤éƒ½æœ‰ä¸€æ¡å¯¹åº”çš„ monitorexit è¢«æ‰§è¡Œã€‚\nå‚è€ƒèµ„æ–™  æ–¹è…¾é£, é­é¹, ç¨‹æ™“æ˜. Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2015. ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ. ä¸å¯ä¸è¯´çš„Javaâ€œé”â€äº‹. Intrinsic Locks and Synchronization. The JavaÂ® Virtual Machine Specification (Java SE 11 Edition). Memory Layout of Objects in Java.  ","href":"/java/concurrency/synchronization/","title":"Java ä¸­çš„ synchronized"},{"content":" æ–‡ç« ä¸­æ¶‰åŠçš„æºä»£ç æ‘˜è‡ª OpenJdk 11ã€‚\n ä¹è§‚é”ä¸æ‚²è§‚é” ä¹è§‚é”ä¸æ‚²è§‚é”æ˜¯ä¸€ç§å¹¿ä¹‰ä¸Šçš„æ¦‚å¿µï¼Œä½“ç°äº†æˆ‘ä»¬çœ‹å¾…çº¿ç¨‹åŒæ­¥çš„ä¸åŒè§’åº¦ã€‚\nä¹è§‚é” ä¹è§‚é”é‡‡ç”¨çš„æ€æƒ³æ˜¯ï¼šå†²çªæ£€æµ‹ã€‚ä¾‹å¦‚ï¼šå¦‚æœ A å’Œ B åŒæ—¶ç¼–è¾‘åŒä¸€ä»½æ–‡ä»¶ï¼Œä½¿ç”¨ä¹è§‚é”ç­–ç•¥ï¼Œ A å’Œ B éƒ½èƒ½å¾—åˆ°æ–‡ä»¶çš„ä¸€ä»½æ‹·è´å¹¶å¯ä»¥è‡ªç”±çš„ç¼–è¾‘ã€‚å‡è®¾ A å…ˆå®Œæˆå·¥ä½œï¼Œé‚£ä¹ˆä»–å¯ä»¥æ¯«æ— å›°éš¾çš„æ›´æ–°ä»–çš„ä¿®æ”¹ã€‚è€Œå½“ B åœ¨ A æäº¤ä¹‹åå®Œæˆå·¥ä½œå¹¶å‘æäº¤ä»–çš„ä¿®æ”¹æ—¶ï¼Œå¹¶å‘æ§åˆ¶ç­–ç•¥å°†ä¼šèµ·ä½œç”¨ï¼Œå¦‚æœæ£€æµ‹åˆ°å†²çªï¼ŒB çš„æäº¤å°†ä¼šè¢«æ‹’ç»ã€‚\nä¹è§‚é”è®¤ä¸ºé”çš„æŒæœ‰è€…åœ¨ä½¿ç”¨æ•°æ®çš„è¿‡ç¨‹ä¸­ä¸ä¼šæœ‰åˆ«çš„çº¿ç¨‹ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šæ·»åŠ é”ï¼Œåªæœ‰åœ¨æäº¤æ•°æ®æ—¶æ‰ä¼šè¿›è¡Œæ£€æµ‹ã€‚Java ä¸­çš„ä¹è§‚é”å¤§éƒ¨åˆ†æ˜¯é€šè¿‡ CAS (Compare And Swap) å®ç°çš„ã€‚CAS æ˜¯ä¸€ç§æ— é”ç®—æ³•ï¼Œç”¨æ¥å°†æŸä¸€å†…å­˜åœ°å€çš„å€¼ä»ä¸€ä¸ªçŠ¶æ€æ›´æ–°åˆ°å¦ä¸€ä¸ªçŠ¶æ€ã€‚CAS æ“ä½œåŒ…å«ä¸‰ä¸ªå‚æ•°ï¼šå†…å­˜åœ°å€ã€é¢„æœŸåŸå€¼å’Œæ–°å€¼ã€‚å¦‚æœå†…å­˜åœ°å€çš„å€¼å’Œé¢„æœŸçš„åŸå€¼ç›¸ç­‰çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠè¯¥ä½ç½®çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œå¦åˆ™ä¸åšä»»ä½•ä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œ AtomicInteger ç±»ä¸­çš„ compareAndSet() æ–¹æ³•ï¼š\npublic final boolean compareAndSet(int expectedValue, int newValue) { return U.compareAndSetInt(this, VALUE, expectedValue, newValue); } CAS è™½ç„¶é«˜æ•ˆï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šåœ¨å…¶è°ƒç”¨æœŸé—´ï¼Œç›®æ ‡å†…å­˜åœ°å€çš„å€¼æ”¹å˜äº†æ•°æ¬¡ï¼Œä½†è¯¥åœ°å€çš„å½“å‰å€¼å´æœ‰å¯èƒ½ä¸è°ƒç”¨è€…ä¹‹å‰è·å–åˆ°çš„å€¼ç›¸ç­‰ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯æœ‰é—®é¢˜çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒCAS æ— æ³•æ¢æµ‹åˆ°â€œæŸä¸ªå€¼è¢«ä¿®æ”¹ï¼Œç„¶åå†è¢«æ”¹å›åŸå€¼â€çš„æƒ…å†µï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ ABA é—®é¢˜ã€‚ABA é—®é¢˜çš„å¸¸è§å¤„ç†æ–¹å¼æ˜¯æ·»åŠ ç‰ˆæœ¬å·ï¼Œçº¿ç¨‹æ¯æ¬¡ä¿®æ”¹å€¼ä¹‹åå°±æ›´æ–°ç‰ˆæœ¬å·ï¼ŒJDK ä¸­çš„ AtomicStampedReference ç±»å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªâ€œç‰ˆæœ¬å·â€ Stampï¼Œæ¯æ¬¡åœ¨æ¯”è¾ƒæ—¶æ—¢æ¯”è¾ƒå½“å‰å€¼åˆæ¯”è¾ƒç‰ˆæœ¬å·ï¼Œè¿™æ ·å°±è§£å†³äº† ABA é—®é¢˜ã€‚\npublic class AtomicStampedReference\u0026lt;V\u0026gt; { private static class Pair\u0026lt;T\u0026gt; { final T reference; final int stamp; private Pair(T reference, int stamp) { this.reference = reference; this.stamp = stamp; } static \u0026lt;T\u0026gt; Pair\u0026lt;T\u0026gt; of(T reference, int stamp) { return new Pair\u0026lt;T\u0026gt;(reference, stamp); } } public boolean compareAndSet(V expectedReference, V newReference, int expectedStamp, int newStamp) { Pair\u0026lt;V\u0026gt; current = pair; return expectedReference == current.reference \u0026amp;\u0026amp; expectedStamp == current.stamp \u0026amp;\u0026amp; ((newReference == current.reference \u0026amp;\u0026amp; newStamp == current.stamp) || casPair(current, Pair.of(newReference, newStamp))); } } ä¹è§‚é”é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œä¹Ÿé€‚ç”¨äºè¯»å†™éƒ½å¤šä½†å¹¶å‘å†²çªä¸æ¿€çƒˆçš„åœºæ™¯ã€‚åœ¨å†²çªè¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œä¹è§‚é”èƒ½è®©æ€§èƒ½å¤§å¹…æé«˜ã€‚\næ‚²è§‚é” æ‚²è§‚é”é‡‡ç”¨çš„æ€æƒ³æ˜¯ï¼šå†²çªé¿å…ã€‚ä¾‹å¦‚ï¼šå¦‚æœ A å’Œ B éƒ½æƒ³ç¼–è¾‘åŒä¸€ä»½æ–‡ä»¶ï¼Œä½¿ç”¨æ‚²è§‚é”ç­–ç•¥ï¼Œè‹¥ A å…ˆè·å¾—æ–‡ä»¶çš„ç¼–è¾‘æƒï¼Œé‚£ä¹ˆ B å°±ä¸èƒ½å¯¹æ–‡ä»¶è¿›è¡Œç¼–è¾‘äº†ã€‚åªæœ‰å½“ A ç¼–è¾‘å®Œæˆå¹¶æäº¤ä¹‹åï¼ŒB æ‰èƒ½å¯¹è¯¥æ–‡ä»¶è¿›è¡Œæ“ä½œã€‚\næ‚²è§‚é”æ˜¯æ¯”è¾ƒä¿å®ˆçš„ï¼Œå®ƒè®¤ä¸ºåœ¨è‡ªå·±ä½¿ç”¨æ•°æ®æ—¶ä¼šæœ‰åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®ï¼Œå› æ­¤åœ¨è·å–æ•°æ®æ—¶ä¼šå…ˆåŠ é”ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šè¢«å…¶å®ƒçº¿ç¨‹ä¿®æ”¹ã€‚Java ä¸­ï¼Œsynchronized å’Œ Lock çš„å®ç°ç±»é‡‡ç”¨çš„éƒ½æ˜¯æ‚²è§‚é”ç­–ç•¥ã€‚\næ‚²è§‚é”é€‚ç”¨äºå¹¶å‘å†™å…¥å¤šã€ç«äº‰æ¿€çƒˆçš„åœºæ™¯ã€‚åœ¨è¿™äº›åœºæ™¯ä¸‹ï¼Œä½¿ç”¨æ‚²è§‚é”å¯ä»¥é¿å…å¤§é‡æ— ç”¨çš„åå¤å°è¯•å¸¦æ¥çš„æ¶ˆè€—ã€‚\nLockæ¥å£ Lock æ¥å£ä¸­å®šä¹‰äº†ä¸€ç»„æŠ½è±¡çš„é”æ“ä½œã€‚ä¸å†…ç½®åŠ é”æœºåˆ¶ä¸åŒçš„æ˜¯ï¼ŒLock æä¾›äº†ä¸€ç§æ— æ¡ä»¶çš„ã€å¯è½®è¯¢çš„ã€å®šæ—¶çš„ä»¥åŠå¯ä¸­æ–­çš„é”è·å–æ“ä½œï¼Œæ‰€æœ‰åŠ é”å’Œè§£é”çš„æ–¹æ³•éƒ½æ˜¯æ˜¾å¼çš„ã€‚Lock æ¥å£çš„å®šä¹‰å¦‚ä¸‹ï¼š\npublic interface Lock { void lock(); void lockInterruptibly() throws InterruptedException; boolean tryLock(); boolean tryLock(long timeout, TimeUnit unit) throws InterruptedException; void unlock(); Condition newCondition(); } ReentrantLock å®ç°äº† Lock æ¥å£ï¼Œå¹¶æä¾›äº†ä¸ synchronized ç›¸åŒçš„äº’æ–¥æ€§å’Œå†…å­˜å¯è§æ€§ã€‚è·å– ReentrantLock çš„è¯­ä¹‰ä¸è¿›å…¥åŒæ­¥ä»£ç å—ä¸€è‡´ï¼Œé‡Šæ”¾ RenentrantLock çš„è¯­ä¹‰ä¹ŸåŒé€€å‡ºåŒæ­¥ä»£ç å—ä¸€è‡´ã€‚ä¸ synchronized ä¸€æ ·ï¼Œ ReentrantLock ä¹Ÿæä¾›äº†å¯é‡å…¥çš„åŠ é”è¯­ä¹‰ã€‚ä½† ReentrantLock æ¯” synchronized æ›´åŠ çµæ´»ï¼Œæœ€å…¸å‹çš„å°±æ˜¯å‰è€…æ”¯æŒéå…¬å¹³å’Œå…¬å¹³çš„é”è·å–æœºåˆ¶ï¼Œè€Œåè€…åªæ”¯æŒå…¬å¹³çš„é”è·å–æœºåˆ¶ã€‚\nä»¥ä¸‹æ˜¯ Lock æ¥å£çš„æ ‡å‡†ä½¿ç”¨å½¢å¼ï¼Œå®ƒæ¯”å†…ç½®é”æ›´å¤æ‚ï¼Œå¹¶ä¸”å¿…é¡»åœ¨ finally å—ä¸­é‡Šæ”¾é”ã€‚å¦åˆ™ï¼Œå¦‚æœåœ¨è¢«ä¿æŠ¤çš„ä»£ç ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¿™ä¸ªé”å°†æ— æ³•é‡Šæ”¾ã€‚\nLock lock = ...; lock.lock(); try { // access the resource protected by this lock } finally { lock.unlock(); } synchronized vs Lock ç›¸åŒç‚¹ synchronized ä¸ Lock æœ‰å¾ˆå¤šç›¸åŒä¹‹å¤„ï¼Œå…¶ä¸­æœ‰ä¸‰ç‚¹æ¯”è¾ƒæ˜æ˜¾ï¼š\n äºŒè€…éƒ½æ˜¯ç”¨æ¥ä¿è¯å¯¹å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ äºŒè€…éƒ½å¯ä»¥ä¿è¯å¯è§æ€§ã€‚å³çº¿ç¨‹ A åœ¨è¿›å…¥ synchronized ä»£ç å—ä¹‹å‰æˆ–åœ¨ synchronized ä»£ç å—å†…è¿›è¡Œçš„æ“ä½œï¼Œå¯¹äºåç»­è·å¾—åŒä¸€ monitor é”çš„çº¿ç¨‹ B æ¥è¯´æ˜¯å¯è§çš„ï¼›çº¿ç¨‹ A åœ¨è°ƒç”¨ unlock() ä¹‹å‰çš„æ‰€æœ‰æ“ä½œå¯¹åç»­åœ¨åŒä¸€ä¸ªé”ä¸Šè°ƒç”¨ lock() çš„çº¿ç¨‹ B æ¥è¯´æ˜¯å¯è§çš„ã€‚ äºŒè€…éƒ½æ˜¯å¯é‡å…¥çš„ã€‚  ä¸åŒç‚¹  å‰è€…æ˜¯ JVM éšå¼å®ç°çš„ï¼Œè€Œåè€…æ˜¯ Java è¯­è¨€æä¾›çš„ APIã€‚ å‰è€…çš„é”åªèƒ½æ˜¯éå…¬å¹³çš„ï¼Œè€Œåè€…çš„ä¸€äº›å®ç°å¯ä»¥å…è®¸é”æ˜¯å…¬å¹³çš„ã€‚ synchronized ä½¿ç”¨çš„æ˜¯ Object å¯¹è±¡çš„ wait()ã€notify()ã€notifyAll() è°ƒåº¦æœºåˆ¶ï¼Œè€Œ Lock ä½¿ç”¨çš„æ˜¯ Condition æ¥å£çš„ await()ã€signal()ã€signalAll() å®Œæˆçº¿ç¨‹ä¹‹é—´çš„è°ƒåº¦ã€‚ synchronized çš„ä½œç”¨é™äºåŒæ­¥ä»£ç å—ï¼ˆåŒ…æ‹¬æ–¹æ³•ï¼‰ï¼Œè€Œ Lock éœ€è¦æ‰‹åŠ¨ç»™å‡ºé”çš„èµ·å§‹å’Œç»“æŸä½ç½®ã€‚å‰è€…çš„æ‰§è¡Œæ˜¯æ‰˜ç®¡ç»™ JVM çš„ï¼Œåè€…æ˜¯é€šè¿‡ä»£ç æ‰‹åŠ¨æ§åˆ¶çš„ã€‚ å‰è€…ä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼Œè€Œåè€…éœ€è¦æ‰‹åŠ¨é‡Šæ”¾é”ã€‚ å‰è€…åªèƒ½ä»¥é˜»å¡çš„æ–¹å¼è·å¾—é”ï¼Œåè€…å¯ä»¥ä½¿ç”¨éé˜»å¡çš„æ–¹å¼å»è·å¾—é”ã€‚  \u0026hellip;\nAbstractQueuedSynchronizer(AQS) Lock æ¥å£çš„å®ç°åŸºæœ¬éƒ½æ˜¯é€šè¿‡èšåˆä¸€ä¸ª AbstractQueuedSynchronizer çš„å­ç±»æ¥å®Œæˆçº¿ç¨‹è®¿é—®æ§åˆ¶çš„ã€‚\n**AQS**æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶ï¼ŒReentrantLockã€Semaphoreã€CountDownLatchã€ReentrantReadWriteLockã€SynchronousQueueç­‰éƒ½æ˜¯åŸºäºå®ƒå®ç°çš„ã€‚\nåœ¨åŸºäºAQSæ„å»ºçš„åŒæ­¥å™¨ç±»ä¸­ï¼Œæœ€åŸºæœ¬çš„æ“ä½œåŒ…æ‹¬å„ç§å½¢å¼çš„è·å–æ“ä½œå’Œé‡Šæ”¾æ“ä½œã€‚è·å–æ“ä½œæ˜¯ä¸€ç§ä¾èµ–çŠ¶æ€çš„æ“ä½œï¼Œé€šå¸¸ä¹Ÿä¼šé˜»å¡ã€‚ç›¸åï¼Œé‡Šæ”¾æ“ä½œå¹¶ä¸æ˜¯ä¸€ä¸ªé˜»å¡æ“ä½œï¼Œå½“æ‰§è¡Œé‡Šæ”¾æ“ä½œæ—¶ï¼Œæ‰€æœ‰åœ¨è¯·æ±‚æ—¶è¢«é˜»å¡çš„çº¿ç¨‹éƒ½ä¼šå¼€å§‹æ‰§è¡Œã€‚\nAQSè´Ÿè´£ç®¡ç†åŒæ­¥å™¨ç±»ä¸­çš„çŠ¶æ€ï¼Œå®ƒç”¨ä¸€ä¸ªintç±»å‹çš„å­—æ®µ state æ¥ä¿å­˜çŠ¶æ€ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡getState()ã€setState()ä»¥åŠCompareAndSetState()ç­‰æ–¹æ³•æ¥è¿›è¡Œæ“ä½œã€‚stateå¯ä»¥è¡¨ç¤ºä»»æ„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼šReentrantLockç”¨å®ƒæ¥è¡¨ç¤ºæ‰€æœ‰è€…çº¿ç¨‹å·²ç»é‡å¤è·å–è¯¥é”çš„æ¬¡æ•°ï¼›Semaphoreç”¨å®ƒè¡¨ç¤ºå‰©ä½™çš„è®¸å¯æ•°é‡ï¼›CountDownLatchç”¨å®ƒæ¥è¡¨ç¤ºè®¡æ•°å™¨å½“å‰çš„å€¼ï¼›ReentrantReadWriteLockç”¨stateçš„é«˜16ä½è¡¨ç¤ºè¯»çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è·å–è¯»é”çš„æ¬¡æ•°ï¼Œä½16ä½è¡¨ç¤ºè·å–å†™é”çš„æ¬¡æ•°ã€‚å¯¹äºAQSæ¥è¯´ï¼Œçº¿ç¨‹åŒæ­¥çš„å…³é”®å°±æ˜¯å¯¹çŠ¶æ€å€¼stateè¿›è¡Œæ“ä½œã€‚\nAQSæ˜¯ä¸€ä¸ªFIFOçš„åŒå‘é˜Ÿåˆ—ï¼Œå†…éƒ¨é€šè¿‡èŠ‚ç‚¹headå’Œtailè®°å½•é˜Ÿé¦–å’Œé˜Ÿå°¾å…ƒç´ ï¼Œé˜Ÿåˆ—å…ƒç´ çš„ç±»å‹ä¸ºNodeã€‚\nAQSçš„å®ç°åˆ†æ åŒæ­¥é˜Ÿåˆ— AQSä¾èµ–å†…éƒ¨çš„åŒæ­¥é˜Ÿåˆ—ï¼ˆä¸€ä¸ªFIFOçš„åŒå‘é˜Ÿåˆ—ï¼‰æ¥å®ŒæˆåŒæ­¥çŠ¶æ€çš„ç®¡ç†ï¼Œå½“å‰çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å¤±è´¥æ—¶ï¼ŒAQSä¼šå°†å½“å‰çº¿ç¨‹ä»¥åŠç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯æ„æˆä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰å¹¶å°†å…¶åŠ å…¥åŒæ­¥é˜Ÿåˆ—ï¼ŒåŒæ—¶é˜»å¡å½“å‰çº¿ç¨‹ï¼Œå½“åŒæ­¥çŠ¶æ€é‡Šæ”¾æ—¶ï¼Œä¼šæŠŠé˜Ÿé¦–èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹å”¤é†’ï¼Œä½¿å…¶å†æ¬¡å°è¯•è·å–åŒæ­¥çŠ¶æ€ã€‚\nNodeèŠ‚ç‚¹ NodeèŠ‚ç‚¹æ˜¯æ„æˆåŒæ­¥é˜Ÿåˆ—çš„åŸºç¡€ï¼ŒAQSæ‹¥æœ‰é¦–èŠ‚ç‚¹ï¼ˆheadï¼‰å’Œå°¾èŠ‚ç‚¹ï¼ˆtailï¼‰ã€‚headèŠ‚ç‚¹æ˜¯è·å–åŒæ­¥çŠ¶æ€æˆåŠŸçš„èŠ‚ç‚¹ï¼Œå®ƒåœ¨é‡Šæ”¾åŒæ­¥çŠ¶æ€æ—¶ï¼Œä¼šå”¤é†’åç»§èŠ‚ç‚¹ï¼Œè€Œè¢«å”¤é†’çš„åç»§èŠ‚ç‚¹ä¼šåœ¨è·å–åŒæ­¥çŠ¶æ€æˆåŠŸæ—¶å°†è‡ªå·±è®¾ç½®ä¸ºheadèŠ‚ç‚¹ã€‚\nNodeä¸­çš„threadå˜é‡ç”¨æ¥è®°å½•å­˜æ”¾è¿›AQSé˜Ÿåˆ—é‡Œé¢çš„çº¿ç¨‹ã€‚NodeèŠ‚ç‚¹å†…éƒ¨çš„SHAREDç”¨æ¥æ ‡è®°è¯¥çº¿ç¨‹åœ¨å…±äº«æ¨¡å¼é˜»å¡ï¼ŒEXCLUSIVEç”¨æ¥æ ‡è®°çº¿ç¨‹åœ¨äº’æ–¥æ¨¡å¼é˜»å¡ã€‚waitStatusè®°å½•å½“å‰èŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€ï¼š\n CANCELLEDï¼šç”±äºåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…çš„çº¿ç¨‹ç­‰å¾…è¶…æ—¶æˆ–è€…è¢«ä¸­æ–­ï¼Œéœ€è¦ä»åŒæ­¥é˜Ÿåˆ—ä¸­å–æ¶ˆç­‰å¾…ï¼ŒèŠ‚ç‚¹è¿›å…¥è¯¥çŠ¶æ€åå°†ä¸åœ¨å˜åŒ– SIGNALï¼šåç»§èŠ‚ç‚¹çš„çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œè€Œå½“å‰èŠ‚ç‚¹çš„çº¿ç¨‹å¦‚æœé‡Šæ”¾äº†åŒæ­¥çŠ¶æ€æˆ–è€…è¢«å–æ¶ˆï¼Œå°†ä¼šé€šçŸ¥åç»§èŠ‚ç‚¹ï¼Œä½¿åç»§èŠ‚ç‚¹çš„çº¿ç¨‹å¾—ä»¥è¿è¡Œ CONDITIONï¼šèŠ‚ç‚¹åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼ŒèŠ‚ç‚¹çº¿ç¨‹ç­‰å¾…åœ¨Conditionä¸Šï¼Œå½“å…¶å®ƒçº¿ç¨‹è°ƒç”¨äº†Conditionçš„signal()æ–¹æ³•åï¼Œè¯¥èŠ‚ç‚¹å°†ä¼šä»ç­‰å¾…é˜Ÿåˆ—ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ PROPAGATEï¼šè¡¨ç¤ºä¸‹ä¸€æ¬¡å…±äº«å¼åŒæ­¥çŠ¶æ€è·å–å°†ä¼šæ— æ¡ä»¶åœ°è¢«ä¼ æ’­ä¸‹å» 0ï¼šä¸å¤„äºä»¥ä¸Šä»»ä½•ä¸€ä¸ªçŠ¶æ€ prevè¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ï¼ˆå½“èŠ‚ç‚¹ä»é˜Ÿå°¾åŠ å…¥åŒæ­¥é˜Ÿåˆ—æ—¶è¢«è®¾ç½®ï¼‰ï¼Œnextè¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ã€‚  ç‹¬å å¼åŒæ­¥çŠ¶æ€çš„è·å–ä¸é‡Šæ”¾ è·å–é” é€šè¿‡è°ƒç”¨AQSçš„acquire(int arg)æ–¹æ³•ï¼Œå¯ä»¥ä»¥äº’æ–¥çš„å½¢å¼è·å–åŒæ­¥çŠ¶æ€å¹¶å¿½ç•¥ä¸­æ–­ã€‚acquire(int arg)æ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š\npublic final void acquire(int arg) { if (!tryAcquire(arg) \u0026amp;\u0026amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt(); } è¿™æ®µä»£ç ä¸»è¦å®Œæˆäº†è·å–åŒæ­¥çŠ¶æ€ã€æ„é€ èŠ‚ç‚¹ã€åŠ å…¥åŒæ­¥é˜Ÿåˆ—ä»¥åŠåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­è‡ªæ—‹ç­‰å¾…çš„ç›¸å…³æ“ä½œã€‚ä¸»è¦é€»è¾‘æ˜¯ï¼šé¦–å…ˆè°ƒç”¨AQSå­ç±»è‡ªå®šä¹‰çš„tryAcquire(int arg)æ–¹æ³•è·å–åŒæ­¥çŠ¶æ€ï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™æ„é€ åŒæ­¥èŠ‚ç‚¹ï¼ˆNode.EXCLUSIVEï¼‰å¹¶é€šè¿‡addWaiter(Node node)æ–¹æ³•å°†è¯¥èŠ‚ç‚¹åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œæœ€åè°ƒç”¨acquireQueued(Node node, int arg)æ–¹æ³•ä½¿è¯¥èŠ‚ç‚¹ä»¥è‡ªæ—‹çš„æ–¹å¼è·å–åŒæ­¥çŠ¶æ€ï¼ˆåªæœ‰å‰é©±èŠ‚ç‚¹ä¸ºå¤´èŠ‚ç‚¹æ—¶æ‰èƒ½å¤Ÿå°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼‰ã€‚å¦‚æœè·å–ä¸åˆ°åˆ™å°è¯•é˜»å¡èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹ï¼Œè¢«é˜»å¡çº¿ç¨‹çš„å”¤é†’ä¸»è¦ä¾é å‰é©±èŠ‚ç‚¹çš„å‡ºé˜Ÿæˆ–é˜»å¡çº¿ç¨‹è¢«ä¸­æ–­æ¥å®ç°ã€‚acquireQueued()æ–¹æ³•æºç å¦‚ä¸‹ï¼š\nfinal boolean acquireQueued(final Node node, int arg) { boolean interrupted = false; try { for (;;) { final Node p = node.predecessor(); if (p == head \u0026amp;\u0026amp; tryAcquire(arg)) { setHead(node); p.next = null; // help GC  return interrupted; } // åˆ¤æ–­è·å–é”å¤±è´¥åæ˜¯å¦é˜»å¡çº¿ç¨‹  if (shouldParkAfterFailedAcquire(p, node)) interrupted |= parkAndCheckInterrupt(); } } catch (Throwable t) { cancelAcquire(node); if (interrupted) selfInterrupt(); throw t; } } å½“è·å–é”å¤±è´¥åï¼ŒshouldParkAfterFailedAcquire() æ–¹æ³•ä¼šå†³å®šæ˜¯å¦æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œæ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š\nprivate static boolean shouldParkAfterFailedAcquire(Node pred, Node node) { int ws = pred.waitStatus; if (ws == Node.SIGNAL) /* * This node has already set status asking a release * to signal it, so it can safely park. */ return true; if (ws \u0026gt; 0) { /* * Predecessor was cancelled. Skip over predecessors and * indicate retry. */ do { node.prev = pred = pred.prev; } while (pred.waitStatus \u0026gt; 0); pred.next = node; } else { /* * waitStatus must be 0 or PROPAGATE. Indicate that we * need a signal, but don\u0026#39;t park yet. Caller will need to * retry to make sure it cannot acquire before parking. */ pred.compareAndSetWaitStatus(ws, Node.SIGNAL); } return false; } ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œçº¿ç¨‹è¢«æŒ‚èµ·çš„å‰ææ¡ä»¶æ˜¯ï¼šå‰é©±èŠ‚ç‚¹çš„çŠ¶æ€ä¸º SIGNALï¼ŒSIGNAL çŠ¶æ€çš„å«ä¹‰æ˜¯åç»§èŠ‚ç‚¹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå½“å‰èŠ‚ç‚¹é‡Šæ”¾é”åå°†ä¼šå”¤é†’åç»§èŠ‚ç‚¹ã€‚\næ•´ä¸ªåŠ é”çš„æµç¨‹åˆ°è¿™é‡Œå°±å·²ç»èµ°å®Œäº†ï¼Œæœ€åçš„æƒ…å†µæ˜¯ï¼šæ²¡æœ‰æ‹¿åˆ°é”çš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­è¢«æŒ‚èµ·ï¼Œç›´åˆ°æ‹¥æœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ä¹‹åï¼Œæ‰ä¼šå»å”¤é†’å…¶ä»–çš„çº¿ç¨‹å»è·å–é”èµ„æºã€‚\né‡Šæ”¾é” é‡Šæ”¾åŒæ­¥çŠ¶æ€åˆ™æ˜¯é€šè¿‡release(int arg)æ–¹æ³•æ¥å®Œæˆçš„ï¼š\npublic final boolean release(int arg) { if (tryRelease(arg)) { Node h = head; if (h != null \u0026amp;\u0026amp; h.waitStatus != 0) unparkSuccessor(h); return true; } return false; } è¿™æ®µä»£ç æ‰§è¡Œæ—¶ï¼Œä¼šé‡Šæ”¾åŒæ­¥çŠ¶æ€å¹¶å”¤é†’åç»§èŠ‚ç‚¹ï¼ˆåç»§èŠ‚ç‚¹æˆä¸ºheadèŠ‚ç‚¹ï¼Œç»§è€Œé‡æ–°å°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼‰ä¸­çš„çº¿ç¨‹ï¼Œå…·ä½“å”¤é†’ç­‰å¾…çº¿ç¨‹æ—¶é€šè¿‡unparkSuccessor(Node node)æ–¹æ³•æ¥å®Œæˆçš„ï¼Œå®ƒè°ƒç”¨äº†LockSupportçš„unpark(Thread thread)æ–¹æ³•ã€‚\nå…±äº«å¼åŒæ­¥çŠ¶æ€è·å–ä¸é‡Šæ”¾ è·å–é” å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ä¸ç‹¬å å¼è·å–æœ€ä¸»è¦çš„åŒºåˆ«åœ¨äºåŒä¸€æ—¶åˆ»æ˜¯å¦èƒ½æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–åˆ°åŒæ­¥çŠ¶æ€ã€‚é€šè¿‡è°ƒç”¨AQSçš„acquireShared(int arg)æ–¹æ³•å¯ä»¥ä»¥å…±äº«çš„æ–¹å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œè¯¥æ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š\npublic final void acquireShared(int arg) { if (tryAcquireShared(arg) \u0026lt; 0) doAcquireShared(arg); } private void doAcquireShared(int arg) { final Node node = addWaiter(Node.SHARED); boolean interrupted = false; try { for (;;) { final Node p = node.predecessor(); if (p == head) { int r = tryAcquireShared(arg); if (r \u0026gt;= 0) { setHeadAndPropagate(node, r); p.next = null; // help GC  return; } } if (shouldParkAfterFailedAcquire(p, node)) interrupted |= parkAndCheckInterrupt(); } } catch (Throwable t) { cancelAcquire(node); throw t; } finally { if (interrupted) selfInterrupt(); } } åœ¨acquireShared(int arg)æ–¹æ³•ä¸­ï¼Œè°ƒç”¨çš„tryAcquireShared(int arg)è¿”å›å€¼è‹¥ä¸å°äº0ï¼Œåˆ™è¡¨ç¤ºè·å–åŒæ­¥çŠ¶æ€æˆåŠŸã€‚è‹¥è·å–å¤±è´¥ï¼Œå°±è¿›å…¥doAcquireShared(int arg)æ–¹æ³•è‡ªæ—‹ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹çš„å‰é©±ä¸ºheadèŠ‚ç‚¹ï¼Œå†æ¬¡å°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œè·å–æˆåŠŸä¾¿é€€å‡ºè‡ªæ—‹ï¼Œå¦åˆ™ç»§ç»­å°è¯•ã€‚\né‡Šæ”¾é” åŒæ­¥çŠ¶æ€çš„é‡Šæ”¾æ˜¯é€šè¿‡releaseShared(int arg)æ–¹æ³•æ¥å®Œæˆçš„ï¼š\npublic final boolean releaseShared(int arg) { if (tryReleaseShared(arg)) { doReleaseShared(); return true; } return false; } private void doReleaseShared() { for (;;) { Node h = head; if (h != null \u0026amp;\u0026amp; h != tail) { int ws = h.waitStatus; if (ws == Node.SIGNAL) { if (!h.compareAndSetWaitStatus(Node.SIGNAL, 0)) continue; // loop to recheck cases  unparkSuccessor(h); } else if (ws == 0 \u0026amp;\u0026amp; !h.compareAndSetWaitStatus(0, Node.PROPAGATE)) continue; // loop on failed CAS  } if (h == head) // loop if head changed  break; } } ä¸åŒäºrelease(int arg)æ–¹æ³•ï¼ŒreleaseShared(int arg)æ–¹æ³•ä¼šå”¤é†’åç»§èŠ‚ç‚¹å¹¶ç¡®ä¿é‡Šæ”¾æ“ä½œå‘åä¼ æ’­ã€‚\nReentrantLock ReentrantLockå…è®¸ä¸€ä¸ªçº¿ç¨‹å¯¹èµ„æºé‡å¤åŠ é”ï¼Œè¿˜æ”¯æŒè®¾ç½®é”çš„å…¬å¹³æ€§ã€‚\nsynchronizedå…³é”®å­—æœ¬æ˜¯æ˜¯æ”¯æŒé‡å…¥çš„ï¼ˆéšå¼çš„ï¼‰ï¼Œè€ŒReentrantLockçš„é‡å…¥éœ€è¦æ˜¾å¼è¿›è¡Œï¼Œå³è°ƒç”¨lock()æ–¹æ³•ã€‚\né‡å…¥ é‡å…¥æ˜¯æŒ‡ä»»æ„çº¿ç¨‹åœ¨è·å–é”ä¹‹åèƒ½å¤Ÿå†æ¬¡è·å–è¯¥é”è€Œä¸ä¼šè¢«é”é˜»å¡ã€‚è¿™ä¸€ç‰¹æ€§çš„å®ç°éœ€è¦è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š\n çº¿ç¨‹å†æ¬¡è·å–åŒä¸€ä¸ªé”ã€‚è¿™ä¸ªæ—¶å€™éœ€è¦é”å»è¯†åˆ«çº¿ç¨‹æ˜¯å¦ä¸ºå½“å‰æ‹¥æœ‰é”çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å†æ¬¡è·å–æˆåŠŸï¼Œå®Œæˆé‡å…¥ã€‚ é”çš„æœ€ç»ˆé‡Šæ”¾ã€‚éœ€è¦ä¿è¯çº¿ç¨‹é‡å¤è·å–næ¬¡é”å¹¶é‡Šæ”¾næ¬¡é”ä¹‹åï¼Œå…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿè·å–åˆ°è¯¥é”ã€‚  é‡å…¥çš„ä¸€ç§å®ç°æ–¹æ³•æ˜¯ï¼šä¸ºæ¯ä¸ªé”å…³è”ä¸€ä¸ªè®¡æ•°å€¼å’Œä¸€ä¸ªæ‰€æœ‰è€…çº¿ç¨‹ï¼Œå½“è®¡æ•°å€¼ä¸º0æ—¶ï¼Œè¿™ä¸ªé”å°±è¢«è®¤ä¸ºä¸è¢«ä»»ä½•çº¿ç¨‹æŒæœ‰ã€‚å½“çº¿ç¨‹è¯·æ±‚ä¸€ä¸ªæœªè¢«æŒæœ‰çš„é”æ—¶ï¼ŒJVMä¼šè®°ä¸‹é”çš„æŒæœ‰è€…å¹¶å°†è®¡æ•°å€¼è®¾ç½®ä¸º1ï¼Œå¦‚æœåŒä¸€ä¸ªçº¿ç¨‹å†æ¬¡è·å–è¿™ä¸ªé”ï¼Œè®¡æ•°å€¼å°±åŠ 1ï¼Œå½“çº¿ç¨‹é€€å‡ºåŒæ­¥ä»£ç å—æ—¶ï¼Œè®¡æ•°å€¼å‡1ã€‚å½“è®¡æ•°å€¼ä¸º0æ—¶ï¼Œè¿™ä¸ªé”å°†è¢«é‡Šæ”¾ã€‚\né”çš„å…¬å¹³æ€§ åœ¨ ReentrantLock çš„æ„é€ å‡½æ•°ä¸­æä¾›äº†ä¸€ä¸ª fair å‚æ•°ï¼Œç”¨æ¥æŒ‡å®šæ‰€åˆ›å»ºçš„é”æ˜¯å¦å…¬å¹³ï¼Œé»˜è®¤åˆ›å»ºä¸€ä¸ªéå…¬å¹³çš„é”ã€‚åœ¨å…¬å¹³çš„é”ä¸Šï¼Œçº¿ç¨‹å°†æŒ‰ç…§å®ƒä»¬å‘å‡ºè¯·æ±‚çš„é¡ºåºæ¥è·å¾—é”ï¼Œä½†åœ¨éå…¬å¹³çš„é”ä¸Šï¼Œæ˜¯å…è®¸â€œæ’é˜Ÿâ€çš„ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚éå…¬å¹³çš„é”æ—¶ï¼Œå¦‚æœåœ¨å‘å‡ºè¯·æ±‚çš„åŒæ—¶è¯¥é”çš„çŠ¶æ€å˜ä¸ºå¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°†è·³è¿‡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ç­‰å¾…çº¿ç¨‹å¹¶è·å¾—è¿™ä¸ªé”ã€‚\nåœ¨æ¿€çƒˆç«äº‰çš„æƒ…å†µä¸‹ï¼Œéå…¬å¹³é”çš„æ€§èƒ½é«˜äºå…¬å¹³é”çš„ä¸€ä¸ªåŸå› æ˜¯ï¼šåœ¨æ¢å¤ä¸€ä¸ªè¢«æŒ‚èµ·çš„çº¿ç¨‹ä¸è¯¥çº¿ç¨‹çœŸæ­£å¼€å§‹è¿è¡Œä¹‹é—´å­˜åœ¨ç€ä¸¥é‡çš„å»¶è¿Ÿï¼Œè€Œä½¿ç”¨éå…¬å¹³é”å‡å°‘äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ã€‚è™½ç„¶éå…¬å¹³é”å¸¦æ¥äº†æ›´é«˜çš„æ€§èƒ½ï¼Œä½†å¯èƒ½å¯¼è‡´çº¿ç¨‹é¥¥é¥¿ã€‚\nReentrantLock é»˜è®¤é‡‡ç”¨éå…¬å¹³é”ï¼š\npublic ReentrantLock() { sync = new NonfairSync(); } å¦‚æœä½¿ç”¨è€…å¸Œæœ›ä½¿ç”¨åŸºäºå…¬å¹³é”çš„ReentrantLockï¼Œå¯ä»¥ä½¿ç”¨å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼š\npublic ReentrantLock(boolean fair) { sync = fair ? new FairSync() : new NonfairSync(); } ReentrantLock ä¸­çš„ lock() å®ç°ä¸º sync.acquire(1)ã€‚acquire() æ–¹æ³•æ˜¯ Sync ç±»ä» AbstractQueuedSynchronizer ç»§æ‰¿æ¥çš„ï¼Œä¸Šæ–‡ä¸­å·²ç»æåˆ°è¿‡å…¶å…·ä½“å®ç°ã€‚tryAcquire() æ–¹æ³•å°è¯•ä»¥ç‹¬å çš„æ–¹å¼è·å–é”ï¼Œå¦‚æœè·å–é”å¤±è´¥ï¼Œåˆ™æŠŠçº¿ç¨‹åŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œä¸‹é¢æ¥çœ‹ tryAcquire() åœ¨ FariSync å’Œ NonfairSync ä¸­çš„å…·ä½“å®ç°ã€‚FairSync ä¸­çš„ tryAcquire() æ–¹å¼å®ç°ä¸ºï¼š\nprotected final boolean tryAcquire(int acquires) { final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) { if (!hasQueuedPredecessors() \u0026amp;\u0026amp; compareAndSetState(0, acquires)) { setExclusiveOwnerThread(current); return true; } } else if (current == getExclusiveOwnerThread()) { int nextc = c + acquires; if (nextc \u0026lt; 0) throw new Error(\u0026#34;Maximum lock count exceeded\u0026#34;); setState(nextc); return true; } return false; } è€Œ NonfairSync ä¸­çš„å®ç°åˆ™åŠå…¶ç®€å•ï¼š\nprotected final boolean tryAcquire(int acquires) { return nonfairTryAcquire(acquires); } nonfairTryAcquire() æ–¹æ³•çš„å®ç°ä½äºæŠ½è±¡ç±» Sync ä¸­ï¼Œå…¶å…·ä½“å†…å®¹ä¸ºï¼š\nfinal boolean nonfairTryAcquire(int acquires) { final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) { if (compareAndSetState(0, acquires)) { setExclusiveOwnerThread(current); return true; } } else if (current == getExclusiveOwnerThread()) { int nextc = c + acquires; if (nextc \u0026lt; 0) // overflow  throw new Error(\u0026#34;Maximum lock count exceeded\u0026#34;); setState(nextc); return true; } return false; } å¯¹æ¯” FairSync å¯ä»¥å‘ç°ï¼ŒFairSync ä¸­çš„ tryAcquire() æ–¹æ³•ä»…å¤šäº†ä¸€è¡Œï¼š!hasQueuedPredecessors()ã€‚hasQueuedPredecessor() æ–¹æ³•ç”¨æ¥æŸ¥çœ‹é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ¯”å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´æ›´ä¹…çš„çº¿ç¨‹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±å°è¯•ä¸€ä¸‹æ˜¯å¦èƒ½è·å–åˆ°é”ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™æ ‡è®°é”ä¸ºå·²å ç”¨ã€‚\nè¿™é‡Œæœ‰ä¸€ä¸ªç‰¹ä¾‹éœ€è¦æ³¨æ„ï¼ŒtryLock() æ–¹æ³•ä¸éµå®ˆæˆ‘ä»¬è®¾å®šçš„å…¬å¹³åŸåˆ™ã€‚å› ä¸ºå®ƒçš„æºç æ˜¯è¿™æ ·çš„ï¼š\npublic boolean tryLock() { return sync.nonfairTryAcquire(1); } ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿æˆ‘ä»¬è®¾å®šé”ä¸ºå…¬å¹³é”ï¼Œå¦‚æœåœ¨è°ƒç”¨ tryLock() æ—¶é”å¯ç”¨ï¼Œå°±èƒ½ç«‹å³è·å¾—é”ï¼Œä¸å‰é¢æ˜¯å¦æœ‰çº¿ç¨‹æ’é˜Ÿæ— å…³ã€‚\nReadWriteLock ReadWriteLock ï¼ˆè¯»å†™é”ï¼‰çš„æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š\npublic interface ReadWriteLock { Lock readLock(); Lock writeLock(); } ReadWriteLock æš´éœ²äº†ä¸¤ä¸ª Lock å¯¹è±¡ï¼Œå…¶ä¸­ä¸€ä¸ªç”¨äºè¯»æ“ä½œï¼Œå¦ä¸€ä¸ªç”¨äºå†™æ“ä½œã€‚è¦è¯»å–ç”± ReadWriteLock ä¿æŠ¤çš„æ•°æ®ï¼Œå¿…é¡»å…ˆè·å¾—è¯»é”ï¼Œå½“éœ€è¦ä¿®æ”¹ ReadWriteLock ä¿æŠ¤çš„æ•°æ®æ—¶ï¼Œå¿…é¡»å…ˆè·å¾—å†™é”ã€‚\nåœ¨ ReadWriteLock å®ç°çš„åŠ é”ç­–ç•¥ä¸­ï¼Œå…è®¸å¤šä¸ªè¯»æ“ä½œåŒæ—¶è¿›è¡Œï¼ˆå¤šä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰è¯»é”ï¼‰ï¼Œä½†æ¯æ¬¡åªå…è®¸ä¸€ä¸ªå†™æ“ä½œï¼ˆæ¯æ¬¡è‡³å¤šæœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™é”ï¼‰ã€‚å¯¹äºè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼ŒReadWriteLock èƒ½å¤Ÿæé«˜æ€§èƒ½ã€‚\nè¯»å†™é”çš„è·å–è§„åˆ™å¦‚ä¸‹ï¼š\n å¦‚æœä¸€ä¸ªçº¿ç¨‹æŒæœ‰è¯»é”ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å¯ä»¥ç»§ç»­ç”³è¯·è¯»é”ã€‚ å¦‚æœä¸€ä¸ªçº¿ç¨‹æŒæœ‰è¯»é”ï¼Œé‚£ä¹ˆæ­¤æ—¶å…¶å®ƒçº¿ç¨‹å¿…é¡»ç­‰å¾…å½“å‰çº¿ç¨‹é‡Šæ”¾è¯»é”ä¹‹åæ‰èƒ½ç”³è¯·å†™é”ã€‚ å¦‚æœä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™é”ï¼Œé‚£ä¹ˆæ­¤æ—¶å…¶å®ƒçº¿ç¨‹å¿…é¡»ç­‰å¾…å½“å‰çº¿ç¨‹é‡Šæ”¾æ‰å†™é”ä¹‹åæ‰èƒ½ç”³è¯·è¯»é”æˆ–å†™é”ã€‚  ç®€è€Œè¨€ä¹‹ï¼Œè¯»å¯ä»¥å¹¶å‘è¿›è¡Œï¼Œè¯»å†™ä¸èƒ½åŒæ—¶è¿›è¡Œï¼Œå¤šä¸ªçº¿ç¨‹ä¸èƒ½åŒæ—¶å†™ã€‚\nReentrantReadWriteLock ReentrantReadWriteLock å®ç°äº† ReadWriteLock æ¥å£ï¼Œå¹¶åŠ å…¥äº†ä¸€äº›ç›‘æ§é”å†…éƒ¨å·¥ä½œçŠ¶æ€çš„æ–¹æ³•ã€‚\nReentrantReadWriteLock çš„å®ç°ä¾èµ–äº AQSï¼Œç”±äº AQS å†…ä½¿ç”¨çš„æ˜¯ä¸€ä¸ª int ç±»å‹çš„ state å˜é‡æ¥ä¿å­˜çš„åŒæ­¥çŠ¶æ€ï¼Œæ‰€ä»¥ ReentrantReadWriteLock å¯¹ state å˜é‡è¿›è¡Œäº†æŒ‰ä½åˆ‡å‰²ï¼Œåˆ†ä¸¤éƒ¨åˆ†ä½¿ç”¨ï¼šé«˜16ä½è¡¨ç¤ºè¯»çŠ¶æ€ï¼Œä½16ä½è¡¨ç¤ºå†™çŠ¶æ€ã€‚\nReentrantReadWriteLock æ”¯æŒé”çš„é™çº§ï¼ˆå†™é”åˆ°è¯»é”ï¼‰ï¼Œä½†ä¸æ”¯æŒé”çš„å‡çº§ã€‚\nLockSupport LockSupportæ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œç”±UnSafeç±»å®ç°ï¼Œä¸»è¦ç”¨æ¥æŒ‚èµ·å’Œå”¤é†’çº¿ç¨‹ï¼Œå®ƒæ˜¯åˆ›å»ºé”å’Œå…¶å®ƒåŒæ­¥ç±»çš„åŸºç¡€ã€‚LockSupportä¼šä¸ºæ¯ä¸ªä½¿ç”¨å®ƒçš„çº¿ç¨‹å…³è”ä¸€ä¸ªè®¸å¯è¯ï¼ˆpermitï¼‰ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹è°ƒç”¨LockSupportç±»çš„æ–¹æ³•çš„çº¿ç¨‹æ˜¯ä¸æŒæœ‰è®¸å¯è¯çš„ã€‚\nå¦‚æœè°ƒç”¨park()æ–¹æ³•çš„çº¿ç¨‹å·²ç»æ‹¿åˆ°äº†ä¸LockSupportå…³è”çš„è®¸å¯è¯ï¼Œåˆ™è°ƒç”¨LockSupport.park()æ—¶ä¼šé©¬ä¸Šè¿”å›ï¼Œå¦åˆ™è°ƒç”¨çº¿ç¨‹ä¼šè¢«ç¦æ­¢å‚ä¸çº¿ç¨‹è°ƒåº¦ï¼Œä¹Ÿå°±æ˜¯ä¼šè¢«é˜»å¡æŒ‚èµ·ã€‚\nåœ¨å…¶å®ƒçº¿ç¨‹è°ƒç”¨unpark(Thread thread)æ–¹æ³•å¹¶å°†è¢«é˜»å¡çº¿ç¨‹ä½œä¸ºå‚æ•°æ—¶ï¼Œå› è°ƒç”¨park()æ–¹æ³•è€Œè¢«é˜»å¡çš„çº¿ç¨‹ä¼šè¿”å›ã€‚å¦‚æœå…¶å®ƒçº¿ç¨‹è°ƒç”¨äº†è¢«é˜»å¡çº¿ç¨‹çš„interrupt()æ–¹æ³•ï¼Œè¢«é˜»å¡çº¿ç¨‹ä¹Ÿä¼šè¿”å›ï¼Œä½†ä¸ä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ã€‚\nContidionæ¥å£ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå½“å†…ç½®é”è¿‡äºæ­»æ¿æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ˜¾å¼é”ã€‚æ­£å¦‚Lockæ˜¯ä¸€ç§å¹¿ä¹‰çš„å†…ç½®é”ä¸€æ ·ï¼ŒCondiitonä¹Ÿæ˜¯ä¸€ç§å¹¿ä¹‰çš„å†…ç½®æ¡ä»¶é˜Ÿåˆ—ã€‚Conditionæ¥å£çš„å®šä¹‰å¦‚ä¸‹ï¼š\npublic interface Condition { void await() throws InterruptedException; boolean await(long time, TimeUnit unit) throws InterruptedException; long awaitNanos(long nanosTimeout) throws InterruptedException; void awaitUninterruptibly(); boolean awaitUntil(Date deadlines) throws InterruptedException; void signal(); void signalAll(); } ä¸€ä¸ªConditionå’Œä¸€ä¸ªLockå…³è”åœ¨ä¸€èµ·ï¼Œå°±åƒä¸€ä¸ªæ¡ä»¶é˜Ÿåˆ—å’Œä¸€ä¸ªå†…ç½®é”ç›¸å…³è”ä¸€æ ·ã€‚å¯ä»¥é€šè¿‡Lock.newCondition()æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªConditionã€‚\nç‰¹åˆ«æ³¨æ„ï¼šåœ¨Conditionå¯¹è±¡ä¸­ï¼Œä¸wait()ã€notify()ã€notifyAll()æ–¹æ³•å¯¹åº”çš„åˆ†åˆ«æ˜¯await()ã€signal()å’ŒsignalAll()ã€‚Conditionå¯¹Objectè¿›è¡Œäº†æ‰©å±•ï¼Œå› ä¸ºå®ƒä¹ŸåŒ…å«wait()å’Œnotify()ç­‰æ–¹æ³•ã€‚ä¸€å®šè¦ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç‰ˆæœ¬â€”â€”await()å’Œsignal()ã€‚\nå‚è€ƒèµ„æ–™  Brian Goetz, Tim Peierls, Joshua Bloch, Joseph Bowbeer, David Holmes, and Doug Lea. Java Concurrency in Practice. Addison-Wesley Professional, 2006. æ–¹è…¾é£, é­é¹, ç¨‹æ™“æ˜. Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2015. Martin Fowler. Patterns of Enterprise Application Architecture. Addison-Wesley Professional, 2002.  ","href":"/java/concurrency/locks/","title":"é”"},{"content":"Wikipedia ä¸­æ˜¯è¿™æ ·æè¿° Proxy çš„ï¼š\n A proxy, in its most general form, is a class functioning as an interface to something else. The proxy could interface to anything: a network connection, a large object in memory, a file, or some other resource that is expensive or impossible to duplicate. In short, a proxy is a wrapper or agent object that is being called by the client to access the real serving object behind the scenes. Use of the proxy can simply be forwarding to the real object, or can provide additional logic. In the proxy, extra functionality can be provided, for example caching when operations on the real object are resource intensive, or checking preconditions before operations on the real object are invoked. For the client, usage of a proxy object is similar to using the real object, because both implement the same interface.\n ä»£ç†æ¨¡å¼ è®¾è®¡æ¨¡å¼è¯»ä¹¦ç¬”è®°ä¹‹ä»£ç†æ¨¡å¼\nåœ¨ç»å…¸çš„è®¾è®¡æ¨¡å¼ç§ï¼Œå¯¹äºæ¯ä¸€ä¸ª RealSubject ç±»ï¼Œéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ª Proxy ä»£ç†ç±»ï¼Œå½“ RealSubject è¿™ç§éœ€è¦è¢«ä»£ç†çš„ç±»å˜å¾—å¾ˆå¤šæ—¶ï¼Œå°±éœ€è¦å®šä¹‰å¤§é‡çš„ Proxy ç±»ï¼Œå±€é¢å¾ˆå®¹æ˜“ä¸€å‘ä¸å¯æ”¶æ‹¾ã€‚JDK åŠ¨æ€ä»£ç†å¯ä»¥æœ‰æ•ˆåœ°è§£å†³ä»£ç†ç±»æ•°é‡è¿‡å¤šè¿™ä¸ªé—®é¢˜ã€‚\nJDK åŠ¨æ€ä»£ç† java.lang.reflect.Proxy æä¾›äº†åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ åŠ¨æ€ åˆ›å»ºæ¥å£å®ç°ç±»ï¼ˆå³ä»£ç†ç±»ï¼‰çš„æ–¹æ³•ï¼Œå› ä¸ºä»£ç†ç±»æ˜¯åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€åˆ›å»ºçš„ï¼Œæ‰€ä»¥åˆè¢«ç§°ä¸ºåŠ¨æ€ä»£ç†ç±»ï¼ˆdynamic proxy classï¼‰ï¼Œè¢«å®ç°çš„æ¥å£è¢«ç§°ä¸ºä»£ç†æ¥å£ï¼ˆproxy interfaceï¼‰ï¼Œä»£ç†ç±»çš„å®ä¾‹è¢«ç§°ä¸ºä»£ç†å®ä¾‹ï¼ˆproxy instanceï¼‰ã€‚\nInvocationHandler æ¥å£ æ¯ä¸ªä»£ç†å®ä¾‹éƒ½æœ‰ä¸€ä¸ªç›¸å…³è”çš„å®ç°äº† InvocationHandler æ¥å£çš„å¯¹è±¡ã€‚InvocationHandler æ¥å£çš„å®šä¹‰å¦‚ä¸‹ï¼š\npublic interface InvocationHandler { public Object invoke(Object proxy, Method method, Object[] args) throws Throwable; } ä»£ç†å®ä¾‹ä¸Šçš„ä»»ä½•æ–¹æ³•è°ƒç”¨ä¼šè¢«åˆ†æ´¾åˆ°åˆ°å¯¹åº” InvocationHandler çš„ invoke() æ–¹æ³•ä¸Šã€‚invoke() æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼š\n proxyï¼šä»£ç†å®ä¾‹ methodï¼šå°†è¦åœ¨ proxy ä¸Šè°ƒç”¨çš„æ–¹æ³•æ‰€å¯¹åº”çš„ Method å¯¹è±¡ argsï¼šä¼ é€’ç»™ method çš„å‚æ•°åˆ—è¡¨ã€‚è‹¥ method æ²¡æœ‰å‚æ•°ï¼Œåˆ™åº”ä¼ é€’ nullã€‚  åˆ›å»ºä»£ç† Proxy ç±»çš„é™æ€æ–¹æ³• newProxyInstance(ClassLoader loader, Class\u0026lt;?\u0026gt;[] interfaces, InvocationHandler h) å°±æ˜¯ç”¨æ¥åˆ›å»ºä»£ç†å®ä¾‹çš„ã€‚å®ƒæœ‰ä¸‰ä¸ªå‚æ•°ï¼š\n loaderï¼šç±»åŠ è½½å™¨ï¼Œç”¨äºåŠ è½½ä»£ç†ç±» interfacesï¼šä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«ä»£ç†ç±»å®ç°çš„æ‰€æœ‰æ¥å£ hï¼šä¸ä»£ç†ç±»ç›¸å…³è”çš„ InvocationHandler  æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä¾‹å­è¿›ä¸€æ­¥ç†è§£ã€‚\nå…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ï¼š\n// æ¥å£ public interface Subject { Object execute(); } åˆ›å»ºä¸€ä¸ªæ¥å£å®ç°ç±»ï¼š\npublic class RealSubject implements Subject { @Override public Object execute() { System.out.println(\u0026#34;Real subject is executing.\u0026#34;); return null; } } åˆ›å»ºä»£ç†ç±»ï¼š\npublic class SubjectProxy implements InvocationHandler { private final Subject target; public SubjectProxy(Subject target) {this.target = target;} @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { Object result = method.invoke(target, args); return result; } } åˆ›å»ºä¸€ä¸ªä»£ç†å®ä¾‹ï¼Œç„¶åè°ƒç”¨ä»£ç†å®ä¾‹çš„æ–¹æ³•ç®€å•æµ‹è¯•ä¸€ä¸‹ï¼š\npublic class SubjectProxyTest { public static void main(String[] args) { Subject subject = (Subject) Proxy.newProxyInstance( SubjectProxy.class.getClassLoader(), new Class[]{Subject.class}, new SubjectProxy(new RealSubject())); subject.execute(); } } ç¨‹åºçš„è¿è¡Œç»“æœä¸ºï¼š\nReal subject is executing. å¯ä»¥å‘ç°ï¼Œè™½ç„¶æˆ‘ä»¬åˆ›å»ºçš„æ˜¯ Subject å¯¹è±¡ï¼Œä½†å®é™…è¢«è°ƒç”¨çš„æ–¹æ³•å´æ˜¯ RealSubject çš„æ–¹æ³•ã€‚\nå†æ·±å…¥ä¸€ç‚¹ æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥çœ‹åˆ°ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæµ‹è¯•ç¨‹åºçš„æ—¶å€™åŠ ä¸€ä¸ªå‚æ•° -Djdk.proxy.ProxyGenerator.saveGeneratedFiles=trueï¼Œå°†ç”Ÿæˆçš„ä»£ç†ç±»ä¿å­˜åˆ°å½“å‰çš„å·¥ä½œç›®å½•ã€‚åœ¨ JDK9 ä¹‹å‰ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ -Dsun.misc.ProxyGenerator.saveGeneratedFiles=trueã€‚åœ¨ç¬”è€…çš„ç”µè„‘ä¸Šï¼Œç”Ÿæˆçš„ä»£ç†ç±»æ˜¯ com.sun.proxy.$Proxy0ï¼Œåç¼–è¯‘å¾—åˆ°çš„ç±»æ˜¯è¿™æ ·çš„ï¼š\n// // Source code recreated from a .class file by IntelliJ IDEA // (powered by FernFlower decompiler) //  package com.sun.proxy; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; import java.lang.reflect.UndeclaredThrowableException; import ml.zhannicholas.reflection.dynamicproxy.Subject; public final class $Proxy0 extends Proxy implements Subject { private static Method m1; private static Method m2; private static Method m3; private static Method m0; public $Proxy0(InvocationHandler var1) throws { super(var1); } public final boolean equals(Object var1) throws { try { return (Boolean)super.h.invoke(this, m1, new Object[]{var1}); } catch (RuntimeException | Error var3) { throw var3; } catch (Throwable var4) { throw new UndeclaredThrowableException(var4); } } public final String toString() throws { try { return (String)super.h.invoke(this, m2, (Object[])null); } catch (RuntimeException | Error var2) { throw var2; } catch (Throwable var3) { throw new UndeclaredThrowableException(var3); } } public final Object execute() throws { try { return (Object)super.h.invoke(this, m3, (Object[])null); } catch (RuntimeException | Error var2) { throw var2; } catch (Throwable var3) { throw new UndeclaredThrowableException(var3); } } public final int hashCode() throws { try { return (Integer)super.h.invoke(this, m0, (Object[])null); } catch (RuntimeException | Error var2) { throw var2; } catch (Throwable var3) { throw new UndeclaredThrowableException(var3); } } static { try { m1 = Class.forName(\u0026#34;java.lang.Object\u0026#34;).getMethod(\u0026#34;equals\u0026#34;, Class.forName(\u0026#34;java.lang.Object\u0026#34;)); m2 = Class.forName(\u0026#34;java.lang.Object\u0026#34;).getMethod(\u0026#34;toString\u0026#34;); m3 = Class.forName(\u0026#34;ml.zhannicholas.reflection.dynamicproxy.Subject\u0026#34;).getMethod(\u0026#34;execute\u0026#34;); m0 = Class.forName(\u0026#34;java.lang.Object\u0026#34;).getMethod(\u0026#34;hashCode\u0026#34;); } catch (NoSuchMethodException var2) { throw new NoSuchMethodError(var2.getMessage()); } catch (ClassNotFoundException var3) { throw new NoClassDefFoundError(var3.getMessage()); } } } å¯ä»¥å‘ç°ï¼Œä»£ç†ç±» $Proxy0 ä¸ä»…å®ç°äº† Subject æ¥å£ï¼Œè¿˜ç»§æ‰¿è‡ª Proxy ç±»ã€‚ç”±äº Java ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡æ¥å£æ¥å®ç°å¤šæ€ã€‚è¿™ä¹Ÿæ˜¯ JDK åŠ¨æ€ä»£ç†çš„ä¸è¶³ï¼Œå³è¦æ±‚è¢«ä»£ç†çš„ç±»è‡³å°‘éœ€è¦å®ç°ä¸€ä¸ªæ¥å£ã€‚è‹¥è¢«ä»£ç†çš„ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œcglibæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚\ncglib JDKçš„åŠ¨æ€ä»£ç†åŸºäº åå°„ æœºåˆ¶ï¼Œç”Ÿæˆä¸€ä¸ª å®ç° ä»£ç†æ¥å£çš„ä»£ç†ç±»ï¼Œç„¶åé‡å†™æ¥å£ï¼Œå®ç°æ–¹æ³•å¢å¼ºï¼Œåªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»ã€‚å› ä¸ºæ˜¯åŸºäºåå°„ï¼ŒåŠ¨æ€ä»£ç†åœ¨ç”Ÿæˆç±»çš„æ—¶å€™éå¸¸å¿«ï¼Œä½†åç»­æ“ä½œä¼šå¾ˆæ…¢ã€‚\ncglibé‡‡ç”¨äº† å­—èŠ‚ç  æŠ€æœ¯ï¼Œé€šè¿‡ ç»§æ‰¿ ç›®æ ‡ç±»ï¼ˆç”Ÿæˆå­ç±»ï¼‰å¹¶é‡å†™çˆ¶ç±»çš„æ–¹æ³•æ¥è¾¾åˆ°å¢å¼ºçš„ç›®çš„ã€‚cglib å¯ä»¥åœ¨é‡å†™çš„æ–¹æ³•ä¸­è¿›è¡Œæ‹¦æˆªï¼Œå®ç°ä»£ç†å¯¹è±¡çš„ç›¸å…³åŠŸèƒ½ã€‚ç”±äºè¿™ç§ä»£ç†æ–¹å¼æ˜¯åŸºäºç»§æ‰¿çš„ï¼Œæ‰€ä»¥ cglib ä¸èƒ½ä»£ç†è¢« final ä¿®é¥°çš„ç±»ã€‚å› ä¸ºæ˜¯åŸºäºå­—èŠ‚ç æŠ€æœ¯ï¼Œcglibåœ¨ç”Ÿæˆç±»çš„æ—¶å€™å¾ˆæ…¢ï¼Œä½†åç»­æ“ä½œå¾ˆå¿«ã€‚\nç®€å•ç¤ºä¾‹ å…ˆå®šä¹‰ä¸€ä¸ªåŸå§‹ç±»ï¼š\npublic class Person { public String hello(String name) { System.out.println(\u0026#34;Hello, \u0026#34; + name); return \u0026#34;Hello, \u0026#34; + name; } } ç„¶åä½¿ç”¨ cglib è¿›è¡Œä»£ç†ï¼š\npublic class PersonProxyTest { public static void main(String[] args) { Enhancer enhancer = new Enhancer(); enhancer.setSuperclass(Person.class); enhancer.setCallback(new MethodInterceptor() { @Override public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable { System.out.println(\u0026#34;cglib methodintercept start...\u0026#34;); Object result = proxy.invokeSuper(obj, args); System.out.println(\u0026#34;cglib methodintercept end...\u0026#34;); return result; } }); Person personProxy = (Person) enhancer.create(); personProxy.hello(\u0026#34;Nicholas\u0026#34;); } } è¿è¡Œè¿™æ®µä»£ç ï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š\ncglib method intercept start... Hello, Nicholas cglib method intercept end... è¿™æ®µä»£ç é‡Œé¢ç”¨åˆ°äº† Enhancer ç±»å’Œ MethodInterceptor æ¥å£ã€‚è¿™ä¸¤è€…çš„ä½œç”¨å’ŒJDKåŠ¨æ€ä»£ç†é‡Œé¢çš„ Proxy å’Œ InvocationHander æœ‰äº›ç±»ä¼¼ã€‚setSuperClass(Class superclass) å‘Šè¯‰ Enhancer å»ç”Ÿæˆä¸€ä¸ª superclass çš„å­ç±»ï¼Œè€Œ setCallback(Callback callback) å‘Šè¯‰ Enhancer è¯¥ä½¿ç”¨å“ªä¸ª callback æ¥å¤„ç†è¢«ä»£ç†ç±»ä¸Šçš„æ–¹æ³•è°ƒç”¨ã€‚MethodIntercepter å®ç°äº† Callback æ¥å£ï¼Œå…è®¸æˆ‘ä»¬å¯¹æ‹¦æˆªçš„æ–¹æ³•è¿›è¡Œå®Œå…¨æ§åˆ¶ã€‚\nå‚è€ƒèµ„æ–™  Proxy pattern. Dynamic Proxy Classes. cglib: The missing manual.  ","href":"/java/java_lang/proxy/","title":"Java ä»£ç†"},{"content":"åå°„(Reflection) æ˜¯Javaè¯­è¨€çš„ä¸€å¤§ç‰¹æ€§ï¼Œå®ƒå…è®¸Javaç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­è·å–è‡ªèº«çš„ç›¸å…³ä¿¡æ¯ï¼Œè¿˜èƒ½æ”¹å˜ç¨‹åºçš„å†…éƒ¨å±æ€§ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„è·å–ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•çš„å±æ€§ï¼Œä¹Ÿå¯ä»¥ç”¨åå°„æ¥å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ã€è¿›è¡Œæ–¹æ³•è°ƒç”¨ã€è·å–æˆ–ä¿®æ”¹å­—æ®µçš„å€¼ã€‚\nä»¥ä¸‹æ˜¯Oracleå®˜æ–¹å¯¹åå°„çš„è§£é‡Šï¼š\n Reflection enables Java code to discover information about the fields, methods and constructors of loaded classes, and to use reflected fields, methods, and constructors to operate on their underlying counterparts, within security restrictions.\n è·å–Classå¯¹è±¡ Javaä¸­å…±æœ‰ä¸¤ç§ç±»å‹ï¼šå¼•ç”¨ç±»å‹å’Œ åŸºæœ¬ç±»å‹ã€‚å¼•ç”¨ç±»å‹åŒ…æ‹¬ï¼šç±»ã€æ•°ç»„(ç±»å’Œæ•°ç»„éƒ½ç»§æ‰¿è‡ª java.lang.Object)å’Œæ¥å£ã€‚åŸºæœ¬ç±»å‹åŒ…æ‹¬ï¼šbooleanã€byteã€shortã€charã€intã€longã€floatã€doubleã€‚ å½“Javaç¨‹åºè¿è¡Œæ—¶ï¼ŒJVMä¼šä¸ºæ¯ç§ç±»å‹å®ä¾‹åŒ–ä¸€ä¸ªä¸å¯å˜çš„**java.lang.Class**ç±»ï¼Œå®ä¾‹çš„å¾ˆå¤šæ•°æ®éƒ½æ¥è‡ªå¯¹åº”çš„ **.classæ–‡ä»¶ã€‚java.lang.Class**æ˜¯åå°„APIçš„å…¥å£ï¼Œå®ƒä¸ä»…æä¾›äº†è·å–åŠä¿®æ”¹å¯¹è±¡å†…éƒ¨ä¿¡æ¯æ–¹æ³•ï¼Œè¿˜æä¾›äº†ä¸–è¢­åŒ–å¯¹è±¡çš„é€”å¾„ã€‚æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥è·å–åˆ° **Class**å®ä¾‹çš„å¼•ç”¨ï¼šç›´æ¥è·å–ã€ä½¿ç”¨ **Object**ç±»çš„getClass()æ–¹æ³•å’Œä½¿ç”¨ **Class**ç±»çš„é™æ€forName(String className)æ–¹æ³•ã€‚\nç›´æ¥è·å– å¯¹äº **A**ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ **A.class**æ¥è·å–å®ƒå¯¹åº”çš„ **Class**å¯¹è±¡ï¼Œè¿™ä¹Ÿé€‚ç”¨äºåŸºæœ¬ç±»å‹ã€‚å¯¹äºåŒ…è£…ç±»ï¼Œå…¶å†…éƒ¨çš„é™æ€finalå˜é‡ **TYPE**ä¸å¯¹åº”åŸºæœ¬ç±»å‹çš„ **Class**å¯¹è±¡æ˜¯åŒä¸€ä¸ªã€‚ä¾‹å¦‚ï¼š\nClass\u0026lt;Object\u0026gt; objectClass = Object.class; System.out.println(int.class == Integer.TYPE); // true System.out.println(int.class == Integer.class); // false System.out.println(void.class == Void.TYPE); // true ä½¿ç”¨ **Object**ç±»çš„getClass()æ–¹æ³• **Object**ç±»æœ‰ä¸€ä¸ªgetClass()æ–¹æ³•ï¼Œå®ƒè¿”å›å¯¹è±¡å®ä¾‹å¼•ç”¨çš„ **Class**å¯¹è±¡ï¼š\nClass\u0026lt;?\u0026gt; objectClass = new Object().getClass(); ä½¿ç”¨ **Class**ç±»çš„é™æ€forName(String className)æ–¹æ³• **Class**ç±»çš„é™æ€forName(String className)æ–¹æ³•ä¼šå°è¯•è¿”å›è™šæ‹Ÿæœºå†…classNameå¯¹åº”çš„ **Class**ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼š\nClass\u0026lt;?\u0026gt; objectClass = Class.forName(\u0026#34;java.lang.Object\u0026#34;); ä¸ç®¡é‡‡å–ä½•ç§æ–¹å¼è·å–ä¸€ä¸ªç»™å®šç±»å‹çš„ **Class**å¯¹è±¡å¼•ç”¨ï¼Œè¿”å›çš„å¼•ç”¨(å¦‚æœå­˜åœ¨çš„è¯)éƒ½æ˜¯åŒä¸€ä¸ªã€‚ä¾‹å¦‚ï¼š\nSystem.out.println(Object.class == new Object().getClass()); // true System.out.println(Object.class == Class.forName(\u0026#34;java.lang.Object\u0026#34;)); // true System.out.println(new Object().getClass() == Class.forName(\u0026#34;java.lang.Object\u0026#34;)); // true è·å–ç±»ä¿¡æ¯ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„æ¥è·å–ç±»çš„ä¿¡æ¯ï¼Œä¾‹å¦‚åŒ…åã€ç±»åã€ç±»å‹ã€è®¿é—®ä¿®é¥°ç¬¦ç­‰ã€‚\nç°åœ¨æœ‰ä¸€ä¸ª **User**ç±»ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š\npackage ml.zhannicholas.reflection; import java.io.Serializable; import java.util.UUID; public class User implements Cloneable, Serializable { protected String uuid; protected String name; protected String email; public class Address {} public User() {} public User(String name) { this(name, null); } private User(String name, String email) { this.uuid = UUID.randomUUID().toString(); this.name = name; this.email = email; } @Override protected Object clone() throws CloneNotSupportedException { return super.clone(); } // getter and setter methods } **ActiveUser**æ˜¯ **User**ç±»çš„ä¸€ä¸ªå­ç±»ï¼š\npublic final class ActiveUser extends User { public String approach; // getter and setter methods } åé¢ä¼šä½¿ç”¨åå°„è·å–è¿™äº›ç±»çš„ä¿¡æ¯ã€‚\nè·å–åŒ…ä¿¡æ¯ ç®€å•çš„è·å–åŒ…åï¼š\nString packageName = userClass.getPackageName(); // ml.zhannicholas.reflection è·å– **Package**å¯¹è±¡ï¼š\nPackage package = userClass.getPackage(); **Package**å¯¹è±¡åŒ…å«äº†åŒ…çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚åŒ…åã€ç‰ˆæœ¬å·ç­‰ã€‚\nè·å–ç±»å **Class**ç±»æä¾›äº†å››ä¸ªè·å–ç±»åçš„æ–¹æ³•ï¼Œä¸åŒæ–¹æ³•çš„è¿”å›å€¼ç¨æœ‰å·®åˆ«ï¼š è·å–ç±»çš„simple name(ä¸å«åŒ…å):\npublic String getSimpleName(); è·å–ç±»çš„name(å«åŒ…å):\npublic String getName(); è·å–ç±»çš„è§„èŒƒå(canonical name)ï¼š\npublic String getCanonicalName(); è·å–å¯¹åº”ç±»å‹çš„åå­—(type name)ï¼š\npublic String getTypeName(); åŸºæœ¬ç±»å‹å’Œvoid å¯¹äºåŸå§‹ç±»å‹å’Œvoidï¼Œå››ç§æ–¹æ³•è¿”å›çš„ç»“æœç›¸åŒï¼š\nint.class.getSimpleName(); // int int.class.getName(); // int int.class.getTypeName(); // int int.class.getCanonicalName(); // int void.class.getSimpleName(); // void void.class.getName(); // void void.class.getTypeName(); // void void.class.getCanonicalName(); // void å¯¹è±¡ç±»å‹ å¯¹äºæ™®é€šçš„Javaå¯¹è±¡ï¼ŒgetSimpleName()è¿”å›ç®€å•çš„ç±»åï¼Œå…¶å®ƒä¸‰ä¸ªæ–¹æ³•çš„è¿”å›å€¼å’Œç±»çš„è§„èŒƒåç›¸åŒï¼š\nUser.class.getSimpleName(); // User User.class.getName(); // ml.zhannicholas.reflection.User User.class.getTypeName(); // ml.zhannicholas.reflection.User User.class.getCanonicalName(); // ml.zhannicholas.reflection.User å†…éƒ¨ç±» å¯¹äºå››ç§å†…éƒ¨ç±»ï¼Œä»¥ä¸Šå‡ ç§æ–¹æ³•çš„è¿”å›å€¼ç•¥æœ‰å·®å¼‚ã€‚\né™æ€å†…éƒ¨ç±»å’Œéé™æ€æˆå‘˜ç±» å¯¹äºé™æ€å†…éƒ¨ç±»(nested classes)å’Œéé™æ€æˆå‘˜ç±»(inner class)ï¼ŒgetSimpleName()è¿”å›ç®€å•çš„ç±»åï¼ŒgetCanonicalName()è¿”å›ç±»çš„è§„èŒƒåï¼Œè€ŒgetName()å’ŒgetTypeName()è¿”å›çš„ç»“æœç›¸åŒï¼Œä¸º$è¿æ¥çš„å¤–éƒ¨ç±»çš„è§„èŒƒåå’Œå†…éƒ¨ç±»çš„ç®€å•åï¼š\nUser.Address.class.getSimpleName(); // Address User.Address.class.getName(); // ml.zhannicholas.reflection.User$Address User.Address.class.getTypeName(); // ml.zhannicholas.reflection.User$Address User.Address.class.getCanonicalName(); // ml.zhannicholas.reflection.User.Address åŒ¿åç±» å¯¹äºåŒ¿åç±»(anonymouse classes)ï¼ŒgetCanonicalName()æ–¹æ³•ä¼šè¿”å›nullï¼ŒgetSimpleName()è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚getName()å’ŒgetTypeName()è¿”å›çš„ç»“æœç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œä»å·¦åˆ°å³åˆ†åˆ«æ˜¯ï¼šå¤–éƒ¨ç±»çš„è§„èŒƒåã€$å’Œè¯¥åŒ¿åç±»åœ¨æ‰€æœ‰åŒ¿åç±»ä¸­å‡ºç°çš„ä½ç½®(ä»1å¼€å§‹)ï¼š\npackage ml.zhannicholas.reflecton; public class ReflectionTest { public static void main(String[] args) { new User(){}.getClass().getSimpleName(); // ç©ºå­—ç¬¦ä¸²  new User(){}.getClass().getName(); // ml.zhannicholas.reflection.ReflectionTest$2  new User(){}.getClass().getTypeName(); // ml.zhannicholas.reflection.ReflectionTest$3  new User(){}.getClass().getCanonicalName() // null  } } å±€éƒ¨ç±» å¯¹äºå±€éƒ¨ç±»(local classes)ï¼ŒgetCanonicalName()æ–¹æ³•ä¼šè¿”å›nullï¼ŒgetSimpleName()è¿”å›ç®€å•çš„ç±»åã€‚getName()å’ŒgetTypeName()è¿”å›çš„ç»“æœç”±å››éƒ¨åˆ†ç»„æˆï¼Œä»å·¦åˆ°å³åˆ†åˆ«æ˜¯ï¼šå¤–éƒ¨ç±»çš„è§„èŒƒåã€$ã€è¯¥å±€éƒ¨ç±»åœ¨æ‰€æœ‰åŒåå±€éƒ¨ç±»ä¸­å‡ºç°çš„ä½ç½®(ä»1å¼€å§‹)å’Œå±€éƒ¨ç±»çš„ç®€å•åï¼š\npackage ml.zhannicholas.reflection; public class ReflectionTest { public static void main(String[] args) { testLocalClasses2(); testLocalClasses1(); } private static void testLocalClasses1() { System.out.println(\u0026#34;local classes test1: \u0026#34;); class LocalClass {} System.out.println(LocalClass.class.getName()); System.out.println(LocalClass.class.getTypeName()); System.out.println(LocalClass.class.getCanonicalName()); System.out.println(LocalClass.class.getSimpleName()); } private static void testLocalClasses2() { System.out.println(\u0026#34;local classes test2: \u0026#34;); class LocalClass {} System.out.println(LocalClass.class.getName()); System.out.println(LocalClass.class.getTypeName()); System.out.println(LocalClass.class.getCanonicalName()); System.out.println(LocalClass.class.getSimpleName()); } } ä¸Šé¢è¿™æ®µä»£ç çš„è¿è¡Œç»“æœä¸ºï¼š\nlocal classes test2: ml.zhannicholas.reflection.ReflectionTest$2LocalClass ml.zhannicholas.reflection.ReflectionTest$2LocalClass null LocalClass local classes test1: ml.zhannicholas.reflection.ReflectionTest$1LocalClass ml.zhannicholas.reflection.ReflectionTest$1LocalClass null LocalClass æ•°ç»„ å¯¹äºæ•°ç»„ï¼ŒgetSimpleName()è¿”å›æ•°ç»„å…ƒç´ ç±»å‹å¯¹åº”çš„simple nameåŠ ä¸Šæ•°ç»„ç»´åº¦æ•°é‡çš„[],getTypeName()è¿”å›çš„æ˜¯æ•°ç»„å…ƒç´ ç±»å‹å¯¹åº”çš„type nameåŠ ä¸Šæ•°ç»„ç»´åº¦æ•°é‡çš„[]ï¼Œ getCanonicalName()è¿”å›çš„æ˜¯æ•°ç»„å…ƒç´ ç±»å‹å¯¹åº”çš„canonical nameåŠ ä¸Šæ•°ç»„ç»´åº¦æ•°é‡çš„[]ï¼ŒgetName()è¿”å›çš„æ˜¯æ•°ç»„ç»´åº¦æ•°é‡çš„[åŠ ä¸Šæ•°ç»„å…ƒç´ ç±»å‹å¯¹åº”çš„ç¼–ç :\nUser[].class.getSimpleName(); // User[] User[].class.getName(); // [Lml.zhannicholas.reflection.User User[].class.getTypeName(); // ml.zhannicholas.reflection.User[] User[].class.getCanonicalName(); // ml.zhannicholas.reflection.User[] å…¨é™å®šåä¸è§„èŒƒå å…¨é™å®šå(fully qualified name)ä¸è§„èŒƒå(canonical name)çš„å®šä¹‰å’ŒåŒºåˆ«è§JLS11ã€‚\nè·å–ä¿®é¥°ç¬¦ é€šè¿‡getModifiers()æ–¹æ³•å¯ä»¥è·å–ä¸€ä¸ªç±»æˆ–æ¥å£çš„ä¿®é¥°ç¬¦ï¼Œè¿”å›çš„ç»“æœä¼šè¢«ç¼–ç æˆä¸€ä¸ªintç±»å‹çš„æ•´æ•°ï¼Œæ•´æ•°çš„æ¯ä¸€ä½éƒ½ä»£è¡¨ä¸åŒçš„è®¿é—®ä¿®é¥°ç¬¦ã€‚æˆ‘ä»¬å¯ä»¥ **Modifier**ç±»çš„é™æ€æ–¹æ³•toString()è·å¾—è§£ç åçš„è®¿é—®ä¿®é¥°ç¬¦ã€‚\nint modifier = User.class.getModifiers(); Modifier.toString(modifier); // public Modifier.toString(Serializable.class.getModifiers()); // public abstract interface é€šè¿‡è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ˜ç¡®çš„çŸ¥é“æ¥å£ç±»å‹æ˜¯abstractçš„ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„è®¿é—®ä¿®é¥°ç¬¦æŒ‡çš„æ˜¯JVMä¸­çš„è®¿é—®ä¿®é¥°ç¬¦ï¼Œå³JVMS11ä¸­å®šä¹‰çš„access_flagsï¼Œå…±9ç§ï¼Œè€ŒJLS11å®šä¹‰çš„ç±»ä¿®é¥°ç¬¦åªæœ‰7ç§ã€‚\nè·å–çˆ¶ç±» é€šè¿‡getSuperClass()æ–¹æ³•å¯ä»¥è·å¾—ä¸€ä¸ªç±»çš„çˆ¶ç±»å¯¹åº”çš„ **Classå®ä¾‹ã€‚å¯¹äºåŸºæœ¬ç±»å‹ã€voidã€æ¥å£ã€Object**ç±»æœ¬èº«ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›nullã€‚å¯¹äºæ•°ç»„ï¼Œæ–¹æ³•ä¼šè¿”å› **Object**ç±»å¯¹åº”çš„ **Class**å®ä¾‹ï¼š\nSystem.out.println(User.class.getSuperclass()); // class java.lang.Object System.out.println(ActiveUser[].class.getSuperclass()); // class java.lang.Object System.out.println(Object.class.getSuperclass()); // null System.out.println(int.class.getSuperclass()); // null System.out.println(void.class.getSuperclass()); // null System.out.println(Serializable.class.getSuperclass()); // null è·å–ç±»ç›´æ¥å®ç°çš„æ¥å£ é€šè¿‡è°ƒç”¨getInterfaces()æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ç±»ç›´æ¥å®ç°çš„æ¥å£ï¼Œæˆ–æ¥å£ç›´æ¥ç»§æ‰¿çš„æ¥å£ã€‚å¯¹äºåŸºæœ¬ç±»å‹ï¼Œæ–¹æ³•è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º0çš„æ•°ç»„ã€‚å¯¹äºæ•°ç»„ç±»å‹ï¼Œæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªé•¿åº¦ä¸º2çš„æ•°ç»„ï¼Œå¯¹åº”çš„å…ƒç´ åˆ†åˆ«ä¸º **java.lang.Cloneable**å’Œ java.io.Serializableï¼š\nSystem.out.println(Arrays.toString(User.class.getInterfaces())); // [interface java.lang.Cloneable, interface java.io.Serializable] System.out.println(Arrays.toString(ActiveUser.class.getInterfaces())); // [] System.out.println(Arrays.toString(int.class.getInterfaces())); // [] System.out.println(Arrays.toString(List.class.getInterfaces())); // [interface java.util.Collection] System.out.println(Arrays.toString(User[].class.getInterfaces())); // [interface java.lang.Cloneable, interface java.io.Serializable] è·å–æ³¨è§£ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–ä¸€ä¸ªç±»æˆ–æ¥å£ä¸Šçš„æ³¨è§£ï¼š\nAnnotation[] annotations = Deprecated.class.getAnnotations(); è·å–æ³›å‹å‚æ•° å¯ä»¥é€šè¿‡getTypeParameters()æ–¹æ³•è·å–æ³›å‹å‚æ•°ï¼Œä¾‹å¦‚ï¼š\nTypeVariable[] typeVariables = Map.class.getTypeParameters(); for (TypeVariable typeVariable: typeVariables) { System.out.print(typeVariable.getName() + \u0026#34; \u0026#34;); } ä»¥ä¸Šä»£ç è·å–äº† **java.util.Map**æ¥å£å†…çš„æ³›å‹å‚æ•°åå­—ï¼Œè¾“å‡ºç»“æœä¸ºï¼š\nK V è·å–æ„é€ å‡½æ•°ä¿¡æ¯ **Class**ç±»æä¾›äº†4ç§å¯ä»¥è·å–æ„é€ å‡½æ•°ä¿¡æ¯çš„æ–¹æ³•ï¼š\npublic Constructor\u0026lt;?\u0026gt;[] getConstructors(); public Constructor\u0026lt;T\u0026gt; getConstructor(Class\u0026lt;?\u0026gt;... parameterTypes); public Constructor\u0026lt;?\u0026gt;[] getDeclaredConstructors(); public Constructor\u0026lt;T\u0026gt; getDeclaredConstructor(Class\u0026lt;?\u0026gt;... parameterTypes); getConstructors()æ–¹æ³•è¿”å›å½“å‰ç±»ä¸­çš„æ‰€æœ‰å…¬æœ‰æ„é€ å‡½æ•°(å¯¹äºæ¥å£ç±»å‹ã€åŸºæœ¬ç±»å‹ã€voidç±»å‹å’Œæ•°ç»„ç±»å‹ï¼Œè¿”å›çš„æ•°ç»„é•¿åº¦ä¸º0)ï¼ŒgetDeclaredConstructors()æ–¹æ³•è¿”å›å½“å‰ç±»ä¸­æ‰€æœ‰å£°æ˜çš„æ‰€æœ‰æ„é€ å‡½æ•°ï¼Œå¦‚æœå½“å‰ç±»æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆé»˜è®¤æ„é€ å‡½æ•°ä¹Ÿä¼šè¢«æ·»åŠ åˆ°è¿”å›ç»“æœä¸­ã€‚ getConstructor()å’ŒgetDeclaredConstructor()å¯ä»¥è¿”å›å…·æœ‰ç‰¹å®šå‚æ•°åˆ—è¡¨çš„æ„é€ å‡½æ•°ï¼Œå¦‚æœæ‰¾ä¸åˆ°ç‰¹å®šå‚æ•°åˆ—è¡¨çš„æ„é€ å‡½æ•°ï¼Œç»æŠ›å‡ºä¸€ä¸ª **NoSuchMethodException**å¼‚å¸¸ã€‚\nprivate static void printConstructor(Constructor\u0026lt;?\u0026gt; constructor) { System.out.println(constructor.toGenericString()); } private static void printConstructors(Constructor\u0026lt;?\u0026gt;[] constructors) { for (Constructor\u0026lt;?\u0026gt; constructor: constructors) { printConstructor(constructor); } System.out.println(); } private static void getConstructors() throws NoSuchMethodException { System.out.println(\u0026#34;Constructors of ActiveUser.class:\u0026#34;); printConstructors(ActiveUser.class.getConstructors()); System.out.println(\u0026#34;Constructors of User.class:\u0026#34;); printConstructors(User.class.getConstructors()); System.out.println(\u0026#34;Declared constructors of ActiveUser.class:\u0026#34;); printConstructors(ActiveUser.class.getDeclaredConstructors()); System.out.println(\u0026#34;Declared constructors of User.class:\u0026#34;); printConstructors(User.class.getDeclaredConstructors()); System.out.println(\u0026#34;Declared constructors of User.class with parameters list (String.class):\u0026#34;); printConstructor(User.class.getDeclaredConstructor(String.class)); } getConstructors()æ–¹æ³•ä¼šå°è¯•å»è·å– **User**å’Œ **ActiveUser**çš„æ„é€ å‡½æ•°å¹¶è¾“å‡ºï¼Œè¿è¡Œæ–¹æ³•ï¼Œå°†ä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š\nConstructors of ActiveUser.class: public ml.zhannicholas.reflection.ActiveUser() Constructors of User.class: public ml.zhannicholas.reflection.User(java.lang.String) public ml.zhannicholas.reflection.User() Declared constructors of ActiveUser.class: public ml.zhannicholas.reflection.ActiveUser() Declared constructors of User.class: private ml.zhannicholas.reflection.User(java.lang.String,java.lang.String) public ml.zhannicholas.reflection.User(java.lang.String) public ml.zhannicholas.reflection.User() Declared constructors of User.class with parameters list (String.class): public ml.zhannicholas.reflection.User(java.lang.String) è·å–å­—æ®µä¿¡æ¯ **Class**ç±»æä¾›äº†4ç§å¯ä»¥è·å–å­—æ®µä¿¡æ¯çš„æ–¹æ³•ï¼š\npublic Field[] getFields(); public Field getField(String name); public Field[] getDeclaredFields(); public Field getDeclaredField(String name); getFields()æ–¹æ³•è¿”å›ç±»ä¸­æ‰€æœ‰çš„å…¬æœ‰å­—æ®µ(åŒ…æ‹¬ç»§æ‰¿æ¥çš„å…¬æœ‰å­—æ®µ)ï¼ŒgetDeclaredFields()è¿”å›ç±»ä¸­å£°æ˜çš„æ‰€æœ‰å­—æ®µ(ä½†ä¸åŒ…æ‹¬ä»ç»§æ‰¿æ¥çš„å­—æ®µ)ï¼ŒgetField()å’ŒgetDeclaredField()ä¼šè¿”å›å…·æœ‰æŒ‡å®šnameçš„å­—æ®µï¼Œè‹¥ä¸å­˜åœ¨nameå¯¹åº”çš„å­—æ®µï¼Œå°†æŠ›å‡ºä¸€ä¸ª NoSuchFieldExceptionã€‚\nprivate static void printField(Field field) { System.out.println(field.toGenericString()); } private static void printFields(Field[] fields) { for (Field field: fields) { printField(field); } System.out.println(); } private static void getFields() throws NoSuchFieldException { System.out.println(\u0026#34;Fields of User.class:\u0026#34;); printFields(User.class.getFields()); System.out.println(\u0026#34;Fields of ActiveUser.class\u0026#34;); printFields(ActiveUser.class.getFields()); System.out.println(\u0026#34;Declared fields of User.class:\u0026#34;); printFields(User.class.getDeclaredFields()); System.out.println(\u0026#34;Declared fields of ActiveUser.class:\u0026#34;); printFields(ActiveUser.class.getDeclaredFields()); System.out.println(\u0026#34;Filed [approach] of ActiveUser.class:\u0026#34;); printField(ActiveUser.class.getField(\u0026#34;approach\u0026#34;)); System.out.println(\u0026#34;Declared field [uuid] of User.class:\u0026#34;); printField(User.class.getDeclaredField(\u0026#34;uuid\u0026#34;)); } getFields()æ–¹æ³•ä¼šå°è¯•è·å– **User**å’Œ **ActiveUser**ç±»ä¸­æ»¡è¶³è¦æ±‚çš„å­—æ®µå¹¶è¾“å‡ºï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\nFields of User.class: Fields of ActiveUser.class public java.lang.String ml.zhannicholas.reflection.ActiveUser.approach Declared fields of User.class: protected java.lang.String ml.zhannicholas.reflection.User.uuid protected java.lang.String ml.zhannicholas.reflection.User.name protected java.lang.String ml.zhannicholas.reflection.User.email Declared fields of ActiveUser.class: public java.lang.String ml.zhannicholas.reflection.ActiveUser.approach Filed [approach] of ActiveUser.class: public java.lang.String ml.zhannicholas.reflection.ActiveUser.approach Declared field [uuid] of User.class: protected java.lang.String ml.zhannicholas.reflection.User.uuid è·å–æ–¹æ³•ä¿¡æ¯ **Class**ç±»æä¾›äº†4ç§å¯ä»¥è·å–æ–¹æ³•ä¿¡æ¯çš„æ–¹æ³•ï¼š\npublic Method[] getMethods(); public Method getMethod(String name, Class\u0026lt;?\u0026gt;... parameterTypes); public Method[] getDeclaredMethods(); public Method getDeclaredMethod(String name, Class\u0026lt;?\u0026gt;... parameterTypes); getMethods()æ–¹æ³•è¿”å›ç±»ä¸­æ‰€æœ‰å…¬æœ‰æ–¹æ³•(åŒ…æ‹¬ç»§æ‰¿æ¥çš„)ï¼ŒgetDeclaredMethods()æ–¹æ³•è¿”å›ç±»ä¸­æ‰€æœ‰å£°æ˜çš„æ–¹æ³•(ä¸åŒ…æ‹¬ç»§æ‰¿æ¥çš„),getMethod()å’ŒgetDeclaredMethod()è¿”å›æ»¡è¶³æŒ‡å®šå‚æ•°åˆ—è¡¨å¹¶ä¸”æ–¹æ³•ååŒ¹é…çš„æ–¹æ³•ï¼Œå¯èƒ½æŠ›å‡ºä¸€ä¸ª NoSuchMethodExceptionã€‚è¿™å››ä¸ªæ–¹æ³•ä¸ä¼šè·å–ç±»ä¸­çš„æ„é€ å‡½æ•°ã€‚\nprivate static void printMethod(Method method) { System.out.println(method.toGenericString()); } private static void printMethods(Method[] methods) { for (Method method: methods) { printMethod(method); } System.out.println(); } private static void getMethods() throws NoSuchMethodException { System.out.println(\u0026#34;Methods of User.class:\u0026#34;); printMethods(User.class.getMethods()); System.out.println(\u0026#34;Declared method of User.class:\u0026#34;); printMethods(User.class.getDeclaredMethods()); System.out.println(\u0026#34;Method [equals] without parameter list in User.class:\u0026#34;); printMethod(User.class.getMethod(\u0026#34;equals\u0026#34;, Object.class)); System.out.println(\u0026#34;Declared method [getEmail] without parameter list in User.class:\u0026#34;); printMethod(User.class.getDeclaredMethod(\u0026#34;getEmail\u0026#34;)); } è¿™æ®µä»£ç ä¼šå°è¯•è·å– **User**ç±»ä¸­æ»¡è¶³è¦æ±‚çš„æ–¹æ³•å¹¶è¾“å‡ºï¼Œè¿è¡Œç»“æœä¸ºï¼š\nMethods of User.class: public java.lang.String ml.zhannicholas.reflection.User.getName() public void ml.zhannicholas.reflection.User.setName(java.lang.String) public java.lang.String ml.zhannicholas.reflection.User.getEmail() public void ml.zhannicholas.reflection.User.setEmail(java.lang.String) public final native void java.lang.Object.wait(long) throws java.lang.InterruptedException public final void java.lang.Object.wait(long,int) throws java.lang.InterruptedException public final void java.lang.Object.wait() throws java.lang.InterruptedException public boolean java.lang.Object.equals(java.lang.Object) public java.lang.String java.lang.Object.toString() public native int java.lang.Object.hashCode() public final native java.lang.Class\u0026lt;?\u0026gt; java.lang.Object.getClass() public final native void java.lang.Object.notify() public final native void java.lang.Object.notifyAll() Declared method of User.class: protected java.lang.Object ml.zhannicholas.reflection.User.clone() throws java.lang.CloneNotSupportedException public java.lang.String ml.zhannicholas.reflection.User.getName() public void ml.zhannicholas.reflection.User.setName(java.lang.String) public java.lang.String ml.zhannicholas.reflection.User.getEmail() public void ml.zhannicholas.reflection.User.setEmail(java.lang.String) Method [equals] without parameter list in User.class: public boolean java.lang.Object.equals(java.lang.Object) Declared method [getEmail] without parameter list in User.class: public java.lang.String ml.zhannicholas.reflection.User.getEmail() åˆ›å»ºæ–°å®ä¾‹ é€šè¿‡åå°„ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥åˆ›å»ºæ–°çš„å®ä¾‹ï¼š\n ä½¿ç”¨Class.newInstance()ã€‚ ä½¿ç”¨Constructor.newInstance()ã€‚  å‰è€…åœ¨JDK9ä¸­å·²è¢«å¼ƒç”¨ï¼Œå› ä¸ºå®ƒä¼šæŠ›å‡ºæ„é€ å‡½æ•°ä¸­çš„ä»»ä½•å¼‚å¸¸(ä¸ç®¡æ˜¯å—æ£€å¼‚å¸¸è¿˜æ˜¯éå—æ£€å¼‚å¸¸)ï¼Œè€Œåè€…ä¼šä½¿ç”¨ **InvocationTargetException**æ¥åŒ…è£¹æ„é€ å‡½æ•°æŠ›å‡ºçš„ä»»ä½•å¼‚å¸¸ã€‚æ­¤å¤–ï¼Œå’Œåè€…ç›¸æ¯”ï¼Œå‰è€…åªæ”¯æŒæ— å‚æ„é€ å‡½æ•°å¹¶è¦æ±‚è¿™ä¸ªæ„é€ å‡½æ•°æ˜¯å¯è§çš„ï¼Œè€Œåè€…èƒ½å¤Ÿè°ƒç”¨æ‰€æœ‰çš„æ„é€ å‡½æ•°(åŒ…æ‹¬è¢«privateä¿®é¥°çš„æ„é€ å‡½æ•°)ã€‚å‰è€…å¯ä»¥ä½¿ç”¨clazz.getDeclaredConstructor().newInstance()ä»£æ›¿ã€‚\nSystem.out.println(\u0026#34;Invoke default constructor:\u0026#34;); System.out.println(User.class.getDeclaredConstructor().newInstance()); System.out.println(\u0026#34;Invoke public constructor:\u0026#34;); User user1 = User.class.getDeclaredConstructor(String.class).newInstance(\u0026#34;Nicholas\u0026#34;); System.out.println(\u0026#34;name=\u0026#34; + user1.name + \u0026#34;, email=\u0026#34; + user1.getEmail()); System.out.println(\u0026#34;Invoke private constructor:\u0026#34;); Constructor\u0026lt;User\u0026gt; userConstructor = User.class.getDeclaredConstructor(String.class, String.class); userConstructor.setAccessible(true); User user2 = userConstructor.newInstance(\u0026#34;Nicholas\u0026#34;, \u0026#34;nicholas@zhannicholas.ml\u0026#34;); System.out.println(\u0026#34;name=\u0026#34; + user2.name + \u0026#34;, email=\u0026#34; + user2.getEmail()); ä¸Šé¢çš„ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨åå°„æ¥è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°ï¼Œå…¬æœ‰æ„é€ å‡½æ•°ä»¥åŠç§æœ‰æ„é€ å‡½æ•°ã€‚åœ¨è°ƒç”¨ç§æœ‰æ„é€ å‡½æ•°æ—¶ï¼Œéœ€è¦å…ˆæ˜¯è¯¥æ„é€ å‡½æ•°å¯è§ï¼Œå¦åˆ™ä¼šé­é‡ä¸€ä¸ª IllegalAccessExceptionã€‚è¿è¡Œç»“æœå¦‚ä¸‹ï¼š\nnvoke default constructor: ml.zhannicholas.reflection.User@5594a1b5 Invoke public constructor: name=Nicholas, email=null Invoke private constructor: name=Nicholas, email=nicholas@zhannicholas.ml æ“ä½œæ•°ç»„ **Class**ç±»å¹¶æ²¡æœ‰ç›´æ¥æä¾›æ“ä½œæ•°ç»„çš„æ–¹æ³•ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæä¾›çš„isArray()æ–¹æ³•æ¥åˆ¤æ–­æŸä¸ª **Class**å®ä¾‹æ˜¯å¦ä»£è¡¨ä¸€ä¸ªæ•°ç»„ã€‚è¦æ“ä½œæ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **java.lang.reflect.Array**ç±»ï¼Œå®ƒæä¾›äº†åŠ¨æ€åˆ›å»ºå’Œè®¿é—®æ•°ç»„çš„é™æ€æ–¹æ³•ã€‚\n**Array**ç±»æä¾›äº†ä¸¤ä¸ªåˆ›å»ºæ•°ç»„çš„æ–¹æ³•ï¼š\npublic static Object newInstance(Class\u0026lt;?\u0026gt; componentType, int length); public static Object newInstance(Class\u0026lt;?\u0026gt; componentType, int... dimensions); ç¬¬ä¸€ä¸ªæ–¹æ³•ç”¨æ¥åˆ›å»ºä¸€ç»´æ•°ç»„ï¼Œç¬¬äºŒä¸ªæ–¹æ³•ç”¨æ¥åˆ›å»ºå¤šç»´æ•°ç»„ã€‚\næ­¤å¤–ï¼Œ**Array**è¿˜æä¾›äº†è·å–æ•°ç»„ç»´åº¦(getLength())ï¼Œè®¾ç½®(setXXX())å’Œè¯»å–(getXXX())æŒ‡å®šä¸‹æ ‡å€¼çš„æ–¹æ³•ï¼š\nint[] nums = (int[]) Array.newInstance(int.class, 2); System.out.println(Arrays.toString(nums)); Array.set(nums, 0, 1); Array.set(nums, 1, 2); System.out.println(\u0026#34;[\u0026#34; + Array.get(nums, 0) + \u0026#34;, \u0026#34; + Array.get(nums, 1) + \u0026#34;]\u0026#34;); int[][] matrix = (int[][]) Array.newInstance(int.class, 2, 2); System.out.println(\u0026#34;Dimension of matrix: \u0026#34; + Array.getLength(matrix)); System.out.println(\u0026#34;[\u0026#34; + Arrays.toString(matrix[0]) + \u0026#34;, \u0026#34; + Arrays.toString(matrix[1]) + \u0026#34;]\u0026#34;); Array.set(matrix, 0, new int[]{1,2}); Array.set(matrix, 1, new int[]{3,4}); System.out.println(Arrays.toString((int[]) Array.get(matrix, 0))); System.out.println(Arrays.toString((int[]) Array.get(matrix, 1))); ä¸Šé¢è¿™æ®µä»£ç æ¼”ç¤ºäº†ä½¿ç”¨ **Array**ç±»è¿›è¡Œæ•°ç»„çš„åˆ›å»ºã€ç»´åº¦åŠå†…å®¹è¯»å–ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n[0, 0] [1, 2] Dimension of matrix: 2 [[0, 0], [0, 0]] [1, 2] [3, 4] è°ƒç”¨å¯¹è±¡æ–¹æ³• åœ¨è·å–åˆ°ç±»çš„æ–¹æ³•ä¿¡æ¯ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ **java.lang.reflect.Method**çš„public Object invoke(Object obj, Object... args);æ–¹æ³•æ¥è°ƒç”¨objçš„ä¸­å‚æ•°åˆ—è¡¨ä¸ºObject... argsçš„æ–¹æ³•å¹¶å¾—åˆ°æ–¹æ³•è°ƒç”¨ç»“æœã€‚å¯¹äºé™æ€æ–¹æ³•ï¼Œç»™ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’nullå³å¯ã€‚\npublic class Calculator { public static int add(int a, int b) {return a + b;} public int minus(int a, int b) {return a - b;} } public class InvokeCalculator { public static void main(String[] args) { Method add = Calculator.class.getDeclaredMethod(\u0026#34;add\u0026#34;, int.class, int.class); System.out.println(add.invoke(null, 1, 2)); Method minus = Calculator.class.getDeclaredMethod(\u0026#34;minus\u0026#34;, int.class, int.class); System.out.println(minus.invoke(new Calculator(), 1, 2)); } } ä¸Šé¢çš„ä»£ç é€šè¿‡åå°„è·å–åˆ°äº† **Calculator**çš„é™æ€æ–¹æ³•add()å’Œå®ä¾‹æ–¹æ³•minusï¼Œç„¶åé€šè¿‡ **Method**ç±»çš„çš„invoke()æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\n3 -1 ä¿®æ”¹å­—æ®µå€¼ åœ¨è·å–åˆ°ç±»çš„å­—æ®µä¿¡æ¯åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ **java.lang.reflect.Field**ç±»æä¾›çš„getXXX()æ–¹æ³•æ¥è·å–å®ä¾‹å­—æ®µçš„å€¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨setXXX()æ–¹æ³•æ¥æ”¹å˜å®ä¾‹å­—æ®µçš„å€¼ï¼š\nUser user = new User(\u0026#34;Nicholas\u0026#34;); Field name = User.class.getDeclaredField(\u0026#34;name\u0026#34;); System.out.println(name.get(user)); name.set(user, \u0026#34;Sarkar\u0026#34;); System.out.println(name.get(user)); è¿™æ®µä»£ç å…ˆå®ä¾‹åŒ–äº†ä¸€ä¸ª **User**ç±»ï¼Œç„¶åé€šè¿‡åå°„è¯»å–nameå­—æ®µçš„å€¼ï¼Œä¹‹ååˆä¿®æ”¹äº†nameçš„å€¼ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\nNicholas Sarkar å‚è€ƒèµ„æ–™  James Gosling, Bill Joy, Guy Steele, Gilad Bracha, Alex Buckley, Daniel Smith. The Java Language Specification: Java SE 11 Edition. 2018. Tim Lindholm, Frank Yellin, Gilad Bracha, Alex Buckley, Daniel Smith. The Java Virtual Machine Specification: Java SE 11 Edition. 2018. Trail: The Reflection API.  ","href":"/java/java_lang/reflection/","title":"åå°„"},{"content":"é€šè¿‡å…‹éš†ï¼ˆCloneï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿæ„å»ºå‡ºä¸€ä¸ªå·²æœ‰å¯¹è±¡çš„å‰¯æœ¬ã€‚\næµ…å…‹éš† VS æ·±å…‹éš† æµ…å…‹éš†ï¼ˆShadow Cloneï¼‰ æˆ– æµ…å¤åˆ¶ï¼ˆShallow Copyï¼‰ æŠŠåŸå¯¹è±¡ä¸­æˆå‘˜å˜é‡ä¸ºå€¼ç±»å‹çš„å±æ€§éƒ½å¤åˆ¶ç»™å…‹éš†å¯¹è±¡ï¼ŒæŠŠåŸå¯¹è±¡ä¸­æˆå‘˜å˜é‡ä¸ºå¼•ç”¨ç±»å‹çš„å¼•ç”¨åœ°å€ä¹Ÿå¤åˆ¶ç»™å…‹éš†å¯¹è±¡ã€‚å½“åŸå¯¹è±¡ä¸­å­˜åœ¨å¼•ç”¨ç±»å‹çš„æˆå‘˜å˜é‡æ—¶ï¼Œè¯¥å˜é‡çš„åœ°å€ä¼šè¢«åŸå¯¹è±¡å’Œå…‹éš†å¯¹è±¡å…±äº«ã€‚\næ·±å…‹éš†ï¼ˆDeep Cloneï¼‰ æˆ– æ·±å¤åˆ¶ï¼ˆDeep Copyï¼‰ å°†åŸå¯¹è±¡ä¸­çš„æ‰€æœ‰ç±»å‹çš„æˆå‘˜å˜é‡ï¼ˆæ— è®ºæ˜¯å€¼ç±»å‹è¿˜æ˜¯å¼•ç”¨ç±»å‹ï¼‰éƒ½å¤åˆ¶ä¸€ä»½ç»™å…‹éš†å¯¹è±¡ã€‚\nç®€å•æ¥è¯´ï¼Œæµ…å…‹éš†å’Œæ·±å…‹éš†çš„åŒºåˆ«å°±åœ¨äºå¯¹å¼•ç”¨ç±»å‹çš„æˆå‘˜å˜é‡çš„å¤åˆ¶ï¼šå‰è€…å¤åˆ¶çš„æ˜¯å¼•ç”¨å¯¹è±¡çš„åœ°å€ï¼Œè€Œåè€…å¤åˆ¶çš„æ˜¯å¼•ç”¨å¯¹è±¡æœ¬èº«ã€‚\nCloneable æ¥å£ åœ¨ Java ä¸­ï¼Œä¸ºäº†å®ç°å¯¹è±¡çš„å…‹éš†ï¼Œæˆ‘ä»¬éœ€è¦è®©ç±»å®ç° Cloneable æ¥å£å¹¶é‡å†™ Object ç±»çš„ clone() æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š\n@Data @AllArgsConstructor public class CloneableName implements Cloneable { private String firstName; private String lastName; @Override public CloneableName clone() throws CloneNotSupportedException { return (CloneableName) super.clone(); } } @Data @AllArgsConstructor public class CloneableUser implements Cloneable { private String id; private CloneableName name; private int age; @Override public CloneableUser clone() throws CloneNotSupportedException { return (CloneableUser) super.clone(); } } å¯¹äºä¸€ä¸ªç±»è€Œè¨€ï¼Œå¦‚æœæˆ‘ä»¬åªé‡å†™ clone() æ–¹æ³•è€Œä¸å®ç° Cloneable æ¥å£ï¼Œè°ƒç”¨ clone() æ–¹æ³•æ—¶å°±ä¼šæŠ›å‡º CloneNotSupportedExceptionã€‚\nJava ä¸­çš„æ•°ç»„æœ¬èº«ä¹Ÿæ˜¯å¯å…‹éš†çš„ï¼Œæ ¹æ® JLS11 æ•°ç»„å¯¹è±¡æ—¢æ˜¯å¯å…‹éš†çš„ï¼Œåˆæ˜¯å¯åºåˆ—åŒ–çš„ã€‚æ•°ç»„å¯ä»¥çœ‹æˆä¸‹é¢è¿™ä¸ªç±»ï¼š\nclass A\u0026lt;T\u0026gt; implements Cloneable, java.io.Serializable { public final int length = X; public T[] clone() { try { return (T[])super.clone(); } catch (CloneNotSupportedException e) { throw new InternalError(e.getMessage()); } } } clone() æ–¹æ³• clone() æ˜¯ä¸€ä¸ª native æ–¹æ³•ï¼Œå®ƒåœ¨ Object ç±»ä¸­å®šï¼Œå…¶è¯¦ç»†å†…å®¹å¦‚ä¸‹ï¼š\n/** * Creates and returns a copy of this object. The precise meaning * of \u0026#34;copy\u0026#34; may depend on the class of the object. The general * intent is that, for any object {@code x}, the expression: * \u0026lt;blockquote\u0026gt; * \u0026lt;pre\u0026gt; * x.clone() != x\u0026lt;/pre\u0026gt;\u0026lt;/blockquote\u0026gt; * will be true, and that the expression: * \u0026lt;blockquote\u0026gt; * \u0026lt;pre\u0026gt; * x.clone().getClass() == x.getClass()\u0026lt;/pre\u0026gt;\u0026lt;/blockquote\u0026gt; * will be {@code true}, but these are not absolute requirements. * While it is typically the case that: * \u0026lt;blockquote\u0026gt; * \u0026lt;pre\u0026gt; * x.clone().equals(x)\u0026lt;/pre\u0026gt;\u0026lt;/blockquote\u0026gt; * will be {@code true}, this is not an absolute requirement. * \u0026lt;p\u0026gt; * By convention, the returned object should be obtained by calling * {@code super.clone}. If a class and all of its superclasses (except * {@code Object}) obey this convention, it will be the case that * {@code x.clone().getClass() == x.getClass()}. * \u0026lt;p\u0026gt; * By convention, the object returned by this method should be independent * of this object (which is being cloned). To achieve this independence, * it may be necessary to modify one or more fields of the object returned * by {@code super.clone} before returning it. Typically, this means * copying any mutable objects that comprise the internal \u0026#34;deep structure\u0026#34; * of the object being cloned and replacing the references to these * objects with references to the copies. If a class contains only * primitive fields or references to immutable objects, then it is usually * the case that no fields in the object returned by {@code super.clone} * need to be modified. * \u0026lt;p\u0026gt; * The method {@code clone} for class {@code Object} performs a * specific cloning operation. First, if the class of this object does * not implement the interface {@code Cloneable}, then a * {@code CloneNotSupportedException} is thrown. Note that all arrays * are considered to implement the interface {@code Cloneable} and that * the return type of the {@code clone} method of an array type {@code T[]} * is {@code T[]} where T is any reference or primitive type. * Otherwise, this method creates a new instance of the class of this * object and initializes all its fields with exactly the contents of * the corresponding fields of this object, as if by assignment; the * contents of the fields are not themselves cloned. Thus, this method * performs a \u0026#34;shallow copy\u0026#34; of this object, not a \u0026#34;deep copy\u0026#34; operation. * \u0026lt;p\u0026gt; * The class {@code Object} does not itself implement the interface * {@code Cloneable}, so calling the {@code clone} method on an object * whose class is {@code Object} will result in throwing an * exception at run time. * * @return a clone of this instance. * @throws CloneNotSupportedException if the object\u0026#39;s class does not * support the {@code Cloneable} interface. Subclasses * that override the {@code clone} method can also * throw this exception to indicate that an instance cannot * be cloned. * @see java.lang.Cloneable */ @HotSpotIntrinsicCandidate protected native Object clone() throws CloneNotSupportedException; ä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼šObject å¯¹ clone() æœ‰ä¸‰æ¡çº¦å®šï¼š\n å¯¹äºæ‰€æœ‰å¯¹è±¡æ¥è¯´ï¼Œè¡¨è¾¾å¼ x.clone() != x çš„å€¼ä¸º true ï¼Œå³å…‹éš†å¯¹è±¡ä¸åŸå¯¹è±¡ä¸åº”è¯¥åŒä¸€ä¸ªå¯¹è±¡ã€‚ å¯¹äºæ‰€æœ‰å¯¹è±¡æ¥è¯´ï¼Œè¡¨è¾¾å¼ x.clone().getClass() == x.getClass() çš„å€¼åº”è¯¥ä¸º true ï¼Œå³å…‹éš†å¯¹è±¡ä¸åŸå¯¹è±¡çš„ç±»å‹åº”è¯¥æ˜¯ä¸€æ ·çš„ã€‚ å¯¹äºæ‰€æœ‰å¯¹è±¡æ¥è¯´ï¼Œè¡¨è¾¾å¼ x.clone().equals(x) çš„å€¼åº”è¯¥ä¸º trueï¼Œå³å…‹éš†å¯¹è±¡ä¸åŸå¯¹è±¡æ˜¯ç›¸ç­‰ï¼ˆequalï¼‰çš„ã€‚  é»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒç”¨ Object.clone() è¿›è¡Œçš„æ˜¯æµ…å…‹éš†ã€‚ä¾‹å¦‚ï¼š\n@Test public void shallowCopyTest() throws CloneNotSupportedException { CloneableUser user1 = new CloneableUser(\u0026#34;id1\u0026#34;, new CloneableName(\u0026#34;fn\u0026#34;, \u0026#34;ln\u0026#34;), 20); CloneableUser user2 = user1.clone(); assertNotSame(user1, user2); // shallow copy  assertSame(user1.getName(), user2.getName()); user2.getName().setFirstName(\u0026#34;nfn\u0026#34;); assertSame(user1.getName().getFirstName(), user2.getName().getFirstName()); user2.setId(\u0026#34;id2\u0026#34;); assertNotSame(user1.getId(), user2.getId()); } å®ç°æ·±å…‹éš† åœ¨Javaä¸­ï¼Œå®ç°æ·±å…‹éš†çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼š\n ä¸ºæ‰€æœ‰å¼•ç”¨ç±»å‹éƒ½å®ç°å…‹éš†æ–¹æ³•ã€‚ ä½¿ç”¨å¤åˆ¶æ„é€ å‡½æ•°ã€‚ é€šè¿‡åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚ é€šè¿‡ç¬¬ä¸‰æ–¹å·¥å…·å®ç°æ·±å…‹éš†ï¼Œä¾‹å¦‚ Apache Commons Lang ã€ Jackson ã€ Gson ã€FastJson ç­‰ã€‚  ä¸ºå¼•ç”¨ç±»å‹å®ç°å…‹éš†æ–¹æ³• è¿™ç§æ–¹æ³•éœ€è¦ä¸ºæ¯ç§ç±»å‹éƒ½å®ç°å…‹éš†æ–¹æ³•ï¼Œå¹¶ä¸”è¿™äº›ç±»å‹éƒ½è¦å®ç° Cloneable æ¥å£ã€‚ä¾‹å¦‚ï¼š\n@Test public void deepCopyTest_implementsCloneable() throws CloneNotSupportedException { @Data @NoArgsConstructor @AllArgsConstructor class Name implements Cloneable { private String firstName; private String lastName; @Override protected Name clone() throws CloneNotSupportedException { return (Name) super.clone(); } } @Data @NoArgsConstructor @AllArgsConstructor class User implements Cloneable { private String id; private Name name; private int age; @Override protected User clone() throws CloneNotSupportedException { User user = (User) super.clone(); user.setName(name.clone()); return user; } } Name newName = new Name(\u0026#34;fn\u0026#34;, \u0026#34;ln\u0026#34;); User user = new User(\u0026#34;id1\u0026#34;, newName, 20); User user2 = user.clone(); user2.getName().setFirstName(\u0026#34;nfn\u0026#34;); assertNotSame(user.getName().getFirstName(), user2.getName().getFirstName()); } ä½¿ç”¨å¤åˆ¶æ„é€ å‡½æ•° è¿™ç§æ–¹æ³•ä¸éœ€è¦å®ç° Cloneable æ¥å£ï¼Œä½†æ˜¯éœ€è¦ä¸ºæ‰€æœ‰çš„å¼•ç”¨ç±»å‹éƒ½å®šä¹‰ä¸€ä¸ªå¤åˆ¶æ„é€ å‡½æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœæ„é€ å™¨çš„å‚æ•°ä¸ºåŸºæœ¬æ•°æ®ç±»å‹æˆ–å­—ç¬¦ä¸²ç±»å‹ï¼ˆä¸å¯å˜ç±»å‹ï¼‰å°±ç›´æ¥èµ‹å€¼ï¼Œå¦åˆ™éœ€è¦é‡æ–° new ä¸€ä¸ªå¯¹è±¡ã€‚ä¾‹å¦‚ï¼š\n@Test public void deepCopyTest_copyConstructor() { @Data @NoArgsConstructor @AllArgsConstructor class Name { private String firstName; private String lastName; public Name (Name name) { this.firstName = name.getFirstName(); this.lastName = name.getLastName(); } } @Data @NoArgsConstructor @AllArgsConstructor class User { private String id; private Name name; private int age; public User (User user) { this.id = user.getId(); this.name = new Name(user.getName()); this.age = user.age; } } Name newName = new Name(\u0026#34;fn\u0026#34;, \u0026#34;ln\u0026#34;); User user = new User(\u0026#34;id1\u0026#34;, newName, 20); User user2 = new User(user); user2.getName().setFirstName(\u0026#34;nfn\u0026#34;); assertNotSame(user.getName().getFirstName(), user2.getName().getFirstName()); } åºåˆ—åŒ–ä¸ååºåˆ—åŒ– è¿™ç§æ–¹æ³•è¦æ±‚å¼•ç”¨ç±»å‹å®ç° Serializable æ¥å£ã€‚æ€æƒ³ä¸ºï¼šå…ˆå°†è¦åŸå¯¹è±¡å†™å…¥åˆ°å­—èŠ‚æµä¸­ï¼Œç„¶åå†ä»è¿™ä¸ªå­—èŠ‚æµä¸­è¯»å‡ºåˆšåˆšå­˜å‚¨çš„ä¿¡æ¯ï¼Œæ¥ä½œä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡è¿”å›ï¼Œæ–°å¯¹è±¡å’ŒåŸå¯¹è±¡å°±ä¸å­˜åœ¨ä»»ä½•åœ°å€ä¸Šçš„å…±äº«ï¼Œè¿™æ ·å°±å®ç°äº†æ·±å…‹éš†ã€‚ä¾‹å¦‚ï¼š\n@Test public void deepCopyTest_serDe() { SerializableUser user1 = new SerializableUser(\u0026#34;id1\u0026#34;, new SerializableName(\u0026#34;fn\u0026#34;, \u0026#34;ln\u0026#34;), 20); try { ByteArrayOutputStream baos = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(baos); oos.writeObject(user1); oos.close(); ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray()); ObjectInputStream ois = new ObjectInputStream(bais); SerializableUser user2 = (SerializableUser) ois.readObject(); ois.close(); assertEquals(user1, user2); assertNotSame(user1, user2); user2.getName().setFirstName(\u0026#34;nfn\u0026#34;); assertNotSame(user1.getName().getFirstName(), user2.getName().getFirstName()); } catch (IOException | ClassNotFoundException e) { e.printStackTrace(); } } ä½¿ç”¨ä¸‰æ–¹å·¥å…· Apache Commons Lang å·¥å…·åŒ…ä¸­çš„ SerializationUtils æä¾›äº†ä¸€ä¸ª clone() æ–¹æ³•ï¼Œå¯ä»¥å®ç°å¯¹è±¡çš„æ·±å…‹éš†ã€‚ç”±äºæ–¹æ³•å†…éƒ¨ä¹Ÿæ˜¯é€šè¿‡åºåˆ—åŒ–ä¸ååºåˆ—åŒ–å®ç°çš„ï¼Œå› æ­¤éœ€è¦è¢«åºåˆ—åŒ–çš„ç±»å®ç° Serialiable æ¥å£ã€‚ä¾‹å¦‚ï¼š\n@Test public void deepCopy_apacheCommonsLang() { SerializableUser user1 = new SerializableUser(\u0026#34;id1\u0026#34;, new SerializableName(\u0026#34;fn\u0026#34;, \u0026#34;ln\u0026#34;), 20); SerializableUser user2 = SerializationUtils.clone(user1); assertEquals(user1, user2); assertNotSame(user1, user2); user2.getName().setFirstName(\u0026#34;nfn\u0026#34;); assertNotSame(user1.getName().getFirstName(), user2.getName().getFirstName()); } å¾ˆå¤š JSON å·¥å…·åº“ä¹Ÿå¯ä»¥å®ç°å¯¹è±¡çš„æ·±å…‹éš†ï¼Œå®ƒä»¬çš„æ ¸å¿ƒæ€æƒ³æ˜¯å…ˆå°†å¯¹è±¡è½¬å‚¨ä¸º JSON ï¼Œç„¶åç”¨ JSON é‡æ–°åˆ›å»ºå‡ºä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼Œæ–°è€å¯¹è±¡çš„åœ°å€ä¸åŒï¼Œä½†å†…å®¹å´æ˜¯ç›¸åŒçš„ã€‚ä¾‹å¦‚ Google çš„ Gson åº“ï¼š\n@Test public void deepCopy_json() { User user1 = new User(\u0026#34;id1\u0026#34;, new Name(\u0026#34;fn\u0026#34;, \u0026#34;ln\u0026#34;), 20); Gson gson = new Gson(); User user2 = gson.fromJson(gson.toJson(user1), User.class); assertEquals(user1, user2); assertNotSame(user1, user2); user2.getName().setFirstName(\u0026#34;nfn\u0026#34;); assertNotSame(user1.getName().getFirstName(), user2.getName().getFirstName()); } ç›¸å…³ä»£ç  ç›¸å…³ä»£ç ä½äº Githubã€‚\nå‚è€ƒèµ„æ–™  The JavaÂ® Language Specification (Java SE 11 Edition).  ","href":"/java/java_lang/cloning_objects/","title":"Cloning Objects"},{"content":"Javaå…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªç±»ä¸­å®šä¹‰å¦ä¸€ä¸ªç±»ï¼Œåè€…è¢«ç§°ä¸ºåµŒå¥—ç±»ï¼ˆnested classï¼‰ã€‚åµŒå¥—ç±»å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š\n é™æ€å†…éƒ¨ç±»ï¼ˆstatic nested classï¼‰ å†…éƒ¨ç±»ï¼ˆinner classï¼‰  å…¶ä¸­å†…éƒ¨ç±»åˆå¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼š\n éé™æ€æˆå‘˜ç±»ï¼ˆnon-static member classï¼‰ å±€éƒ¨å†…éƒ¨ç±»ï¼ˆlocal classï¼‰ åŒ¿åå†…éƒ¨ç±»ï¼ˆanonymous classï¼‰  å››ç§åµŒå¥—ç±»çš„å®šä¹‰å¦‚ä¸‹ï¼š\nclass OuterClass { static class NestedClass{} // é™æ€åµŒå¥—ç±»  class MemberClass{} // éé™æ€æˆå‘˜ç±»  void m1() { class LocalClass{} // å±€éƒ¨å†…éƒ¨ç±»  new Thread(new Runnable() { // åŒ¿åå†…éƒ¨ç±»  @Override public void run() { // nothing  } }); } } é™æ€å†…éƒ¨ç±» é™æ€å†…éƒ¨ç±»æŒ‡è¢«å£°æ˜ä¸ºstaticçš„å†…éƒ¨ç±»ï¼Œå®ƒå¯ä»¥å•ç‹¬å®ä¾‹åŒ–ï¼Œå…¶å®ƒçš„å†…éƒ¨ç±»éœ€è¦åœ¨å¤–éƒ¨ç±»å®ä¾‹åŒ–ä¹‹åæ‰èƒ½å®ä¾‹åŒ–ã€‚é™æ€å†…éƒ¨ç±»ä¸èƒ½å’Œå¤–éƒ¨ç±»åŒåï¼Œä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹å˜é‡ï¼Œåªèƒ½è®¿é—®å¤–éƒ¨ç±»çš„ç±»å˜é‡å’Œç±»æ–¹æ³•ï¼ˆåŒ…æ‹¬è¢«privateä¿®é¥°çš„ç±»å˜é‡å’Œç±»æ–¹æ³•ï¼‰ã€‚\néé™æ€æˆå‘˜ç±» éé™æ€æˆå‘˜ç±»ä¸è¢«staticä¿®é¥°ã€‚å®ƒå¯ä»¥è‡ªç”±çš„è®¿é—®å¤–éƒ¨ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œæ— è®ºè¿™äº›å±æ€§å’Œæ–¹æ³•æ˜¯é™æ€çš„è¿˜æ˜¯éé™æ€çš„ã€‚ä½†æ˜¯æˆå‘˜ç±»æ˜¯å’Œå¤–éƒ¨ç±»å®ä¾‹ç›¸ç»‘å®šçš„ï¼Œå› æ­¤ä¸å¯ä»¥å®šä¹‰é™æ€å˜é‡å’Œé™æ€æ–¹æ³•ã€‚åªæœ‰åœ¨å¤–éƒ¨ç±»å®ä¾‹åŒ–ä¹‹åï¼Œè¿™ä¸ªæˆå‘˜ç±»æ‰èƒ½è¢«å®ä¾‹åŒ–ã€‚\nå±€éƒ¨å†…éƒ¨ç±» å±€éƒ¨å†…éƒ¨ç±»æ˜¯æŒ‡å®šä¹‰åœ¨ä¸€ä¸ªä»£ç å—å†…çš„ç±»ï¼Œå®ƒçš„ä½œç”¨èŒƒå›´åªé™äºå…¶æ‰€åœ¨çš„ä»£ç å—ã€‚å±€éƒ¨å†…éƒ¨ç±»å’Œå±€éƒ¨å˜é‡ç±»ä¼¼ï¼Œä¸èƒ½è¢«privateã€publicã€protectedå’Œstaticå…³é”®å­—ä¿®é¥°ï¼Œå¹¶ä¸”åªèƒ½è®¿é—®æ–¹æ³•ä¸­å®šä¹‰ä¸ºfinalçš„å±€éƒ¨å˜é‡ã€‚å±€éƒ¨ç±»çš„å…¶å®ƒé™åˆ¶å’Œæˆå‘˜ç±»åŸºæœ¬ç›¸åŒã€‚\nåŒ¿åå†…éƒ¨ç±» åŒ¿åå†…éƒ¨ç±»æ²¡æœ‰ç±»åã€‚ä¸èƒ½ä½¿ç”¨å…³é”®å­—classã€extendsã€implementsï¼Œæ²¡æœ‰æ„é€ å‡½æ•°ã€‚ä¸€ä¸ªåŒ¿åç±»ä¸€å®šæ˜¯åœ¨newçš„åé¢ï¼Œå¹¶ä¸”å®ƒå¿…é¡»ç»§æ‰¿å…¶å®ƒç±»æˆ–å®ç°ä¸€ä¸ªæ¥å£ã€‚æˆå‘˜ç±»çš„é™åˆ¶ä¹Ÿé€‚ç”¨äºåŒ¿åç±»ã€‚\n","href":"/java/java_lang/nested_classes/","title":"Nested Classes"},{"content":"","href":"/tags/jakartaee/","title":"JakartaEE"},{"content":" A servlet is a Javaâ„¢ technology-based Web component, managed by a container, that generates dynamic content.\n å’Œå…¶å®ƒåŸºäºJavaçš„ç»„ä»¶ä¸€æ ·ï¼ŒServletä¹Ÿç”±Javaç±»ç»„æˆï¼Œè¿™äº›Javaç±»(.classæ–‡ä»¶)ä¼šè¢«ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œå­—èŠ‚ç éšåä¼šè¢«åŠ¨æ€åœ°åŠ è½½åˆ°WebæœåŠ¡å™¨ä¸­å¹¶è¿è¡Œã€‚Servleté€šè¿‡Servletå®¹å™¨å®ç°çš„request/responseæ¨¡å‹æ¥ä¸Webå®¢æˆ·ç«¯è¿›è¡Œäº¤äº’ã€‚\nrequest/responseæ¨¡å‹ï¼šå¯ä»¥ç®€å•çš„å°†è¿™ä¸ªæ¨¡å‹çœ‹æˆæ˜¯ä¸€ç§å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šè¿‡äº¤æ¢å„è‡ªçš„æ¶ˆæ¯æ¥äº¤äº’çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚åƒæµè§ˆå™¨è¿™æ ·çš„å®¢æˆ·ç«¯å‘å‡ºçš„æ¶ˆæ¯å«åšrequestsï¼Œè€ŒæœåŠ¡ç«¯å“åº”çš„æ¶ˆæ¯å°±å«åšresponsesã€‚\nä»€ä¹ˆæ˜¯Servletå®¹å™¨  The servlet container is a part of a Web server or application server that provides the network services over which requests and responses are sent, decodes MIME-based requests, and formats MIME-based responses. A servlet container also contains and manages servlets through their lifecycle.\n å®¹å™¨(Container)ï¼Œåˆç§°Servletå¼•æ“(Servlet engine)ã€‚å®ƒå¯ä»¥æ˜¯WebæœåŠ¡å™¨å†…ç½®çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯WebæœåŠ¡å™¨ä¸­çš„æ’ä»¶ã€‚å¯¹äºæ‰€æœ‰çš„Servletå®¹å™¨è€Œè¨€ï¼Œé™¤äº†å¿…é¡»æ”¯æŒçš„HTTPåè®®ä»¥å¤–ï¼Œè¿˜å¯èƒ½æ”¯æŒå‘HTTPSè¿™ç§çš„åŸºäºrequest/responseæ¨¡å‹çš„åè®®ã€‚å®¹å™¨å¿…é¡»å®ç°çš„HTTPåè®®ç‰ˆæœ¬åŒ…æ‹¬HTTP/1.1å’ŒHTTP/2ï¼Œå½“æ”¯æŒHTTP/2æ—¶ï¼Œå®¹å™¨å¿…é¡»æ”¯æŒh2å’Œh2cä¸¤ç§åè®®æ ‡è¯†ç¬¦ï¼Œå³æ‰€æœ‰çš„Servletå®¹å™¨å¿…é¡»æ”¯æŒALPNã€‚\næ­¤å¤–ï¼ŒServletå®¹å™¨è¿˜å¯èƒ½ä¼šåœ¨Servletçš„æ‰§è¡Œç¯å¢ƒä¸­åŠ å…¥å®‰å…¨é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œä¸€äº›åº”ç”¨æœåŠ¡å™¨å¯èƒ½ä¼šé™åˆ¶å¯¹**Thread**å¯¹è±¡çš„åˆ›å»ºï¼Œä»¥é¿å…å¯¹å®¹å™¨ä¸­çš„å…¶å®ƒç»„ä»¶é€ æˆè´Ÿé¢å½±å“ã€‚\nä¸€ä¸ªä¾‹å­ ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„Servletäº‹ä»¶åºåˆ—ï¼š\n å®¢æˆ·ç«¯(æ¯”å¦‚æµè§ˆå™¨)è®¿é—®WebæœåŠ¡å™¨å¹¶å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ã€‚ WebæœåŠ¡å™¨æ¥æ”¶è¯¥HTTPè¯·æ±‚å¹¶å°†å…¶è½¬äº¤ç»™Servletå®¹å™¨ã€‚ Servletå®¹å™¨å…ˆæ ¹æ®é…ç½®ä¿¡æ¯å†³å®šè¯¥è¦è°ƒç”¨å“ªä¸€ä¸ªServletï¼Œç„¶åå°†è¡¨ç¤ºrequestå’Œresponseçš„å¯¹è±¡ä¼ é€’ç»™è¯¥Servletå¹¶è°ƒç”¨å®ƒã€‚ Servletä»requestå¯¹è±¡ä¸­è·å–åˆ°è¿œç¨‹ç”¨æˆ·çš„èº«ä»½ã€è¯·æ±‚å‚æ•°å’Œå…¶å®ƒç›¸å…³æ•°æ®ï¼Œç„¶åæ‰§è¡Œå¤„ç†é€»è¾‘ï¼Œæœ€åç”Ÿæˆå“åº”æ•°æ®(é€šè¿‡responseå¯¹è±¡)å¹¶å‘å›ç»™å®¢æˆ·ç«¯ã€‚ ä¸€æ—¦Servletå®Œæˆæ•´ä¸ªè¯·æ±‚å¤„ç†è¿‡ç¨‹ï¼ŒServletå®¹å™¨å°±ä¼šåˆ·æ–°å“åº”ï¼Œç„¶åå°†æ§åˆ¶æƒå½’è¿˜ç»™WebæœåŠ¡å™¨ã€‚  ä¸€ä¸ªç®€å•çš„Servlet ä¸‹é¢å°†ç¼–å†™ä¸€ä¸ªéå¸¸ç®€å•çš„Servletï¼Œå®ƒå°†å±•ç°ç¼–å†™Servletçš„æ‰€æœ‰åŸºæœ¬è¦æ±‚ã€‚æœ€ç»ˆè¯¥Servletä¼šåœ¨æµè§ˆå™¨ä¸­è¾“å‡ºä¸€äº›æ–‡æœ¬ï¼š\n Hello, Servlet!\n æˆ‘è¿™é‡Œä½¿ç”¨çš„å¼€å‘å·¥å…·æ˜¯IDEAï¼ŒServletå®¹å™¨æ—¶Tomcat 9.0.35ã€‚æˆ‘ç›´æ¥ä½¿ç”¨IDEAåˆ›å»ºäº†ä¸€ä¸ªJava Enterpriseå·¥ç¨‹ï¼Œç›¸å…³é…ç½®å¦‚ä¸‹ï¼š\n   Name Value     Java EE version Java EE 8   Application Server Tomcat 9.0.35   Additional Libraries and Frameworks Web Application    åˆ›å»ºServletç±» Servletæ˜¯ä¸€ä¸ªJavaç±»ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ï¼Œå®ƒç›´æ¥ç»§æ‰¿äº† **HttpServlet**å¹¶é‡å†™äº†serviceæ–¹æ³•ï¼š\npublic class HelloServlet extends HttpServlet { @Override protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { PrintWriter writer = resp.getWriter(); writer.println(\u0026#34;Hello, Servlet!\u0026#34;); writer.close(); } } serviceæ–¹æ³•æ˜¯Servletå®¹å™¨åœ¨Servletç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨çš„æœ€åŸºæœ¬çš„å¤„ç†æ–¹æ³•ã€‚åœ¨æˆ‘ä»¬çš„serviceæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†Hello, Servlet!å†™åˆ°äº†å“åº”å¯¹è±¡çš„è¾“å‡ºæµä¸­ã€‚\né…ç½®Webç¨‹åº åœ¨WEB-INFç›®å½•ä¸‹åˆ›å»ºweb.xmlæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;web-app xmlns=\u0026#34;http://xmlns.jcp.org/xml/ns/javaee\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\u0026#34; version=\u0026#34;4.0\u0026#34;\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;hello-servlet\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;ml.zhannicholas.servletdemos.HelloServlet\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;hello-servlet\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;/hello\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;/web-app\u0026gt; è¯¥æ–‡ä»¶å‘Tomcatæè¿°äº†æˆ‘ä»¬è¦å‘å¸ƒçš„Webåº”ç”¨ç¨‹åºã€‚æ–‡ä»¶ä¸­çš„servlet-nameè¡¨ç¤ºæ‰€ä½¿ç”¨çš„Servletçš„åå­—ã€‚servlet-classå…ƒç´ å°†è¯¥åç§°æ˜ å°„åˆ°ä¸€ä¸ªServletçš„å®ç°ç±»ï¼Œæœ¬ç¤ºä¾‹ä¸­ä¸º HelloServletã€‚servlet-mappingå…ƒç´ å‘Šè¯‰Tomcatæˆ‘ä»¬çš„Servletåªå¤„ç†å¯¹/helloçš„è¯·æ±‚ã€‚\nè®¾ç½®å¥½web.xmlåï¼Œå°±å¯ä»¥å¯åŠ¨Tomcatäº†ã€‚\nè¿è¡ŒServlet åœ¨TomcatæˆåŠŸå‘å¸ƒæˆ‘ä»¬çš„Webåº”ç”¨ä¹‹åï¼Œè®¿é—®http://localhost:8080/hello å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„Hello, Servlet!ä¿¡æ¯äº†ã€‚\nç¤ºä¾‹ä»£ç ä½äºGithubã€‚\nå‚è€ƒèµ„æ–™  Shing Wai, Chan Ed Burns. Javaâ„¢ Servlet Specification, Version 4.0. Oracle Corporation, 2017.  ","href":"/java/jakartaee/what_is_servlet/","title":"What is Servlet"},{"content":"**Servletæ¥å£æ˜¯Java Servlet APIçš„æ ¸å¿ƒæŠ½è±¡ï¼Œæ‰€æœ‰çš„Servletéƒ½ç›´æ¥æˆ–é—´æ¥åœ°å®ç°å®ƒã€‚GenericServlet**å’Œ **HttpServlet**å°±æ˜¯Java Servlet APIä¸­çš„ä¸¤ä¸ª **Servlet**å®ç°ç±»ã€‚å¾ˆå¤šæ—¶å€™ï¼Œå¼€å‘äººå‘˜åªéœ€è¦ç»§æ‰¿ **HttpServlet**å¹¶å®ç°ä»–ä»¬è‡ªå·±çš„æœåŠ¡å°±è¡Œäº†ã€‚\nè¯·æ±‚å¤„ç†æ–¹æ³• **Servlet**æ¥å£ä¸­å®šä¹‰çš„serviceæ–¹æ³•å°±æ˜¯ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„ï¼ŒServletå®¹å™¨æ¯å°†ä¸€ä¸ªè¯·æ±‚è·¯ç”±åˆ°ä¸€ä¸ªServletå®ä¾‹ä¹‹åï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªserviceæ–¹æ³•ã€‚ä¸ºäº†å¤„ç†å¹¶å‘è¯·æ±‚ï¼Œå¼€å‘è€…ç¼–å†™çš„Servleté€šå¸¸è¦èƒ½å¤Ÿå¤„ç†åœ¨ç‰¹å®šæ—¶é—´å†…serviceæ–¹æ³•ä¸­æœ‰å¤šä¸ªçº¿ç¨‹æ‰§è¡Œçš„æƒ…å†µã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒWebå®¹å™¨å°±æ˜¯é€šè¿‡åœ¨ä¸åŒçº¿ç¨‹ä¸Šå¹¶å‘åœ°æ‰§è¡Œserviceæ–¹æ³•æ¥å°†å¹¶å‘è¯·æ±‚äº¤ç»™åŒä¸€ä¸ªServletå¤„ç†çš„ã€‚\nHTTPè¯·æ±‚çš„å¤„ç†æ–¹æ³• ä¸ºäº†ç®€åŒ–HTTPè¯·æ±‚çš„å¤„ç†è¿‡ç¨‹ï¼ŒæŠ½è±¡ç±» **HttpServlet**åœ¨ **Servlet**çš„åŸºç¡€ä¸Šæ·»åŠ äº†ä¸€äº›é¢å¤–çš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å¯ä»¥è‡ªåŠ¨çš„è¢«serviceæ–¹æ³•è°ƒç”¨ï¼Œå®ƒä»¬æ˜¯ï¼š\n å¤„ç†GETè¯·æ±‚çš„doGetæ–¹æ³•ï¼› å¤„ç†POSTè¯·æ±‚çš„doPostæ–¹æ³•ï¼› å¤„ç†PUTè¯·æ±‚çš„doPutæ–¹æ³•ï¼› å¤„ç†DELETEè¯·æ±‚çš„doDeleteæ–¹æ³•ï¼› å¤„ç†HEADè¯·æ±‚çš„doHeadæ–¹æ³•ï¼› å¤„ç†OPTIONSè¯·æ±‚çš„doOptionsæ–¹æ³•ï¼› å¤„ç†TRACEè¯·æ±‚çš„doTraceæ–¹æ³•ï¼›  åœ¨å¼€å‘åŸºäºHTTPçš„Servletæ—¶ï¼Œå¼€å‘è€…ä¸€èˆ¬åªéœ€è¦å…³å¿ƒdoGetå’ŒdoPostæ–¹æ³•å³å¯ã€‚\nServletç”Ÿå‘½å‘¨æœŸ Servletæœ‰ä¸€ä¸ªå®šä¹‰éå¸¸è‰¯å¥½çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒå®šä¹‰äº†Servletæ˜¯å¦‚ä½•è¢«åŠ è½½å¹¶è¢«å®ä¾‹åŒ–ã€å¦‚ä½•åˆå§‹åŒ–ã€å¦‚ä½•å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ä»¥åŠå¦‚ä½•ç»“æŸæœåŠ¡çš„ã€‚è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ˜¯é€šè¿‡ **Servlet**æ¥å£çš„initã€serviceå’Œdestroyæ–¹æ³•æ¥å®šä¹‰çš„ï¼Œæ‰€æœ‰çš„Servletéƒ½å¿…é¡»ç›´æ¥æˆ–é—´æ¥åœ°å®ç°è¿™å‡ ä¸ªæ–¹æ³•ã€‚Servletçš„ç”Ÿå‘½å‘¨æœŸæ˜¯ç”±Servletå®¹å™¨æ§åˆ¶çš„ï¼Œå½“ä¸€ä¸ªè¯·æ±‚è¢«æ˜ å°„åˆ°ä¸€ä¸ªServletæ—¶ï¼Œå®¹å™¨ä¼šè¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\n å¦‚æœå®¹å™¨ä¸­æ²¡æœ‰è¯¥Servletçš„å®ä¾‹ï¼Œå®¹å™¨å°±ä¼šï¼šå…ˆåŠ è½½Servletï¼Œç„¶ååˆ›å»ºServletå®ä¾‹ï¼Œå†è°ƒç”¨initæ–¹æ³•å¯¹Servletè¿›è¡Œåˆå§‹åŒ–ã€‚ å®¹å™¨è°ƒç”¨Servletçš„serviceæ–¹æ³•å¹¶ä¼ å…¥requestå’Œresponseå¯¹è±¡ã€‚  å½“å®¹å™¨éœ€è¦ç§»é™¤ä¸€ä¸ªServletæ—¶ï¼Œå®ƒä¼šè°ƒç”¨Servletçš„destroyæ–¹æ³•è¿›è¡Œæ”¶å°¾å·¥ä½œã€‚\nåŠ è½½ä¸å®ä¾‹åŒ– Servletçš„åŠ è½½ä¸å®ä¾‹åŒ–æ˜¯ç”±Servletå®¹å™¨è´Ÿè´£çš„ã€‚Servletçš„åŠ è½½ä¸åˆå§‹åŒ–å¯ä»¥å‘ç”Ÿåœ¨Servletå®¹å™¨å¯åŠ¨æ—¶ï¼Œä¹Ÿå¯ä»¥å»¶è¿Ÿåˆ°éœ€è¦å¤„ç†è¯·æ±‚æ—¶æ‰å‘ç”Ÿã€‚Servletå®¹å™¨ä½¿ç”¨Javaçš„ç±»åŠ è½½æœºåˆ¶æ¥åŠ è½½Servletï¼Œè¢«åŠ è½½çš„Servletå¯èƒ½æ¥è‡ªæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå¯èƒ½æ¥è‡ªè¿œç¨‹æ–‡ä»¶ç³»ç»Ÿæˆ–å…¶å®ƒç½‘ç»œæœåŠ¡ã€‚å½“Servletè¢«åŠ è½½æˆåŠŸä¹‹åï¼Œå®¹å™¨å°±ä¼šå®ä¾‹åŒ–å®ƒä»¥å¤‡å°†æ¥ä½¿ç”¨ã€‚\nåˆå§‹åŒ– å½“Servletå¯¹è±¡è¢«å®ä¾‹åŒ–ä¹‹åï¼Œå®¹å™¨å¿…é¡»åœ¨å®ƒå¼€å§‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ä¹‹å‰å°†å®ƒåˆå§‹åŒ–ã€‚åˆå§‹åŒ–è¿‡ç¨‹å¯ä»¥ç”¨æ¥ä»æ•°æ®åº“å†…è¯»å–é…ç½®æ•°æ®ï¼Œæ‰§è¡Œä¸€æ¬¡æ€§æ´»åŠ¨ç­‰ç­‰ã€‚å®¹å™¨é€šè¿‡ **Servlet**æ¥å£çš„initæ–¹æ³•æ¥åˆå§‹åŒ–ä¸€ä¸ªServletï¼Œinitæ–¹æ³• æ¥æ”¶ä¸€ä¸ª **ServletConfigæ¥å£çš„å®ç°ç±»ï¼Œå®ƒå…è®¸Servletä»Webåº”ç”¨çš„é…ç½®ä¿¡æ¯ä¸­è¯»å–name-valueå½¢å¼çš„åˆå§‹åŒ–å‚æ•°ã€‚æ­¤å¤–ï¼ŒServlet**è¿˜å¯ä»¥é€šè¿‡ **ServletConfig**æ¥è®¿é—® ServletConfigï¼ˆå®ƒæè¿°äº†å½“å‰Servletçš„è¿è¡Œç¯å¢ƒï¼‰ã€‚\nåœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼ŒServletå®ä¾‹å¯èƒ½ä¼šæŠ›å‡ºä¸€ä¸ª **UnavailableException**æˆ– ServletExceptionã€‚è¿™æ—¶ï¼Œè¿™ä¸ªServletå®ä¾‹å°±ä¸èƒ½è¢«æ”¾åˆ°ç°å½¹æœåŠ¡ä¸­ï¼ŒServletå®¹å™¨å¿…é¡»æŠŠå®ƒé‡Šæ”¾æ‰ã€‚è¿™ä¸ªæ—¶å€™ï¼Œdestroyæ–¹æ³•å¹¶ä¸ä¼šè¢«è°ƒç”¨ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹Servletçš„åˆå§‹åŒ–æ˜¯ä¸æˆåŠŸçš„ã€‚åˆå§‹åŒ–å¤±è´¥çš„Servletåœ¨ä¹‹åçš„æŸä¸ªæ—¶é—´ç‚¹è¿˜å¯èƒ½å†æ¬¡è¢«åˆå§‹åŒ–ã€‚\nè¯·æ±‚å¤„ç† åœ¨Servletè¢«æ­£ç¡®åœ°åˆå§‹åŒ–ä¹‹åï¼ŒServletå®¹å™¨å°±å¯ä»¥ç”¨å®ƒæ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚äº†ã€‚æ¯ä¸ªè¯·æ±‚éƒ½è¢«è¡¨ç¤ºä¸ºä¸€ä¸ª **ServletRequest**å¯¹è±¡ï¼Œè€Œè¯·æ±‚çš„å“åº”ä¼šè¢«è¡¨ç¤ºæˆä¸€ä¸ª **ServletResponse**å¯¹è±¡ã€‚è¿™ä¸¤ä¸ªå¯¹è±¡éƒ½ä¼šè¢«ä¼ é€’ç»™ **Servlet**æ¥å£çš„serviceæ–¹æ³•ä½œä¸ºå…¥å‚ã€‚å½“å¤„ç†HTTPè¯·æ±‚æ—¶ï¼Œå®¹å™¨ä¼šä½¿ç”¨ **HttpServletRequest**å’Œ **HttpServletResponse**ç±»å‹çš„å¯¹è±¡ã€‚\nå½“ç„¶ï¼Œå®¹å™¨å†…å¤„äºæœåŠ¡çŠ¶æ€çš„Servletåœ¨æ•´ä¸ªç”Ÿå­˜æœŸä¸­ä¸€ä¸ªè¯·æ±‚ä¹Ÿä¸å¤„ç†ä¹Ÿæ˜¯æœ‰å¯èƒ½çš„ã€‚\nå¤šçº¿ç¨‹é—®é¢˜ Servletå®¹å™¨å¯èƒ½å°†å¹¶å‘çš„è¯·æ±‚ç§»äº¤ç»™Servletçš„serviceæ–¹æ³•ã€‚ä¸ºäº†å¤„ç†è¿™äº›è¯·æ±‚ï¼ŒServletå¼€å‘è€…å¿…é¡»ä»”ç»†å¤„ç†å¥½serviceæ–¹æ³•å†…çš„å¤šä¸ªçº¿ç¨‹ã€‚**SingleThreadModel**åœ¨Servlet 4.0ä¸­å·²è¢«å¼ƒç”¨ã€‚\nè¯·æ±‚å¤„ç†ä¸­çš„å¼‚å¸¸ åœ¨å¤„ç†è¯·æ±‚æ—¶ï¼ŒServletå¯èƒ½ä¼šæŠ›å‡º **ServletExceptionæˆ– UnavailableExceptionã€‚ServletException**è¡¨ç¤ºå¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä¸€äº›é”™è¯¯ï¼Œæ­¤æ—¶å®¹å™¨éœ€è¦é‡‡å–ä¸€äº›æ“ä½œæ¥æ¸…é™¤è¯·æ±‚ã€‚è€Œ **UnavailableException**è¡¨ç¤ºè¯¥Servletä¸´æ—¶æˆ–æ°¸ä¹…ä¸å¯ç”¨ã€‚å¦‚æœä¸å¯ç”¨æ˜¯æ°¸ä¹…çš„ï¼Œå®¹å™¨å¿…é¡»å°†è¿™ä¸ªServletç§»é™¤ï¼Œè°ƒç”¨å®ƒçš„destroyæ–¹æ³•å¹¶é‡Šæ”¾å®ƒï¼Œå®¹å™¨ä¼šä¸ºæ‰€æœ‰å› æ­¤è€Œæ‹’ç»çš„è¯·æ±‚è¿”å›SC_NOT_FOUND(404)ã€‚å¦‚æœä¸å¯ç”¨æ˜¯ä¸´æ—¶çš„ï¼Œå®¹å™¨ä¼šåœ¨ä¸€å®šæ—¶é—´å†…ä¸å†è·¯ç”±ç›¸å…³çš„è¯·æ±‚åˆ°è¿™ä¸ªServletä¸Šï¼Œå®¹å™¨ä¼šä¸ºæ‰€æœ‰åœ¨è¿™æ®µæ—¶é—´å†…å› æ­¤è€Œæ‹’ç»çš„è¯·æ±‚è¿”å›SC_SERVICE_UNAVAILABLE(503)ã€‚\nå¼‚æ­¥å¤„ç† **AsyncContext**è¡¨ç¤ºçš„æ˜¯ **ServletRequest**åˆ›å»ºçš„å¼‚æ­¥æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚\nå¾…å®Œå–„ã€‚\nç»ˆæ­¢æœåŠ¡ å½“å®¹å™¨å†³å®šè¦ç§»é™¤ä¸€ä¸ªServletæ—¶ï¼Œå®ƒä¼šè°ƒç”¨è¿™ä¸ªServletçš„destroyæ–¹æ³•ã€‚Servletå¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­é‡Šæ”¾å½“å‰å ç”¨çš„èµ„æºã€ä¿å­˜å½“å‰çŠ¶æ€åˆ°æ•°æ®åº“ç­‰ç­‰ã€‚åœ¨è°ƒç”¨destroyæ–¹æ³•ä¹‹å‰ï¼Œå®¹å™¨ä¼šç­‰å¾…serviceæ–¹æ³•å†…çš„çº¿ç¨‹æ‰§è¡Œç»“æŸã€‚å½“ç­‰å¾…æ—¶é—´è¾¾åˆ°æŸä¸ªé˜ˆå€¼æ—¶ï¼Œdestroyæ–¹æ³•ä¹Ÿå¯èƒ½è¢«ç›´æ¥è°ƒç”¨ã€‚åœ¨destroyæ–¹æ³•å®Œæˆåï¼Œå®¹å™¨å¿…é¡»é‡Šæ”¾è¿™ä¸ªServletï¼Œä»¥ä¾¿GCå°†å…¶å›æ”¶ã€‚\n","href":"/java/jakartaee/the_servlet_interface/","title":"The Servlet Interface"},{"content":"Java EE(Java Platform, Enterprise Edition)æ˜¯æ„å»ºåœ¨Java SEä¹‹ä¸Šçš„ä¸€å¥—ä¼ä¸šçº§æ ‡å‡†ï¼Œæ—©æœŸè¢«ç§°ä¸ºJ2EE(Java 2 Platform Enterprise Edition)ï¼Œç°åœ¨åˆ™è¢«ç§°ä¸ºJakarta EEã€‚\nåœ¨Javaçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸­ï¼ŒJavaä¼ä¸šæ‰©å±•ä»…ä»…åªæ˜¯core JDKçš„ä¸€éƒ¨åˆ†ã€‚åˆ°äº†1999å¹´ï¼Œè¿™äº›ä¼ä¸šæ‰©å±•è¢«ä»Java SEä¸­å‰¥ç¦»å‡ºæ¥ï¼Œå¹¶ä½œä¸ºJava 2çš„ä¸€éƒ¨åˆ†ï¼Œå³J2EE(æˆ–Java 2 Platform Enterprise Edition)ï¼ŒJ2EEè¿™ä¸ªç§°å‘¼ä¸€è‡´ç»´æŒåˆ°äº†2006å¹´ã€‚åœ¨2006å¹´å‘å¸ƒçš„Java 5ä¸­ï¼ŒJ2EEæ”¹åä¸ºJava EEï¼Œè¿™ä¸ªåå­—ä¸€ç›´ä½¿ç”¨åˆ°äº†2017å¹´ã€‚2017å¹´å‘ç”Ÿäº†ä¸€ä»¶å’ŒJavaæœ‰å…³çš„å¤§äº‹å„¿ï¼šOracleå†³å®šå°†Java EEæèµ ç»™EclipseåŸºé‡‘ä¼šã€‚è™½ç„¶å¦‚æ­¤ï¼Œä½†Oracleä¾æ—§ä¿ç•™äº†Javaè¯­è¨€çš„æ‰€æœ‰æƒã€‚äº‹å®ä¸Šï¼Œç”±äºOracleæ‹¥æœ‰\u0026quot;Java\u0026quot;çš„å•†æ ‡æƒï¼ŒæŒ‰ç…§æ³•å¾‹è§„å®šï¼ŒEclipseåŸºé‡‘ä¼šä¸èƒ½å†ä½¿ç”¨Java EEè¿™ä¸ªåå­—ã€‚ç»è¿‡ç¤¾åŒºæŠ•ç¥¨ï¼ŒåŸºé‡‘ä¼šæœ€ç»ˆé€‰å–äº†Jakarta EEä½œä¸ºJava EEçš„æ–°åå­—ã€‚\nç®€è€Œè¨€ä¹‹ï¼ŒJ2EEçš„åå­—åœ¨å†å²ä¸Šçš„ä¸»è¦å˜æ›´å¦‚ä¸‹ï¼š\n   Version Date     J2EE 1.2 1999å¹´12æœˆ   J2EE 1.3 2001å¹´09æœˆ   J2EE 1.4 2003å¹´11æœˆ   Java EE 5 2006å¹´05æœˆ   Java EE 6 2009å¹´12æœˆ   Java EE 7 2013å¹´04æœˆ   Java EE 8 2017å¹´08æœˆ   Jakarta EE 2018å¹´12æœˆ    å½“å‰ï¼ŒJava EEçš„å¤§éƒ¨åˆ†Githubä»“åº“å·²ç»å½’æ¡£ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯Eclipse EE4Jã€‚\n","href":"/java/jakartaee/about/","title":"About Jakarta EE"},{"content":"Redisä¸­æä¾›äº†5ä¸ªå’Œäº‹åŠ¡ç›¸å…³çš„å‘½ä»¤ï¼šMULTIã€EXECã€DISCARDã€**WATCH key [key ...]**å’Œ UNWATCHã€‚Redisäº‹åŠ¡ä¸€æ¬¡æ‰§è¡Œä¸€ç»„å‘½ä»¤ï¼Œå¹¶ä¿è¯ï¼š\n ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤æŒ‰é¡ºåºä¸²è¡Œæ‰§è¡Œã€‚è‹¥æŸä¸€ä¸ªè¿æ¥å·²å¼€å¯äº‹åŠ¡ï¼Œå…¶å®ƒè¿æ¥æäº¤çš„å‘½ä»¤å¹¶ä¸ä¼šæ’å…¥åˆ°è¿™ä¸ªäº‹åŠ¡ä¸­ï¼Œè€Œæ˜¯ä¼šå•ç‹¬æ‰§è¡Œï¼Œå³éš”ç¦»æ€§â€”â€”æ¯ä¸ªä¼šè¯ä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ è¦ä¹ˆæ‰€æœ‰çš„å‘½ä»¤éƒ½æ‰§è¡Œï¼Œè¦ä¹ˆä¸€æ¡å‘½ä»¤éƒ½ä¸æ‰§è¡Œï¼Œå³åŸå­æ€§ã€‚Redisä¿è¯å½“æŸä¸ªè¿æ¥æ–­å¼€åï¼Œä¹‹å‰åœ¨è¯¥è¿æ¥ä¸Šæ‰€æœ‰QUEUEDçš„å‘½ä»¤ä¸€ä¸ªä¹Ÿä¸ä¼šæ‰§è¡Œ  ä½¿ç”¨äº‹åŠ¡ **MULTI**æ ‡å¿—ç€ä¸€ä¸ªäº‹åŠ¡å—çš„å¼€å§‹ï¼Œéšåçš„å‘½ä»¤ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šè¢«æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ã€‚å½“é‡åˆ° **EXEC**æ—¶ï¼Œé˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¼šä»¥åŸå­çš„æ–¹å¼æŒ‰å…¥é˜Ÿé¡ºåºæ‰§è¡Œï¼Œé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤æ„æˆäº†ä¸€ä¸ªå•ä¸€çš„åŸå­æ“ä½œã€‚è€Œå½“é‡åˆ° **DISCARD**å‘½ä»¤æ—¶ï¼Œäº‹åŠ¡é˜Ÿåˆ—ä¼šè¢«æ¸…ç©ºï¼Œé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤è¢«ä¸¢å¼ƒï¼Œäº‹åŠ¡ç»“æŸï¼Œè¿æ¥å›åˆ°æ­£å¸¸çŠ¶æ€ï¼Œå¦‚æœæŸäº›é”®å¤„äºwatchedçŠ¶æ€ï¼Œå®ƒä»¬å°†ä¸å†è¢«watchã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä»acount:Båˆ’20åˆ°acount:Açš„è¿™ä¸ªæ“ä½œæ˜¯åŸå­çš„ï¼š\n\u0026gt; mset account:A 100 account:B 200 OK \u0026gt; multi OK \u0026gt; decrby account:B 20 QUEUED \u0026gt; incrby account:A 20 QUEUED \u0026gt; exec 1) (integer) 180 2) (integer) 120 \u0026gt; mget account:A account:B 1) \u0026quot;120\u0026quot; 2) \u0026quot;180\u0026quot; ä»ä¸Šé¢è¿™æ®µä»£ç å¯ä»¥å‘ç°ï¼Œ**MULTI**åçš„å‘½ä»¤éƒ½è¢«QUEUEDï¼Œæ‰§è¡Œ **EXEC**ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ å°±æ˜¯ä¹‹å‰å…¥é˜Ÿçš„å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œå®ƒä»¬æ˜¯é¡ºåºå¯¹åº”çš„ã€‚\nå½“äº‹åŠ¡ä¸­å‘ç”Ÿé”™è¯¯ åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œå¯èƒ½å‘ç”Ÿä»¥ä¸‹ä¸¤ç±»é”™è¯¯ï¼š\n è°ƒç”¨ **EXEC**ä¹‹å‰æœ‰å‘½ä»¤å…¥é˜Ÿå¤±è´¥ã€‚å¤šæ•°æƒ…å†µä¸‹æ˜¯ç”±äºç¼–ç¨‹é”™è¯¯(ä¾‹å¦‚è¯­æ³•é”™è¯¯)ï¼Œä¹Ÿå¯èƒ½æ˜¯ç³»ç»Ÿé”™è¯¯(ä¾‹å¦‚å†…å­˜ç”¨å°½)ï¼Œä¹Ÿå¯èƒ½æ˜¯è¢«å½“å‰çº¿ç¨‹ **WATCH**çš„é”®åœ¨è°ƒç”¨ **MULTI**ä¹‹åè¢«å…¶å®ƒçº¿ç¨‹ä¿®æ”¹ è°ƒç”¨ **EXEC**ä¹‹åæœ‰å‘½ä»¤æ‰§è¡Œå¤±è´¥ã€‚ä¾‹å¦‚åœ¨ç‰¹å®šç±»å‹çš„æ•°æ®ä¸Šæ‰§è¡Œè¯¥ç±»å‹ä¸æ”¯æŒçš„æ“ä½œ  å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œå½“å‰äº‹åŠ¡ä¼šè¢«æ ‡è®°ä¸ºæ— æ•ˆçŠ¶æ€ï¼Œé”™è¯¯çš„å‘½ä»¤å¹¶ä¸ä¼šå…¥é˜Ÿï¼Œå…¶åçš„å‘½ä»¤ä¼šç»§ç»­å…¥é˜Ÿï¼Œä½†å½“è°ƒç”¨ **EXEC**æ—¶ï¼Œå¹¶ä¸ä¼šå¼€å¯äº‹åŠ¡ï¼Œè€Œæ˜¯ä¼šå¼‚å¸¸ä¸­æ­¢ã€‚å½“xxå‘½ä»¤ç”±äºè¯­æ³•é”™è¯¯è€Œå…¥é˜Ÿå¤±è´¥ï¼Œäº‹åŠ¡å¤„äºæ— æ•ˆçŠ¶æ€ï¼Œè°ƒç”¨ **EXECå¹¶ä¸ä¼šå¼€å¯äº‹åŠ¡ï¼Œè€Œæ˜¯ç›´æ¥ç»ˆæ­¢ï¼ŒINCR account:B**ä¹Ÿæ²¡æœ‰æ‰§è¡Œï¼š\n\u0026gt; multi OK \u0026gt; xx (error) ERR unknown command `xx`, with args beginning with: \u0026gt; incr account:B QUEUED \u0026gt;exec (error) EXECABORT Transaction discarded because of previous errors. å¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œå½“æŸä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥æ—¶ï¼ŒRedisä¼šç»§ç»­æ‰§è¡Œåç»­å‘½ä»¤ï¼Œå› ä¸ºRedisä¸æ”¯æŒå›æ»šã€‚ç»§ç»­ä»¥account:Aå’Œaccount:Bä¸¾ä¾‹ï¼Œæˆ‘ä»¬å…ˆåœ¨stringä¸Šæ‰§è¡Œ **LPOP**å‘½ä»¤ï¼Œå‘½ä»¤æœ¬èº«æ²¡æœ‰è¯­æ³•é”™è¯¯ï¼Œå› æ­¤å…¥é˜ŸæˆåŠŸï¼Œå¼€å¯äº‹åŠ¡åï¼Œlpop account:Aæ‰§è¡Œå¤±è´¥ï¼Œè€Œåç»­å‘½ä»¤æ­£å¸¸æ‰§è¡Œï¼š\n\u0026gt; multi OK \u0026gt; lpop account:A QUEUED \u0026gt; incr account:B QUEUED \u0026gt; exec 1) (error) WRONGTYPE Operation against a key holding the wrong kind of value 2) (integer) 181 \u0026gt; mget account:A account:B 1) \u0026quot;120\u0026quot; 2) \u0026quot;181\u0026quot; ç¬¬ä¸€ç§æƒ…å†µå’Œç¬¬äºŒç§æƒ…å†µæœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šå‰è€…ä¼šå¯¼è‡´ **EXEC**æ‰§è¡Œå¤±è´¥ï¼Œè€Œåè€…ä¸ä¼šã€‚\nä¹è§‚å¹¶å‘æ§åˆ¶ **WATCHä¸ºRedisäº‹åŠ¡æä¾›äº†åŸºäºcheck-and-set(CAS)çš„ä¹è§‚å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œä½œç”¨èŒƒå›´ä¸ºå•ä¸ªè¿æ¥ã€‚WATCH**å¿…é¡»åœ¨ **MULTI**ä¹‹å‰è°ƒç”¨ï¼Œå®ƒåœ¨è°ƒç”¨ **EXECå‘½ä»¤ä¹‹å‰æŒç»­watchä¸€ç»„é”®ï¼Œè‹¥è¢«watchçš„é”®ä¸­æœ‰è‡³å°‘ä¸€ä¸ªè¢«å…¶å®ƒå®¢æˆ·ç«¯ä¿®æ”¹ï¼Œæ•´ä¸ªäº‹åŠ¡å°±ä¼šä¸­æ­¢ï¼ŒEXECä¹Ÿä¼šè¿”å›NULLä»¥è¡¨ç¤ºäº‹åŠ¡å¤±è´¥(æ²¡æœ‰ä»»ä½•å‘½ä»¤è¢«æ‰§è¡Œ)ã€‚WATCH**å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼Œåé¢çš„è°ƒç”¨ä¸ä¼šé‡ç½®ä¹‹å‰è¢«watchçš„é”®ï¼Œè€Œæ˜¯æŒç»­å¢åŠ æ–°çš„è¢«watchçš„é”®ã€‚\n**UNWATCH**ä¼šä½¿å¾—å½“å‰è¢«watchçš„æ‰€æœ‰é”®ä¸å†è¢«ç›‘è§†ã€‚å¦‚æœå·²ç»åœ¨ **WATCH**ä¹‹åè°ƒç”¨äº† **EXEC**æˆ– DISCARDï¼Œå°±ä¸éœ€è¦å†æ¬¡æ‰‹åŠ¨è°ƒç”¨ **UNWATCH**äº†ï¼Œå› ä¸ºå®ƒä»¬ä¼šè‡ªåŠ¨unwatchã€‚\nå‚è€ƒèµ„æ–™  Transactions.  ","href":"/posts/redis/redis_transactions/","title":"Redisä¸­çš„äº‹åŠ¡"},{"content":"ä½œä¸ºRedis 5.0ä¸­æ¨å‡ºçš„å…¨æ–°æ•°æ®ç»“æ„ï¼Œstreamçš„è¡Œä¸ºå°±åƒappend-only logä¸€æ ·ï¼Œä½†å®ƒç”±åŸºæ•°æ ‘(radix tree)å®ç°ã€‚streamç”±entryæ„æˆã€‚å®ƒå…·æœ‰å¾ˆå¤šç‰¹æ€§ï¼šstreamçš„entryä¿å­˜äº†ä¸€ç»„field-valueå¯¹ï¼Œå’Œhashååˆ†ç±»ä¼¼ã€‚é™¤äº†field-valueå¯¹ï¼Œæ¯ä¸ªentryéƒ½å…·æœ‰å”¯ä¸€IDï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªIDçš„å½¢å¼ä¸ºï¼š\u0026lt;millisecond-timestamp\u0026gt;-\u0026lt;sequence number\u0026gt;ã€‚streamæ”¯æŒåŸºäºIDçš„èŒƒå›´æŸ¥è¯¢ï¼Œè‹¥å°†æ—¶é—´æˆ³ä½œä¸ºIDçš„å‰ç¼€ï¼Œä¾¿å¯ä»¥å®ç°åŸºäºæ—¶é—´çš„èŒƒå›´æŸ¥è¯¢ã€‚entryä¸€æ—¦è¢«åˆ›å»ºï¼Œå…¶å­˜å‚¨çš„å†…å®¹å°±ä¸èƒ½è¢«ä¿®æ”¹ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä»streamä¸­åˆ é™¤æŸä¸ªentryã€‚è‹¥è¦å‘streamä¸­æ·»åŠ entryï¼Œåªèƒ½é€šè¿‡åœ¨streamçš„æœ«å°¾è¿½åŠ è¿™ä¸ªentryçš„æ–¹å¼è¿›è¡Œã€‚æœ€åï¼ŒstreamåŒæ—¶æ”¯æŒé˜»å¡å’Œéé˜»å¡çš„æ¶ˆè´¹æ¨¡å¼ï¼Œå¯ä»¥è¢«å¤šä¸ªä¸åŒçš„æ¶ˆè´¹ç»„æ¶ˆè´¹æˆ–å¤„ç†ï¼Œè¿™äº›æ¶ˆè´¹ç»„ç›¸å½“äºstreamçš„è®¢é˜…è€…ã€‚streamå’ŒPub/Subæœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šstreamä¼šä¸ºäº†åç»­å®¢æˆ·ç«¯çš„æ¶ˆè´¹è€Œåœ¨å†…å­˜ä¸­ä¿å­˜æ•°æ®ï¼ŒPub/Subä¸ä¿å­˜ä»»ä½•æ¶ˆæ¯ã€‚\nStreamç”Ÿäº§è€… é€šå¸¸æƒ…å†µä¸‹ï¼Œproducerä»ä¸€ä¸ªæˆ–å¤šä¸ªæºè¯»å–æ•°æ®ï¼Œç„¶åå°†å®ƒä»¬å†™å…¥åˆ°streamã€‚\nRedis Streamçš„ç”Ÿäº§è€…API Redis Stream Producer APIå…è®¸producerå°†ä»»ä½•æ¶ˆæ¯(entry)è¿½åŠ åˆ°streamçš„æœ«å°¾ï¼Œæ•´ä¸ªAPIåªåŒ…å«ä¸€ä¸ªå‘½ä»¤â€”â€”XADD key ID field value [field value ...]ã€‚ **XADDå‘½ä»¤ç”¨äºå°†ä¸€ä¸ªentryè¿½åŠ åˆ°streamï¼Œå½“keyä¸å­˜åœ¨æ—¶ï¼Œè¿˜ä¼šæ–°å»ºä¸€ä¸ªstreamï¼šç¬¬ä¸€ä¸ªå‚æ•°keyä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„streamï¼ŒIDè¡¨ç¤ºæ¶ˆæ¯çš„IDï¼Œé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¼šä½¿ç”¨*æ¥å‘Šè¯‰Redisæˆ‘ä»¬å¸Œæœ›ç”±Redisæ¥ç”Ÿæˆè¿™ä¸ªIDï¼Œæ¥ä¸‹æ¥æ˜¯entryçš„å†…å®¹ã€‚XADD**ä¼šå°†æ–°åŠ å…¥streamçš„æ¶ˆæ¯çš„IDä½œä¸ºè¿”å›å€¼è¿”å›ã€‚\n\u0026gt; xadd numbers * n 0 \u0026quot;1587959118318-0\u0026quot; \u0026gt; xadd numbers * n 1 \u0026quot;1587959128680-0\u0026quot; \u0026gt; type numbers stream æ¶ˆæ¯ID IDæ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”æ¯ä¸ªæ¶ˆæ¯æœ‰ä¸”åªæœ‰ä¸€ä¸ªIDï¼Œå®ƒä»£è¡¨ç€æ¶ˆæ¯åœ¨streamä¸­çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šè¶Šæ¥è¿‘äºstreamå¼€å¤´çš„æ¶ˆæ¯çš„IDè¶Šå°ï¼Œè¶Šæ¥è¿‘äºstreamæœ«å°¾çš„æ¶ˆæ¯çš„IDè¶Šå¤§ã€‚æ¶ˆæ¯çš„IDæ˜¯ä¸å¯å˜çš„ï¼Œä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±ä¸èƒ½å†è¢«ä¿®æ”¹ã€‚\næˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªå‘½ä»¤çš„å‰é¢åŠ ä¸Šä¸€ä¸ªæ•°å­—ï¼Œç„¶åRedisä¼šå¤šæ¬¡æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚è¿™èƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„è§‚å¯ŸRedisè‡ªåŠ¨ç”Ÿæˆæ¶ˆæ¯IDçš„ç‰¹ç‚¹ï¼š\n\u0026gt; 7 xadd letter_number * a 1 \u0026quot;1587960623524-0\u0026quot; \u0026quot;1587960623525-0\u0026quot; \u0026quot;1587960623525-1\u0026quot; \u0026quot;1587960623526-0\u0026quot; \u0026quot;1587960623526-1\u0026quot; \u0026quot;1587960623527-0\u0026quot; \u0026quot;1587960623527-1\u0026quot; è¿™é‡Œé‡å¤æ‰§è¡Œäº†7æ¬¡xadd letter_number * a 1ã€‚Redisè‡ªåŠ¨ç”Ÿæˆçš„æ¶ˆæ¯IDçš„æ ¼å¼ä¸ºï¼š\u0026lt;millisecond-timestamp\u0026gt;-\u0026lt;sequence number\u0026gt;ã€‚å¯ä»¥å‘ç°ï¼šå½“timestampç›¸åŒæ—¶ï¼Œsequence numberä¼šä¸æ–­è‡ªå¢(å¤šä¸ªæ¶ˆæ¯å¯èƒ½ä¼šåœ¨åŒä¸€ä¸ªæ—¶é—´å‡ºç°ï¼Œç”¨è‡ªå¢ä¿è¯IDçš„å”¯ä¸€æ€§)ã€‚æ¯åˆ°ä¸€ä¸ªæ–°çš„æ—¶åˆ»ï¼Œsequence numberä¼šé‡ç½®ä¸º0ã€‚\nå®é™…ä¸Šï¼ŒIDåŒ…æ‹¬ä¸¤ä¸ªæ•°å­—(64ä½æ— ç¬¦å·æ•´æ•°)ï¼Œæ•°å­—ä¹‹é—´ç”¨-åˆ†éš”ã€‚IDæ˜¯æ€»æ˜¯è‡ªå¢çš„ï¼Œè¿™ä½“ç°åœ¨ç»„æˆIDçš„ä¸¤ä¸ªæ•°å­—çš„è‡ªå¢ä¸Šã€‚æ’å…¥ä¸€ä¸ªIDæ¯”å½“å‰streamä¸­æœ€å¤§entryçš„IDè¿˜å°çš„entryæ˜¯ä¸è¢«æ¥å—çš„ã€‚\n\u0026gt; xadd letter_number 1-1 a 1 (error) ERR The ID specified in XADD is equal or smaller than the target stream top item æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›ä½¿ç”¨è‡ªå·±çš„IDï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦ä¿è¯è‡ªå·±çš„IDæ˜¯è‡ªå¢çš„ï¼Œä¸€ä¸ªæœ‰æ•ˆçš„IDå¿…é¡»å¤§äº0-0ã€‚\n\u0026gt; xadd mystream 0-0 max 100 (error) ERR The ID specified in XADD must be greater than 0-0 \u0026gt; xadd mystream 0-1 max 100 \u0026quot;0-1\u0026quot; \u0026gt; xadd mystream 1-1 max 10 \u0026quot;1-1\u0026quot; æ’å…¥æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†IDæŒ‡å®šä¸ºä¸€ä¸ªæ•°å­—ï¼Œç§°ä¸ºpartial IDï¼Œè¿™ä¸ªæ—¶å€™Redisä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ·»åŠ sequence numberã€‚\n\u0026gt; xadd mystream 2 max 111 \u0026quot;2-0\u0026quot; // Redisè‡ªåŠ¨æ·»åŠ sequence number æ¶ˆæ¯å†…å®¹ **XADD**å‘½ä»¤ä¸æ¥æ”¶ç©ºæ¶ˆæ¯ï¼Œä¸€ä¸ªæ¶ˆæ¯è‡³å°‘åŒ…å«ä¸€ä¸ªfield-valueå¯¹ã€‚æ¯ä¸€ä¸ªfieldä¸Šçš„valueéƒ½æ˜¯ä¸€ä¸ªæ™®é€šçš„Rediså­—ç¬¦ä¸²ã€‚æ¶ˆæ¯çš„å†…å®¹å¯¹Redisæ¥è¯´æ—¶ä¸é€æ˜çš„ï¼ŒRedisæœ¬èº«ä¹Ÿä¸å¤„ç†æ¶ˆæ¯çš„å†…å®¹ã€‚\nç®¡ç†Streamçš„é•¿åº¦ **XLEN key**å¯ä»¥ç”¨æ¥æŸ¥çœ‹streamä¸­æ¶ˆæ¯(entry)çš„æ•°é‡ï¼Œè‹¥keyä¸å­˜åœ¨ï¼Œå°†è¿”å›0(å°±åƒstreamæ˜¯ç©ºçš„ä¸€æ ·)ã€‚\n\u0026gt; xlen ms-1 (integer) 0 \u0026gt; xadd ms-1 0-1 f1 v1 f2 v2 \u0026quot;0-1\u0026quot; \u0026gt; xadd ms-1 1-1 f1 v1 f2 v2 \u0026quot;1-1\u0026quot; \u0026gt; xlen ms-1 (integer) 2 **XDEL key ID [ID ...]**ç”¨æ¥ä»streamä¸­åˆ é™¤æ¶ˆæ¯ï¼Œè¿”å›å®é™…è¢«åˆ é™¤æ¶ˆæ¯çš„æ•°é‡ã€‚è™½ç„¶streamæ˜¯ä¸€ä¸ªappend-onlyçš„æ•°æ®ç»“æ„ï¼Œä½†å®ƒæ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰§è¡Œåˆ é™¤æ“ä½œã€‚å½“åˆ é™¤æŸä¸ªæ¶ˆæ¯æ—¶ï¼Œå¹¶ä¸æ˜¯çœŸæ­£åˆ é™¤ï¼Œè€Œæ˜¯æ ‡è®°åˆ é™¤ï¼Œå½“æ»¡è¶³ä¸€å®šæ¡ä»¶æ—¶ï¼Œæ‰ä¼šè¿›è¡ŒçœŸæ­£çš„åˆ é™¤æ“ä½œã€‚å³ä½¿streamä¸­çš„æ‰€æœ‰æ¶ˆæ¯éƒ½è¢«åˆ é™¤ï¼Œstreamä¸ºç©ºæ—¶ï¼Œstreamæœ¬èº«ä¹Ÿä¸ä¼šè¢«åˆ é™¤ï¼Œè¦åˆ é™¤å®ƒï¼Œå¯ä»¥ä½¿ç”¨ **DEL**æˆ– UNLINKã€‚\n\u0026gt; xdel ms-1 0-1 1-1 (integer) 2 \u0026gt; xlen ms-1 (integer) 0 \u0026gt; exists ms-1 (integer) 1 \u0026gt; del ms-1 (integer) 0 ä½¿ç”¨ **XDEL**å¯ä»¥é™åˆ¶streamçš„é•¿åº¦ï¼Œä½†æˆ‘ä»¬éœ€è¦çŸ¥é“æ¶ˆæ¯çš„IDã€‚ä¸ºäº†é˜²æ­¢streamæ— é™æ‰©å¤§ï¼ŒRedisä¹Ÿå…è®¸æˆ‘ä»¬å¯¹streamè¿›è¡Œä¿®å‰ª(trim)ï¼Œå³é™åˆ¶streamé•¿åº¦çš„ä¸Šé™ã€‚ **XTRIM key MAXLEN [~] countå°†streamçš„é•¿åº¦é™åˆ¶ä¸ºcountï¼Œå½“streamé•¿åº¦è¶…è¿‡ä¸Šé™ï¼ŒXTRIM**ä¼šå¼€å§‹åˆ é™¤streamä¸­IDæœ€å°çš„æ¶ˆæ¯ã€‚ç„¶è€Œï¼Œä½¿ç”¨MAXLENå¯¹streamè¿›è¡Œä¿®å»ºçš„å¼€é”€éå¸¸å¤§ï¼Œè¿™å’Œentryåº•å±‚çš„åŸºæ•°æ ‘(radix tree)ä¸­é‡‡ç”¨çš„å®ç»“ç‚¹(macro node)æœ‰å…³ç³»ã€‚å‘½ä»¤æä¾›äº†ä¸€ä¸ªå¯é€‰å‚æ•°~ï¼ŒXTRIM mystream MAXLEN ~ 1000è¡¨ç¤ºï¼šå¹¶ä¸æ˜¯çœŸçš„ä¸èƒ½è¶…è¿‡1000ï¼Œæ¶ˆæ¯çš„æ•°é‡å¯ä»¥æ“ä½œ1000ä¸”è‡³å°‘æ˜¯1000ã€‚å½“Redisç§»é™¤æ•´ä¸ªå®ç»“ç‚¹æ—¶æ‰ä¼šè¿›è¡Œä¿®å‰ªæ“ä½œã€‚\n\u0026gt; xadd ms-2 0-1 f1 v1 \u0026quot;0-1\u0026quot; \u0026gt; xadd ms-2 0-2 f1 v1 \u0026quot;0-2\u0026quot; \u0026gt; xadd ms-2 0-3 f1 v1 \u0026quot;0-3\u0026quot; \u0026gt; xtrim ms-2 MAXLEN 2 (integer) 1 // æœ‰ä¸€ä¸ªentryè¢«åˆ é™¤ \u0026gt; xlen ms-2 (integer) 2 å¦‚æœéœ€è¦ä¸€ç›´é™åˆ¶streamçš„é•¿åº¦ï¼Œé™¤äº†å‘¨æœŸæ€§çš„æ‰‹åŠ¨è°ƒç”¨ XTRIMï¼Œè¿˜å¯ä»¥åˆ©ç”¨ **XADD**æä¾›çš„MAXLENæ¥åœ¨æˆ‘ä»¬æ·»åŠ entryæ—¶è‡ªåŠ¨ä¿®å‰ªstreanï¼Œä¾‹å¦‚ï¼šxadd ms-3 maxlen ~ 2 * f1 v1ã€‚\nèŒƒå›´æŸ¥è¯¢ **XRANGE key start end [COUNT count]**æŸ¥è¯¢IDåœ¨[start, end]ä¹‹é—´çš„æ‰€æœ‰entryã€‚\n\u0026gt; 10 xadd ms-3 * f1 v1 // ç”Ÿæˆ10æ¡æ¶ˆæ¯ \u0026quot;1587969310313-0\u0026quot; \u0026quot;1587969310313-1\u0026quot; \u0026quot;1587969310314-0\u0026quot; \u0026quot;1587969310314-1\u0026quot; \u0026quot;1587969310314-2\u0026quot; \u0026quot;1587969310315-0\u0026quot; \u0026quot;1587969310315-1\u0026quot; \u0026quot;1587969310316-0\u0026quot; \u0026quot;1587969310316-1\u0026quot; \u0026quot;1587969310316-2\u0026quot; \u0026gt; xrange ms-3 1587969310313-0 1587969310313-1 1) 1) \u0026quot;1587969310313-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 2) 1) \u0026quot;1587969310313-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; -å’Œ+è¡¨ç¤ºstreamå¯èƒ½å­˜åœ¨çš„æœ€å°IDå’Œæœ€å¤§IDï¼Œ-ç­‰ä»·äº0-0ï¼Œ+ç­‰ä»·äº18446744073709551615-18446744073709551615ã€‚\n\u0026gt; xrange ms-3 - + // ä½¿ç”¨-å’Œ+ 1) 1) \u0026quot;1587969310313-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 2) 1) \u0026quot;1587969310313-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 3) 1) \u0026quot;1587969310314-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 4) 1) \u0026quot;1587969310314-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 5) 1) \u0026quot;1587969310314-2\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 6) 1) \u0026quot;1587969310315-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 7) 1) \u0026quot;1587969310315-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 8) 1) \u0026quot;1587969310316-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 9) 1) \u0026quot;1587969310316-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 10) 1) \u0026quot;1587969310316-2\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨partial IDã€‚ä¾‹å¦‚ï¼š\n\u0026gt; xrange ms-3 1587969310313 1587969310314 1) 1) \u0026quot;1587969310313-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 2) 1) \u0026quot;1587969310313-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 3) 1) \u0026quot;1587969310314-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 4) 1) \u0026quot;1587969310314-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 5) 1) \u0026quot;1587969310314-2\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; å¯é€‰å‚æ•°countå¯ä»¥é™åˆ¶è¿”å›ç»“æœæ•°é‡çš„ä¸Šé™ï¼š\n\u0026gt; xrange ms-3 1587969310313 1587969310314 count 1 1) 1) \u0026quot;1587969310313-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; è¿­ä»£Stream ç»“åˆIDè‡ªå¢çš„ç‰¹æ€§å’Œ **XRANGE**çš„countå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å®Œæˆå¯¹æ•´ä¸ªstreamçš„è¿­ä»£ã€‚é¦–å…ˆï¼š\n\u0026gt; xrange ms-3 - + count 2 1) 1) \u0026quot;1587969310313-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 2) 1) \u0026quot;1587969310313-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; ç„¶åå°†å½“å‰è¿­ä»£è¿”å›çš„æœ€åä¸€ä¸ªIDçš„sequence numberåŠ ä¸€ï¼Œä½œä¸ºä¸‹ä¸€æ¬¡è¿­ä»£çš„èµ·å§‹IDï¼š\n\u0026gt; xrange ms-3 1587969310313-1 + count 2 1) 1) \u0026quot;1587969310313-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 2) 1) \u0026quot;1587969310314-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; é‡å¤è¿™ä¸ªè¿‡ç¨‹å³å¯ã€‚ä»¥ä¸Šæ¼”ç¤ºçš„æ˜¯IDä»å°åˆ°å¤§çš„æ­£å‘è¿­ä»£è¿‡ç¨‹ï¼Œè‹¥è¦ä»å¤§åˆ°å°è¿›è¡Œåå‘è¿­ä»£ï¼Œå¯ä»¥ä½¿ç”¨ XREVRANGE key end start [COUNT count]ã€‚\næŸ¥è¯¢å•æ¡æ¶ˆæ¯ å¦‚æœåªéœ€è¦æŸ¥è¯¢å•æ¡æ¶ˆæ¯ï¼Œå¯ä»¥å°†countå‚æ•°è®¾ä¸º1ã€‚\n\u0026gt; xrange ms-3 1587969310313-0 + count 1 1) 1) \u0026quot;1587969310313-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; å› ä¸º **XRANGE**å’Œ **XREVRANGE**é‡‡ç”¨çš„æ˜¯é—­åŒºé—´ï¼Œæ‰€ä»¥å½“startå’Œendç›¸åŒæ—¶ï¼ŒæŸ¥è¯¢çš„ç»“æœå°±æ˜¯å•æ¡æ¶ˆæ¯ã€‚\n\u0026gt; xrange ms-3 1587969310313-0 1587969310313-0 1) 1) \u0026quot;1587969310313-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; \u0026gt; xrevrange ms-3 1587969310313-0 1587969310313-0 1) 1) \u0026quot;1587969310313-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; æ¶ˆè´¹è€… æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›ä¸»åŠ¨å»æŸ¥è¯¢streamï¼Œè€Œæ˜¯å¸Œæœ›å½“streamä¸­æœ‰æ–°çš„æ¶ˆæ¯æ—¶ï¼Œæ–°çš„æ¶ˆæ¯å¯ä»¥ç›´æ¥æ¨é€ç»™æˆ‘ä»¬ï¼Œä¹Ÿå°±æ˜¯è®¢é˜…streamã€‚**XREAD [COUNT count] [BLOCK milliseconds] STREAMS key [key ...] id [id ...]**æ­£æ˜¯ç”¨æ¥ç›‘å¬streamä¸­æ–°çš„æ¶ˆæ¯çš„ã€‚ä¾‹å¦‚ï¼š\n\u0026gt; xread count 1 streams ms-3 0 1) 1) \u0026quot;ms-3\u0026quot; 2) 1) 1) \u0026quot;1587969310313-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; **XREAD**ä¸æ”¯æŒ-å’Œ+ï¼Œidè¡¨ç¤ºæ¶ˆè´¹è€…ä¸Šä¸€æ¬¡æ”¶åˆ°çš„æ¶ˆæ¯IDï¼Œæ‰€ä»¥è¿”å›çš„æ¶ˆæ¯IDéƒ½ä¼šå¤§äºidã€‚\n\u0026gt; xread count 1 streams ms-3 1587969310313-0 1) 1) \u0026quot;ms-3\u0026quot; 2) 1) 1) \u0026quot;1587969310313-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; é˜»å¡å‹æ¶ˆè´¹è€… é»˜è®¤æƒ…å†µä¸‹ï¼Œ**XREAD**æ˜¯éé˜»å¡çš„ã€‚é€šè¿‡ä½¿ç”¨å¯é€‰çš„[BLOCK] millisecondså‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°† **XREADå˜æˆé˜»å¡æ“ä½œã€‚åœ¨æ¶ˆæ¯åˆ°æ¥ä¹‹å‰ï¼ŒXREAD**ä¼šåœ¨æ–°æ¶ˆæ¯åˆ°æ¥ä¹‹å‰é˜»å¡é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œè‹¥åœ¨è¶…æ—¶ä¹‹å‰æœ‰æ–°çš„æ¶ˆæ¯åˆ°æ¥ï¼Œåˆ™ç»“æŸé˜»å¡å¹¶è¿”å›æ–°çš„æ¶ˆæ¯ï¼Œå¦åˆ™è¶…æ—¶è‡ªåŠ¨è¿”å›ã€‚\n\u0026gt; xrevrange ms-3 + - count 2 // è·å–æœ€æ–°çš„ä¸¤æ¡æ¶ˆæ¯ 1) 1) \u0026quot;1587969310316-2\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; 2) 1) \u0026quot;1587969310316-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; \u0026gt; xread count 1 block 1000 streams ms-3 1587969310316-1 // å› ä¸ºæœ‰æ¶ˆæ¯ï¼Œç›´æ¥è¿”å› 1) 1) \u0026quot;ms-3\u0026quot; 2) 1) 1) \u0026quot;1587969310316-2\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; \u0026gt; xread count 1 block 1000 streams ms-3 1587969310316-2 // æ²¡æœ‰æ–°çš„æ¶ˆæ¯ï¼Œé˜»å¡ï¼Œè¶…æ—¶è¿”å› (nil) (1.03s) BLOCK 0è¡¨ç¤ºæ–°æ¶ˆæ¯åˆ°æ¥ä¹‹å‰ä¸€ç›´é˜»å¡ï¼Œä¸ä¼šè¶…æ—¶è¿”å›ã€‚åœ¨client-2ä¸Šé˜»å¡ï¼Œ$è¡¨ç¤ºå½“å‰streamä¸­æœ€æ–°æ¶ˆæ¯çš„ID(ä½¿ç”¨$ä¹‹åï¼Œæ¯ä¸ªæ¶ˆæ¯æœ€å¤šæ”¶åˆ°ä¸€æ¬¡)ï¼Œæ‰€ä»¥client-2ä¼šä¸€ç›´é˜»å¡ï¼š\nclient-2:6379\u0026gt; xread count 1 block 0 streams ms-3 $ è¿™ä¸ªæ—¶å€™åœ¨client-1ä¸Šå‘ms-3ä¸­å†™å…¥ä¸€æ¡æ¶ˆæ¯ï¼š\nclient-1:6379\u0026gt; xadd ms-3 * f1 v1 \u0026quot;1587974321051-0\u0026quot; client-2æ”¶åˆ°æ¶ˆæ¯ï¼Œç»“æŸé˜»å¡ï¼Œè¿”å›ï¼š\nclient-2:6379\u0026gt; xread count 1 block 0 streams ms-3 $ 1) 1) \u0026quot;ms-3\u0026quot; 2) 1) 1) \u0026quot;1587974321051-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; (23.59s) æ¶ˆè´¹ç»„ **XREAD**å¯ä»¥è®©å¤šä¸ªæ¶ˆè´¹è€…éƒ½è·å–åˆ°streamä¸­çš„æ‰€æœ‰æ¶ˆæ¯ã€‚å°†æ‰€æœ‰çš„æ¶ˆæ¯åŒæ—¶åˆ†å‘ç»™å¤šä¸ªæ¶ˆè´¹è€…æœ‰æ—¶å€™å¹¶ä¸èƒ½æé«˜æ•ˆç‡ï¼Œå› ä¸ºå¤šä¸ªæ¶ˆè´¹è€…å¯èƒ½åšç€é‡å¤çš„å·¥ä½œï¼Œè€Œæˆ‘ä»¬åªéœ€è¦ä¸€ä»½ç»“æœã€‚ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å¤„ç†æ–¹å¼æ˜¯ï¼šå°†streamä¸­çš„æ¶ˆæ¯åˆ’åˆ†ä¸ºå¤šä¸ªå½¼æ­¤ä¸é‡å çš„å­é›†ï¼Œç„¶åå°†ä¸åŒçš„å­é›†åˆ†å‘ç»™ä¸åŒæ¶ˆè´¹è€…å¤„ç†ã€‚ä¸ºäº†å¤„ç†ä¸€ä¸ªå¤§çš„ä»»åŠ¡ï¼Œå¤šä¸ªç‰©ç†æ¶ˆè´¹è€…å¯ä»¥è”åˆèµ·æ¥ï¼Œæ¯ä¸ªç‰©ç†æ¶ˆè´¹è€…å¤„ç†ä¸åŒçš„éƒ¨åˆ†ï¼Œå¤–ç•Œçœ‹èµ·æ¥å°±åƒåªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ä¸€æ ·ï¼Œè¿™æ ·ï¼Œå¤šä¸ªç‰©ç†æ¶ˆè´¹è€…æ„æˆäº†ä¸€ä¸ªé€»è¾‘æ¶ˆè´¹è€…ï¼Œå¤–ç•Œçœ‹åˆ°çš„æ­£æ˜¯è¿™ä¸ªé€»è¾‘æ¶ˆè´¹è€…ã€‚åœ¨Redisé‡Œï¼Œè¿™ä¸ªé€»è¾‘æ¶ˆè´¹è€…å°±æ˜¯ä¸€ä¸ªæ¶ˆè´¹ç»„(Consumer Group)ï¼Œç‰©ç†æ¶ˆè´¹è€…å¯ä»¥æ ¹æ®å®é™…éœ€è¦åŠ å…¥æˆ–è€…ç¦»å¼€é€»è¾‘æ¶ˆè´¹è€…ï¼Œé€»è¾‘æ¶ˆè´¹è€…ä»streamä¸­è·å–æ•°æ®ï¼Œæ•°æ®ç”±å¤šä¸ªç‰©ç†æ¶ˆè´¹è€…è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”ï¼š\n åŒä¸€ä¸ªæ¶ˆæ¯ä¸ä¼šè¢«åˆ†å‘ç»™å¤šä¸ªæ¶ˆè´¹è€… æ¶ˆè´¹ç»„ä¸­çš„æ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½é€šè¿‡åå­—å”¯ä¸€è¯†åˆ«ï¼Œåå­—æ˜¯ä¸€ä¸ªå¤§å°å†™æ•æ„Ÿçš„å­—ç¬¦ä¸² æ¯ä¸ªæ¶ˆè´¹ç»„éƒ½æœ‰first ID never consumedçš„æ¦‚å¿µï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“ä¸€ä¸ªæ¶ˆè´¹è€…è¯·æ±‚æ–°çš„æ¶ˆæ¯æ—¶ï¼Œå®ƒå¯ä»¥æä¾›ä»æœªè¢«äº¤ä»˜è¿‡çš„æ¶ˆæ¯ ä½¿ç”¨ç‰¹å®šçš„å‘½ä»¤ä½œä¸ºæŸä¸ªæ¶ˆæ¯å·²ç»è¢«æ­£ç¡®å¤„ç†çš„ç¡®è®¤ï¼Œæ­¤åè¯¥æ¶ˆæ¯å¯ä»¥è¢«ç§»å‡ºæ¶ˆè´¹ç»„äº† æ¶ˆè´¹ç»„è¿½è¸ªæ¯ä¸ªå½“å‰è¢«åˆ†å‘ç»™æŸä¸ªæ¶ˆè´¹è€…ä½†è¿˜æœªæ”¶åˆ°å¤„ç†å®Œæˆçš„ç¡®è®¤çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯çš„è¿™ç§çŠ¶æ€è¢«ç§°ä¸ºpendingã€‚Redisä½¿ç”¨Pending Entries List (PEL)æ¥è¿½è¸ªè¿™äº›æ¶ˆæ¯  **XGROUP [CREATE key groupname id-or-$] [SETID key groupname id-or-$] [DESTROY key groupname] [DELCONSUMER key groupname consumername]**æ˜¯ä¸€ä¸ªç”¨æ¥ç®¡ç†å’Œkeyä¸Šstreamç›¸å…³è”çš„æ¶ˆè´¹ç»„çš„å‘½ä»¤ã€‚\nåˆ›å»ºæ¶ˆè´¹ç»„ è¦åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹ç»„ï¼Œå¯ä»¥ä½¿ç”¨ **XGROUP CREATE key groupname id-or $**å­å‘½ä»¤ã€‚æœ€åä¸€ä¸ªå‚æ•°id-or-$æ˜¯æ¶ˆè´¹ç»„å¼€å§‹æ¶ˆè´¹çš„æ¶ˆæ¯çš„ID(ä¸åŒ…æ‹¬è¿™ä¸ªIDä»£è¡¨çš„æ¶ˆæ¯)ã€‚å¦‚æœå¸Œæœ›æ¶ˆè´¹ç»„ä»ä¸‹ä¸€ä¸ªæœ€æ–°çš„æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ï¼Œå¯ä»¥ä½¿ç”¨$ï¼Œ$è¡¨ç¤ºstreamä¸­çš„æœ€åä¸€ä¸ªæ¶ˆæ¯çš„IDã€‚å¦‚æœå¸Œæœ›æ¶ˆè´¹ç»„æ¶ˆè´¹streamä¸­çš„æ‰€æœ‰æ¶ˆæ¯ï¼Œå¯ä»¥ä½¿ç”¨0ä½œä¸ºä¼ å…¥IDã€‚å¦‚æœæ¶ˆè´¹ç»„å·²ç»å­˜åœ¨ï¼Œå‘½ä»¤å°†æ”¾å›ä¸€ä¸ª-BUSYGROUPé”™è¯¯ï¼Œå¦åˆ™åˆ›å»ºæˆåŠŸå¹¶è¿”å›OKã€‚\nå¦‚æœstreamä¸å­˜åœ¨ï¼Œå‘½ä»¤ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œå¯ä»¥åœ¨IDåé¢æ–°å¢ä¸€ä¸ªå¯é€‰MKSTREAMå­å‘½ä»¤è®©Redisè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªstreamï¼Œè¿™ä¸ªæ—¶å€™åˆ›å»ºå‡ºæ¥çš„streamçš„é•¿åº¦ä¸º0ã€‚\n\u0026gt; xgroup create ms-4 group0 0 // ms-4ä¸å­˜åœ¨ (error) ERR The XGROUP subcommand requires the key to exist. Note that for CREATE you may want to use the MKSTREAM option to create an empty stream automatically. \u0026gt; xgroup create ms-4 group0 0 MKSTREAM // åˆ›å»ºgroup0ï¼Œå¹¶è®©Redisè‡ªåŠ¨åˆ›å»ºå‡ºstream OK \u0026gt; exists ms-4 (integer) 1 \u0026gt; xadd ms-4 0-1 f1 v1 // æ·»åŠ ä¸€æ¡æ¶ˆæ¯åˆ°ms-4 \u0026quot;0-1\u0026quot; \u0026gt; xgroup create ms-4 group1 $ // åˆ›å»ºgroup1 OK \u0026gt; xadd ms-4 1-1 f1 v1 \u0026quot;1-1\u0026quot; \u0026gt; xinfo groups ms-4 1) 1) \u0026quot;name\u0026quot; 2) \u0026quot;group0\u0026quot; 3) \u0026quot;consumers\u0026quot; 4) (integer) 0 5) \u0026quot;pending\u0026quot; 6) (integer) 0 7) \u0026quot;last-delivered-id\u0026quot; 8) \u0026quot;0-0\u0026quot; 2) 1) \u0026quot;name\u0026quot; 2) \u0026quot;group1\u0026quot; 3) \u0026quot;consumers\u0026quot; 4) (integer) 0 5) \u0026quot;pending\u0026quot; 6) (integer) 0 7) \u0026quot;last-delivered-id\u0026quot; 8) \u0026quot;0-1\u0026quot; æ¯ä¸ªæ¶ˆè´¹ç»„éƒ½ä¸ä¸€ä¸ªstreamä»¥åŠæœ€è¿‘äº¤ä»˜çš„æ¶ˆæ¯ID(å³ä¸Šé¢çš„last-delivered-id)ç›¸å…³è”ã€‚\næ·»åŠ æ¶ˆè´¹è€…åˆ°æ¶ˆè´¹ç»„ **XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] ID [ID ...]**æ˜¯ **XREAD**çš„ä¸€ä¸ªç‰¹æ®Šç‰ˆæœ¬ï¼Œå®ƒæ”¯æŒConsumer Groupã€‚STREAMSé€‰é¡¹çš„IDå¯ä»¥æ˜¯ä»¥ä¸‹ä¸¤ç§å½¢å¼ï¼š\n \u0026gt;ã€‚\u0026gt;æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„IDï¼Œè¡¨ç¤ºæ¶ˆè´¹è€…åªæƒ³æ¥æ”¶é‚£äº›ä»æœªè¢«äº¤ä»˜ç»™ä»»ä½•å…¶ä»–æ¶ˆè´¹è€…çš„æ¶ˆæ¯ï¼Œå³æ¶ˆè´¹è€…æƒ³æ”¶åˆ°ä¸€ä¸ªä»æœªè¢«äº¤ä»˜è¿‡çš„æ¶ˆæ¯ ä»»ä½•å…¶å®ƒçš„IDï¼Œå³0ï¼Œå…¶å®ƒæœ‰æ•ˆIDæˆ–partial IDã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ¶ˆè´¹è€…çš„PEL(è¿”å›çš„PELä¸­çš„IDæ¯”ä¼ é€’çš„IDéƒ½è¦å¤§)ï¼Œè€ŒBLOCKå’ŒNOACKå‚æ•°ä¼šè¢«å¿½ç•¥ã€‚  \u0026gt; xreadgroup group group0 consumerA count 1 block 1000 streams ms-4 \u0026gt; 1) 1) \u0026quot;ms-4\u0026quot; 2) 1) 1) \u0026quot;0-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; \u0026gt; xreadgroup group group0 consumerA streams ms-4 0 // æŸ¥çœ‹consumerAçš„PEL 1) 1) \u0026quot;ms-4\u0026quot; 2) 1) 1) 0-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; ä¸Šé¢è¿™æ¡å‘½ä»¤è®©æ¶ˆè´¹è€…consumerAåŠ å…¥åˆ°äº†group0ä¸­å¹¶æ¶ˆè´¹äº†ä¸€æ¡æ¶ˆæ¯ã€‚å¦‚æœè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†æ¬¡æ‰§è¡Œxinfo groups ms-4ï¼Œä¼šå¾—åˆ°å’Œä¸Šä¸€æ¬¡ä¸åŒçš„ç»“æœï¼š\n\u0026gt; xinfo groups ms-4 1) 1) \u0026quot;name\u0026quot; 2) \u0026quot;group0\u0026quot; 3) \u0026quot;consumers\u0026quot; 4) (integer) 1 5) \u0026quot;pending\u0026quot; 6) (integer) 1 7) \u0026quot;last-delivered-id\u0026quot; // 0-1å·²è¢«group0ä¸­çš„consumerAæ¶ˆè´¹ 8) \u0026quot;0-1\u0026quot; 2) 1) \u0026quot;name\u0026quot; 2) \u0026quot;group1\u0026quot; 3) \u0026quot;consumers\u0026quot; 4) (integer) 0 5) \u0026quot;pending\u0026quot; 6) (integer) 0 7) \u0026quot;last-delivered-id\u0026quot; 8) \u0026quot;0-1\u0026quot; è‹¥è¦æŸ¥çœ‹æŸä¸ªæ¶ˆè´¹ç»„ä¸­çš„æ¶ˆè´¹è€…ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ XINFO CONSUMERS \u0026lt;key\u0026gt; \u0026lt;group\u0026gt;ï¼š\n\u0026gt; xinfo consumers ms-4 group0 1) 1) \u0026quot;name\u0026quot; 2) \u0026quot;comsumerA\u0026quot; 3) \u0026quot;pending\u0026quot; 4) (integer) 1 5) \u0026quot;idle\u0026quot; 6) (integer) 905911 æ¶ˆæ¯å¤„ç†å®Œæˆç¡®è®¤ **XACK key group ID [ID ...]**ä»æ¶ˆè´¹ç»„çš„PELç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯ï¼Œè¡¨ç¤ºä»–ä»¬å·²è¢«æˆåŠŸå¤„ç†ã€‚å‡è®¾group0ä¸­çš„consumerAå·²ç»å°†0-1è¿™æ¡æ¶ˆæ¯å¤„ç†å®Œæˆï¼Œå®ƒéœ€è¦å‘ŠçŸ¥RedisæœåŠ¡å™¨å®ƒå·²ç»è¿™æ¡æ¶ˆæ¯å¤„ç†å®Œæ¯•ï¼š\n\u0026gt; xack ms-4 group0 0-1 // å‘é€ç¡®è®¤ (integer) 1 \u0026gt; xreadgroup group group0 consumerA streams ms-4 0 // æŸ¥çœ‹consumerAçš„PEL 1) 1) \u0026quot;ms-4\u0026quot; 2) (empty list or set) å½“æ¶ˆæ¯å¤„ç†å¤±è´¥æ—¶ï¼Œæ²¡æœ‰ **XACK**ç¡®è®¤ï¼Œæ¶ˆè´¹è€…å¯ä»¥å†æ¬¡è¿›è¡Œæ¶ˆè´¹ã€‚æœ‰æ—¶å€™ï¼Œå½“å¤±è´¥åœ¨å¯æ¥å—èŒƒå›´å†…æ—¶ï¼Œæˆ‘ä¹ˆå¯ä»¥ä½¿ç”¨ **XREADGROUP**ä¸­çš„å­å‘½ä»¤ **NOACK**æ¥å‘Šè¯‰Redisä¸éœ€è¦è¿›è¡Œç¡®è®¤ï¼ŒRedisä¼šè®¤ä¸º **XREADGROUP**è¿”å›çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å·²ç¡®è®¤ï¼Œå› æ­¤ä¸ç”¨å†ç»´æŠ¤å¯¹åº”çš„PELã€‚\nç®¡ç†æ¶ˆè´¹ç»„ å…ˆå‡†å¤‡ä¸€äº›æµ‹è¯•æ•°æ®ï¼Œåˆ›å»º3ä¸ªæ¶ˆè´¹ç»„ï¼Œå®ƒä»¬éƒ½ä»æœ€æ–°çš„æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ï¼š\n\u0026gt; xgroup create ms-5 group0 $ MKSTREAM OK \u0026gt; xgroup create ms-5 group1 $ OK \u0026gt; xgroup create ms-5 group3 $ OK å‘ms-5ä¸­å†™å…¥7æ¡æ¶ˆæ¯ï¼š\n\u0026gt; 7 xadd ms-5 * f1 v1 \u0026quot;1587991174542-0\u0026quot; \u0026quot;1587991174542-1\u0026quot; \u0026quot;1587991174542-2\u0026quot; \u0026quot;1587991174543-0\u0026quot; \u0026quot;1587991174543-1\u0026quot; \u0026quot;1587991174543-2\u0026quot; \u0026quot;1587991174544-0\u0026quot; ä¿®æ”¹æ¶ˆè´¹è€…çš„ä½ç½® **XGROUP SETID key groupname id-or-$**å…è®¸æˆ‘ä»¬ä¿®æ”¹æ¶ˆè´¹ç»„çš„last-delivered-idçš„å€¼ï¼Œè¿›è€Œæ”¹å˜æ¥ä¸‹æ¥è¦æ¶ˆè´¹çš„æ¶ˆæ¯(å³æ¶ˆè´¹è€…çš„ä½ç½®)ã€‚è‹¥è¦é‡æ–°æ¶ˆè´¹æ‰€æœ‰æ¶ˆæ¯ï¼Œå¯ä»¥ä½¿ç”¨ï¼š\n\u0026gt; xgroup setid ms-5 group1 0 OK è‹¥ç°åœ¨æŒ‡å‘æ¶ˆè´¹æœ€æ–°çš„æ¶ˆæ¯ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ï¼š\n\u0026gt; xgroup setid ms-5 group1 $ OK åˆ é™¤æ¶ˆè´¹ç»„ å› ä¸ºå¹¶ä¸ä¼šè‡ªåŠ¨åˆ é™¤æœªä½¿ç”¨çš„æ¶ˆè´¹ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±æ¥åšè¿™ä»¶äº‹æƒ…ã€‚**XGROUP DESTROY key groupname**ä¼šæ°¸ä¹…åˆ é™¤æŸä¸ªæ¶ˆè´¹ç»„å’Œç›¸å…³çš„æ¶ˆè´¹è€…ã€‚\n\u0026gt; xgroup destroy ms-5 group3 // åˆ é™¤group3 (integer) 1 ä»æ¶ˆè´¹ç»„åˆ é™¤æ¶ˆè´¹è€… **XGROUP DELCONSUMER key groupname consumername**å‘½ä»¤ç”¨äºä»æ¶ˆè´¹ç»„é‡Œé¢åˆ é™¤æ¶ˆè´¹è€…ï¼Œå®ƒè¿˜ä¼šåˆ é™¤æ¶ˆè´¹è€…å¯¹åº”çš„PELï¼Œè¿”å›å€¼ä¸ºè¢«åˆ æ¶ˆè´¹çš„çš„PELä¸­çš„æ¶ˆæ¯æ•°é‡ã€‚\n\u0026gt; xreadgroup group group0 consumerA count 1 block 1000 streams ms-5 \u0026gt; 1) 1) \u0026quot;ms-5\u0026quot; 2) 1) 1) \u0026quot;1587991174542-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; \u0026gt; xreadgroup group group0 consumerB count 1 block 1000 streams ms-5 \u0026gt; 1) 1) \u0026quot;ms-5\u0026quot; 2) 1) 1) \u0026quot;1587991174542-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; \u0026gt; xinfo consumers ms-5 group0 // æŸ¥çœ‹group0ä¸­çš„æ¶ˆè´¹è€… 1) 1) \u0026quot;name\u0026quot; 2) \u0026quot;consumerA\u0026quot; 3) \u0026quot;pending\u0026quot; 4) (integer) 1 5) \u0026quot;idle\u0026quot; 6) (integer) 88581 2) 1) \u0026quot;name\u0026quot; 2) \u0026quot;consumerB\u0026quot; 3) \u0026quot;pending\u0026quot; 4) (integer) 1 5) \u0026quot;idle\u0026quot; 6) (integer) 79710 \u0026gt; xgroup delconsumer ms-5 group0 consumerB // åˆ é™¤group0ä¸­çš„consumerB (integer) 1 \u0026gt; xinfo consumers ms-5 group0 1) 1) \u0026quot;name\u0026quot; 2) \u0026quot;consumerA\u0026quot; 3) \u0026quot;pending\u0026quot; 4) (integer) 1 5) \u0026quot;idle\u0026quot; 6) (integer) 1540978 åœ¨åˆ é™¤æ¶ˆè´¹è€…çš„æ—¶å€™ä¸€å®šè¦æ¶ˆæ¯ï¼Œå› ä¸ºå®ƒå¯èƒ½è¿˜æœ‰æœªç¡®è®¤çš„æ¶ˆæ¯(PELä¸ä¸ºç©º)ã€‚\næ¶ˆè´¹å¤±è´¥é—®é¢˜ ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‰€æœ‰äº¤ä»˜çš„æ¶ˆæ¯éƒ½ä¼šè¢«ç¡®è®¤(XACK)ã€‚ä½†æ˜¯æœ‰æ—¶å€™ï¼Œæ¶ˆè´¹è€…å¯èƒ½åœ¨å‘å‡º **XACK**ä¹‹å‰å°±å·²ç»ä¸‹çº¿äº†ï¼Œè¿™ä¸ªæ—¶å€™æœªç¡®è®¤çš„æ¶ˆæ¯å°±ä¼šä¸€ç›´ç•™åœ¨PELä¸­ã€‚\næŸ¥çœ‹æœªç¡®è®¤çš„æ¶ˆæ¯ æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æŸ¥çœ‹æœªç¡®è®¤çš„æ¶ˆæ¯ï¼š**XINFO CONSUMERS key group**å’Œ XPENDING key group [start end count] [consumer]ã€‚\nå…ˆå‡†å¤‡æµ‹è¯•æ•°æ®ï¼Œåˆ›å»ºæ¶ˆè´¹ç»„group0å¹¶å‘ms-6ä¸­å†™å…¥5æ¡æ¶ˆæ¯ï¼Œç„¶åæ·»åŠ æ¶ˆè´¹è€…consumerAï¼š\n\u0026gt; xgroup create ms-6 group0 0 MKSTREAM OK \u0026gt; 5 xadd ms-6 * f1 v1 \u0026quot;1587996240331-0\u0026quot; \u0026quot;1587996240331-1\u0026quot; \u0026quot;1587996240332-0\u0026quot; \u0026quot;1587996240332-1\u0026quot; \u0026quot;1587996240333-0\u0026quot; \u0026gt; xreadgroup group group0 consumerA count 1 block 1000 streams ms-6 \u0026gt; 1) 1) \u0026quot;ms-6\u0026quot; 2) 1) 1) \u0026quot;1587996240331-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; æŸ¥çœ‹æ¶ˆæ¯ç¡®è®¤çŠ¶æ€ï¼š\n\u0026gt; xinfo consumers ms-6 group0 1) 1) \u0026quot;name\u0026quot; 2) \u0026quot;consumerA\u0026quot; 3) \u0026quot;pending\u0026quot; 4) (integer) 1 5) \u0026quot;idle\u0026quot; 6) (integer) 44813 \u0026gt; xpending ms-6 group0 1) (integer) 1 2) \u0026quot;1587996240331-0\u0026quot; 3) \u0026quot;1587996240331-0\u0026quot; 4) 1) 1) \u0026quot;consumerA\u0026quot; 2) \u0026quot;1\u0026quot; ç»“æœæ˜¾ç¤ºconsumerAæ¶ˆè´¹çš„ä¸€æ¡æ¶ˆæ¯è¿˜æœªç¡®è®¤ã€‚\næ›´æ¢æ¶ˆè´¹è€… å‡è®¾consumerAåœ¨å‘é€ç¡®è®¤æ¶ˆæ¯ä¹‹å‰ä¸‹çº¿äº†ï¼Œä¸ºäº†ç»§ç»­å¤„ç†consumerAåœ¨ä¸‹çº¿å‰æœªå¤„ç†å®Œçš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **XCLAIM key group consumer min-idle-time ID [ID ...] [IDLE ms] [TIME ms-unix-time] [RETRYCOUNT count] [FORCE] [JUSTID]**å‘½ä»¤è®©å¦ä¸€ä¸ªæ¶ˆè´¹è€…è·å¾—æœªå¤„ç†å®Œçš„æ¶ˆæ¯å¹¶ç»§ç»­å¤„ç†ã€‚\nå…ˆåˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…consumerBï¼š\n\u0026gt; xreadgroup group group0 consumerB count 1 block 1000 streams ms-6 \u0026gt; 1) 1) \u0026quot;ms-6\u0026quot; 2) 1) 1) \u0026quot;1587996240331-1\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; \u0026gt; xack ms-6 group0 1587996240331-1 (integer) 1 \u0026gt; xreadgroup group group0 consumerB streams ms-6 0 1) 1) \u0026quot;ms-6\u0026quot; 2) (empty list or set) // consumerBçš„æ¶ˆæ¯éƒ½å·²ç»å¤„ç†å®Œå¹¶ç¡®è®¤ å°†consumerAæœªå¤„ç†å®Œçš„æ¶ˆæ¯1587996240331-0è½¬äº¤ç»™consumerBï¼š\n\u0026gt; xclaim ms-6 group0 consumerB 1000 1587996240331-0 1) 1) \u0026quot;1587996240331-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; æŸ¥çœ‹consumerAå’ŒconsumerBçš„PELï¼š\n\u0026gt; xreadgroup group group0 consumerA streams ms-6 0 1) 1) \u0026quot;ms-6\u0026quot; 2) (empty list or set) \u0026gt; xreadgroup group group0 consumerB streams ms-6 0 1) 1) \u0026quot;ms-6\u0026quot; 2) 1) 1) \u0026quot;1587996240331-0\u0026quot; 2) 1) \u0026quot;f1\u0026quot; 2) \u0026quot;v1\u0026quot; å¦‚æœæˆ‘ä»¬è¿è¡Œ XPENDINGï¼Œä¹Ÿå¯ä»¥å‘ç°æ¶ˆæ¯1587996240331-0ç°åœ¨å½’consumerBæ‰€æœ‰ï¼š\n\u0026gt; xpending ms-6 group0 1) (integer) 1 2) \u0026quot;1587996240331-0\u0026quot; 3) \u0026quot;1587996240331-0\u0026quot; 4) 1) 1) \u0026quot;consumerB\u0026quot; 2) \u0026quot;1\u0026quot; å‚è€ƒèµ„æ–™  Introduction to Redis Streams.  ","href":"/posts/redis/redis_streams/","title":"Redis Streams"},{"content":"Redisçš„é”®æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åœ¨Redisä¸­ï¼Œå­—ç¬¦ä¸²äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šRedisä¸­çš„å­—ç¬¦ä¸²å¯ä»¥æ˜¯ä»»ä½•äºŒè¿›åˆ¶åºåˆ—ï¼Œå³å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„æ•°æ®(æ¯”å¦‚ï¼šä¸€å¼ å›¾ç‰‡ã€ä¸€ä¸ªåºåˆ—åŒ–åçš„Javaå¯¹è±¡â€¦â€¦)ã€‚åƒ2ã€2.3ã€0xffã€ç©ºå­—ç¬¦ä¸²(\u0026quot;\u0026quot;)ç­‰ä»»ä½•äºŒè¿›åˆ¶åºåˆ—éƒ½å¯ä»¥ä½œä¸ºRedisä¸­çš„é”®ã€‚ç”±äºé”®æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶åºåˆ—ï¼Œæ‰€ä»¥é”®æ˜¯åŒºåˆ†å¤§å°å†™çš„(aå’ŒAæ˜¯ä¸¤ä¸ªä¸åŒçš„é”®)ã€‚å½“å‰ç‰ˆæœ¬çš„Redisçš„é”®æœ€å¤§æ”¯æŒåˆ°512MB(æœªæ¥è¿™ä¸ªå€¼å¯èƒ½è¿˜ä¼šæ›´å¤§)ã€‚è¿‡å¤§çš„é”®ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ï¼Œå› æ­¤é€‰æ‹©åˆé€‚çš„é”®å¾ˆé‡è¦ã€‚\né€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ç»“æ„è‰¯å¥½ä¸”æœ‰æ„ä¹‰çš„é”®åï¼Œä½¿ç”¨å†’å·(:)ä½œä¸ºåˆ†éš”ç¬¦ã€‚ä¾‹å¦‚ï¼šusers:1000:friendsã€‚\né€»è¾‘æ•°æ®åº“ Redisä¸­ä¹Ÿæœ‰æ•°æ®åº“(database)çš„æ¦‚å¿µï¼Œåªæ˜¯æ˜¯ä»¥å‘½åç©ºé—´(namespacing)çš„å½¢å¼ä½“ç°çš„ã€‚åœ¨æ¯ä¸€ä¸ªé€»è¾‘æ•°æ®åº“(logical database)å†…ï¼Œéƒ½å­˜åœ¨ä¸€ä¸ªé”®ç©ºé—´(key space)ã€‚é€»è¾‘æ•°æ®åº“é€šè¿‡ä¸‹æ ‡(ä»0å¼€å§‹)è¿›è¡ŒåŒºåˆ†ã€‚ä¸€ä¸ªé€»è¾‘æ•°æ®åº“å†…çš„é”®åéƒ½æ˜¯å”¯ä¸€çš„ï¼Œä½†åŒä¸€ä¸ªé”®åå¯ä»¥å‡ºç°åœ¨å¤šä¸ªä¸åŒçš„é€»è¾‘æ•°æ®åº“ä¸­ï¼Œé€»è¾‘æ•°æ®åº“çš„ä¸€ä¸ªä½œç”¨å°±æ˜¯å¯¹é”®åè¿›è¡Œéš”ç¦»ã€‚\né€»è¾‘æ•°æ®åº“çš„æ•°é‡ä¹Ÿæ˜¯æœ‰é™åˆ¶çš„ï¼ŒRedisé›†ç¾¤åªæ”¯æŒdatabase 0ã€‚\nè·å–æ‰€æœ‰é”®å æœ‰ä¸¤ä¸ªå‘½ä»¤å¯ä»¥è·å–Redisæ•°æ®åº“å†…æ‰€æœ‰çš„é”®åï¼Œ**KEYS pattern**å’Œ SCAN cursor [MATCH pattern] [COUNT count]ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸¤ä¸ªå‘½ä»¤æ¥è¿­ä»£æ•°æ®åº“å†…æ‰€æœ‰çš„é”®ï¼Œä¹Ÿå¯ä»¥åªè·å–æ»¡è¶³ç»™å®šæ¨¡å¼çš„é”®ã€‚\nKEYSå‘½ä»¤ä¼šä¸€æ¬¡æ€§è¿­ä»£å®Œæ‰€æœ‰çš„é”®ï¼Œåœ¨è¿­ä»£å®Œæ‰€æœ‰çš„é”®ä¹‹å‰ï¼Œä¼šé˜»å¡æ‰€æœ‰å…¶å®ƒçš„æ“ä½œã€‚è‹¥æ•°æ®åº“å†…é”®çš„æ•°é‡éå¸¸å¤§ï¼Œæ‰§è¡Œè¿™ä¸ªå‘½ä»¤åˆ™ä¼šå¾ˆè€—æ—¶ï¼Œå› æ­¤åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ—¶è¦è°¨æ…ï¼Œç”±äº **KYES**çš„ä½¿ç”¨æ¯” **SCAN**è¦ç®€å•ï¼Œå› æ­¤å®ƒåœ¨è°ƒè¯•æ—¶è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚\nSCANå‘½ä»¤ä¹Ÿä¼šé˜»å¡ï¼Œä½†å®ƒé‡‡å–çš„æ˜¯å¢é‡è¿­ä»£çš„æ–¹å¼ï¼Œä¸€æ¬¡åªè¿­ä»£å°‘é‡çš„é”®ï¼Œé˜»å¡æ—¶é—´ä¸ä¼šè¿‡é•¿ï¼Œå› æ­¤åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å®ƒæ˜¯å®‰å…¨çš„ã€‚\nåˆ é™¤é”® æœ‰å¤šç§æ–¹å¼å¯ä»¥åˆ é™¤é”®ï¼Œæ¯ç§æ–¹å¼éƒ½èƒ½ä¿è¯åˆ é™¤æˆåŠŸï¼Œä½†ä¸åŒæ–¹å¼çš„æ€§èƒ½ä¸åŒã€‚\nDEL key [key ...]å‘½ä»¤ä¼šåˆ é™¤ç»™å®šçš„é”®å¹¶å›æ”¶ä¸é”®ç›¸å…³è”çš„å†…å­˜ï¼Œè¿™ä¸ªåˆ é™¤æ“ä½œæ˜¯ä»¥é˜»å¡æ–¹å¼è¿›è¡Œçš„ã€‚**UNLINK key [key ...]**å‘½ä»¤å’Œ DELå‘½ä»¤ç±»ä¼¼ï¼Œä½†å®ƒä¼šä½¿ç”¨å•ç‹¬çš„åå°çº¿ç¨‹æ¥å›æ”¶å†…å­˜ï¼Œå› æ­¤æ˜¯éé˜»å¡çš„ã€‚\næ£€æŸ¥é”®çš„å­˜åœ¨æ€§ å½“æˆ‘ä»¬æ‰§è¡Œ **SETå‘½ä»¤æ—¶ï¼Œè‹¥é”®ä¸å­˜åœ¨ï¼Œå°†ä¼šåˆ›å»ºé”®å¹¶è®¾ç½®å€¼ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›åªæœ‰å½“æŸä¸€ä¸ªé”®å­˜åœ¨æ—¶ï¼Œæ‰ç»™å®ƒè®¾ç½®å€¼ã€‚EXISTS key [key ...]**å‘½ä»¤å¯ä»¥æ£€æµ‹ç»™å®šçš„é”®æ˜¯å¦å­˜åœ¨ï¼Œè‹¥é”®å­˜åœ¨ï¼Œåˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚\né”®è¿‡æœŸ æˆ‘ä»¬å¯ä»¥ä¸ºæŸä¸ªkeyè®¾ç½®è¿‡æœŸæ—¶é—´(expires)ã€‚å½“è¾¾åˆ°è®¾ç½®çš„è¿‡æœŸæ—¶é—´æ—¶ï¼Œå¯¹åº”çš„keyå°±ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œå°±åƒæˆ‘ä»¬æ˜¾å¼çš„æ‰§è¡Œ DEL å‘½ä»¤ä¸€æ ·ã€‚è¿‡æœŸæ—¶é—´çš„å•ä½å¯ä»¥æ˜¯ç§’ï¼Œä¹Ÿå¯ä»¥æ˜¯æ¯«ç§’ï¼Œè¿˜å¯ä»¥æ˜¯UNIXæ—¶é—´æˆ³ã€‚å…³äºexpiresçš„ä¿¡æ¯éƒ½å­˜æ”¾åœ¨ç£ç›˜ä¸Šï¼Œä¸”æœ‰å¤‡ä»½ã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿RedisæœåŠ¡å™¨åœæ­¢è¿è¡Œï¼Œè¿‡æœŸæ—¶é—´ä»ç„¶ä¼šæœ‰æ•ˆã€‚å®é™…ä¸Šï¼ŒRedisä¿å­˜çš„æ˜¯keyè¿‡æœŸçš„ç¡®åˆ‡æ—¶é—´ï¼Œè€Œä¸æ˜¯å‰©ä½™ç”Ÿå­˜æ—¶é—´ï¼Œè™½ç„¶å‚æ•°å¯ä»¥æ˜¯ç§’æˆ–æ¯«ç§’ã€‚\næœ‰ä¸‰ç§ç±»å‹çš„å‘½ä»¤å¯ä»¥ç®¡ç†é”®çš„è¿‡æœŸæ—¶é—´ï¼š\n è®¾ç½®è¿‡æœŸæ—¶é—´ï¼šEXPIRE(å•ä½ä¸ºç§’)ã€PEXPIRE(å•ä½ä¸ºæ¯«ç§’)ã€EXPIREAT(å•ä½ä¸ºç§’)ã€PEXPIREAT(å•ä½ä¸ºæ¯«ç§’) æŸ¥çœ‹å‰©ä½™è¿‡æœŸæ—¶é•¿ï¼šTTL(å•ä½ä¸ºç§’)ã€PTTL(å•ä½ä¸ºæ¯«ç§’) ç§»é™¤è¿‡æœŸæ—¶é—´ï¼šPERSIST  ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š\n\u0026gt; set s1 v1 OK \u0026gt; expire s1 10 // è®¾ç½®s1äº10ç§’åè¿‡æœŸ 1 \u0026gt; ttl s1 // æŸ¥çœ‹s1çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´(å•ä½ä¸ºç§’) 7 \u0026gt; pttl s1 // æŸ¥çœ‹s1çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´(å•ä½ä¸ºæ¯«ç§’) 3042 \u0026gt; get s1 // æŸ¥çœ‹s1çš„å€¼ï¼Œæœªç»è¿‡10ç§’ \u0026quot;v1\u0026quot; \u0026gt; get s1 // æŸ¥çœ‹s1çš„å€¼ï¼Œè¶…è¿‡10ç§’ï¼Œs1å·²è¢«åˆ é™¤ (nil) \u0026gt; set s2 v2 ex 10 // åœ¨è®¾ç½®å€¼çš„åŒæ—¶æŒ‡å®šè¿‡æœŸæ—¶é—´ä¸º10ç§’ OK \u0026gt; set s3 v3 px 10000 // åœ¨è®¾ç½®å€¼çš„åŒæ—¶æŒ‡å®šè¿‡æœŸæ—¶é—´ä¸º10000æ¯«ç§’ OK æ•°æ®ç±»å‹ Redisæ”¯æŒå¤šç§æ•°æ®ç»“æ„(ç±»å‹)ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **TYPE key**å‘½ä»¤æ¥æŸ¥çœ‹keyå¯¹åº”çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ï¼š\n\u0026gt; set key1 1 OK \u0026gt; rpush key2 a 1 \u0026gt; type key1 string \u0026gt; type key2 list **OBJECT subcommand [arguments [arguments ...]]**å…è®¸æˆ‘ä»¬æŸ¥çœ‹æŸä¸ªé”®å¯¹åº”çš„Rediså¯¹è±¡çš„å†…éƒ¨ä¿¡æ¯ã€‚æ”¯æŒçš„subcommandæœ‰ï¼š\n OBJECT REFCOUNT \u0026lt;key\u0026gt;ï¼šè¿”å›keyå¯¹åº”çš„å€¼çš„å¼•ç”¨æ•° OBJECT ENCODING \u0026lt;key\u0026gt;ï¼šè¿”å›keyå¯¹åº”çš„å€¼åœ¨Rediså†…éƒ¨å­˜å‚¨çš„å­˜å‚¨å½¢å¼ OBJECT IDLETIME \u0026lt;key\u0026gt;ï¼šè¿”å›keyå¯¹åº”çš„å€¼æœ‰å¤šä¹…æ²¡æœ‰è¢«è¯»/å†™äº†ï¼Œå•ä½ä¸ºç§’ OBJECT FREQ \u0026lt;key\u0026gt;ï¼šè¿”å›keyå¯¹åº”çš„å€¼è¢«è®¿é—®é¢‘ç‡çš„å¯¹æ•°å€¼ OBJECT HELPï¼šè¿”å›ç®€çŸ­çš„å¸®åŠ©ä¿¡æ¯  Redisä¸­çš„å¯¹è±¡åœ¨Rediså†…éƒ¨å¯ä»¥è¢«å­˜å‚¨ä¸ºå¤šç§å½¢å¼ï¼š\n Stringå¯ä»¥è¢«ç¼–ç æˆraw(æ™®é€šå­—ç¬¦ä¸²)å’Œint(64ä½æœ‰ç¬¦å·æ•´æ•°ä¼šè¢«è¿™ä¹ˆå­˜å‚¨ä»¥èŠ‚çœç©ºé—´) Listå¯ä»¥è¢«ç¼–ç æˆziplist(ç”¨äºå°å‹listï¼Œå¯ä»¥èŠ‚çœç©ºé—´)å’Œlinkedlist Setå¯ä»¥è¢«ç¼–ç æˆintset(ç”¨äºåªç”±æ•´æ•°ç»„æˆçš„å°å‹é›†åˆ)å’Œhashtable Hashå¯ä»¥è¢«ç¼–ç æˆziplist(ç”¨äºå°å‹hash)å’Œhashtable Sorted Setå¯ä»¥è¢«ç¼–ç æˆziplist(ç”¨äºå°å‹sorted set)å’Œskiplist  å½“Redisæ— æ³•ç»§ç»­ç»´æŒä¸ºèŠ‚çœç©ºé—´è€Œæ˜¯ç”¨çš„ç¼–ç æ ¼å¼æ—¶ï¼Œéƒ½ä¼šå°†ç¼–ç æ ¼å¼è½¬ä¸ºå„ç§ç±»å‹å¯¹åº”çš„é€šç”¨æ ¼å¼ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•æŸ¥çœ‹æ•°æ®çš„ç¼–ç æ ¼å¼ï¼š\n\u0026gt; set foo 1 OK \u0026gt; object encoding foo \u0026quot;int\u0026quot; \u0026gt; append foo a (integer) 2 \u0026gt; object encoding foo \u0026quot;raw\u0026quot; Strings å­—ç¬¦ä¸²(string)æ˜¯Redisä¸­æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå®ƒä¸ä»…å¯ä»¥å­˜å‚¨æ–‡æœ¬æ•°æ®ï¼Œè¿˜å¯ä»¥å­˜å‚¨æ•´æ•°ã€æµ®ç‚¹æ•°å’ŒäºŒè¿›åˆ¶æ•°æ®ã€‚stringæ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œæœ€å¤§ä¸èƒ½è¶…è¿‡512MBã€‚\nRedisæä¾›äº†20å¤šä¸ªæ“ä½œstringç±»å‹çš„å‘½ä»¤ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š\n\u0026gt; set s1 \u0026quot;Hello, Redis\u0026quot; // è®¾ç½®s1çš„å€¼ä¸º\u0026quot;Hello, Redis\u0026quot; OK // æˆåŠŸè¿”å›OK \u0026gt; get s1 // è·å–å€¼ \u0026quot;Hello, Redis\u0026quot; \u0026gt; setnx s1 \u0026quot;Redis\u0026quot; // å°è¯•ä¸ºs1è®¾ç½®æ–°å€¼ (integer) 0 // s1å·²æœ‰å€¼ï¼Œä¸è¿›è¡Œæ“ä½œï¼Œè¿”å›0 \u0026gt; set s1 2 // è®¾ç½®å€¼ OK \u0026gt; get s1 \u0026quot;2\u0026quot; \u0026gt; incr s1 // åŠ 1 (integer) 3 \u0026gt; incrby s1 10 // åŠ 10 (integer) 13 \u0026gt; decr s1 // å‡1 (integer) 12 \u0026gt; decrby s1 5 // å‡5 (integer) 7 \u0026gt; incrbyfloat s1 1.1 // åŠ 1.1 \u0026quot;8.09999999999999964\u0026quot; \u0026gt; incrbyfloat s1 -3.1 // å‡3.1 \u0026quot;5\u0026quot; SET å’Œ GET åˆ†åˆ«ç”¨æ¥è®¾ç½®å’Œæ£€ç´¢keyå¯¹åº”çš„å€¼(è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²)ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæŸä¸ªkeyå·²ç»æœ‰å¯¹åº”çš„å€¼ï¼ŒSET å‘½ä»¤ä¼šè¦†ç›–æ‰å·²æœ‰çš„å€¼(ä¸ç®¡ä¹‹å‰çš„å€¼æ˜¯ä½•ç§ç±»å‹éƒ½ä¼šè¢«è¦†ç›–)ï¼Œå’Œè¿™ä¸ªkeyå…³è”çš„TTLä¹Ÿä¼šè¢«ä¸¢å¼ƒã€‚å¦‚æœä¸å¸Œæœ›å·²æœ‰keyçš„å€¼è¢«è¦†ç›–ï¼Œå¯ä»¥ä½¿ç”¨ SETNX å‘½ä»¤ï¼Œå½“keyå­˜åœ¨æ—¶ï¼ŒSETNX ä¸ä¼šè¿›è¡Œä»»ä½•æ“ä½œã€‚\nè™½ç„¶å€¼æ˜¯stringï¼Œä½†å¦‚æœè¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªæ•°å­—çš„å­—ç¬¦ä¸²å½¢å¼çš„è¯ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡ŒåŠ å‡æ“ä½œã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œs1çš„å€¼è¢«é‡æ–°ä¿®æ”¹ä¸ºäº†\u0026quot;2\u0026quot;ï¼Œéšåæ‰§è¡Œäº† INCR å’Œ INCRBY ä¸¤ä¸ªåŠ æ³•å‘½ä»¤ï¼Œå€¼å˜æˆäº†13ï¼Œä¹‹åçš„å‡æ³•å‘½ä»¤ DECR å’Œ DECRBY å°†å€¼å‡åˆ°äº†7ã€‚æ›´åŠ æœ‰è¶£çš„æ˜¯ï¼ŒRedisè¿˜æä¾›äº† INCRBYFLOAT ä»¥æ”¯æŒæµ®ç‚¹åŠ å‡è¿ç®—ã€‚\næœ‰æ—¶å€™ï¼Œä¸€æ¬¡æ€§è®¾ç½®æˆ–è·å–å¤šä¸ªå€¼æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ï¼Œè¿™å¯ä»¥é€šè¿‡ MSET key value [key value ...] å’Œ MGET key [key ...] å‘½ä»¤å®ç°ã€‚ç±»ä¼¼çš„è¿˜æœ‰ MSETNX å‘½ä»¤ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\n\u0026gt; mset s1 1 s2 2 s3 a OK \u0026gt; mget s1 s2 s3 1) \u0026quot;1\u0026quot; 2) \u0026quot;2\u0026quot; 3) \u0026quot;a\u0026quot; Lists åœ¨Redisä¸­ï¼Œåˆ—è¡¨(list)è¡¨ç¤ºç”±ä¸€ç³»åˆ—å…ƒç´ ç»„æˆçš„æœ‰åºåºåˆ—ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒListçš„å®ç°æœ‰æ•°ç»„å’Œé“¾è¡¨ä¸¤ç§æ–¹å¼ï¼Œä¸¤è€…å„æœ‰ä¼˜åŠ£ã€‚æ•°ç»„å®ç°çš„Listå¯ä»¥é€šè¿‡ç´¢å¼•å¿«é€Ÿè®¿é—®å…ƒç´ ï¼Œä½†åœ¨æ’å…¥æˆ–åˆ é™¤å…ƒç´ çš„æ—¶å€™è¾ƒæ…¢ï¼›é“¾è¡¨å®ç°çš„Liståœ¨æ’å…¥æˆ–åˆ é™¤å…ƒç´ æ—¶éå¸¸è¿…é€Ÿï¼Œä½†è®¿é—®å…ƒç´ æ—¶è¾ƒæ…¢ã€‚Redisä¸­çš„listä½¿ç”¨åŒå‘é“¾è¡¨å®ç°ï¼Œæ”¯æŒåŒå‘æ“ä½œã€‚åŸºäºé“¾è¡¨çš„å®ç°è¿˜å¸¦æ¥äº†ä¸€ä¸ªé‡å¤§ä¼˜åŠ¿ï¼Œé‚£å°±æ˜¯å¯ä»¥å¿«é€Ÿçš„æˆªå–åˆ—è¡¨ä¸­çš„æŸä¸€éƒ¨åˆ†ã€‚\nRedisæä¾›äº†10å¤šä¸ªæ“ä½œlistçš„å‘½ä»¤ï¼Œä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š\n\u0026gt; lpush list1 a 1 b // å‘åˆ—è¡¨list1çš„å¤´éƒ¨ä¾æ¬¡æ’å…¥aã€1ã€bè¿™ä¸‰ä¸ªå…ƒç´  (integer) 3 // æˆåŠŸæ’å…¥ï¼Œå½“å‰åˆ—è¡¨list1å«æœ‰3ä¸ªå…ƒç´  \u0026gt; lrange list1 0 -1 // æŸ¥çœ‹list1ä¸­çš„æ‰€æœ‰å…ƒç´  1) \u0026quot;b\u0026quot; 2) \u0026quot;1\u0026quot; 3) \u0026quot;a\u0026quot; \u0026gt; llen list1 // è·å–list1çš„é•¿åº¦ (integer) 3 \u0026gt; rpush list1 c d // å‘åˆ—è¡¨list1å°¾éƒ¨ä¾æ¬¡æ’å…¥cã€dè¿™ä¸¤ä¸ªå…ƒç´  (integer) 5 // æ’å…¥æˆåŠŸï¼Œå½“å‰åˆ—è¡¨list1å«æœ‰5ä¸ªå…ƒç´  \u0026gt; lrange list1 0 -1 1) \u0026quot;b\u0026quot; 2) \u0026quot;1\u0026quot; 3) \u0026quot;a\u0026quot; 4) \u0026quot;c\u0026quot; 5) \u0026quot;d\u0026quot; \u0026gt; lpop list1 // ç§»é™¤å¹¶è¿”å›åˆ—è¡¨list1ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´  \u0026quot;b\u0026quot; \u0026gt; rpop list1 // ç§»é™¤å¹¶è¿”å›åˆ—è¡¨list2ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´  \u0026quot;d\u0026quot; \u0026gt; lrange list2 0 -1 // åˆ—è¡¨list2æ˜¯ç©ºçš„ (empty list or set) \u0026gt; lpop list2 // ä»ä¸€ä¸ªç©ºçš„åˆ—è¡¨é‡Œé¢ç§»é™¤å…ƒç´ ä¼šè¿”å›NULL (nil) \u0026gt; rpop list2 (nil) \u0026gt; lrange list1 0 -1 1) \u0026quot;1\u0026quot; 2) \u0026quot;a\u0026quot; 3) \u0026quot;c\u0026quot; \u0026gt; lindex list1 0 // æŸ¥çœ‹åˆ—è¡¨list1ä¸­å¤„äºä½ç½®0å¤„çš„å…ƒç´  1 \u0026gt; lindex list1 -1 // æŸ¥çœ‹åˆ—è¡¨list1ä¸­æœ€åä¸€ä¸ªå…ƒç´  \u0026quot;c\u0026quot; \u0026gt; ltrim list1 1 2 // ä¿®å‰ªåˆ—è¡¨list1ï¼Œåªä¿ç•™ä½äºåŒºé—´[1,2]ä¸­çš„å…ƒç´  OK \u0026gt; lrange list1 0 -1 // æŸ¥çœ‹list1ä¸­æ‰€æœ‰å…ƒç´  1) \u0026quot;a\u0026quot; 2) \u0026quot;c\u0026quot; å‘½ä»¤ LPUSH key value [value ...] å’Œ RPUSH key value [value ...] åˆ†åˆ«ç”¨æ¥å‘åˆ—è¡¨å¤´éƒ¨(å·¦ä¾§)å’Œå°¾éƒ¨(å³ä¾§)æ·»åŠ å…ƒç´ ï¼ŒLPOP key å’Œ RPOP key åˆ†åˆ«ç”¨æ¥ä»åˆ—è¡¨å¤´éƒ¨(å·¦ä¾§)å’Œå°¾éƒ¨(å³ä¾§)ç§»é™¤å…ƒç´ ã€‚åœ¨ä¸€ä¸ªç©ºçš„åˆ—è¡¨ä¸Šæ‰§è¡Œ LPOP æˆ– RPOP å°†è¿”å› NULL ã€‚\nè‹¥è¦æŸ¥çœ‹åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ LRANGE key start stop å‘½ä»¤ï¼ŒLRANGE å‘½ä»¤éœ€è¦ä¸¤ä¸ªç´¢å¼•ä½œä¸ºå‚æ•°ã€‚è¿™ä¸¤ä¸ªç´¢å¼•å½¢æˆä¸€ä¸ªåŒºé—´ï¼Œåˆ†åˆ«æŒ‡å‘å¾…è¿”å›çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®ã€‚ç´¢å¼•å¯ä»¥æ˜¯è´Ÿæ•°ï¼Œ0ã€-1ã€-2åˆ†åˆ«ä»£è¡¨é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªã€æœ€åä¸€ä¸ªå’Œå€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ã€‚é™¤äº†åŒºé—´æŸ¥çœ‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ LINDEX key index å‘½ä»¤æŸ¥çœ‹æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚\nLLEN key ç”¨äºæŸ¥çœ‹listçš„é•¿åº¦ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿ç•™åˆ—è¡¨ä¸­çš„æŸä¸€éƒ¨åˆ†ï¼Œè¿™ä¸ªæ—¶å€™ LTRIM key start end å°±å¯ä»¥æ’ä¸Šç”¨åœºäº†ï¼Œå®ƒå’Œ LRANGE ç±»ä¼¼ï¼Œä¹Ÿæ¥æ”¶ä¸¤ä¸ªç´¢å¼•ä½œä¸ºå‚æ•°ï¼Œä½†å®ƒå°†åˆ—è¡¨çš„å†…å®¹è®¾ç½®ä¸ºåŒºé—´å†…çš„å…ƒç´ å¹¶å»é™¤åŒºé—´å¤–çš„æ‰€æœ‰å…ƒç´ ã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒLTRIM å‘Šè¯‰Redisåªä¿ç•™åˆ—è¡¨list1å¤„äºåŒºé—´[1,2]ä¸­çš„å…ƒç´ ï¼Œç„¶åä¸¢å¼ƒå…¶å®ƒçš„å…ƒç´ ã€‚\næœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›åªæœ‰å½“åˆ—è¡¨ä¸­æœ‰å…ƒç´ æ—¶ï¼Œæ‰æ‰§è¡ŒPOPæ“ä½œï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨ BLPOP key [key ...] timeout å’Œ BRPOP key [key ...] timeout ã€‚ä¸¤ä¸ªå‘½ä»¤çš„éƒ½æ˜¯ä»åˆ—è¡¨ä¸­ç§»é™¤å…ƒç´ ï¼Œåªæ˜¯æ–¹å‘ä¸ä¸€æ ·ã€‚ä»¥ BLPOP ä¸ºä¾‹ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæˆ–å¤šä¸ªkeyä»¥åŠä¸€ä¸ªè¶…æ—¶æ—¶é—´timeout(å¯é˜»å¡æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œ0ä»£è¡¨ä¸€ç›´é˜»å¡)ã€‚åœ¨è¿™äº›keyä¸­ï¼Œå¦‚æœæœ‰keyå¯¹åº”çš„åˆ—è¡¨ä¸ä¸ºç©ºï¼Œå°†ä¼šè¿”å›ç¬¬ä¸€ä¸ªéç©ºåˆ—è¡¨çš„keyåŠPOPå‡ºçš„å€¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼š\n\u0026gt; lrange list1 0 -1 // åˆ—è¡¨list1åŒ…å«ä¸¤ä¸ªå…ƒç´  1) \u0026quot;a\u0026quot; 2) \u0026quot;c\u0026quot; \u0026gt; lrange list2 0 -1 // åˆ—è¡¨list2ä¸ºç©º (empty list or set) \u0026gt; blpop list2 list1 0 // list1ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ è¢«ç§»é™¤ 1) \u0026quot;list1\u0026quot; 2) \u0026quot;a\u0026quot; BLPOP ä¾æ¬¡æ£€æŸ¥list2å’Œlist1ï¼Œç„¶åç§»é™¤å¹¶è¿”å›list1çš„å¤´éƒ¨å…ƒç´ (list2æ˜¯ä¸€ä¸ªç©ºåˆ—è¡¨)ã€‚\nå¦‚æœ BLPOP å‘½ä»¤åé¢ç»™å‡ºçš„çš„keyå¯¹åº”çš„éƒ½æ˜¯ç©ºåˆ—è¡¨ï¼ŒBLPOP å°±ä¼šé˜»å¡å½“å‰è¿æ¥ã€‚ä¸€æ—¦å¦å¤–ä¸€ä¸ªå®¢æˆ·ç«¯å‘æŸä¸€ä¸ªkeyå¯¹åº”çš„åˆ—è¡¨æ’å…¥å…ƒç´ ï¼ŒBLPOP å°±ä¼šè§£é™¤é˜»å¡å¹¶è¿”å›ã€‚è‹¥é˜»å¡çš„æ—¶é—´è¶…è¿‡äº†timeoutï¼Œå°†è¿”å›NULLã€‚\nHashes Redisä¸­çš„å“ˆå¸Œè¡¨(hash)æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„field-valueæ˜ å°„è¡¨(fieldå’Œvalueçš„ç±»å‹å‡æ˜¯string)ï¼Œä¸æ”¯æŒå¤šçº§åµŒå¥—ï¼Œéå¸¸é€‚åˆè¡¨ç¤ºå¯¹è±¡ã€‚\nä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š\n\u0026gt; hset user:1 name Tome // å°†å“ˆå¸Œè¡¨user:1çš„nameå­—æ®µçš„å€¼è®¾ç½®ä¸ºTome (integer) 1 \u0026gt; hget user:1 name // è·å–å“ˆå¸Œè¡¨user:1ä¸­nameå­—æ®µå¯¹åº”çš„å€¼ \u0026quot;Tome\u0026quot; \u0026gt; hmset user:2 name Bob age 20 education barchelor // ä¸€æ¬¡å‘å“ˆå¸Œè¡¨user:2ä¸­æ’å…¥å¤šä¸ªfiled-value OK \u0026gt; hmget user:2 name age // è·å–å“ˆå¸Œè¡¨user:2ä¸­nameå’Œageå­—æ®µå¯¹åº”çš„å€¼ 1) \u0026quot;Bob\u0026quot; 2) \u0026quot;20\u0026quot; \u0026gt; hgetall user:2 // è·å–å“ˆå¸Œè¡¨user:2ä¸­æ‰€æœ‰å­—æ®µå’Œå€¼ 1) \u0026quot;name\u0026quot; 2) \u0026quot;Bob\u0026quot; 3) \u0026quot;age\u0026quot; 4) \u0026quot;20\u0026quot; 5) \u0026quot;education\u0026quot; 6) \u0026quot;barchelor\u0026quot; \u0026gt; hget user:1 age // ä¼å›¾è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„å­—æ®µå¯¹åº”çš„å€¼ï¼Œä¼šè¿”å›NULL (nil) \u0026gt; hexists user:1 age // æ£€æŸ¥å“ˆå¸Œè¡¨user:1ä¸­æ˜¯å¦å­˜åœ¨å­—æ®µage (integer) 0 \u0026gt; hvals user:2 // è¿”å›å“ˆå¸Œè¡¨user:2ä¸­æ‰€æœ‰çš„å€¼ 1) \u0026quot;Bob\u0026quot; 2) \u0026quot;20\u0026quot; 3) \u0026quot;barchelor\u0026quot; \u0026gt; hincrby user:2 age 2 // å°†å“ˆå¸Œè¡¨user:2çš„ageå­—æ®µå¯¹åº”çš„å€¼åŠ 2 (integer) 22 \u0026gt; hget user:2 age \u0026quot;22\u0026quot; Sets Redisä¸­çš„é›†åˆ(set)æ˜¯ä¸€ä¸ªç”±å­—ç¬¦ä¸²æ„æˆçš„æ— åºé›†åˆï¼Œé›†åˆä¸­ä¸å­˜åœ¨é‡å¤å…ƒç´ ã€‚é™¤äº†åŸºæœ¬çš„æ’å…¥ã€åˆ é™¤ã€å­˜åœ¨æ€§æ£€æµ‹ç­‰æ“ä½œï¼ŒRedisè¿˜æ”¯æŒé›†åˆçš„äº¤ã€å¹¶ã€å·®è®¡ç®—ã€‚\nä¸‹é¢æ˜¯åŸºæœ¬æ“ä½œçš„ä¸€äº›ä¾‹å­ï¼š\n\u0026gt; sadd colors red blue white black // å‘é›†åˆcolorsä¸­æ’å…¥4ä¸ªå…ƒç´  (integer) 4 \u0026gt; smembers colors // æŸ¥çœ‹é›†åˆcolorså†…å®¹ 1) \u0026quot;blue\u0026quot; 2) \u0026quot;white\u0026quot; 3) \u0026quot;red\u0026quot; 4) \u0026quot;black\u0026quot; \u0026gt; sismember colors yellow // æ£€æŸ¥yellowæ˜¯å¦åœ¨colorsä¸­ (integer) 0 // é›†åˆcolorsä¸åŒ…å«yellow \u0026gt; scard colors // æŸ¥çœ‹é›†åˆcolorsçš„åŸºæ•°(å…ƒç´ ä¸ªæ•°) (integer) 4 \u0026gt; spop colors // éšæœºä»é›†åˆcolorsä¸­ç§»é™¤ä¸€ä¸ªå…ƒç´  \u0026quot;black\u0026quot; \u0026gt; srem set1 black // ä»é›†åˆcolorsä¸­åˆ é™¤ä¸€ä¸ªä¸å­˜åœ¨çš„å…ƒç´  (integer) 0 \u0026gt; srem colors white // ä»é›†åˆcolorsä¸­åˆ é™¤ä¸€ä¸ªå­˜åœ¨çš„å…ƒç´  (integer) 1 \u0026gt; smembers colors 1) \u0026quot;blue\u0026quot; 2) \u0026quot;red\u0026quot; ä¸‹é¢æ˜¯é›†åˆè¿ç®—ï¼š\n\u0026gt; sadd set2 a b c red blue gold (integer) 6 \u0026gt; smembers set2 1) \u0026quot;c\u0026quot; 2) \u0026quot;a\u0026quot; 3) \u0026quot;gold\u0026quot; 4) \u0026quot;b\u0026quot; 5) \u0026quot;red\u0026quot; 6) \u0026quot;blue\u0026quot; \u0026gt; sunion colors set2 // colors âˆ© set2 1) \u0026quot;gold\u0026quot; 2) \u0026quot;red\u0026quot; 3) \u0026quot;b\u0026quot; 4) \u0026quot;a\u0026quot; 5) \u0026quot;blue\u0026quot; 6) \u0026quot;c\u0026quot; \u0026gt; sinter colors set2 // colors âˆª set2 1) \u0026quot;blue\u0026quot; 2) \u0026quot;red\u0026quot; \u0026gt; sdiff set2 colors // set - colors 1) \u0026quot;gold\u0026quot; 2) \u0026quot;b\u0026quot; 3) \u0026quot;c\u0026quot; 4) \u0026quot;a\u0026quot; \u0026gt; sadd set3 f (integer) 1 \u0026gt; sdiff set2 colors set3 // set2 - colors - set3 1) \u0026quot;gold\u0026quot; 2) \u0026quot;b\u0026quot; 3) \u0026quot;c\u0026quot; 4) \u0026quot;a\u0026quot; Sorted sets Redisä¸­çš„æœ‰åºé›†åˆ(sorted set)å’Œé›†åˆ(set)ç±»ä¼¼ï¼Œå­˜æ”¾ä¸é‡å¤çš„å­—ç¬¦ä¸²ã€‚ä¸è¿‡ï¼Œæœ‰åºé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æµ®ç‚¹ç±»å‹çš„åˆ†æ•°(score)ï¼Œè¿™ä¸ªåˆ†æ•°ç”¨æ¥ç»´æŒé›†åˆçš„æœ‰åºæ€§ã€‚ç”±äºæ˜¯æœ‰åºçš„ï¼Œæœ‰åºé›†åˆåˆå…·æœ‰å“ˆå¸Œè¡¨çš„å¿«é€Ÿè®¿é—®çš„ä¼˜åŠ¿ã€‚\nè€ƒè™‘æœ‰åºé›†åˆä¸­çš„ä¸¤ä¸ªå…ƒç´ Aå’ŒBï¼Œæœ‰åºé›†åˆçš„æœ‰åºæ€§åŸºäºä»¥ä¸‹ä¸¤ç‚¹ï¼š\n å¦‚æœA.score \u0026gt; B.scoreï¼Œé‚£ä¹ˆï¼šA \u0026gt; B å¦‚æœA.socre = B.scoreï¼ŒA \u0026gt; Bçš„å‰ææ˜¯Açš„å­—å…¸åºå¤§äºBã€‚å› ä¸ºé›†åˆçš„å…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥Aå’ŒBçš„å†…å®¹ä¸å¯èƒ½ç›¸åŒ  ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š\n\u0026gt; zadd z1 2 a -1 b // å‘æœ‰åºé›†åˆz1ä¸­æ·»åŠ a(score=2)å’Œb(score=-1)ï¼Œ ZADDè¿˜å¯ä»¥ç”¨æ¥æ›´æ–°å…ƒç´ å¯¹åº”çš„åˆ†æ•° (integer) 2 \u0026gt; zrange z1 0 -1 // æŸ¥çœ‹z1å†…å®¹(æ­£åº)ï¼Œå› ä¸ºb.score \u0026lt; a.scoreï¼Œæ‰€ä»¥båœ¨å‰é¢ 1) \u0026quot;b\u0026quot; 2) \u0026quot;a\u0026quot; \u0026gt; zrange z1 0 -1 withscores // æŸ¥çœ‹z1å†…å®¹åŠå¯¹åº”åˆ†æ•° 1) \u0026quot;b\u0026quot; 2) \u0026quot;-1\u0026quot; 3) \u0026quot;a\u0026quot; 4) \u0026quot;2\u0026quot; \u0026gt; zrevrange z1 0 -1 // æŸ¥çœ‹z1å†…å®¹(é€†åº) 1) \u0026quot;a\u0026quot; 2) \u0026quot;b\u0026quot; \u0026gt; zrangebyscore z1 0 inf // æŸ¥çœ‹z1ä¸­åˆ†æ•°åœ¨[0, inf)å†…çš„å†…å®¹ 1) \u0026quot;a\u0026quot; \u0026gt; zrank z1 b // æŸ¥çœ‹z1ä¸­å†…å®¹bçš„æ’å (integer) 0 \u0026gt; zremrangebyscore z1 -inf -1 // ç§»é™¤z1ä¸­åˆ†æ•°ä½äº(-inf,1]çš„æ‰€æœ‰å…ƒç´  (integer) 1 \u0026gt; zrange z1 0 -1 1) \u0026quot;a\u0026quot; æœ‰åºé›†åˆè¿˜æ”¯æŒå¾ˆå¤šçš„å‘½ä»¤ï¼Œæ¯”å¦‚ï¼šZPOPMAXã€ZRANGEBYLEXã€**ZUNIONSTORE**ç­‰ç­‰ã€‚\nBitmaps ä¸¥æ ¼åœ°è¯´ï¼ŒBitmapå¹¶ä¸æ˜¯ä¸€ç§æ–°çš„æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯åŸºäºstringçš„ä¸€ç§æ•°æ®ç±»å‹ï¼Œå®ƒæä¾›äº†ä¸€äº›åŸºäºæ¯”ç‰¹ä½çš„æ“ä½œã€‚ç”±äºå½“å‰Redisä¸­çš„stringæœ€å¤§æ”¯æŒåˆ°512MBï¼Œå› æ­¤ä½æ“ä½œèƒ½å¤Ÿä½¿ç”¨çš„æ¯”ç‰¹ä½æ•°æœ€å¤§ä¸º$$2^{32}$$ï¼Œçº¦ä¸º4.295äº¿ã€‚\nBit fields Bit fieldæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒæŠŠæ•°æ®ä»¥æ¯”ç‰¹ä½ä¸ºå•å…ƒè¿›è¡Œå­˜å‚¨ï¼Œå¹¶å…è®¸å¯¹å•ä¸ªæ¯”ç‰¹ä½æˆ–ä¸€ç»„æ¯”ç‰¹ä½è¿›è¡Œæ“ä½œã€‚\n**BITFIELD**ä¼šå°†stringä½œä¸ºä½æ•°ç»„å¯¹å¾…ï¼Œæ”¯æŒä¸€æ¬¡æ“ä½œä¸€ä¸ªæˆ–å¤šä¸ªä½ã€‚å¯ä»¥ç†è§£ä¸ºï¼šæˆ‘ä»¬å¯ä»¥åœ¨stringä¸Šæ“ä½œä¸€ä¸ªæˆ–å¤šä¸ªå¯å˜é•¿åº¦çš„æ•´æ•°ã€‚å…¶å®Œæ•´è¯­æ³•å¦‚ä¸‹ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªå­å‘½ä»¤å’Œä¸‰ç§æº¢å‡ºç­–ç•¥ï¼š BITFIELD key [GET type offset] [SET type offset value] [INCRBY type offset increment] [OVERFLOW WRAP|SAT|FAIL]\nè¿™é‡Œçš„typeå¿…é¡»æ˜¯æ•´æ•°ç±»å‹ï¼Œå®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šç¬¦å·å‰ç¼€+æ•´æ•°çš„å®½åº¦ã€‚å‰ç¼€ç”±åˆ†ä¸ºä¸¤ç§ï¼šiè¡¨ç¤ºæœ‰ç¬¦å·(signed)æ•´æ•°ï¼Œè€Œuè¡¨ç¤ºæ— ç¬¦å·(unsigned)æ•´æ•°ã€‚ä¾‹å¦‚ï¼šu8è¡¨ç¤ºå®½åº¦ä¸º8ä½çš„æ— ç¬¦å·æ•´æ•°ï¼Œè€Œi5è¡¨ç¤ºå®½åº¦ä¸º5ä½çš„æœ‰ç¬¦å·æ•´æ•°ã€‚å¯¹äºæ— ç¬¦å·æ•´æ•°ï¼Œæœ€å¤§æ”¯æŒåˆ°64ä½ï¼Œè€Œå¯¹äºæœ‰ç¬¦å·æ•´æ•°ï¼Œæœ€å¤§æ”¯æŒåˆ°63ä½ã€‚\noffsetæœ‰ä¸¤ç§å½¢å¼ï¼š\n ä¸å¸¦å‰ç¼€#ï¼Œé‡‡ç”¨ä»0å¼€å§‹çš„offsetå»ç¡®å®šbit fieldçš„ä½ç½® å¸¦å‰ç¼€#ï¼Œé‡‡ç”¨æ•´æ•°çš„å®½åº¦ä¹˜ä»¥offsetå»ç¡®å®šbit fieldçš„ä½ç½®  ä¾‹å¦‚ï¼š\n\u0026gt; bitfield myfield set u8 0 42 1) (integer) 0 \u0026gt; bitfield myfield get u8 0 1) (integer) 42 \u0026gt; type myfield string \u0026gt; object encoding myfield \u0026quot;raw\u0026quot; \u0026gt; bitfield myfield set u8 #1 10 1) (integer) 0 \u0026gt; bitfield myfield get u8 #1 get u8 8 1) (integer) 10 2) (integer) 10 \u0026gt; get myfield \u0026quot;*\\n\u0026quot; // åœ¨ASCIIè¡¨ä¸­ï¼Œ42è¡¨ç¤º'*'ï¼Œè€Œ10è¡¨ç¤º'\\n'ã€‚ **BITFIELD**æ”¯æŒçš„ä¸‰ä¸ªå­å‘½ä»¤åˆ†åˆ«ä¸ºï¼š\n GET \u0026lt;type\u0026gt; \u0026lt;offset\u0026gt;ï¼šè¿”å›ç»™å®šçš„bit field SET \u0026lt;type\u0026gt; \u0026lt;offset\u0026gt; \u0026lt;value\u0026gt;ï¼šè®¾ç½®bit fieldçš„å€¼å¹¶è¿”å›å…¶ä¸Šçš„æ—§å€¼ INCRBY \u0026lt;type\u0026gt; \u0026lt;offset\u0026gt; \u0026lt;increment\u0026gt;ï¼šåœ¨ç»™å®šçš„bit fieldä¸Šæ‰§è¡Œå¢å‡æ“ä½œï¼Œå¹¶è¿”å›æ–°å€¼  å¯¹äº **INCRBY**å­å‘½ä»¤ï¼Œè¿˜å¯ä»¥æŒ‡å®šæº¢å‡ºç­–ç•¥ï¼Œæœ‰ä¸‰ç§å¯é€‰çš„æº¢å‡ºç­–ç•¥ï¼š\n WRAPï¼šwrap aroundï¼Œå›ç»•ã€‚ä¾‹å¦‚ï¼Œå¯¹äºi8ç±»å‹çš„127ï¼ŒåŠ ä¸€ä¼šå¾—åˆ°-128ï¼Œè€Œå¯¹äºu7ç±»å‹çš„128ï¼ŒåŠ ä¸€ä¼šå¾—åˆ°0 SATï¼šsaturation arithmeticï¼Œé¥±å’Œè®¡ç®—ã€‚ä¾‹å¦‚ï¼Œä¾‹å¦‚ï¼Œå¯¹äºi8ç±»å‹çš„127ï¼ŒåŠ ä¸€ä¾ç„¶æ˜¯128 FAILï¼šå½“å‘ç”Ÿæº¢å‡ºæ—¶ï¼Œä¸é‡‡å–ä»»ä½•è¿ç®—ï¼Œè€Œæ˜¯è¿”å›NULL WRAPæ˜¯é»˜è®¤çš„æº¢å‡ºç­–ç•¥ã€‚  Bit arrays SETBIT key offset valueç»™æŒ‡å®šæ¯”ç‰¹ä½è®¾ç½®å€¼ï¼Œç„¶åè¿”å›è¯¥ä½ç½®ä¸ŠåŸæ¥çš„å€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™ä¼šå…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„stringï¼Œè¿™ä¸ªstringä¼šè‡ªåŠ¨æ‰©å®¹ä»¥ä¿è¯offsetçš„æœ‰æ•ˆæ€§ã€‚ä¼å›¾ä½¿ç”¨ **SETBIT**è®¾ç½®0å’Œ1ä»¥å¤–çš„å€¼ä¼šå¯¼è‡´é”™è¯¯ã€‚ **GETBIT key offset**è·å–offsetä½ç½®çš„å€¼ï¼Œè‹¥ç»™å®šoffsetè¶…å‡ºäº†å½“å‰stringçš„é•¿åº¦æˆ–keyä¸å­˜åœ¨ï¼ŒRediséƒ½ä¼šè¿”å›0ã€‚ä¾‹å¦‚ï¼š\n\u0026gt; setbit bits 2 1 (integer) 0 \u0026gt; getbit bits 2 (integer) 1 \u0026gt; getbit bits 1 (integer) 0 æœ‰ä¸‰ç§å‘½ä»¤å¯ä»¥æ“ä½œä¸€ç»„æ¯”ç‰¹ä½ï¼š\n BITOP operation destkey key [key ...]ï¼šè¿›è¡Œå­—ç¬¦ä¸²ä¹‹é—´çš„æŒ‰ä½ä¸(AND)ã€æŒ‰ä½æˆ–(OR)ã€æŒ‰ä½å¼‚æˆ–(XOR)ä»¥åŠæŒ‰ä½å–å(NOT)æ“ä½œ BITCOUNT key [start end]ï¼šè¿›è¡Œè®¡æ•°æ“ä½œï¼Œè¿”å›è®¾ç½®ä¸º1çš„æ¯”ç‰¹ä½çš„ä¸ªæ•° BITPOS key bit [start end]ï¼šå¯»æ‰¾ç»™å®šbit(0æˆ–1)å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®  HyperLogLogs Redisä½¿ç”¨HyperLogLogè¿›è¡Œè®¡æ•°ï¼Œè¿™ä¸ªç®—æ³•æ˜¯åŸºäºç»Ÿè®¡çš„ã€‚Redisçš„å®ç°ä¸­ï¼Œæ ‡å‡†è¯¯å·®åªæœ‰1%ï¼Œå¹¶ä¸”åœ¨æœ€åçš„æƒ…å†µä¸‹åªéœ€è¦æ¶ˆè€— 12KB çš„å†…å­˜ã€‚HyperLogLogåœ¨æŠ€æœ¯ä¸Šæ˜¯ä¸€ç§ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œä½†ä¹Ÿæ˜¯åŸºäºstringå®ç°çš„ã€‚\næˆ‘ä»¬ä½¿ç”¨ SADD å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼Œç±»ä¼¼çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ PFADD å‘HyperLogLogä¸­æ·»åŠ å…ƒç´ ã€‚å®é™…ä¸Šï¼ŒHyperLogLogå¹¶ä¸å­˜å‚¨æˆ‘ä»¬æ·»åŠ çš„å…ƒç´ ï¼Œåªæ˜¯æ›´æ–°å†…éƒ¨çŠ¶æ€ã€‚\n\u0026gt; pfadd hll a b c d // å‘hllä¸­åŠ å…¥å››ä¸ªå…ƒç´  (integer) 1 \u0026gt; type hll // æŸ¥çœ‹hllç±»å‹ string // HyperLogLogå®é™…ä¸ºstring \u0026gt; pfcount hll // å¯¹hllè¿›è¡Œè®¡æ•° (integer) 4 \u0026gt; pfadd hll1 a b c d (integer) 1 \u0026gt; pfadd hll2 c d e f (integer) 1 \u0026gt; pfmerge hll3 hll1 hll2 // åˆå¹¶hll1å’Œhll2åˆ°hll3 OK \u0026gt; pfcount hll3 (integer) 6 Geospatial indexes Redisåœ¨3.2.0ç‰ˆæœ¬ä¸­åŠ å…¥äº†åœ°ç†ç©ºé—´(geospatial)è¿™ä¸€æ•°æ®ç±»å‹ï¼Œå¹¶æ”¯æŒåŠå¾„æŸ¥è¯¢åŠŸèƒ½ã€‚ä¸€ä¸ªå…·ä½“çš„ä½ç½®ä¿¡æ¯ç”±ä¸‰å…ƒç»„(longtitude, latitude, member)ç¡®å®šã€‚å¯¹äºæ¯ä¸€ä¸ª\u0026lt;latitude, longitude\u0026gt;å¯¹ï¼ŒRediséƒ½ä¼šè®¡ç®—å‡ºä¸€ä¸ªGeoHash(Redisä¸­çš„GeoHashæ˜¯ä¸€ä¸ª52ä½çš„æ•´æ•°)ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ **GEOADD key longitude latitude member [longitude latitude member ...]**å‘ä¸€ä¸ªkeyæ·»åŠ åœ°ç†æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šè¢«å­˜å‚¨ä¸ºæœ‰åºé›†åˆ(memberä½œä¸ºæœ‰åºé›†åˆä¸­çš„memberï¼ŒGeoHashä½œä¸ºæœ‰åºé›†åˆä¸­çš„score)ï¼Œè¿™ä¹ˆåšä¸ºåŠå¾„æŸ¥è¯¢ **GEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]**å’Œ **GEORADIUSBYMEMBER key member radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]**æä¾›äº†æ”¯æŒã€‚æœ‰åºé›†åˆä¸Šçš„æ‰€æœ‰å‘½ä»¤ä¹Ÿèƒ½ç”¨äºgeospatialç±»å‹ã€‚\nä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š\n\u0026gt; geoadd municipalities 116.4551113869 39.6733986505 beijing 121.6406041505 30.8267595167 shanghai 106.6992091675 29.3055601981 chongqing // æ·»åŠ 3ä¸ªåœ°ç†ç©ºé—´æ•°æ® (integer) 3 \u0026gt; zrange municipalities 0 -1 withscores // å› ä¸ºGeoHashä½¿ç”¨æœ‰åºé›†åˆå­˜å‚¨ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨zrangeå‘½ä»¤ 1) \u0026quot;chongqing\u0026quot; 2) \u0026quot;4026043269574572\u0026quot; 3) \u0026quot;shanghai\u0026quot; 4) \u0026quot;4054740844391077\u0026quot; 5) \u0026quot;beijing\u0026quot; 6) \u0026quot;4069148402401385\u0026quot; \u0026gt; type municipalities zset \u0026gt; geohash municipalities beijing shanghai // æŸ¥çœ‹beijingå’Œchongqingçš„GeoHash 1) \u0026quot;wx4cdn242c0\u0026quot; 2) \u0026quot;wtqrrgzfzs0\u0026quot; \u0026gt; geopos municipalities chongqing // æŸ¥çœ‹chongqingçš„åœ°ç†ç©ºé—´æ•°æ® 1) 1) \u0026quot;106.69921070337295532\u0026quot; 2) \u0026quot;29.30556015923176716\u0026quot; \u0026gt; geodist municipalities beijing chongqing // æŸ¥çœ‹beijingå’Œchongqingç›´æ¥çš„è·ç¦»(å•ä½ä¸ºç±³) \u0026quot;1457336.8906\u0026quot; \u0026gt; georadius municipalities 116 40 1000 km // æŸ¥çœ‹ä»¥ç»åº¦116ã€çº¬åº¦40ä¸ºä¸­å¿ƒï¼Œ1000kmä¸ºåŠå¾„å†…çš„æ‰€æœ‰ä½ç½® 1) \u0026quot;beijing\u0026quot; \u0026gt; georadiusbymember municipalities chongqing 1500 km // æŸ¥çœ‹ä»¥chongqingä¸ºä¸­å¿ƒã€1500kmä¸ºåŠå¾„å†…çš„æ‰€æœ‰ä½ç½® 1) \u0026quot;chongqing\u0026quot; 2) \u0026quot;shanghai\u0026quot; 3) \u0026quot;beijing\u0026quot; Streams è§Redis Streamsã€‚\nå‚è€ƒèµ„æ–™  An introduction to Redis data types and abstractions. Bit field.  ","href":"/posts/redis/redis_datastructures/","title":"Redisæ•°æ®ç»“æ„"},{"content":"Redisé€šè¿‡ PUBLISHã€**SUBSCRIBE**ç­‰å‘½ä»¤å®ç°äº†å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œè¿™ä¸ªåŠŸèƒ½æä¾›äº†ä¸¤ç§ä¿¡æ¯æœºåˆ¶ï¼šsimple syndicationå’Œpattern syndicationã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå‘å¸ƒ-è®¢é˜…ä¸ä¿è¯å®Œæˆæ¶ˆæ¯çš„äº¤ä»˜ã€‚å½“æ¶ˆæ¯å‘å¸ƒæ—¶åˆ°æŸä¸ªchannelä¸Šæ—¶ï¼Œåªæœ‰é‚£äº›è®¢é˜…äº†è¯¥channelå¹¶ä¸”è¿æ¥ä¸Šäº†çš„å®¢æˆ·ç«¯æ‰ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚æ¶ˆæ¯ä¸€æ—¦å‘å¸ƒï¼Œå°±ä¼šè¢«ä¸¢å¼ƒï¼Œåªæœ‰é‚£äº›å½“å‰è®¢é˜…äº†çš„å®¢æˆ·ç«¯æ‰ä¼šæ”¶åˆ°è¯¥æ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯åªæœ‰åœ¨æ¶ˆæ¯å‘å¸ƒå‰è®¢é˜…ï¼Œæ‰èƒ½æ”¶åˆ°è¯¥æ¶ˆæ¯ã€‚ã€‚\nSimple syndication åœ¨simple syndicationä¸‹ï¼ŒRedisä½¿ç”¨ **PUBLISH channel message**å‘å¸ƒmessageåˆ°æŒ‡å®šchannelï¼Œç„¶åè¿”å›æ”¶åˆ°è¯¥æ¶ˆæ¯çš„å®¢æˆ·ç«¯æ•°é‡ã€‚\nå®¢æˆ·ç«¯ä½¿ç”¨ SUBSCRIBE channel [channel ...]æ¥ç›‘å¬æŒ‡å®šçš„channelï¼Œæ­¤åå®¢æˆ·ç«¯ä¸èƒ½å†å‘å‡ºé™¤ SUBSCRIBEã€PSUBSCRIBEã€UNSUBSCRIBEã€PUNSUBSCRIBEã€**PING**å’Œ **QUIT**ä»¥å¤–çš„å‘½ä»¤ã€‚å¯¹äºredis-cliæ¥è¯´ï¼Œä¸€æ—¦å¤„äºè®¢é˜…æ¨¡å¼ï¼Œå°±ä¸å†æ¥æ”¶ä»»ä½•å‘½ä»¤å¹¶ä¸”åªèƒ½é€šè¿‡Ctrl-Cæ¥é€€å‡ºã€‚\nè‹¥å®¢æˆ·ç«¯ä¸æƒ³å†ç›‘å¬æŸä¸ªchannelä¸Šçš„æ¶ˆæ¯ï¼Œå¯ä»¥æ‰§è¡Œ **UNSUBSCRIBE [channel [channel ...]]**æ¥åœæ­¢å¯¹æŒ‡å®šchannelä¸Šæ¶ˆæ¯çš„è®¢é˜…ã€‚è‹¥æ²¡æœ‰ç»™å‡ºchannelå‚æ•°ï¼Œå®¢æˆ·ç«¯å°†åœæ­¢å¯¹ä¹‹å‰è®¢é˜…çš„æ‰€æœ‰channelçš„ç›‘å¬ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š é¦–å…ˆclient-2è®¢é˜…äº†ch1ä¸Šçš„æ¶ˆæ¯ï¼š\nclient-2:6379\u0026gt; subscribe ch1 Reading messages... (press Ctrl-C to quit) 1) \u0026quot;subscribe\u0026quot; 2) \u0026quot;ch1\u0026quot; 3) (integer) 1 ç„¶åclient-1å¾€ch1ä¸Šå‘å¸ƒæ¶ˆæ¯ï¼š\nclient-1:6379\u0026gt; publish ch1 \u0026quot;hello\u0026quot; (integer) 1 // æœ‰ä¸€ä¸ªè®¢é˜…è€…æ”¶åˆ°äº†æ¶ˆæ¯ æ”¶åˆ°æ¶ˆæ¯çš„æ­£æ˜¯client-2ï¼Œclient-2ä¸Šåº”è¯¥å¯ä»¥çœ‹åˆ°è¿™æ ·çš„ä¿¡æ¯ï¼š\nclient-2:6379\u0026gt; subscribe ch1 Reading messages... (press Ctrl-C to quit) 1) \u0026quot;subscribe\u0026quot; 2) \u0026quot;ch1\u0026quot; 3) (integer) 1 1) \u0026quot;message\u0026quot; 2) \u0026quot;ch1\u0026quot; 3) \u0026quot;hello\u0026quot; æ¶ˆæ¯çš„æ ¼å¼ Redisä¸­ï¼Œchannelçš„è®¢é˜…è€…æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯ä¸€ä¸ªç”±ä¸‰ä¸ªå…ƒç´ ç»„æˆçš„æ•°ç»„ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ¶ˆæ¯çš„ç±»å‹ï¼Œåä¸¤ä¸ªå…ƒç´ çš„å†…å®¹éšæ¶ˆæ¯çš„ç±»å‹è€Œå˜åŒ–ã€‚æœ‰ä¸‰ç§ç±»å‹çš„æ¶ˆæ¯ï¼š\n subscribeï¼šæˆåŠŸè®¢é˜…æŸä¸ªchannelï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºè¢«è®¢é˜…channelçš„åå­—ï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ä¸ºå½“å‰è®¢é˜…çš„channelæ•°é‡ unsubscribeï¼šæˆåŠŸå–æ¶ˆå¯¹æŸä¸ªchannelçš„è®¢é˜…ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºå–æ¶ˆè®¢é˜…çš„channelçš„åå­—ï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ä¸ºå½“å‰è®¢é˜…çš„channelæ•°é‡(ä¸º0è¡¨ç¤ºä¸å†è®¢é˜…ä»»ä½•channel) messageï¼šæ”¶åˆ°äº†å‘å¸ƒçš„æ¶ˆæ¯ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºè¿™ä¸ªæ¶ˆæ¯çš„æ¥æº(channel)ï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ä¸ºæ¶ˆæ¯çš„å†…å®¹  Pattern syndication æœ‰æ—¶å€™æˆ‘ä»¬æƒ³æ¥æ”¶æ‰€æœ‰çš„æ¶ˆæ¯ï¼Œè¿™ä¸ªæ—¶å€™æŠŠæ‰€æœ‰çš„channeléƒ½è®¢é˜…å°±è¡Œäº†ã€‚ä½†æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½å¸Œæœ›å¯¹æ¶ˆæ¯çš„æ¥æºè¿›è¡Œè¿‡æ»¤ï¼Œåªæ¥æ”¶æ»¡è¶³è¿‡æ»¤æ¡ä»¶çš„channelä¸Šçš„ä¿¡æ¯ã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨ **PSUBSCRIBE pattern [pattern ...]**æ¥è®¢é˜…æ»¡è¶³ç»™å®šæ¨¡å¼çš„channeläº†ã€‚Redisæ”¯æŒglob-styleçš„patternï¼š\n h?lloè¡¨ç¤ºè®¢é˜…helloã€hilloã€halloç­‰ h*lloè¡¨ç¤ºè®¢é˜…hlloã€helloã€haelloç­‰ h[ae]lloè¡¨ç¤ºè®¢é˜…halloå’Œhelloï¼Œè€Œä¸æ˜¯hxlloæˆ–hblloç­‰  **PUNSUBSCRIBE [pattern [pattern]]**è¡¨ç¤ºä¸å†è®¢é˜…æ»¡è¶³ç»™å®šæ¨¡å¼çš„channelã€‚è‹¥æ²¡æœ‰ç»™å‡ºpatternå‚æ•°ï¼Œå®¢æˆ·ç«¯å°†åœæ­¢å¯¹ä¹‹å‰è®¢é˜…çš„æ‰€æœ‰channelçš„ç›‘å¬ã€‚\næ¥ç€ä¸Šä¸€éƒ¨åˆ†ä¸¾ä¾‹ï¼Œæ–°å¼€ä¸€ä¸ªclient-3è®¢é˜…ch?æ¨¡å¼çš„channelï¼š\nclient-3:6379\u0026gt; psubscribe ch? Reading messages... (press Ctrl-C to quit) 1) \u0026quot;psubscribe\u0026quot; // è®¢é˜…patternæˆåŠŸ 2) \u0026quot;ch?\u0026quot; // è®¢é˜…çš„pattern 3) (integer) 1 // è®¢é˜…è¯¥patternçš„è®¢é˜…è€…æ•°é‡ ç„¶åclient-1å¾€ch3ä¸Šå‘å¸ƒæ¶ˆæ¯ï¼š\nclient-1:6379\u0026gt; publish ch3 \u0026quot;hello, ch3\u0026quot; (integer) 1 // æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯æ”¶åˆ°äº†æ¶ˆæ¯ æ”¶åˆ°æ¶ˆæ¯çš„æ­£æ˜¯client-3ï¼Œç”±äºclient-2åªè®¢é˜…äº†ch1ï¼Œå› æ­¤å®ƒä¸ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚client-3ä¸Šåº”è¯¥å¯ä»¥çœ‹åˆ°è¿™æ ·çš„ä¿¡æ¯ï¼š\nclient-3:6379\u0026gt; psubscribe ch? Reading messages... (press Ctrl-C to quit) 1) \u0026quot;psubscribe\u0026quot; 2) \u0026quot;ch?\u0026quot; 3) (integer) 1 1) \u0026quot;pmessage\u0026quot; // æ”¶åˆ°æ¶ˆæ¯ 2) \u0026quot;ch?\u0026quot; // pattern 3) \u0026quot;ch3\u0026quot; // æ¶ˆæ¯å¯¹åº”çš„channel 4) \u0026quot;hello, ch3\u0026quot; // æ¶ˆæ¯å†…å®¹ æ¶ˆæ¯çš„æ ¼å¼ ä½¿ç”¨ **PSUBSCRIBE**ä¹‹åï¼Œè®¢é˜…è€…æ¥æ”¶åˆ°çš„æ¶ˆæ¯å’Œ **SUBSCRIBE**å¤§ä½“ç±»ä¼¼ï¼Œä½†æ¶ˆæ¯å†…å®¹çš„å«ä¹‰ç¨æœ‰å˜åŒ–ï¼Œå…·ä½“çš„è§ä¸Šé¢çš„æ³¨é‡Šã€‚\næŸ¥çœ‹Pub/Subç³»ç»ŸçŠ¶æ€ **PUBSUB subcommand [argument [argumeng ...]]å‘½ä»¤å…è®¸æˆ‘ä»¬æŸ¥çœ‹å‘å¸ƒ-è®¢é˜…ç³»ç»Ÿçš„å†…éƒ¨çŠ¶æ€ï¼Œå…±æ”¯æŒ3ä¸ªå­å‘½ä»¤ï¼š\n PUBSUB CHANNELS [pattern]ï¼šæŸ¥çœ‹å½“å‰å¤„äºæ´»åŠ¨çŠ¶æ€çš„channel(æœ‰è‡³å°‘ä¸€ä¸ªè®¢é˜…è€…çš„channel)ã€‚è‹¥æœªæä¾›patternå‚æ•°ï¼Œå°†è¿”å›æ‰€æœ‰çš„å¤„äºæ´»åŠ¨çŠ¶æ€çš„channelï¼Œå¦åˆ™åªè¿”å›æ»¡è¶³patternå¹¶å¤„äºæ´»åŠ¨çŠ¶æ€çš„channel PUBSUB NUMSUB [channel-1 ... channel-N]ï¼šæŸ¥çœ‹ç»™å®šchannelçš„è®¢é˜…è€…æ•°é‡(ä¸åŒ…æ‹¬è®¢é˜…patternçš„è®¢é˜…è€…)ï¼Œè¿”å›ç»“æœçš„æ ¼å¼ä¸ºchannel,count,channel,count,...,ã€‚è‹¥æœªæä¾›channelå‚æ•°ï¼Œå°†è¿”å›ä¸€ä¸ªç©ºåˆ—è¡¨ PUBSUB NUMPATï¼šè¿”å›è¢«è®¢é˜…patternçš„æ•°é‡  æ¥ç€ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨client-1ä¸Šæ‰§è¡Œ PUBSUBï¼ŒæŸ¥çœ‹ç³»ç»ŸçŠ¶æ€ï¼š\nclient-1:6379\u0026gt; pubsub channels // ä¸å¸¦patternå‚æ•° 1) \u0026quot;ch1\u0026quot; client-1:6379\u0026gt; pubsub channels ch? 1) \u0026quot;ch1\u0026quot; client-1:6379\u0026gt; pubsub numsub ch1 // æŸ¥çœ‹ch1ä¸Šè®¢é˜…è€…çš„æ•°é‡ 1) \u0026quot;ch1\u0026quot; 2) (integer) 1 client-1:6379\u0026gt; pubsub numsub // ä¸å¸¦å‚æ•° (empty list or set) client-1:6379\u0026gt; pubsub numpat (integer) 1 // å½“å‰è¢«è®¢é˜…çš„patternæ•°é‡ä¸º1 å‚è€ƒèµ„æ–™  Pub/Sub. Publishâ€“subscribe pattern.  ","href":"/posts/redis/publish_subscribe/","title":"Publish/Subscribe"},{"content":"Redisæ”¯æŒåœ¨æœåŠ¡ç«¯ä½¿ç”¨Luaè§£é‡Šå™¨æ‰§è¡ŒLuaè„šæœ¬ã€‚Redisæœ¬èº«å·²ç»æä¾›äº†éå¸¸å¤šçš„å‘½ä»¤ï¼Œè€ŒLuaè„šæœ¬å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä½¿ç”¨Luaæä¾›çš„è¯­è¨€ç‰¹æ€§æ¥ç»„ç»‡è¿™äº›å‘½ä»¤ï¼Œä»¥è¾¾åˆ°æ›´å¥½çš„æ•ˆæœã€‚æ€»çš„æ¥è¯´ï¼Œä½¿ç”¨Luaè„šæœ¬å¸¦æ¥çš„å¥½å¤„æœ‰ï¼š\n é™ä½ç½‘ç»œå¼€é”€ã€‚å®¢æˆ·ç«¯æ¯æ¬¡åªèƒ½æ“ä½œä¸€ä¸ªé”®ï¼Œå®¢æˆ·ç«¯æ¯å‘å‡ºä¸€ä¸ªå‘½ä»¤ï¼Œéƒ½ä¼šå¼•å‘ä¸€ä¸ªå®Œæ•´è¯·æ±‚-å“åº”è¿‡ç¨‹ï¼Œå½“éœ€è¦å‘é€å¤§é‡æŒ‡ä»¤æ—¶ï¼Œè¿™ä¼šå¼•èµ·å·¨å¤§çš„ç½‘ç»œå¼€é”€ã€‚å› ä¸ºLuaè„šæœ¬æ˜¯ç›´æ¥åœ¨åœ¨RedisæœåŠ¡ç«¯æ‰§è¡Œçš„ï¼Œå°†å¤šä¸ªå‘½ä»¤æ”¾åœ¨åŒä¸€ä¸ªLuaè„šæœ¬ä¸­æ‰§è¡Œæˆ–åœ¨åŒä¸€ä¸ªLuaè„šæœ¬ä¸­æ“ä½œå¤šä¸ªé”®å¯ä»¥å‡å°‘ç½‘ç»œä¼ è¾“æ¬¡æ•°ï¼Œè¿›è€Œé™ä½ç½‘ç»œå¼€é”€ åŸå­æ“ä½œã€‚Redisä¼šå°†æ•´ä¸ªLuaè„šæœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“ä»¥åŸå­çš„æ–¹å¼æ‰§è¡Œï¼Œå°±åƒäº‹åŠ¡ä¸€æ · å¯å¤ç”¨æ€§ã€‚Luaè„šæœ¬å°±åƒæ˜¯æ•°æ®åº“ä¸­çš„å­˜å‚¨ç¨‹åºä¸€æ ·ï¼Œæ”¯æŒä¼ å…¥å‚æ•°ï¼Œåå¤ä½¿ç”¨ã€‚Redisè¿˜ä¼šç¼“å­˜å·²æ‰§è¡Œçš„è„šæœ¬ï¼Œè¿™æ„å‘³ç€å…¶å®ƒçš„å®¢æˆ·ç«¯å¯ä»¥ç›´æ¥ä½¿ç”¨å·²ç¼“å­˜çš„è„šæœ¬  æ‰§è¡Œè„šæœ¬ æ‰§è¡ŒLuaè„šæœ¬çš„å‘½ä»¤ä¸º **EVAL script numkeys key [key ...] arg [arg ...]**å’Œ EVALSHA sha1 numkeys key [key ...] arg [arg ...]ã€‚\n**EVAL**å…·æœ‰å¾ˆå¤šå‚æ•°ï¼šscriptä»£è¡¨å¾…æ‰§è¡Œçš„Luaè„šæœ¬ï¼Œnumkeysè¡¨ç¤ºé”®çš„æ•°é‡.ï¼Œæ¥ä¸‹æ¥æ˜¯é”®å(å¯ä»¥é€šè¿‡å…¨å±€å˜é‡KEYSè®¿é—®)å’Œè„šæœ¬å¯èƒ½éœ€è¦ç”¨åˆ°çš„å‚æ•°(å¯ä»¥é€šè¿‡å…¨å±€å˜é‡ARGVè®¿é—®)ã€‚\n\u0026gt; hset hash-key f1 hello f2 Redis (integer) 2 \u0026gt; eval \u0026quot;return redis.call('HGET', KEYS[1], ARGV[1])\u0026quot; 1 hash-key f2 \u0026quot;Redis\u0026quot; \u0026gt; eval \u0026quot;return redis.call('HGET', 'hash-key', 'f2')\u0026quot; 0 \u0026quot;Redis\u0026quot; åœ¨ä¸Šé¢è¿™æ®µè„šæœ¬é‡Œï¼Œåˆ›å»ºäº†ä¸¤ä¸ªé¢„å®šä¹‰çš„æ•°ç»„ï¼šKEYSå­˜æ”¾ä¼ å…¥æ‰€æœ‰é”®åï¼Œè€ŒARGVå­˜æ”¾ä¼ å…¥çš„æ‰€æœ‰å‚æ•°ã€‚æœ€åä¸€æ¡å‘½ä»¤ç¡¬ç¼–ç å‚æ•°ï¼Œè™½ç„¶æ‰§è¡Œç»“æœå’Œå€’æ•°ç¬¬äºŒæ¡ä¸€è‡´ï¼Œä½†çµæ´»æ€§éå¸¸ä½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šLuaä¸­çš„æ•°ç»„ä¸‹æ ‡æ˜¯åŸºäº1çš„ã€‚\nLuaå’ŒRedisä¹‹é—´çš„æ•°æ®ç±»å‹è½¬æ¢ Redis to Luaï¼š\n   Redis Value Lua Value     Redis Integer Number   Redis bulk reply String   Redis multi bulk reply Table (with other types nested)   Redis status reply Table with \u0026ldquo;ok\u0026rdquo; field containing status   Redis error Table with \u0026ldquo;err\u0026rdquo; field containing error   Redis nil bulk reply and nil multi reply False (boolean type)    Lua to Redisï¼š\n   Lua Value Redis Value     Number Redis Integer   String Redis bulk reply   Table (array) Redis multi bulk reply   Table with \u0026ldquo;ok\u0026rdquo; field Redis status reply   Table with \u0026ldquo;err\u0026rdquo; field Redis error reply   False (boolean type) Redis nil bulk reply   True (boolean type) Redis integer reply with value of 1    è¿˜æœ‰æœ‰ä¸‰æ¡é‡è¦çš„è§„åˆ™éœ€è¦æ³¨æ„ï¼š\n Luaä¸­æ²¡æœ‰integerå’Œfloatä¹‹åˆ†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯numberç±»å‹ã€‚Redisä¼šå°†Luaä¸­çš„numberè½¬ä¸ºintegerï¼Œå¯¹äºæµ®ç‚¹æ•°æ¥è¯´ï¼Œå…¶å°æ•°éƒ¨åˆ†å°±ä¼šä¸¢å¤±ã€‚å¦‚æœéœ€è¦ä¿ç•™æµ®ç‚¹æ•°çš„å°æ•°éƒ¨åˆ†ï¼Œæˆ‘ä»¬åº”è¯¥é‡‡ç”¨stringæ¥è¿›è¡Œå­˜å‚¨å’ŒæŸ¥è¯¢æ“ä½œ Luaæ•°ç»„ä»¥nilä½œä¸ºç»“æŸæ ‡å¿—ï¼Œæœ‰æ•ˆæ•°ç»„å…ƒç´ ä»…ä½äºç¬¬ä¸€ä¸ªnilå‡ºç°ä¹‹å‰ã€‚æ‰€ä»¥Redisåœ¨è½¬æ¢Luaæ•°ç»„æ—¶ï¼Œé‡åˆ°nilå°±ä¼šåœæ­¢ å½“Luaæ•°ç»„åŒ…å«é”®(å’Œå®ƒä»¬çš„å€¼)æ—¶ï¼Œè½¬æ¢åˆ°Redisçš„æ•°æ®ç±»å‹æ—¶ä¸ä¼šè¢«åŒ…å«è¿›å»  ç®¡ç†è„šæœ¬ ç¼“å­˜è„šæœ¬ å¯¹äºä¸€ä¸ªLuaè„šæœ¬ï¼Œå®¢æˆ·ç«¯é¦–å…ˆé€šè¿‡ç½‘ç»œå°†å®ƒå‘é€ç»™Redisï¼ŒRedisåœ¨æ‰§è¡Œè„šæœ¬å‰éœ€è¦è§£æ(parse)è¯¥è„šæœ¬ï¼Œè„šæœ¬æ‰§è¡Œå®Œæˆåï¼Œæ‰§è¡Œç»“æœä¼šè¢«ä¼ å›ç»™å®¢æˆ·ç«¯ã€‚è„šæœ¬çš„è§£ææ˜¯éœ€è¦ä¸€å®šå¼€é”€çš„ï¼Œæ‰€ä»¥Redisä¼šç»´æŠ¤ä¸€ä¸ªå·²ç¼–è¯‘è„šæœ¬çš„ç¼“å­˜ã€‚å½“æˆ‘ä»¬éœ€è¦åå¤æ‰§è¡ŒæŸä¸ªè„šæœ¬æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **SCRIPT LOAD script**å‘½ä»¤ï¼Œå®ƒä¼šè§£æè„šæœ¬ï¼Œå°†å…¶è½½å…¥ç¼“å­˜å¹¶è¿”å›è„šæœ¬çš„sha1æ‘˜è¦å€¼ï¼Œéšåå¯ä»¥ä½¿ç”¨ **EVALSHA**å‘½ä»¤é€šè¿‡è„šæœ¬çš„sha1æ‘˜è¦è°ƒç”¨è¿™ä¸ªè„šæœ¬ã€‚\n\u0026gt; set s1 \u0026quot;hello\u0026quot; OK \u0026gt; script load \u0026quot;local val=redis.call('GET', KEYS[1]) return val\u0026quot; \u0026quot;dd47ad79bb7b6d7d2b8e0607c344d134412e84e0\u0026quot; \u0026gt; evalsha dd47ad79bb7b6d7d2b8e0607c344d134412e84e0 1 s1 \u0026quot;hello\u0026quot; åªè¦æˆ‘ä»¬æ²¡æœ‰æ‰‹åŠ¨æ‰§è¡Œ SCRIPT FLUSH(æ¸…ç©ºç¼“å­˜ä¸­çš„æ‰€æœ‰è„šæœ¬)æˆ–é‡å¯Redisï¼Œè„šæœ¬å°±ä¼šä¸€ç›´ä½äºç¼“å­˜å½“ä¸­ã€‚**SCRIPT EXISTS sha1 [sha1 ...]**ç”¨äºæ£€æµ‹è„šæœ¬æ˜¯å¦å·²åœ¨ç¼“å­˜å½“ä¸­ã€‚\n\u0026gt; script exists dd47ad79bb7b6d7d2b8e0607c344d134412e84e0 1) (integer) 1 // ç¼“å­˜ä¸­å­˜åœ¨è¯¥è„šæœ¬ å…¶å®ƒå‘½ä»¤ æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬çš„è„šæœ¬å¯èƒ½æœ‰bugæˆ–è€…ç”±äºæŸç§åŸå› å¯¼è‡´å…¶ä¸èƒ½åœ¨é¢„æœŸçš„æ—¶é—´å†…æ‰§è¡Œå®Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **SCRIPT KILL**æ¥ç»ˆæ­¢å½“å‰æ­£åœ¨æ‰§è¡Œçš„è„šæœ¬ã€‚ **SCRIPT DEBUG YES|SYNC|NO**å¯ä»¥å”¤èµ·LDB(Lua Debuger)ï¼Œè¿›ä¸€æ­¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œè„šæœ¬è°ƒè¯•ã€‚\nå½“è„šæœ¬æ‰§è¡Œæ—¶é—´è¿‡é•¿ å½“ä¸€ä¸ªè„šæœ¬å¼€å§‹æ‰§è¡Œï¼Œåœ¨ä¸€æ®µæ—¶é—´å†…(é»˜è®¤ä¸º5ç§’)ï¼ŒRedisæ˜¯ä¸ä¼šæ¥æ”¶å…¶å®ƒå‘½ä»¤çš„ã€‚ å½“æ‰§è¡Œæ—¶é—´è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ï¼ŒRedisä¸ä¼šä¸»åŠ¨ç»ˆæ­¢è¿™ä¸ªè„šæœ¬ï¼Œå› ä¸ºRedisä¿è¯ä»¥åŸå­çš„æ–¹å¼æ‰§è¡ŒLuaè„šæœ¬ï¼Œä¸»åŠ¨ç»ˆæ­¢è„šæœ¬çš„æ‰§è¡Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®å‡ºç°é—®é¢˜ã€‚Redisä¼šé‡‡å–ä»¥ä¸‹æ–¹å¼åº”å¯¹è¿™ç§æƒ…å†µï¼š\n Redisä¼šåœ¨æ—¥å¿—é‡Œé¢è®°å½•è„šæœ¬æ‰§è¡Œæ—¶é—´è¿‡é•¿ Redisä¼šå¼€å§‹æ¥æ”¶å…¶å®ƒå‘½ä»¤ã€‚å¯¹äºè„šæœ¬æ‰§è¡Œå®Œä¹‹å‰æ¥æ”¶åˆ°çš„è¿™äº›å‘½ä»¤ï¼ŒRediså¹¶ä¸ä¼šæ‰§è¡Œå®ƒä»¬ï¼Œè€Œæ˜¯ç›´æ¥ç”¨ä¸€ä¸ªbusy errorè¿›è¡Œå“åº” å¦‚æœè„šæœ¬æ˜¯åªè¯»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è„šæœ¬æ²¡æœ‰è¿›è¡Œä»»ä½•å†™æ“ä½œï¼Œå¯ä»¥ç›´æ¥ç”¨ **SCRIPT KILL**å®‰å…¨çš„ç»ˆæ­¢è¿™ä¸ªè„šæœ¬ å¦‚æœè„šæœ¬å·²ç»è¿›è¡Œè¿‡å†™å…¥æ“ä½œï¼Œé‚£å°±åªèƒ½é€šè¿‡ **SHUTDOWN NOSAVE**å‘½ä»¤æ¥åœæ­¢æœåŠ¡å™¨ï¼Œå¹¶æ”¾å¼ƒæ‰€æœ‰çš„ä¿®æ”¹ã€‚è¿™äº›ä¿®æ”¹åŒ…æ‹¬ï¼šå½“å‰æ‰§è¡Œçš„Luaè„šæœ¬é€ æˆçš„ä¿®æ”¹å’Œæœ€è¿‘ä¸€æ¬¡åˆ·æ–°æ•°æ®åˆ°ç£ç›˜ä¹‹åçš„å…¶å®ƒä¿®æ”¹ã€‚  ä¸ºäº†é˜²æ­¢è„šæœ¬çš„æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œæˆ‘ä»¬éœ€è¦å°½å¯èƒ½åœ°è€ƒè™‘è„šæœ¬åœ°æ‰§è¡Œæ—¶é—´ï¼Œäº‰å–ä½¿ç”¨æœ€çŸ­çš„æ—¶é—´å®Œæˆç›¸åŒçš„å·¥ä½œã€‚å…¶æ¬¡ï¼Œè„šæœ¬å…¶å®å®šä¹‰äº†äº‹åŠ¡è¾¹ç•Œï¼ŒçŸ¥é“è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªå¤§è„šæœ¬æ‹†åˆ†ä¸ºå¤šä¸ªå¯ä»¥è¢«ç»„ç»‡åœ¨ä¸€èµ·çš„åŸå­å•å…ƒã€‚\nå‚è€ƒèµ„æ–™  Redis Lua scripting.  ","href":"/posts/redis/lua_scripting/","title":"Redis Lua è„šæœ¬"},{"content":"Jedisæ˜¯ä¸€ä¸ªJavaç¼–å†™çš„Rediså®¢æˆ·ç«¯ï¼Œæä¾›äº†å®Œæ•´çš„Redis APIã€‚Rediså®¢æˆ·ç«¯é€šå¸¸éœ€è¦å…·å¤‡ä¸‰ç§èƒ½åŠ›ï¼šç®¡ç†Redisè¿æ¥ã€å®ç°Redisåºåˆ—åŒ–åè®®RESP(REdis Serialization Protocol)å’Œå®ç°å¯ä¾›ç¼–ç¨‹äººå‘˜è°ƒç”¨çš„Redis API(GETã€SETç­‰)ã€‚\né™¤äº†Jedisï¼Œè¿˜æœ‰ä¸¤ä¸ªJavaç¼–å†™çš„Rediså®¢æˆ·ç«¯éå¸¸æµè¡Œï¼Œå®ƒä»¬æ˜¯Lettuceå’ŒRedissonã€‚\nè¿æ¥åˆ°RedisæœåŠ¡ Jedis jedis = new Jedis(\u0026#34;127.0.0.1\u0026#34;, 6379); jedis.set(\u0026#34;hello\u0026#34;, \u0026#34;Redis\u0026#34;); assertThat(result, is(\u0026#34;OK\u0026#34;)); String value = jedis.get(\u0026#34;hello\u0026#34;); assertThat(value, is(\u0026#34;Redis\u0026#34;)); jedis.close(); // å…³é—­TCPè¿æ¥ï¼Œé˜²æ­¢å‘ç”Ÿè¿æ¥æ³„æ¼ Jedis APIçš„ä½¿ç”¨å’Œredis-cliéå¸¸ç±»ä¼¼ï¼Œä¾‹å¦‚redis-cliä¸­çš„ SET å’Œ **GET**åœ¨Jedisä¸­å°±æ˜¯jedis.set(...)å’Œjedis.get(...)ã€‚\nåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨Jedis Jediså®ä¾‹ä¼šç»´æŠ¤ä¸€ä¸ªåˆ°Redisçš„TCPè¿æ¥ï¼Œå®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å› æ­¤ï¼Œä¸ºäº†é¿å…é‡åˆ°æœªçŸ¥é—®é¢˜ï¼Œæˆ‘ä»¬ä¸åº”è¯¥è®©åŒä¸€ä¸ªJediså®ä¾‹è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ã€‚ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½åˆ›å»ºä¸€ä¸ªJediså®ä¾‹ä¹Ÿä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºè¿™ä¼šåˆ›å»ºå¤§é‡çš„Socketè¿æ¥ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´æœªçŸ¥é—®é¢˜ã€‚ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨JedisPoolï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç½‘ç»œè¿æ¥æ± ã€‚ä½¿ç”¨JedisPoolæ—¢å¯ä»¥å¸®åŠ©æˆ‘ä»¬å…‹æœéçº¿ç¨‹å®‰å…¨å¼•å‘çš„æœªçŸ¥é—®é¢˜ï¼ŒåŒæ—¶ï¼Œç”±äºå¤ç”¨äº†è¿æ¥ï¼Œåº”ç”¨çš„æ€§èƒ½ä¹Ÿä¼šæœ‰æ‰€æé«˜ã€‚ä¸ºäº†ä½¿ç”¨JedisPoolï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆå§‹åŒ–å®ƒï¼š\nJedisPool jedisPool = new JedisPool(new JedisPoolConfig(), \u0026#34;127.0.0.1\u0026#34;, 6379); JedisPoolåŸºäºApache Commons Pool 2å®ç°ã€‚JedisPoolConfigä¹Ÿç»§æ‰¿äºGenericObjectPoolConfigï¼Œå®ƒåŒ…å«äº†ä¸€äº›éå¸¸æœ‰ç”¨çš„è¿æ¥æ± é»˜è®¤å€¼ã€‚æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆä½¿ç”¨JedisPool:\ntry (Jedis jedis = jedisPool.getResource()) { String result = jedis.set(\u0026#34;hello\u0026#34;, \u0026#34;Redis\u0026#34;); assertThat(result, is(\u0026#34;OK\u0026#34;)); String value = jedis.get(\u0026#34;hello\u0026#34;); assertThat(value, is(\u0026#34;Redis\u0026#34;)); } jedisPool.close(); é€‰æ‹©æ­£ç¡®çš„Javaç±»å»è¿æ¥Redis    Thread-safe Deployment Type Connection     No Single Redis Jedis   No Redis Enterprise Jedis   Yes Single Redis JedisPool   Yes Redis Enterprise JedisPool   Yes Redis Sentinel JedisSentinelPool   Yes RedisCluster JedisCluster    Java-Redisç±»å‹æ˜ å°„    Redis Type Java Type     string String   list List   set Set   hash Map\u0026lt;String, String\u0026gt;   float Double   integer Long    Pipelining pipelineå†…çš„æ‰€æœ‰å‘½ä»¤éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå®ƒä»¬ä¸æ˜¯ä¸€ä¸ªåŸå­çš„æ•´ä½“ã€‚\nPipeline p = jedis.pipelined(); Response\u0026lt;Long\u0026gt; hsetResponse = p.hset(statusKey, \u0026#34;available\u0026#34;, \u0026#34;true\u0026#34;); Response\u0026lt;Long\u0026gt; expireResponse = p.expire(statusKey, 1000); Response\u0026lt;Long\u0026gt; saddResponse = p.sadd(availableKey, \u0026#34;1\u0026#34;); p.sync(); // é€šè¿‡pipelineå‘é€æ‰€æœ‰çš„å‘½ä»¤å¹¶è·å–è¿”å›å€¼ assertThat(hsetResponse.get(), is(1L)); assertThat(expireResponse.get(), is(1L)); assertThat(saddResponse.get(), is(1L)); Transactions å¾ˆå¤šå®¢æˆ·ç«¯ç”¨pipelineå®ç°äº‹åŠ¡ï¼Œè¿™ä¹ˆåšæ—¢é«˜æ•ˆï¼Œåˆèƒ½ä¿è¯åŸå­æ€§ã€‚\nTransaction t = jedis.multi(); Response\u0026lt;Long\u0026gt; hsetResponse = t.hset(statusKey, \u0026#34;available\u0026#34;, \u0026#34;true\u0026#34;); Response\u0026lt;Long\u0026gt; expireResponse = t.expire(statusKey, 1000); Response\u0026lt;Long\u0026gt; saddResponse = t.sadd(availableKey, \u0026#34;1\u0026#34;); t.exec(); assertThat(hsetResponse.get(), is(1L)); assertThat(expireResponse.get(), is(1L)); assertThat(saddResponse.get(), is(1L)); å‚è€ƒèµ„æ–™  Jedis wiki.  ","href":"/posts/redis/jedis/","title":"Jedis"},{"content":" æœ¬æ–‡ä¸­ç»å¤§éƒ¨åˆ†å†…å®¹å’Œå›¾ç‰‡éƒ½æ¥è‡ª High Performance Java Persistence: Get the most out of your persistence layerã€‚\n äº‹åŠ¡ï¼ˆTransactionï¼‰ æ˜¯ç”±ä¸€ç»„è¯»å†™æ“ä½œç»„æˆçš„ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ‰§è¡Œå•å…ƒï¼Œè¿™ç»„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚æ ¹æ®å®šä¹‰ï¼Œä¸€ä¸ªäº‹åŠ¡å¿…é¡»æ˜¯åŸå­çš„ï¼ˆatomicï¼‰ã€ä¸€è‡´çš„ï¼ˆconsistentï¼‰ã€éš”ç¦»çš„ï¼ˆisolatedï¼‰å’ŒæŒä¹…çš„ï¼ˆdurableï¼‰ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠè¿™å››å¤§ç‰¹æ€§ç§°ä¸º ACIDã€‚\nåŸå­æ€§ å¤šä¸ªæ“ä½œå¯ä»¥æ„æˆä¸€ä¸ªé€»è¾‘å·¥ä½œå•å…ƒã€‚å½“ä¸”ä»…å½“å·¥ä½œå•å…ƒå†…çš„æ‰€æœ‰æ“ä½œéƒ½æˆåŠŸï¼Œè¿™ä¸ªå·¥ä½œå•å…ƒæ‰æˆåŠŸï¼Œè‹¥æœ‰æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œåˆ™å¿…é¡»å›æ»šæ‰€æœ‰å·²ç»æ‰§è¡Œçš„æ“ä½œå¹¶æ¢å¤åˆ°æœªæ‰§è¡Œæ—¶çš„çŠ¶æ€ï¼Œè¿™å°±æ˜¯äº‹åŠ¡çš„ åŸå­æ€§ï¼ˆAtomicityï¼‰ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒåŸå­æ€§å°±æ˜¯â€œall-or-nothingâ€ã€‚\nä¸€è‡´æ€§ ä¸€è‡´æ€§å’Œäº‹åŠ¡çŠ¶æ€çš„æ”¹å˜ç´§å¯†ç›¸å…³çš„ï¼Œå½“äº‹åŠ¡æ¶‰åŠä¿®æ”¹æ“ä½œæ—¶ï¼Œå¯ä»¥å°†å…¶çœ‹ä½œæ˜¯çŠ¶æ€è¿ç§»ï¼Œæ•°æ®åº“ä¼šä»ä¸€ä¸ªæœ‰æ•ˆçŠ¶æ€è¿ç§»åˆ°å¦ä¸€ä¸ªæœ‰æ•ˆçŠ¶æ€ã€‚ä¸€è‡´æ€§(Consistencyï¼‰ å°±æ˜¯æŒ‡ç³»ç»Ÿä»ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€è¿ç§»åˆ°å¦ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€ã€‚\né‚£ä¹ˆè¯¥å¦‚ä½•ç†è§£â€œæ­£ç¡®çš„çŠ¶æ€â€å‘¢ï¼Ÿæˆ‘ä»¬åœ¨è®¾è®¡æ•°æ®åº“æ—¶ï¼Œé€šå¸¸ä¼šè§„å®šå­—æ®µçš„ç±»å‹ã€é•¿åº¦ä»¥åŠæ˜¯å¦ä¸ºç©ºç­‰ï¼Œè¿™äº›å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„è§„åˆ™ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜ä¼šç»™åˆ—åŠ ä¸Šä¸€äº›çº¦æŸï¼ˆconstraintï¼‰ï¼Œæ¯”å¦‚ä¸»é”®çº¦æŸã€å¤–é”®çº¦æŸã€å”¯ä¸€çº¦æŸå’Œå„ç§è‡ªå®šä¹‰çº¦æŸã€‚åªæœ‰å½“æ•°æ®æ»¡è¶³æ‰€æœ‰çš„è§„åˆ™å’Œçº¦æŸæ—¶ï¼Œå®ƒæ‰æ˜¯ æœ‰æ•ˆçš„ï¼Œå®ƒçš„çŠ¶æ€æ‰æ˜¯æ­£ç¡®çš„ã€‚ä¸€è‡´æ€§ä¿è¯åªæœ‰æœ‰æ•ˆçš„æ•°æ®æ‰ä¼šè¢«å†™å…¥æ•°æ®åº“ä¸­ï¼Œè‹¥æ•°æ®åœ¨äº‹åŠ¡æ‰§è¡Œåå¤„äºæ— æ•ˆçŠ¶æ€ï¼ˆå³è¿åè§„åˆ™æˆ–çº¦æŸï¼‰ï¼Œæ•´ä¸ªäº‹åŠ¡éƒ½ä¼šå›æ»šï¼Œæ‰€æœ‰çš„ä¿®æ”¹éƒ½ä¼šè¢«æ’¤é”€ï¼Œæ•°æ®åº“ä¼šå›åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚\nä¸€è‡´æ€§æ˜¯ç»´æŠ¤æ•°æ®å®Œæ•´æ€§ï¼ˆintegrityï¼‰çš„å…³é”®ã€‚\néš”ç¦»æ€§ äº‹åŠ¡çš„ éš”ç¦»æ€§(Isolationï¼‰ å®šä¹‰çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡äº§ç”Ÿçš„å½±å“å¯¹å…¶å®ƒäº‹åŠ¡çš„å¯è§ç¨‹åº¦ã€‚ä¸ºäº†æé«˜ååé‡ï¼Œæ•°æ®åº“ç³»ç»Ÿé€šå¸¸ä¼šå…è®¸å¤šä¸ªè¿æ¥å¯¹æ•°æ®è¿›è¡Œå¹¶å‘è®¿é—®ã€‚ä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼ˆintegrityï¼‰ï¼Œæ•°æ®åº“ç³»ç»Ÿå¿…é¡»å¯¹è¿™äº›å¹¶å‘çš„è¯»å†™æ“ä½œè¿›è¡Œæ§åˆ¶ã€‚\nè‹¥å‡ ä¸ªäº‹åŠ¡ä¸ç®¡ä»¥ä½•ç§é¡ºåºæ‰§è¡Œï¼Œæœ€ç»ˆç³»ç»Ÿçš„çŠ¶æ€éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåˆ™è¿™å‡ ä¸ªäº‹åŠ¡æ˜¯ å¯ä¸²è¡ŒåŒ–çš„ï¼ˆserilizableï¼‰ã€‚å¦‚æœå‡ ä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œï¼Œå³ä½¿æ¯ä¸ªäº‹åŠ¡éƒ½èƒ½ç¡®ä¿ä¸€è‡´æ€§å’ŒåŸå­æ€§ï¼Œå®ƒä»¬çš„æ“ä½œä¹Ÿå¯èƒ½ä¼šä»¥æˆ‘ä»¬æ„æ–™ä¹‹å¤–çš„æŸç§é¡ºåºäº¤å‰æ‰§è¡Œï¼Œæœ€ç»ˆå¯¼è‡´ä¸ä¸€è‡´çŠ¶æ€ã€‚ åªæœ‰å½“è¿™äº›äº‹åŠ¡æ˜¯å¯ä¸²è¡ŒåŒ–çš„ï¼Œæœ€ç»ˆçš„ç»“æœæ‰ä¼šä¸€è‡´ã€‚å¯ä¸²è¡ŒåŒ–æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œä½†æ˜¯æ­¤æ—¶æ•°æ®åº“çš„æ€§èƒ½å¯èƒ½ä¼šå¾ˆä½ï¼Œå› ä¸ºäº‹åŠ¡éƒ½æ˜¯ä¸²è¡Œçš„äº†ï¼Œå¹¶å‘çš„ä¼˜åŠ¿è¡ç„¶æ— å­˜ã€‚\næ•°æ®åº“ä¸­å…è®¸å¤šä¸ªä¸åŒçš„éš”ç¦»çº§åˆ«ï¼Œè¿™äº›éš”ç¦»çº§åˆ«å®é™…ä¸Šæ˜¯åœ¨æ€§èƒ½ä¸æ•°æ®å®Œæ•´æ€§ä¹‹é—´åšæƒè¡¡çš„ç»“æœã€‚éš”ç¦»çº§åˆ«è¶Šä½ï¼Œå¹¶å‘åº¦è¶Šé«˜ï¼Œæ•°æ®çš„å®Œæ•´æ€§å°±è¶Šå·®ï¼Œåä¹‹ï¼Œéš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œå¹¶å‘åº¦è¶Šä½ï¼Œæ•°æ®çš„å®Œæ•´æ€§å°±è¶Šå¥½ã€‚å¯ä¸²è¡ŒåŒ–æ˜¯å”¯ä¸€ä¸€ä¸ªæ²¡æœ‰æŸåæ•°æ®å®Œæ•´æ€§çš„éš”ç¦»çº§åˆ«ã€‚\nå¹¶å‘æ§åˆ¶ å¹¶å‘è®¿é—®å¾ˆå®¹æ˜“å‡ºç°æ•°æ®å†²çªï¼Œé€šå¸¸æœ‰ä¸¤ç§è§£å†³æ•°æ®å†²çªçš„åŸºæœ¬ç­–ç•¥ï¼š\n å†²çªé¿å…ï¼šä½¿ç”¨é”æ§åˆ¶å…±äº«èµ„æºï¼Œæ¯”å¦‚ä¸¤é˜¶æ®µé”ï¼ˆ2PL, two-phase lockingï¼‰ å†²çªæ£€æµ‹ï¼šå¹¶å‘æ€§æ›´å¥½ï¼Œä½†å¯èƒ½å¯¼è‡´æ•°æ®å¼‚å¸¸ï¼Œæ¯”å¦‚å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCC, Multi-Version Concurrency Controlï¼‰  ä¸¤é˜¶æ®µé” ä¸ºäº†å‡å°‘è®¿é—®å…±äº«èµ„æºæ—¶å‘ç”Ÿçš„å†²çªï¼Œå…³ç³»å‹æ•°æ®åº“æ”¯æŒå¤šç²’åº¦é”ã€‚æ•°æ®åº“å¯¹è±¡å¤©ç”Ÿå°±æ˜¯å±‚æ¬¡ç»“æ„çš„ï¼Œä¸€ä¸ªé€»è¾‘è¡¨ç©ºé—´å¯èƒ½è¢«æ˜ å°„åˆ°å¤šä¸ªæ•°æ®åº“æ–‡ä»¶ï¼Œè€Œä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶åˆç”±å¤šä¸ªæ•°æ®é¡µæ„æˆï¼Œæ¯é¡µåˆåŒ…å«å¾ˆå¤šè¡Œâ€¦â€¦ å› æ­¤ï¼Œä¸åŒçš„æ•°æ®åº“å¯¹è±¡éƒ½å¯ä»¥è·å¾—é”ã€‚\nä½çº§åˆ«çš„é”ï¼ˆæ¯”å¦‚ï¼šè¡Œçº§é”ï¼‰ç²’åº¦è¾ƒå°ï¼Œå‡å°äº†ç«äº‰çš„å¯èƒ½ï¼Œå¯ä»¥æä¾›æ›´å¥½çš„å¹¶å‘æ§åˆ¶ã€‚ç„¶è€Œï¼Œæ¯ä¸ªé”éƒ½æ˜¯ä¼šæ¶ˆè€—èµ„æºçš„ï¼Œç»´æŒå¤§é‡çš„ä½çº§åˆ«é”ï¼Œä¹Ÿä¼šå¸¦æ¥å¯è§‚çš„èµ„æºå¼€é”€ã€‚å› æ­¤ï¼Œæ•°æ®åº“å¯èƒ½ä¼šå†³å®šç”¨ä¸€ä¸ªç¨å¾®é«˜çº§åˆ«çš„é”ä»£æ›¿è¿™äº›ä½çº§åˆ«çš„é”ï¼Œè¿™å°±æ˜¯é”å‡çº§ã€‚è¿™å°±æ˜¯å¯å¹¶å‘æ€§å’Œèµ„æºæ¶ˆè€—ä¹‹é—´çš„ä¸€ä¸ªæƒè¡¡ç‚¹ã€‚\nä¸åŒæ•°æ®åº“çš„é”éƒ½æœ‰è‡ªå·±çš„å±‚çº§ç»“æ„ï¼Œæœ€å¸¸è§çš„é”æœ‰ä¸¤ç§ï¼š\n å…±äº«é”ï¼ˆè¯»é”ï¼‰ï¼šåŠ é”åï¼Œåªå…è®¸å¹¶å‘è¯»ï¼Œä¸å…è®¸å†™ äº’æ–¥é”ï¼ˆå†™é”ï¼‰ï¼šåŠ é”åï¼Œæ—¢ä¸å…è®¸å†™ä¹Ÿä¸å…è®¸è¯»  ä¸¤é˜¶æ®µé”ä¿è¯äº†å¯ä¸²è¡Œæ€§ï¼Œåè®®è¦æ±‚æ¯ä¸ªäº‹åŠ¡åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š\n å¢é•¿é˜¶æ®µï¼šåªå¯è·å–é”ï¼Œä¸å¯é‡Šæ”¾é” ç¼©å‡é˜¶æ®µï¼šåªå¯é‡Šæ”¾é”ï¼Œä¸å¯è·å–é” æœ€åˆï¼Œäº‹åŠ¡å¤„äºå¢é•¿é˜¶æ®µï¼Œäº‹åŠ¡å¯ä»¥æ ¹æ®éœ€è¦è·å–é”ã€‚ä¸€æ—¦äº‹åŠ¡å¼€å§‹é‡Šæ”¾é”ï¼Œä¾¿è¿›å…¥ç¼©å‡é˜¶æ®µï¼Œå¹¶ä¸”ä¸èƒ½å†å‘å‡ºåŠ é”è¯·æ±‚ã€‚  å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ æœ€åˆï¼Œæ‰€æœ‰çš„æ•°æ®åº“ç³»ç»Ÿéƒ½é‡‡ç”¨ä¸¤é˜¶æ®µé”å®ç°å¯ä¸²è¡ŒåŒ–çš„äº‹åŠ¡ã€‚åæ¥ï¼Œå¾ˆå¤šæ•°æ®åº“å‚å•†æ”¹ç”¨äº†å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(MVCCï¼‰ã€‚\nå°½ç®¡é”å¯ä»¥æä¾›å¯ä¸²è¡ŒåŒ–çš„äº‹åŠ¡è°ƒåº¦ï¼Œä½†æ˜¯é”ç«äº‰è¿˜æ˜¯ä¼šå¯¹äº‹åŠ¡çš„å“åº”æ—¶é—´å’Œå¯æ‰©å±•æ€§é€ æˆå½±å“ã€‚ä¸ºäº†å…‹æœè¿™ä¸ªç¼ºç‚¹ï¼Œæ•°æ®åº“å‚å•†ä»¬é€‰æ‹©äº†ä¹è§‚å¹¶å‘æ§åˆ¶æœºåˆ¶ã€‚å¦‚æœè¯´ä¸¤é˜¶æ®µé”ä½¿ç”¨çš„æ˜¯å†²çªé¿å…ç­–ç•¥ï¼Œé‚£ä¹ˆ MVVC ä½¿ç”¨çš„å°±æ˜¯å†²çªæ£€æµ‹ç­–ç•¥ã€‚\nä¸ºäº†é˜²æ­¢é˜»å¡ï¼Œæ•°æ®åº“è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œç„¶åå¯ä»¥é‡å»ºæ•°æ®åº“è®°å½•çš„æ—©æœŸç‰ˆæœ¬ï¼Œæœªæäº¤çš„æ”¹å˜å¯èƒ½å¯¹åæ¥çš„ç”¨æˆ·ä¸å¯è§ã€‚æ²¡æœ‰äº†é”çš„ååŠ©ï¼Œå¯ä¸²è¡ŒåŒ–è°ƒåº¦çš„å®ç°å˜å¾—æ›´åŠ å›°éš¾ï¼Œæ•°æ®åº“å¼•æ“å¿…é¡»åˆ†æå½“å‰çš„äº¤å‰æ“ä½œå¹¶æ£€æµ‹å½±å“ä¸²è¡ŒåŒ–çš„å¼‚å¸¸æ“ä½œã€‚\nMVCC æ˜¯é€šè¿‡ä¿å­˜æ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§æ¥å®ç°çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡æ‰§è¡Œå¤šé•¿æ—¶é—´ï¼Œæ¯ä¸ªäº‹åŠ¡çœ‹åˆ°çš„æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚äº‹åŠ¡å¼€å§‹æ—¶é—´çš„ä¸åŒï¼Œå³ä½¿æ˜¯åŒä¸€æ—¶åˆ»çš„åŒä¸€å¼ è¡¨ï¼Œä¸åŒäº‹ç‰©çœ‹åˆ°çš„æ•°æ®ä¹Ÿå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚\næ•°æ®åº“ä¸­å…è®¸å¤šä¸ªä¸åŒçš„éš”ç¦»çº§åˆ«ï¼Œè¿™äº›éš”ç¦»çº§åˆ«å®é™…ä¸Šæ˜¯åœ¨æ€§èƒ½ä¸æ•°æ®å®Œæ•´æ€§ä¹‹é—´åšæƒè¡¡çš„ç»“æœã€‚éš”ç¦»çº§åˆ«è¶Šä½ï¼Œå¹¶å‘åº¦è¶Šé«˜ï¼Œæ•°æ®çš„å®Œæ•´æ€§å°±è¶Šå·®ï¼Œåä¹‹ï¼Œéš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œå¹¶å‘åº¦è¶Šä½ï¼Œæ•°æ®çš„å®Œæ•´æ€§å°±è¶Šå¥½ã€‚å¯ä¸²è¡ŒåŒ–æ˜¯å”¯ä¸€ä¸€ä¸ªæ²¡æœ‰æŸåæ•°æ®å®Œæ•´æ€§çš„éš”ç¦»çº§åˆ«ã€‚\næ•°æ®åº“å¼‚è±¡ ä¸¥æ ¼ä¿è¯æ•°æ®å®Œæ•´æ€§çš„ä»£ä»·å¯èƒ½ä¼šéå¸¸é«˜ï¼Œå› æ­¤æœ‰å¿…è¦é™ä½å¯¹äº‹åŠ¡ä¸²è¡ŒåŒ–çš„ä¿è¯ç¨‹åº¦ï¼Œä½¿ç”¨å¤šä¸ªéš”ç¦»çº§åˆ«ï¼Œä½†è¿™ä¼šå¯¼è‡´æ•°æ®åº“å¼‚è±¡ï¼ˆPhenomenaï¼‰çš„å‡ºç°ã€‚\nSQL-92 æ ‡å‡†æå‡ºäº†ä¸‰ç§å¼‚è±¡ï¼š\n è„è¯»ï¼ˆdirty readï¼‰ ä¸å¯é‡å¤è¯»ï¼ˆnon-repeatable readï¼Œä¹Ÿå« fuzzy readï¼‰ å¹»è¯»ï¼ˆphantom readï¼‰  ç°å®ä¸­ï¼Œè¿˜æœ‰å…¶å®ƒçš„å¼‚è±¡ï¼š\n è„å†™ï¼ˆdirty writeï¼‰ è¯»åï¼ˆread skewï¼‰ å†™åï¼ˆwrite skewï¼‰ æ›´æ–°ä¸¢å¤±ï¼ˆloss updateï¼‰  è„å†™ å½“ä¸¤ä¸ªå¹¶å‘äº‹åŠ¡è¢«å…è®¸åŒæ—¶ä¿®æ”¹åŒä¸€è¡Œæ—¶ï¼Œè„å†™å°±å‘ç”Ÿäº†ã€‚\nå‘ç”Ÿè„å†™æ—¶ï¼Œè‹¥ä¸¤ä¸ªäº‹åŠ¡åˆ†åˆ«æäº¤æˆ–å›æ»šï¼Œåˆ™äº‹åŠ¡çš„ç»“æœæ˜¯æ— æ³•ç¡®å®šçš„ã€‚å¦‚æœä¸¤ä¸ªäº‹åŠ¡éƒ½æäº¤ï¼Œåæäº¤çš„äº‹åŠ¡ä¼šè¦†ç›–å…ˆæäº¤çš„äº‹åŠ¡çš„æ“ä½œç»“æœï¼Œé€ æˆæ›´æ–°ä¸¢å¤±ã€‚å¦‚æœç¬¬ä¸€ä¸ªäº‹åŠ¡é€‰æ‹©å›æ»šï¼Œæ•°æ®åº“å¼•æ“åˆ™ä¸å¾—ä¸è¿›è¡ŒæŠ‰æ‹©ï¼š\n å°†æ•°æ®æ¢å¤åˆ°ç¬¬ä¸€ä¸ªäº‹åŠ¡åšå‡ºæ”¹å˜ä¹‹å‰çš„é‚£ä¸€ä¸ªç‰ˆæœ¬ï¼ˆä¸Šå›¾ä¸­å³ï¼štitle:'Transactions'ï¼‰ï¼Œè¿™å›å¯¼è‡´ç¬¬äºŒä¸ªäº‹åŠ¡æœªæäº¤çš„å˜æ›´è¢«è¦†ç›–ã€‚ å®ƒçŸ¥é“æ•°æ®æœ‰ä¸€ä¸ªè¾ƒæ–°çš„ç‰ˆæœ¬ï¼ˆä¸Šå›¾ä¸­å³ï¼štitle:'BASE'ï¼‰ï¼Œä½†å¦‚æœç¬¬äºŒä¸ªäº‹åŠ¡å†³å®šå›æ»šï¼Œå›æ»šçš„ç»“æœå°†æ˜¯ç¬¬ä¸€ä¸ªäº‹åŠ¡è¿˜æœªæäº¤çš„å˜æ›´ï¼ˆä¸Šå›¾ä¸­å³ï¼štitle:'ACID'ï¼‰ã€‚  å¦‚æœæ•°æ®åº“å¼•æ“ä¸èƒ½é˜»æ­¢è„å†™ï¼Œå°±ä¸èƒ½ä¿è¯å›æ»šï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰å¯é çš„å›æ»šæœºåˆ¶ï¼ŒåŸå­æ€§æ˜¯æ— æ³•å®ç°çš„ã€‚å› æ­¤ï¼Œæ‰€æœ‰çš„æ•°æ®åº“éƒ½å¿…é¡»é˜»æ­¢è„å†™ã€‚\næœ€ä½çš„éš”ç¦»çº§åˆ«â€”â€”è¯»å–æœªæäº¤ å°±å¯ä»¥é¿å…è„å†™ã€‚\nè„è¯» è§£å†³è„å†™ä¹‹åï¼Œæˆ‘ä»¬é¢ä¸´çš„é—®é¢˜æ˜¯è„è¯»ã€‚è‹¥ä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ”¹å˜ï¼Œå°±ä¼šå‘ç”Ÿè„è¯»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯»å–æœªæäº¤è¿™ä¸€éš”ç¦»çº§åˆ«ä¸èƒ½é˜²æ­¢è„è¯»ã€‚ä½¿ç”¨æœªæäº¤çš„æ•°æ®è¿›è¡Œå†³ç­–æ˜¯æœ‰é£é™©çš„ï¼Œå› ä¸ºæœªæäº¤çš„æ•°æ®å¯èƒ½å›æ»šã€‚\nä¸ºäº†é˜²æ­¢è„è¯»ï¼Œæ•°æ®åº“å¼•æ“å¿…é¡»é˜²æ­¢å…¶ä»–çš„å¹¶å‘äº‹åŠ¡è¯»å–å½“å‰äº‹åŠ¡æœªæäº¤çš„æ”¹å˜ã€‚ä¸€ç§é˜²æ­¢è„è¯»çš„ç®€å•æ–¹æ³•æ˜¯å¯¹æœªæäº¤çš„è®°å½•åŠ é”ï¼Œä½†å¦‚æœè·å¾—é”çš„äº‹åŠ¡è¿è¡Œæ—¶é—´è¿‡é•¿çš„è¯ï¼Œå…¶å®ƒäº‹åŠ¡åªæœ‰ç­‰åˆ°é”è¢«é‡Šæ”¾åæ‰èƒ½è¯»å–åˆ°ç›¸å…³çš„è®°å½•ã€‚æ‰€ä»¥å®è·µä¸­ä¸€èˆ¬ä¸é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œå› ä¸ºé”ä¼šå¼•èµ·ç«äº‰ï¼Œè€Œç«äº‰ä¼šå¯¹å¯ä¼¸ç¼©æ€§ã€‚æ—¢ç„¶ undo log å·²ç»ä¿å­˜äº†æ¯ä¸ªæœªæäº¤è®°å½•çš„ä¹‹å‰ç‰ˆæœ¬ï¼Œé‚£ä¹ˆæ•°æ®åº“å¼•æ“å°±å¯ä»¥åœ¨å…¶å®ƒå¹¶å‘äº‹åŠ¡æŸ¥è¯¢ä¸­ä½¿ç”¨å®ƒå»æ¢å¤ä¹‹å‰ç‰ˆæœ¬çš„æ•°æ®ã€‚\néš”ç¦»çº§åˆ«â€”â€”è¯»å–å·²æäº¤å¯ä»¥é˜²æ­¢è„è¯»ã€‚è¯»å–æœªæäº¤çš„ä½¿ç”¨åœºæ™¯å¾ˆå°‘ï¼ˆä»…é€‚ç”¨äºå…è®¸è„è¯»çš„è¦æ±‚æ²¡é‚£ä¹ˆä¸¥æ ¼çš„æŸ¥è¯¢ï¼‰ï¼Œæ‰€ä»¥åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¯»å–å·²æäº¤é€šå¸¸æ˜¯æœ€ä½çš„éš”ç¦»çº§åˆ«ã€‚\nä¸å¯é‡å¤è¯» è§£å†³äº†è„è¯»ï¼Œæˆ‘ä»¬é¢ä¸´çš„é—®é¢˜æ˜¯ä¸å¯é‡å¤è¯»ã€‚è‹¥ä¸€ä¸ªäº‹åŠ¡è¦å¤šæ¬¡è¯»å–æ•°æ®åº“ä¸­çš„æ•°æ® A åˆæ²¡æœ‰ç»™ A åŠ  å…±äº«é” æ—¶ï¼Œå…¶å®ƒäº‹åŠ¡å¯èƒ½åœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ç»“æŸä¹‹å‰ä¿®æ”¹æ‰ A çš„å€¼ï¼Œæœ€ç»ˆå¯¼è‡´ç¬¬ä¸€ä¸ªäº‹åŠ¡å¤šæ¬¡è¯»å–åˆ°çš„å†…å®¹ä¸ä¸€è‡´ï¼Œè¿™å°±æ˜¯ä¸å¯é‡å¤è¯»ã€‚\nå½“äº‹åŠ¡åŸºäºç¬¬ä¸€æ¬¡è¯»å–åˆ°çš„å€¼è¿›è¡Œå†³ç­–æ—¶ï¼Œå°±å¯èƒ½é‡åˆ°é—®é¢˜ã€‚å› ä¸ºè¿™æ¡è®°å½•å¯èƒ½åœ¨å†³ç­–æœŸé—´è¢«ä¿®æ”¹ï¼Œå¯ä»¥è®¤ä¸ºäº‹åŠ¡åŸºäºé”™è¯¯çš„æ•°æ®åšå‡ºäº†å†³ç­–ã€‚\nç°åœ¨å¾ˆå¤šæ•°æ®åº“éƒ½è½¬å‘äº† MVCC æ¨¡å‹ï¼Œå…±äº«é”ä¸å†æ˜¯é˜²æ­¢ä¸å¯é‡å¤è¯»çš„å”¯ä¸€é€”å¾„äº†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯é‡å¤è¯» å’Œ å¯ä¸²è¡ŒåŒ– è¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«éƒ½å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚åœ¨ è¯»å–å·²æäº¤ è¿™ä¸€éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ˜¾å¼è·å–å…±äº«é”ï¼ˆæ¯”å¦‚ï¼šSELECT FOR SHAREï¼‰ä¹Ÿå¯ä»¥é¿å…ä¸å¯é‡å¤è¯»ã€‚\nå¯é‡å¤è¯»çš„å«ä¹‰æ˜¯ï¼šåªå…è®¸è¯»å–å·²æäº¤çš„æ•°æ®ï¼Œè€Œä¸”åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®é¡¹æœŸé—´ï¼Œä¸å…è®¸å…¶å®ƒäº‹åŠ¡ä¿®æ”¹è¿™ä¸ªæ•°æ®é¡¹.\nä¸€äº› ORM æ¡†æ¶ï¼ˆæ¯”å¦‚ JPA/Hibernateï¼‰æä¾›äº†åº”ç”¨çº§çš„å¯é‡å¤è¯»ã€‚æ‰€æœ‰æ£€ç´¢å‡ºæ¥çš„å®ä½“çš„ç¬¬ä¸€ä¸ªå¿«ç…§éƒ½ä¼šè¢«ç¼“å­˜åœ¨å½“å‰è¿è¡Œçš„æŒä¹…åŒ–ä¸Šä¸‹æ–‡ï¼ˆPersistence Contextï¼‰ä¸­ï¼Œåç»­æŸ¥è¯¢æ“ä½œéƒ½ä¼šè¿”å›å·²ç»ç¼“å­˜çš„å¯¹è±¡ã€‚\nå¹»è¯» å½“æˆ‘ä»¬è§£å†³äº†ä¸å¯é‡å¤è¯»é—®é¢˜ä¹‹åï¼Œè¿˜ä¼šç¢°åˆ°å¹»è¯»çš„æƒ…å†µã€‚ å¹»è¯»å‘ç”Ÿåœ¨æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡ T1 åœ¨è¯»å–ä¸€ä¸ªèŒƒå›´å†…çš„æ•°æ®æ—¶ï¼ˆåŒ…æ‹¬ç»Ÿè®¡æŸ¥è¯¢ï¼‰æ²¡æœ‰åŠ é”ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ T2 æ‰§è¡Œäº†å’Œä¹‹å‰èŒƒå›´æœ‰äº¤é›†çš„æ’å…¥æ“ä½œã€‚æ¯”å¦‚ T1 åœ¨ T2 ä¹‹å‰è¯»åˆ°çš„ A çš„å€¼æ˜¯ 3ï¼Œä½† T2 æ‰§è¡Œæ—¶æœ‰äº¤é›†ï¼Œæ’å…¥äº†æ–°çš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ A å˜æˆäº† 4ï¼Œå¦‚æœ T1 å†æ¬¡è¯»å– A çš„è¯ï¼Œå°±ä¼šå‘ç° A å˜æˆäº† 4 è€Œä¸æ˜¯ä¹‹å‰çš„ 3ï¼Œè¿™å°±æ˜¯å¹»è¯»ã€‚\nä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„åŒºåˆ«ï¼šä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯æ•°æ®çš„ä¿®æ”¹ï¼Œæ¯”å¦‚å¤šæ¬¡è¯»å–åŒä¸€æ¡è®°å½•å‘ç°å…¶ä¸­æŸäº›åˆ—è¢«ä¿®æ”¹ï¼›è€Œå¹»è¯»çš„é‡ç‚¹åœ¨äºæ•°æ®çš„æ’å…¥æˆ–åˆ é™¤ï¼Œæ¯”å¦‚å¤šæ¬¡è¯»å–ä¸€ä¸ªé›†åˆå†…çš„æ•°æ®ï¼Œä¼šå‘ç°è¯¥é›†åˆå†…çš„æ•°æ®å˜å¤šäº†æˆ–è€…å˜å°‘äº†ã€‚\néš”ç¦»çº§åˆ«â€”â€”å¯ä¸²è¡ŒåŒ–å¯ä»¥é¿å…å¹»è¯»ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦äº‹åŠ¡å®Œå…¨ä¸²è¡ŒåŒ–ï¼Œå¹¶å‘æ€§å°±éå¸¸å¼±äº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¡Œé”è§£å†³ä¸äº†å¹»è¯»ï¼Œå› ä¸ºå³ä½¿é”ä½æ‰€æœ‰çš„è®°å½•ï¼Œä¹Ÿé˜»æ­¢ä¸äº†æ’å…¥æ–°çš„æ•°æ®ã€‚MySQL çš„ InnoDB å¼•æ“å¼•å…¥äº† é—´éš™é”ï¼ˆGap Lockï¼‰ï¼Œå®ƒèƒ½é”ä½è®°å½•ä¹‹é—´çš„â€œé—´éš™â€ï¼Œè§£å†³å¹»è¯»ã€‚\nè¯»å è¯»åå‘ç”Ÿåœ¨å½“ä¸¤å¼ æ•°æ®è¡¨ä¹‹é—´æœ‰ä¸€ä¸ªæ€»çš„çº¦æŸçš„æ—¶å€™ã€‚æ¯”å¦‚è¡¨ A å’Œè¡¨ B å¿…é¡»åŒæ­¥æ”¹å˜ï¼Œå½“äº‹åŠ¡ T1 åœ¨è¯»å–è¡¨ A çš„æ•°æ®é¡¹ a å’Œè¡¨ B çš„æ•°æ®é¡¹ b æ—¶ï¼Œäº‹åŠ¡ T2 æ’è¿›æ¥æ›´æ–°äº†æ•°æ®é¡¹ a å’Œ bï¼Œæœ€ç»ˆå¯¼è‡´äº‹åŠ¡ T1 è¯»åˆ°äº† a çš„æ—§å€¼å’Œ b çš„æ–°å€¼ï¼Œè¿™å°±æ˜¯è¯»åã€‚\nä¸ºäº†è§£å†³è¯»åï¼Œäº‹åŠ¡ T1 åœ¨è¯»å–æ•°æ®æ˜¯å¯ä»¥ ä½¿ç”¨å…±äº«é” é˜²æ­¢äº‹åŠ¡ T2 æ›´æ–°æ•°æ®ï¼Œä¹Ÿå¯ä»¥åœ¨æ£€æµ‹åˆ°æ•°æ®è¿åçº¦æŸæ—¶è¿›è¡Œå›æ»šã€‚\nå†™å å†™åå’Œè¯»åç±»ä¼¼ã€‚å‡è®¾è¡¨ A çš„æ•°æ®é¡¹ a å’Œè¡¨ B çš„æ•°æ®é¡¹ b åœ¨å•ä¸ªäº‹åŠ¡å†…å¿…é¡»åŒæ­¥æ”¹å˜ï¼Œè‹¥å…è®¸å†™åï¼Œåˆ™äº‹åŠ¡ T1 æ›´æ–°äº†è¡¨ A çš„æ•°æ®é¡¹ aï¼Œäº‹åŠ¡ T2 ä¹Ÿæ›´æ–°äº†è¡¨ B çš„æ•°æ®é¡¹ bï¼ŒT1 å’Œ T2 ä¸¤ä¸ªäº‹åŠ¡ç‹¬ç«‹çš„æ›´æ–°äº†è¿™ä¸¤æ¡è®°å½•ï¼Œæœ€ç»ˆæ‰“ç ´äº†äºŒè€…å¿…é¡»åŒæ—¶æ”¹å˜çš„çº¦æŸã€‚\nå’Œä¸å¯é‡å¤è¯»ç±»ä¼¼ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è§£å†³å†™åï¼š\n ç¬¬ä¸€ä¸ªäº‹åŠ¡è·å–ä¸¤ä¸ªæ•°æ®é¡¹ä¸Šçš„å…±äº«é”ï¼Œè¿™èƒ½é˜²æ­¢ç¬¬äºŒä¸ªäº‹åŠ¡æ›´æ–°è¿™ä¸¤ä¸ªæ•°æ®é¡¹ã€‚ æ•°æ®åº“å¼•æ“åœ¨æ£€æµ‹åˆ°ç¬¬äºŒä¸ªäº‹åŠ¡ä¿®æ”¹äº†ç›¸å…³è®°å½•ä¹‹åï¼Œå¼ºåˆ¶å›æ»šç¬¬ä¸€ä¸ªäº‹åŠ¡ã€‚  æ›´æ–°ä¸¢å¤± å½“äº‹åŠ¡ T1 è¯»å–æŸä¸ªæ•°æ®é¡¹ a ç„¶åä¿®æ”¹ a æ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ T2 å´åœ¨äº‹åŠ¡ T1 è¯»å– a ä¹‹åä¿®æ”¹ a ä¹‹å‰ä¿®æ”¹äº† aï¼Œè¿™ä¸ªæ—¶å€™äº‹åŠ¡ T2 æ‰€ä½œçš„æ›´æ–°å°±ä¸¢å¤±äº†ï¼ŒT1 æ ¹æœ¬å¯Ÿè§‰ä¸åˆ° T2 çš„å­˜åœ¨ã€‚\nå…ˆåˆ†æä¸‹æ›´æ–°ä¸¢å¤±çš„æƒ…å†µï¼šé¦–å…ˆï¼Œæ²¡æœ‰è„å†™ï¼Œå› ä¸º T2 å·²ç»æäº¤ã€‚å…¶æ¬¡ï¼Œæ²¡æœ‰è„è¯»ï¼Œå› ä¸ºåœ¨å†™ä¹‹åæ²¡æœ‰è¯»æ“ä½œã€‚å¯é‡å¤è¯»å°±å¯é¿å…æ›´æ–°ä¸¢å¤±é—®é¢˜ã€‚\néš”ç¦»çº§åˆ« SQL æ ‡å‡†å®šä¹‰äº† 4 ä¸ªéš”ç¦»çº§åˆ«ï¼š\n READ UNCOMMITTEDï¼š æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–æœªæäº¤çš„æ•°æ®ã€‚å¯èƒ½å¯¼è‡´è„è¯»ã€ä¸å¯é‡å¤è¯»æˆ–å¹»è¯»ã€‚ READ COMMITTEDï¼šå…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ã€‚å¯ä»¥é˜²æ­¢è„è¯»ï¼Œä½†ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ä»ç„¶æœ‰å¯èƒ½å‘ç”Ÿã€‚ REPEATABLE READï¼šé™¤éæ•°æ®è¢«äº‹ç‰©æœ¬èº«ä¿®æ”¹ï¼Œå¯¹åŒä¸€è®°å½•çš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ã€‚å¯ä»¥é˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¯èƒ½å‘ç”Ÿå¹»è¯»ã€‚ SERIALIZABLEï¼šäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œå¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚  ä¸‹è¡¨å±•ç¤ºäº†å„éš”ç¦»çº§åˆ«åŠå…¶èƒ½å¤Ÿé˜²æ­¢çš„å¼‚è±¡ï¼š\n    è„è¯»(Dirty Readï¼‰ ä¸å¯é‡å¤è¯»(Non-repeatable Readï¼‰ å¹»è¯»(Phantom Readï¼‰     è¯»å–æœªæäº¤(Read Uncommittedï¼‰ æ˜¯ æ˜¯ æ˜¯   è¯»å–å·²æäº¤(Read Committedï¼‰ å¦ æ˜¯ æ˜¯   å¯é‡å¤è¯»(Repeatable Readï¼‰ å¦ å¦ æ˜¯   å¯ä¸²è¡ŒåŒ–(Serializableï¼‰ å¦ å¦ å¦    MySQL é»˜è®¤çš„éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»ï¼Œè€Œ Oracleã€SQL Server å’Œ PostgreSQL é»˜è®¤çš„éš”ç¦»çº§åˆ«ä¸ºè¯»å–å·²æäº¤ã€‚\næŒä¹…æ€§ äº‹åŠ¡ä¸€æ—¦å®Œæˆï¼Œå®ƒå¯¹æ•°æ®åº“çš„æ”¹å˜å°±å¿…é¡»æ˜¯æ°¸ä¹…çš„ï¼Œå³ä½¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šå¯¹æ•°æ®çš„æ”¹å˜é€ æˆå½±å“ï¼Œè¿™å°±æ˜¯ æŒä¹…æ€§(Durabilityï¼‰ã€‚\nå‚è€ƒèµ„æ–™  Vlad Mihalcea. High Performance Java Persistence: Get the most out of your persistence layer. 2015. Abaham Siberschatz, Henry F.Kort, S.Sudarshan. æ•°æ®åº“ç³»ç»Ÿæ¦‚å¿µ(ç¬¬å…­ç‰ˆï¼‰. æ¨å†¬é’, æçº¢ç‡•, å”ä¸–æ¸­, è¯‘. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2013.  ","href":"/posts/databases/database_transactions/","title":"äº‹åŠ¡"},{"content":"","href":"/tags/http/","title":"HTTP"},{"content":"","href":"/categories/networks/","title":"Networks"},{"content":"Webèµ„æº Webèµ„æºï¼ˆWeb resourceï¼‰ï¼Œæˆ–èµ„æºï¼ˆresourceï¼‰æ˜¯ä¸€ä¸ªéå¸¸å®½æ³›çš„æ¦‚å¿µï¼Œå®ƒä»£è¡¨ä¸€ä¸ªå¯ä»¥è¢«è¯†åˆ«çš„ä¸œè¥¿ã€‚WikiPediaæ˜¯è¿™ä¹ˆæè¿°å®ƒçš„ï¼š\n A web resource, or simply resource, is any identifiable thing, whether digital, physical, or abstract.\n åœ¨æ—©æœŸçš„Webä¸­ï¼Œèµ„æºå°±æ˜¯å¯å¯»å€çš„é™æ€æ–‡æ¡£ï¼ˆdocumentsï¼‰æˆ–æ–‡ä»¶ï¼ˆfilesï¼‰ã€‚éšç€Webçš„å‘å±•ï¼Œèµ„æºå˜å¾—è¶Šæ¥è¶Šå®½æ³›å’ŒæŠ½è±¡ï¼Œç°åœ¨çš„èµ„æºåŒ…æ‹¬ä¸€åˆ‡å¯ä»¥è¢«è¯†åˆ«çš„ä¸œè¥¿æˆ–å®ä½“ã€‚\nWebèµ„æºä¿å­˜åœ¨WebæœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡ ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆUniform Resource Identifier, URIï¼‰ è¿›è¡Œè¯†åˆ«ã€‚\nURI  A Uniform Resource Identifier (URI) is a string of characters that unambiguously identifies a particular resource.\n RFC2396å¯¹ç»„æˆäº†URIçš„ä¸‰ä¸ªå•è¯è¿›è¡Œäº†å®šä¹‰ï¼š\n Uniform: è§„å®šç»Ÿä¸€çš„æ ¼å¼å¯æ–¹ä¾¿å¤„ç†å¤šç§ä¸åŒç±»å‹çš„èµ„æºï¼Œè€Œä¸ç”¨æ ¹æ®ä¸Šä¸‹æ–‡ ç¯å¢ƒæ¥è¯†åˆ«èµ„æºæŒ‡å®šçš„è®¿é—®æ–¹å¼ã€‚å¦å¤–ï¼ŒåŠ å…¥æ–°å¢çš„åè®®æ–¹æ¡ˆï¼ˆå¦‚ http: æˆ– ftp:ï¼‰ä¹Ÿæ›´å®¹æ˜“ã€‚ Resource: èµ„æºçš„å®šä¹‰æ˜¯â€œå¯æ ‡è¯†çš„ä»»ä½•ä¸œè¥¿â€ã€‚é™¤äº†æ–‡æ¡£æ–‡ä»¶ã€å›¾åƒæˆ–æœåŠ¡ï¼ˆä¾‹ å¦‚å½“å¤©çš„å¤©æ°”é¢„æŠ¥ï¼‰ç­‰èƒ½å¤ŸåŒºåˆ«äºå…¶ä»–ç±»å‹çš„ï¼Œå…¨éƒ½å¯ä½œä¸ºèµ„æºã€‚å¦ å¤–ï¼Œèµ„æºä¸ä»…å¯ä»¥æ˜¯å•ä¸€çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šæ•°çš„é›†åˆä½“ã€‚ Identifier: è¡¨ç¤ºå¯æ ‡è¯†çš„å¯¹è±¡ã€‚ä¹Ÿç§°ä¸ºæ ‡è¯†ç¬¦ã€‚  ç®€è€Œè¨€ä¹‹ï¼ŒURIå¯ä»¥å”¯ä¸€æ ‡è¯†å¹¶å®šä½Webä¸Šçš„èµ„æºï¼Œå®ƒæœ‰URLå’ŒURNä¸¤ç§å½¢å¼ã€‚\nURIçš„è¯­æ³• ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼ˆuniformityï¼‰ï¼Œæ‰€æœ‰çš„URIéƒ½éµå¾ªäº†ä¸€ä¸ªé¢„å®šä¹‰çš„è§„åˆ™é›†ã€‚è™½ç„¶å¦‚æ­¤ï¼ŒURIä¹Ÿå¯ä»¥é€šè¿‡ å‘½åæ–¹æ¡ˆï¼ˆnaming schemeï¼‰ è¿›è¡Œæ‰©å±•ã€‚\nURIçš„é€šç”¨è¯­æ³•å®šä¹‰å¦‚ä¸‹ï¼Œå®ƒç”±5éƒ¨åˆ†ç»„æˆï¼š\nURI = scheme:[//authority]path[?query][#fragment] authority = [userinfo@]host[:port] ä¸Šé¢çš„è¯­æ³•å®šä¹‰ä¹Ÿå¯ä»¥ç”¨è¯­æ³•æ ‘æ¥è¡¨ç¤ºï¼š\nURIåŒ…æ‹¬ï¼š\n ä¸€ä¸ªéç©ºçš„æ–¹æ¡ˆï¼ˆschemeï¼‰ï¼ˆåé¢è·Ÿç€:ï¼‰ï¼šschemeæè¿°çš„æ˜¯å®¢æˆ·ç«¯åœ¨è®¿é—®æœåŠ¡å™¨å¹¶è·å–èµ„æºæ—¶éœ€è¦ä½¿ç”¨å“ªç§åè®®ã€‚å¸¸è§çš„schemeå¦‚ï¼šhttpã€ftpã€mailtoã€httpsç­‰ã€‚schemeå¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œå› æ­¤HTTPä¸httpæŒ‡çš„æ˜¯åŒä¸€ä¸ªschemeã€‚ ä¸€ä¸ªå¯é€‰çš„ æƒé™ï¼ˆauthorityï¼‰ éƒ¨åˆ†ï¼ˆä»¥//å¼€å§‹ï¼‰ï¼Œå®ƒåŒ…æ‹¬ï¼š  ä¸€ä¸ªå¯é€‰çš„ ç”¨æˆ·ä¿¡æ¯ï¼ˆuserinfoï¼‰ éƒ¨åˆ†ï¼ŒuserinfoåŒ…æ‹¬ä¸€ä¸ªç”¨æˆ·åï¼ˆusernameï¼‰å’Œä¸€ä¸ªå¯é€‰çš„å¯†ç ï¼ˆpasswordï¼‰ã€‚ç”¨æˆ·åä¸å¯†ç ä¹‹é—´ç”¨:åˆ†éš”ï¼Œå³username:passwordï¼Œç”±äºå®‰å…¨åŸå› ï¼Œè¿™ä¸€éƒ¨åˆ†é€šå¸¸è¢«å¼ƒç”¨ã€‚userinfoåé¢ä¼šè·Ÿç€ä¸€ä¸ª@ã€‚ ä¸€ä¸ª ä¸»æœºï¼ˆhostï¼‰ éƒ¨åˆ†ï¼šè¡¨ç¤ºå®¿ä¸»æœåŠ¡å™¨çš„ä¸»æœºåæˆ–IPåœ°å€ï¼ˆIPv4åœ°å€å¿…é¡»é‡‡ç”¨ç‚¹åˆ†åè¿›åˆ¶å½¢å¼ï¼ŒIPv6åœ°å€åˆ™å¿…é¡»ç”¨[]æ‹¬èµ·æ¥ï¼‰ã€‚ ä¸€ä¸ªå¯é€‰çš„ ç«¯å£ï¼ˆportï¼‰ éƒ¨åˆ†ï¼Œä»¥:å¼€å¤´ï¼šè¡¨ç¤ºå®¿ä¸»æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ï¼Œå¾ˆå¤šschemeéƒ½æœ‰é»˜è®¤çš„ç«¯å£å·ã€‚   ä¸€ä¸ª è·¯å¾„ï¼ˆpathï¼‰ éƒ¨åˆ†ï¼šè¡¨ç¤ºæœåŠ¡å™¨ä¸Šèµ„æºçš„æœ¬åœ°åï¼Œpathå¯èƒ½ç”±å¾ˆå¤š/åˆ†éš”çš„ç‰‡æ®µç»„æˆã€‚ ä¸€ä¸ªå¯é€‰çš„ æŸ¥è¯¢ï¼ˆqueryï¼‰ éƒ¨åˆ†ï¼šä»¥?å¼€å¤´ï¼Œqueryçš„è¯­æ³•å¹¶æ²¡æœ‰æ˜ç¡®å®šä¹‰ï¼Œä½†å®ƒé€šå¸¸æ˜¯å¾ˆå¤šé”®-å€¼å¯¹ç»„æˆï¼Œè¿™äº›é”®-å€¼å¯¹ä¼šè¢«æŸä¸ªåˆ†éš”ç¬¦åˆ†éš”ã€‚ä¾‹å¦‚ï¼škey1=value1\u0026amp;key2=value2æˆ–key1=value1;key2=value2ä¸­åˆ†åˆ«é‡‡ç”¨äº†\u0026amp;å’Œ;ä½œä¸ºåˆ†éš”ç¬¦ã€‚ ä¸€ä¸ªå¯é€‰çš„ ç‰‡æ®µï¼ˆfragmentï¼‰ éƒ¨åˆ†ï¼šä»¥#å¼€å§‹ï¼Œé€šå¸¸åŒ…æ‹¬ä¸€ä¸ªfragmentæ ‡è¯†ç¬¦ã€‚æœ‰äº›èµ„æºï¼ˆæ¯”å¦‚HTMLï¼‰ä¼šåœ¨å†…éƒ¨ä½œè¿›ä¸€æ­¥åˆ’åˆ†ï¼Œfragmentå°±å¯ä»¥ç”¨æ¥å¼•ç”¨éƒ¨åˆ†èµ„æºæˆ–èµ„æºçš„ä¸€ä¸ªç‰‡æ®µã€‚å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚å†…å®¹æ—¶ï¼Œfragmentå¹¶ä¸ä¼šè¢«å‘é€ç»™æœåŠ¡å™¨ï¼Œå› ä¸ºfragmentæ˜¯ç»™å®¢æˆ·ç«¯å†…éƒ¨ä½¿ç”¨çš„ã€‚ä¾‹å¦‚ï¼šæµè§ˆå™¨ä»æœåŠ¡å™¨æ‹¿åˆ°æ•´ä¸ªèµ„æºåï¼Œå¯ä»¥å°†æ»šåŠ¨é¡µé¢æŒ‡å®šçš„fragmentéƒ¨åˆ†ã€‚  ä¾‹å­ ä¸‹é¢æ˜¯ä¸€äº›URIçš„ä¾‹å­ï¼š\nftp://ftp.is.co.za/rfc/rfc1808.txt https://tools.ietf.org/html/rfc3986#section-3.5 ldap://[2001:db8::7]/c=GB?objectClass?one mailto:John.Doe@example.com news:comp.infosystems.www.servers.unix tel:+1-816-555-1212 telnet://192.0.2.16:80/ urn:oasis:names:specification:docbook:dtd:xml:4.1.2 URIçš„ä½¿ç”¨ å½“åº”ç”¨å¼•ç”¨ä¸€ä¸ªURIæ—¶ï¼Œå®ƒä»¬å¹¶ä¸æ€»æ˜¯ä½¿ç”¨URIè¯­æ³•è§„åˆ™ä¸­æ‰€å®šä¹‰çš„å®Œæ•´å½¢å¼ï¼ˆç»å¯¹URLï¼‰ã€‚å¾ˆå¤šç½‘ç»œåè®®å’Œåª’ä½“ç±»å‹éƒ½å…è®¸ä½¿ç”¨URIçš„ç¼©ç•¥å½¢å¼ï¼Œä¾‹å¦‚ç›¸å¯¹URIã€‚ä¸€äº›æµè§ˆå™¨è¿˜æ”¯æŒURLçš„â€œè‡ªåŠ¨æ‰©å±•â€ï¼Œå³ç”¨æˆ·è¾“å…¥URLçš„ä¸€éƒ¨åˆ†ï¼Œæµè§ˆå™¨ä¼šå¡«å……URLçš„å‰©ä½™éƒ¨åˆ†ã€‚\nURIå¼•ç”¨ èµ„æºæ ‡è¯†ç¬¦æœ€å¸¸è§çš„ä½¿ç”¨æ–¹å¼å°±æ˜¯URIå¼•ç”¨ï¼ˆURI Referenceï¼‰ã€‚URIå¼•ç”¨ä¸æ˜¯ä¸€ä¸ªURIå°±æ˜¯ä¸€ä¸ªç›¸å¯¹å¼•ç”¨ã€‚\nç›¸å¯¹å¼•ç”¨ å¦‚æœä¸€ä¸ªURIå¼•ç”¨çš„å‰ç¼€åŒ¹é…ä¸ä¸ŠURIè¯­æ³•ä¸­å®šä¹‰çš„schemeï¼ˆä»¥:ç»“å°¾ï¼‰ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªç›¸å¯¹å¼•ç”¨ï¼ˆrelative referenceï¼‰ã€‚ç›¸å¯¹URIæ˜¯ä¸å®Œæ•´çš„ï¼Œè¦æƒ³ä»ç›¸å¯¹URIä¸­è·å¾—è®¿é—®èµ„æºæ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ï¼Œå°±å¿…é¡»åœ¨åŸºURIï¼ˆbase URIï¼‰çš„åŸºç¡€ä¸Šè¿›è¡Œè§£æã€‚ç›¸å¯¹å¼•ç”¨æ‰€æŒ‡å‘çš„URIåˆç§°ç›®æ ‡URIï¼ˆtarget URIï¼‰ã€‚\nç›¸å¯¹å¼•ç”¨æœ‰å‡ ç§ä¸åŒçš„å½¢å¼ï¼š\n ä»¥ä¸¤ä¸ªæ–œçº¿ï¼ˆ//ï¼‰å¼€å¤´çš„ç›¸å¯¹å¼•ç”¨æ˜¯è¢«ç§°ä¸ºç½‘ç»œè·¯å¾„å¼•ç”¨ï¼ˆnetwork-path referenceï¼‰ï¼Œè¿™ä¸€ç±»å¼•ç”¨å¾ˆå°‘è¢«ä½¿ç”¨ã€‚ ä»¥å•ä¸ªæ–œçº¿ï¼ˆ/ï¼‰å¼€å¤´çš„ç›¸å¯¹å¼•ç”¨è¢«ç§°ä¸ºç»å¯¹è·¯å¾„åº”ç”¨ï¼ˆabsolute-path referenceï¼‰ã€‚ ä¸ä»¥æ–œçº¿å¼€å¤´çš„ç›¸å¯¹å¼•ç”¨è¢«ç§°ä¸ºç›¸å¯¹è·¯å¾„åº”ç”¨ï¼ˆrelative-path referenceï¼‰ã€‚è‹¥æŸä¸ªè·¯å¾„ç‰‡æ®µä¸­åŒ…å«:ï¼ˆä¾‹å¦‚this:thatï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªè·¯å¾„ç‰‡æ®µä¸èƒ½ç›´æ¥ç”¨ä½œç›¸å¯¹è·¯å¾„å¼•ç”¨ä¸­çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒä¼šè¢«è¯¯è®¤ä¸ºæ˜¯schemeåã€‚è¿™ç§è·¯å¾„ç‰‡æ®µå‰é¢å¿…é¡»åŠ ä¸Š./ï¼ˆä¾‹å¦‚./this:thatï¼‰ä»¥æ¶ˆé™¤æ­§ä¹‰ã€‚  ç»å¯¹URI å’Œç›¸å¯¹å¼•ç”¨ä¸åŒï¼Œç»å¯¹URIï¼ˆAbsolute URIï¼‰ åŒ…å«è®¿é—®èµ„æºæ‰€å¿…éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚ç»å¯¹URIçš„å¼€å¤´åŒ…æ‹¬è®¿é—®èµ„æºæ‰€é‡‡ç”¨çš„schemeã€‚\nå¼•ç”¨è§£æ ä¸ºäº†è®¿é—®ç›¸å¯¹å¼•ç”¨æŒ‡å‘çš„èµ„æºï¼Œæˆ‘ä»¬éœ€è¦å…ˆè§£æå»å®ƒå¯¹åº”çš„ç»å¯¹URIã€‚è§£æè¿‡ç¨‹è§ï¼šReference Resolution.\nURL  A Uniform Resource Locator (URL), colloquially termed a web address, is a reference to a web resource that specifies its location on a computer network and a mechanism for retrieving it.\n **ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆUniform Resource Locator, URLï¼‰**æ˜¯èµ„æºæ ‡è¯†ç¬¦æœ€å¸¸è§çš„å½¢å¼ï¼Œæè¿°äº†ç‰¹å®šæœåŠ¡å™¨ä¸Šç‰¹å®šèµ„æºçš„ä½ç½®ã€‚ç°åœ¨ï¼Œå‡ ä¹æ‰€æœ‰çš„URIéƒ½æ˜¯URLã€‚\nURN  A Uniform Resource Name (URN) is a Uniform Resource Identifier (URI) that uses the urn scheme. URNs are globally unique persistent identifiers assigned within defined namespaces so they will be available for a long period of time, even after the resource which they identify ceases to exist or becomes unavailable.\n ç»Ÿä¸€èµ„æºåï¼ˆUniform Resource Name, URNï¼‰ æ˜¯URIçš„å¦ä¸€ç§å½¢å¼ï¼Œä½œä¸ºç‰¹å®šå†…å®¹çš„å”¯ä¸€åå­—ä½¿ç”¨ï¼Œä¸èµ„æºç›®å‰çš„æ‰€åœ¨åœ°æ— å…³ã€‚å’ŒURLä¸åŒï¼ŒURNæ˜¯ä¸ä½ç½®æ— å…³çš„ï¼Œæˆ‘ä»¬å¯ä»¥å››å¤„ç§»åŠ¨èµ„æºï¼Œä½†ä¾ç„¶å¯ä»¥é€šè¿‡URNæ¥è®¿é—®å®ƒã€‚ä¾‹å¦‚ï¼Œä¸è®ºRFC 2141ä½äºä½•å¤„ï¼ˆç”šè‡³æ˜¯è¢«å¤åˆ¶åˆ°å¤šä¸ªåœ°æ–¹ï¼‰ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç”¨urn:ietf:rfc:2141è¿™ä¸ªURNæ¥è®¿é—®å®ƒã€‚\nå‚è€ƒèµ„æ–™  Web resource. Uniform Resource Identifier. Uniform Resource Locator. Uniform Resource Name. RFC 3986. David Gourley, Brian Totty. HTTP: The Definitive Guide. O\u0026rsquo;Reilly Media, 2002. ã€æ—¥ã€‘ä¸Šé‡å®£, å›¾è§£HTTP, äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾, 2014.  ","href":"/computer_networks/http/uri_and_resources/","title":"URIä¸èµ„æº"},{"content":"Webä»£ç†ï¼ˆProxyï¼‰ æœåŠ¡å™¨æ˜¯ç½‘ç»œä¸­çš„ä¸­é—´å®ä½“ï¼Œä½äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ï¼Œæ‰®æ¼”çš„æ˜¯â€œä¸­é—´äººâ€çš„è§’è‰²ï¼Œè´Ÿè´£åœ¨å„ç«¯ç‚¹ä¹‹é—´æ¥å›ä¼ é€HTTPæŠ¥æ–‡ã€‚\nWebçš„ä¸­é—´å®ä½“ Webä»£ç†æœåŠ¡å™¨æ˜¯ä»£è¡¨å®¢æˆ·ç«¯å®Œæˆäº‹åŠ¡å¤„ç†çš„ä¸­é—´äººã€‚å¦‚æœæ²¡æœ‰Webä»£ç†ï¼ŒHTTPå®¢æˆ·ç«¯å°±è¦ç›´æ¥ä¸æœåŠ¡å™¨è¿›è¡Œå¯¹è¯ã€‚è€Œæœ‰äº†Webä»£ç†ä¹‹åï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥ä¸ä»£ç†è¿›è¡Œå¯¹è¯ï¼Œç„¶åä»£ç†ä»£è¡¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿›è¡Œäº¤æµã€‚å®¢æˆ·ç«¯ä»ç„¶å¯ä»¥å®Œæˆäº‹åŠ¡å¤„ç†ï¼Œä½†ä»£ç†å¯ä»¥ä¸ºå®ƒå¸¦æ¥æ›´åŠ ä¼˜è´¨çš„æœåŠ¡å’Œæ›´åŠ çµæ´»çš„æ‰©å±•åŠŸèƒ½ã€‚\nHTTPä»£ç†æœåŠ¡å™¨æ—¢æ˜¯Webå®¢æˆ·ç«¯ï¼Œåˆæ˜¯WebæœåŠ¡å™¨ã€‚å¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼ŒWebä»£ç†æ‰®æ¼”çš„æ˜¯æœåŠ¡å™¨çš„è§’è‰²ï¼Œå®ƒå¿…é¡»æ­£ç¡®å¤„ç†è¯·æ±‚å¹¶è¿›è¡Œå“åº”ã€‚åŒæ—¶ï¼Œå¯¹äºæœåŠ¡å™¨è€Œè¨€ï¼ŒWebä»£ç†æ‰®æ¼”çš„æ˜¯å®¢æˆ·ç«¯çš„è§’è‰²ï¼Œå®ƒå‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚å¹¶è·å¾—å“åº”ã€‚\nä»£ç†vsç½‘å…³ ä¸¥æ ¼æ¥è¯´ï¼Œä»£ç†è¿æ¥çš„æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªä½¿ç”¨ç›¸åŒåè®®çš„åº”ç”¨ç¨‹åºï¼Œè€Œç½‘å…³è¿æ¥çš„æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªä½¿ç”¨ä¸åŒåè®®çš„ç«¯ç‚¹ã€‚ç½‘å…³çš„ä¸»è¦ä½œç”¨æ˜¯è¿›è¡Œåè®®è½¬æ¢ï¼Œå³ä½¿å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä½¿ç”¨äº†ä¸åŒçš„åè®®ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥å€ŸåŠ©å®ƒå®Œæˆä¸æœåŠ¡å™¨ä¹‹é—´çš„äº‹åŠ¡å¤„ç†ã€‚\nä»£ç†çš„ä½¿ç”¨åœºæ™¯ ä»£ç†æœåŠ¡å™¨å¯ä»¥ç›‘è§†å¹¶ä¿®æ”¹æ‰€æœ‰ç»è¿‡çš„HTTPæµé‡ï¼Œå› æ­¤å¯ä»¥ç”¨å®ƒæ¥å®ç°å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼š\n è¿›è¡Œå†…å®¹çš„è¿‡æ»¤ã€è®¿é—®æ§åˆ¶ã€è·¯ç”±å’Œè½¬æ¢ã€‚ ä½œä¸ºé˜²ç«å¢™ä½¿ç”¨ã€‚ ä½œä¸ºWebç¼“å­˜ä½¿ç”¨ï¼Œç»´æŠ¤å¸¸ç”¨å†…å®¹çš„å‰¯æœ¬ï¼Œä»¥åŠ å¿«è®¿é—®é€Ÿåº¦ã€‚ å‡æ‰®WebæœåŠ¡å™¨ï¼Œæ¥æ”¶å‘ç»™WebæœåŠ¡å™¨çš„çœŸå®è¯·æ±‚å¹¶å¤„ç†ã€‚è¿™ç§ä»£ç†è¢«ç§°ä¸ºæ›¿ä»£ç‰©ï¼ˆsurrogateï¼‰æˆ–åå‘ä»£ç†ï¼ˆreverse proxyï¼‰ã€‚ä¸æ™®é€šWebæœåŠ¡å™¨ä¸åŒçš„æ˜¯ï¼Œåå‘ä»£ç†å¯ä»¥å‘èµ·ä¸å…¶å®ƒæœåŠ¡å™¨çš„é€šä¿¡ï¼ŒæŒ‰éœ€è·å–è¯·æ±‚å†…å®¹ã€‚åå‘ä»£ç†è¿˜å¯ä»¥ç”¨æ¥æé«˜è®¿é—®æ…¢é€ŸWebæœåŠ¡å™¨ä¸Šå…¬å…±å†…å®¹æ—¶çš„é€Ÿåº¦ï¼Œé€šå¸¸å°†è¿™äº›åå‘ä»£ç†ç§°ä¸ºæœåŠ¡å™¨åŠ é€Ÿå™¨ï¼ˆserver acceleratorï¼‰ã€‚ åŒ¿åä»£ç†ã€‚ä¸»åŠ¨ä»HTTPæŠ¥æ–‡ä¸­åˆ é™¤è®¿é—®è€…çš„èº«ä»½ä¿¡æ¯ï¼Œä»è€Œæä¾›é«˜åº¦çš„ç§å¯†æ€§å’ŒåŒ¿åæ€§ã€‚  å¦‚ä½•å°†è¯·æ±‚å¯¼å‘ä»£ç† å®¢æˆ·ç«¯é€šå¸¸ä¼šç›´æ¥ä¸WebæœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚ä¸ºäº†è®©ä»£ç†æ´¾ä¸Šç”¨åœºï¼Œæˆ‘ä»¬éœ€è¦å°†åˆ°å®¢æˆ·ç«¯çš„HTTPæµé‡å¯¼å‘ä»£ç†ï¼Œå¸¸è§çš„æ–¹å¼æœ‰å››ç§ï¼š\n ä¿®æ”¹å®¢æˆ·ç«¯ï¼ˆå›¾aï¼‰ã€‚å¾ˆå¤šWebå®¢æˆ·ç«¯éƒ½æ”¯æŒæ‰‹å·¥å’Œè‡ªåŠ¨çš„ä»£ç†é…ç½®ï¼Œå¯ä»¥å°†å®¢æˆ·ç«¯é…ç½®ä¸ºä½¿ç”¨ä»£ç†æœåŠ¡å™¨ã€‚ ä¿®æ”¹ç½‘ç»œï¼ˆå›¾bï¼‰ã€‚ç½‘ç»œåŸºç¡€è®¾æ–½å¯ä»¥åœ¨å®¢æˆ·ç«¯ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µå°†å®¢æˆ·ç«¯çš„æµé‡æ‹¦æˆªå¹¶å¯¼å…¥ä»£ç†ï¼Œè¿™ç§ä»£ç†é€šå¸¸è¢«ç§°ä¸º*æ‹¦æˆªï¼ˆinterceptingï¼‰*ä»£ç†ã€‚ ä¿®æ”¹DNSçš„å‘½åç©ºé—´ï¼ˆå›¾cï¼‰ã€‚æ”¾åœ¨WebæœåŠ¡å™¨ä¹‹å‰çš„ä»£ç†å¯ä»¥ç›´æ¥å‡æ‰®WebæœåŠ¡å™¨çš„åå­—å’ŒIPåœ°å€ï¼Œè¿™æ ·ï¼Œè¯·æ±‚å°±å¯ä»¥ç›´æ¥è¢«å‘ç»™ä»£ç†è€Œä¸æ˜¯æœåŠ¡å™¨äº†ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹DNSåˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨ç‰¹æ®Šçš„åŠ¨æ€DNSæœåŠ¡å™¨ã€‚ ä¿®æ”¹WebæœåŠ¡å™¨ï¼ˆå›¾dï¼‰ã€‚å¯ä»¥å°†æŸäº›WebæœåŠ¡å™¨é…ç½®ä¸ºå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªHTTPé‡å®šå‘å‘½ä»¤ï¼Œå°†å®¢æˆ·ç«¯çš„è¯·æ±‚é‡å®šå‘åˆ°ä¸€ä¸ªä»£ç†ä¸Šå»ã€‚  å®¢æˆ·ç«¯ä»£ç†è®¾ç½® ç°åœ¨å‡ ä¹æ‰€æœ‰çš„æµè§ˆå™¨éƒ½å…è®¸ç”¨æˆ·å¯¹ä»£ç†çš„ä½¿ç”¨è¿›è¡Œé…ç½®ã€‚é…ç½®çš„æ–¹å¼å¤§æ¦‚æœ‰ä¸‹é¢å‡ ç§:\n æ‰‹å·¥é…ç½®ã€‚æ˜¾ç¤ºåœ°è®¾ç½®ä½¿ç”¨çš„ä»£ç†ã€‚ é¢„å…ˆé…ç½®æµè§ˆå™¨ã€‚æµè§ˆå™¨å‚å•†é¢„å…ˆå¯¹æµè§ˆå™¨è¿›è¡Œé…ç½®ã€‚ ä»£ç†çš„è‡ªåŠ¨é…ç½®ï¼ˆProxy Auto-Configuration, PACï¼‰ã€‚æä¾›ä¸€ä¸ªæŒ‡å‘JavaScriptç¼–å†™çš„PACæ–‡ä»¶çš„URIï¼Œå®¢æˆ·ç«¯ä¼šå»è·å–è¿™ä¸ªæ–‡ä»¶å¹¶è¿è¡Œï¼Œä»è€Œå†³å®šæ˜¯å¦ä½¿ç”¨ä»¥åŠä½¿ç”¨å“ªä¸ªä»£ç†æœåŠ¡å™¨ã€‚PACæ–‡ä»¶çš„åç¼€é€šå¸¸æ˜¯.pacï¼ŒMIMEç±»å‹é€šå¸¸æ˜¯application/x-ns-proxy-autoconfigã€‚ ä½¿ç”¨Webä»£ç†è‡ªåŠ¨å‘ç°åè®®ï¼ˆWeb Proxy Autodiscovery Protocol, WPADï¼‰ã€‚WPADåè®®çš„ç®—æ³•ä¼šä½¿ç”¨å‘ç°æœºåˆ¶é€çº§ä¸Šå‡ç­–ç•¥è‡ªåŠ¨åœ°ä¸ºæµè§ˆå™¨å‘ç°åˆé€‚çš„PACæ–‡ä»¶ã€‚åè®®ä¼šä½¿ç”¨ä¸€ç³»åˆ—çš„èµ„æºå‘ç°æŠ€æœ¯æ¥åˆ¤å®šå‡ºé€‚å½“çš„PACæ–‡ä»¶ã€‚  è¿½è¸ªæŠ¥æ–‡ Webè¯·æ±‚åœ¨ä»å®¢æˆ·ç«¯ä¼ é€åˆ°æœåŠ¡å™¨çš„è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç»è¿‡ä¸¤ä¸ªæˆ–å¤šä¸ªä»£ç†æ˜¯éå¸¸å¸¸è§çš„ã€‚éšç€ä»£ç†çš„æµè¡Œï¼Œæˆ‘ä»¬è¦èƒ½å¤Ÿè¿½è¸ªç»è¿‡ä»£ç†çš„æŠ¥æ–‡æµï¼Œä»¥æ£€æµ‹å‡ºå„ç§é—®é¢˜ï¼Œå…¶é‡è¦æ€§å°±è·Ÿè¿½è¸ªç»è¿‡ä¸åŒäº¤æ¢æœºå’Œè·¯ç”±å™¨ä¼ è¾“çš„IPæ•°æ®æŠ¥æµä¸€æ ·ã€‚\nViaé¦–éƒ¨ Viaé¦–éƒ¨å­—æ®µåˆ—å‡ºäº†æŠ¥æ–‡é€”å¾„çš„æ¯ä¸ªä¸­é—´èŠ‚ç‚¹ï¼ˆä»£ç†æˆ–ç½‘å…³ï¼‰çš„ç›¸å…³ä¿¡æ¯ï¼ŒæŠ¥æ–‡æ¯ç»è¿‡ä¸€ä¸ªèŠ‚ç‚¹ï¼Œéƒ½å¿…é¡»å°†è¿™ä¸ªä¸­é—´èŠ‚ç‚¹æ·»åŠ åˆ°Viaåˆ—è¡¨çš„æœ«å°¾ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„æŠ¥æ–‡ç»è¿‡äº†ä¸¤ä¸ªä»£ç†ï¼šç¬¬ä¸€ä¸ªä»£ç†ä¸ºproxy1.comï¼Œå®ƒå®ç°äº†HTTP/1.1åè®®ï¼›ç¬¬äºŒä¸ªä»£ç†ä¸ºproxy2.comï¼Œå®ƒå®ç°äº†HTTP/1.0ï¼š\nVia: 1.1 proxy1.com, 1.0 proxy2.com Viaé¦–éƒ¨è¢«ç”¨æ¥è¿½è¸ªæŠ¥æ–‡çš„è½¬å‘è¿‡ç¨‹ã€è¯Šæ–­æŠ¥æ–‡è·¯ç”±å¾ªç¯ï¼Œä»¥åŠè¯†åˆ«æ•´ä¸ªè¯·æ±‚/å“åº”é“¾ä¸Šæ‰€æœ‰å‘é€æ–¹çš„åè®®å¤„ç†èƒ½åŠ›ã€‚\nViaçš„è¯­æ³• Viaé¦–éƒ¨åŒ…å«ä¸€ä¸ªç”±é€—å·åˆ†éš”çš„è·¯å¾„ç‚¹ï¼ˆwaypointï¼‰ã€‚æ¯ä¸ªè·¯å¾„ç‚¹éƒ½å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„ä»£ç†æœåŠ¡å™¨æˆ–ç½‘å…³ï¼Œå¹¶ä¸”å«æœ‰ä¸è¯¥ä¸­é—´èŠ‚ç‚¹çš„ä¸€äº›ä¿¡æ¯ï¼ˆæ¯”å¦‚æ‰€é‡‡ç”¨çš„åè®®ã€èŠ‚ç‚¹åœ°å€ç­‰ï¼‰ã€‚Viaé¦–éƒ¨çš„è¯­æ³•å¦‚ä¸‹ï¼š\nVia = \u0026quot;Via\u0026quot; \u0026quot;:\u0026quot; 1#( waypoint ) waypoint = ( received-protocol received-by [ comment ] ) received-protocol = [ protocol-name \u0026quot;/\u0026quot; ] protocol-version received-by = ( host [ \u0026quot;:\u0026quot; port ] ) | pseudonym Viaçš„è¯·æ±‚ä¸å“åº”è·¯å¾„ è¯·æ±‚å’Œå“åº”æŠ¥æ–‡éƒ½ä¼šç»è¿‡ä»£ç†è¿›è¡Œä¼ è¾“ã€‚å› æ­¤ï¼Œè¯·æ±‚å’Œå“åº”æŠ¥æ–‡ä¸­éƒ½è¦æœ‰Viaé¦–éƒ¨ã€‚ç”±äºè¯·æ±‚å’Œå“åº”é€šå¸¸æ˜¯åœ¨åŒä¸€æ¡TCPè¿æ¥ä¸Šä¼ é€çš„ï¼Œæ‰€ä»¥å“åº”æŠ¥æ–‡ä¼šåœ¨è¯·æ±‚æŠ¥æ–‡çš„è·¯å¾„ä¸Šåå‘ä¼ è¾“ã€‚å› æ­¤ï¼Œå“åº”æŠ¥æ–‡çš„Viaé¦–éƒ¨å‡ ä¹æ€»æ˜¯ä¸è¯·æ±‚æŠ¥æ–‡çš„Viaé¦–éƒ¨ç›¸åã€‚\nTRACEæ–¹æ³• é€šè¿‡HTTP/1.1æä¾›çš„TRACEæ–¹æ³•ï¼Œç”¨æˆ·å¯ä»¥è¿½è¸ªè¯·æ±‚æŠ¥æ–‡ç»è¿‡çš„ä»£ç†é“¾ï¼Œè§‚å¯Ÿè¯·æ±‚æŠ¥æ–‡ç»è¿‡äº†å“ªäº›ä»£ç†ä»¥åŠæ¯ä¸ªä»£ç†éƒ½å¯¹è¯·æ±‚æŠ¥æ–‡åšäº†å“ªäº›ä¿®æ”¹ã€‚\nTRACEå¯¹ä»£ç†æµçš„è°ƒè¯•éå¸¸æœ‰ç”¨ï¼Œå½“TRACEè¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼Œæ•´æ¡è¯·æ±‚æŠ¥æ–‡éƒ½ä¼šè¢«å°è£…åœ¨ä¸€æ¡HTTPå“åº”çš„bodyä¸­ä¼šé€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯é€šè¿‡æ£€æŸ¥å“åº”æŠ¥æ–‡ï¼Œä¾¿å¯ä»¥çŸ¥é“æŠ¥æ–‡æ‰€ç»è¿‡çš„ä»£ç†åˆ—è¡¨ã€‚TRACEå“åº”çš„Content-Typeä¸ºmessage/httpï¼ŒçŠ¶æ€ç ä¸º200 OKã€‚\né€šå¸¸ï¼Œä¸ç®¡å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å­˜åœ¨å¤šå°‘ä»£ç†ï¼ŒTRACEæŠ¥æ–‡éƒ½ä¼šæ²¿ç€è¿™ä¸ªä»£ç†é“¾ä¼ åˆ°æœåŠ¡å™¨ã€‚ä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Max-Forwardsé¦–éƒ¨æ¥é™åˆ¶TRACEå’ŒOPTIONSè¯·æ±‚æ‰€ç»è¿‡çš„ä»£ç†æ•°ã€‚Max-Forwardsè¯·æ±‚é¦–éƒ¨åŒ…å«äº†ä¸€ä¸ªæ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°ä»£è¡¨å½“å‰è¯·æ±‚æŠ¥æ–‡è¿˜å¯ä»¥è¢«è½¬å‘å¤šå°‘æ¬¡ã€‚å½“å€¼ä¸º0æ—¶ï¼Œä¸ç®¡æ¥æ”¶è€…æ˜¯è°ï¼Œå®ƒéƒ½å¿…é¡»åœæ­¢è½¬å‘å¹¶å°†TRACEæŠ¥æ–‡ä¼šé€ç»™å®¢æˆ·ç«¯ã€‚å½“å€¼å¤§äº0æ—¶ï¼Œæ¥æ”¶è€…ä¼šå°†å…¶å‡ä¸€å¹¶è½¬å‘ã€‚\nä»£ç†çš„äº’æ“ä½œæ€§ å®¢æˆ·ç«¯ã€æœåŠ¡å™¨å’Œä»£ç†é€šå¸¸æ˜¯ç”±ä¸åŒå‚å•†æ„å»ºçš„ï¼Œå®ç°çš„HTTPè§„èŒƒç‰ˆæœ¬å¯èƒ½ä¼šå­˜åœ¨å·®å¼‚ã€‚é€šè¿‡HTTPæä¾›çš„OPTIONSæ–¹æ³•ï¼Œå®¢æˆ·ç«¯æˆ–ä»£ç†å¯ä»¥å‘ç°WebæœåŠ¡å™¨æˆ–å…¶ä¸ŠæŸä¸ªç‰¹å®šèµ„æºæ‰€æ”¯æŒçš„åŠŸèƒ½ã€‚å¦‚æœOPTIONSè¯·æ±‚çš„URIæ˜¯ä¸ªæ˜Ÿå·ï¼ˆ*ï¼‰ï¼Œé‚£ä¹ˆè¯·æ±‚çš„æ˜¯æ•´ä¸ªæœåŠ¡å™¨æ‰€æ”¯æŒçš„åŠŸèƒ½ã€‚å¦‚æœOPTIONSè¯·æ±‚çš„URIæ˜¯ä¸ªå®é™…çš„èµ„æºåœ°å€ï¼Œé‚£ä¹ˆè¯·æ±‚çš„å°±æ˜¯ç‰¹å®šèµ„æºçš„å¯ç”¨ç‰¹æ€§ã€‚å¦‚æœOPTIONSè¯·æ±‚æˆåŠŸï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¸€ä¸ªåŒ…å«äº†å„ç§é¦–éƒ¨å­—æ®µçš„200 OKå“åº”ï¼Œè¿™äº›é¦–éƒ¨å­—æ®µå°±æè¿°äº†æœåŠ¡å™¨æˆ–ç‰¹å®šèµ„æºæ‰€æ”¯æŒçš„å„ç§å¯é€‰ç‰¹æ€§ã€‚\nHTTP/1.1åœ¨å“åº”ä¸­å”¯ä¸€æŒ‡å®šçš„é¦–éƒ¨å­—æ®µæ˜¯Allowï¼Œå®ƒæè¿°äº†æœåŠ¡å™¨æˆ–ç‰¹å®šæ‰€æ”¯æŒçš„å„ç§æ–¹æ³•ï¼Œä¾‹å¦‚ï¼šAllow: GET, HEAD, PUTã€‚\nå‚è€ƒèµ„æ–™  David Gourley, Brian Totty. HTTP: The Definitive Guide. O\u0026rsquo;Reilly Media, 2002.  ","href":"/computer_networks/http/proxies/","title":"ä»£ç†"},{"content":"ç”¨äºHTTPåè®®äº¤äº’çš„ä¿¡æ¯è¢«ç§°ä¸ºHTTPæŠ¥æ–‡ï¼ˆHTTP Messagesï¼‰ã€‚å®¢æˆ·ç«¯å‘å‡ºçš„HTTPå«åšè¯·æ±‚æŠ¥æ–‡ï¼ˆæˆ–Requestsï¼‰ï¼ŒæœåŠ¡ç«¯å‘å‡ºçš„æŠ¥æ–‡å«åšå“åº”æŠ¥æ–‡ï¼ˆæˆ–Responsesï¼‰ã€‚\næŠ¥æ–‡æµ ä½œä¸ºHTTPåº”ç”¨ç¨‹åºä¹‹é—´å‘é€çš„æ•°æ®å—ï¼ŒHTTPæŠ¥æ–‡ä»¥ä¸€äº›æè¿°äº†æŠ¥æ–‡å†…å®¹åŠå«ä¹‰çš„æ–‡æœ¬å½¢å¼çš„ å…ƒä¿¡æ¯ï¼ˆmeta-informationï¼‰ å¼€å¤´ï¼Œåé¢è·Ÿç€å¯é€‰çš„æ•°æ®éƒ¨åˆ†ã€‚è¿™äº›æŠ¥æ–‡åœ¨å®¢æˆ·ç«¯ã€æœåŠ¡å™¨å’Œä»£ç†ä¹‹é—´æµåŠ¨ï¼Œæœ¯è¯­æµå…¥ï¼ˆinboundï¼‰ã€æµå‡ºï¼ˆoutboundï¼‰ã€ä¸Šæ¸¸ï¼ˆupstreamï¼‰ å’Œ ä¸‹æ¸¸ï¼ˆdownstreamï¼‰ å°±æ˜¯ç”¨æ¥æè¿°æŠ¥æ–‡çš„æ–¹å‘çš„ã€‚\nInboundä¸Outbound HTTPä½¿ç”¨æœ¯è¯­inboundå’Œoutboundæ¥æè¿°äº‹åŠ¡å¤„ç†çš„æ–¹å‘ã€‚æŠ¥æ–‡æµå…¥æºç«¯æœåŠ¡å™¨ï¼Œå¤„ç†å®Œæˆä¹‹ååˆä¼šæµå‡ºåˆ°ç”¨æˆ·çš„Agentä»£ç†ä¸­ï¼š\nUpstreamä¸Downstream ä¸ç®¡æ˜¯è¯·æ±‚æŠ¥æ–‡è¿˜æ˜¯å“åº”æŠ¥æ–‡ï¼Œæ‰€æœ‰çš„HTTPæŠ¥æ–‡éƒ½ä¼šå‘ä¸‹æ¸¸ï¼ˆdownstreamï¼‰æµåŠ¨ï¼Œæ‰€æœ‰çš„æŠ¥æ–‡å‘é€è€…éƒ½åœ¨æ¥æ”¶è€…çš„ä¸Šæ¸¸ï¼ˆupstreamï¼‰ã€‚æŠ¥æ–‡åªä¼šä»ä¸Šæ¸¸å‘ä¸‹æ¸¸æµåŠ¨ï¼Œä¸å­˜åœ¨ä»ä¸‹æ¸¸å‘ä¸Šæ¸¸æµåŠ¨çš„æƒ…å†µï¼š\næŠ¥æ–‡çš„ç»„æˆ HTTPæŠ¥æ–‡æœ¬èº«æ˜¯ç”±å¤šè¡Œï¼ˆç”¨CRLFä½œæ¢è¡Œç¬¦ï¼‰æ•°æ®æ„æˆçš„å­—ç¬¦ä¸²æ–‡æœ¬ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼šå¯¹æŠ¥æ–‡è¿›è¡Œæè¿°çš„èµ·å§‹è¡Œï¼ˆstart lineï¼‰ã€åŒ…å«æŠ¥æ–‡å±æ€§çš„é¦–éƒ¨ï¼ˆheadersï¼‰å’Œå¯é€‰çš„åŒ…å«æ•°æ®çš„ä¸»ä½“ï¼ˆbodyï¼‰ã€‚ä¾‹å¦‚:\nèµ·å§‹è¡Œå’Œé¦–éƒ¨éƒ½æ˜¯ç”±è¡Œåˆ†éš”çš„ASCIIæ–‡æœ¬ï¼Œæ¯è¡Œéƒ½ä»¥ä¸€ä¸ªæœ‰ä¸¤ä¸ªå­—ç¬¦ç»„æˆçš„è¡Œç»ˆæ­¢ç¬¦ç»“æŸã€‚è¿™ä¸ªè¡Œç»ˆæ­¢ç¬¦åŒ…æ‹¬ä¸€ä¸ªå›è½¦ç¬¦ï¼ˆCarriage Return, CR, ASCIIç ä¸º13ï¼‰å’Œä¸€ä¸ªæ¢è¡Œç¬¦ï¼ˆLine Feed, LF, ASCIIç ä¸º10ï¼‰ï¼ŒCRå’ŒLFåˆèµ·æ¥å°±æ˜¯CRLFã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡HTTPè§„èŒƒä¸­è¯´æ˜åº”è¯¥ç”¨CRLFæ¥è¡¨ç¤ºè¡Œç»ˆæ­¢ï¼Œä½†æœ‰äº›è€çš„æˆ–ä¸å®Œæ•´çš„åº”ç”¨ç¨‹åºå¹¶ä¸æ€»æ˜¯åŒæ—¶å‘é€CRå’ŒLFï¼Œæ‰€ä»¥åº”ç”¨ç¨‹åºä¹Ÿåº”è¯¥èƒ½å¤„ç†è¿™ç§æƒ…å†µã€‚\næŠ¥æ–‡çš„ä¸»ä½“æ˜¯ä¸€ä¸ªå¯é€‰çš„æ•°æ®å—ã€‚ä¸èµ·å§‹è¡Œå’Œé¦–éƒ¨ä¸åŒçš„æ˜¯ï¼Œä¸»ä½“ä¸­å¯ä»¥åŒ…å«æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¸ºç©ºã€‚\næŠ¥æ–‡çš„è¯­æ³• æ‰€æœ‰çš„HTTPæŠ¥æ–‡éƒ½å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šè¯·æ±‚æŠ¥æ–‡ï¼ˆrequest messageï¼‰å’Œå“åº”æŠ¥æ–‡ï¼ˆresponse messageï¼‰ã€‚è¯·æ±‚æŠ¥æ–‡è¯·æ±‚æœåŠ¡å™¨æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œè€Œå“åº”æŠ¥æ–‡åˆ™ä¼šå°†è¯·æ±‚çš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡çš„åŸºæœ¬æœºæ„ç›¸åŒï¼Œä½†å®ƒä»¬çš„æ ¼å¼æœ‰äº›è®¸å·®å¼‚ã€‚\nè¿™æ˜¯è¯·æ±‚æŠ¥æ–‡çš„æ ¼å¼ï¼š\n\u0026lt;method\u0026gt; \u0026lt;request-URL\u0026gt; \u0026lt;version\u0026gt; \u0026lt;headers\u0026gt; \u0026lt;entity-body\u0026gt; è¿™æ˜¯å“åº”æŠ¥æ–‡çš„æ ¼å¼ï¼ˆå®ƒå’Œè¯·æ±‚æŠ¥æ–‡åªæœ‰èµ·å§‹è¡Œä¸åŒï¼‰ï¼š\n\u0026lt;version\u0026gt; \u0026lt;status\u0026gt; \u0026lt;reson-phrase\u0026gt; \u0026lt;headers\u0026gt; \u0026lt;entity-body\u0026gt; ä¸‹é¢æ˜¯å¯¹æŠ¥æ–‡æ ¼å¼ä¸­å„ç»„æˆéƒ¨åˆ†çš„ä¸€ä¸ªç®€çŸ­è¯´æ˜ï¼š\n æ–¹æ³•ï¼ˆmethodï¼‰ï¼šå‘ŠçŸ¥æœåŠ¡å™¨è¦åšä»€ä¹ˆã€‚ è¯·æ±‚URLï¼ˆrequest-URLï¼‰ï¼šæŒ‡å®šäº†æ‰€è¯·æ±‚èµ„æºæˆ–URLé‡Œé¢pathéƒ¨åˆ†çš„å®Œæ•´URLã€‚ ç‰ˆæœ¬ï¼ˆversionï¼‰ï¼šæŠ¥æ–‡æ‰€ä½¿ç”¨çš„HTTPç‰ˆæœ¬ï¼Œæ ¼å¼ä¸ºï¼šHTTP/\u0026lt;major-version\u0026gt;.\u0026lt;minor-version\u0026gt;ã€‚ çŠ¶æ€ç ï¼ˆstatus-codeï¼‰ï¼šæè¿°è¯·æ±‚è¿‡ç¨‹ç§å‘ç”Ÿçš„æƒ…å†µï¼Œæ¯ä¸ªçŠ¶æ€ç çš„ç¬¬ä¸€ä½æ•°å­—éƒ½å¯¹åº”ä¸€ç±»çŠ¶æ€ã€‚ åŸå› çŸ­è¯­ï¼ˆreason-phraseï¼‰ï¼šè¿™æ˜¯çŠ¶æ€ç çš„å¯è¯»ç‰ˆæœ¬ï¼ŒåŒ…å«è¡Œç»ˆæ­¢ç¬¦ä¹‹å‰çš„æ‰€æœ‰æ–‡æœ¬ã€‚ é¦–éƒ¨ï¼ˆheaderï¼‰ï¼šé¦–éƒ¨çš„æ•°é‡å¯ä»¥ä¸º0ä¸ªã€1ä¸ªæˆ–å¤šä¸ªï¼Œæ¯ä¸ªé¦–éƒ¨éƒ½åŒ…å«ä¸€ä¸ªåå­—ï¼Œåå­—åé¢è·Ÿç€ä¸€ä¸ª:ï¼Œç„¶åæ˜¯ä¸€ä¸ªå¯é€‰çš„ç©ºæ ¼ï¼Œæ¥ç€æ˜¯ä¸€ä¸ªå€¼ï¼Œæœ€åæ˜¯ä¸€ä¸ªCRLFã€‚é¦–éƒ¨æ€»æ˜¯ä»¥ä¸€ä¸ªç©ºè¡Œï¼ˆå•ä¸ªCRLFï¼‰ç»“æŸã€‚ ä¸»ä½“ï¼ˆentity-bodyï¼‰ï¼šä¸»ä½“éƒ¨åˆ†åŒ…å«ä¸€ä¸ªç”±ä»»æ„æ•°æ®ç»„æˆçš„æ•°æ®å—ã€‚è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„éƒ¨åˆ†ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æŠ¥æ–‡éƒ½æœ‰ä¸»ä½“éƒ¨åˆ†ï¼Œæœ‰æ—¶ï¼ŒæŠ¥æ–‡åªæ˜¯ä»¥ä¸€ä¸ªCRLFç»“æŸã€‚  èµ·å§‹è¡Œ æ‰€æœ‰çš„HTTPæŠ¥æ–‡éƒ½ä»¥ä¸€ä¸ªèµ·å§‹è¡Œä½œä¸ºå¼€å§‹ã€‚è¯·æ±‚æŠ¥æ–‡çš„èµ·å§‹è¡Œè¯´æ˜äº†è¦åšä»€ä¹ˆï¼Œè€Œå“åº”æŠ¥æ–‡çš„èµ·å§‹è¡Œåˆ™è¯´æ˜äº†å‘ç”Ÿäº†ä»€ä¹ˆã€‚\nè¯·æ±‚è¡Œ è¯·æ±‚æŠ¥æ–‡çš„èµ·å§‹è¡Œç§°ä¸ºè¯·æ±‚è¡Œï¼ˆrequest lineï¼‰ã€‚è¯·æ±‚è¡ŒåŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼Œå³[æŠ¥æ–‡çš„è¯­æ³•]éƒ¨åˆ†ä»‹ç»çš„æ–¹æ³•ã€è¯·æ±‚URLå’Œç‰ˆæœ¬ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚\nå“åº”è¡Œ å“åº”æŠ¥æ–‡çš„èµ·å§‹è¡Œç§°ä¸ºå“åº”è¡Œï¼ˆresponse lineï¼‰ï¼Œå®ƒåŒ…å«äº†å“åº”æŠ¥æ–‡æ‰€ä½¿ç”¨çš„HTTPç‰ˆæœ¬ã€æ•°å­—çŠ¶æ€ç å’Œæè¿°æ“ä½œçŠ¶æ€çš„åŸå› çŸ­è¯­ã€‚\næ–¹æ³• è¯·æ±‚è¡Œä»¥æ–¹æ³•å¼€å§‹ï¼Œæ–¹æ³•å‘ŠçŸ¥æœåŠ¡å™¨è¦åšä»€ä¹ˆã€‚ä¸‹é¢æè¿°äº†7ç§å¸¸ç”¨çš„HTTPæ–¹æ³•ï¼š\n   æ–¹æ³• æè¿° æ˜¯å¦åŒ…å«body     GET ä»æœåŠ¡å™¨è·å–ä¸€ä»½æ–‡æ¡£ å¦   HEAD åªä»æœåŠ¡å™¨è·å–æ–‡æ¡£çš„é¦–éƒ¨ å¦   POST å‘æœåŠ¡å™¨å‘é€éœ€è¦å¤„ç†çš„æ•°æ® æ˜¯   PUT å°†è¯·æ±‚çš„bodyéƒ¨åˆ†å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Š æ˜¯   TRACE å¯¹å¯èƒ½ç»è¿‡ä»£ç†ä¼ é€åˆ°æœåŠ¡å™¨ä¸Šçš„æŠ¥æ–‡è¿›è¡Œè¿½è¸ª å¦   OPTIONS å†³å®šå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå“ªäº›æ–¹æ³• å¦   DELETE ä»æœåŠ¡å™¨ä¸Šåˆ é™¤ä¸€ä»½æ–‡æ¡£ å¦    å¹¶ä¸æ˜¯æ‰€æœ‰çš„æœåŠ¡å™¨éƒ½å®ç°äº†ä»¥ä¸Š7ç§æ–¹æ³•ã€‚æ­¤å¤–ï¼Œç”±äºHTTPåœ¨è®¾è®¡ä¸Šæ˜¯æ˜“æ‰©å±•çš„ï¼Œä¸€äº›æœåŠ¡å™¨å¯èƒ½è¿˜ä¼šå®ç°ä¸€äº›è‡ªå·±çš„è¯·æ±‚æ–¹æ³•ã€‚\nçŠ¶æ€ç  æ–¹æ³•æ˜¯å®¢æˆ·ç«¯ç”¨æ¥å‘ŠçŸ¥æœåŠ¡å™¨åšä»€ä¹ˆï¼Œè€ŒçŠ¶æ€ç æ˜¯æœåŠ¡å™¨ç”¨æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯å‘ç”Ÿäº†ä»€ä¹ˆçš„ã€‚çŠ¶æ€ç ä½äºå“åº”è¡Œä¸­ï¼ŒçŠ¶æ€ç ä¸ºæ•°å­—ï¼Œä¾¿äºç¨‹åºè¿›è¡Œå¤„ç†ã€‚è€ŒåŸå› çŸ­è¯­ä¸ºæ–‡æœ¬ï¼Œæ–¹ä¾¿äººä»¬ç†è§£ã€‚çŠ¶æ€ç å…±æœ‰5ä¸ªç±»åˆ«ï¼š\n   æ€»èŒƒå›´ å·²å®šä¹‰èŒƒå›´ åˆ†ç±»     100 ~ 199 100 ~ 101 ä¿¡æ¯æç¤º   200 ~ 299 200 ~ 206 æˆåŠŸ   300 ~ 399 300 ~ 305 é‡å®šå‘   400 ~ 499 400 ~ 415 å®¢æˆ·ç«¯é”™è¯¯   500 ~ 599 500 ~ 505 æœåŠ¡å™¨é”™è¯¯    åŸå› çŸ­è¯­ åŸå› çŸ­è¯­æ˜¯å“åº”è¡Œä¸­çš„æœ€åä¸€ä¸ªéƒ¨åˆ†ï¼Œå®ƒä¸ºçŠ¶æ€ç æä¾›äº†æ–‡æœ¬å½¢å¼çš„è§£é‡Šï¼Œæ–¹ä¾¿äººä»¬ç†è§£ã€‚çŠ¶æ€ç å’ŒåŸå› çŸ­è¯­æ€»æ˜¯æˆå¯¹å‡ºç°ã€‚\nç‰ˆæœ¬å· ç‰ˆæœ¬å·ä¼šä»¥HTTP/\u0026lt;major\u0026gt;.\u0026lt;minor\u0026gt;çš„å½¢å¼å‡ºç°åœ¨èµ·å§‹è¡Œä¸­ï¼ŒHTTPåº”ç”¨ç¨‹åºç”¨å®ƒæ¥å‘Šè¯‰å¯¹æ–¹è‡ªå·±æ‰€éµå¾ªçš„åè®®ç‰ˆæœ¬ï¼Œä»¥ä¾¿åŒæ–¹äº’ç›¸ç†è§£ã€‚ç‰ˆæœ¬å·è¯´æ˜äº†åº”ç”¨ç¨‹åºæ”¯æŒçš„æœ€é«˜HTTPç‰ˆæœ¬ã€‚\né¦–éƒ¨ HTTPçš„èµ·å§‹è¡Œåä¼šæœ‰0ä¸ªã€1ä¸ªæˆ–å¤šä¸ªé¦–éƒ¨å­—æ®µï¼Œé¦–éƒ¨å†…å®¹ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åˆ†åˆ«å¤„ç†è¯·æ±‚å’Œå“åº”æé€æ‰€éœ€è¦çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šæŠ¥æ–‡ä¸»ä½“çš„å¤§å°ã€æ‰€ä½¿ç”¨çš„è¯­è¨€ã€ç¼–ç ã€è®¤è¯ä¿¡æ¯ç­‰ï¼‰ã€‚é¦–éƒ¨å­—æ®µæœ¬è´¨ä¸ºä¸€ä¸ªé”®-å€¼å¯¹åˆ—è¡¨ã€‚\nHTTPè§„èŒƒå®šä¹‰äº†å‡ ç§ç±»å‹çš„é¦–éƒ¨ï¼š\n é€šç”¨é¦–éƒ¨ï¼šæ—¢å¯ä»¥å‡ºç°åœ¨è¯·æ±‚æŠ¥æ–‡ä¸­ï¼Œä¹Ÿå¯ä»¥å‡ºç°åœ¨å“åº”æŠ¥æ–‡ä¸­ã€‚ è¯·æ±‚é¦–éƒ¨ï¼šæä¾›æ›´å¤šæœ‰å…³è¯·æ±‚çš„ä¿¡æ¯ã€‚ å“åº”é¦–éƒ¨ï¼šæä¾›æ›´å¤šæœ‰å…³å“åº”çš„ä¿¡æ¯ã€‚ å®ä½“é¦–éƒ¨ï¼šæè¿°bodyçš„é•¿åº¦å’Œå†…å®¹ï¼Œæˆ–èµ„æºæœ¬èº«ã€‚ æ‰©å±•é¦–éƒ¨ï¼šè§„èŒƒä¸­æ²¡æœ‰å®šä¹‰çš„æ–°é¦–éƒ¨ã€‚  é™¤äº†HTTPè§„èŒƒå®šä¹‰çš„å‡ ç§é¦–éƒ¨å­—æ®µå¤–ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥éšæ„å‘æ˜è‡ªå·±æ‰€ç”¨çš„é¦–éƒ¨ã€‚\nä¸»ä½“ ä½œä¸ºHTTPæŠ¥æ–‡çš„æœ€åä¸€éƒ¨åˆ†ï¼Œbodyå°±æ˜¯HTTPæŠ¥æ–‡è¦ä¼ è¾“çš„å†…å®¹ã€‚\nå†…å®¹åå•† åŒä¸€ä¸ªWebç½‘ç«™å¯èƒ½å­˜æœ‰å¤šä»½è¡¨ç¤ºç›¸åŒå†…å®¹çš„é¡µé¢ï¼ˆæ¯”å¦‚åŒä¸€ä¸ªé¡µé¢å¯èƒ½å­˜åœ¨è‹±è¯­ç‰ˆæœ¬å’Œä¸­æ–‡ç‰ˆæœ¬ï¼‰ã€‚å½“æµè§ˆå™¨é»˜è®¤è¯­è¨€ä¸ºè‹±æ–‡æ—¶ï¼Œè®¿é—®ç½‘ç«™æ—¶å¯èƒ½å±•ç¤ºçš„æ˜¯è‹±æ–‡é¡µé¢ï¼Œè€Œå½“æµè§ˆå™¨è¯­è¨€è®¾ç½®ä¸ºä¸­æ–‡æ—¶ï¼Œè®¿é—®ç½‘ç«™å±•ç¤ºçš„å¯èƒ½åˆæ˜¯ä¸­æ–‡é¡µé¢ã€‚è¿™ç§æœºåˆ¶å°±æ˜¯å†…å®¹åå•†ï¼ˆContent Negotiationï¼‰ï¼Œå³å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°±å“åº”çš„èµ„æºå†…å®¹è¿›è¡Œäº¤æ¶‰ï¼Œç„¶åè¿”å›ç»™å®¢æˆ·ç«¯æœ€ä¸ºåˆé€‚çš„èµ„æºï¼Œå†³ç­–æ—¶å¯èƒ½ä¼šå°†è¯­è¨€ã€ç¼–ç ã€å­—ç¬¦é›†ç­‰ä½œä¸ºåˆ¤åˆ«æ¡ä»¶ã€‚å†…å®¹åå•†å¯èƒ½æ¶‰åŠçš„é¦–éƒ¨æœ‰ï¼šAcceptã€Accept-Charsetã€Accept-Encodingã€Accept-Languageã€Content-Languageç­‰ã€‚\næœ‰ä¸‰ç§ä¸åŒçš„å†…å®¹åå•†ç±»å‹ï¼šå®¢æˆ·ç«¯é©±åŠ¨åå•†ï¼ˆclient-driver negotiationï¼‰ã€æœåŠ¡ç«¯é©±åŠ¨åå•†ï¼ˆserver-driven negotiationï¼‰å’Œé€æ˜åå•†ï¼ˆtransparent negotiationï¼‰ã€‚\nå®¢æˆ·ç«¯é©±åŠ¨åå•† å®¢æˆ·ç«¯å…ˆå‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›ä¸€ä¸ªå¯ä¾›é€‰æ‹©çš„åˆ—è¡¨ï¼Œç„¶åå®¢æˆ·ç«¯ä»åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ã€‚è¿™ç§æ–¹å¼å¯¹æœåŠ¡ç«¯æ¥è¯´æ›´å®¹æ˜“å®ç°ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å¯ä»¥åšå‡ºæœ€åˆé€‚çš„é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œè¿™å›ä½¿å¾—æ•´ä¸ªè¿‡ç¨‹å˜å¾—æ›´é•¿ï¼Œå› ä¸ºè‡³å°‘éœ€è¦ä¸¤æ¬¡è¯·æ±‚æ‰èƒ½è·å–åˆ°æ­£ç¡®çš„å†…å®¹ã€‚\næœåŠ¡ç«¯é©±åŠ¨åå•† æœåŠ¡ç«¯é€šè¿‡æ£€æŸ¥å®¢æˆ·ç«¯çš„è¯·æ±‚å¤´ï¼Œä»è€Œå†³å®šè¦è¿”å›çš„å†…å®¹ã€‚è¿™ç§æ–¹å¼æ¯”å®¢æˆ·ç«¯é©±åŠ¨åå•†æ›´å¿«ï¼ŒHTTPæä¾›äº†ä¸€ä¸ªè´¨é‡å€¼æœºåˆ¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©æœåŠ¡å™¨æ‰¾åˆ°æœ€åˆé€‚çš„é€‰æ‹©ã€‚æ­¤å¤–ï¼ŒVaryé¦–éƒ¨ä¹Ÿä¼šå¸®åŠ©æœåŠ¡å™¨è¿›è¡ŒçŒœæµ‹ã€‚æœåŠ¡ç«¯é©±åŠ¨åå•†æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šå¦‚æœè¯·æ±‚å¤´å¯¹æœåŠ¡å™¨æ²¡å•¥å¸®åŠ©ï¼ŒæœåŠ¡å™¨å¿…é¡»çŒœæµ‹å‡ºæœ€ä½³å†…å®¹ã€‚\nå†…å®¹åå•†ç›¸å…³é¦–éƒ¨ å®¢æˆ·ç«¯å¯èƒ½ä¼šä½¿ç”¨ä»¥ä¸‹é¦–éƒ¨å‘Šè¯‰æœåŠ¡å™¨å®ƒä»¬çš„å†…å®¹åå¥½ï¼š\n   Header Description     Accept å‘Šè¯‰æœåŠ¡å™¨å¯æ¥å—çš„åª’ä½“ç±»å‹   Accept-Language å‘Šè¯‰æœåŠ¡å™¨å¯æ¥å—å‘é€çš„è¯­è¨€   Accept-Charset å‘Šè¯‰æœåŠ¡å™¨å¯æ¥å—çš„å­—ç¬¦é›†   Accept-Encoding å‘Šè¯‰æœåŠ¡å™¨å¯æ¥å—çš„ç¼–ç     å½“æ”¶åˆ°çš„è¯·æ±‚å«æœ‰ä»¥ä¸Šçš„é¦–éƒ¨æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šå°†å¯¹åº”çš„å®ä½“é¦–éƒ¨æ·»åŠ åˆ°å“åº”æŠ¥æ–‡ä¸­ï¼š\n   Accept Header Entity header     Accept Content-Type   Accept-Language Content-Language   Accept-Charset Content-Type   Accept-Encoding Content-Encoding    å†…å®¹åå•†é¦–éƒ¨ä¸­çš„è´¨é‡å€¼ ä¸ºäº†å…è®¸å®¢æˆ·ç«¯åˆ—å‡ºæ¯ç§åå¥½ç±»åˆ«çš„å¤šç§é€‰é¡¹ä»¥åŠæ¯ä¸ªåå¥½é€‰é¡¹çš„ä¼˜å…ˆæ¬¡åºï¼ŒHTTPåè®®å®šä¹‰äº†è´¨é‡å€¼ï¼ˆQuality Valueï¼‰ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å¯ä»¥å‘é€ä»¥ä¸‹å½¢å¼çš„Accept-Languageé¦–éƒ¨ï¼š\nAccept-Language: en;q=0.5, fr;q=0.0, zh;q=1.0, tr;q=0.0 å…¶ä¸­qå€¼çš„èŒƒå›´æ˜¯0.0 ~ 1.0ï¼ˆ0.0çš„ä¼˜å…ˆçº§æœ€ä½ï¼Œè€Œ1.0çš„ä¼˜å…ˆçº§æœ€é«˜ï¼‰ã€‚ä¸Šé¢çš„é¦–éƒ¨å¯¿å‘½å®¢æˆ·ç«¯æœ€æ„¿æ„æ¥æ”¶çš„ä¸­æ–‡ï¼ˆzhï¼‰æ–‡æ¡£ï¼Œä½†è‹±è¯­ï¼ˆenï¼‰æ–‡æ¡£ä¹Ÿå¯ä»¥ï¼Œå¹¶ä¸”ä¸æ„¿æ„æ¥æ”¶æ–‡æ¡£çš„æ³•è¯­ï¼ˆfrï¼‰æˆ–åœŸè€³å…¶ï¼ˆtrï¼‰è¯­ç‰ˆæœ¬ã€‚\né€æ˜åå•† ç”±ä¸€ä¸ªä¸­é—´è®¾å¤‡ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªä»£ç†ç¼“å­˜ï¼‰ä»£è¡¨å®¢æˆ·ç«¯è¿›è¡Œå†…å®¹åå•†ã€‚è¿™ç§æ–¹å¼æ¯”å®¢æˆ·ç«¯é©±åŠ¨åå•†æ›´å¿«ï¼Œä½†ç›®å‰å…³äºå¦‚ä½•åå•†æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ ‡å‡†ã€‚\nå‚è€ƒèµ„æ–™  David Gourley, Brian Totty. HTTP: The Definitive Guide. O\u0026rsquo;Reilly Media, 2002. ã€æ—¥ã€‘ä¸Šé‡å®£, å›¾è§£HTTP, äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾, 2014.  ","href":"/computer_networks/http/http_messages/","title":"HTTP æŠ¥æ–‡"},{"content":"Webè¿æ¥ç€ä¸è®¡å…¶æ•°çš„èµ„æºï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„èµ„æºéƒ½æ˜¯å¯ä»¥éšæ„è®¿é—®çš„ã€‚æŸäº›èµ„æºåªå¯¹éƒ¨åˆ†ç‰¹å®šçš„ç”¨æˆ·å¼€æ”¾ï¼Œä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œéœ€è¦å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ï¼ˆauthenticationï¼‰ã€‚é€šè¿‡è®¤è¯ï¼ŒæœåŠ¡å™¨å¯ä»¥çŸ¥é“ç”¨æˆ·æ˜¯è°ï¼Œè¿›è€Œåˆ¤å®šç”¨æˆ·å¯ä»¥è®¿é—®å“ªäº›èµ„æºã€‚ç®€è€Œè¨€ä¹‹ï¼Œè®¤è¯å°±æ˜¯å‘æœåŠ¡å™¨è¯æ˜ä½ æ˜¯è°ï¼Œè€Œ**æˆæƒï¼ˆauthorizationï¼‰**å°±æ˜¯æœåŠ¡å™¨æˆäºˆç”¨æˆ·è®¿é—®ç‰¹å®šèµ„æºçš„æƒé™ã€‚\nHTTP1.1ä½¿ç”¨çš„è®¤è¯æ–¹å¼å¦‚ä¸‹ï¼š\n BASICè®¤è¯ï¼ˆåŸºæœ¬è®¤è¯ï¼‰ DIGESTè®¤è¯ï¼ˆæ‘˜è¦è®¤è¯ï¼‰ SSLå®¢æˆ·ç«¯è®¤è¯ FormBaseè®¤è¯ï¼ˆè¡¨å•è®¤è¯ï¼‰ æ­¤å¤–ï¼Œè¿˜æœ‰NTLMã€Kerberosã€Windows Live IDç­‰è®¤è¯æ–¹å¼ã€‚  HTTPè®¿é—®è®¤è¯æ¡†æ¶ HTTPæä¾›äº†ä¸€ä¸ªç®€å•çš„ è´¨è¯¢-å“åº”ï¼ˆchallenge-responseï¼‰ è®¤è¯æœºåˆ¶ï¼ŒæœåŠ¡å™¨å¯ä»¥ç”¨å®ƒæ¥å¯¹å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡Œè´¨è¯¢ï¼Œè¦æ±‚ç”¨æˆ·æä¾›è®¤è¯ä¿¡æ¯ã€‚ä¸‹å›¾å±•ç¤ºäº†HTTPçš„è®¤è¯æ¨¡å‹ï¼š\nHTTPè®¤è¯æ¨¡å‹ç”±4ä¸ªæ­¥éª¤ç»„æˆï¼š\n è¯·æ±‚ï¼ˆRequestï¼‰ï¼šå®¢æˆ·ç«¯å‘é€è¯·æ±‚ã€‚ è´¨è¯¢ï¼ˆChallengeï¼‰ï¼šå½“å®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºéœ€è¦è®¤è¯æ—¶ï¼ŒæœåŠ¡å™¨ä¼šä»¥401 UnauthorizedçŠ¶æ€ç æ‹’ç»è¯·æ±‚ï¼ŒåŒæ—¶åœ¨å“åº”æŠ¥æ–‡ä¸­æ·»åŠ WWW-Authenticateé¦–éƒ¨å­—æ®µã€‚WWW-Authenticateé¦–éƒ¨å­—æ®µä¼šå¯¹ä¿æŠ¤åŒºåŸŸè¿›è¡Œæè¿°å¹¶æŒ‡å®šè®¤è¯ç®—æ³•ã€‚ æˆæƒï¼ˆAuthorizationï¼‰ï¼šå®¢æˆ·ç«¯é‡æ–°å‘èµ·è¯·æ±‚ï¼Œä½†è¿™æ¬¡ä¼šç»™è¯·æ±‚æŠ¥æ–‡é™„åŠ ä¸€ä¸ªAuthorizationé¦–éƒ¨ã€‚Authorizationé¦–éƒ¨è¯´æ˜äº†è®¤è¯ç®—æ³•ã€ç”¨æˆ·åå’Œå¯†ç ã€‚ æˆåŠŸï¼ˆSuccessï¼‰ï¼šå¦‚æœæˆæƒæˆåŠŸï¼ŒæœåŠ¡å™¨å°±ä¼šè¿”å›å®¢æˆ·ç«¯æ‰€è¯·æ±‚çš„å†…å®¹ã€‚æœ‰äº›æˆæƒç®—æ³•ä¼šåœ¨Authentication-Infoé¦–éƒ¨ä¸­è¿”å›ä¸€äº›ä¸æˆæƒä¼šè¯ç›¸å…³çš„é™„åŠ ä¿¡æ¯ã€‚  HTTPå…è®¸æœåŠ¡å™¨ç»™ä¸åŒçš„èµ„æºæŒ‡å®šä¸åŒçš„è®¿é—®æƒé™ï¼Œè¿™æ˜¯é€šè¿‡å®‰å…¨åŸŸæ¥å®ç°çš„ã€‚WebæœåŠ¡å™¨ä¼šå°†å—ä¿æŠ¤çš„æ–‡æ¡£ç»„ç»‡æˆä¸€ä¸ªå®‰å…¨åŸŸï¼ˆsecurity realmï¼‰ï¼Œæ¯ä¸ªå®‰å…¨åŸŸéƒ½å¯ä»¥æœ‰ä¸åŒçš„æˆæƒç”¨æˆ·ã€‚\nBASICè®¤è¯ BASICè®¤è¯æ—©åœ¨HTTP/1.0è§„èŒƒä¸­å°±è¢«æå‡ºæ¥äº†ï¼Œåæ¥è¢«ç§»åˆ°äº†RFC2617ä¸­ã€‚ç°åœ¨ä»ç„¶æœ‰ä¸€éƒ¨åˆ†ç½‘ç«™ä½¿ç”¨è¿™ç§ä¼ ç»Ÿçš„è®¤è¯æ–¹å¼ã€‚BASICè®¤è¯ä¸­ä¼šä½¿ç”¨WWW-Authenticateå’ŒAuthorizationä¸¤ä¸ªé¦–éƒ¨ï¼Œä½†å¹¶ä¸ä¼šä½¿ç”¨Authentication-Infoé¦–éƒ¨ï¼š\n è´¨è¯¢ï¼ˆæœåŠ¡å™¨å‘å¾€å®¢æˆ·ç«¯ï¼‰ï¼šç½‘ç«™çš„ä¸åŒéƒ¨åˆ†å¯èƒ½ä½¿ç”¨ä¸åŒçš„å¯†ç ï¼ŒRealmæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå‘Šè¯‰ç”¨æˆ·è¯¥ä½¿ç”¨å“ªä¸ªè´¦å·å’Œå¯†ç ã€‚é¦–éƒ¨æ ¼å¼ä¸ºï¼šWWW-Authenticate: Basic realm=quoted-realmã€‚ å“åº”ï¼ˆå®¢æˆ·ç«¯å‘å¾€æœåŠ¡ç«¯ï¼‰ï¼šå®¢æˆ·ç«¯ç”¨:å°†ç”¨æˆ·åå’Œå¯†ç è¿æ¥èµ·æ¥ï¼Œç„¶åç”¨Base-64è¿›è¡Œç¼–ç ã€‚é¦–éƒ¨æ ¼å¼ä¸ºï¼šAuthorization: Basic base64-username-and-passwordã€‚  BASICè®¤è¯çš„æ­¥éª¤ ä¸‹é¢æ˜¯BASICè®¤è¯çš„ä¸€ä¸ªä¾‹å­ï¼š\nBASICè®¤è¯çš„æ­¥éª¤å¦‚ä¸‹ï¼š\n å®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºéœ€è¦BASICè®¤è¯çš„èµ„æºã€‚ æœåŠ¡å™¨ä¼šéšçŠ¶æ€ç 401 Authorization Requiredè¿”å›å¸¦WWW-Authenticateé¦–éƒ¨å­—æ®µçš„å“åº”ï¼Œè¯¥å­—æ®µå†…åŒ…å«äº†è®¤è¯çš„æ–¹å¼ï¼ˆBASICï¼‰å’Œè¯·æ±‚èµ„æºæ‰€å±å®‰å…¨åŸŸï¼ˆrealm=\u0026quot;xxx\u0026quot;ï¼‰ã€‚ å®¢æˆ·ç«¯å‘ç”¨æˆ·è¯¢é—®ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åç”¨:è¿æ¥äºŒè€…ï¼Œå†è¿›è¡ŒBase-64ç¼–ç å¤„ç†ã€‚ç¼–ç ç»“æœä¼šæ”¾åœ¨Authorizationé¦–éƒ¨ä¸­å›é€ç»™æœåŠ¡å™¨ã€‚ æœåŠ¡å™¨å¯¹ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œè§£ç ï¼ŒéªŒè¯å®ƒä»¬çš„æ­£ç¡®æ€§ã€‚å¦‚æœéªŒè¯é€šè¿‡ï¼Œåˆ™è¿”å›ä¸€æ¡åŒ…å«è¯·æ±‚èµ„æºçš„å“åº”ã€‚  ä»£ç†è®¤è¯ ä½äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä»£ç†ä¹Ÿå¯ä»¥å®ç°è®¤è¯åŠŸèƒ½ã€‚ä»£ç†è®¤è¯çš„æ­¥éª¤å’ŒBASICè®¤è¯çš„èº«ä»½éªŒè¯æ­¥éª¤ç›¸åŒï¼Œä½†é¦–éƒ¨å’ŒçŠ¶æ€ç éƒ½æœ‰æ‰€ä¸åŒã€‚ä¸‹è¡¨åˆ—å‡ºäº†WebæœåŠ¡å™¨å’Œä»£ç†åœ¨è®¤è¯ä¸­ä½¿ç”¨çš„çŠ¶æ€ç å’Œé¦–éƒ¨çš„å·®å¼‚ï¼š\n   Web Server Proxy Server     Unauthorized status code: 401 Unauthorized status code: 407   WWW-Authenticate Proxy-Authenticate   Authorization Proxy-Authorization   Authentication-Info Proxy-Authentication-Info    BASICè®¤è¯çš„ç¼ºé™· BASICè®¤è¯è™½ç„¶ç®€å•ä¾¿æ·ï¼Œä½†å¹¶ä¸å®‰å…¨ã€‚åªèƒ½ç”¨å®ƒæ¥é˜²æ­¢éæ¶æ„ç”¨æˆ·çš„æ— æ„é—´è®¿é—®ï¼Œæˆ–é…åˆSSLç­‰åŠ å¯†æŠ€æœ¯ä¸€èµ·ä½¿ç”¨ã€‚BASICè®¤è¯å­˜åœ¨ä¸€äº›ç¼ºé™·ï¼š\n é€šè¿‡ç½‘ç»œå‘é€ç”¨æˆ·åå’Œå¯†ç ã€‚è™½ç„¶ç”¨æˆ·åå’Œå¯†ç ç»è¿‡äº†Base-64ç¼–ç ï¼Œä½†å¯ä»¥è½»æ¾è§£ç ã€‚ æ”»å‡»è€…å¯ä»¥å—…æ¢åˆ°ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åå®æ–½é‡æ”¾æ”»å‡»ã€‚ ç¼ºä¹é’ˆå¯¹ä»£ç†æˆ–ä¸­é—´äººç­‰ä¸­é—´èŠ‚ç‚¹çš„é˜²æŠ¤æªæ–½ã€‚ æœåŠ¡å™¨å¾ˆå®¹æ˜“è¢«å‡å†’ã€‚  DIGESTè®¤è¯ BASICè®¤è¯è™½ç„¶ç®€å•ï¼Œä½†æä¸å®‰å…¨ï¼šç”¨æˆ·åå’Œå¯†ç æ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼ŒæŠ¥æ–‡ä¹Ÿå®¹æ˜“è¢«ç¯¡æ”¹ï¼Œä¿è¯å®‰å…¨çš„å”¯ä¸€æ–¹å¼å°±æ˜¯é…åˆSSLè¿›è¡ŒBASICè®¤è¯ã€‚ç”±äºBASICè®¤è¯æ— æ³•è¾¾åˆ°å¤§å¤šæ•°Webç½‘ç«™æœŸæœ›çš„å®‰å…¨ç­‰çº§ï¼Œå®ƒå¹¶ä¸å¸¸ç”¨ã€‚ä¸ºäº†å¼¥è¡¥BASICè®¤è¯çš„ä¸è¶³ï¼ŒHTTP/1.1å¼•å…¥äº†DIGESTè®¤è¯ã€‚DIGESTè®¤è¯åŒæ ·é‡‡ç”¨äº†è´¨è¯¢/å“åº”çš„æ–¹å¼ï¼Œä½†ä¸ä¼šå‘é€æ˜æ–‡å¯†ç ï¼Œå› æ­¤æ›´åŠ å®‰å…¨ã€‚\nDIGESTè®¤è¯æ­¥éª¤ ç”±äºDIGESTè®¤è¯å’ŒBASICè®¤è¯éƒ½é‡‡ç”¨äº†HTTPçš„è´¨è¯¢/å“åº”æ¡†æ¶ï¼Œæ‰€ä»¥DIGESTè®¤è¯çš„æ­¥éª¤ä¸BASICè®¤è¯çš„æ­¥éª¤åŸºæœ¬ç›¸åŒã€‚ä¸‹å›¾å±•ç¤ºäº†äºŒè€…å†è¯­æ³•ä¸Šçš„å·®å¼‚ï¼š\nDIGESTè®¤è¯çš„æ­¥éª¤å¦‚ä¸‹ï¼š\n å®¢æˆ·ç«¯è¯·æ±‚å—ä¿æŠ¤çš„èµ„æºã€‚ æœåŠ¡å™¨ä¼šéšçŠ¶æ€ç 401 Authorization Requiredè¿”å›å¸¦WWW-Authenticateé¦–éƒ¨å­—æ®µçš„å“åº”ï¼Œè¯¥å­—æ®µå†…åŒ…å«äº†è®¤è¯çš„æ–¹å¼ï¼ˆDIGESTï¼‰ã€å¯¹åº”çš„ä¿æŠ¤åŸŸï¼ˆrealmï¼‰ã€ä¸´æ—¶è´¨è¯¢ç ï¼ˆnonceï¼Œä¸€ä¸ªéšæœºæ•°ï¼‰ç­‰ã€‚realmå’Œnonceè¿™ä¸¤ä¸ªå­—æ®µæ˜¯å¿…é¡»è¦æœ‰çš„ï¼Œå®¢æˆ·ç«¯éœ€è¦ä¾é å‘æœåŠ¡ç«¯å›é€è¿™ä¸¤ä¸ªå€¼è¿›è¡Œè®¤è¯ã€‚ å®¢æˆ·ç«¯å†Authorizationé¦–éƒ¨ä¸­è¿”å›DIGESTè®¤è¯æ‰€å¿…é¡»çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬usernameã€realmã€nonceã€uriã€responseçš„å­—æ®µä¿¡æ¯ç­‰ã€‚å…¶ä¸­realmå’Œnonceå°±æ˜¯ä¸Šä¸€æ­¥ä¸­ä»æœåŠ¡å™¨å“åº”ä¸­æ”¶åˆ°çš„å­—æ®µã€‚ æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯æä¾›çš„ä¿¡æ¯è¿›è¡ŒéªŒè¯ã€‚è‹¥éªŒè¯é€šè¿‡ï¼Œåˆ™è¿”å›å—ä¿æŠ¤çš„èµ„æºã€‚  å‚è€ƒèµ„æ–™  David Gourley, Brian Totty. HTTP: The Definitive Guide. O\u0026rsquo;Reilly Media, 2002. RFC2617.  ","href":"/computer_networks/http/http_authentication/","title":"HTTP è®¤è¯"},{"content":"Webä¸Šæ‰€æœ‰çš„èµ„æºéƒ½å¯ä»¥ä½¿ç”¨HTTPåè®®ï¼Œå¹¶ä¸”å…¶å®ƒåº”ç”¨å’Œåº”ç”¨åè®®ä¹Ÿå¯ä»¥åˆ©ç”¨HTTPæ¥å®Œæˆå®ƒä»¬çš„ä»»åŠ¡ã€‚å¼€å‘è€…å¯ä»¥å°†HTTPä½œä¸ºä¸€ä¸ªæ¡†æ¶æ¥ä½¿ç”¨å…¶å®ƒåè®®å¹¶è¿›è¡Œåº”ç”¨é€šä¿¡ï¼Œä¾‹å¦‚ï¼š\n ç”¨ç½‘å…³ä½œä¸ºHTTPä¸å…¶å®ƒåè®®å’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„æ¥å£ã€‚ ç”¨åº”ç”¨ç¨‹åºæ¥å£æ¥å®ç°Webä¸Šä¸åŒç±»å‹èµ„æºä¹‹é—´çš„ç›¸äº’é€šä¿¡ã€‚ ç”¨éš§é“åœ¨HTTPè¿æ¥ä¸Šå‘é€éHTTPæµé‡ã€‚ ç”¨ä¸­ç»§é€è·³è½¬å‘æ•°æ®ã€‚  ç½‘å…³ ç½‘å…³ï¼ˆgatewayï¼‰ æ˜¯ä¸€ç§åœ¨æœåŠ¡å™¨ä¹‹é—´å……å½“ä¸­é—´å®ä½“çš„ç‰¹æ®ŠæœåŠ¡å™¨ï¼Œé€šå¸¸ç”¨æ¥å°†HTTPæµé‡è½¬æ¢ä¸ºå…¶å®ƒåè®®æµé‡ã€‚ç½‘å…³æ€»æ˜¯åƒæºæœåŠ¡å™¨ä¸€æ ·æ¥æ”¶è¯·æ±‚ï¼Œå®¢æˆ·ç«¯å¯èƒ½å¹¶ä¸çŸ¥é“è‡ªå·±åœ¨å’Œä¸€ä¸ªç½‘å…³é€šä¿¡ã€‚\nå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç½‘å…³ Webç½‘å…³åœ¨ä¸€ä¾§ä½¿ç”¨HTTPåè®®ï¼Œè€Œåœ¨å¦ä¸€ä¾§ä½¿ç”¨å¦ä¸€ç§åè®®ã€‚\nç½‘å…³å¯ä»¥ç”¨ä¸€ä¸ª/åˆ†éš”çš„å®¢æˆ·ç«¯åè®®å’ŒæœåŠ¡ç«¯åè®®è¿›è¡Œæè¿°ï¼š\u0026lt;client-protocol\u0026gt;/\u0026lt;server-protocol\u0026gt;ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè¿æ¥HTTPå®¢æˆ·ç«¯ä¸FTPæœåŠ¡å™¨çš„ç½‘å…³å°±å¯ä»¥è¢«ç§°ä¸ºHTTP/FTPç½‘å…³ã€‚å¯ä»¥ç”¨æœ¯è¯­ å®¢æˆ·ç«¯ç½‘å…³ï¼ˆclent-side gatewayï¼‰ å’Œ æœåŠ¡ç«¯ç½‘å…³ï¼ˆserver-side gatewayï¼‰ æ¥æè¿°å¯¹è¯æ˜¯åœ¨ç½‘å…³çš„å“ªä¸€ä¾§è¿›è¡Œçš„ï¼š\n å®¢æˆ·ç«¯ç½‘å…³ä¸å®¢æˆ·ç«¯ä½¿ç”¨HTTPè¿›è¡Œå¯¹è¯ï¼Œè€Œä¸æœåŠ¡å™¨ä½¿ç”¨å…¶å®ƒåè®®ï¼ˆHTTP/*ï¼‰ã€‚ æœåŠ¡ç«¯ç½‘å…³ä¸å®¢æˆ·ç«¯ä½¿ç”¨å…¶å®ƒåè®®è¿›è¡Œå¯¹è¯ï¼Œè€Œä¸æœåŠ¡å™¨ä½¿ç”¨HTTPåè®®ï¼ˆ*/HTTPï¼‰ã€‚  åè®®ç½‘å…³ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸å°†æµé‡å¯¼å‘ä»£ç†ç›¸åŒçš„æ–¹æ³•æ¥å°†æµé‡å¯¼å…¥ç½‘å…³ã€‚ä¾‹å¦‚ï¼Œæ˜¾å¼é…ç½®æµè§ˆå™¨ä½¿ç”¨ç½‘å…³ã€å¯¹æµé‡è¿›è¡Œé€æ˜æ‹¦æˆªæˆ–å°†ç½‘å…³æ ‡è®°é…ç½®ä¸ºåå‘ä»£ç†ã€‚\nHTTP/*ï¼šæœåŠ¡ç«¯Webç½‘å…³ è¯·æ±‚æµå…¥æºæœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡ç«¯Webç½‘å…³ä¼šå°†å®¢æˆ·ç«¯HTTPè¯·æ±‚è½¬æ¢ä¸ºå…¶å®ƒåè®®ã€‚\nHTTP/HTTPSï¼šæœåŠ¡ç«¯å®‰å…¨ç½‘å…³ ä¸€ä¸ªç»„ç»‡å¯ä»¥é€šè¿‡ç½‘å…³å¯¹æ‰€æœ‰çš„è¾“å…¥Webè¯·æ±‚åŠ å¯†ï¼Œä»¥æä¾›é¢å¤–çš„éšç§å’Œå®‰å…¨æ€§ä¿æŠ¤ã€‚å®¢æˆ·ç«¯å¯ä»¥ç”¨æ™®é€šçš„HTTPæµè§ˆWebå†…å®¹ï¼Œä½†æ˜¯ç½‘å…³ä¼šè‡ªåŠ¨åŠ å¯†ç”¨æˆ·çš„å¯¹è¯ã€‚\nHTTPS/HTTPï¼šå®¢æˆ·ç«¯å®‰å…¨åŠ é€Ÿå™¨ç½‘å…³ HTTPS/HTTPç½‘å…³ä½äºWebæœåŠ¡å™¨ä¹‹å‰ï¼Œé€šå¸¸ä½œä¸ºä¸å¯è§çš„æ‹¦æˆªç½‘å…³æˆ–åå‘ä»£ç†ä½¿ç”¨ã€‚å®ƒä»¬æ¥æ”¶å®‰å…¨çš„HTTPSæµé‡ï¼Œå¯¹å®‰å…¨æµé‡è¿›è¡Œè§£å¯†ï¼Œå¹¶å‘WebæœåŠ¡å™¨å‘é€æ™®é€šçš„HTTPè¯·æ±‚ã€‚è¿™äº›ç½‘å…³é€šå¸¸åŒ…å«ä¸“ç”¨çš„è§£å¯†ç¡¬ä»¶ï¼Œå¯ä»¥é«˜æ•ˆåœ°è§£å¯†å®‰å…¨æµé‡ï¼Œä»è€Œé™ä½æºæœåŠ¡å™¨çš„è´Ÿè·ã€‚ä½†æ˜¯ï¼Œç½‘å…³å’ŒæºæœåŠ¡å™¨ä¹‹é—´å‘é€çš„æ˜¯æœªåŠ å¯†çš„æµé‡ï¼Œæ‰€ä»¥éœ€è¦ç¡®ä¿ç½‘å…³å’ŒæºæœåŠ¡å™¨ä¹‹é—´çš„å®‰å…¨æ€§ã€‚\nèµ„æºç½‘å…³ åº”ç”¨æœåŠ¡å™¨æ˜¯ç½‘å…³æœ€å¸¸è§çš„å½¢å¼ã€‚åº”ç”¨æœåŠ¡å™¨æ˜¯æœåŠ¡ç«¯ç½‘å…³ï¼Œå®ƒä¸å®¢æˆ·ç«¯ä¹‹é—´é€šè¿‡HTTPé€šä¿¡ï¼Œå¹¶ä¸æœåŠ¡ç«¯çš„æŸä¸ªåº”ç”¨ç¨‹åºç›¸è¿ã€‚åº”ç”¨æœåŠ¡å™¨å¯èƒ½ä¼šå°†HTTPè¯·æ±‚é€šè¿‡**åº”ç”¨ç¼–ç¨‹æ¥å£ï¼ˆApplication Programming Interface, APIï¼‰**ä¼ é€’ç»™è¿è¡Œåœ¨æœåŠ¡ç«¯ä¸Šçš„åº”ç”¨ç¨‹åºã€‚\né€šç”¨ç½‘å…³æ¥å£ ç¬¬ä¸€ä¸ªæµè¡Œçš„åº”ç”¨ç¨‹åºç½‘å…³APIå°±æ˜¯é€šç”¨ç½‘å…³æ¥å£ï¼ˆCommon Gateway Interface, CGIï¼‰ã€‚CGIæ˜¯ä¸€ä¸ªæ ‡å‡†æ¥å£é›†ï¼ŒWebæœåŠ¡å™¨å¯ä»¥ç”¨å®ƒæ¥è£…è½½ç¨‹åºä»¥å¤„ç†å¯¹ç‰¹å®šURLçš„HTTPè¯·æ±‚ï¼Œæ”¶é›†ç¨‹åºçš„è¾“å‡ºæ•°æ®å¹¶å°†å…¶æ”¾å…¥HTTPå“åº”ä¸­å›é€ã€‚\nä¸Šå›¾å±•ç¤ºäº†æœåŠ¡å™¨ä¸ç½‘å…³åº”ç”¨ç¨‹åºä¹‹é—´çš„åŸºæœ¬äº¤äº’æœºåˆ¶ã€‚è¿™ä¸ªåè®®ï¼ˆè¯·æ±‚ã€è½¬äº¤ã€å“åº”ï¼‰å°±æ˜¯CGIæ¨¡å‹çš„åŸºæœ¬è¿è¡Œæœºåˆ¶ã€‚\nCGIåº”ç”¨ç¨‹åºæ˜¯ç‹¬ç«‹äºæœåŠ¡å™¨çš„ï¼Œå› æ­¤å‡ ä¹å¯ä»¥é‡‡ç”¨ä»»æ„è¯­è¨€å®ç°ã€‚CGIçš„å¤„ç†å¯¹ç”¨æˆ·æ˜¯ä¸å¯è§çš„ã€‚å®¢æˆ·ç«¯å®Œå…¨ä¸çŸ¥é“æœåŠ¡å™¨å’ŒCGIåº”ç”¨ç¨‹åºä¹‹é—´çš„è½¬æ¥è¿‡ç¨‹ï¼ŒURLä¸­å‡ºç°å­—æ¯cgiæˆ–å¯èƒ½çš„?æ˜¯å®¢æˆ·ç«¯å‘ç°ä½¿ç”¨äº†CGIåº”ç”¨ç¨‹åºçš„å”¯ä¸€çº¿ç´¢ã€‚\nCGIåœ¨æœåŠ¡å™¨å’Œä¼—å¤šèµ„æºç±»å‹ä¹‹é—´æä¾›äº†ä¸€ä¸ªç®€å•çš„å¯¹æ¥æ–¹å¼ï¼Œå¯ä»¥å¤„ç†å„ç§éœ€è¦çš„è½¬æ¢ã€‚æ­¤å¤–ï¼Œä»–è¿˜èƒ½å¾ˆå¥½åœ°ä¿æŠ¤æœåŠ¡å™¨ï¼Œé˜²æ­¢ä¸€äº›æ‰©å±•ç ´åæœåŠ¡å™¨ã€‚ä½†æ˜¯è¿™ç§åˆ†ç¦»ä¼šé€ æˆæ€§èƒ½çš„æŸå¤±ï¼Œå› ä¸ºä¸ºæ¯ä¸ªCGIè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹è¿™ä¸€åšæ³•çš„ä»£ä»·æ˜¯éå¸¸æ˜‚è´µçš„ã€‚\næœåŠ¡å™¨æ‰©å±•API å¤§å¤šæ•°æµè¡Œçš„æœåŠ¡å™¨éƒ½ä¼šä¸ºå¼€å‘è€…æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªæ‰©å±•APIï¼Œè¿™äº›æ‰©å±•é€šå¸¸ä¸æœåŠ¡å™¨è‡ªèº«çš„æ¶æ„æœ‰å…³ç³»ï¼Œå¼€å‘è€…å¼€ä¸€é€šè¿‡è¿™äº›æ¥å£æ”¹å˜æœåŠ¡å™¨çš„è¡Œä¸ºæˆ–å®šåˆ¶å®ç°æŸäº›éœ€æ±‚ã€‚\néš§é“ éš§é“ï¼ˆtunnelï¼‰ æ˜¯ä¸€ç§HTTPåº”ç”¨ç¨‹åºï¼Œå½“éš§é“å»ºç«‹åï¼Œå®ƒå°±ä¼šåœ¨ä¸¤æ¡è¿æ¥ä¹‹é—´å¯¹åŸå§‹æ•°æ®è¿›è¡Œç›²è½¬å‘ã€‚HTTPéš§é“ä¸ä¼šçª¥æ¢æ•°æ®ï¼Œå®ƒé€šå¸¸ç”¨æ¥åœ¨HTTPè¿æ¥ä¸Šä¼ è¾“éHTTPæ•°æ®ã€‚åˆ©ç”¨HTTPéš§é“ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡HTTPåº”ç”¨ç¨‹åºè®¿é—®ä½¿ç”¨éHTTPåè®®çš„åº”ç”¨ç¨‹åºã€‚\néš§é“çš„å»ºç«‹ Webéš§é“æ˜¯ç”¨HTTPçš„CONNECTæ–¹æ³•å»ºç«‹èµ·æ¥çš„ã€‚CONNECTæ–¹æ³•è¯·æ±‚éš§é“ç½‘å…³åˆ›å»ºä¸€æ¡é€šå‘ä»»æ„ç›®æ ‡æœåŠ¡å™¨å’Œç«¯å£çš„TCPè¿æ¥ï¼Œå¹¶å¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åç»­æ•°æ®è¿›è¡Œç›²è½¬å‘ã€‚\nä¸Šå›¾æ˜¾ç¤ºäº†ä½¿ç”¨CONNECTæ–¹æ³•å»ºç«‹ä¸€æ¡åˆ°ç½‘å…³çš„éš§é“çš„è¿‡ç¨‹ï¼š\n å®¢æˆ·ç«¯å‘é€ä¸€æ¡CONNECTè¯·æ±‚ç»™éš§é“ç½‘å…³ï¼ˆå›¾aï¼‰ï¼Œè¯·æ±‚éš§é“æ‰“å¼€ä¸€æ¡TCPè¿æ¥ï¼ˆè¿™é‡Œæ‰“å¼€çš„æ˜¯ä¸€æ¡æ ‡å‡†SSLè¿æ¥ï¼‰ã€‚ å»ºç«‹ç½‘å…³ä¸æœåŠ¡å™¨ä¹‹é—´çš„TCPè¿æ¥ï¼ˆå›¾bå’Œå›¾cï¼‰ã€‚ ä¸€æ—¦TCPè¿æ¥å»ºç«‹æˆåŠŸï¼Œç½‘å…³å°±ä¼šå‘é€ä¸€æ¡HTTP 200 Connection Establishedå“åº”ç»™å®¢æˆ·ç«¯ï¼ˆå›¾dï¼‰ã€‚ éš§é“å»ºç«‹å®Œæˆï¼ˆå›¾eï¼‰ã€‚å®¢æˆ·ç«¯é€šè¿‡HTTPéš§é“å‘é€çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«ç›´æ¥è½¬å‘ç»™è¾“å‡ºTCPè¿æ¥ï¼ŒæœåŠ¡å™¨å‘é€çš„æ‰€æœ‰æ•°æ®ä¹Ÿä¼šé€šè¿‡HTTPéš§é“è½¬å‘ç»™å®¢æˆ·ç«¯ã€‚  ä¸­ç»§ HTTPä¸­ç»§ï¼ˆrelayï¼‰ æ˜¯ä¸€ä¸ªç®€å•çš„HTTPä»£ç†ï¼Œå®ƒæ²¡æœ‰å®Œå…¨éµå¾ªHTTPè§„èŒƒã€‚ä¸­ç»§åšçš„äº‹æƒ…å¾ˆç®€å•ï¼šå»ºç«‹è¿æ¥ï¼Œç„¶åå¯¹å­—èŠ‚è¿›è¡Œç›²è½¬å‘ã€‚\nå‚è€ƒèµ„æ–™  David Gourley, Brian Totty. HTTP: The Definitive Guide. O\u0026rsquo;Reilly Media, 2002.  ","href":"/computer_networks/http/gateway_tunnels_and_relays/","title":"ç½‘å…³ã€éš§é“å’Œä¸­ç»§"},{"content":"HTTPè¿æ¥æ˜¯HTTPæŠ¥æ–‡ä¼ è¾“çš„å…³é”®é€šé“ã€‚\nTCPè¿æ¥ TCP/IPæ˜¯å…¨çƒè®¡ç®—æœºåŠç½‘ç»œè®¾å¤‡éƒ½åœ¨ä½¿ç”¨çš„ä¸€ä¸ªåˆ†å±‚åŒ…äº¤æ¢åè®®é›†ï¼Œå‡ ä¹æ‰€æœ‰çš„HTTPé€šä¿¡éƒ½æ˜¯ç”±TCP/IPæ‰¿è½½çš„ã€‚TCPè¿æ¥æ—¶å¯é çš„ï¼Œå®ƒä¸ºHTTPæä¾›äº†ä¸€æ¡å¯é çš„æ¯”ç‰¹ä¼ è¾“ç®¡é“ï¼Œä»TCPè¿æ¥ä¸€ç«¯ä¼ å…¥çš„å­—èŠ‚ä¼šåœ¨å¦ä¸€ç«¯ä»¥åŸæœ‰çš„é¡ºåºè¢«æ­£ç¡®åœ°ä¼ é€å‡ºæ¥ã€‚\nTCPä¼šå°†æ•°æ®åˆ‡åˆ†ä¸ºå°çš„æ•°æ®å—å‘é€ï¼Œè¿™äº›å°çš„æ•°æ®å—å°±æ˜¯IPæ•°æ®åŒ…ï¼ˆIP packetsï¼‰æˆ–IPæ•°æ®æŠ¥ï¼ˆIP datagramsï¼‰ã€‚è¿™ä¸ªæ—¶å€™ï¼ŒHTTPå°±ä½äºHTTP over TCP over IPè¿™ä¸ªåè®®æ ˆçš„æœ€é¡¶å±‚ï¼Œå…¶å®‰å…¨ç‰ˆæœ¬HTTPSåªæ˜¯åœ¨HTTPå’ŒTCPä¹‹é—´æ’å…¥äº†ä¸€ä¸ªåŠ å¯†å±‚ï¼ˆç§°ä¸ºTLSæˆ–SSLï¼‰ï¼š\nHTTPåœ¨ä¼ é€ä¸€æ¡æŠ¥æ–‡æ—¶ï¼Œä¼šä»¥æµçš„å½¢å¼å°†æŠ¥æ–‡å†…å®¹é€šè¿‡ä¸€æ¡æ‰“å¼€çš„TCPè¿æ¥æŒ‰åºä¼ è¾“ã€‚TCPåœ¨æ”¶åˆ°æ•°æ®æµä¹‹åï¼Œä¼šå…ˆå°†æ•°æ®æµåˆ†å‰²æˆå°æ•°æ®å—ï¼ˆè¿™äº›æ•°æ®å—è¢«ç§°ä¸ºæ®µï¼ˆsegmentsï¼‰ï¼‰ï¼Œç„¶åå°†æ®µå°è£…åœ¨IPæ•°æ®åŒ…ä¸­ï¼Œé€šè¿‡Internetè¿›è¡Œä¼ è¾“ã€‚æ‰€æœ‰çš„è¿™äº›å·¥ä½œéƒ½æ˜¯ç”±TCP/IPè½¯ä»¶æ¥å¤„ç†çš„ï¼Œæ¯ä¸ªTCPæ®µéƒ½ç”±IPæ•°æ®æŠ¥æ‰¿è½½ï¼Œä»ä¸€ä¸ªIPåœ°å€å‘é€åˆ°å¦ä¸€ä¸ªIPåœ°å€ã€‚æ¯ä¸ªIPæ•°æ®åŒ…ä¸­éƒ½åŒ…æ‹¬ï¼š\n ä¸€ä¸ªIPæ•°æ®æŠ¥é¦–éƒ¨ï¼ˆé€šå¸¸ä¸º20å­—èŠ‚ï¼‰ã€‚ ä¸€ä¸ªTCPæ®µé¦–éƒ¨ï¼ˆé€šå¸¸ä¸º20å­—èŠ‚ï¼‰ã€‚ ä¸€ä¸ªTCPæ•°æ®å—ï¼ˆ0æˆ–å¤šä¸ªå­—èŠ‚ï¼‰ã€‚  TCPé€šè¿‡ç«¯å£å·æ¥ä¿æŒå½“å‰æ‰“å¼€çš„TCPè¿æ¥çš„æ­£ç¡®è¿è¡Œã€‚IPåœ°å€å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°æ­£ç¡®çš„ä¸»æœºï¼Œè€Œç«¯å£å·å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°è¯¥ä¸»æœºä¸Šæ­£ç¡®çš„åº”ç”¨ç¨‹åºã€‚ä¸€æ¡TCPè¿æ¥ç”±\u0026lt;source-IP-address, source-port, destination-IP-address, destination-port\u0026gt;å››ä¸ªå€¼å”¯ä¸€æ ‡è¯†ã€‚\nHTTPè¿æ¥å¤„ç† HTTPå…è®¸å®¢æˆ·ç«¯å’Œæœ€ç»ˆçš„æºç«¯æœåŠ¡å™¨ä¸­é—´å­˜åœ¨ä¸€ä¸ªä¸­é—´å®ä½“ï¼ˆintermediaryï¼‰ï¼ˆä»£ç†ã€ç¼“å­˜ç­‰ï¼‰é“¾ã€‚HTTPæŠ¥æ–‡ä»å®¢æˆ·ç«¯å¼€å§‹åœ¨ä¸­é—´è®¾å¤‡é—´é€è·³è½¬å‘ï¼Œæœ€ç»ˆåˆ°è¾¾æºç«¯æœåŠ¡å™¨ã€‚æˆ–è€…ä»æºç«¯æœåŠ¡å™¨å‡ºå‘ï¼Œç»è¿‡ä¸­é—´è®¾å¤‡é—´çš„é€è·³è½¬å‘ï¼Œæœ€ç»ˆè¾¾åˆ°å®¢æˆ·ç«¯ã€‚\nConnection Header HTTPçš„Connectioné¦–éƒ¨æ˜¯ä¸€ä¸ªé€šç”¨é¦–éƒ¨ï¼Œå®ƒå…è®¸å‘é€æ–¹æˆ–å®¢æˆ·ç«¯å£°æ˜ä¸€äº›åªç”¨äºæŸä¸ªç‰¹å®šè¿æ¥çš„é€‰é¡¹ï¼Œå¹¶ä¸”è¿™äº›é€‰é¡¹ä¸ä¼šï¼ˆä¹Ÿä¸èƒ½ï¼‰è¢«å…¶å®ƒçš„è¿æ¥ä½¿ç”¨ã€‚è¿™äº›é€‰é¡¹å°±æ˜¯Connectioné¦–éƒ¨å­—æ®µä¸­çš„ä¸€ä¸ªç”±é€—å·åˆ†éš”çš„è¿æ¥æ ‡ç­¾åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼šå¯ä»¥ç”¨Connection: closeæ¥è¡¨é¢å‘é€æ–¹å¸Œæœ›åœ¨å“åº”æŠ¥æ–‡å‘é€ä¹‹åå…³é—­è¿æ¥ã€‚\nConnectioné¦–éƒ¨å¯ä»¥æ‰¿è½½3ä¸­ä¸åŒç±»å‹çš„æ ‡ç­¾ï¼š\n HTTPé¦–éƒ¨å­—æ®µåï¼šåˆ—å‡ºåªä¸æ­¤è¿æ¥æœ‰å…³çš„é¦–éƒ¨ã€‚ å€¼closeï¼šè¯´æ˜å½“å‰çš„request/responseæ“ä½œå®Œæˆä¹‹åå°±å…³é—­è¿™æ¡è¿æ¥ã€‚è¿™æ˜¯HTTP/1.0ä¸­çš„é»˜è®¤å€¼ã€‚ ä»»æ„æ ‡ç­¾å€¼ï¼šæè¿°æ­¤è¿æ¥çš„éæ ‡å‡†é€‰é¡¹ã€‚  å¦‚æœè¿æ¥æ ‡ç­¾åˆ—è¡¨ä¸­åŒ…å«äº†ä¸€äº›HTTPé¦–éƒ¨å­—æ®µçš„åç§°ï¼Œé‚£ä¹ˆè¿™äº›é¦–éƒ¨å­—æ®µå°±åŒ…å«äº†ä¸€äº›ä¸è¿æ¥æœ‰å…³çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ˜¯ä¸èƒ½è¢«è½¬å‘å‡ºå»çš„ã€‚åœ¨å°†HTTPæŠ¥æ–‡è¢«è½¬å‘å‡ºå»ä¹‹å‰ï¼Œä»£ç†å¿…é¡»åˆ é™¤Connectioné¦–éƒ¨ä¸­åˆ—å‡ºçš„æ‰€æœ‰HTTPé¦–éƒ¨å­—æ®µã€‚Connectioné¦–éƒ¨æ˜¯ä¸€ä¸ªé€è·³é¦–éƒ¨ï¼Œåªé€‚ç”¨äºå•å„é“¾è·¯å¹¶ä¸”ä¸åº”è¯¥è¢«é¡ºç€é“¾è·¯å‘ä¸‹ä¼ è¾“ã€‚\nä¸²è¡Œäº‹åŠ¡å¤„ç†ä¸çŸ­è¿æ¥ HTTPæœ€æ—©æœŸçš„æ¨¡å‹æ˜¯çŸ­è¿æ¥ï¼ˆShort-lived connectionsï¼‰ã€‚æ¯ä¸€ä¸ªHTTPè¯·æ±‚éƒ½ç”±å®ƒè‡ªå·±ç‹¬ç«‹çš„è¿æ¥å®Œæˆï¼Œè¿™æ„å‘³ç€æ¯å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚ä¹‹å‰éƒ½ä¼šè¿›è¡Œä¸€æ¬¡TCPæ¡æ‰‹ã€‚è¿™äº›è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼šæ¯å‘èµ·ä¸€ä¸ªè¯·æ±‚æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œå¹¶åœ¨æ”¶åˆ°å“åº”æ—¶ç«‹å³å…³é—­ã€‚\nTCPåè®®æ¡æ‰‹æœ¬èº«å°±æ˜¯å¾ˆè€—æ—¶çš„ï¼Œæ‰€ä»¥TCPå¯ä»¥é€šè¿‡ä¿æŒæ›´å¤šçš„çƒ­è¿æ¥æ¥é€‚åº”è´Ÿè½½ã€‚è€ŒçŸ­è¿æ¥ç ´åäº†TCPå…·å¤‡çš„èƒ½åŠ›ï¼Œå› ä¸ºæ–°çš„å†·è¿æ¥é™ä½äº†å…¶æ€§èƒ½ã€‚å¦‚æœæ¯ä¸ªäº‹åŠ¡éƒ½éœ€è¦ï¼ˆä¸²è¡Œåœ°å»ºç«‹ï¼‰ä¸€æ¡æ–°çš„è¿æ¥ï¼Œé‚£ä¹ˆTCPçš„è¿æ¥æ—¶å»¶å’Œæ…¢å¯åŠ¨æ—¶å»¶å°±ä¼šå åŠ èµ·æ¥ã€‚\nçŸ­è¿æ¥æ˜¯HTTP/1.0çš„é»˜è®¤æ¨¡å‹ï¼ˆå¦‚æœæ²¡æœ‰æŒ‡å®šConnectionå¤´ï¼Œæˆ–å®ƒçš„å€¼è¢«è®¾ç½®ä¸ºcloseï¼‰ã€‚è€Œåœ¨HTTP/1.1ä¸­ï¼Œåªæœ‰å½“Connectionè¢«è®¾ä¸ºä¸ºcloseæ—¶æ‰ä¼šç”¨åˆ°çŸ­è¿æ¥æ¨¡å‹ã€‚\nçŸ­è¿æ¥å¯¹TCPæ€§èƒ½æœ‰å…ˆå¤©çš„é™åˆ¶ï¼šæ¯æ‰“å¼€ä¸€ä¸ªTCPè¿æ¥éƒ½æ˜¯ç›¸å½“è€—è´¹èµ„æºçš„æ“ä½œã€‚ä¸ºäº†è§£å†³çŸ­è¿æ¥æ¨¡å‹çš„ä½æ•ˆç‡é—®é¢˜ï¼Œå‡ºç°äº†å‡ ç§æ–°çš„æ¨¡å‹ï¼š\n å¹¶è¡Œè¿æ¥ï¼ˆParallel connectionsï¼‰ï¼šé€šè¿‡å¤šæ¡TCPè¿æ¥å‘èµ·å¹¶å‘çš„HTTPè¯·æ±‚ã€‚ æŒä¹…è¿æ¥ï¼ˆPersistent connectionsï¼‰ï¼šé‡ç”¨TCPè¿æ¥ï¼Œä»¥æ¶ˆé™¤æ‰“å¼€åŠå…³é—­TCPè¿æ¥æ—¶çš„æ—¶å»¶ã€‚ ç®¡é“åŒ–è¿æ¥ï¼ˆPipelined connectionsï¼‰ï¼šé€šè¿‡å…±äº«çš„TCPè¿æ¥å‘èµ·å¹¶å‘çš„HTTPè¯·æ±‚ã€‚ å¤ç”¨è¿æ¥ï¼ˆMultiplexed connectionsï¼‰ï¼šäº¤æ›¿ä¼ é€è¯·æ±‚å’Œå“åº”æŠ¥æ–‡ã€‚  å¹¶è¡Œè¿æ¥ HTTPå…è®¸å®¢æˆ·ç«¯æ‰“å¼€å¤šæ¡è¿æ¥ï¼Œå¹¶è¡Œåœ°æ‰§è¡Œå¤šä¸ªHTTPäº‹åŠ¡ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰è‡ªå·±çš„TCPè¿æ¥ã€‚\nä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªç½‘é¡µé‡Œé¢åŒ…å«å¤šä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œå¦‚æœå¹¶è¡Œè¿æ¥èƒ½å¤Ÿå…‹æœå•æ¡è¿æ¥çš„ç©ºè½½æ—¶é—´å’Œå®½å¸¦é™åˆ¶ï¼Œç½‘é¡µçš„åŠ è½½é€Ÿåº¦å°±ä¼šæœ‰æ‰€æé«˜ã€‚æ—¶å»¶å¯ä»¥é‡å èµ·æ¥ï¼Œå¦‚æœå•æ¡è¿æ¥æ²¡æœ‰å……åˆ†åˆ©ç”¨å¸¦å®½ï¼Œç©ºé—²çš„å¸¦å®½å¯ä»¥ç”¨æ¥åŠ è½½å…¶å®ƒç»„ä»¶ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¹¶è¡Œè¿æ¥å¯èƒ½ä¼šæ›´å¿«ï¼Œä½†ä¸ä¸€å®šæ€»æ˜¯æ›´å¿«ã€‚å½“ä¸€ä¸ªè¾ƒæ…¢çš„å®¢æˆ·ç«¯è¿æ¥åˆ°è¾ƒå¿«çš„æœåŠ¡å™¨ä¸Šæ—¶ï¼Œæ…¢å®¢æˆ·ç«¯çš„å¸¦å®½å¯èƒ½å¾ˆå¿«è¢«è€—å°½ï¼Œæ¥ç€å°±æ˜¯å¸¦å®½èµ„æºçš„ç«äº‰ï¼Œè¿™å¯èƒ½å¹¶ä¸ä¼šå¸¦æ¥æ€§èƒ½çš„æå‡ã€‚å› ä¸ºï¼Œæ‰“å¼€å¤§é‡è¿æ¥ä¼šæ¶ˆè€—å¾ˆå¤šçš„å†…å­˜èµ„æºï¼Œä»è€Œå¼•å‘è‡ªèº«çš„æ€§èƒ½é—®é¢˜ã€‚\nå¾ˆå¤šæµè§ˆå™¨éƒ½ä½¿ç”¨äº†å¹¶è¡Œè¿æ¥ï¼Œä½†å®ƒä»¬ä¸€èˆ¬éƒ½ä¼šå°†å¹¶è¡Œè¿æ¥çš„æ€»æ•°é™åˆ¶åœ¨ä¸€ä¸ªè¾ƒå°çš„å€¼ï¼Œè€ŒæœåŠ¡å™¨å¯ä»¥éšæ„å…³é—­æ¥è‡ªç‰¹å®šå®¢æˆ·ç«¯çš„è¿‡é‡è¿æ¥ã€‚\næŒä¹…è¿æ¥ Webå®¢æˆ·ç«¯ç»å¸¸ä¼šæ‰“å¼€åˆ°åŒä¸€ä¸ªç«™ç‚¹çš„è¿æ¥ï¼Œå¹¶ä¸”å¯èƒ½ä¼šåœ¨å°†æ¥çš„ä¸€æ®µæ—¶é—´å†…å¯¹è¯¥ç«™ç‚¹å‘èµ·æ›´å¤šçš„è¯·æ±‚ï¼Œè¿™ç§æ€§è´¨å°±æ˜¯ç«™ç‚¹çš„å±€éƒ¨æ€§ï¼ˆsite localityï¼‰ã€‚\nå› æ­¤ï¼ŒHTTP/1.1ï¼ˆä»¥åŠHTTP/1.0çš„å„ç§å¢å¼ºç‰ˆæœ¬ï¼‰å…è®¸HTTPè®¾å¤‡åœ¨äº‹åŠ¡å¤„ç†ç»“æŸä¹‹åä¿æŒTCPè¿æ¥çš„æ‰“å¼€çŠ¶æ€ï¼Œä»¥ä¾¿å°†æ¥çš„HTTPè¯·æ±‚å¯ä»¥é‡ç”¨ç°æœ‰çš„è¿æ¥ã€‚åœ¨äº‹åŠ¡ç»“æŸä¹‹åä»ç„¶ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€çš„TCPè¿æ¥è¢«ç§°ä¸ºæŒä¹…è¿æ¥ï¼ˆpersistent connectionsï¼‰ã€‚éæŒä¹…è¿æ¥ä¼šåœ¨æ¯ä¸ªäº‹åŠ¡ç»“æŸä¹‹åå…³é—­ï¼Œè€ŒæŒä¹…è¿æ¥ä¼šåœ¨ä¸åŒäº‹åŠ¡ä¹‹é—´ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œç›´åˆ°å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å†³å®šå°†å…¶å…³é—­ä½ç½®ã€‚\né‡ç”¨å·²ç»å¯¹ç›®æ ‡æœåŠ¡å™¨æ‰“å¼€çš„ç©ºé—²æŒä¹…è¿æ¥ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥é¿å¼€å»ºç«‹è¿æ¥é˜¶æ®µçš„é«˜æ˜‚å¼€é”€ã€‚æ­¤å¤–ï¼Œå·²ç»æ‰“å¼€çš„è¿æ¥å¯ä»¥é¿å…æ…¢å¯åŠ¨çš„æ‹¥å¡é€‚åº”é˜¶æ®µï¼Œä»¥ä¾¿æ›´å¿«é€Ÿåœ°è¿›è¡Œæ•°æ®çš„ä¼ è¾“ã€‚\næŒä¹…è¿æ¥æœ‰ä¸¤ç§ç±»å‹ï¼š\n æ¯”è¾ƒè€çš„HTTP/1.0+ä¸­çš„keep-aliveè¿æ¥ã€‚ HTTP/1.1ä¸­çš„persistentè¿æ¥ã€‚  å¹¶è¡Œè¿æ¥ vs æŒä¹…è¿æ¥ å¹¶è¡Œè¿æ¥è™½ç„¶å¯èƒ½æ¯”è¾ƒå¿«ï¼Œä½†å¹¶è¡Œè¿æ¥ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼š\n æ¯ä¸ªäº‹åŠ¡éƒ½ä¼šæ‰“å¼€/å…³é—­ä¸€æ¡æ–°çš„è¿æ¥ï¼Œè¿™ä¼šè€—è´¹æ—¶é—´å’Œå¸¦å®½ã€‚ ç”±äºTCPçš„æ…¢å¯åŠ¨ç‰¹æ€§ï¼Œæ¯æ¡æ–°è¿æ¥çš„å®é™…æ€§èƒ½ä¼šæœ‰æ‰€é™ä½ã€‚ å¯æ‰“å¼€çš„å¹¶è¡Œè¿æ¥çš„æœ€å¤§æ•°é‡å®é™…ä¸Šæ˜¯æœ‰é™çš„ã€‚  æŒä¹…è¿æ¥æœ‰ä¸€äº›æ¯”å¹¶è¡Œè¿æ¥æ›´å¥½çš„åœ°æ–¹ã€‚æŒä¹…è¿æ¥å¯ä»¥æœ‰æ•ˆçš„é™ä½æ—¶å»¶å’Œå»ºç«‹è¿æ¥çš„å¼€é”€ï¼Œè¿˜å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ§åˆ¶æ‰“å¼€è¿æ¥çš„æ•°é‡ã€‚ä½†æ˜¯ï¼Œä¸€ç›´æ‰“å¼€çš„å¤§é‡ç©ºé—²è¿æ¥ä¼šå¸¦æ¥æ–°çš„é—®é¢˜ï¼Œå®ƒä»¬ä¼šæ¶ˆè€—å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„èµ„æºã€‚å› æ­¤ï¼Œç®¡ç†æŒä¹…è¿æ¥æ—¶è¦ç‰¹åˆ«ä»”ç»†ã€‚\nHTTP/1.0+ä¸­çš„Keep-Aliveè¿æ¥ å’ŒçŸ­è¿æ¥ç›¸æ¯”ï¼ŒæŒä¹…è¿æ¥èŠ‚çœäº†æ‰“å¼€/å…³é—­è¿æ¥å’ŒTCPæ…¢å¯åŠ¨é˜¶æ®µçš„å¼€é”€ã€‚\nåœ¨å½“å‰çš„HTTP/1.1è§„èŒƒä¸­ï¼Œkeep-aliveå·²ç»è¢«å¼ƒç”¨äº†ã€‚ä½†æ˜¯ï¼Œkeep-aliveæ¡æ‰‹æ“ä½œä»ç„¶åœ¨æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´å¹¿æ³›ä½¿ç”¨ã€‚\nå®ç°äº†HTTP/1.0 keep-aliveè¿æ¥çš„å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡åœ¨è¯·æ±‚å¤´é‡Œé¢åŒ…å«Connection: Keep-Aliveæ¥å‘Šè¯‰æœåŠ¡å™¨å®ƒå¸Œæœ›è¿æ¥ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚è‹¥æœåŠ¡å™¨ä¹Ÿæ„¿æ„ä¸ºä¸‹ä¸€æ¡è¯·æ±‚è€Œä¿æŒè¿æ¥çš„æ‰“å¼€çŠ¶æ€ï¼Œå®ƒä¹Ÿä¼šå°†Connection: Keep-Aliveæ”¾å…¥å“åº”å¤´ã€‚å¦‚æœå“åº”æŠ¥æ–‡ä¸­æ²¡æœ‰Connection: Keep-Aliveï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±ä¼šè®¤ä¸ºæœåŠ¡å™¨ä¸æ”¯æŒkeep-aliveå¹¶ä¸”æœåŠ¡å™¨ä¼šåœ¨å‘å›å“åº”æŠ¥æ–‡ä¹‹åå…³é—­è¿æ¥ã€‚\nKeep-Aliveé€‰é¡¹ éœ€è¦æ³¨æ„çš„æ˜¯ï¼škeep-aliveé¦–éƒ¨åªæ˜¯è¯·æ±‚å°†è¿æ¥ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€ï¼Œè€Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸ä¸€å®šä¼šåŒæ„è¿›è¡Œkeep-aliveä¼šè¯ã€‚å®ƒä»¬å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å…³é—­ç©ºé—²çš„keep-aliveè¿æ¥ï¼Œä¹Ÿå¯ä»¥éšæ„é™åˆ¶åœ¨keep-aliveè¿æ¥ä¸Šå¤„ç†çš„äº‹åŠ¡æ•°é‡ã€‚\næˆ‘ä»¬é€šè¿‡è°ƒæ•´Keep-Aliveé€šç”¨é¦–éƒ¨ä¸­çš„ä¸€äº›ç”±é€—å·åˆ†éš”çš„å‚æ•°æ¥æ”¹å˜keep-aliveè¡Œä¸ºï¼š\n timeoutå‚æ•°æ˜¯åœ¨Keep-Aliveå“åº”å¤´ä¸­å‘é€çš„ã€‚å®ƒä»£è¡¨ç€ä¸€ä¸ªæœåŠ¡å™¨å¯èƒ½ä¼šå°†è¿æ¥ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€çš„æ—¶é—´çš„ä¼°è®¡å€¼ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªæ‰¿è¯ºå€¼ã€‚ maxå‚æ•°ä¹Ÿæ˜¯åœ¨Keep-Aliveå“åº”å¤´ä¸­å‘é€çš„ã€‚å®ƒè¡¨ç¤ºæœåŠ¡å™¨è¿˜å¸Œæœ›ä¸ºå¤šå°‘ä¸ªäº‹åŠ¡è€Œå°†è¿æ¥è¡¨ç¤ºåœ¨æ‰“å¼€çŠ¶æ€ï¼Œäº‹åŠ¡çš„æ•°é‡ä¹Ÿæ˜¯ä¸€ä¸ªä¼°è®¡å€¼ï¼Œä¸æ˜¯æ‰¿è¯ºå€¼ã€‚ Keep-Aliveé¦–éƒ¨è¿˜æ”¯æŒä»»æ„æœªç»å¤„ç†çš„å±æ€§ï¼Œè¿™äº›å±æ€§ä¸»è¦ç”¨äºè¯Šæ–­å’Œè°ƒè¯•ï¼Œè¯­æ³•ä¸ºname [=value]ã€‚  Keep-Aliveé¦–éƒ¨æ˜¯å¯é€‰çš„ï¼Œåªæœ‰åœ¨Connection: Keep-Aliveå‡ºç°æ—¶æ‰ä¼šè¢«ä½¿ç”¨ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸¤è¡Œè¡¨ç¤ºæœåŠ¡å™¨æœ€å¤šè¿˜ä¼šä¸ºå¦å¤–5ä¸ªäº‹åŠ¡ä¿æŒè¿æ¥çš„æ‰“å¼€çŠ¶æ€ï¼Œæˆ–è€…å°†è¿æ¥çš„æ‰“å¼€çŠ¶æ€å†ä¿æŒ120ç§’ï¼š\nConnection: Keep-Alive Keep-Alive: max=5, timeout=120 Keep-Aliveè¿æ¥çš„é™åˆ¶ä¸è§„åˆ™ ä½¿ç”¨keep-aliveè¿æ¥æ—¶æœ‰ä¸€äº›é™åˆ¶å’Œéœ€è¦ç‰¹åˆ«è¯´æ˜çš„åœ°æ–¹ï¼š\n åœ¨HTTP/1.0ä¸­ï¼Œkeep-aliveä¸æ˜¯é»˜è®¤ä½¿ç”¨çš„ã€‚å®¢æˆ·ç«¯å¿…é¡»å‘é€ä¸€ä¸ªConnection: Keep-Aliveè¯·æ±‚å¤´æ¥æ¿€æ´»keep-aliveè¿æ¥ã€‚ Connection: Keep-Aliveé¦–éƒ¨å¿…é¡»éšæ‰€æœ‰å¸Œæœ›ä¿æŒæŒä¹…è¿æ¥çš„æŠ¥æ–‡ä¸€èµ·å‘é€ã€‚å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰å‘é€å®ƒï¼ŒæœåŠ¡å™¨ä¼šåœ¨å®Œæˆè¯¥è¯·æ±‚ä¹‹åå…³é—­è¿æ¥ã€‚ å®¢æˆ·ç«¯å¯ä»¥æ ¹æ®å“åº”æŠ¥æ–‡ä¸­æ˜¯å¦æœ‰Connection: Keep-Aliveé¦–éƒ¨æ¥åˆ¤æ–­æœåŠ¡å™¨æ˜¯å¦å·²ç»åœ¨å‘å‡ºå“åº”æŠ¥æ–‡ä¹‹åå…³é—­è¿æ¥ã€‚ åªæœ‰åœ¨æ— éœ€æ£€æµ‹è¿æ¥å…³é—­å°±èƒ½ç¡®å®šæŠ¥æ–‡çš„å®ä½“ä¸»ä½“çš„é•¿åº¦æ—¶ï¼Œè¿æ¥æ‰èƒ½è¢«ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€ã€‚ ä»£ç†å’Œç½‘å…³å¿…é¡»æ‰§è¡ŒConnectioné¦–éƒ¨ä¸Šçš„è§„åˆ™ã€‚ä»£ç†å’Œç½‘å…³å¿…é¡»åœ¨è½¬å‘æˆ–ç¼“å­˜æŠ¥æ–‡ä¹‹å‰ç§»é™¤Connectioné¦–éƒ¨ä¸­å‡ºç°çš„é¦–éƒ¨å­—æ®µåŠConnectioné¦–éƒ¨æœ¬èº«ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œä¸åº”è¯¥åœ¨ä»£ç†æœåŠ¡å™¨æ— æ³•ä¿è¯æ”¯æŒConnectioné¦–éƒ¨çš„æƒ…å†µä¸‹å»ºç«‹keep-aliveè¿æ¥ï¼Œè¿™ä¹ˆåšæ˜¯ä¸ºäº†é¿å…**å“‘ä»£ç†ï¼ˆdumb proxiesï¼‰**é—®é¢˜çš„å‡ºç°ã€‚ ä»æŠ€æœ¯ä¸Šè¯´ï¼Œåº”è¯¥å¿½ç•¥æ‰€æœ‰æ¥è‡ªHTTP/1.0è®¾å¤‡çš„Connectioné¦–éƒ¨å­—æ®µï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½æ˜¯ç”±æ¯”è¾ƒè€çš„ä»£ç†æœåŠ¡å™¨è¯¯è½¬å‘çš„ã€‚ é™¤éé‡å¤çš„è¯·æ±‚ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œå®¢æˆ·ç«¯å¿…é¡»å‡†å¤‡å¥½åœ¨æ¥æ”¶åˆ°å“åº”ä¹‹å‰è¿æ¥å°±å…³é—­æ—¶é‡å‘è¯·æ±‚ã€‚  HTTP/1.0æŒä¹…è¿æ¥ HTTP/1.0é€æ¸åœæ­¢äº†å¯¹keep-aliveè¿æ¥çš„æ”¯æŒï¼Œå¹¶ç”¨ä¸€ç§åä¸º**æŒä¹…è¿æ¥ï¼ˆpersistent connectionï¼‰**çš„è®¾è®¡å–ä»£äº†å®ƒã€‚\nä¸HTTP/1.0+çš„keep-aliveè¿æ¥ä¸åŒï¼ŒHTTP/1.1çš„æŒä¹…è¿æ¥åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯æ¿€æ´»çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé™¤éç‰¹åˆ«æŒ‡æ˜ï¼Œå¦åˆ™HTTP/1.1ä¼šå‡å®šæ‰€æœ‰çš„è¿æ¥éƒ½æ˜¯æŒä¹…çš„ã€‚è‹¥è¦åœ¨äº‹åŠ¡å¤„ç†ç»“æŸä¹‹åå…³é—­è¿æ¥ï¼ŒHTTP/1.1åº”ç”¨ç¨‹åºå¿…é¡»åœ¨æŠ¥æ–‡ä¸­æ˜¾å¼åœ°æ·»åŠ ä¸€ä¸ªConnection: closeé¦–éƒ¨ã€‚ä½†æ˜¯ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ˜¯å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å…³é—­ç©ºé—²è¿æ¥çš„ï¼Œæ‰€ä»¥ä¸å‘é€Connection: closeå¹¶ä¸æ„å‘³ç€æœåŠ¡å™¨ä¼šæ°¸è¿œå°†è¿æ¥ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€ã€‚\næŒä¹…è¿æ¥çš„é™åˆ¶ä¸è§„åˆ™ åœ¨ä½¿ç”¨æŒä¹…è¿æ¥æ—¶ï¼Œæœ‰ä¸€äº›ç‚¹éœ€è¦æ³¨æ„ï¼š\n åœ¨å‘é€Connection: closeè¯·æ±‚å¤´ä¹‹åï¼Œå®¢æˆ·ç«¯å°±ä¸èƒ½åœ¨è¯¥è¿æ¥ä¸Šå‘é€å…¶å®ƒçš„è¯·æ±‚äº†ã€‚ å¦‚æœå®¢æˆ·ç«¯ä¸æƒ³åœ¨æŸæ¡è¿æ¥ä¸Šå‘é€å¦ä¸€ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥åœ¨å½“å‰çš„æœ€åä¸€ä¸ªè¯·æ±‚ä¸­å‘é€Connection: closeé¦–éƒ¨ã€‚ åªæœ‰å½“è¿æ¥ä¸Šçš„æ‰€æœ‰æŠ¥æ–‡éƒ½æ˜¯æ­£ç¡®çš„è‡ªå®šä¹‰çš„æ¶ˆæ¯é•¿åº¦ï¼Œè¿æ¥æ‰èƒ½è¢«ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€ã€‚ HTTP/1.1ä»£ç†å¿…é¡»èƒ½å¤ŸåŒºåˆ†å…³ç³»å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„æŒä¹…è¿æ¥ï¼Œæ¯æ¡æŒä¹…è¿æ¥éƒ½åªé€‚ç”¨äºå•è·³ä¼ è¾“ã€‚ HTTP/1.1æœåŠ¡å™¨ä¸åº”è¯¥ä¸HTTP/1.0å®¢æˆ·ç«¯å»ºç«‹æŒä¹…è¿æ¥ã€‚ ä¸ç®¡Connectioné¦–éƒ¨å†…å®¹å¦‚ä½•ï¼ŒHTTP/1.1è®¾å¤‡éƒ½å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å…³é—­è¿æ¥ã€‚ é™¤éé‡å¤å‘èµ·è¯·æ±‚ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œå¦åˆ™å¦‚æœå®¢æˆ·ç«¯åœ¨æ”¶åˆ°æ•´ä¸ªå“åº”ä¹‹å‰è¿æ¥å°±å…³é—­äº†ï¼Œå®¢æˆ·ç«¯å¿…é¡»é‡æ–°å‘èµ·è¯·æ±‚ã€‚ ä¸€ä¸ªç”¨æˆ·å®¢æˆ·ç«¯å¯¹ä»»ä½•æœåŠ¡å™¨æˆ–ä»£ç†æœ€å¤šåªèƒ½ç»´æŒä¸¤æ¡æŒä¹…è¿æ¥ï¼Œä»¥é˜²æ­¢æœåŠ¡å™¨è¿‡è½½ã€‚  ç®¡é“åŒ–è¿æ¥ HTTP/1.1å…è®¸åœ¨æŒä¹…è¿æ¥ä¹‹ä¸Šä½¿ç”¨å¯é€‰çš„ç®¡é“åŒ–è¿æ¥ï¼ˆPipelined connectionsï¼‰ï¼šåœ¨å“åº”åˆ°è¾¾ä¹‹å‰ï¼Œå¯ä»¥å°†å¤šæ¡è¯·æ±‚æ”¾å…¥é˜Ÿåˆ—ï¼Œå½“ç¬¬ä¸€æ¡è¯·æ±‚ç»è¿‡ç½‘ç»œæµå‘æœåŠ¡å™¨æ—¶ï¼Œå…¶å®ƒçš„è¯·æ±‚ä¹Ÿå¯ä»¥å¼€å§‹å‘é€äº†ã€‚åœ¨é«˜å»¶è¿Ÿçš„ç½‘ç»œæ¡ä»¶ä¸‹ï¼Œç®¡é“åŒ–è¿æ¥å¯ä»¥é™ä½ç½‘ç»œçš„ç¯å›æ—¶é—´ï¼Œæé«˜æ€§èƒ½ã€‚\nåœ¨ä½¿ç”¨ç®¡é“åŒ–è¿æ¥æ—¶ï¼Œæœ‰ä¸€äº›åœ°æ–¹éœ€è¦æ³¨æ„ï¼š\n å¦‚æœHTTPå®¢æˆ·ç«¯æ— æ³•ç¡®è®¤è¿æ¥æ˜¯æŒä¹…çš„ï¼Œå®ƒå°±ä¸åº”è¯¥ä½¿ç”¨ç®¡é“ã€‚ æœåŠ¡å™¨å¿…é¡»æŒ‰ç…§ä¸è¯·æ±‚ç›¸åŒçš„é¡ºåºå›é€HTTPå“åº”ã€‚å› ä¸ºHTTPæŠ¥æ–‡ä¸­æ²¡æœ‰åºåˆ—å·æ ‡ç­¾ï¼Œæ‰€ä»¥å“åº”ä¸èƒ½å¤±åºã€‚ HTTPå®¢æˆ·ç«¯å¿…é¡»åšå¥½è¿æ¥å¯èƒ½åœ¨ä»»æ„æ—¶åˆ»å…³é—­çš„å‡†å¤‡ï¼Œå¹¶é‡å‘æ‰€æœ‰æœªå®Œæˆçš„ç®¡é“åŒ–è¯·æ±‚ã€‚ HTTPå®¢æˆ·ç«¯ä¸åº”è¯¥ä½¿ç”¨ç®¡é“åŒ–çš„æ–¹å¼å‘é€ä¼šäº§ç”Ÿå‰¯ä½œç”¨çš„è¯·æ±‚ã€‚  è¿æ¥çš„å…³é—­ å¼‚å¸¸å…³é—­è¿æ¥ æ‰€ä»¥çš„HTTPå®¢æˆ·ç«¯ã€æœåŠ¡å™¨æˆ–ä»£ç†éƒ½å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å…³é—­ä¸€æ¡TCPä¼ è¾“è¿æ¥ï¼ŒHTTPåº”ç”¨ç¨‹åºå¿…é¡»åšå¥½æ­£ç¡®å¤„ç†è¿æ¥éæ­£å¸¸å…³é—­çš„æƒ…å†µã€‚\næ¯æ¡HTTPå“åº”éƒ½åº”è¯¥æœ‰ç²¾ç¡®çš„Content-Lengthé¦–éƒ¨ï¼Œç”¨æ¥æè¿°å“åº”ä¸»ä½“çš„å¤§å°ã€‚ä¸€äº›è€çš„HTTPæœåŠ¡å™¨ä¼šçœç•¥è¿™ä¸ªé¦–éƒ¨ï¼Œè¿™æ ·å°±è¦é€šè¿‡æœåŠ¡å™¨å‘å‡ºçš„è¿æ¥å…³é—­æ¥ç¡®å®šæ•°æ®çš„çœŸå®æœ«å°¾ã€‚\næ­£å¸¸å…³é—­è¿æ¥ TCPè¿æ¥æ˜¯åŒå‘çš„ã€‚TCPè¿æ¥çš„æ¯ä¸€ç«¯éƒ½æœ‰ä¸€ä¸ªè¾“å…¥é˜Ÿåˆ—å’Œä¸€ä¸ªè¾“å‡ºé˜Ÿåˆ—ï¼Œåˆ†åˆ«ç”¨äºæ•°æ®çš„è¯»å†™ã€‚æ”¾åœ¨ä¸€ç«¯è¾“å‡ºé˜Ÿåˆ—ä¸­çš„æ•°æ®æœ€ç»ˆä¼šå‡ºç°åœ¨å¦ä¸€ç«¯çš„è¾“å…¥é˜Ÿåˆ—ä¸­ã€‚\nå®Œå…¨å…³é—­ä¸åŠå…³é—­ åº”ç”¨ç¨‹åºå¯ä»¥å…³é—­TCPè¾“å…¥ä¸è¾“å‡ºä¿¡é“ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œæˆ–å°†ä¸¤ä¸ªéƒ½å…³é—­ã€‚å¥—æ¥å­—è°ƒç”¨close()ä¼šå°†TCPè¿æ¥çš„è¾“å…¥ä¸è¾“å‡ºä¿¡é“éƒ½å…³é—­ï¼Œè¿™å°±æ˜¯å®Œå…¨å…³é—­ã€‚è€Œå¥—æ¥å­—è°ƒç”¨shutdown()åªä¼šå•ç‹¬å…³é—­è¾“å…¥æˆ–è¾“å‡ºä¿¡é“ï¼Œè¿™å°±æ˜¯åŠå…³é—­ã€‚\nå…³é—­è¿æ¥çš„è¾“å‡ºä¿¡é“æ€»æ˜¯å®‰å…¨çš„ï¼šå¦ä¸€ç«¯çš„å¯¹ç­‰å®ä½“ä¼šåœ¨è¯»å–å®Œç¼“å­˜åŒºä¸­çš„æ‰€æœ‰æ•°æ®ä¹‹åå¾—åˆ°ä¸€ä¸ªæµç»“æŸçš„é€šçŸ¥ï¼Œä»è€ŒçŸ¥é“ä¿¡é“å·²ç»å…³é—­ï¼›é™¤éåº”ç”¨ç¨‹åºçŸ¥é“å¦ä¸€ç«¯ä¸ä¼šå†å‘é€å…¶å®ƒæ•°æ®äº†ï¼Œå…³é—­è¿æ¥çš„è¾“å‡ºä¿¡é“æ˜¯æ¯”è¾ƒå±é™©çš„ï¼šå¦ä¸€ç«¯çš„å¯¹ç­‰å®ä½“å‘å·²å…³é—­çš„è¾“å…¥ä¿¡é“å‘é€æ•°æ®æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå›é€ä¸€æ¡\u0026quot;connection reset by peer\u0026quot;çš„æ¶ˆæ¯ã€‚å¤§éƒ¨åˆ†æ“ä½œç³»ç»Ÿéƒ½ä¼šå°†è¿™ç§æƒ…å†µä½œä¸ºä¸¥é‡é”™è¯¯æ¥å¤„ç†ï¼Œå¹¶åˆ é™¤å¯¹ç«¯è¿˜æœªè¯»å–çš„æ‰€æœ‰ç¼“å­˜æ•°æ®ã€‚\nå‚è€ƒèµ„æ–™  David Gourley, Brian Totty. HTTP: The Definitive Guide. O\u0026rsquo;Reilly Media, 2002. HTTP/1.x çš„è¿æ¥ç®¡ç†.  ","href":"/computer_networks/http/connection_management/","title":"HTTPè¿æ¥ç®¡ç†"},{"content":"HTTP æœ€åˆæ˜¯ä¸€ä¸ªåŒ¿åã€æ— çŠ¶æ€çš„è¯·æ±‚/å“åº”åè®®ã€‚æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¤„ç†å¹¶å›é€å“åº”ï¼ŒWeb æœåŠ¡å™¨å‡ ä¹æ²¡æœ‰ä»€ä¹ˆä¿¡æ¯å¯ä»¥ç”¨æ¥åˆ¤æ–­è¯·æ±‚æ¥è‡ªäºå“ªä¸ªç”¨æˆ·ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒWeb æœåŠ¡å™¨å¯èƒ½åŒæ—¶å’Œä¸Šåƒä¸ªå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ã€‚ç°ä»£çš„Webç«™ç‚¹å¸Œæœ›èƒ½å¤Ÿä¸ºä¸åŒç”¨æˆ·æä¾›ä¸ªæ€§åŒ–ä½“éªŒï¼Œå› æ­¤æœåŠ¡å™¨éœ€è¦é€šè¿‡æŸç§æ–¹å¼è¯†åˆ«å‡ºå½“å‰å¯¹è¯çš„ç”¨æˆ·ã€‚å¸¸è§çš„ç”¨æˆ·è¯†åˆ«æœºåˆ¶æœ‰ï¼š\n ä½¿ç”¨æ‰¿è½½æœ‰ç”¨æˆ·èº«ä»½ä¿¡æ¯çš„ HTTP é¦–éƒ¨ã€‚ è¿½è¸ªå®¢æˆ·ç«¯çš„ IP åœ°å€ã€‚ é€šè¿‡ç™»å½•è®¤è¯æ¥è¯†åˆ«ç”¨æˆ·ã€‚ ä½¿ç”¨ Fat URLï¼Œåœ¨ URL ä¸­åµŒå…¥è¯†åˆ«ä¿¡æ¯ã€‚ ä½¿ç”¨ cookie ã€‚  æ‰¿è½½æœ‰ç”¨æˆ·ä¿¡æ¯çš„HTTPé¦–éƒ¨ å¸¸è§çš„ç”¨æ¥æ‰¿è½½ç”¨æˆ·ä¿¡æ¯çš„HTTPé¦–éƒ¨æœ‰ï¼š\n   é¦–éƒ¨åç§° é¦–éƒ¨ç±»å‹ æè¿°     From Request ç”¨æˆ·çš„Emailåœ°å€   User-Agent Request ç”¨æˆ·çš„æµè§ˆå™¨   Referer Request ç”¨æˆ·æ˜¯ä»è¿™ä¸ªé¡µé¢ä¸Šé¢çš„é“¾æ¥è·³è½¬è¿‡æ¥çš„   Authorization Request ç”¨æˆ·åå’Œå¯†ç    Client-ip Extension (Request) å®¢æˆ·ç«¯IPåœ°å€   X-Forward-For Extension (Request) å®¢æˆ·ç«¯IPåœ°å€   Cookie Extension (Request) æœåŠ¡ç«¯ç”Ÿæˆçš„IDæ ‡ç­¾    From é¦–éƒ¨åŒ…å«äº†ç”¨æˆ·çš„ E-mail åœ°å€ï¼Œè¿™åœ¨ç†æƒ³æƒ…å†µä¸‹å¯ä»¥ç”¨æ¥è¯†åˆ«ç”¨æˆ·ã€‚ä½†æŸäº›æœåŠ¡å™¨å¯èƒ½ä¼šæ”¶é›†è¿™äº› E-mail åœ°å€ï¼Œç”¨äºæ•£å‘åƒåœ¾é‚®ä»¶ï¼Œæ‰€ä»¥å¾ˆå°‘æœ‰æµè§ˆå™¨ä¼šå‘é€ From é¦–éƒ¨ã€‚From é¦–éƒ¨ä¸€èˆ¬æ˜¯ç”±å‘æœºå™¨äººæˆ–èœ˜è››è¿™æ ·çš„è‡ªåŠ¨åŒ–ç¨‹åºå‘é€çš„ã€‚\nUser-Agent å¯ä»¥å°†ç”¨æˆ·æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨ã€‚è¿™äº›ä¿¡æ¯åŒ…æ‹¬ç¨‹åºçš„åç§°ã€ç‰ˆæœ¬ï¼Œç”šè‡³æ“ä½œç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯ç­‰ã€‚ä¾‹å¦‚ï¼š\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.89 Safari/537.36 Referer é¦–éƒ¨å¯ä»¥å‘Šè¯‰æœåŠ¡å™¨ç”¨æˆ·æ˜¯ä»å“ªä¸ªé¡µé¢è¿‡æ¥çš„ã€‚æœåŠ¡å™¨å¯ä»¥é€šè¿‡å®ƒæ›´å¥½åœ°ç†è§£ç”¨æˆ·çš„æµè§ˆè¡Œä¸ºã€‚\nFromã€User-Agentã€Referer é¦–éƒ¨å‡ä¸è¶³ä»¥å®ç°å¯é çš„ç”¨æˆ·è¯†åˆ«ã€‚\né€šè¿‡å®¢æˆ·ç«¯IPåœ°å€è¯†åˆ«ç”¨æˆ· æ—©æœŸçš„ Web æœåŠ¡å™¨å°è¯•å°†å®¢æˆ·ç«¯IPåœ°å€ä½œä¸ºä¸€ç§è¯†åˆ«ç”¨æˆ·çš„æ–¹å¼ã€‚å¦‚æœæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸åŒçš„IPåœ°å€ï¼Œå¹¶ä¸”IPåœ°å€å¾ˆå°‘å˜åŒ–çš„è¯ï¼Œè¿™ç§æ–¹æ¡ˆè¿˜æ˜¯å¯è¡Œçš„ã€‚è™½ç„¶ Client-IP ä¸æ˜¯ HTTP æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œä½†å¾ˆå¤šä»£ç†éƒ½ä¼šæ·»åŠ è¿™ä¸ªé¦–éƒ¨ï¼ŒWebæœåŠ¡å™¨å¯ä»¥é€šè¿‡å®ƒæ‰¾åˆ°æ‰¿è½½ HTTP è¯·æ±‚çš„ TCP è¿æ¥å¦ä¸€ç«¯çš„IPåœ°å€ã€‚\nè™½ç„¶å¦‚æ­¤ï¼Œä½¿ç”¨å®¢æˆ·ç«¯IPåœ°å€æ¥è¯†åˆ«ç”¨æˆ·è¿˜æ˜¯å­˜åœ¨è¯¸å¤šç¼ºç‚¹ï¼š\n å®¢æˆ·ç«¯IPåœ°å€æè¿°çš„æ˜¯ç”¨æˆ·æ‰€ç”¨æœºå™¨çš„IPï¼Œè€Œä¸æ˜¯ç”¨æˆ·ã€‚å½“å¤šä¸ªç”¨æˆ·å…±äº«åŒä¸€å°è®¡ç®—æœºæ—¶ï¼Œå°±æ— æ³•åŒºåˆ†ç”¨æˆ·äº†ã€‚ å¾ˆå¤š ISP éƒ½ä¼šä¸ºç”¨æˆ·åŠ¨æ€åˆ†é…IPåœ°å€ã€‚ç”¨æˆ·çš„IPåœ°å€ä¸å›ºå®šï¼Œè¯†åˆ«å¤±æ•ˆã€‚ ä¸ºäº†æé«˜å®‰å…¨æ€§å’Œç®¡ç†ç¨€ç¼ºçš„IPåœ°å€èµ„æºï¼Œå¾ˆå¤šç”¨æˆ·éƒ½æ˜¯é€šè¿‡NATæŠ€æœ¯æ¥æµè§ˆç½‘ç»œçš„ã€‚è¿™ä¸ªæ—¶å€™ç”¨æˆ·çš„çœŸå®IPå°±è¢«NATéšè—äº†ï¼Œå®¢æˆ·ç«¯IPæˆä¸ºäº†NATè®¾å¤‡çš„IPã€‚ HTTP ä»£ç†å’Œç½‘å…³é€šå¸¸ä¼šæ‰“å¼€ä¸€äº›æ–°çš„è¿æ¥åˆ°æœåŠ¡å™¨çš„TCPè¿æ¥ï¼Œè¿™ä¸ªæ—¶å€™æœåŠ¡å™¨çœ‹åˆ°çš„å°±æ˜¯ä»£ç†æˆ–ç½‘å…³çš„åœ°å€ã€‚æœ‰äº›ä»£ç†æˆ–ç½‘å…³ä¼šåœ¨ç‰¹æ®Šçš„ Client-IP æˆ– X-Forwarded-For æ‰©å±•é¦–éƒ¨ä¸­å­˜æ”¾åŸå§‹çš„IPåœ°å€ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„ä»£ç†éƒ½ä¼šè¿™ä¹ˆåšã€‚  é€šè¿‡ç™»å½•è¯†åˆ«ç”¨æˆ· WebæœåŠ¡å™¨é™¤äº†è¢«åŠ¨åœ°æ ¹æ®IPæ¥çŒœæµ‹ç”¨æˆ·èº«ä»½å¤–ï¼Œè¿˜å¯ä»¥è¦æ±‚ç”¨æˆ·è¿›è¡Œè®¤è¯æ¥æ˜¾å¼åœ°è¯¢é—®ç”¨æˆ·æ˜¯è°ã€‚\nä¸ºäº†å¸®åŠ©ç®€åŒ–Webç«™ç‚¹çš„ç™»å½•ï¼ŒHTTP åŒ…å«äº†å†…ç½®äº†ä¸€ç§å°†ç”¨æˆ·ä¿¡æ¯ä¼ é€ç»™Webç«™ç‚¹çš„æœºåˆ¶ï¼Œå³ä½¿ç”¨ WWW-Authenticate å’Œ Authorization é¦–éƒ¨ã€‚ä¸€æ—¦ç™»å½•ï¼Œæµè§ˆå™¨å°±ä¼šåœ¨æ¥ä¸‹æ¥è®¿é—®è¯¥ç«™ç‚¹çš„æ¯ä¸ªè¯·æ±‚ä¸­æºå¸¦ç™»å½•ä¿¡æ¯ã€‚\nå¦‚æœæœåŠ¡å™¨å¸Œæœ›åœ¨è®¿é—®ç«™ç‚¹å†…å®¹ä¹‹å‰å…ˆç™»å½•ï¼Œå®ƒä¼šå…ˆç»™æµè§ˆå™¨å›é€ä¸€ä¸ª 401 Login Required å“åº”çŠ¶æ€ç å¹¶æ·»åŠ  WWW-Authenticate é¦–éƒ¨åˆ°å“åº”ä¸­ã€‚æµè§ˆå™¨æ¥ç€å¼¹å‡ºä¸€ä¸ªç™»å½•å¯¹è¯æ¡†è¦æ±‚ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ä¹‹åï¼Œæµè§ˆå™¨å°±ä¼šæ·»åŠ ä¸€ä¸ª Authorization é¦–éƒ¨ï¼ˆæºå¸¦åŠ å¯†åçš„ç”¨æˆ·åå’Œå¯†ç ï¼‰å¹¶é‡å‘åŸæ¥çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°†åˆ©ç”¨å®ƒä»¬å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚é€šå¸¸ï¼Œæµè§ˆå™¨ä¼šä¿å­˜ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯ï¼Œå¹¶åœ¨å¾€åéœ€è¦ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç çš„æ—¶å€™è‡ªåŠ¨å‘é€å‡ºå»ã€‚è¿™æ ·ä¸€æ¥ï¼Œåªéœ€è¦ç™»å½•ä¸€æ¬¡ï¼Œå°±å¯ä»¥åœ¨æ•´ä¸ªä¼šè¯æœŸé—´ç»´æŒç”¨æˆ·çš„èº«ä»½ä¿¡æ¯äº†ã€‚ä¸‹å›¾å±•ç¤ºäº†è¿™ä¸ªè¿‡ç¨‹ï¼š\nFat URL æœ‰äº›Webç«™ç‚¹ä¼šä¸ºæ¯ä¸ªç”¨æˆ·ç”Ÿæˆç‰¹å®šç‰ˆæœ¬çš„ URL ï¼Œä»è€Œè¿½è¸ªç”¨æˆ·çš„èº«ä»½ã€‚é€šå¸¸çš„åšæ³•æ˜¯ï¼šæ‰©å±•åŸæ¥çš„ URL ï¼Œå¾€å…¶ä¸­åŠ å…¥ä¸€äº›çŠ¶æ€ä¿¡æ¯ã€‚å½“ç”¨æˆ·æµè§ˆç«™ç‚¹æ—¶ï¼ŒWebæœåŠ¡å™¨ä¼šåŠ¨æ€ç”Ÿæˆä¸€äº›è¶…é“¾æ¥ï¼Œç»§ç»­ç»´æŠ¤ URL ä¸­çš„çŠ¶æ€ä¿¡æ¯ã€‚è¿™äº›æ‰©å±•åçš„åŒ…å«äº†ç”¨æˆ·çŠ¶æ€ä¿¡æ¯çš„URLå°±è¢«ç§°ä¸º Fat URLã€‚\nè™½ç„¶ Fat URL èƒ½å¤Ÿè¯†åˆ«ç”¨æˆ·çš„èº«ä»½ï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä¸å°‘ç¼ºç‚¹ï¼Œä¾‹å¦‚ï¼š\n URL å¯èƒ½ä¼šå˜å¾—åˆé•¿åˆä¸‘é™‹ï¼Œå¯èƒ½ä¼šç»™ç”¨æˆ·å¸¦æ¥å›°æƒ‘ã€‚ å½“åŒ…å«äº†ç”¨æˆ·çŠ¶æ€ä¿¡æ¯çš„ URL è¢«åˆ†äº«ç»™åˆ«äººæ—¶ï¼Œç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ä¹Ÿè¢«åˆ†äº«å‡ºå»äº†ã€‚ ç”ŸæˆURLå¯èƒ½ä¼šç»™æœåŠ¡å™¨å¸¦æ¥é¢å¤–çš„è´Ÿæ‹…ã€‚  Cookie Cookieæ˜¯ä¸€ç§è¯†åˆ«ç”¨æˆ·ï¼Œå®ç°æŒä¹…ä¼šè¯çš„æ–¹å¼ï¼Œä½¿ç”¨éå¸¸å¹¿æ³›ï¼Œä¹Ÿéå¸¸é‡è¦ã€‚\nCookieçš„ç±»å‹ Cookieå¯ä»¥ç²—ç•¥åœ°åˆ†ä¸ºä¸¤ç±»ï¼šä¼šè¯cookieå’ŒæŒä¹…cookieï¼š\n ä¼šè¯cookieæ˜¯ä¸€ç§ä¸´æ—¶cookieï¼Œä»–è®°å½•äº†ç”¨æˆ·è®¿é—®ç«™ç‚¹æ—¶çš„è®¾ç½®å’Œåå¥½ï¼Œä¼šåœ¨ç”¨æˆ·é€€å‡ºæµè§ˆå™¨æ—¶è¢«åˆ é™¤ã€‚ æŒä¹…cookieçš„ç”Ÿå­˜æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå› ä¸ºå®ƒä»¬å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚å³ä½¿æµè§ˆå™¨é€€å‡ºï¼Œè®¡ç®—æœºè¢«é‡å¯ä¹Ÿä¾ç„¶å­˜åœ¨ã€‚  ä¼šè¯cookieå’ŒæŒä¹…cookieä¹‹é—´çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯å®ƒä»¬çš„è¿‡æœŸæ—¶é—´ã€‚\nCookieçš„å·¥ä½œåŸç† å½“ç”¨æˆ·é¦–æ¬¡è®¿é—®Webç«™ç‚¹æ—¶ï¼ŒWebæœåŠ¡å™¨å¯¹ç”¨æˆ·ä¸€æ— æ‰€çŸ¥ã€‚å¦‚æœWebæœåŠ¡å™¨å¸Œæœ›ç”¨æˆ·å†æ¬¡å›æ¥çš„è¯ï¼Œå®ƒå°±ä¼šé€šè¿‡ Set-Cookie é¦–éƒ¨ç»™ç”¨æˆ·è¿”å›ä¸€ä¸ªç‹¬æœ‰çš„cookieã€‚åªè¦ç”¨æˆ·åœ¨ä»¥åçš„è®¿é—®ä¸­å¸¦ä¸Šè¿™ä¸ªcookieï¼ŒæœåŠ¡å™¨å°±å¯ä»¥è¯†åˆ«å‡ºç”¨æˆ·äº†ã€‚cooKieä¸­åŒ…å«äº†ä¸€ä¸ªç”±name=valueä¿¡æ¯æ„æˆçš„ä»»æ„åˆ—è¡¨ã€‚Cookieä¸­å¯ä»¥åŒ…å«ä»»ä½•ä¿¡æ¯ï¼Œæµè§ˆå™¨ä¼šè®°ä½æœåŠ¡å™¨è¿”å›æŠ¥æ–‡é¦–éƒ¨ä¸­Set-Cookieçš„å†…å®¹å¹¶å°†cookieä¿å­˜åœ¨æµè§ˆå™¨çš„cookieæ•°æ®åº“ä¸­ã€‚å½“ç”¨æˆ·åœ¨ä¹‹åå†æ¬¡è®¿é—®æŸä¸ªç«™ç‚¹æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šé€‰å‡ºè¯¥ç«™ç‚¹åˆ†é…ç»™ç”¨æˆ·çš„cookieå¹¶æ”¾åœ¨Cookieé¦–éƒ¨ä¸­ä¼ ç»™æœåŠ¡ç«¯ã€‚\nCookieçš„åŸºæœ¬æ€æƒ³å°±æ˜¯è®©æµè§ˆå™¨ç»´æŠ¤ä¸€ç»„æœåŠ¡å™¨ç‰¹æœ‰çš„ä¿¡æ¯ï¼Œæ¯æ¬¡è®¿é—®æœåŠ¡å™¨æ—¶éƒ½å°†è¿™äº›ä¿¡æ¯æä¾›ç»™å®ƒã€‚å› ä¸ºæµè§ˆå™¨éœ€è¦è´Ÿè´£cookieçš„å­˜å‚¨ï¼Œæ‰€ä»¥cookieä¹Ÿç§°å®¢æˆ·ç«¯çŠ¶æ€ï¼ˆclient-side stateï¼‰ï¼Œè€Œcookieåœ¨HTTPè§„èŒƒä¸­çš„æ­£å¼åç§°åˆ™æ˜¯HTTP state management mechanismã€‚\nCookieçš„å±æ€§ Domain äº§ç”Ÿcookieçš„æœåŠ¡å™¨å¯ä»¥å‘Set-Cookieé¦–éƒ¨ä¸­æ·»åŠ ä¸€ä¸ªDomainå±æ€§æ¥å‘Šè¯‰æµè§ˆå™¨è¿™ä¸ªcookieæ˜¯ç»™å“ªäº›ç«™ç‚¹ä½¿ç”¨çš„ã€‚ä¾‹å¦‚ï¼ŒSet-Cookie: user=\u0026quot;Tom\u0026quot;; domain=\u0026quot;example.com\u0026quot;å‘Šè¯‰æµè§ˆå™¨å°†Cookie: use=\u0026quot;Tom\u0026quot;å‘ç»™example.comä¸‹çš„æ‰€æœ‰ç«™ç‚¹ã€‚\nPath Pathæ ‡è¯†äº†ä¸»æœºä¸‹çš„é‚£äº›è·¯å¾„å¯ä»¥æ¥å—è¯¥Cookieï¼ˆè¯¥è·¯å¾„å¿…é¡»å‡ºç°åœ¨è¯·æ±‚URLä¸­ï¼‰ã€‚ä¾‹å¦‚å½“Path=/docsæ—¶ï¼Œ/docs/ã€/docs/Web/ã€/docs/web/HTTPéƒ½ä¼šè¢«åŒ¹é…ã€‚\nå‚è€ƒèµ„æ–™  David Gourley, Brian Totty. HTTP: The Definitive Guide. O\u0026rsquo;Reilly Media, 2002. HTTP Cookies.  ","href":"/computer_networks/http/client_certification_and_cookies/","title":"å®¢æˆ·ç«¯èº«ä»½è¯†åˆ«ä¸Cookie"},{"content":"Webç¼“å­˜æŒ‡çš„æ˜¯ä¸€äº›å¯ä»¥è‡ªåŠ¨ä¿å­˜å¸¸ç”¨æ–‡æ¡£å‰¯æœ¬çš„HTTPè®¾å¤‡ã€‚å½“Webè¯·æ±‚ç»è¿‡ç¼“å­˜æ—¶ï¼Œå¦‚æœç¼“å­˜è®¾å¤‡æœ¬åœ°å­˜åœ¨ä¸€ä¸ªå¯ç”¨çš„â€œå·²ç¼“å­˜â€å‰¯æœ¬ï¼Œå°±ä¸éœ€è¦å†å»**æºæœåŠ¡å™¨ï¼ˆorigin server, å³æŒæœ‰èµ„æºå®ä½“çš„æœåŠ¡å™¨ï¼‰**è·å–è¿™ä¸ªæ–‡æ¡£äº†ï¼Œç›´æ¥å°†ç¼“å­˜è®¾å¤‡æœ¬åœ°å­˜å‚¨ä¸­çš„æ–‡æ¡£å‰¯æœ¬è¿”å›ç»™å®¢æˆ·ç«¯å³å¯ã€‚ç¼“å­˜å…·æœ‰ä¸å°‘ä¼˜ç‚¹ï¼š\n å‡å°‘å†—ä½™çš„æ•°æ®ä¼ è¾“ï¼Œä»è€ŒèŠ‚çœç½‘ç»œè´¹ç”¨ã€‚ ç¼“è§£ç½‘ç»œç“¶é¢ˆé—®é¢˜ã€‚æœ‰äº†ç¼“å­˜ä¹‹åï¼Œå¯ä»¥æ›´å¿«åœ°åŠ è½½é¡µé¢è€Œä¸éœ€è¦æ›´å¤šçš„å¸¦å®½ã€‚ é™ä½å¯¹æºæœåŠ¡å™¨çš„è¦æ±‚ã€‚æœåŠ¡å™¨ä¸ä»…å¯ä»¥æ›´å¿«åœ°å“åº”ï¼Œè¿˜èƒ½é¿å…è¿‡è½½çš„å‡ºç°ã€‚ é™ä½è·ç¦»æ—¶å»¶ã€‚å› ä¸ºä»è¾ƒè¿œçš„åœ°æ–¹åŠ è½½é¡µé¢ä¼šæ›´æ…¢ã€‚  ç¼“å­˜å‘½ä¸­ä¸ä¸å‘½ä¸­ ç¼“å­˜æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œä½†ä¸€ä¸ªç¼“å­˜ä¹Ÿä¸å¯èƒ½å­˜å‚¨ä¸‹ä¸–ç•Œä¸Šæ‰€æœ‰æ–‡æ¡£çš„å‰¯æœ¬ã€‚\nå½“è¯·æ±‚åˆ°è¾¾ç¼“å­˜æ—¶ï¼Œè‹¥ç¼“å­˜ä¸­å­˜åœ¨è¢«è¯·æ±‚å†…å®¹çš„å‰¯æœ¬ï¼ˆå‰¯æœ¬åº”è¯¥æ˜¯æœ‰æ•ˆçš„ï¼‰ï¼Œåˆ™å¯ä»¥ç›´æ¥å°†å‰¯æœ¬è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™ç§æƒ…å†µè¢«ç§°ä¸ºç¼“å­˜å‘½ä¸­ï¼ˆcache hitï¼‰ã€‚å¦åˆ™ï¼Œç¼“å­˜ä¸­æ²¡æœ‰å¯ç”¨å‰¯æœ¬ï¼Œè¯·æ±‚ä¼šè¢«è½¬å‘ç»™æºæœåŠ¡å™¨ï¼Œè¿™ç§æƒ…å†µè¢«ç§°ä¸ºç¼“å­˜ä¸å‘½ä¸­ï¼ˆcache missï¼‰ã€‚æºæœåŠ¡å™¨ä¸Šçš„å†…å®¹å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œç¼“å­˜éœ€è¦ä¸æ—¶åœ°å¯¹å…¶è¿›è¡Œæ£€æµ‹ï¼Œçœ‹çœ‹å®ƒä»¬ä¿å­˜çš„å‰¯æœ¬æ˜¯å¦ä»ç„¶æ˜¯æœåŠ¡å™¨ä¸Šçš„æœ€æ–°å†…å®¹ï¼Œè¿™äº›*æ–°é²œåº¦æ£€æµ‹ï¼ˆfreshness checksï¼‰*å°±è¢«ç§°ä¸ºHTTPå†éªŒè¯ï¼ˆHTTP revalidationï¼‰ã€‚\nå†éªŒè¯ HTTPå®šä¹‰äº†ä¸€äº›ç‰¹æ®Šçš„è¯·æ±‚ï¼Œå®ƒä»¬å¯ä»¥ä¸ä»æœåŠ¡å™¨è·å–æ•´ä¸ªå¯¹è±¡ï¼Œå¹¶å¿«é€Ÿæ£€æµ‹å‡ºå†…å®¹æ˜¯å¦ä¾ç„¶æ˜¯æ–°é²œçš„ã€‚ç¼“å­˜å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»ï¼Œä»¥ä»»æ„é¢‘ç‡å¯¹å‰¯æœ¬è¿›è¡Œå†éªŒè¯ã€‚ç”±äºç½‘ç»œå¸¦å®½éå¸¸çè´µï¼Œå¤§éƒ¨åˆ†ç¼“å­˜åªæœ‰åœ¨å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚å¹¶ä¸”å‰¯æœ¬æ—§å¾—è¶³ä»¥éœ€è¦æ£€æµ‹æ—¶ï¼Œæ‰ä¼šå¯¹å‰¯æœ¬è¿›è¡Œå†éªŒè¯ã€‚\nç¼“å­˜åœ¨å¯¹å‰¯æœ¬è¿›è¡Œå†éªŒè¯æ—¶ï¼Œä¼šå‘æºæœåŠ¡å™¨å‘é€ä¸€ä¸ªå°çš„å†éªŒè¯è¯·æ±‚ã€‚å¦‚æœå†…å®¹æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ŒæœåŠ¡å™¨å°±ä¼šä»¥ 304 Not Modified è¿›è¡Œå“åº”ã€‚åªè¦ç¼“å­˜ç¡®è®¤äº†å‰¯æœ¬ä»ç„¶æ˜¯æœ‰æ•ˆçš„ï¼Œå®ƒæœºä¼šå†æ¬¡å°†å‰¯æœ¬æ ‡è®°ä¸ºæ–°é²œçš„å¹¶å°†å‰¯æœ¬æä¾›ç»™å®¢æˆ·ç«¯ï¼Œè¿™è¢«ç§°ä¸ºå†éªŒè¯å‘½ä¸­ï¼ˆrevalidation hitï¼‰æˆ–ç¼“æ…¢å‘½ä¸­ï¼ˆslow hitï¼‰ã€‚å› ä¸ºè¿™ç§æ–¹å¼éœ€è¦ä¸æºæœåŠ¡å™¨è¿›è¡Œæ ¸å¯¹ï¼Œæ‰€ä»¥æ¯”å•çº¯çš„ç¼“å­˜å‘½ä¸­è¦æ…¢ï¼Œä½†å®ƒæ²¡æœ‰ä»æœåŠ¡å™¨è·å–å¯¹è±¡æ•°æ®ï¼Œæ‰€ä»¥æ¯”ç¼“å­˜ä¸å‘½ä¸­è¦å¿«ä¸€äº›ã€‚\nHTTPæä¾›äº†ä¸€äº›å†éªŒè¯ç¼“å­˜å¯¹è±¡çš„å·¥å…·ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„å°±æ˜¯ If-Modified-Since é¦–éƒ¨ã€‚å½“å®ƒè¢«æ·»åŠ åˆ°GETè¯·æ±‚ä¸­æ—¶ï¼Œå®ƒå‘Šè¯‰æœåŠ¡å™¨åªæœ‰å½“å¯¹è±¡çš„å‰¯æœ¬è¢«ç¼“å­˜å¹¶ä¸”å¯¹è±¡å·²ç»è¢«ä¿®æ”¹åï¼Œæ‰å‘é€å¯¹è±¡ã€‚å½“æœåŠ¡å™¨æ”¶åˆ°GET If-Modified-Sinceè¯·æ±‚æ—¶ï¼Œå¯èƒ½å¤„äºä¸‰ç§çŠ¶æ€:\n æœåŠ¡å™¨å†…å®¹æœªä¿®æ”¹ï¼ˆå†éªŒè¯å‘½ä¸­ï¼‰ã€‚æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ 304 Not Modified ä½œä¸ºå“åº”ã€‚ æœåŠ¡å™¨å†…å®¹å·²ä¿®æ”¹ä½†æœªåˆ é™¤ã€‚è¿™æ˜¯æœåŠ¡å™¨å¯¹è±¡ä¸ç¼“å­˜å‰¯æœ¬å·²ç»ä¸åŒäº†ï¼ŒæœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€æ¡å¸¦æœ‰å®Œæ•´å†…å®¹çš„æ™®é€š 200 OK ä½œä¸ºå“åº”ã€‚ æœåŠ¡å™¨å¯¹è±¡å·²è¢«åˆ é™¤ã€‚è¿™ä¸ªæ—¶å€™æœåŠ¡å™¨ä¼šå›é€ä¸€ä¸ª 404 Not Found å“åº”ï¼Œç¼“å­˜æ”¶åˆ°åä¼šå°†å¯¹åº”çš„å‰¯æœ¬åˆ é™¤ã€‚  ç¼“å­˜çš„å¤„ç†æ­¥éª¤ Webç¼“å­˜å¯¹ä¸€æ¡HTTP GETæŠ¥æ–‡çš„å¤„ç†è¿‡ç¨‹åŒ…æ‹¬ä»¥ä¸‹7ä¸ªæ­¥éª¤ï¼š\n æ¥æ”¶â€”â€”ç¼“å­˜ä»ç½‘ç»œä¸­è¯»å–æŠµè¾¾çš„è¯·æ±‚æŠ¥æ–‡ã€‚ è§£æâ€”â€”ç¼“å­˜å¯¹æŠ¥æ–‡è¿›è¡Œè§£æï¼Œæå–å‡ºURLå’Œå„ç§é¦–éƒ¨ã€‚ æŸ¥è¯¢â€”â€”ç¼“å­˜æŸ¥è¯¢æœ¬åœ°æ˜¯å¦å­˜åœ¨å¯ç”¨å‰¯æœ¬ï¼Œå¦‚æœæ²¡æœ‰å°±ä»æœåŠ¡å™¨è·å–ä¸€ä»½å¹¶ä¿å­˜åœ¨æœ¬åœ°ã€‚ æ–°é²œåº¦æ£€æµ‹â€”â€”ç¼“å­˜æŸ¥çœ‹å·²ç¼“å­˜çš„å‰¯æœ¬æ˜¯å¦è¶³å¤Ÿæ–°é²œï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±è¯¢é—®æœåŠ¡å™¨è¯¥å†…å®¹æ˜¯å¦æœ‰æ›´æ–°ã€‚ åˆ›å»ºå“åº”â€”â€”ç¼“å­˜ä½¿ç”¨æ–°çš„é¦–éƒ¨å’Œå·²ç¼“å­˜çš„ä¸»ä½“æ¥æ„å»ºä¸€æ¡å“åº”æŠ¥æ–‡ã€‚ å‘é€â€”â€”ç¼“å­˜å°†å“åº”æŠ¥æ–‡å‘é€ç»™å®¢æˆ·ç«¯ã€‚ æ—¥å¿—â€”â€”ç¼“å­˜å‘æ—¥å¿—æ–‡ä»¶ä¸­æ–°å¢ä¸€ä¸ªæè¿°è¿™ä¸ªäº‹åŠ¡çš„æ¡ç›®ï¼ˆå¯é€‰ï¼‰ã€‚  ä¸‹é¢çš„æµç¨‹å›¾å±•ç¤ºäº†ç¼“å­˜æ˜¯å¦‚ä½•å¤„ç†GETè¯·æ±‚çš„ï¼š\nä¿æŒå‰¯æœ¬çš„æ–°é²œ HTTPæä¾›äº†ä¸€äº›æœºåˆ¶ç”¨æ¥ä¿æŒå·²ç¼“å­˜æ•°æ®ä¸æœåŠ¡å™¨æ•°æ®ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚è¿™äº›æœºåˆ¶è¢«ç§°ä¸ºæ–‡æ¡£è¿‡æœŸï¼ˆdocument expirationï¼‰å’ŒæœåŠ¡å™¨å†éªŒè¯ï¼ˆserver revalidationï¼‰ã€‚\næ–‡æ¡£è¿‡æœŸ é€šè¿‡HTTPçš„ Cache-Control å’Œ Expires é¦–éƒ¨ï¼ŒæºæœåŠ¡å™¨å¯ä»¥ä¸ºæ¯ä¸ªæ–‡æ¡£é™„åŠ ä¸€ä¸ªâ€œè¿‡æœŸæ—¶é—´â€ï¼Œä»è€Œè¯´æ˜åœ¨å¤šé•¿æ—¶é—´å†…å¯ä»¥è®¤ä¸ºè¿™äº›å†…å®¹æ˜¯æ–°é²œçš„ã€‚\nåœ¨ç¼“å­˜æ–‡æ¡£è¿‡æœŸä¹‹å‰ï¼Œé™¤éå®¢æˆ·ç«¯è¯·æ±‚ä¸­åŒ…å«é˜»æ­¢æä¾›å·²ç¼“å­˜æˆ–æœªéªŒè¯èµ„æºçš„é¦–éƒ¨ï¼Œç¼“å­˜å¯ä»¥ä¸ä¸æœåŠ¡å™¨è”ç³»å¹¶ä»»æ„ä½¿ç”¨è¿™äº›å‰¯æœ¬ã€‚ä¸€æ—¦æ–‡æ¡£è¿‡æœŸï¼Œç¼“å­˜å°±å¿…é¡»ä¸æœåŠ¡å™¨è¿›è¡Œæ ¸å¯¹ã€‚\næœåŠ¡å™¨ç”¨HTTP/1.0+çš„ Expires é¦–éƒ¨æˆ–HTTP/1.1çš„ Cache-Control: max-age é¦–éƒ¨æ¥æŒ‡å®šè¿‡æœŸæ—¶é—´ã€‚äºŒè€…æ‰€åšçš„äº‹æƒ…æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äºï¼šå‰è€…ä½¿ç”¨ç»å¯¹æ—¶é—´ï¼Œåè€…ä½¿ç”¨ç›¸å¯¹æ—¶é—´ã€‚\næœåŠ¡å™¨å†éªŒè¯ å·²ç¼“å­˜æ–‡æ¡£è¿‡æœŸäº†å¹¶ä¸æ„å‘³ç€å®ƒä¸æºæœåŠ¡å™¨ä¸Šç›®å‰å¤„äºæ´»è·ƒçŠ¶æ€çš„æ–‡æ¡£æœ‰æœ¬è´¨åŒºåˆ«ï¼Œè¿™åªæ˜¯æ„å‘³ç€åˆ°äº†æ ¸å¯¹æ—¶é—´äº†ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯æœåŠ¡å™¨å†éªŒè¯ï¼Œç¼“å­˜éœ€è¦è¯¢é—®æºæœåŠ¡å™¨æ–‡æ¡£æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼š\n è‹¥å†éªŒè¯æ˜¾ç¤ºå†…å®¹å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™ç¼“å­˜éœ€è¦è·å–ä¸€ä»½æ–°çš„å‰¯æœ¬ï¼Œæ›¿æ¢æ‰æ—§çš„æ•°æ®ï¼Œç„¶åå‘é€ç»™å®¢æˆ·ç«¯ã€‚ è‹¥å†éªŒè¯æ˜¾å¼å†…å®¹æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ç¼“å­˜åªéœ€è¦è·å–æ–°çš„é¦–éƒ¨ï¼ˆé¦–éƒ¨ä¸­åŒ…å«äº†æ–°çš„è¿‡æœŸæ—¥æœŸï¼‰å¹¶æ›´æ–°ç¼“å­˜ä¸­çš„é¦–éƒ¨ã€‚  ä½¿ç”¨æ¡ä»¶æ–¹æ³•è¿›è¡Œå†éªŒè¯ HTTPçš„æ¡ä»¶æ–¹æ³•å¯ä»¥é«˜æ•ˆåœ°å®ç°å†éªŒè¯ã€‚HTTPå…è®¸ç¼“å­˜å‘æºæœåŠ¡å™¨å‘é€ä¸€ä¸ªâ€œæ¡ä»¶GETâ€ï¼Œè¯·æ±‚æœåŠ¡å™¨åªæœ‰åœ¨æ–‡æ¡£ä¸ç¼“å­˜ä¸­çš„æ–‡æ¡£å‰¯æœ¬ä¸åŒæ—¶ï¼Œæ‰å›é€å¯¹è±¡ä¸»ä½“ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå•ä¸ªæ¡ä»¶GETå°±èƒ½å®Œæˆæ–°é²œåº¦æ£€æµ‹å’Œå¯¹è±¡è·å–ã€‚è¦å‘èµ·æ¡ä»¶GETè¯·æ±‚ï¼Œéœ€è¦å‘GETè¯·æ±‚æŠ¥æ–‡çš„é¦–éƒ¨ä¸­åŠ å…¥ä»¥ä¸‹ç‰¹æ®Šçš„æ¡ä»¶é¦–éƒ¨ï¼ŒWebæœåŠ¡å™¨åªæœ‰åœ¨æ¡ä»¶ä¸ºçœŸæ—¶æ‰è¿”å›å¯¹è±¡ã€‚\nå’Œç¼“å­˜ç›¸å…³çš„æ¡ä»¶é¦–éƒ¨æœ‰ä¸¤ä¸ªï¼š\n If-Modified-Since: \u0026lt;date\u0026gt;ï¼šå¦‚æœæ–‡æ¡£åœ¨æŒ‡å®šæ—¥æœŸ \u0026lt;date\u0026gt; ä¹‹åè¢«ä¿®æ”¹äº†ï¼Œå°±æ‰§è¡Œè¯·æ±‚çš„æ–¹æ³•ã€‚å®ƒä¸€èˆ¬å’Œ Last-Modified å“åº”é¦–éƒ¨é…åˆä½¿ç”¨ï¼Œåªæœ‰å½“å†…å®¹è¢«ä¿®æ”¹ä¹‹åæ‰å»è·å–æ–°çš„å†…å®¹ã€‚ If-None-Match: \u0026lt;tags\u0026gt;ï¼šæœåŠ¡å™¨å¯ä»¥ä¸ºæ–‡æ¡£æä¾›ç‰¹æ®Šçš„æ ‡ç­¾ï¼ˆETagï¼‰ï¼Œè¿™äº›æ ‡ç­¾å°±åƒåºåˆ—å·ä¸€æ ·ï¼Œå¦‚æœå·²ç¼“å­˜æ ‡ç­¾ä¸æœåŠ¡å™¨æ–‡æ¡£ä¸­çš„æ ‡ç­¾ä¸åŒï¼Œå°±æ‰§è¡Œè¯·æ±‚æ–¹æ³•ã€‚  æ§åˆ¶ç¼“å­˜ HTTPä¸ºæœåŠ¡å™¨å®šä¹‰äº†å‡ ç§å£°æ˜æ–‡æ¡£åœ¨è¿‡æœŸå‰å¯ä»¥è¢«ç¼“å­˜å¤šé•¿æ—¶é—´çš„æ–¹å¼ã€‚æŒ‰ç…§ä¼˜å…ˆçº§é€’å‡çš„é¡ºåºï¼ŒæœåŠ¡å™¨å¯ä»¥ï¼š\n é™„åŠ ä¸€ä¸ª Cache-Control: no-store é¦–éƒ¨åˆ°å“åº”ä¸­å»ã€‚ é™„åŠ ä¸€ä¸ª Cache-Control: no-cache é¦–éƒ¨åˆ°å“åº”ä¸­å»ã€‚ é™„åŠ ä¸€ä¸ª Cache-Control: must-revalidate é¦–éƒ¨åˆ°å“åº”ä¸­å»ã€‚ é™„åŠ ä¸€ä¸ªCache-Control: max-age é¦–éƒ¨åˆ°å“åº”ä¸­å»ã€‚ é™„åŠ ä¸€ä¸ª Expires é¦–éƒ¨åˆ°å“åº”ä¸­å»ã€‚ ä¸é™„åŠ è¿‡æœŸä¿¡æ¯ï¼Œè®©ç¼“å­˜è‡ªå·±ç¡®å®šè¿‡æœŸæ—¶é—´ã€‚  no-storeä¸no-cache HTTP/1.1æä¾›äº†å‡ ç§æ ‡è®°å¯¹è±¡ä¸å¯è¢«ç¼“å­˜çš„æ–¹å¼ã€‚ä»æŠ€æœ¯ä¸Šè¯´ï¼Œè¿™äº›ä¸å¯ç¼“å­˜çš„é¡µé¢æ°¸è¿œéƒ½ä¸åº”è¯¥è¢«å­˜å‚¨åœ¨ç¼“å­˜ä¸­ã€‚ä¸‹é¢å°±æ˜¯å‡ ä¸ªæ ‡è®°æ–‡æ¡£ä¸å¯è¢«ç¼“å­˜çš„é¦–éƒ¨ï¼š\nPragma: no-cache Cache-Control: no-cache Cache-Control: no-store no-cache å¹¶ä¸æ„å‘³ç€\u0026quot;don\u0026rsquo;t cache\u0026quot;ï¼Œå½“å“åº”è¢«æ ‡è®°ä¸º no-cache æ—¶ï¼Œç¼“å­˜åœ¨ä¸æºæœåŠ¡å™¨è¿›è¡Œæ–°é²œåº¦å†éªŒè¯ä¹‹å‰ï¼Œä¸èƒ½å°†å…¶æä¾›ç»™å®¢æˆ·ç«¯ã€‚æ ‡è®°ä¸º no-store çš„å“åº”ç¦æ­¢ç¼“å­˜ä¿æŒå“åº”çš„å‰¯æœ¬ã€‚HTTP/1.1ä¸­çš„ Pragma: no-cache é¦–éƒ¨çš„ç›®çš„æ˜¯å…¼å®¹ HTTP/1.0+ã€‚\nmust-revalidate must-revalidate å¹¶ä¸æ„å‘³ç€\u0026quot;must revalidate\u0026quot;ã€‚Cache-Control: must-revalidate å“åº”é¦–éƒ¨å‘Šè¯‰ç¼“å­˜ï¼Œå½“æœ¬åœ°èµ„æºçš„å­˜æ´»æ—¶é—´æ²¡æœ‰è¶…è¿‡ max-age æ—¶ï¼Œå¯ä»¥ç›´æ¥è¿”å›ã€‚å¦åˆ™ï¼Œå¿…é¡»è·ŸæºæœåŠ¡å™¨è¿›è¡Œå†éªŒè¯ã€‚\nmax-age Cache-Control: max-age é¦–éƒ¨è¡¨ç¤ºä»æœåŠ¡å™¨å°†æ–‡æ¡£ä¼ æ¥ä¹‹æ—¶èµ·ï¼Œå¯ä»¥è®¤ä¸ºè¯¥æ–‡æ¡£å¤„äºæ–°é²œçŠ¶æ€çš„ç§’æ•°ã€‚è¿˜æœ‰ä¸€ä¸ª s-maxage é¦–éƒ¨ï¼Œå…¶è¡Œä¸ºä¸ max-age ç±»ä¼¼ï¼Œä½†åªç”¨äºå…±äº«ï¼ˆå…¬æœ‰ï¼‰ç¼“å­˜ï¼š\nCache-Control: max-age=3600 Cache-Control: s-maxage=3600 æœåŠ¡å™¨å¯ä»¥å°† max-age æˆ– s-maxage çš„å€¼è®¾ç½®ä¸º 0ï¼Œä»è€Œè¦æ±‚ç¼“å­˜ä¸ç¼“å­˜æŸä¸ªæ–‡æ¡£æˆ–æ¯æ¬¡è®¿é—®è¯¥æ–‡æ¡£æ—¶éƒ½åˆ·æ–°ï¼š\nCache-Control: max-age=0 Cache-Control: s-maxage=0 Expires Expires å“åº”é¦–éƒ¨å·²è¢«å¼ƒç”¨ï¼Œå› ä¸ºå®ƒå£°æ˜çš„æ˜¯å®é™…çš„è¿‡æœŸæ—¶é—´è€Œä¸æ˜¯ç›¸å¯¹æ—¶é•¿ã€‚å½“æœºå™¨çš„æ—¶é’Ÿä¸åŒæ­¥æ—¶ï¼Œä¼šæœ‰é—®é¢˜ã€‚\nå‚è€ƒèµ„æ–™  David Gourley, Brian Totty. HTTP: The Definitive Guide. O\u0026rsquo;Reilly Media, 2002.  ","href":"/computer_networks/http/caching/","title":"Webç¼“å­˜"},{"content":"","href":"/tags/networks/","title":"Networks"},{"content":"ç½‘ç»œå±‚çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯å°†æ•°æ®åŒ…ä»æºä¸»æœºè·¯ç”±åˆ°ç›®æ ‡ä¸»æœºã€‚åœ¨å¤§å¤šæ•°ç½‘ç»œä¸­ï¼Œæ•°æ®åŒ…éœ€è¦ç»è¿‡å¤šè·³æ‰èƒ½åˆ°è¾¾ç›®çš„åœ°ã€‚è·¯ç”±ç®—æ³•è´Ÿè´£ä¸ºå…¥å¢ƒæ•°æ®åŒ…é€‰æ‹©ä¸€æ¡è¾“å‡ºçº¿è·¯ã€‚è·¯ç”±ç®—æ³•ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼šè‡ªé€‚åº”ç®—æ³•å’Œéè‡ªé€‚åº”ç®—æ³•ã€‚éè‡ªé€‚åº”ç®—æ³•ä¸ä¼šæ ¹æ®å½“å‰æµ‹é‡æˆ–ä¼°è®¡çš„æµé‡å’Œæ‹“æ‰‘ç»“æ„æ¥è°ƒæ•´è·¯ç”±å†³ç­–ï¼Œæ•´ä¸ªè¿‡ç¨‹æ˜¯é™æ€çš„ã€‚è€Œè‡ªé€‚åº”ç®—æ³•ä¼šæ”¹å˜è·¯ç”±å†³ç­–ï¼Œè·¯ç”±å†³ç­–çš„æ”¹å˜ä¼šåæ˜ ç½‘ç»œæ‹“æ‰‘ç»“æ„çš„å˜åŒ–ï¼Œé€šå¸¸ä¹Ÿä¼šåæ˜ ç½‘ç»œæµé‡çš„å˜åŒ–æƒ…å†µï¼Œå…¶è¿‡ç¨‹æ˜¯åŠ¨æ€çš„ã€‚\næœ€çŸ­è·¯å¾„ç®—æ³• æ„é€ ä¸€å¼ ç½‘ç»œå›¾ï¼Œå›¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªè·¯ç”±å™¨ï¼Œæ¯æ¡è¾¹ä»£è¡¨ä¸€æ¡é€šä¿¡çº¿è·¯ã€‚ä¸ºäº†é€‰æ‹©ä¸€å¯¹ç»™å®šè·¯ç”±å™¨ä¹‹é—´çš„è·¯ç”±çº¿è·¯ï¼Œç®—æ³•åªéœ€è¦æ‰¾å‡ºè¿™å¯¹ç»™å®šè·¯ç”±å™¨ä¹‹é—´çš„æœ€çŸ­è·¯å¾„å³å¯ã€‚\nDijkstra ç®—æ³•æ˜¯ä¸€ç§éå¸¸æœ‰åçš„æœ€çŸ­è·¯å¾„ç®—æ³•ï¼Œå®ƒèƒ½å¤Ÿæ‰¾å‡ºå›¾ä¸­æºèŠ‚ç‚¹åˆ°å…¨éƒ¨ç›®æ ‡èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚ç®—æ³•è¦æ±‚æ‰€æœ‰è¾¹çš„æƒé‡éƒ½ä¸ºéè´Ÿå€¼ï¼Œæ°å¥½ç½‘ç»œæ‹“æ‰‘ä¸­ä¸å¯èƒ½å­˜åœ¨éè´Ÿå€¼ã€‚\nç®—æ³•åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç»´æŠ¤äº†ä¸€ç»„èŠ‚ç‚¹é›†åˆ Sï¼Œå¹¶ä¸”ä»æºç‚¹ s å‡ºå‘åˆ°é›†åˆ S ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æœ€å°è·ç¦»éƒ½å·²ç»è¢«æ‰¾åˆ°ã€‚ç”¨ V è¡¨ç¤ºç”±å›¾ä¸­æ‰€æœ‰èŠ‚ç‚¹æ„æˆçš„é›†åˆï¼Œç®—æ³•é‡å¤çš„ä»èŠ‚ç‚¹é›† V-S ä¸­é€‰å‡ºåˆ°æºç‚¹ s è·¯å¾„æœ€çŸ­èŠ‚ç‚¹ uï¼Œå°† u åŠ å…¥é›†åˆ Sï¼Œç„¶åæ›´æ–°æºç‚¹ **s**åˆ°é›†åˆ V-S ä¸­å„èŠ‚ç‚¹çš„ä¼°è®¡è·ç¦»ã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°éå†å®Œæ‰€æœ‰é¡¶ç‚¹(é›†åˆ V-S ä¸ºç©º)ã€‚ä¸‹å›¾å±•ç¤ºäº†è¿™ä¸ªè¿‡ç¨‹ï¼š\næœ€çŸ­è·¯å¾„ç®—æ³•çš„ç¼ºç‚¹åœ¨äºå…¶éœ€è¦çŸ¥é“æ•´ä¸ªç½‘ç»œçš„æ‹“æ‰‘å›¾ã€‚\næ³›æ´ªç®—æ³• æ³›æ´ª(flooding)ç®—æ³•çš„æ€æƒ³æ˜¯ï¼šå°†æ¯ä¸€ä¸ªå…¥å¢ƒçš„æ•°æ®åŒ…éƒ½å‘é€åˆ°é™¤è¯¥æ•°æ®åŒ…å…¥å¢ƒçº¿è·¯ä»¥å¤–æ‰€æœ‰çš„çº¿è·¯ã€‚ç®—æ³•çš„é²æ£’æ€§éå¸¸å¥½ï¼Œåªè¦æºä¸»æœºå’Œç›®æ ‡ä¸»æœºä¹‹é—´å­˜åœ¨ä¸€æ¡å¯ç”¨é€šè·¯ï¼Œæ•°æ®åŒ…ä¾¿å¯åˆ°è¾¾ç›®çš„åœ°ã€‚ç®—æ³•èƒ½å¤Ÿé€‰æ‹©æ¯ä¸€æ¡å¯èƒ½çš„è·¯å¾„ï¼ˆåŒ…æ‹¬æœ€çŸ­è·¯å¾„ï¼‰ï¼Œä½†ç®—æ³•ä¼šäº§ç”Ÿå¤§é‡çš„é‡å¤æ•°æ®åŒ…ã€‚\nè·ç¦»çŸ¢é‡ç®—æ³• **è·ç¦»çŸ¢é‡è·¯ç”±(distance vector routing)**ç®—æ³•æ˜¯ä¸€ç§åŠ¨æ€è·¯ç”±ç®—æ³•ã€‚ç®—æ³•è¦æ±‚æ¯ä¸ªè·¯ç”±å™¨éƒ½ç»´æŠ¤ä¸€å¼ è¡¨ï¼Œè¡¨ä¸­è®°å½•äº†å½“å‰å·²çŸ¥çš„åˆ°ç½‘ç»œä¸­å…¶å®ƒè·¯ç”±å™¨çš„æœ€ä½³è·ç¦»åŠæ‰€ä½¿ç”¨çš„é“¾è·¯ã€‚æ¯ä¸ªè·¯ç”±å™¨å›åˆæ‰€æœ‰çš„ç›¸é‚»çš„å…¶å®ƒè·¯ç”±å™¨äº¤æ¢ä¿¡æ¯å¹¶ç»“åˆè·å–çš„ä¿¡æ¯ä¸æ–­æ›´æ–°è‡ªå·±çš„è¡¨ï¼Œæœ€ç»ˆç®—æ³•æ”¶æ•›æ—¶ï¼Œæ¯ä¸ªè·¯ç”±å™¨éƒ½å¯ä»¥å¾—åˆ°åˆ°è¾¾å…¶å®ƒè·¯ç”±å™¨çš„æœ€ä½³é“¾è·¯ã€‚è·¯ç”±å™¨ä¹‹é—´äº¤æ¢ä¿¡æ¯é‡‡ç”¨çš„å°±æ˜¯ RIP(è·¯ç”±ä¿¡æ¯åè®®(Router Information Protocol)ã€‚\nè·ç¦»çŸ¢é‡è·¯ç”±ç®—æ³•è™½ç„¶æ€»èƒ½æ”¶æ•›åˆ°æ­£ç¡®çš„ç­”æ¡ˆï¼Œä½†è¿™ä¸ªæ”¶æ•›é€Ÿåº¦å¯èƒ½éå¸¸æ…¢ã€‚å½“ç½‘ç»œæ‹“æ‰‘ç»“æ„å‘ç”Ÿå˜åŒ–ä¹‹åï¼Œå¯èƒ½å‡ºç°æ— ç©·è®¡æ•°é—®é¢˜ã€‚ç®—æ³•å¯¹å¥½æ¶ˆæ¯(ä¸€æ¡æ›´è¿‘çš„é“¾è·¯)çš„ååº”éå¸¸è¿…é€Ÿï¼Œå¯¹åæ¶ˆæ¯(æŸæ¡é“¾è·¯ä¸å¯ç”¨æ—¶ï¼Œå°è¯•åˆ‡æ¢åˆ°å…¶å®ƒé“¾è·¯)çš„ååº”å´å¼‚å¸¸è¿Ÿç¼“ã€‚é—®é¢˜çš„æ ¸å¿ƒåœ¨äºï¼Œå½“Bå‘ç°è‡ªå·±è”ç³»ä¸ä¸ŠCæ—¶ï¼ŒAå‘Šè¯‰Bå®ƒæœ‰ä¸€æ¡é€šå¾€Cçš„è·¯å¾„ï¼ŒBæ— ä»åˆ¤æ–­è‡ªå·±æ˜¯å¦å°±åœ¨Aåˆ°Cçš„è¿™ä¸ªè·¯å¾„ä¸Šé¢ã€‚\né“¾è·¯çŠ¶æ€è·¯ç”± ç”±äºè·ç¦»çŸ¢é‡ç®—æ³•å­˜åœ¨æ— ç©·è®¡æ•°é—®é¢˜ï¼Œå®ƒåæ¥è¢«**é“¾è·¯çŠ¶æ€è·¯ç”±(link state routing)**ç®—æ³•å–ä»£äº†ã€‚\né“¾è·¯çŠ¶æ€è·¯ç”±ç®—æ³•å¯ä»¥ç”¨äº”ä¸ªéƒ¨åˆ†æ¥æè¿°ï¼Œæ¯ä¸€ä¸ªè·¯ç”±å™¨å¿…é¡»å®Œæˆè¿™äº”ä¸ªéƒ¨åˆ†ï¼š\n å‘ç°é‚»å±…èŠ‚ç‚¹ï¼Œå¹¶äº†è§£é‚»å±…èŠ‚ç‚¹çš„ç½‘ç»œä½ç½® è®¾ç½®åˆ°æ¯ä¸ªé‚»å±…èŠ‚ç‚¹çš„è·ç¦»æˆ–æˆæœ¬åº¦é‡å€¼ æ„é€ ä¸€ä¸ªåŒ…å«æ‰€æœ‰åˆšåˆšè·çŸ¥çš„é“¾è·¯çŠ¶æ€ä¿¡æ¯åŒ… å°†è¿™ä¸ªåŒ…å‘ç»™æ‰€æœ‰å…¶ä»–çš„è·¯ç”±å™¨ï¼Œå¹¶æ¥æ”¶æ¥è‡ªå…¶å®ƒè·¯ç”±å™¨çš„ä¿¡æ¯åŒ… è®¡ç®—å‡ºåˆ°æ¯ä¸ªå…¶å®ƒè·¯ç”±å™¨çš„æœ€çŸ­è·¯å¾„  å®é™…ä¸Šï¼Œç®—æ³•å°†å®Œæ•´çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„å‘ç»™äº†æ¯ä¸€ä¸ªè·¯ç”±å™¨ï¼Œç„¶åæ¯ä¸ªè·¯ç”±å™¨è¿è¡ŒDijstraç®—æ³•å°±å¯ä»¥æ‰¾å‡ºè‡ªå·±åˆ°å…¶å®ƒè·¯ç”±å™¨çš„æœ€çŸ­è·¯å¾„ã€‚\né“¾è·¯çŠ¶æ€è·¯ç”±ç®—æ³•åœ¨å®é™…çš„ç½‘ç»œä¸­ä½¿ç”¨éå¸¸å¹¿æ³›ï¼Œå…¸å‹çš„æœ‰ IS-IS(Intermediate System-Intermediate System) å’Œ OSPF(Open Shortest Path First) ã€‚\nå‚è€ƒæ–‡çŒ®  ANDREW S. TANENBAUM, DAVID J. WETHERALL. Computer Networks, Fifth Edition. Pearson, 2011. Thomas H. Cormen, Charles E. Leiserson, Ronald L. Rivest, Clifford Stein. Introduction to Algorithms, third Edition. The MIT Press, 2009.  ","href":"/computer_networks/fundamentals/routing_algorithms/","title":"è·¯ç”±ç®—æ³•"},{"content":"å»¶è¿Ÿï¼ˆLatencyï¼‰ å’Œ**å¸¦å®½ï¼ˆBandwidthï¼‰**æ˜¯è¡¡é‡ç½‘ç»œæ€§èƒ½çš„ä¸¤ä¸ªå…³é”®æŒ‡æ ‡ã€‚\nå»¶è¿Ÿ å»¶è¿Ÿæ˜¯æŒ‡ä¸€ä¸ªæ•°æ®åŒ…(æˆ–ä¸€æ¡æ¶ˆæ¯)ä»å‘é€åˆ°è¢«æ¥æ”¶è¿™ä¸ªè¿‡ç¨‹ä¸­æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚\nå»¶è¿Ÿçš„æ„æˆ å¯¹äºé€šè¿‡å› ç‰¹ç½‘è¿æ¥çš„ä¸€å¯¹å®¢æˆ·ç«¯-æœåŠ¡å™¨è€Œè¨€ï¼Œå»¶è¿ŸåŒ…å«ä»¥ä¸‹å››éƒ¨åˆ†ï¼š\n ä¼ æ’­å»¶è¿Ÿ(Propagation delay)ï¼šæ•°æ®åŒ…ä»å‘é€æ–¹åˆ°æ¥æ”¶æ–¹æ‰€ç»è¿‡çš„æ—¶é—´ï¼Œå–å†³äºå‘é€æ–¹ä¸æ¥æ”¶æ–¹ä¹‹é—´çš„è·ç¦»ä¸ä¿¡å·çš„ä¼ æ’­é€Ÿç‡ å‘é€å»¶è¿Ÿ(Transmission delay)ï¼šå°†æ•´ä¸ªæ•°æ®åŒ…ä¼ é€åˆ°é“¾è·¯ä¸Šæ‰€éœ€æ—¶é—´ï¼Œå–å†³äºåŒ…çš„é•¿åº¦å’Œé“¾è·¯çš„ä¼ è¾“é€Ÿç‡ å¤„ç†å»¶è¿Ÿ(Processing delay)ï¼šè·¯ç”±å™¨å¤„ç†åŒ…å¤´ï¼Œæ£€æµ‹é”™è¯¯ï¼Œä»¥åŠå†³å®šåŒ…çš„ç›®çš„åœ°æ‰€èŠ±è´¹çš„æ—¶é—´ æ’é˜Ÿå»¶è¿Ÿ(Queuing delay)ï¼šå½“åŒ…åˆ°è¾¾çš„é€Ÿåº¦è¶…è¿‡äº†è·¯ç”±å™¨çš„å¤„ç†é€Ÿåº¦æ—¶ï¼Œæ–°æŠµè¾¾çš„æ•°æ®åŒ…ä¼šåœ¨ä¸€ä¸ªç¼“å†²åŒºä¸­æ’é˜Ÿã€‚æ•°æ®åŒ…åœ¨é˜Ÿåˆ—ä¸­æ’é˜Ÿç›´åˆ°å¯ä»¥è¢«å¤„ç†æ‰€ç»è¿‡çš„æ—¶é—´å°±æ˜¯æ’é˜Ÿå»¶è¿Ÿ  ä¸€èˆ¬è€Œè¨€ï¼Œæºåˆ°ç›®æ ‡çš„è·ç¦»è¶Šé•¿ï¼Œä¼ æ’­å»¶è¿Ÿå°±è¶Šé•¿ï¼›æºåˆ°ç›®æ ‡ä¹‹é—´çš„è·¯ç”±å™¨è¶Šå¤šï¼Œå‘é€å»¶è¿Ÿå’Œå¤„ç†å»¶è¿Ÿå°±è¶Šé•¿ï¼›è·¯å¾„ä¸Šçš„è´Ÿè½½è¶Šé‡ï¼Œå‡ºç°æ’é˜Ÿçš„å¯èƒ½æ€§å°±è¶Šå¤§ï¼›\næ•°æ®åŒ…åœ¨ä¼ è¾“ä»‹è´¨ä¸­ä¼ æ’­ã€‚ä¸€æ—¦é€‰å®šä¼ è¾“ä»‹è´¨ï¼ŒåŒ…çš„ä¼ æ’­é€Ÿåº¦å…¶å®ä¹Ÿå°±å®šä¸‹æ¥äº†ã€‚è™½ç„¶éš¾ä»¥ä½¿æ•°æ®åŒ…ä¼ é€å¾—æ›´å¿«ï¼Œä½†å´å¯ä»¥æŠŠæœåŠ¡å™¨æ”¾åˆ°ç¦»ç”¨æˆ·æ›´è¿‘çš„åœ°æ–¹ï¼Œä»è€Œå‡å°‘ç”¨æˆ·çš„ç­‰å¾…æ—¶é—´ï¼Œè¿™å…¶å®å°±æ˜¯CDNçš„å·¥ä½œåŸç†ã€‚\næœ€åä¸€è‹±é‡Œå»¶è¿Ÿ æœ‰è¶£çš„æ˜¯ï¼Œå¤§é‡çš„ä¼ æ’­å»¶è¿Ÿå¹¶ä¸æ˜¯å‡ºç°åœ¨å½“æ•°æ®åŒ…è·¨è¶Šå¤§æ´‹ä»ä¸€ä¸ªå¤§é™†åˆ°å¦ä¸€ä¸ªå¤§é™†çš„æ—¶å€™ï¼Œè€Œé€šå¸¸æ˜¯å‡ºç°åœ¨æœ€åçš„å‡ è‹±é‡Œä¸­ã€‚è¦èƒ½å¤Ÿè¿ä¸ŠInternetï¼ŒISPéœ€è¦è·¯ç”±çº¿ç¼†ã€èšåˆä¿¡å·å¹¶è½¬å‘è‡³è·¯ç”±èŠ‚ç‚¹ã€‚å—è¿æ¥ç±»å‹ã€è·¯ç”±ç­–ç•¥ã€å‘å¸ƒæŠ€æœ¯ç­‰å½±å“ï¼Œæ•°æ®åŒ…ä»ç”¨æˆ·åˆ°ISPçš„ä¸»è·¯ç”±å™¨ä¼šè€—è´¹å¤§é‡çš„æ—¶é—´ã€‚å› æ­¤ï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ISPæœ‰æ—¶å€™å¯ä»¥æ˜¾è‘—é™ä½å»¶è¿Ÿã€‚\nå¸¦å®½ å¸¦å®½æ˜¯æŒ‡ä¸€ä¸ªé€»è¾‘æˆ–ç‰©ç†ä¿¡é“ä¸Šçš„æœ€å¤§ååç‡ï¼Œé€šå¸¸ç”¨å•ä½æ—¶é—´å†…ä¼ è¾“çš„æ¯”ç‰¹æ•°(bit/s)æ¥è¡¨ç¤ºã€‚\né‡‡æ ·å®šç†(Nyquistâ€“Shannon sampling theorem) é‡‡æ ·æ˜¯å°†ä¸€ä¸ªä¿¡å·è½¬æ¢ä¸ºæ•°å­—åºåˆ—çš„è¿‡ç¨‹ã€‚Nyquistæ›¾ç»æ¨å¯¼å‡ºä¸€ä¸ªå…¬å¼ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæœ‰é™å¸¦å®½çš„æ— å™ªå£°ä¿¡é“çš„æœ€å¤§æ•°æ®ä¼ è¾“é€Ÿç‡ã€‚åæ¥ï¼ŒShannonè¿›ä¸€æ­¥æŠŠNyquistçš„å·¥ä½œæ‰©å±•åˆ°äº†æœ‰éšæœºå™ªå£°(çƒ­åŠ¨åŠ›å¼•èµ·)çš„ä¿¡é“çš„æƒ…å½¢ã€‚\nNyquistè¯æ˜ï¼Œå¯¹äºä¸€ä¸ªä»»æ„ä¸€ä¸ªä¿¡å·ï¼Œå¦‚æœè¿™ä¸ªä¿¡å·é€šè¿‡äº†ä¸€ä¸ªå¸¦å®½ä¸º B çš„ä½é€šæ»¤æ³¢å™¨ï¼Œé‚£ä¹ˆåªè¦è¿›è¡Œæ¯ç§’ **2B**æ¬¡ç¡®åˆ‡é‡‡æ ·ï¼Œå°±å¯ä»¥å®Œå…¨é‡æ„å‡ºè¢«è¿‡æ»¤çš„ä¿¡å·ã€‚å¦‚æœä¿¡å·åŒ…å«äº† V ä¸ªç¦»æ•£ç­‰çº§ï¼Œé‚£ä¹ˆNyquistæ¨å¯¼å‡ºçš„å…¬å¼å¯ä»¥è¡¨ç¤ºä¸ºï¼š\n$$ maximum \\ data \\ rate = 2Blog_2V \\ bits/sec $$\né€šè¿‡Nyquistå®šç†ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼šåœ¨æ— å™ªå£°çš„1kHzä¿¡é“ä¸Šä¸å¯èƒ½ä»¥è¶…è¿‡2000bit/sçš„é€Ÿç‡ä¼ è¾“äºŒè¿›åˆ¶(ç¦»æ•£ç­‰çº§ä¸º2)ä¿¡å·ã€‚\nå¯¹äºä»»ä½•ä¸€ä¸ªä¿¡é“ï¼Œç”±äºç³»ç»Ÿä¸­åˆ†å­çš„è¿åŠ¨ï¼Œéšæœº(çƒ­)å™ªå£°æ€»æ˜¯å­˜åœ¨çš„ã€‚ä¿¡å·åŠŸç‡ä¸å™ªå£°åŠŸç‡çš„æ¯”å€¼è¢«ç§°ä¸º ä¿¡å™ªæ¯”(SNR, Signal-to-Noise Ratio)ã€‚å¦‚æœå°†ä¿¡å·åŠŸç‡å’Œå™ªå£°åŠŸç‡åˆ†åˆ«è®°ä½œ Så’Œ Nï¼Œé‚£ä¹ˆä¿¡å™ªæ¯”ä¸ºï¼šS/Nã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ºäº†è¡¨ç¤ºæ›´å¤§èŒƒå›´ï¼Œä¿¡å™ªæ¯”ä¼šè¢«å†™æˆå¯¹æ•°å½¢å¼\n$$ 10log_{10}S/N $$\nå¯¹æ•°çš„å–å€¼å•ä½ç§°ä¸ºåˆ†è´(dB, decibel)ã€‚ä¾‹å¦‚ï¼Œ10 çš„ä¿¡å™ªæ¯”ä¸º 10 åˆ†è´ï¼Œè€Œ 100 çš„ä¿¡å™ªæ¯”ä¸º 20 åˆ†è´ã€‚\nShannonçš„æˆæœä¸ºï¼šå¯¹äºä¸€ä¸ªå¸¦å®½ä¸º **B**Hzï¼Œä¿¡å™ªæ¯”ä¸º S/N çš„æœ‰å™ªå£°ä¿¡é“ï¼Œå…¶æœ€å¤§é€Ÿç‡ä¸ºï¼š\n$$ maximum \\ number \\ of \\ bits/sec = Blog_2(1 + S/N) $$\nè¿™å‘Šè¯‰äº†æˆ‘ä»¬å®é™…ä¿¡é“èƒ½å¤Ÿè·å¾—çš„æœ€å¤§å®¹é‡ã€‚\nå‚è€ƒèµ„æ–™  Ilya Grigorik. High Performance Browser Networking. O\u0026rsquo;Reilly Media, 2013. ANDREW S. TANENBAUM, DAVID J. WETHERALL. Computer Networks, Fifth Edition. Pearson, 2011.  ","href":"/computer_networks/fundamentals/latency_and_bandwidth/","title":"å»¶è¿Ÿä¸å¸¦å®½"},{"content":"IPåœ°å€ IPv4é‡‡ç”¨çš„æ˜¯32ä½åœ°å€ï¼Œè€ŒIpv6é‡‡ç”¨çš„æ˜¯128ä½åœ°å€ã€‚Internetä¸Šçš„æ¯å°ä¸»æœºå’Œè·¯ç”±å™¨éƒ½æœ‰IPåœ°å€ï¼Œä½†ä¸€ä¸ªIPåœ°å€å¹¶ä¸çœŸæ­£æŒ‡å‘ä¸€å°ä¸»æœºæˆ–è·¯ç”±å™¨ï¼Œè€Œæ˜¯æŒ‡å‘ä¸€ä¸ªç½‘ç»œæ¥å£ã€‚å¦‚æœä¸€å°ä¸»æœºåœ¨ä¸¤ä¸ªç½‘ç»œä¸Šï¼Œé‚£ä¹ˆå®ƒå¿…é¡»æ‹¥æœ‰ä¸¤ä¸ªIPåœ°å€ã€‚ä¸è¿‡ï¼Œå¤§å¤šæ•°ä¸»æœºéƒ½åœ¨ä¸€ä¸ªç½‘ç»œå†…ï¼Œåªæœ‰ä¸€ä¸ªIPåœ°å€ï¼Œä½†è·¯ç”±å™¨æœ‰å¤šä¸ªæ¥å£ï¼Œä»è€Œæœ‰å¤šä¸ªIPåœ°å€ã€‚\nIPv4 IPv4çš„ä¹¦å†™æ ¼å¼æ˜¯ç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤ºæ³•ï¼Œå°†4ä¸ªå­—èŠ‚ä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½å†™æˆä¸€ä¸ª0~255ä¹‹é—´çš„æ•´æ•°ï¼Œç„¶åç”¨.åˆ†éš”ã€‚ä¾‹å¦‚ï¼š32ä½çš„16è¿›åˆ¶åœ°å€80D00297å¯ä»¥å†™æˆ128.208.2.151ã€‚\nåˆ†ç±»å’Œç‰¹æ®Šå¯»å€ åœ¨1993å¹´ä»¥å‰ï¼ŒIPåœ°å€è¢«åˆ†ä¸º5ç±»ï¼Œè¿™ç§åˆ†é…è¢«ç§°ä¸º åˆ†ç±»å¯»å€(classful addressing)ã€‚ä¸€ä¸ªIPv4åœ°å€åˆ32æ¯”ç‰¹ç»„æˆï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªç½‘ç»œå·(å”¯ä¸€æ ‡è¯†äº’è”ç½‘ä¸­çš„æŸä¸ªå­ç½‘)ã€ä¸€ä¸ªä¸»æœºå·(å”¯ä¸€æ ‡è¯†ç½‘ç»œå†…çš„ä¸€å°ä¸»æœº)ã€‚\nIPåœ°å€è¢«åˆ’åˆ†ä¸ºäº†ä¸Šå›¾ä¸­çš„Aã€Bã€Cã€Dã€Eäº”ä¸ªç±»åˆ«ã€‚ä»Šå¤©ï¼Œè¡¨æ˜ä¸€ä¸ªIPåœ°å€æ˜¯å¦å±äºAã€Bæˆ–Cç±»ç½‘ç»œçš„æ ‡å¿—ä½å·²ä¸å†ä½¿ç”¨ã€‚\næœ‰ä¸€äº›åœ°å€æœ‰ç€ç‰¹ä¿—çš„å«ä¹‰ã€‚å…¨0è¿™ä¸ªåœ°å€(0.0.0.0)åœ¨ä¸»æœºå¯åŠ¨çš„æ—¶å€™ç”¨ï¼Œè¡¨ç¤ºâ€œè¿™ä¸ªç½‘ç»œâ€æˆ–â€œè¿™ä¸ªä¸»æœºâ€ã€‚å…¨1(255.255.255.255)è¿™ä¸ªåœ°å€è¡¨ç¤ºæŒ‡å®šç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœºï¼Œå®ƒå…è®¸åœ¨æœ¬åœ°ç½‘ç»œä¸Šè¿›è¡Œå¹¿æ’­ã€‚ç½‘ç»œå·ä¸ºå…¨0çš„åœ°å€è¡¨ç¤ºæœ¬åœ°ç½‘ç»œçš„æ‰€æœ‰ä¸»æœºã€‚ä¸»æœºå·ä¸ºå…¨1å¹¶å…·æœ‰æ­£ç¡®ç½‘ç»œå·çš„åœ°å€å…è®¸åœ¨è¯¥ç½‘ç»œå†…è¿›è¡Œå¹¿æ’­ã€‚æ‰€æœ‰127.xx.yy.zzå½¢å¼çš„åœ°å€ä¿ç•™ï¼Œç»™æœ¬åœ°ç¯è·¯æµ‹è¯•ç”¨ã€‚\nåˆ°äº†1990å‰åï¼ŒæŒ‰ç…§å½“æ—¶IPåœ°å€çš„åˆ†é…é€Ÿåº¦ï¼Œåˆ°1996å¹´å‰åå°±å¯èƒ½ç”¨å®Œæ‰€æœ‰çš„IPåœ°å€ï¼Œå½“æ—¶é‡‡å–äº†3ç§è§£å†³æ–¹æ¡ˆï¼š\n å¼€å‘æ–°çš„IPåè®®å’Œå¯»å€æ–¹æ¡ˆï¼Œç»“æœæœ‰äº†ç°åœ¨çš„IPv6 ä¿®æ”¹å½“å‰IPåœ°å€çš„åˆ†é…æ–¹æ¡ˆï¼Œç»“æœæœ‰äº†CIDR(Classless Inter Domain Routing, æ— ç±»åŸŸé—´è·¯ç”±) è®©æœªæ³¨å†Œçš„è®¡ç®—æœºé€šè¿‡NATçš„æ–¹å¼è®¿é—®äº’è”ç½‘  CIDR CIDRä¸­å·²ç»æ²¡æœ‰IPåœ°å€åˆ†ç±»çš„æ¦‚å¿µäº†ï¼Œå®ƒå…è®¸ä½¿ç”¨ä»»æ„é•¿åº¦çš„åœ°å€å‰ç¼€ï¼Œæé«˜äº†IPåœ°å€ç©ºé—´çš„åˆ©ç”¨ç‡ã€‚\næ¯ä¸ª32ä½çš„åœ°å€ç”±é«˜ä½çš„å¯å˜é•¿ç½‘ç»œå’Œä½ä½çš„ä¸»æœºä¸¤éƒ¨åˆ†ç»„æˆã€‚åŒä¸€ä¸ªç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœºåœ°å€ä¸­çš„ç½‘ç»œå€¼æ˜¯ç›¸åŒçš„ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªç½‘ç»œå¯¹åº”ä¸€å—è¿ç»­çš„IPåœ°å€ç©ºé—´ï¼Œè¿™å—åœ°å€ç©ºé—´å°±è¢«ç§°ä¸ºåœ°å€çš„ å‰ç¼€(prefix)ã€‚å‰ç¼€é•¿åº¦ç›¸å½“äºç½‘ç»œéƒ¨åˆ†ä¸­1çš„äºŒè¿›åˆ¶æ©ç ï¼Œä¾‹å¦‚å‰ç¼€é•¿åº¦ä¸º24ï¼Œå…¶å¯ä»¥å†™æˆ255.255.255.0æˆ–/24ï¼Œè¿™ç§å†™æ³•è¢«ç§°ä¸º å­ç½‘æ©ç (subnet mask)ã€‚å­ç½‘æ©ç å¯ä»¥å’Œä¸€ä¸ªIPåœ°å€è¿›è¡Œä¸è¿ç®—ï¼Œè¿ç®—ç»“æœä¸ºè¯¥IPçš„ç½‘ç»œéƒ¨åˆ†ã€‚\nå°†å¤šä¸ªå°å‰ç¼€çš„åœ°å€å—åˆå¹¶æˆä¸€ä¸ªå¤§å‰ç¼€çš„åœ°å€å—çš„è¿‡ç¨‹ç§°ä¸º è·¯ç”±èšåˆ(route aggregation)ã€‚\nCIDRçš„å·¥ä½œåŸç†ï¼šå½“ä¸€ä¸ªæ•°æ®åŒ…åˆ°è¾¾æ—¶ï¼Œè·¯ç”±å™¨æ‰«æè·¯ç”±è¡¨ä»¥ä¾¿ç¡®å®šç›®çš„åœ°æ˜¯å¦åœ¨å‰ç¼€çš„åœ°å€å—å†…ã€‚è¿™ä¸ªæ—¶å€™æœ‰å¯èƒ½åŒ¹é…åˆ°å¤šä¸ªå…·æœ‰ä¸åŒå‰ç¼€çš„è¡¨é¡¹ï¼Œè¿™ç§æƒ…å†µä¸‹ä½¿ç”¨å…·æœ‰æœ€é•¿å‰ç¼€çš„è¡¨é¡¹ã€‚\nNAT NAT(Network Address Translation) çš„æ€æƒ³æ˜¯ISPä¸ºæ¯ä¸ªå®¶åº­æˆ–æ¯ä¸ªå…¬å¸åˆ†é…ä¸€ä¸ªIPåœ°å€(æˆ–è€…å°½å¯èƒ½å°‘çš„åˆ†é…IPåœ°å€)ï¼Œç”¨è¿™ä¸ªåˆ†é…çš„IPåœ°å€æ¥ä¼ è¾“Internetæµé‡ã€‚åœ¨ç½‘ç»œå†…éƒ¨ï¼Œæ¯å°ä¸»æœºéƒ½æœ‰å…¶å”¯ä¸€çš„IPåœ°å€ï¼Œè¯¥åœ°å€ç”¨æ¥è¿›è¡Œç½‘ç»œå†…éƒ¨è·¯ç”±ã€‚å½“ä¸€ä¸ªæ•°æ®åŒ…éœ€è¦ä»ç½‘ç»œå†…éƒ¨å»å¾€å…¶å®ƒç½‘ç»œæ—¶ï¼Œå¿…é¡»è¿›è¡Œåœ°å€è½¬æ¢ï¼ŒæŠŠå…¶å†…éƒ¨IPåœ°å€æ¢æˆå…±äº«çš„é‚£ä¸ªIPåœ°å€ã€‚\næœ‰ä¸‰ç±»ä¿ç•™çš„IPåœ°å€å¯ä¾›å†…éƒ¨ç½‘ç»œä¸»æœºä½¿ç”¨ï¼š\n   èŒƒå›´ æ•°é‡     10.0.0.0 ~ 10.255.255.255/8 16777216   172.16.0.0 ~ 172.31.255.255/12 1048576   192.168.0.0 ~ 192.168.255.255/16 65536    æœ€å¸¸ç”¨çš„NATå¯»å€ç®—æ³•çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š\n å½“å†…éƒ¨ç½‘ç»œä¸Šçš„ä¸»æœºå‘é€ä¸€ä¸ªTCPæˆ–UDPåŒ…ç»™ç½‘ç»œå¤–çš„ä¸»æœºæ—¶ï¼Œè·¯ç”±å™¨å°†æ•°æ®åŒ…ä¸­çš„æºIPåœ°å€å’Œç«¯å£å·ä¿å­˜ä¸ºåœ°å€è½¬æ¢è¡¨ä¸­çš„ä¸€æ¡è®°å½• è·¯ç”±å™¨ç”¨è‡ªå·±çš„IPæ›¿æ¢æ‰æ•°æ®åŒ…ä¸­çš„æºIPåœ°å€ï¼Œç”¨ä¸€ä¸ªè™šæ‹Ÿçš„ç«¯å£å·æ›¿æ¢æºç«¯å£ï¼Œè¿™ä¸ªè™šæ‹Ÿçš„ç«¯å£å·æŒ‡å‘åŒ…å«å‘é€ä¸»æœºåœ°å€ä¿¡æ¯çš„é‚£æ¡è®°å½• è·¯ç”±å™¨å°†ä¿®æ”¹äº†æºIPåœ°å€å’Œæºç«¯å£çš„æ•°æ®åŒ…è½¬å‘ç»™ç›®æ ‡ä¸»æœº å½“è·¯ç”±å™¨ä»å¤–éƒ¨ä¸»æœºæ¥æ”¶åˆ°ä¸€ä¸ªTCPæˆ–UDPåŒ…æ—¶ï¼Œå®ƒä½¿ç”¨åŒ…ä¸­çš„ç›®çš„ç«¯å£å·è®¿é—®åœ°å€è½¬æ¢è¡¨ä¸­çš„è®°å½•ï¼Œå¹¶ç”¨è®°å½•çš„å†…å®¹æ›¿æ¢æ•°æ®åŒ…ä¸­çš„ç›®çš„åœ°å€å’Œç«¯å£å·ï¼Œç„¶åå°†ä¿®æ”¹åçš„æ•°æ®åŒ…è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸­çš„ä¸»æœº  IPv6 IPv6ä¸ä»…è§£å†³äº†IPv4åœ°å€è€—å°½çš„é—®é¢˜ï¼Œè¿˜åšäº†å¾ˆå¤šçš„æ”¹è¿›ã€‚IPv6åœ°å€ç”±16ä¸ªå­—èŠ‚ç»„æˆï¼Œ16ä¸ªå­—èŠ‚è¢«åˆ†æˆ8ç»„æ¥ä¹¦å†™ï¼Œæ¯ä¸€ç»„4ä¸ª16è¿›åˆ¶æ•°å­—ï¼Œç»„ä¹‹é—´ç”¨å†’å·éš”å¼€ã€‚\nå‚è€ƒèµ„æ–™  ANDREW S. TANENBAUM, DAVID J. WETHERALL. Computer Networks, Fifth Edition. Pearson, 2011.  ","href":"/computer_networks/fundamentals/ip_address/","title":"Ipå¯»å€"},{"content":"","href":"/tags/zookeeper/","title":"ZooKeeper"},{"content":" ZooKeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œå¯ä»¥ä¸ºåˆ†å¸ƒå¼è®¡ç®—ç¯å¢ƒç»´æŠ¤é…ç½®ä¿¡æ¯ã€æä¾›å‘½åã€åŒæ­¥ã€åˆ†ç»„ç­‰æœåŠ¡ã€‚\n å•æœºéƒ¨ç½² å‡†å¤‡Javaç¯å¢ƒ ZooKeeperæ˜¯ç”±Javaç¼–å†™çš„ï¼Œå¯ä»¥åœ¨JDK 7åŠä»¥ä¸Šç‰ˆæœ¬ä¸­è¿è¡Œã€‚åœ¨æ­£å¼è¿è¡ŒZooKeeperä¹‹å‰ï¼Œéœ€è¦é…ç½®å¥½Javaç¯å¢ƒä»¥åŠJAVA_HOMEã€‚\nä¸‹è½½ é¦–å…ˆä¸‹è½½æœ€ç‰ˆæœ¬çš„ZooKeeperï¼Œç„¶åè§£å‹ã€‚å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯3.5.5ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œä¸‹è½½çš„ä¹Ÿæ˜¯è¿™ä¸ªç‰ˆæœ¬ã€‚ä¸ºäº†åŠ å¿«ä¸‹è½½é€Ÿåº¦ï¼Œæˆ‘ä½¿ç”¨äº†æ¸…åå¤§å­¦çš„é•œåƒç«™ã€‚\nwget https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/stable/apache-zookeeper-3.5.5-bin.tar.gz tar -xzvf apache-zookeeper-3.5.5-bin.tar.gz åˆ›å»ºé…ç½®æ–‡ä»¶ ä¸ºäº†å¯åŠ¨ZooKeeperï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä»½é…ç½®æ–‡ä»¶ã€‚å¯åŠ¨æ—¶å¦‚æœä¸æŒ‡å®šé…ç½®æ–‡ä»¶åï¼ŒZooKeeperé»˜è®¤ä¼šå»å®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ä¸­å¯»æ‰¾ä¸€ä¸ªåä¸ºzoo.cfgçš„æ–‡ä»¶ï¼Œå¹¶ä»ä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚å…ˆåˆ›å»ºä¸€ä»½é…ç½®æ–‡ä»¶ï¼š\ncd apache-zookeeper-3.5.5-bin vim conf/zoo.cfg ä¸‹é¢æ˜¯zoo.cfgæ–‡ä»¶å†…å®¹çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œæ–‡ä»¶å†…å®¹å‚è€ƒè‡ªZooKeeper Getting Started Guide:\ntickTime=2000 dataDir=/opt/Apache/apache-zookeeper-3.5.5-bin/data/standalone # æ•°æ®ç›®å½• clientPort=2181 å…¶å®å‹ç¼©åŒ…é‡Œé™„å¸¦äº†ä¸€ä»½é…ç½®æ–‡ä»¶çš„æ ·æœ¬zoo_sample.cfgï¼Œä¹Ÿå¯ä»¥å‚è€ƒè¿™ä¸ªæ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒZooKeeperå†…ç½®çš„AdminServerä½¿ç”¨äº†8080ç«¯å£ï¼Œå¦‚æœå®‰è£…æœºå™¨ä¸Šçš„8080ç«¯å£å·²è¢«ä½¿ç”¨ï¼Œéœ€è¦æ–°å¢ä¸€ä¸ªé…ç½®é¡¹ï¼Œä¾‹å¦‚ï¼š\nadmin.serverPort=9090 # ä½¿ç”¨9090ç«¯å£ä½œä¸ºAdminServeré€šä¿¡ç«¯å£ è¿˜å¯ä»¥è‡ªå®šä¹‰ZooKeeperçš„æ—¥å¿—æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ï¼š\ndataLogDir=/opt/Apache/apache-zookeeper-3.5.5-bin/logs/standalone å¯åŠ¨ZooKeeper å‡†å¤‡å¥½é…ç½®æ–‡ä»¶ä¹‹åï¼Œå°±å¯ä»¥å¯åŠ¨ZooKeeperäº†:\nbin/zkServer.sh start è‹¥æƒ³æ˜¾å¼æŒ‡å®šä½¿ç”¨é…ç½®æ–‡ä»¶zoo.cfgï¼Œåˆ™å¯è¿è¡Œï¼š\nbin/zkServer.sh start zoo.cfg è‹¥çœ‹åˆ°å‡ºé”™ä¿¡æ¯ï¼Œåˆ™ZooKeeperå¯åŠ¨æˆåŠŸã€‚å¯è¿›ä¸€æ­¥æŸ¥çœ‹å½“å‰è¿è¡ŒçŠ¶æ€ï¼š\nbin/zkServer.sh status è¿æ¥ZooKeeper bin/zkCli.sh -server 127.0.0.1:2181 åœæ­¢ZooKeeper bin/zkServer.sh stop ä¼ªé›†ç¾¤éƒ¨ç½² å¾ˆå¤šæ—¶å€™ï¼Œå•æœºç‰ˆçš„ZooKeeperå·²ç»èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬çš„æµ‹è¯•è¦æ±‚äº†ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æ¨¡æ‹Ÿé›†ç¾¤ç¯å¢ƒã€‚ZooKeeperæ¨èåœ¨é›†ç¾¤ä¸­ä½¿ç”¨å¥‡æ•°å°æœºå™¨ã€‚ä¸‹é¢å°†éƒ¨ç½²çš„æ˜¯3èŠ‚ç‚¹çš„ä¼ªé›†ç¾¤ã€‚\nå‡†å¤‡é…ç½®æ–‡ä»¶ é›†ç¾¤æ¨¡å¼çš„é…ç½®æ–‡ä»¶åœ¨å•æœºçš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›å’Œé›†ç¾¤ç›¸å…³çš„ä¿¡æ¯ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œåœ¨confç›®å½•ä¸­å»ºç«‹æ–‡ä»¶zoo1.cfgï¼š\ntickTime=2000 dataDir=/opt/Apache/apache-zookeeper-3.5.5-bin/data/cluster/zk1 clientPort=2182 initLimit=10 syncLimit=5 dataLogDir=/opt/Apache/apache-zookeeper-3.5.5-bin/logs/cluster/zk1 server.1=127.0.0.1:2887:3887 server.2=127.0.0.1:2888:3888 server.3=127.0.0.1:2889:3889 ä¸Šé¢çš„server.Xä¸­ï¼ŒXä»£è¡¨æœåŠ¡å™¨çš„idã€‚æœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶ï¼Œä¼šå»è¯»å–dataDirç›®å½•ä¸‹ä¸€ä¸ªåä¸ºmyidçš„æ–‡ä»¶ã€‚myidæ–‡ä»¶çš„å†…å®¹å³æœåŠ¡å™¨çš„idã€‚\nåŒç†ï¼Œzoo2.cfgçš„å†…å®¹ä¸ºï¼š\ntickTime=2000 dataDir=/opt/Apache/apache-zookeeper-3.5.5-bin/data/cluster/zk2 clientPort=2183 initLimit=10 syncLimit=5 dataLogDir=/opt/Apache/apache-zookeeper-3.5.5-bin/logs/cluster/zk2 server.1=127.0.0.1:2887:3887 server.2=127.0.0.1:2888:3888 server.3=127.0.0.1:2889:3889 zoo3.cfg:\ntickTime=2000 dataDir=/opt/Apache/apache-zookeeper-3.5.5-bin/data/cluster/zk3 clientPort=2184 initLimit=10 syncLimit=5 dataLogDir=/opt/Apache/apache-zookeeper-3.5.5-bin/logs/cluster/zk3 server.1=127.0.0.1:2887:3887 server.2=127.0.0.1:2888:3888 server.3=127.0.0.1:2889:3889 å› ä¸ºæ˜¯ä¼ªé›†ç¾¤ï¼Œä¸‰ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„å„ä¸ªç«¯å£ä¸ä¸€æ ·ï¼Œå¦‚æœæ˜¯çœŸé›†ç¾¤ï¼Œç«¯å£å¯ä»¥æ˜¯ä¸€æ ·çš„ã€‚\nå‡†å¤‡myidæ–‡ä»¶ åˆ†åˆ«åœ¨ä¸Šé¢ä¸‰ä¸ªé…ç½®æ–‡ä»¶æŒ‡å®šçš„dataDirä¸­å»ºç«‹ä¸€ä¸ªåä¸ºmyidçš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ºæœåŠ¡å™¨çš„idï¼š\necho \u0026#34;1\u0026#34; \u0026gt;\u0026gt; /opt/Apache/apache-zookeeper-3.5.5-bin/data/cluster/zk1/myid echo \u0026#34;2\u0026#34; \u0026gt;\u0026gt; /opt/Apache/apache-zookeeper-3.5.5-bin/data/cluster/zk2/myid echo \u0026#34;3\u0026#34; \u0026gt;\u0026gt; /opt/Apache/apache-zookeeper-3.5.5-bin/data/cluster/zk3/myid å¯åŠ¨ä¼ªé›†ç¾¤ é€šè¿‡æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–¹å¼å¯åŠ¨å„ä¸ªèŠ‚ç‚¹ï¼š\nbin/zkServer.sh start zoo1.cfg bin/zkServer.sh start zoo2.cfg bin/zkServer.sh start zoo3.cfg æŸ¥çœ‹å„èŠ‚ç‚¹çŠ¶æ€ï¼š\nbin/zkServer.sh status zoo1.cfg bin/zkServer.sh status zoo2.cfg bin/zkServer.sh status zoo3.cfg åœæ­¢é›†ç¾¤ï¼š\nbin/zkServer.sh stop zoo1.cfg bin/zkServer.sh stop zoo2.cfg bin/zkServer.sh stop zoo3.cfg ","href":"/posts/getting_started/zookeeper%E5%8D%95%E6%9C%BA%E4%B8%8E%E4%BC%AA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/","title":"ZooKeeperå•æœºä¸ä¼ªé›†ç¾¤éƒ¨ç½²"},{"content":" Redisæ˜¯ä¸€ä¸ªä½äºå†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œç”± ANSI C è¯­è¨€ç¼–å†™ã€‚å¯ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚å®ƒæ”¯æŒçš„æ•°æ®ç»“æ„æœ‰ï¼šstringã€hashã€listã€setã€sorted set with range quriesã€bitmapã€hyperloglogsã€geospatial indexes with radius queriesä»¥åŠstreamã€‚Redisæ”¯æŒå¤åˆ¶ã€Luaè„šæœ¬ã€åŸºäºLRUçš„é”®é©±é€ã€äº‹åŠ¡å’Œä¸åŒçº§åˆ«çš„ç£ç›˜æŒä¹…åŒ–ï¼Œå¹¶é€šè¿‡å“¨å…µå’ŒRedisé›†ç¾¤çš„è‡ªåŠ¨åˆ†åŒºæœºåˆ¶æ¥ä¿è¯é«˜å¯ç”¨ã€‚\n Redis æ˜¯ Remote dictionary server çš„ç¼©å†™ï¼Œå­—æ¯æ„æ€å³è¿œç¨‹å­—å…¸æœåŠ¡ã€‚ä¸€ä¸ª Redis å¯ä»¥æœ‰å¤šä¸ªå­˜å‚¨æ•°æ®çš„å­—å…¸ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ select æ¥é€‰æ‹©å­—å…¸ï¼ˆDBï¼‰è¿›è¡Œå­˜å‚¨ã€‚\n Redisçš„å­˜å‚¨æ˜¯åŸºäºkey-valueçš„ï¼Œä½†è¿™é‡Œçš„key-valueä¸æ˜¯ç®€å•çš„key-valueï¼Œå› ä¸ºvalueçš„ç±»å‹å¯ä»¥æœ‰å¾ˆå¤šç§ã€‚åœ¨æˆ‘ä»¬ä¼ ç»Ÿçš„key-valueå­˜å‚¨ä¸­ï¼Œkeyå’Œvalueéƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œåœ¨Redisä¸­ï¼Œvalueä¸ä»…å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯åƒåˆ—è¡¨ã€é›†åˆè¿™æ ·çš„å¤æ‚çš„æ•°æ®ç»“æ„ã€‚\n æœ¬æ–‡ä¸»è¦å†…å®¹åŒ…æ‹¬ï¼šRedisçš„å®‰è£…ã€é”®å’Œå‡ ç§å¸¸è§çš„æ•°æ®ç±»å‹çš„ä½¿ç”¨ï¼Œä»¥åŠå’Œæ•°æ®ç”Ÿå­˜æœŸç›¸å…³çš„ä¸€äº›æ“ä½œã€‚\nå®‰è£…Redis å‚è§Redis Quick Startã€‚\nRedisé”® Redisçš„é”®æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åœ¨Redisä¸­ï¼Œå­—ç¬¦ä¸²äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šRedisä¸­çš„å­—ç¬¦ä¸²å¯ä»¥åŒ…å«ä»»ä½•ç±»å‹çš„æ•°æ®(æ¯”å¦‚ï¼šä¸€å¼ å›¾ç‰‡ã€ä¸€ä¸ªåºåˆ—åŒ–åçš„Javaå¯¹è±¡â€¦â€¦)ï¼Œè¿™äº›ä¹Ÿå¯ä»¥æˆä¸ºRedisä¸­çš„é”®ã€‚\næ³¨æ„ï¼šç©ºå­—ç¬¦ä¸²(\u0026quot;\u0026quot;)ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„é”®ã€‚\næ•°æ®ç±»å‹ Strings å­—ç¬¦ä¸²(string)æ˜¯Redisæœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œæœ€å¤§ä¸èƒ½è¶…è¿‡512MBã€‚\nRedisæä¾›äº†20å¤šä¸ªæ“ä½œstringç±»å‹çš„å‘½ä»¤ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š\n\u0026gt;\u0026gt; set s1 \u0026quot;Hello, Redis\u0026quot; // è®¾ç½®s1çš„å€¼ä¸º\u0026quot;Hello, Redis\u0026quot; OK // æˆåŠŸè¿”å›OK \u0026gt;\u0026gt; get s1 // è·å–å€¼ \u0026quot;Hello, Redis\u0026quot; \u0026gt;\u0026gt; setnx s1 \u0026quot;Redis\u0026quot; // å°è¯•ä¸ºs1è®¾ç½®æ–°å€¼ 0 // s1å·²æœ‰å€¼ï¼Œä¸è¿›è¡Œæ“ä½œï¼Œè¿”å›0 \u0026gt;\u0026gt; get s1 \u0026quot;Hello, Redis\u0026quot; \u0026gt;\u0026gt; set s1 2 // è®¾ç½®å€¼ OK \u0026gt;\u0026gt; get s1 \u0026quot;2\u0026quot; \u0026gt;\u0026gt; incr s1 // åŠ 1 3 \u0026gt;\u0026gt; incrby s1 10 // åŠ 10 13 \u0026gt;\u0026gt; decr s1 // å‡1 12 \u0026gt;\u0026gt; decrby s1 5 // å‡5 7 \u0026gt;\u0026gt; incrbyfloat s1 1.1 // åŠ 1.1 8.1 \u0026gt;\u0026gt; incrbyfloat s1 -3.1 // å‡3.1 5 SET å’Œ GET åˆ†åˆ«ç”¨æ¥è®¾ç½®å’Œæ£€ç´¢keyå¯¹åº”çš„å€¼(è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²)ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæŸä¸ªkeyå·²ç»æœ‰å¯¹åº”çš„å€¼ï¼ŒSET å‘½ä»¤ä¼šè¦†ç›–æ‰å·²æœ‰çš„å€¼(ä¸ç®¡ä¹‹å‰çš„å€¼æ˜¯ä½•ç§ç±»å‹éƒ½ä¼šè¢«è¦†ç›–)ï¼Œå’Œè¿™ä¸ªkeyå…³è”çš„TTLä¹Ÿä¼šè¢«ä¸¢å¼ƒã€‚å¦‚æœä¸å¸Œæœ›å·²æœ‰keyçš„å€¼è¢«è¦†ç›–ï¼Œå¯ä»¥ä½¿ç”¨ SETNX å‘½ä»¤ï¼Œå½“keyå­˜åœ¨æ—¶ï¼ŒSETNX ä¸ä¼šè¿›è¡Œä»»ä½•æ“ä½œã€‚\nè™½ç„¶å€¼æ˜¯stringï¼Œä½†å¦‚æœè¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªæ•°å­—çš„å­—ç¬¦ä¸²å½¢å¼çš„è¯ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡ŒåŠ å‡æ“ä½œã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œs1çš„å€¼è¢«é‡æ–°ä¿®æ”¹ä¸ºäº†\u0026quot;2\u0026quot;ï¼Œéšåæ‰§è¡Œäº† INCR å’Œ INCRBY ä¸¤ä¸ªåŠ æ³•å‘½ä»¤ï¼Œå€¼å˜æˆäº†13ï¼Œä¹‹åçš„å‡æ³•å‘½ä»¤ DECR å’Œ DECRBY å°†å€¼å‡åˆ°äº†7ã€‚æ›´åŠ æœ‰è¶£çš„æ˜¯ï¼ŒRedisè¿˜æä¾›äº† INCRBYFLOAT ä»¥æ”¯æŒæµ®ç‚¹åŠ å‡è¿ç®—ã€‚\n\u0026gt;\u0026gt; mset s1 1 s2 2 s3 a OK \u0026gt;\u0026gt; mget s1 s2 s3 [ \u0026quot;1\u0026quot;, \u0026quot;2\u0026quot;, \u0026quot;a\u0026quot; ] æœ‰æ—¶å€™ï¼Œä¸€æ¬¡æ€§è®¾ç½®æˆ–è·å–å¤šä¸ªå€¼æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ï¼Œè¿™å¯ä»¥é€šè¿‡ MSET å’Œ MGET å‘½ä»¤å®ç°ã€‚ç±»ä¼¼çš„è¿˜æœ‰ MSETNX å‘½ä»¤ã€‚\nLists åœ¨Redisä¸­ï¼Œåˆ—è¡¨(list)è¡¨ç¤ºç”±ä¸€äº›å…ƒç´ ç»„æˆçš„æœ‰åºåºåˆ—ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒListçš„å®ç°æœ‰æ•°ç»„å’Œé“¾è¡¨ä¸¤ç§æ–¹å¼ï¼Œä¸¤è€…å„æœ‰ä¼˜åŠ£ã€‚æ•°ç»„å®ç°çš„Listå¯ä»¥é€šè¿‡ç´¢å¼•å¿«é€Ÿè®¿é—®å…ƒç´ ï¼Œä½†åœ¨æ’å…¥æˆ–åˆ é™¤å…ƒç´ çš„æ—¶å€™è¾ƒæ…¢ï¼›é“¾è¡¨å®ç°çš„Liståœ¨æ’å…¥æˆ–åˆ é™¤å…ƒç´ æ—¶éå¸¸è¿…é€Ÿï¼Œä½†è®¿é—®å…ƒç´ æ—¶è¾ƒæ…¢ã€‚Redisä¸­çš„listä½¿ç”¨é“¾è¡¨å®ç°ï¼Œå› ä¸ºå¯¹äºä¸€ä¸ªæ•°æ®åº“ç³»ç»Ÿæ¥è¯´ï¼Œå¿«é€Ÿå‘ä¸€ä¸ªéå¸¸é•¿çš„åˆ—è¡¨ä¸­æ·»åŠ å…ƒç´ è‡³å…³é‡è¦ã€‚åŸºäºé“¾è¡¨çš„å®ç°è¿˜å¸¦æ¥äº†ä¸€ä¸ªé‡å¤§ä¼˜åŠ¿ï¼Œé‚£å°±æ˜¯å¯ä»¥å¿«é€Ÿçš„é€‰å–åˆ—è¡¨ä¸­çš„æŸä¸€éƒ¨åˆ†ã€‚\nRedisæä¾›äº†10å¤šä¸ªæ“ä½œlistçš„å‘½ä»¤ï¼Œä¸‹é¢æ—¶ä¸€äº›ä¾‹å­ï¼š\n\u0026gt;\u0026gt; lpush list1 a 1 b // å‘åˆ—è¡¨list1çš„å¤´éƒ¨ä¾æ¬¡æ’å…¥aã€1ã€bè¿™ä¸‰ä¸ªå…ƒç´  3 // æˆåŠŸæ’å…¥ï¼Œå½“å‰åˆ—è¡¨list1å«æœ‰3ä¸ªå…ƒç´  \u0026gt;\u0026gt; lrange list1 0 -1 // æŸ¥çœ‹list1 1) \u0026quot;b\u0026quot; 2) \u0026quot;1\u0026quot; 3) \u0026quot;a\u0026quot; \u0026gt;\u0026gt; rpush list1 c d // å‘åˆ—è¡¨list1å°¾éƒ¨ä¾æ¬¡æ’å…¥cã€dè¿™ä¸¤ä¸ªå…ƒç´  5 // æ’å…¥æˆåŠŸï¼Œå½“å‰åˆ—è¡¨list1å«æœ‰5ä¸ªå…ƒç´  \u0026gt;\u0026gt; lrange list1 0 -1 1) \u0026quot;b\u0026quot; 2) \u0026quot;1\u0026quot; 3) \u0026quot;a\u0026quot; 4) \u0026quot;c\u0026quot; 5) \u0026quot;d\u0026quot; \u0026gt;\u0026gt; lpop list1 // ç§»é™¤å¹¶è¿”å›åˆ—è¡¨list1ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´  b \u0026gt;\u0026gt; rpop list1 // ç§»é™¤å¹¶è¿”å›åˆ—è¡¨list2ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´  d \u0026gt;\u0026gt; lrange list2 0 -1 // åˆ—è¡¨list2æ˜¯ç©ºçš„ \u0026gt;\u0026gt; lpop list2 // ä»ä¸€ä¸ªç©ºçš„åˆ—è¡¨é‡Œé¢ç§»é™¤å…ƒç´ ä¼šè¿”å›NULL (nil) \u0026gt;\u0026gt; rpop list2 (nil) \u0026gt;\u0026gt; lrange list1 0 -1 1) \u0026quot;1\u0026quot; 2) \u0026quot;a\u0026quot; 3) \u0026quot;c\u0026quot; \u0026gt;\u0026gt; lindex list1 0 // æŸ¥çœ‹åˆ—è¡¨list1ä¸­å¤„äºä½ç½®0å¤„çš„å…ƒç´  1 \u0026gt;\u0026gt; lindex list1 -1 // æŸ¥çœ‹åˆ—è¡¨list1ä¸­æœ€åä¸€ä¸ªå…ƒç´  c å‘½ä»¤ LPUSH å’Œ RPUSH åˆ†åˆ«ç”¨æ¥å‘åˆ—è¡¨å¤´éƒ¨(å·¦ä¾§)å’Œå°¾éƒ¨(å³ä¾§)æ·»åŠ å…ƒç´ ï¼ŒLPOP å’Œ RPOP åˆ†åˆ«ç”¨æ¥ä»åˆ—è¡¨å¤´éƒ¨(å·¦ä¾§)å’Œå°¾éƒ¨(å³ä¾§)ç§»é™¤å…ƒç´ ã€‚åœ¨ä¸€ä¸ªç©ºçš„åˆ—è¡¨ä¸Šæ‰§è¡Œ LPOP æˆ– RPOP å°†è¿”å› NULL ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›åªæœ‰å½“åˆ—è¡¨ä¸­æœ‰å…ƒç´ æ—¶ï¼Œæ‰æ‰§è¡ŒPOPæ“ä½œï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨ BLPOP å’Œ BRPOP ã€‚ä¸¤ä¸ªå‘½ä»¤çš„éƒ½æ˜¯ä»åˆ—è¡¨ä¸­ç§»é™¤å…ƒç´ ï¼Œåªæ˜¯æ–¹å‘ä¸ä¸€æ ·ã€‚ä»¥ BLPOP ä¸ºä¾‹ï¼ŒBLPOP çš„å®Œæ•´å‘½ä»¤å¦‚ä¸‹ï¼š\nBLPOP key [key ...] timeout BLPOP æ¥æ”¶ä¸€ä¸ªæˆ–å¤šä¸ªkeyä»¥åŠä¸€ä¸ªè¶…æ—¶æ—¶é—´timeout(å¯é˜»å¡æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œ0ä»£è¡¨ä¸€ç›´é˜»å¡)ã€‚åœ¨è¿™äº›keyä¸­ï¼Œå¦‚æœæœ‰keyå¯¹åº”çš„åˆ—è¡¨ä¸ä¸ºç©ºï¼Œå°†ä¼šè¿”å›ç¬¬ä¸€ä¸ªéç©ºåˆ—è¡¨çš„keyåŠPOPå‡ºçš„å€¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼š\n\u0026gt;\u0026gt; lrange list1 0 -1 // åˆ—è¡¨list1åŒ…å«ä¸¤ä¸ªå…ƒç´  1) \u0026quot;a\u0026quot; 2) \u0026quot;c\u0026quot; \u0026gt;\u0026gt; lrange list2 0 -1 // åˆ—è¡¨list2ä¸ºç©º \u0026gt;\u0026gt; blpop list2 list1 0 // list1ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ è¢«ç§»é™¤ 1) \u0026quot;list1\u0026quot; 2) \u0026quot;a\u0026quot; BLPOP ä¾æ¬¡æ£€æŸ¥list2å’Œlist1ï¼Œç„¶åç§»é™¤å¹¶è¿”å›list1çš„å¤´éƒ¨å…ƒç´ (list2æ˜¯ä¸€ä¸ªç©ºåˆ—è¡¨)ã€‚\nå¦‚æœ BLPOP å‘½ä»¤åé¢ç»™å‡ºçš„çš„keyå¯¹åº”çš„éƒ½æ˜¯ç©ºåˆ—è¡¨ï¼ŒBLPOP å°±ä¼šé˜»å¡å½“å‰è¿æ¥ã€‚ä¸€æ—¦å¦å¤–ä¸€ä¸ªå®¢æˆ·ç«¯å‘æŸä¸€ä¸ªkeyå¯¹åº”çš„åˆ—è¡¨æ’å…¥å…ƒç´ ï¼ŒBLPOP å°±ä¼šè§£é™¤é˜»å¡å¹¶è¿”å›ã€‚è‹¥é˜»å¡çš„æ—¶é—´è¶…è¿‡äº†timeoutï¼Œå°†è¿”å›NULLã€‚\nè‹¥è¦æŸ¥çœ‹åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ LRANGE å‘½ä»¤ï¼ŒLRANGE å‘½ä»¤éœ€è¦ä¸¤ä¸ªç´¢å¼•ä½œä¸ºå‚æ•°ã€‚è¿™ä¸¤ä¸ªç´¢å¼•å½¢æˆä¸€ä¸ªåŒºé—´ï¼Œåˆ†åˆ«æŒ‡å‘å¾…è¿”å›çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®ã€‚ç´¢å¼•å¯ä»¥æ˜¯è´Ÿæ•°ï¼Œ0ã€-1ã€-2åˆ†åˆ«ä»£è¡¨é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªã€æœ€åä¸€ä¸ªå’Œå€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ã€‚é™¤äº†åŒºé—´æŸ¥çœ‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ LINDEX å‘½ä»¤æŸ¥çœ‹æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚\n\u0026gt;\u0026gt; llen list1 // æŸ¥çœ‹åˆ—è¡¨list1çš„é•¿åº¦ 3 \u0026gt;\u0026gt; ltrim list1 1 2 // ä¿®å‰ªåˆ—è¡¨list1ï¼Œåªä¿ç•™ä½äºåŒºé—´[1,2]ä¸­çš„å…ƒç´  OK \u0026gt;\u0026gt; lrange list1 0 -1 // æŸ¥çœ‹list1ä¸­æ‰€æœ‰å…ƒç´  1) \u0026quot;a\u0026quot; 2) \u0026quot;c\u0026quot; LLEN ç”¨äºæŸ¥çœ‹listçš„é•¿åº¦ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿ç•™åˆ—è¡¨ä¸­çš„æŸä¸€éƒ¨åˆ†ï¼Œè¿™ä¸ªæ—¶å€™ LTRIM å°±å¯ä»¥æ’ä¸Šç”¨åœºäº†ï¼Œå®ƒå’Œ LRANGE ç±»ä¼¼ï¼Œä¹Ÿæ¥æ”¶ä¸¤ä¸ªç´¢å¼•ä½œä¸ºå‚æ•°ï¼Œä½†å®ƒå°†åˆ—è¡¨çš„å†…å®¹è®¾ç½®ä¸ºåŒºé—´å†…çš„å…ƒç´ å¹¶å»é™¤åŒºé—´å¤–çš„æ‰€æœ‰å…ƒç´ ã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒLTRIM å‘Šè¯‰Redisåªä¿ç•™åˆ—è¡¨list1å¤„äºåŒºé—´[1,2]ä¸­çš„å…ƒç´ ï¼Œç„¶åä¸¢å¼ƒå…¶å®ƒçš„å…ƒç´ ã€‚\nHashes Redisä¸­çš„å“ˆå¸Œè¡¨(hash)æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„field-valueæ˜ å°„è¡¨ï¼Œéå¸¸é€‚åˆç”¨æ¥è¡¨ç¤ºå¯¹è±¡ã€‚\nä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š\n\u0026gt;\u0026gt; hset user:1 name Tome // å°†å“ˆå¸Œè¡¨user:1çš„nameå­—æ®µçš„å€¼è®¾ç½®ä¸ºTome 1 \u0026gt;\u0026gt; hget user:1 name // è·å–å“ˆå¸Œè¡¨user:1ä¸­nameå­—æ®µå¯¹åº”çš„å€¼ Tome \u0026gt;\u0026gt; hmset user:2 name Bob age 20 education barchelor // ä¸€æ¬¡å‘å“ˆå¸Œè¡¨user:2ä¸­æ’å…¥å¤šä¸ªfiled-value OK \u0026gt;\u0026gt; hmget user:2 name age // è·å–å“ˆå¸Œè¡¨user:2ä¸­nameå’Œageå­—æ®µå¯¹åº”çš„å€¼ [ \u0026quot;Bob\u0026quot;, \u0026quot;20\u0026quot; ] \u0026gt;\u0026gt; hgetall user:2 // è·å–å“ˆå¸Œè¡¨user:2ä¸­æ‰€æœ‰å­—æ®µå’Œå€¼ { \u0026quot;name\u0026quot;: \u0026quot;Bob\u0026quot;, \u0026quot;age\u0026quot;: \u0026quot;20\u0026quot;, \u0026quot;education\u0026quot;: \u0026quot;barchelor\u0026quot; } \u0026gt;\u0026gt; hget user:1 age // ä¼å›¾è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„å­—æ®µå¯¹åº”çš„å€¼ï¼Œä¼šè¿”å›NULL (nil) \u0026gt;\u0026gt; hexists user:1 age // æ£€æŸ¥å“ˆå¸Œè¡¨user:1ä¸­æ˜¯å¦å­˜åœ¨å­—æ®µage 0 \u0026gt;\u0026gt; hvals user:2 // è¿”å›å“ˆå¸Œè¡¨user:2ä¸­æ‰€æœ‰çš„å€¼ [ \u0026quot;Bob\u0026quot;, \u0026quot;20\u0026quot;, \u0026quot;barchelor\u0026quot; ] \u0026gt;\u0026gt; hincrby user:2 age 2 // å°†å“ˆå¸Œè¡¨user:2çš„ageå­—æ®µå¯¹åº”çš„å€¼åŠ 2 22 \u0026gt;\u0026gt; hget user:2 age 22 Sets Redisä¸­çš„é›†åˆ(set)æ˜¯ä¸€ä¸ªç”±å­—ç¬¦ä¸²æ„æˆçš„æ— åºé›†åˆã€‚é™¤äº†åŸºæœ¬çš„æ’å…¥ã€åˆ é™¤ã€å­˜åœ¨æ€§æ£€æµ‹ç­‰æ“ä½œï¼ŒRedisè¿˜æ”¯æŒé›†åˆçš„äº¤ã€å¹¶ã€å·®è®¡ç®—ã€‚\nä¸‹é¢æ˜¯åŸºæœ¬æ“ä½œçš„ä¸€äº›ä¾‹å­ï¼š\n\u0026gt;\u0026gt; sadd set1 red blue white black // å‘é›†åˆset1ä¸­æ’å…¥4ä¸ªå…ƒç´  4 \u0026gt;\u0026gt; smembers set1 // æŸ¥çœ‹é›†åˆset1å†…å®¹ [ \u0026quot;black\u0026quot;, \u0026quot;white\u0026quot;, \u0026quot;blue\u0026quot;, \u0026quot;red\u0026quot; ] \u0026gt;\u0026gt; sismember set1 yellow // æ£€æŸ¥yellowæ˜¯å¦åœ¨set1ä¸­ 0 // é›†åˆset1ä¸åŒ…å«yellow \u0026gt;\u0026gt; scard set1 // æŸ¥çœ‹é›†åˆset1çš„åŸºæ•°(å…ƒç´ ä¸ªæ•°) 4 \u0026gt;\u0026gt; spop set1 // éšæœºä»é›†åˆset1ä¸­ç§»é™¤ä¸€ä¸ªå…ƒç´  white \u0026gt;\u0026gt; srem set1 white // ä»é›†åˆset1ä¸­åˆ é™¤ä¸€ä¸ªä¸å­˜åœ¨çš„å…ƒç´  0 \u0026gt;\u0026gt; srem set1 black // ä»é›†åˆset1ä¸­åˆ é™¤ä¸€ä¸ªå­˜åœ¨çš„å…ƒç´  1 \u0026gt;\u0026gt; smembers set1 [ \u0026quot;blue\u0026quot;, \u0026quot;red\u0026quot; ] ä¸‹é¢æ˜¯é›†åˆè¿ç®—ï¼š\n\u0026gt;\u0026gt; sadd set2 a b c red blue gold 6 \u0026gt;\u0026gt; smembers set2 [ \u0026quot;red\u0026quot;, \u0026quot;c\u0026quot;, \u0026quot;b\u0026quot;, \u0026quot;a\u0026quot;, \u0026quot;blue\u0026quot;, \u0026quot;gold\u0026quot; ] \u0026gt;\u0026gt; sunion set1 set2 // set1 + set2 [ \u0026quot;a\u0026quot;, \u0026quot;blue\u0026quot;, \u0026quot;gold\u0026quot;, \u0026quot;red\u0026quot;, \u0026quot;c\u0026quot;, \u0026quot;b\u0026quot; ] \u0026gt;\u0026gt; sinter set1 set2 // set1 x set2 [ \u0026quot;blue\u0026quot;, \u0026quot;red\u0026quot; ] \u0026gt;\u0026gt; sdiff set2 set1 // set2 - set1 [ \u0026quot;a\u0026quot;, \u0026quot;gold\u0026quot;, \u0026quot;c\u0026quot;, \u0026quot;b\u0026quot; ] \u0026gt;\u0026gt; sadd set3 f 1 \u0026gt;\u0026gt; sdiff set2 set1 set3 // set2 - set1 - set3 [ \u0026quot;a\u0026quot;, \u0026quot;gold\u0026quot;, \u0026quot;c\u0026quot;, \u0026quot;b\u0026quot; ] Sorted sets Redisä¸­çš„æœ‰åºé›†åˆ(sorted set)å’Œé›†åˆ(set)ç±»ä¼¼ï¼Œå­˜æ”¾ä¸é‡å¤çš„å­—ç¬¦ä¸²ã€‚ä¸è¿‡ï¼Œæœ‰åºé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æµ®ç‚¹åˆ†æ•°(score)ï¼Œè¿™ä¸ªåˆ†æ•°ç”¨æ¥ç»´æŒé›†åˆçš„æœ‰åºæ€§ã€‚ç”±äºæ˜¯æœ‰åºçš„ï¼Œæœ‰åºé›†åˆåˆå…·æœ‰å“ˆå¸Œè¡¨çš„å¿«é€Ÿè®¿é—®çš„ä¼˜åŠ¿ã€‚\nè€ƒè™‘æœ‰åºé›†åˆä¸­çš„ä¸¤ä¸ªå…ƒç´ Aå’ŒBï¼Œæœ‰åºé›†åˆçš„æœ‰åºæ€§åŸºäºä»¥ä¸‹ä¸¤ç‚¹ï¼š\n å¦‚æœA.score \u0026gt; B.scoreï¼Œé‚£ä¹ˆï¼šA \u0026gt; Bã€‚ å¦‚æœA.socre = B.scoreï¼ŒA \u0026gt; Bçš„å‰ææ˜¯Açš„å­—å…¸åºå¤§äºBã€‚å› ä¸ºé›†åˆçš„å…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ï¼ŒAå’ŒBçš„å†…å®¹ä¸èƒ½ç›¸åŒã€‚  ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š\n\u0026gt;\u0026gt; zadd z1 2 a -1 b // å‘æœ‰åºé›†åˆz1ä¸­æ·»åŠ a(score=2)å’Œb(score=-1)ï¼Œ ZADDè¿˜å¯ä»¥ç”¨æ¥æ›´æ–°å…ƒç´ å¯¹åº”çš„åˆ†æ•° 2 \u0026gt;\u0026gt; zrange z1 0 -1 // æŸ¥çœ‹z1å†…å®¹(æ­£åº)ï¼Œå› ä¸ºb.score \u0026lt; a.scoreï¼Œæ‰€æœ‰båœ¨å‰é¢ [ \u0026quot;b\u0026quot;, \u0026quot;a\u0026quot; ] \u0026gt;\u0026gt; zrange z1 0 -1 withscores // æŸ¥çœ‹z1å†…å®¹åŠå¯¹åº”åˆ†æ•° [ \u0026quot;b\u0026quot;, \u0026quot;-1\u0026quot;, \u0026quot;a\u0026quot;, \u0026quot;2\u0026quot; ] \u0026gt;\u0026gt; zrevrange z1 0 -1 // æŸ¥çœ‹z1å†…å®¹(é€†åº) [ \u0026quot;a\u0026quot;, \u0026quot;b\u0026quot; ] \u0026gt;\u0026gt; zrangebyscore z1 0 inf // æŸ¥çœ‹z1ä¸­åˆ†æ•°åœ¨[0, inf)å†…çš„å†…å®¹ [ \u0026quot;a\u0026quot; ] \u0026gt;\u0026gt; zrank z1 b // æŸ¥çœ‹z1ä¸­å†…å®¹bçš„æ’å 0 \u0026gt;\u0026gt; zremrangebyscore z1 -inf -1 // ç§»é™¤z1ä¸­åˆ†æ•°ä½äº(-inf,1]çš„æ‰€æœ‰å…ƒç´  1 \u0026gt;\u0026gt; zrange z1 0 -1 [ \u0026quot;a\u0026quot; ] æœ‰åºé›†åˆè¿˜æ”¯æŒå¾ˆå¤šçš„å‘½ä»¤ï¼Œæ¯”å¦‚ï¼šZPOPMAXã€ZRANGEBYLEXã€**ZUNIONSTORE**ç­‰ç­‰ã€‚\nBitmaps ä¸¥æ ¼åœ°è¯´ï¼ŒBitmapå¹¶ä¸æ˜¯ä¸€ç§æ–°çš„æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯åŸºäºstringçš„ä¸€ç§æ•°æ®ç±»å‹ï¼Œå®ƒæä¾›äº†ä¸€äº›åŸºäºæ¯”ç‰¹ä½çš„æ“ä½œã€‚\nç›¸å…³çš„å‘½ä»¤åˆ†ä¸ºä¸¤ç§ï¼šæ“ä½œå•ä¸ªæ¯”ç‰¹ä½çš„å’Œæ“ä½œä¸€ç»„æ¯”ç‰¹ä½çš„ã€‚\næ¯”ç‰¹ä½çš„è®¾ç½®å’Œæ£€ç´¢ä½¿ç”¨çš„æ˜¯ BITSET å’Œ BITGET å‘½ä»¤:\n\u0026gt;\u0026gt; setbit bits 2 1 0 \u0026gt;\u0026gt; getbit bits 2 1 \u0026gt;\u0026gt; getbit bits 1 0 BITSETç»™æŒ‡å®šæ¯”ç‰¹ä½è®¾ç½®å€¼ï¼Œç„¶åè¿”å›è¯¥ä½ç½®ä¸ŠåŸæ¥çš„å€¼ï¼Œä¼å›¾ä½¿ç”¨ BITSET è®¾ç½®0å’Œ1ä»¥å¤–çš„å€¼ä¼šå¯¼è‡´é”™è¯¯ã€‚ BITGET è·å–æŒ‡å®šä½ç½®çš„å€¼ï¼Œ å¦‚æœç»™å®šçš„ä½ç½®è¶…å‡ºäº†å­˜å‚¨ç”¨çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå°†ä¼šè¿”å›0ã€‚\næ“ä½œä¸€ç»„æ¯”ç‰¹ä½çš„å‘½ä»¤åˆ†ä¸ºä¸‰ç§ï¼š\n BITOP è¿›è¡Œå­—ç¬¦ä¸²ä¹‹é—´çš„æŒ‰ä½ä¸ã€æŒ‰ä½æˆ–ã€æŒ‰ä½å¼‚æˆ–ä»¥åŠæŒ‰ä½å–åæ“ä½œã€‚ BITCOUNT è¿›è¡Œè®¡æ•°æ“ä½œï¼Œè¿”å›è®¾ç½®ä¸º1çš„æ¯”ç‰¹ä½çš„ä¸ªæ•°ã€‚ BITPOS å¯»æ‰¾ç»™å®šçš„0æˆ–1å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚  HyperLogLogs Redisä½¿ç”¨HyperLogLogè¿›è¡Œè®¡æ•°ï¼Œè¿™ä¸ªç®—æ³•æ˜¯åŸºäºç»Ÿè®¡çš„ã€‚Redisçš„å®ç°ä¸­ï¼Œæ ‡å‡†è¯¯å·®åªæœ‰1%ï¼Œå¹¶ä¸”åœ¨æœ€åçš„æƒ…å†µä¸‹åªéœ€è¦æ¶ˆè€— 12KB çš„å†…å­˜ã€‚HyperLogLogåœ¨æŠ€æœ¯ä¸Šæ˜¯ä¸€ç§ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œä½†ä¹Ÿæ˜¯åŸºäºstringå®ç°çš„ã€‚\næˆ‘ä»¬ä½¿ç”¨ SADD å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼Œç±»ä¼¼çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ PFADD å‘HyperLogLogä¸­æ·»åŠ å…ƒç´ ã€‚å®é™…ä¸Šï¼ŒHyperLogLogå¹¶ä¸å­˜å‚¨æˆ‘ä»¬æ·»åŠ çš„å…ƒç´ ï¼Œåªæ˜¯æ›´æ–°å†…éƒ¨çŠ¶æ€ã€‚\n\u0026gt;\u0026gt; pfadd hll a b c d // å‘hllä¸­åŠ å…¥å››ä¸ªå…ƒç´  1 \u0026gt;\u0026gt; type hll // æŸ¥çœ‹hllç±»å‹ string // HyperLogLogå®é™…ä¸ºstring \u0026gt;\u0026gt; pfcount hll // å¯¹hllè¿›è¡Œè®¡æ•° 4 \u0026gt;\u0026gt; pfadd hll1 a b c d 1 \u0026gt;\u0026gt; pfadd hll2 c d e f 1 \u0026gt;\u0026gt; pfmerge hll3 hll1 hll2 // åˆå¹¶hll1å’Œhll2åˆ°hll3 OK \u0026gt;\u0026gt; pfcount hll3 6 Geospatial indexes Redisåœ¨3.2.0ç‰ˆæœ¬ä¸­åŠ å…¥äº†åœ°ç†ç©ºé—´(geospatial)è¿™ä¸€æ•°æ®ç±»å‹ï¼Œå¹¶æ”¯æŒç´¢å¼•åŠå¾„æŸ¥è¯¢åŠŸèƒ½ã€‚ä¸€ä¸ªå…·ä½“çš„ä½ç½®ä¿¡æ¯ç”±ä¸‰å…ƒç»„(longtitude, latitude, name)ç¡®å®šï¼Œå½“å‘æŸä¸€ä¸ªkeyæ·»åŠ æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šè¢«å­˜å‚¨ä¸ºæœ‰åºé›†åˆï¼Œè¿™ä¹ˆåšä¸ºåŠå¾„æŸ¥è¯¢ GEORADIU æä¾›äº†æ”¯æŒã€‚\nä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š\n\u0026gt;\u0026gt; geoadd municipalities 116.4551113869 39.6733986505 beijing 121.6406041505 30.8267595167 shanghai 106.6992091675 29.3055601981 chongqing // æ·»åŠ 3ä¸ªåœ°ç†ç©ºé—´æ•°æ® 3 \u0026gt;\u0026gt; geodist municipalities beijing chongqing // æŸ¥çœ‹beijingå’Œchongqingç›´æ¥çš„è·ç¦»(å•ä½ä¸ºç±³) 1457336.8906 \u0026gt;\u0026gt; georadius municipalities 116 40 1000 km // æŸ¥çœ‹ä»¥ç»åº¦116ã€çº¬åº¦40ä¸ºä¸­å¿ƒï¼Œ1000kmä¸ºåŠå¾„å†…çš„æ‰€æœ‰ä½ç½® [ \u0026quot;beijing\u0026quot; ] \u0026gt;\u0026gt; geohash municipalities beijing shanghai // æŸ¥çœ‹beijingå’Œchongqingçš„Geohashè¡¨ç¤º [ \u0026quot;wx4cdn242c0\u0026quot;, \u0026quot;wtqrrgzfzs0\u0026quot; ] \u0026gt;\u0026gt; geopos municipalities chongqing // æŸ¥çœ‹chongqingçš„åœ°ç†ç©ºé—´æ•°æ® [ [ \u0026quot;106.69921070337295532\u0026quot;, \u0026quot;29.30556015923176716\u0026quot; ] ] \u0026gt;\u0026gt; georadiusbymember municipalities chongqing 1500 km // æŸ¥çœ‹ä»¥chongqingä¸ºä¸­å¿ƒã€1500kmä¸ºåŠå¾„å†…çš„æ‰€æœ‰ä½ç½® [ \u0026quot;chongqing\u0026quot;, \u0026quot;shanghai\u0026quot;, \u0026quot;beijing\u0026quot; ] Streams Streamæ˜¯Redis 5.0ä¸­æ–°å¢åŠ çš„æ•°æ®ç±»å‹ï¼Œå®ƒä»¥æ›´åŠ æŠ½è±¡çš„æ–¹å¼æ¨¡æ‹Ÿäº†æ—¥å¿—ç»“æ„ï¼Œé€šå¸¸å®ç°ä¸ºä¸€ä¸ªä»…ä»¥è¿½åŠ æ¨¡å¼æ‰“å¼€çš„æ–‡ä»¶ã€‚streamæ¶‰åŠåˆ°çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œåé¢ä¼šè¯¦ç»†äº†è§£ã€‚è¿™é‡Œå…ˆè·³è¿‡ã€‚\næ•°æ®è¿‡æœŸ æˆ‘ä»¬å¯ä»¥ä¸ºæŸä¸ªkeyè®¾ç½®è¿‡æœŸæ—¶é—´(expires)ã€‚å½“expiresè¾¾åˆ°æ—¶ï¼Œå¯¹åº”çš„keyå°±ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œå°±åƒæˆ‘ä»¬æ˜¾å¼çš„æ‰§è¡Œ DEL å‘½ä»¤ä¸€æ ·ã€‚è¿‡æœŸæ—¶é—´çš„å•ä½å¯ä»¥æ˜¯ç§’ï¼Œä¹Ÿå¯ä»¥æ˜¯æ¯«ç§’ã€‚å…³äºexpiresçš„ä¿¡æ¯éƒ½å­˜æ”¾åœ¨ç£ç›˜ä¸Šï¼Œä¸”æœ‰å¤‡ä»½ã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿RedisæœåŠ¡å™¨åœæ­¢è¿è¡Œï¼Œè¿‡æœŸæ—¶é—´ä»ç„¶ä¼šæœ‰æ•ˆã€‚å®é™…ä¸Šï¼ŒRedisä¿å­˜çš„æ˜¯keyè¿‡æœŸçš„ç¡®åˆ‡æ—¶é—´ï¼Œè€Œä¸æ˜¯å‰©ä½™ç”Ÿå­˜æ—¶é—´ï¼Œè™½ç„¶å‚æ•°æ˜¯ç§’æˆ–æ¯«ç§’ã€‚\nä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š\n\u0026gt;\u0026gt; set s1 v1 OK \u0026gt;\u0026gt; expire s1 10 // è®¾ç½®s1äº10ç§’åè¿‡æœŸ 1 \u0026gt;\u0026gt; ttl s1 // æŸ¥çœ‹s1çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´(å•ä½ä¸ºç§’) 7 \u0026gt;\u0026gt; pttl s1 // æŸ¥çœ‹s1çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´(å•ä½ä¸ºæ¯«ç§’) 3042 \u0026gt;\u0026gt; get s1 // æŸ¥çœ‹s1çš„å€¼ï¼Œæœªç»è¿‡10ç§’ \u0026quot;v1\u0026quot; \u0026gt;\u0026gt; get s1 // æŸ¥çœ‹s1çš„å€¼ï¼Œè¶…è¿‡10ç§’ï¼Œs1å·²è¢«åˆ é™¤ (nil) \u0026gt;\u0026gt; set s2 v2 ex 10 // åœ¨è®¾ç½®å€¼çš„åŒæ—¶æŒ‡å®šè¿‡æœŸæ—¶é—´ä¸º10ç§’ OK \u0026gt;\u0026gt; set s3 v3 px 10000 // åœ¨è®¾ç½®å€¼çš„åŒæ—¶æŒ‡å®šè¿‡æœŸæ—¶é—´ä¸º10000æ¯«ç§’ OK ","href":"/posts/redis/redis_at_first_sight/","title":"åˆè§Redis"},{"content":"å¿«é€Ÿæ–¹æ³• ä½¿ç”¨rootæ“ä½œ\nStep 1: æ·»åŠ ä¸€ä¸ªç”¨æˆ· adduser username Step 2: æˆäºˆrootæƒé™ usermod -aG sudo username ä½†æ˜¯\u0026hellip;\u0026hellip; æœ‰äº›æ—¶å€™ï¼Œè¿™å¹¶ä¸ç®¡ç”¨\nåœ¨vultræ–°ç§Ÿçš„Debian VPSä¸Šï¼Œæˆ‘æƒ³æ·»åŠ sarkarè¿™ä¸ªç”¨æˆ·ï¼Œå¹¶æˆäºˆå®ƒrootæƒé™ã€‚ä¾ç„¶æ‰§è¡Œäº†ä¸Šé¢çš„å‘½ä»¤ï¼Œä½†å¯æ€œçš„sarkarè¿˜æ˜¯ä¸€ä¸ªæ™®é€šç”¨æˆ·ã€‚è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š\nStep1: å®‰è£…sudo # apt-get install sudo Step2: ä¿®æ”¹/etc/sudoers # cd /etc # chmod +w sudoers # vim sudoers æ‰¾åˆ°ä¸‹é¢å†…å®¹ï¼š\n# User privilege specification root\tALL=(ALL:ALL) ALL åœ¨åé¢æ·»åŠ ä¸€è¡Œï¼Œå£°æ˜sarkarçš„æƒé™ï¼š\n# User privilege specification root\tALL=(ALL:ALL) ALL sarkar ALL=(ALL:ALL) ALL ä¿å­˜å¹¶é€€å‡ºã€‚ç„¶åï¼š\n# chmod -w sudoers ä½¿/etc/sudoerså†æ¬¡æˆä¸ºä¸å¯å†™çš„çŠ¶æ€ã€‚\nç°åœ¨ï¼Œsarkarå°±å…·æœ‰rootæƒé™äº†ã€‚\n","href":"/posts/linux/linux%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%B9%B6%E6%8E%88%E4%BA%88root%E6%9D%83%E9%99%90%E7%9A%84%E7%AE%80%E5%8D%95%E6%96%B9%E6%B3%95/","title":"Linuxæ·»åŠ ç”¨æˆ·å¹¶æˆäºˆrootæƒé™çš„ç®€å•æ–¹æ³•"},{"content":" ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰:ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„å¼•ç”¨ã€‚\n ä»£ç†æ¨¡å¼ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡å¯ä»¥åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹ä½œç”¨ï¼Œå»æ‰å®¢æˆ·ç«¯ä¸åº”è¯¥çœ‹åˆ°çš„å†…å®¹æˆ–æœåŠ¡æˆ–è€…ç»™å®¢æˆ·ç«¯æä¾›é¢å¤–çš„æœåŠ¡ã€‚\nç»“æ„å›¾ ä»£ç†æ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\nä»ç»“æ„å›¾å¯ä»¥çœ‹å‡ºï¼Œä»£ç†æ¨¡å¼ä¸»è¦åŒ…å«3ä¸ªè§’è‰²ï¼š\n Sujectï¼ˆæŠ½è±¡ä¸»é¢˜ç±»ï¼‰ï¼šå®ƒå£°æ˜äº†çœŸå®ä¸»é¢˜å’Œä»£ç†ä¸»é¢˜å…±æœ‰çš„æ¥å£ï¼Œä¼¼çš„åœ¨ä»»ä½•ä½¿ç”¨çœŸæ˜¯ä¸»é¢˜çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨ä»£ç†ä¸»é¢˜ã€‚ RealSubjectï¼ˆçœŸå®ä¸»é¢˜ç±»ï¼‰ï¼šå®ƒå®šä¹‰äº†ä»£ç†è§’è‰²æ‰€ä»£è¡¨çš„çœŸæ˜¯å¯¹è±¡ï¼ŒåŒ…å«çœŸå®çš„ä¸šåŠ¡æ“ä½œï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ä»£ç†å¯¹è±¡é—´æ¥çš„è°ƒç”¨çœŸå®ä¸»é¢˜è§’è‰²ä¸­å®šä¹‰çš„æ“ä½œã€‚ Proxyï¼ˆä»£ç†ç±»ï¼‰ï¼šä»£ç†ç±»åŒ…å«ä¸€ä¸ªå¯¹çœŸå®ä¸»é¢˜ç±»çš„å¼•ç”¨ï¼Œä»è€Œå¯ä»¥åœ¨ä»»ä½•æ—¶å€™æ“çºµçœŸå®ä¸»é¢˜å¯¹è±¡ã€‚é€šå¸¸åœ¨ä»£ç†ç±»ä¸­ï¼Œå®¢æˆ·ç«¯åœ¨è°ƒç”¨çœŸå®ä¸»é¢˜çš„æ–¹æ³•çš„å‰åè¿˜ä¼šè¿›è¡Œä¸€äº›å…¶å®ƒçš„æ“ä½œï¼Œè¿™å¯ä»¥ç”±ä»£ç†ç±»æä¾›ã€‚  æ¨¡å¼å®ç° æ ¹æ®ä»£ç†æ¨¡å¼çš„ç»“æ„å›¾ï¼Œå¯ä»¥å†™å‡ºå¦‚ä¸‹çš„ç¤ºä¾‹ä»£ç ï¼š\n// æŠ½è±¡ä¸»é¢˜æ¥å£ public interface Subject { void request(); } // çœŸå®ä¸»é¢˜ç±» public class RealSubject implements Subject{ @Override public void request() { System.out.println(\u0026#34;Request of RealSubject instance.\u0026#34;); } } // ä»£ç†ä¸»é¢˜ç±» public class Proxy implements Subject { // ç»´æŒä¸€ä¸ªå¯¹çœŸå®ä¸»é¢˜ç±»çš„å¼•ç”¨  private RealSubject realSubject = new RealSubject(); public void preRequest(){ System.out.println(\u0026#34;PreRequest.\u0026#34;); } public void postRequest(){ System.out.println(\u0026#34;PostRequest.\u0026#34;); } @Override public void request() { preRequest(); System.out.println(\u0026#34;request of Proxy.\u0026#34;); realSubject.request(); postRequest(); } } æµ‹è¯•ç”¨çš„å®¢æˆ·ç«¯ç±»ï¼š\n// å®¢æˆ·ç«¯ç±» public class Client { public static void main(String[] args){ Proxy proxy = new Proxy(); proxy.request(); } } è¿è¡Œç»“æœï¼š\nPreRequest. request of Proxy. Request of RealSubject instance. PostRequest. å¯ä»¥å‘ç°ï¼Œå®¢æˆ·ç«¯é€šè¿‡ä»£ç†ç±»è°ƒç”¨äº†çœŸå®ä¸»é¢˜ç±»çš„æ–¹æ³•ï¼ŒåŒæ—¶è¿˜è°ƒç”¨äº†ä¸€äº›å…¶å®ƒçš„æ–¹æ³•ã€‚\nå‡ ç§å¸¸ç”¨çš„ä»£ç†  è¿œç¨‹ä»£ç†ï¼ˆRemote Proxyï¼‰: åˆç§°Ambassadorï¼Œå®ƒä¸ºä¸€ä¸ªä½äºä¸åŒåœ°å€ç©ºé—´çš„å¯¹è±¡æä¾›ä¸€ä¸ªæœ¬åœ°çš„ä»£ç†å¯¹è±¡ã€‚ è™šæ‹Ÿä»£ç†ï¼ˆVirtual Proxyï¼‰ï¼š å¦‚æœè¦åˆ›å»ºä¸€ä¸ªèµ„æºæ¶ˆè€—è¾ƒå¤§çš„å¯¹è±¡ï¼Œå¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªèµ„æºæ¶ˆè€—è¾ƒå°çš„å¯¹è±¡æ¥ä»£æ›¿ï¼ŒçœŸå®çš„å¯¹è±¡åªæœ‰åœ¨è¢«éœ€è¦çš„æ—¶å€™æ‰åˆ›å»ºã€‚ ä¿æŠ¤ä»£ç†ï¼ˆProtect Proxyï¼‰ï¼š æ§åˆ¶å¯¹ä¸€ä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œå¯ä»¥ç»™ä¸åŒçš„ç”¨æˆ·æä¾›ä¸åŒçš„åé—®æƒé™ã€‚ ç¼“å†²ä»£ç†ï¼ˆCache Procyï¼‰ï¼š ä¸ºæŸä¸€ä¸ªç›®æ ‡æ“ä½œçš„ç»“æœæä¾›å­˜å‚¨ç©ºé—´ï¼Œä¾›å¤šä¸ªå®¢æˆ·ç«¯å…±äº«ã€‚ æ™ºèƒ½å¼•ç”¨ä»£ç†ï¼ˆSmart Rererence Proxyï¼‰ï¼š å½“ä¸€ä¸ªå¯¹è±¡è¢«å¼•ç”¨çš„æ—¶å€™ï¼Œæä¾›ä¸€äº›é¢å¤–çš„æ“ä½œã€‚  æ€»ç»“ å¯ä»¥æ ¹æ®ä¸åŒçš„åº”ç”¨åœºåˆé€‰æ‹©ä¸åŒçš„ä»£ç†ç±»å‹ã€‚ä»£ç†æ¨¡å¼èƒ½å¤Ÿåè°ƒè°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç³»ç»Ÿçš„è€¦åˆè¯»ï¼Œç¬¦åˆè¿ªç±³ç‰¹æ³•åˆ™ã€‚å®¢æˆ·ç«¯å¯ä»¥é’ˆå¯¹æŠ½è±¡æ¥å£ç¼–ç¨‹ï¼Œå¢åŠ å’Œæ›´æ¢ä»£ç†ç±»æ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ï¼Œåˆ©äºç³»ç»Ÿçš„æ‰©å±•ã€‚ä¸åŒç±»å‹çš„ä»£ç†ä¸ºä¸åŒçš„åº”ç”¨åœºæ™¯æä¾›åˆé€‚çš„è§£å†³æ–¹æ¡ˆã€‚\nç”±äºä»£ç†å¯¹è±¡å‡ºç°åœ¨å®¢æˆ·ç«¯å’ŒçœŸå®å¯¹è±¡ä¹‹é—´ï¼Œè¿™åŠ å¤§äº†å®¢æˆ·ç«¯å’ŒçœŸå®å¯¹è±¡ä¹‹é—´çš„è·ç¦»ï¼Œå¯èƒ½ä¼šé™ä½è¯·æ±‚çš„å¤„ç†é€Ÿåº¦ã€‚åŒæ—¶ï¼Œä»£ç†æ¨¡å¼çš„å®ç°ä¹Ÿéœ€è¦é¢å¤–å·¥ä½œï¼Œè¿™å¯èƒ½åŠ å¤§ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚\n","href":"/notebook/reading_notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%8D%81%E4%B8%89%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/","title":"ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°ä¹‹åä¸‰ï¼šä»£ç†æ¨¡å¼"},{"content":"","href":"/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/","title":"è®¾è®¡æ¨¡å¼"},{"content":" äº«å…ƒæ¨¡å¼ï¼ˆFlyweight Patternï¼‰ï¼šè¿è¡Œå…±äº«æŠ€æœ¯æœ‰æ•ˆçš„æ”¯æŒå¤§é‡ ç»†ç²’åº¦ å¯¹è±¡çš„å¤ç”¨ï¼Œåˆç§°è½»é‡çº§æ¨¡å¼ã€‚\n äº«å…ƒæ¨¡å¼ä»¥å…±äº«çš„æ–¹å¼é«˜æ•ˆçš„æ”¯æŒå¤§é‡ç»†ç²’åº¦å¯¹è±¡çš„é‡ç”¨ã€‚å®ç°å…±äº«çš„å…³é”®æ˜¯åŒºåˆ†äº† å†…éƒ¨çŠ¶æ€ï¼ˆIntrinsic Stateï¼‰ å’Œ å¤–éƒ¨çŠ¶æ€ï¼ˆExtrinsic Stateï¼‰ ã€‚\n å†…éƒ¨çŠ¶æ€ï¼šå†…éƒ¨çŠ¶æ€æ˜¯äº«å…ƒå†…éƒ¨ä¸ä¼šéšç€å¤–éƒ¨æ¡ä»¶æ”¹å˜è€Œæ”¹å˜çš„çŠ¶æ€ï¼Œæ˜¯å¯ä»¥å…±äº«çš„ã€‚ å¤–éƒ¨çŠ¶æ€ï¼šå¤–éƒ¨çŠ¶æ€ä¼šéšç€å¤–éƒ¨æ¡ä»¶çš„æ”¹å˜è€Œæ”¹å˜çš„çŠ¶æ€ï¼Œæ˜¯ä¸å¯å…±äº«çš„ã€‚  ä¸€æ—¦åŒºåˆ†äº†å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ï¼Œå°±å¯ä»¥å°†å…·æœ‰ç›¸åŒå†…éƒ¨çŠ¶æ€çš„å¯¹è±¡å­˜å‚¨åˆ°äº«å…ƒæ± ä¸­ã€‚å½“éœ€è¦æ–°çš„å¯¹è±¡çš„æ—¶å€™ï¼Œå°±å¯ä»¥å…ˆæŸ¥çœ‹äº«å…ƒæ± ï¼Œå¦‚æœäº«å…ƒæ± æœ‰ç¬¦åˆè¦æ±‚çš„å¯¹è±¡ï¼Œå°±å¯ä»¥å°†å…¶å–å‡ºï¼Œå†æ³¨å…¥ä¸åŒçš„å¤–éƒ¨çŠ¶æ€ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ç³»åˆ—ç›¸ä¼¼çš„å¯¹è±¡ï¼Œè€Œè¿™äº›å¯¹è±¡åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä»½ã€‚\nç»“æ„å›¾ äº«å…ƒæ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š\nä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œäº«å…ƒæ¨¡å¼ä¸»è¦åŒ…å«4ä¸ªè§’è‰²ï¼š\n Flyweightï¼ˆæŠ½è±¡äº«å…ƒç±»ï¼‰ï¼šå®ƒå£°æ˜äº†å…·ä½“äº«å…ƒç±»å…±æœ‰çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥å‘å¤–éƒ¨æä¾›å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è®¾ç½®å¯¹è±¡çš„å¤–éƒ¨çŠ¶æ€ã€‚ ConcreteFlyweightï¼ˆå…·ä½“äº«å…ƒç±»ï¼‰ï¼šå®ƒå®ç°äº†Flyweightç±»å£°æ˜çš„æ–¹æ³•ï¼Œå¹¶ä¸ºå…·ä½“çš„äº«å…ƒç±»æä¾›äº†å­˜å‚¨å†…éƒ¨çŠ¶æ€éœ€è¦çš„ç©ºé—´ã€‚ UnsharedConcreteFlyweightï¼ˆéå…±äº«å…·ä½“äº«å…ƒç±»ï¼‰ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰çš„æŠ½è±¡äº«å…ƒç±»çš„å­ç±»éƒ½è¦è¢«å…±äº«ï¼Œä¸èƒ½è¢«å…±äº«çš„å­ç±»å°±æ˜¯éå…±äº«å…·ä½“äº«å…ƒç±»ã€‚å½“éœ€è¦ä¸€ä¸ªç›¸å…³å¯¹è±¡çš„æ—¶å€™ï¼Œå°±ç›´æ¥å®ä¾‹åŒ–åˆ›å»ºäº†ã€‚ FlyweightFactoryï¼ˆäº«å…ƒå·¥å‚ç±»ï¼‰ï¼šå®ƒè¢«ç”¨æ¥åˆ›å»ºå’Œç®¡ç†äº«å…ƒå¯¹è±¡ï¼Œé’ˆå¯¹FlyweightæŠ½è±¡äº«å…ƒç±»è¿›è¡Œç¼–ç¨‹ã€‚  å®é™…ä¸Šï¼Œç”±äºå…·ä½“äº«å…ƒç±»æ˜¯éœ€è¦è¢«å…±äº«çš„ï¼Œæ‰€ä»¥å¯ä»¥ç»“åˆå•ä¾‹æ¨¡å¼æ¥è®¾è®¡äº«å…ƒç±»ï¼Œä¸ºæ¯ä¸€ä¸ªäº«å…ƒç±»éƒ½æä¾›ä¸€ä¸ªå”¯ä¸€çš„äº«å…ƒå¯¹è±¡ã€‚äº«å…ƒå·¥å‚ä¸€èˆ¬ä¹Ÿæ˜¯ç»“åˆå·¥å‚æ¨¡å¼æ¥è¿›è¡Œè®¾è®¡çš„ã€‚\næ¨¡å¼å®ç° æ¥çœ‹ä¸€ä¸‹ä¸­å›½å›´æ£‹ï¼Œå›´æ£‹çš„æ£‹ç›˜ä¸Šåªæœ‰é»‘å­å’Œç™½å­ï¼Œä¸åŒçš„æ˜¯ä¸åŒæ£‹å­çš„ä½ç½®ä¸åŒï¼Œæ‰€ä»¥å¯ä»¥å°†é»‘å­å’Œç™½å­ä½œä¸ºäº«å…ƒå¯¹è±¡ï¼Œå¯¹åº”çš„åæ ‡ä½œä¸ºå¤–éƒ¨çŠ¶æ€ï¼Œä½¿ç”¨äº«å…ƒæ¨¡å¼æ¥è®¾è®¡æ£‹ç›˜ã€‚ç»“æ„å›¾å¦‚ä¸‹ï¼š\nå®ç°çš„ä»£ç å¦‚ä¸‹ï¼š\n// åæ ‡ç±» public class Coordinate { private int x; private int y; public int getX() { return x; } public int getY() { return y; } public Coordinate(){} public Coordinate(int x, int y) { this.x = x; this.y = y; } } // æŠ½è±¡æ£‹å­ç±» public abstract class GoChessman { public abstract String getColor(); public void display(Coordinate coordinate){ System.out.println(this.getColor() + \u0026#34;: (\u0026#34; + coordinate.getX() + \u0026#34;, \u0026#34; + coordinate.getY() + \u0026#34;).\u0026#34;); } } // ç™½å­ public class WhiteGoChessman extends GoChessman { @Override public String getColor() { return \u0026#34;white\u0026#34;; } } // é»‘å­ public class BlackGoChessman extends GoChessman { @Override public String getColor() { return \u0026#34;black\u0026#34;; } } // æ£‹å­å·¥å‚ public class GoChessmanFactory { private static GoChessmanFactory instance = new GoChessmanFactory(); private static HashMap\u0026lt;String, GoChessman\u0026gt; chessmanMap; private GoChessmanFactory(){ chessmanMap = new HashMap\u0026lt;\u0026gt;(); GoChessman blackGoChessman, whiteGoChessman; blackGoChessman = new BlackGoChessman(); whiteGoChessman = new WhiteGoChessman(); chessmanMap.put(\u0026#34;black\u0026#34;, blackGoChessman); chessmanMap.put(\u0026#34;white\u0026#34;, whiteGoChessman); } public static GoChessmanFactory getInstance() { return instance; } public GoChessman getGoChessman(String color){ return chessmanMap.get(color); } } æµ‹è¯•ç”¨çš„å®¢æˆ·ç«¯ä»£ç ï¼š\n// å®¢æˆ·ç«¯ public class Client { public static void main(String[] args){ // è·å–äº«å…ƒå·¥å‚å¯¹è±¡  GoChessmanFactory goChessmanFactory = GoChessmanFactory.getInstance(); // äº§ç”Ÿæ£‹å­  GoChessman black1 = goChessmanFactory.getGoChessman(\u0026#34;black\u0026#34;); GoChessman black2 = goChessmanFactory.getGoChessman(\u0026#34;black\u0026#34;); // åˆ¤æ–­ä¸¤é¢—é»‘å­æ˜¯å¦ç›¸åŒ  System.out.println(\u0026#34;black1 == black2: \u0026#34; + (black1 == black2)); // è·å–ä¸¤é¢—ç™½å­  GoChessman white1 = goChessmanFactory.getGoChessman(\u0026#34;white\u0026#34;); GoChessman white2 = goChessmanFactory.getGoChessman(\u0026#34;white\u0026#34;); // åˆ¤æ–­ä¸¤é¢—é»‘å­æ˜¯å¦ç›¸åŒ  System.out.println(\u0026#34;white1 == white2: \u0026#34; + (white1 == white2)); // è®¾ç½®åæ ‡å¹¶å±•ç¤º  black1.display(new Coordinate(1, 1)); black2.display(new Coordinate(2, 2)); white1.display(new Coordinate(3, 3)); white2.display(new Coordinate(4, 4)); } } è¿è¡Œç»“æœï¼š\nblack1 == black2: true white1 == white2: true black: (1, 1). black: (2, 2). white: (3, 3). white: (4, 4). å¯ä»¥å‘ç°ï¼šä½¿ç”¨åŒä¸€ä¸ªå…³é”®å­—ä»äº«å…ƒæ± å–å‡ºæ¥çš„å¯¹è±¡æ˜¯éƒ½æ˜¯åŒä¸€ä¸ªï¼ŒåæœŸå¯ä»¥è®¾ç½®ä¸åŒå¯¹è±¡çš„å¤–éƒ¨çŠ¶æ€ï¼Œä½¿å¾—æ‰€æœ‰çš„å¯¹è±¡å…·æœ‰å·®å¼‚ã€‚\næ€»ç»“ å½“ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡ç›¸åŒæˆ–è€…ç›¸ä¼¼çš„å¯¹è±¡çš„æ—¶å€™ï¼Œè¿™ä¼šæµªè´¹å¤§é‡çš„å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨äº«å…ƒæ¨¡å¼å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚é€šè¿‡äº«å…ƒæ± ï¼Œå¯ä»¥å®ç°ç›¸åŒæˆ–è€…ç›¸ä¼¼çš„ç»†ç²’åº¦å¯¹è±¡çš„å¤ç”¨ï¼Œè¿™èƒ½èŠ‚çœå†…å­˜ç©ºé—´ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚ç›¸åŒçš„å¯¹è±¡å› ä¸ºå†…éƒ¨çŠ¶æ€çš„ç›¸åŒè€Œç›¸åŒï¼Œç›¸ä¼¼çš„å¯¹è±¡å› ä¸ºå¤–éƒ¨çŠ¶æ€çš„ä¸åŒè€Œä¸åŒï¼Œå¹¶ä¸”å®ƒä»¬éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨äº«å…ƒæ¨¡å¼ä¼šä½¿ç³»ç»Ÿå˜å¾—å¤æ‚ï¼Œå°†å¯¹è±¡çš„éƒ¨åˆ†çŠ¶æ€å¤–éƒ¨åŒ–å¯èƒ½ä½¿å¾—ç³»ç»Ÿçš„è¿è¡Œæ—¶é—´å˜é•¿ã€‚\n","href":"/notebook/reading_notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%8D%81%E4%BA%8C%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/","title":"ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°ä¹‹åäºŒï¼šäº«å…ƒæ¨¡å¼"},{"content":" å¤–è§‚æ¨¡å¼ï¼ˆFacade Patternï¼‰ï¼šå¤–éƒ¨ä¸ä¸€ä¸ªå­ç³»ç»Ÿçš„é€šä¿¡é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å¤–è§‚è§’è‰²è¿›è¡Œï¼Œä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ã€‚å¤–è§‚æ¨¡å¼åˆç§°é—¨é¢æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä½¿å¾—å­ç³»ç»Ÿçš„ä½¿ç”¨æ›´åŠ å®¹æ˜“ã€‚\n å¤–è§‚æ¨¡å¼éšè—äº†ç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œå¹¶å‘å®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥è®¿é—®ç³»ç»Ÿçš„æ¥å£ã€‚\nç»“æ„å›¾ ä¸ºäº†æ›´å¥½çš„ç†è§£å¤–è§‚æ¨¡å¼ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹ç¤ºæ„å›¾ï¼š\nä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼šå¦‚æœæ²¡æœ‰å¤–è§‚è§’è‰²ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯éƒ½å¯èƒ½éœ€è¦å’Œå¤šä¸ªå­ç³»ç»Ÿä¹‹é—´è¿›è¡Œå¤æ‚çš„äº¤äº’ï¼Œç³»ç»Ÿçš„è€¦åˆåº¦éå¸¸å¤§ã€‚å¼•å…¥å¤–è§‚è§’è‰²facadeä¹‹åï¼Œå®¢æˆ·ç«¯å°±åªéœ€è¦å’Œå¤–è§‚è§’è‰²äº¤äº’äº†ï¼Œå¤–è§‚è§’è‰²ä»£æ›¿å®¢æˆ·ç«¯å’Œå¤šä¸ªå­ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œè¿™é™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚\nå¤–è§‚æ¨¡å¼ç»“æ„å›¾ï¼š\nä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œå¤–è§‚æ¨¡å¼ä¸»è¦åŒ…å«ä¸¤ä¸ªè§’è‰²ï¼š\n Facadeï¼ˆå¤–è§‚è§’è‰²ï¼‰ï¼šå®ƒçŸ¥é“ç›¸å…³çš„å­ç³»ç»Ÿçš„åŠŸèƒ½å’ŒèŒè´£ã€‚å®¢æˆ·ç«¯è°ƒç”¨å®ƒçš„æ–¹æ³•çš„æ—¶å€™ï¼Œå®ƒé€šå¸¸ä¼šæŠŠå®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚å§”æ´¾åˆ°ç›¸åº”çš„å­ç³»ç»Ÿä¸­å»ï¼Œç”±å­ç³»ç»Ÿçš„å¯¹è±¡è¿›è¡Œå¤„ç†ã€‚ Systemï¼ˆå­ç³»ç»Ÿè§’è‰²ï¼‰ï¼šå®ƒä»¬è¢«å¤–è§‚è§’è‰²æˆ–è€…å®¢æˆ·ç«¯è°ƒç”¨ã€‚å®é™…ä¸Šï¼Œå­ç³»ç»Ÿå¹¶ä¸çŸ¥é“å¤–è§‚è§’è‰²çš„å­˜åœ¨ï¼Œå¤–è§‚è§’è‰²å¯¹å¥¹ä»¬æ¥è¯´å°±æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯è€Œå·²ã€‚  æ¨¡å¼å®ç° æ ¹æ®ç»“æ„å›¾å¯ä»¥å†™å‡ºä¸‹é¢çš„ç¤ºä¾‹ä»£ç ï¼š\n// å­ç³»ç»Ÿæ¥å£ public interface Subsystem { void method(); } // å­ç³»ç»ŸA public class SystemA implements Subsystem { @Override public void method() { System.out.println(\u0026#34;è°ƒç”¨systemAçš„æ–¹æ³•\u0026#34;); } } // å­ç³»ç»ŸB public class SystemB implements Subsystem { @Override public void method() { System.out.println(\u0026#34;è°ƒç”¨systemBçš„æ–¹æ³•\u0026#34;); } } // å­ç³»ç»ŸC public class SystemC implements Subsystem { @Override public void method() { System.out.println(\u0026#34;è°ƒç”¨systemCçš„æ–¹æ³•\u0026#34;); } } // å¤–è§‚ç±» public class Facade { private Subsystem systemA; private Subsystem systemB; private Subsystem systemC; public Facade(){ System.out.println(\u0026#34;è°ƒç”¨å¤–è§‚ç±»çš„æ–¹æ³•\u0026#34;); systemA = new SystemA(); systemB = new SystemB(); systemC = new SystemC(); } public void method(){ systemA.method(); systemB.method(); systemC.method(); } } æµ‹è¯•ç”¨çš„å®¢æˆ·ç«¯ç±»ï¼š\n// å®¢æˆ·ç«¯ç±» public class Client { public static void main(String[] args){ Facade facade = new Facade(); facade.method(); } } è¿è¡Œç»“æœï¼š\nè°ƒç”¨å¤–è§‚ç±»çš„æ–¹æ³• è°ƒç”¨systemAçš„æ–¹æ³• è°ƒç”¨systemBçš„æ–¹æ³• è°ƒç”¨systemCçš„æ–¹æ³• å¯ä»¥å‘ç°ï¼Œå®¢æˆ·ç«¯é€šè¿‡å¤–è§‚è§’è‰²è°ƒç”¨äº†å­ç³»ç»Ÿçš„åŠŸèƒ½ã€‚\næ€»ç»“ å¤–è§‚æ¨¡å¼çš„ä¸»è¦ç›®çš„åœ¨äºé™ä½ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚é€šè¿‡å¼•å…¥å¤–è§‚è§’è‰²ï¼Œç®€åŒ–äº†å®¢æˆ·ç«¯ä¸å­ç³»ç»Ÿä¹‹é—´çš„äº¤äº’ï¼Œä¸ºå¤æ‚å­ç³»ç»Ÿçš„è°ƒç”¨æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œä½¿å¾—å­ç³»ç»Ÿå’Œå®¢æˆ·ç«¯ä¹‹é—´çš„è€¦åˆåº¦é™ä½äº†ï¼Œä½†è¿™å¹¶ä¸å½±å“å­å®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨å­ç³»ç»Ÿçš„ç›®çš„ã€‚ä¸€ä¸ªå­ç³»ç»Ÿçš„ä¿®æ”¹ä¸ä¼šå½±å“åˆ°å…¶å®ƒçš„å­ç³»ç»Ÿï¼Œå­ç³»ç»Ÿçš„å†…éƒ¨å˜åŒ–ä¹Ÿä¸ä¼šå½±å“åˆ°å¤–è§‚å¯¹è±¡ã€‚\nä¸è¿‡ï¼Œå¤–è§‚æ¨¡å¼ä¸èƒ½å¾ˆå¥½çš„é™åˆ¶å®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨å­ç³»ç»Ÿç±»ã€‚å¦‚æœè®¾è®¡ä¸å½“ï¼Œå¢åŠ æ–°çš„å­ç³»ç»Ÿå¯èƒ½ä¼šå¯¼è‡´å¤–è§‚ç±»æºä»£ç çš„ä¿®æ”¹ï¼Œè¿™å°†è¿åå¼€é—­åŸåˆ™ã€‚\n","href":"/notebook/reading_notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%8D%81%E4%B8%80%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/","title":"ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°ä¹‹åä¸€ï¼šå¤–è§‚æ¨¡å¼"},{"content":" è£…é¥°æ¨¡å¼ï¼ˆDecotator Patternï¼‰ï¼šåŠ¨æ€çš„ç»™ä¸€ä¸ªå¯¹è±¡å¢åŠ ä¸€äº›é¢å¤–çš„èŒè´£ï¼Œå°±å¢åŠ å¯¹è±¡åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°æ¨¡å¼æ¯”ç”Ÿæˆå­ç±»å®ç°æ›´åŠ çµæ´»ã€‚\n è£…é¥°æ¨¡å¼å…è®¸å‘ä¸€ä¸ªç°æœ‰çš„å¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½è€Œåˆä¸æ”¹å˜å…¶ç»“æ„ã€‚\nç»“æ„å›¾ è£…é¥°æ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\nä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè£…é¥°æ¨¡å¼ä¸»è¦åŒ…å«4ä¸ªè§’è‰²ï¼š\n Componentï¼ˆæŠ½è±¡æ„ä»¶ç±»ï¼‰ï¼šå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå£°æ˜äº†åœ¨å…·ä½“æ„ä»¶ç±»ä¸­çš„ä¸šåŠ¡æ–¹æ³•ã€‚å…·ä½“æ„ä»¶ç±»å’ŒæŠ½è±¡è£…é¥°ç±»éƒ½å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥ä¸€è‡´å¯¹å¾…è£…é¥°å‰çš„å¯¹è±¡å’Œè£…é¥°åçš„å¯¹è±¡ã€‚æŠ½è±¡æ„ä»¶ç±»ä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»ã€‚ ConcreteComponentï¼ˆå…·ä½“æ„ä»¶ç±»ï¼‰ï¼šå®ƒå®ç°äº† Component æ¥å£ï¼Œå®šä¹‰ç±»å…·ä½“çš„æ„ä»¶ã€‚è£…é¥°å™¨ç±»å¯ä»¥ç»™å®ƒå¢åŠ é¢å¤–çš„èŒèƒ½ã€‚ Decotatorï¼ˆæŠ½è±¡è£…é¥°ç±»ï¼‰ï¼šå®ƒä¹Ÿå®ç°äº† Component æ¥å£ï¼Œæ˜¯æ•´ä¸ªæ¨¡å¼çš„æ ¸å¿ƒã€‚å®ƒç”¨æ¥ç»™å…·ä½“æ„ä»¶ç±»å¢åŠ èŒè´£ï¼Œä½†æ˜¯å…·ä½“çš„èŒè´£å°†åœ¨å­ç±»ä¸­å®ç°ã€‚åŒæ—¶ï¼Œä»–ç»´æŠ¤äº†ä¸€ä¸ªå¯¹Componentçš„å¼•ç”¨ï¼Œé€šè¿‡è¿™ä¸ªå¼•ç”¨å¯ä»¥è°ƒç”¨è£…é¥°å‰çš„å¯¹è±¡çš„æ–¹æ³•ï¼Œé€šè¿‡å­ç±»æ‰©å±•è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥è¾¾åˆ°è£…é¥°çš„ç›®çš„ã€‚ ConcreteDecoratorï¼ˆå…·ä½“è£…é¥°ç±»ï¼‰ï¼šå®ƒç»§æ‰¿äº†æŠ½è±¡è£…é¥°ç±»ï¼Œè´Ÿè´£ç»™æ„ä»¶æ·»åŠ æ–°çš„èŒè´£ã€‚æ¯ä¸€ä¸ªå…·ä½“è£…é¥°ç±»éƒ½å®šä¹‰äº†æ–°çš„èŒè´£ï¼Œå¯ä»¥ç»™å¯¹è±¡æ‰©å……èŒè´£ã€‚  æ¨¡å¼å®ç° // æŠ½è±¡æ„ä»¶æ¥å£ public interface Component { void operation(); } // å…·ä½“æ„ä»¶ç±» public class ConcreteComponent implements Component { @Override public void operation() { System.out.println(\u0026#34;è°ƒç”¨åŸæœ‰çš„åŠŸèƒ½\u0026#34;); } } // æŠ½è±¡è£…é¥°ç±» public abstract class Decorator implements Component{ protected Component component; // ç»´æŒä¸€ä¸ªå¯¹Componentå¯¹è±¡çš„å¼•ç”¨  public Decorator(Component component){ this.component = component; } public void operation(){ component.operation(); // è°ƒç”¨åŸæœ‰ä¸šåŠ¡æ–¹æ³•  } } // å…·ä½“è£…é¥°ç±» public class ConcreteDecorator extends Decorator { public ConcreteDecorator(Component component) { super(component); } public void operation(){ super.operation(); // è°ƒç”¨åŸæœ‰ä¸šåŠ¡æ–¹æ³•  addBehavior(); // è°ƒç”¨æ–°å¢æ–¹æ³•  } // æ–°å¢æ–¹æ³•  private void addBehavior(){ System.out.println(\u0026#34;å¢åŠ æ–°åŠŸèƒ½\u0026#34;); } } æµ‹è¯•çš„å®¢æˆ·ç«¯ä»£ç ï¼š\n// å®¢æˆ·ç«¯ç±» public class Client { public static void main(String[] args){ Component component1 = new ConcreteComponent(); Component component2 = new ConcreteDecorator(component1); // ç”¨component2è£…é¥°component1  component2.operation(); } } è¿è¡Œç»“æœï¼š\nè°ƒç”¨åŸæœ‰çš„åŠŸèƒ½ å¢åŠ æ–°åŠŸèƒ½ å¯ä»¥å‘ç°ï¼šç”±äºå…·ä½“æ„ä»¶ç±»å’Œè£…é¥°ç±»éƒ½å®ç°äº†ç›¸åŒçš„æŠ½è±¡æ„ä»¶æ¥å£ï¼Œè£…é¥°æ¨¡å¼èƒ½å¤Ÿä»¥å¯¹å®¢æˆ·ç«¯é€æ˜çš„æ–¹å¼ åŠ¨æ€ çš„ç»™å¯¹è±¡æ·»åŠ èŒè´£ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå¯Ÿè§‰åˆ°å¯¹è±¡åœ¨è£…é¥°å‰åçš„ä¸åŒã€‚\næ€»ç»“ è£…é¥°æ¨¡å¼é™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ï¼Œå¯ä»¥åŠ¨æ€çš„ç»™å¯¹è±¡å¢åŠ æˆ–åˆ é™¤èŒè´£ï¼Œä½¿å¾—éœ€è¦è£…é¥°çš„å…·ä½“æ„ä»¶ç±»å’Œå…·ä½“è£…é¥°ç±»å¯ä»¥ç‹¬ç«‹çš„å˜åŒ–ï¼Œéå¸¸æœ‰åˆ©äºç³»ç»Ÿçš„æ‰©å±•ã€‚\nåœ¨æ‰©å±•å¯¹è±¡åŠŸèƒ½çš„æ—¶å€™ï¼Œä½¿ç”¨ç»„åˆæ–¹å¼çš„è£…é¥°æ¨¡å¼æ¯”ç»§æ‰¿æ›´åŠ çµæ´»ï¼Œä¸ä¼šå¯¼è‡´ç³»ç»Ÿä¸­ç±»çš„è¿…é€Ÿå¢åŠ ï¼Œè€Œä¸”å¯ä»¥å¯¹ä¸€ä¸ªç±»è¿›è¡Œå¤šæ¬¡è£…é¥°ï¼Œè¿™èƒ½å¾—åˆ°åŠŸèƒ½æ›´åŠ å¼ºå¤§çš„å¯¹è±¡ã€‚\nä½†æ˜¯ï¼Œä½¿ç”¨è£…é¥°æ¨¡å¼çš„æ—¶å€™ï¼Œç³»ç»Ÿä¸­ä¼šäº§ç”Ÿå¾ˆå¤šå°å¯¹è±¡ï¼Œå¤§é‡çš„å°å¯¹è±¡ä¼šå ç”¨æ›´å¤šçš„ç³»ç»Ÿèµ„æºã€‚è€Œä¸”ï¼Œè£…é¥°æ¨¡å¼æ¯”ç»§æ‰¿æ›´ä¸ºå¤æ‚ã€‚\n","href":"/notebook/reading_notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%8D%81%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F/","title":"ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°ä¹‹åï¼šè£…é¥°æ¨¡å¼"},{"content":" ç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰ï¼šç»„åˆå¤šä¸ªå¯¹è±¡å½¢æˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºå…·æœ‰â€œæ•´ä½“-éƒ¨åˆ†â€å…³ç³»çš„å±‚æ¬¡ç»“æ„ã€‚ç»„åˆæ¨¡å¼å¯¹å•ä¸ªå¯¹è±¡ï¼ˆå¶å­å¯¹è±¡ï¼‰å’Œç»„åˆå¯¹è±¡ï¼ˆå®¹å™¨å¯¹è±¡ï¼‰çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚ç»„åˆæ¨¡å¼åˆç§°â€œæ•´ä½“-éƒ¨åˆ†â€ï¼ˆPart-Wholeï¼‰æ¨¡å¼ã€‚\n ä½¿ç”¨ç»„åˆæ¨¡å¼ï¼Œå®¢æˆ·ç«¯å¯ä»¥åƒå¤„ç†ç®€å•å…ƒç´ ä¸€æ ·å¤„ç†å¤æ‚å…ƒç´ ï¼Œèƒ½å¤Ÿé™ä½å®¢æˆ·ç«¯å’Œå¤æ‚å…ƒç´ å†…éƒ¨çš„è€¦åˆåº¦ã€‚\nç»“æ„å›¾ ç»„åˆæ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\nä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œç»„åˆæ¨¡å¼ä¸»è¦åŒ…å«3ä¸ªè§’è‰²ï¼š\n Componentï¼ˆæŠ½è±¡æ„ä»¶ç±»ï¼‰ï¼šå®ƒä¸ºå¶å­æ„ä»¶å’Œå®¹å™¨æ„ä»¶å£°æ˜äº†ç”¨æ¥è®¿é—®åŠç®¡ç†å­æ„ä»¶çš„æ¥å£ï¼Œå®ƒä¹Ÿå¯ä»¥åŒ…å«æ‰€æœ‰å­ç±»å…¬å…±æ¥å£çš„å£°æ˜å’Œå®ç°ã€‚å®ƒä¹Ÿå¯ä»¥æ˜¯æ¥å£å’Œå…·ä½“çš„ç±»ã€‚ Leafï¼ˆå¶å­æ„ä»¶ç±»ï¼‰ï¼šå®ƒæ˜¯å®¹å™¨æ ‘ä¸­çš„å¶å­èŠ‚ç‚¹ï¼Œæ²¡æœ‰å­èŠ‚ç‚¹ã€‚å› æ­¤ï¼Œå®ƒå®ç°äº†æŠ½è±¡æ„ä»¶ç±»ä¸­å®šä¹‰çš„æ¥å£ã€‚å¯ä»¥é€šè¿‡ç‰¹æ®Šæ–¹å¼å¤„ç†é‚£äº›è°ƒç”¨è®¿é—®åŠç®¡ç†å­æ„ä»¶çš„è¡Œä¸ºã€‚ Compositeï¼ˆå®¹å™¨æ„ä»¶ç±»ï¼‰ï¼šå®ƒæ˜¯å®¹å™¨æ ‘ä¸­çš„éå¶å­èŠ‚ç‚¹ï¼Œå®ƒå¯ä»¥åŒ…å«å¶å­èŠ‚ç‚¹å’Œå®¹å™¨èŠ‚ç‚¹ã€‚å› æ­¤ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé›†åˆç”¨æ¥ç®¡ç†å­æ„ä»¶ã€‚å®ƒä¹Ÿå®ç°äº†æŠ½è±¡æ„ä»¶ç±»ä¸­å®šä¹‰çš„æ¥å£ï¼Œåœ¨å…¶ä¸šåŠ¡æ–¹æ³•ä¸­å¯ä»¥é€’å½’çš„è°ƒç”¨å­èŠ‚ç‚¹çš„ä¸šåŠ¡æ–¹æ³•ã€‚  æ¨¡å¼å®ç° æ ¹æ®ç»“æ„å›¾ï¼Œå¯ä»¥å†™å‡ºä¸‹é¢çš„ç®€å•å®ç°ä»£ç ï¼š\n// æŠ½è±¡æ„ä»¶ç±» public abstract class Component { public abstract void add(Component c); // æ·»åŠ å…ƒç´   public abstract void remove(Component c); // ç§»é™¤å…ƒç´   public abstract Component getChild(int i); // è·å–å­èŠ‚ç‚¹  public abstract void operation(); // ä¸šåŠ¡æ–¹æ³• } / å¶å­æ„ä»¶ç±» public class Leaf extends Component { @Override public void add(Component c) { } @Override public void remove(Component c) { } @Override public Component getChild(int i) { return null; } @Override public void operation() { System.out.println(\u0026#34;è°ƒç”¨å¶å­æ„ä»¶çš„ä¸šåŠ¡æ–¹æ³•\u0026#34;); } } // å®¹å™¨æ„ä»¶ç±» public class Composite extends Component { private ArrayList\u0026lt;Component\u0026gt; children = new ArrayList\u0026lt;\u0026gt;(); @Override public void add(Component c) { children.add(c); } @Override public void remove(Component c) { children.remove(c); } @Override public Component getChild(int i) { return children.get(i); } @Override public void operation() { System.out.println(\u0026#34;è°ƒç”¨å®¹å™¨æ„ä»¶çš„ä¸šåŠ¡æ–¹æ³• -\u0026gt; é€’å½’è°ƒç”¨å­æ„ä»¶çš„ä¸šåŠ¡æ–¹æ³•\u0026#34;); for(Component child: children){ child.operation(); } } } æµ‹è¯•ç”¨çš„å®¢æˆ·ç«¯ç±»ï¼š\n// å®¢æˆ·ç«¯ç±» public class Client { public static void main(String[] args){ Component leaf1, leaf2, composite1, composite2; leaf1 = new Leaf(); leaf2 = new Leaf(); composite1 = new Composite(); composite2 = new Composite(); composite1.add(leaf1); composite1.add(composite2); composite2.add(leaf2); composite1.operation(); } } è¿è¡Œç»“æœï¼š\nè°ƒç”¨å®¹å™¨æ„ä»¶çš„ä¸šåŠ¡æ–¹æ³• -\u0026gt; é€’å½’è°ƒç”¨å­æ„ä»¶çš„ä¸šåŠ¡æ–¹æ³• è°ƒç”¨å¶å­æ„ä»¶çš„ä¸šåŠ¡æ–¹æ³• è°ƒç”¨å®¹å™¨æ„ä»¶çš„ä¸šåŠ¡æ–¹æ³• -\u0026gt; é€’å½’è°ƒç”¨å­æ„ä»¶çš„ä¸šåŠ¡æ–¹æ³• è°ƒç”¨å¶å­æ„ä»¶çš„ä¸šåŠ¡æ–¹æ³• å¯ä»¥çœ‹å‡º: composite1 æ˜¯ä¸€ä¸ªå®¹å™¨æ„ä»¶ï¼Œå®ƒå…·æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹â€”â€”ä¸€ä¸ªå¶å­èŠ‚ç‚¹ leaf1 å’Œä¸€ä¸ªå®¹å™¨èŠ‚ç‚¹ composite2 ã€‚ composite2 åˆå…·æœ‰ä¸€ä¸ªå¶å­èŠ‚ç‚¹ã€‚è°ƒç”¨ composite1 çš„ä¸šåŠ¡æ–¹æ³•ä¼šä¾æ¬¡é€’å½’è°ƒç”¨å…¶å­æ„ä»¶çš„ä¸šåŠ¡æ–¹æ³•ã€‚\né€æ˜ç»„åˆæ¨¡å¼å’Œå®‰å…¨ç»„åˆæ¨¡å¼ æŒ‰ç…§æŠ½è±¡æ„ä»¶ç±»çš„å®šä¹‰å½¢å¼ï¼Œå¯ä»¥å°†ç»„åˆæ¨¡å¼åˆ†ä¸ºé€æ˜ç»„åˆæ¨¡å¼å’Œå®‰å…¨ç»„åˆæ¨¡å¼ã€‚\né€æ˜ç»„åˆæ¨¡å¼ é€æ˜ç»„åˆæ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\nå¯ä»¥çœ‹å‡ºï¼šé€æ˜ç»„åˆæ¨¡å¼ä¸­ï¼ŒæŠ½è±¡æ„ä»¶ç±»å£°æ˜äº†æ‰€æœ‰ç”¨äºç®¡ç†æˆå‘˜å¯¹è±¡çš„æ–¹æ³•ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰çš„æ„ä»¶ç±»éƒ½å…·æœ‰ç›¸åŒçš„æ¥å£ï¼Œå®¢æˆ·ç«¯å¯ä»¥é’ˆå¯¹æ¥å£ç¼–ç¨‹ã€‚ä»å®¢æˆ·ç«¯çš„è§’åº¦çœ‹ï¼Œå¶å­æ„ä»¶å’Œå®¹å™¨æ„ä»¶æ˜¯ç›¸åŒçš„ï¼Œå¯ä»¥åŒæ ·å¯¹å¾…ã€‚é€æ˜ç»„åˆæ¨¡å¼çš„ç¼ºç‚¹å°±æ˜¯ ä¸å¤Ÿå®‰å…¨ ï¼Œå› ä¸ºå¶å­æ„ä»¶å’Œå®¹å™¨æ„ä»¶æœ¬è´¨ä¸Šæ˜¯æœ‰åŒºåˆ«çš„ã€‚å¶å­æ„ä»¶ä¸å¯èƒ½å…·æœ‰å­æ„ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šè°ƒç”¨å¶å­æ„ä»¶ä¸­å…³äºå­æ„ä»¶çš„æ–¹æ³•å¯èƒ½å¯¼è‡´é—®é¢˜ã€‚\nå®‰å…¨ç»„åˆæ¨¡å¼ å®‰å…¨ç»„åˆæ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\nå¯ä»¥çœ‹å‡ºï¼šå®‰å…¨ç»„åˆæ¨¡å¼ä¸­ï¼ŒæŠ½è±¡æ„ä»¶ç±»æ²¡æœ‰å£°æ˜ä»»ä½•ç”¨äºç®¡ç†æˆå‘˜å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨Compositeç±»ä¸­å£°æ˜å¹¶å®ç°è¿™äº›æ–¹æ³•ã€‚å¯¹äºå¶å­æ„ä»¶çš„å®ä¾‹æ¥è¯´ï¼Œå°±æ— æ³•è°ƒç”¨åˆ°è¿™äº›æ–¹æ³•ï¼Œè¿™æ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯ï¼Œå®‰å…¨ç»„åˆæ˜¯ä¸å¤Ÿé€æ˜çš„ï¼Œå› ä¸ºå¶å­æ„ä»¶å’Œå®¹å™¨æ„ä»¶å…·æœ‰ä¸åŒçš„æ–¹æ³•ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸èƒ½é¢å‘æŠ½è±¡æ„ä»¶ç±»ç¼–ç¨‹ã€‚\næ€»ç»“ ç»„åˆæ¨¡å¼ä¸»è¦ç”¨åœ¨å…·æœ‰ æ•´ä½“-éƒ¨åˆ† ç»“æ„çš„å±‚æ¬¡ç»“æ„ä¸­ï¼Œå¯ä»¥ä¸€è‡´æ€§å¯¹å¾…æ•´ä½“å’Œéƒ¨åˆ†ï¼Œè¿™ä¸€èˆ¬æ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚ä½¿ç”¨ç»„åˆæ¨¡å¼ï¼Œå¯ä»¥æ¸…æ¥šçš„å®šä¹‰åˆ†å±‚æ¬¡çš„å¤æ‚å¯¹è±¡ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥å¿½ç•¥å±‚æ¬¡ä¹‹é—´çš„å·®å¼‚ï¼Œæ–¹ä¾¿å¯¹æ•´ä¸ªç»“æ„è¿›è¡Œæ§åˆ¶ï¼Œç®€åŒ–æ“ä½œã€‚åœ¨ç»„åˆæ¨¡å¼ä¸­å¢åŠ æ–°çš„å¶å­æ„ä»¶å’Œå®¹å™¨æ„ä»¶éå¸¸æ–¹ä¾¿ï¼Œä¸ç”¨ä¿®æ”¹å·²æœ‰ä»£ç ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚ä½†æ˜¯ï¼Œç»„åˆæ¨¡å¼å¾ˆéš¾åœ¨å¢åŠ æ–°æ„ä»¶çš„æ—¶å€™å¯¹æ„ä»¶çš„ç±»å‹è¿›è¡Œé™åˆ¶ã€‚\n","href":"/notebook/reading_notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%B9%9D%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/","title":"ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°ä¹‹ä¹ï¼šç»„åˆæ¨¡å¼"},{"content":" æ¡¥æ¥æ¨¡å¼ï¼ˆBridge Patternï¼‰ï¼šå°†ç±»çš„åŠŸèƒ½å±‚æ¬¡ç»“æ„ï¼ˆæŠ½è±¡éƒ¨åˆ†ï¼‰å’Œå®ç°å±‚æ¬¡ç»“æ„ï¼ˆå®ç°éƒ¨åˆ†ï¼‰åˆ†ç¦»ï¼Œä½¿äºŒè€…èƒ½å¤Ÿ ç‹¬ç«‹ çš„å˜åŒ–ï¼Œå¹¶åœ¨äºŒè€…ä¹‹é—´æ­å»ºæ¡¥æ¢ï¼Œå®ç°æ¡¥æ¥ã€‚\n å¦‚æœç³»ç»Ÿä¸­å­˜åœ¨ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œé€šè¿‡æ¡¥æ¥æ¨¡å¼å°±å¯ä»¥å°†è¿™ä¸¤ä¸ªç»´åº¦åˆ†ç¦»å‡ºæ¥ï¼Œä½¿äºŒè€…å¯ä»¥ç‹¬ç«‹çš„æ‰©å±•ã€‚\nç»“æ„å›¾ æ¡¥æ¥æ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\nä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¡¥æ¥æ¨¡å¼ä¸»è¦åŒ…å«4ä¸ªè§’è‰²ï¼š\n Abstractionï¼ˆæŠ½è±¡ç±»ï¼‰ï¼šæŠ½è±¡ç±»ç”¨æ¥å®šä¹‰æ¥å£ï¼Œå…¶ä¸­ç»´æŠ¤äº†ä¸€ä¸ªImplementorç±»å‹çš„å¯¹è±¡ï¼› RefinedAbstractionï¼ˆæ‰©å……æŠ½è±¡ç±»ï¼‰ï¼šå®ƒæ‰©å……äº†ç”±Abstractionå®šä¹‰çš„æ¥å£ï¼Œå®ç°äº†Abstractionä¸­å£°æ˜çš„æ–¹æ³•ï¼Œå¹¶å¯ä»¥è°ƒç”¨Implementorçš„æ–¹æ³•ï¼› Implementorï¼ˆå®ç°ç±»æ¥å£ï¼‰ï¼šå®ƒå£°æ˜äº†åŸºæœ¬æ“ä½œçš„æ¥å£ï¼› ConcreteImplementorï¼ˆå…·ä½“å®ç°ç±»ï¼‰ï¼šå®ƒå®ç°äº†Implementorä¸­å£°æ˜çš„æ¥å£ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå®ƒå°†æ›¿ä»£Implementoræä¾›ç»™Abstractionå…·ä½“çš„ä¸šåŠ¡æ“ä½œæ–¹æ³•ï¼›  æ¨¡å¼å®ç° å‡è®¾æˆ‘ä»¬è¦å¼€å‘ä¸€ä¸ªç»˜å›¾ç³»ç»Ÿï¼Œå®ƒèƒ½å¤Ÿä½¿ç”¨çº¢ã€ç»¿ã€è“ä¸‰ç§ä¸åŒçš„é¢œè‰²ç»˜åˆ¶åœ†å½¢ã€æ­£æ–¹å½¢å’Œä¸‰è§’å½¢ã€‚å¾ˆå®¹æ˜“å‘ç°è¿™é‡Œé¢æœ‰ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œå¯ä»¥ä½¿ç”¨æ¡¥æ¥æ¨¡å¼æ¥è¿›è¡Œè®¾è®¡ã€‚å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ç»“æ„å›¾ï¼š\näºæ˜¯å¯ä»¥å†™å‡ºä¸‹é¢çš„ç¤ºä¾‹ä»£ç ï¼š\næŠ½è±¡é¢œè‰²æ¥å£ï¼š\n// é¢œè‰²æ¥å£ public interface Color { void paint(); } å…·ä½“é¢œè‰²ç±»ï¼š\n// çº¢è‰² public class Red implements Color{ @Override public void paint() { System.out.println(\u0026#34;ä½¿ç”¨çº¢è‰²ç»˜å›¾\u0026#34;); } } // ç»¿è‰² public class Green implements Color { @Override public void paint() { System.out.println(\u0026#34;ä½¿ç”¨ç»¿è‰²ç»˜å›¾\u0026#34;); } } // è“è‰² public class Blue implements Color { @Override public void paint() { System.out.println(\u0026#34;ä½¿ç”¨è“è‰²ç»˜å›¾\u0026#34;); } } æŠ½è±¡å½¢çŠ¶ç±»ï¼š\n// å½¢çŠ¶æ¥å£ public abstract class Shape { protected Color color; protected Shape(Color color){ this.color = color; } public abstract void draw(); } å…·ä½“å½¢çŠ¶ç±»ï¼š\n// åœ†å½¢ public class Circle extends Shape { public Circle(Color color) { super(color); } @Override public void draw() { color.paint(); System.out.println(\u0026#34;ç»˜åˆ¶åœ†å½¢\u0026#34;); } } // æ­£æ–¹å½¢ public class Square extends Shape { public Square(Color color) { super(color); } @Override public void draw() { color.paint(); System.out.println(\u0026#34;ç»˜åˆ¶æ­£æ–¹å½¢\u0026#34;); } } // ä¸‰è§’å½¢ public class Triangle extends Shape { public Triangle(Color color) { super(color); } @Override public void draw() { color.paint(); System.out.println(\u0026#34;ç»˜åˆ¶ä¸‰è§’å½¢\u0026#34;); } } æµ‹è¯•ç”¨çš„å®¢æˆ·ç«¯ç±»ï¼š\n// å®¢æˆ·ç«¯ public class Client { public static void main(String[] args){ Color color = new Red(); Shape shape = new Circle(color); shape.draw(); color = new Green(); shape = new Triangle(color); shape.draw(); color = new Blue(); shape = new Square(color); shape.draw(); } } è¿è¡Œç»“æœï¼š\nä½¿ç”¨çº¢è‰²ç»˜å›¾ ç»˜åˆ¶åœ†å½¢ ä½¿ç”¨ç»¿è‰²ç»˜å›¾ ç»˜åˆ¶ä¸‰è§’å½¢ ä½¿ç”¨è“è‰²ç»˜å›¾ ç»˜åˆ¶æ­£æ–¹å½¢ æ€»ç»“ åœ¨è¿›è¡Œè½¯ä»¶è®¾è®¡çš„æ—¶å€™ï¼Œå¦‚æœç³»ç»Ÿä¸­æœ‰ä¸¤ä¸ªæˆ–è€…å¤šä¸ªå˜åŒ–çš„ç»´åº¦çš„æ—¶å€™ï¼Œéƒ½å¯ä»¥å°è¯•ä½¿ç”¨æ¡¥æ¥æ¨¡å¼æ¥è¿›è¡Œè®¾è®¡ã€‚é€šè¿‡åœ¨æŠ½è±¡å±‚ä¹‹é—´å»ºç«‹å…³ç³»ï¼Œå¯ä»¥é¿å…å±‚é—´é™æ€ç»§æ‰¿ç»“æ„ï¼ˆå¤šå±‚ç»§æ‰¿å¸¸å¸¸è¿åå•ä¸€æŒ‡èŒè´£åŸåˆ™ï¼‰çš„å‡ºç°ï¼Œè¿˜èƒ½å¤Ÿæ¾è€¦åˆæŠ½è±¡å’Œå®ç°ä¹‹é—´çš„å…³ç³»ã€‚åˆ†ç¦»å‡ºæ¥çš„å„ä¸ªç»´åº¦å¯ä»¥ç‹¬ç«‹çš„å˜åŒ–ï¼Œæœ‰åˆ©äºå•ç‹¬è¿›è¡Œæ‰©å±•ã€‚ä¸è¿‡ï¼Œä½¿ç”¨æ¡¥æ¥æ¨¡å¼ä¼šå¢åŠ ç³»ç»Ÿçš„ç†è§£ä¸è®¾è®¡éš¾åº¦ï¼Œéœ€è¦è¯†åˆ«å‡ºç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œä½¿ç”¨èŒƒå›´ä¹Ÿæœ‰ä¸€å®šçš„å±€é™æ€§ã€‚\n","href":"/notebook/reading_notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%85%AB%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/","title":"ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°ä¹‹å…«ï¼šæ¡¥æ¥æ¨¡å¼"},{"content":" é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰ï¼šå°†ä¸€ä¸ªæ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä½¿æ¥å£ä¸å…¼å®¹çš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œï¼Œåˆç§°åŒ…è£…å™¨ï¼ˆWrapperï¼‰ã€‚\n é€‚é…å™¨æ¨¡å¼çš„ç›®æ ‡å°±æ˜¯åœ¨ä¸ä¿®æ”¹åŸæœ‰é€‚é…è€…æ¥å£å’ŒæŠ½è±¡ç›®æ ‡ç±»æ¥å£çš„å‰æä¸‹ï¼Œå°†ä¸€ä¸ªç±»çš„æ¥å£å’Œå¦ä¸€ä¸ªç±»çš„æ¥å£åŒ¹é…èµ·æ¥ã€‚æ ¹æ®é€‚é…å™¨æœ‰é€‚é…è€…çš„å…³ç³»çš„ä¸åŒï¼Œé€‚é…å™¨æ¨¡å¼åˆåˆ†ä¸º å¯¹è±¡é€‚é…å™¨æ¨¡å¼ å’Œ_ç±»é€‚é…å™¨æ¨¡å¼_ ã€‚\nå¯¹è±¡é€‚é…å™¨æ¨¡å¼  åœ¨å¯¹è±¡é€‚é…å™¨æ¨¡å¼ä¸­ï¼Œé€‚é…å™¨ä¸é€‚é…è€…ä¹‹é—´æ˜¯ å…³è” å…³ç³»ã€‚\n ç»“æ„å›¾ å¯¹è±¡é€‚é…å™¨æ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¯¹è±¡é€‚é…å™¨æ¨¡å¼ä¸»è¦åŒ…å«3ä¸ªè§’è‰²ï¼š\n Targetï¼ˆç›®æ ‡æŠ½è±¡æ¥å£ï¼‰ï¼šå®ƒå®šä¹‰äº†å®¢æˆ·ç«¯æ‰€éœ€è¦çš„æ¥å£ã€‚å®ƒä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»æˆ–è€…å…·ä½“ç±»ï¼› Adapteeï¼ˆé€‚é…è€…ç±»ï¼‰ï¼šå®ƒæ˜¯è¢«é€‚é…çš„è§’è‰²ï¼ŒåŒ…å«äº†å®¢æˆ·ç«¯å¸Œæœ›ä½¿ç”¨çš„ä¸šåŠ¡æ–¹æ³•ï¼Œä½†æ˜¯å®¢æˆ·ç«¯åˆä¸èƒ½è°ƒç”¨ï¼Œéœ€è¦è¿›è¡Œé€‚é…ã€‚ Adapterï¼ˆé€‚é…å™¨ç±»ï¼‰ï¼šå®ƒæ˜¯é€‚é…å™¨æ¨¡å¼çš„æ ¸å¿ƒï¼Œé€šè¿‡å®ƒæ¥å¯¹Targetå’ŒAdapteeè¿›è¡Œé€‚é…ã€‚è¿™é‡ŒAdapteré€šè¿‡å®ç°Targetä¸­çš„æ¥å£å¹¶å…³è”ä¸€ä¸ªAdapteeå¯¹è±¡ä½¿äºŒè€…äº§ç”Ÿå…³è”ã€‚  æ¨¡å¼å®ç° // ç›®æ ‡æ¥å£ public interface Target { // Adaptee æ²¡æœ‰è¿™ä¸ªæ–¹æ³•  void request(); } // é€‚é…è€…ç±» public class Adaptee { public void specificRequest(){ System.out.println(\u0026#34;æˆ‘æ˜¯é€‚é…è€…çš„æ–¹æ³•\u0026#34;); } } // é€‚é…å™¨ç±» public class Adapter implements Target { private Adaptee adaptee; // å…³è”ä¸€ä¸ªAdaptee  public void setAdaptee(Adaptee adaptee) { this.adaptee = adaptee; } @Override public void request() { System.out.println(\u0026#34;è¿›è¡Œé€‚é…\u0026#34;); // è½¬å‘è°ƒç”¨  adaptee.specificRequest(); } } æµ‹è¯•ç”¨çš„å®¢æˆ·ç«¯ä»£ç ï¼š\n// å®¢æˆ·ç«¯ç±» public class Client { public static void main(String[] args){ Target target = new Adapter(); Adaptee adaptee = new Adaptee(); ((Adapter) target).setAdaptee(adaptee); target.request(); } } è¿è¡Œç»“æœï¼š\nè¿›è¡Œé€‚é… æˆ‘æ˜¯é€‚é…è€…çš„æ–¹æ³• é€‚é…å™¨ç±»é€šè¿‡å…³è”ä¸€ä¸ªé€‚é…è€…å®ä¾‹ï¼Œå°†å®¢æˆ·ç«¯å’Œé€‚é…è€…è¡”æ¥èµ·æ¥ï¼Œç„¶ååœ¨**request()** æ–¹æ³•ä¸­è°ƒç”¨é€‚é…è€…çš„ specificRequest() æ–¹æ³•å®Œæˆé€‚é…åŠŸèƒ½ã€‚\nç±»é€‚é…å™¨æ¨¡å¼  åœ¨ç±»é€‚é…å™¨æ¨¡å¼ä¸­ï¼Œé€‚é…å™¨ä¸é€‚é…è€…æ˜¯ ç»§æ‰¿ æˆ–è€… å®ç° å…³ç³»ã€‚\n ç»“æ„å›¾ æ¨¡å¼å®ç° ä»£ç ç»å¤§éƒ¨åˆ†å’Œå¯¹è±¡é€‚é…å™¨çš„ä»£ç ç›¸åŒï¼Œä¸å†é‡å¤ï¼Œä¸åŒåœ¨äºAdapterç±»ã€‚\n// é€‚é…å™¨ç±» public class Adapter extends Adaptee implements Target { @Override public void request() { specificRequest(); } } ç”±äºè¿™é‡Œä½¿ç”¨çš„æ˜¯ç»§æ‰¿æœºåˆ¶ï¼Œåœ¨åªæ”¯æŒå•ç»§æ‰¿ç»“æ„çš„ç¼–ç¨‹è¯­è¨€é‡Œä¼šå—åˆ°ä¸€å®šçš„é™åˆ¶ã€‚\nåŒå‘é€‚é…å™¨æ¨¡å¼  åœ¨åŒå‘é€‚é…å™¨æ¨¡å¼ä¸­ï¼Œé€‚é…å™¨ç±»åŒæ—¶åŒ…å«é€‚é…è€…å’Œç›®æ ‡ç±»çš„å¼•ç”¨ï¼Œé€‚é…è€…å¯ä»¥é€šè¿‡é€‚é…å™¨è°ƒç”¨ç›®æ ‡ç±»çš„æ–¹æ³•ï¼Œç›®æ ‡ç±»ä¹Ÿå¯ä»¥é€šè¿‡é€‚é…å™¨è°ƒç”¨é€‚é…è€…çš„æ–¹æ³•ã€‚\n ç»“æ„å›¾ åŒå‘é€‚é…å™¨æ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\næ¨¡å¼å®ç° åŒå‘é€‚é…å™¨çš„ä»£ç è¾ƒä¸ºå¤æ‚ï¼Œä¸»è¦åœ¨äºé€‚é…å™¨åŒæ—¶ç»´æŒäº†å¯¹ç›®æ ‡ç±»å’Œé€‚é…è€…çš„å¼•ç”¨ï¼š\n// é€‚é…å™¨ç±» public class Adapter implements Target, Adaptee{ // åŒæ—¶ç»´æŒå¯¹ç›®æ ‡ç±»å’Œé€‚é…è€…ç±»çš„å¼•ç”¨  private Target target; private Adaptee adaptee; public void setTarget(Target target) { this.target = target; } public void setAdaptee(Adaptee adaptee) { this.adaptee = adaptee; } @Override public void specificRequest() { target.request(); } @Override public void request() { adaptee.specificRequest(); } } æ€»ç»“ é€‚é…å™¨æ¨¡å¼å°†ç°æœ‰çš„æ¥å£è½¬åŒ–ä¸ºå®¢æˆ·ç±»æ‰€æœŸæœ›çš„æ¥å£ï¼Œå®ç°äº†å¯¹ç°æœ‰ç±»çš„å¤ç”¨ã€‚å¦‚æœæ²¡æœ‰ä¸€äº›ç°æœ‰çš„ç±»ï¼Œé‚£ä¹ˆé€‚é…å™¨æ¨¡å¼æ˜¯æ´¾ä¸ä¸Šç”¨åœºçš„ã€‚\né€‚é…å™¨æ¨¡å¼è§£é™¤äº†ç°æœ‰ç±»å’Œç›®æ ‡ç±»çš„è€¦åˆï¼Œä¹Ÿä¸ç”¨ä¿®æ”¹ç°æœ‰çš„ç»“æ„ã€‚åŒæ—¶ï¼Œé€‚é…å™¨æ¨¡å¼éå¸¸åˆ©äºæ‰©å±•ï¼Œå®Œå…¨ç¬¦åˆå¼€é—­åŸåˆ™ã€‚ä½†æ˜¯ï¼Œé€‚é…å™¨æ¨¡å¼ä¹Ÿæœ‰ä¸€å®šçš„å±€é™ï¼šæ¯”å¦‚å•ç»§æ‰¿ç»“æ„è¯­è¨€çš„é™åˆ¶ï¼Œé€‚é…è€…ç±»ä¸èƒ½æ˜¯æœ€ç»ˆç±»ç­‰ã€‚\n","href":"/notebook/reading_notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%B8%83%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/","title":"ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°ä¹‹ä¸ƒï¼šé€‚é…å™¨æ¨¡å¼"},{"content":" å»ºé€ è€…æ¨¡å¼ï¼ˆBuilder Patternï¼‰ï¼šå°†ä¸€ä¸ªå¤æ‚çš„å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„åˆ›å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚å»ºé€ è€…æ¨¡å¼åˆç§°ä¸ºç”Ÿæˆå™¨æ¨¡å¼ã€‚\n åŸºæœ¬å®ç°æ–¹æ¡ˆ å»ºé€ è€…æ¨¡å¼å¸¸ç”¨æ¥é€æ­¥åˆ›å»ºå¤æ‚å¯¹è±¡ï¼Œå®ƒå…è®¸å®¢æˆ·ç«¯é€šè¿‡æŒ‡å®šå¤æ‚å¯¹è±¡çš„å†…å®¹å’Œç±»å‹å°±å¯ä»¥æ„å»ºå®ƒä»¬ï¼Œç”¨æˆ·å¹¶ä¸éœ€è¦çŸ¥é“å†…éƒ¨çš„å®ç°ç»†èŠ‚ã€‚æ¢å¥è¯è¯´ï¼Œå¤æ‚å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹è¢«åˆ†è§£æˆäº†å¤šä¸ªç®€å•æ­¥éª¤ï¼Œåœ¨åˆ›å»ºå¤æ‚å¯¹è±¡çš„æ—¶å€™ï¼Œåªéœ€è¦äº†è§£å¤æ‚å¯¹è±¡çš„åŸºæœ¬å±æ€§å³å¯ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå¤æ‚å¯¹è±¡çš„å†…éƒ¨æ„é€ è¿‡ç¨‹ã€‚ç”¨æˆ·åªéœ€è¦å…³æ³¨è¿™ä¸ªå¤æ‚å¯¹è±¡éœ€è¦å“ªäº›æ•°æ®ï¼Œè€Œä¸ç”¨å…³å¿ƒå†…éƒ¨çš„å®ç°ç»†èŠ‚ã€‚\nå»ºé€ è€…æ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\nä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå»ºé€ è€…æ¨¡å¼ä¸»è¦åŒ…å«4ä¸ªè§’è‰²ï¼š\n Builderï¼ˆæŠ½è±¡å»ºé€ è€…ç±»ï¼‰ï¼šå®ƒå£°æ˜äº†åˆ›å»ºä¸€ä¸ªäº§å“å¯¹è±¡æ‰€éœ€è¦çš„æ¥å£ã€‚æŠ½è±¡å»ºé€ è€…ç±»ä¹Ÿå¯ä»¥æ˜¯å…·ä½“ç±»æˆ–è€…æŠ½è±¡ç±»ã€‚å®ƒä¸»è¦å«æœ‰ä¸¤ç±»æ–¹æ³•ï¼š  buildPartX(): ç”¨æ¥åˆ›å»ºäº§å“çš„å„ä¸ªç»„æˆéƒ¨ä»¶ï¼› getResult(): è¿”å›åˆ›å»ºå¥½çš„äº§å“ï¼›   ConcreteBuilderï¼ˆå…·ä½“å»ºé€ è€…ç±»ï¼‰ï¼šå®ƒå®ç°äº† Builder æ¥å£ï¼Œå°†è¢«ç”¨æ¥åˆ›å»ºä¸€ä¸ªå…·ä½“çš„äº§å“ï¼› Productï¼ˆäº§å“ç±»ï¼‰ï¼šå®ƒæ˜¯è¢«Concreteåˆ›å»ºçš„å¯¹è±¡ï¼Œå’Œç‰¹å®šçš„ ConcreteBuilder ç›¸å…³è”ï¼› Directorï¼ˆæŒ‡æŒ¥è€…ç±»ï¼‰ï¼šå®ƒéš”ç¦»äº†å®¢æˆ·ç«¯å’Œäº§å“çš„åˆ›å»ºè¿‡ç¨‹ï¼Œè´Ÿè´£å®‰æ’äº§å“çš„åˆ›å»ºè¿‡ç¨‹ã€‚å®ƒæ˜¯å’Œå®¢æˆ·ç«¯äº¤äº’çš„æ¥å£ï¼Œå°†æ ¹æ®å®¢æˆ·ç«¯çš„è¦æ±‚åˆ›å»ºå¹¶è¿”å›å…·ä½“çš„äº§å“ï¼›  æ ¹æ®ç»“æ„å›¾å¯ä»¥å†™å‡ºä¸‹é¢çš„ç¤ºä¾‹ä»£ç ï¼š\n// äº§å“ç±» public class Product { private String partA; private String partB; private String partC; //çœç•¥getterå’Œsetter  @Override public String toString() { return \u0026#34;Product{\u0026#34; + \u0026#34;partA=\u0026#39;\u0026#34; + partA + \u0026#39;\\\u0026#39;\u0026#39; + \u0026#34;, partB=\u0026#39;\u0026#34; + partB + \u0026#39;\\\u0026#39;\u0026#39; + \u0026#34;, partC=\u0026#39;\u0026#34; + partC + \u0026#39;\\\u0026#39;\u0026#39; + \u0026#39;}\u0026#39;; } } // æŠ½è±¡å»ºé€ è€… public interface Builder { void buildPartA(); void buildPartB(); void buildPartC(); Product getResult(); } // å…·ä½“å»ºé€ è€…ç±» public class ConcreteBuilder implements Builder { Product product = new Product(); @Override public void buildPartA() { System.out.println(\u0026#34;Build partA\u0026#34;); product.setPartA(\u0026#34;partA\u0026#34;); } @Override public void buildPartB() { System.out.println(\u0026#34;Build partB\u0026#34;); product.setPartB(\u0026#34;partB\u0026#34;); } @Override public void buildPartC() { System.out.println(\u0026#34;Build partC\u0026#34;); product.setPartC(\u0026#34;partC\u0026#34;); } @Override public Product getResult() { System.out.println(\u0026#34;Building finished!\u0026#34;); return product; } } // æŒ‡æŒ¥è€…ç±» public class Director { private Builder builder; public void setBuilder(Builder builder){ this.builder = builder; } public Product construct(){ builder.buildPartA(); builder.buildPartB(); builder.buildPartC(); return builder.getResult(); } } æµ‹è¯•ç”¨çš„å®¢æˆ·ç«¯ä»£ç ï¼š\n// å®¢æˆ·ç«¯ç±» public class Client { public static void main(String[] args){ Director director = new Director(); Builder builder = new ConcreteBuilder(); // æ³¨å…¥Builder  director.setBuilder(builder); Product product = director.construct(); System.out.println(product); } } è¿è¡Œç»“æœï¼š\nBuild partA Build partB Build partC Building finished! Product{partA=\u0026#39;partA\u0026#39;, partB=\u0026#39;partB\u0026#39;, partC=\u0026#39;partC\u0026#39;} æ€»ç»“ å»ºé€ è€…æ¨¡å¼çš„æ ¸å¿ƒåœ¨äºï¼šå¦‚ä½•ä½¿ç”¨ç›¸åŒçš„æ„å»ºè¿‡ç¨‹ä¸€æ­¥æ­¥å®Œæˆäº§å“ç»„ä»¶çš„åˆ›å»ºï¼Œæœ€ç»ˆæ„å»ºå‡ºä¸åŒçš„äº§å“ã€‚ä½¿ç”¨å»ºé€ è€…æ¨¡å¼çš„ç›®çš„ä¸€èˆ¬æœ‰ä¸¤ä¸ªï¼šç¬¬ä¸€ä¸ªç›®çš„æ˜¯å°†ä½¿ç”¨æ–¹ä¸å¤æ‚å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚åˆ†ç¦»å¼€æ¥ï¼Œå®ç°è§£è€¦ï¼›ç¬¬äºŒä¸ªç›®çš„æ˜¯ç®€åŒ–å¤æ‚å¯¹è±¡çš„æ„å»ºè¿‡ç¨‹ã€‚\nå»ºé€ è€…æ¨¡å¼é€‚ç”¨äºåˆ›å»ºå¤æ‚çš„äº§å“ã€‚å®ƒä¹Ÿèƒ½é€‰æ‹©æ€§çš„åˆ›å»ºäº§å“çš„éƒ¨ä»¶ä»¥åŠæŒ‡å®šäº§å“éƒ¨ä»¶çš„åˆ›å»ºæ¬¡åºï¼Œè¿™èƒ½å¤Ÿå®ç°å¯¹äº§å“åˆ›å»ºè¿‡ç¨‹çš„ç²¾ç¡®æ§åˆ¶ã€‚æ¯ä¸€ç±»çš„å»ºé€ è€…éƒ½ç›¸äº’ç‹¬ç«‹ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ›¿æ¢å…·ä½“çš„å»ºé€ è€…å’Œå¢åŠ æ–°çš„å»ºé€ è€…ï¼Œè¿™ç¬¦åˆå¼€é—­åŸåˆ™ã€‚ä½†æ˜¯ï¼Œå»ºé€ è€…æ¨¡å¼è¦æ±‚äº§å“ä¸€èˆ¬å…·æœ‰è¾ƒå¤šçš„å…±åŒç‚¹ï¼Œå¦‚æœäº§å“ä¹‹é—´å·®å¼‚å¾ˆå¤§ï¼Œå°±ä¸é€‚åˆä½¿ç”¨å»ºé€ è€…æ¨¡å¼äº†ã€‚\n","href":"/notebook/reading_notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%85%AD%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/","title":"ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°ä¹‹å…­ï¼šå»ºé€ è€…æ¨¡å¼"},{"content":" åŸå‹æ¨¡å¼ï¼ˆPrototype Patternï¼‰ï¼šä½¿ç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡ï¼Œå¹¶é€šè¿‡å…‹éš†è¿™äº›åŸå‹å¾—åˆ°æ–°çš„å¯¹è±¡ã€‚\n åŸå‹æ¨¡å¼çš„å·¥ä½œåŸç†å°±æ˜¯ï¼šå°†ä¸€ä¸ªåŸå‹å¯¹è±¡ä¼ ç»™é‚£ä¸ªè¦å‘åŠ¨åˆ›å»ºçš„å¯¹è±¡ï¼Œè¿™ä¸ªè¦å‘åŠ¨åˆ›å»ºçš„å¯¹è±¡é€šè¿‡è¯·æ±‚åŸå‹å¯¹è±¡å…‹éš†è‡ªå·±æ¥å®ç°åˆ›å»ºè¿‡ç¨‹ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼šé€šè¿‡å…‹éš†æ–¹æ³•æ‰€åˆ›å»ºçš„å¯¹è±¡åº”å½“éƒ½æ˜¯ å…¨æ–° çš„å¯¹è±¡ï¼Œä»–ä»¬åœ¨å†…å­˜ä¸­æ‹¥æœ‰æ–°çš„åœ°å€ã€‚é€šå¸¸ï¼Œå¯¹å…‹éš†åçš„å¯¹è±¡è¿›è¡Œä¿®æ”¹ä¸ä¼šå½±å“åŸå‹å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªå…‹éš†å¯¹è±¡éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚é€šè¿‡ä¿®æ”¹å…‹éš†åçš„å¯¹è±¡ï¼Œå¯ä»¥å¾—åˆ°ä¸€ç»„ç›¸ä¼¼çš„å¯¹è±¡ã€‚\nåŸºæœ¬å®ç°æ–¹æ¡ˆ åŸå‹æ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\nä»ç»“æ„å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒåŸå‹æ¨¡å¼ä¸»è¦åŒ…å«3ä¸ªè§’è‰²ï¼š\n Prototypeï¼ˆæŠ½è±¡åŸå‹ç±»ï¼‰ï¼šå®ƒå£°æ˜äº†å…‹éš†æ–¹æ³•çš„æ¥å£ï¼Œä¾›å…·ä½“åŸå‹ç±»å®ç°ï¼Œå®ƒä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–è¿™å…·ä½“ç±»ï¼› ConcretePrototypeï¼ˆå…·ä½“åŸå‹ç±»ï¼‰ï¼šå®ƒå®ç°äº†æŠ½è±¡åŸå‹ç±»ä¸­å£°æ˜çš„å…‹éš†æ–¹æ³•ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªè‡ªå·±çš„å…‹éš†å¯¹è±¡ï¼› Clientï¼ˆå®¢æˆ·ç«¯ç±»ï¼‰ï¼šé’ˆå¯¹æŠ½è±¡åŸå‹ç±»ç¼–ç¨‹ï¼Œè®©ä¸€ä¸ªåŸå‹å¯¹è±¡å…‹éš†è‡ªå·±ä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„åŸå‹å¯¹è±¡ã€‚  åŸå‹æ¨¡å¼çš„ä¸€ä¸ªç®€å•å®ç°ï¼š\nåŸå‹ç±»ï¼š\nimport java.io.*; // å®ç°åºåˆ—åŒ–æ¥å£ï¼Œä¾¿äºè¿›è¡Œæ·±å…‹éš† public class Book implements Serializable { private String name; private String isbn; private String publishingCompany; public Book(String name, String isbn, String publishingCompany) { this.name = name; this.isbn = isbn; this.publishingCompany = publishingCompany; } public String getName() { return name; } public void setName(String name) { this.name = name; } public String getIsbn() { return isbn; } public void setIsbn(String isbn) { this.isbn = isbn; } @Override public String toString() { return \u0026#34;Book{\u0026#34; + \u0026#34;name=\u0026#39;\u0026#34; + name + \u0026#39;\\\u0026#39;\u0026#39; + \u0026#34;, isbn=\u0026#39;\u0026#34; + isbn + \u0026#39;\\\u0026#39;\u0026#39; + \u0026#34;, publishingCompany=\u0026#39;\u0026#34; + publishingCompany + \u0026#39;\\\u0026#39;\u0026#39; + \u0026#39;}\u0026#39;; } // ä½¿ç”¨åºåˆ—åŒ–æŠ€æœ¯è¿›è¡Œæ·±å…‹éš†  public Book deeppClone() throws IOException, ClassNotFoundException{ // å°†å¯¹è±¡å†™å…¥æµä¸­  ByteArrayOutputStream bao = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(bao); oos.writeObject(this); // å°†å¯¹è±¡ä»æµä¸­å–å‡º  ByteArrayInputStream bio = new ByteArrayInputStream(bao.toByteArray()); ObjectInputStream ois = new ObjectInputStream(bio); return (Book) ois.readObject(); } } æµ‹è¯•ç”¨çš„å®¢æˆ·ç«¯ä»£ç ï¼š\nimport java.io.IOException; public class Client { public static void main(String[] args) throws IOException, ClassNotFoundException { Book bookPrototype = new Book(\u0026#34;è®¾è®¡æ¨¡å¼\u0026#34;, \u0026#34;978-7-303-23647-8\u0026#34;, \u0026#34;æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾\u0026#34;); Book bookCopy = bookPrototype.deeppClone(); System.out.println(\u0026#34;bookPrototype == bookCopy: \u0026#34; + (bookPrototype == bookCopy)); System.out.println(\u0026#34;bookPrototype.getClass() == bookCopy.getClass(): \u0026#34; + (bookPrototype.getClass() == bookCopy.getClass())); bookCopy.setIsbn(\u0026#34;978-6-111-22222-1\u0026#34;); System.out.println(\u0026#34;------------ bookPrototype -------------\u0026#34;); System.out.println(bookPrototype); System.out.println(\u0026#34;------------ bookCopy -------------\u0026#34;); System.out.println(bookCopy); } } è¿è¡Œç»“æœï¼š\nbookPrototype == bookCopy: false bookPrototype.getClass() == bookCopy.getClass(): true ------------ bookPrototype ------------- Book{name=\u0026#39;è®¾è®¡æ¨¡å¼\u0026#39;, isbn=\u0026#39;978-7-303-23647-8\u0026#39;, publishingCompany=\u0026#39;æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾\u0026#39;} ------------ bookCopy ------------- Book{name=\u0026#39;è®¾è®¡æ¨¡å¼\u0026#39;, isbn=\u0026#39;978-6-111-22222-1\u0026#39;, publishingCompany=\u0026#39;æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾\u0026#39;} å¯ä»¥å‘ç°ï¼šå…‹éš†çš„å¯¹è±¡å’ŒåŸæ¥çš„å¯¹è±¡å·²ç»ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡äº†ï¼Œä½†æ˜¯å®ƒä»¬ä»ç„¶å±äºåŒä¸€ä¸ªç±»ï¼Œä»ç„¶å…·æœ‰ä¸€è‡´çš„è¡Œä¸ºå’Œç›¸ä¼¼çš„å±æ€§ã€‚\næµ…å…‹éš†VSæ·±å…‹éš† æµ…å…‹éš†å’Œæ·±å…‹éš†çš„ä¸»è¦åŒºåˆ«åœ¨äºæ˜¯å¦æ”¯æŒ å¼•ç”¨ç±»å‹ çš„æˆå‘˜å˜é‡çš„å¤åˆ¶ã€‚\nå€¼ç±»å‹VSå¼•ç”¨ç±»å‹ åœ¨Javaä¸­ï¼Œæ•°æ®ç±»å‹åˆ†ä¸º å€¼ç±»å‹ å’Œ å¼•ç”¨ç±»å‹ ã€‚\nå€¼ç±»å‹ä¹Ÿå°±æ˜¯åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬ï¼šboolean, char, byte, short, int, long, float, doubleï¼›\nå¼•ç”¨ç±»å‹åŒ…æ‹¬ç±»ã€æ•°ç»„ã€æ¥å£ç­‰å¤æ‚ç±»å‹ã€‚\næµ…å…‹éš†ï¼ˆShallow Clone) åœ¨æµ…å…‹éš†ä¸­ï¼Œå¦‚æœåŸå‹å¯¹è±¡æˆå‘˜å˜é‡æ˜¯å€¼ç±»å‹ï¼Œåˆ™å¤åˆ¶ä¸€ä»½ç»™å…‹éš†å¯¹è±¡ï¼›å¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œåˆ™å°†å¼•ç”¨å¯¹è±¡çš„ åœ°å€ å¤åˆ¶ä¸€ä»½ç»™å…‹éš†å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸå‹å¯¹è±¡å’Œå…‹éš†å¯¹è±¡çš„å¼•ç”¨ç±»å‹æˆå‘˜æŒ‡å‘çš„æ˜¯ åŒä¸€ä¸ª å†…å­˜åœ°å€ï¼Œ ä¹Ÿå°±æ˜¯åŒä¸€ä¸ªå¼•ç”¨ã€‚\nå¯ä»¥é€šè¿‡è¦†ç›–objectç±»çš„ clone() æ–¹æ³•å®ç°æµ…å…‹éš†ã€‚\næ·±å…‹éš† å’Œæµ…å…‹éš†ä¸åŒçš„æ˜¯ï¼šæ·±å…‹éš†åœ¨å¤åˆ¶æˆå‘˜å˜é‡çš„æ—¶å€™ï¼Œä¸ç®¡æˆå‘˜å˜é‡æ˜¯åŸºæœ¬ç±»å‹è¿˜æ˜¯å¼•ç”¨ç±»å‹ï¼Œéƒ½ä¼šå¤åˆ¶ä¸€ä»½ç»™å…‹éš†å¯¹è±¡ã€‚æ­¤å¤–ï¼Œæ·±å…‹éš†è¿˜ä¼šå°†åŸå‹å¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨ä¹Ÿå¤åˆ¶ä¸€ä»½ç»™å…‹éš†å¯¹è±¡ã€‚\nå¯ä»¥é€šè¿‡åºåˆ—åŒ–ï¼ˆSerializationï¼‰æŠ€æœ¯å¿«é€Ÿå®ç°æ·±å…‹éš†ã€‚\næ€»ç»“ åŸå‹æ¨¡å¼æ˜¯ä¸€ç§ç”¨æ¥å¿«é€Ÿåˆ›å»ºå¤§é‡ç›¸åŒæˆ–è€…ç›¸ä¼¼å¯¹è±¡çš„æ–¹å¼ã€‚ç‰¹åˆ«æ˜¯å½“åˆ›å»ºæ–°çš„å¯¹è±¡è¾ƒä¸ºå¤æ‚çš„æ—¶å€™ï¼Œä½¿ç”¨åŸå‹æ¨¡å¼å¯ä»¥ç®€åŒ–åˆ›å»ºè¿‡ç¨‹ã€‚ä½¿ç”¨äº†æŠ½è±¡å±‚çš„åŸå‹æ¨¡å¼è¿˜èƒ½å¾ˆå¥½çš„æ”¯æŒæ‰©å±•ã€‚å½“æˆ‘ä»¬éœ€è¦ä¿å­˜å¯¹è±¡åœ¨æŸä¸€æ—¶åˆ»çš„çŠ¶æ€çš„æ—¶å€™ï¼Œèƒ½å¤Ÿå¾ˆè½»æ¾çš„é€šè¿‡æ·±å…‹éš†æœºåˆ¶æ¥å®ç°ã€‚ä¸è¿‡ï¼ŒåŸå‹æ¨¡å¼éœ€è¦ä¸ºæ¯ä¸€ä¸ªç±»éƒ½é…å¤‡ä¸€ä¸ªå…‹éš†æ–¹æ³•ï¼Œç”±äºå…‹éš†æ–¹æ³•åœ¨ç±»çš„å†…éƒ¨ï¼Œæ‰€ä»¥å½“éœ€è¦å¯¹ç±»è¿›è¡Œæ”¹é€ çš„æ—¶å€™ï¼Œéœ€è¦ä¿®æ”¹åŸæœ‰çš„ä»£ç ï¼Œè¿™è¿åäº†å¼€é—­åŸåˆ™ã€‚\n","href":"/notebook/reading_notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%BA%94%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/","title":"ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°ä¹‹äº”ï¼šåŸå‹æ¨¡å¼"},{"content":" æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factory Patternï¼‰ï¼šæä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–è€…ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œè€Œæ— é¡»æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼åˆç§°Kitæ¨¡å¼ã€‚\n äº§å“ç­‰çº§ç»“æ„å’Œäº§å“æ— å…ˆå›å¿†ä¸€ä¸‹å·¥å‚æ–¹æ³•æ¨¡å¼ï¼šåœ¨å·¥å‚æ–¹æ³•æ¨¡å¼é‡Œé¢ï¼Œæ¯ä¸€ç§å…·ä½“çš„äº§å“éƒ½æœ‰å®ƒå¯¹åº”çš„å·¥å‚ï¼Œå·¥å‚æ–¹æ³•å…·æœ‰ä¸“ä¸€æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªå·¥å‚ä»…æä¾›ä¸€ç§äº§å“ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªå·¥å‚å¯ä»¥åˆ›å»ºå¤šç§äº§å“ã€‚å¦‚æœä»ç„¶é‡‡å–ä¸€ä¸ªå·¥å‚å¯¹åº”ä¸€ç§äº§å“çš„æ–¹æ³•ï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­ç±»çš„ä¸ªæ•°å°±ä¼šå¿«é€Ÿå¢åŠ ã€‚\nåœ¨æå‡ºæŠ½è±¡å·¥å‚æ¨¡å¼ä¹‹å‰ï¼Œå…ˆå¼•å…¥äº§å“ç­‰çº§ç»“æ„å’Œäº§å“æ—çš„æ¦‚å¿µï¼š\n äº§å“ç­‰çº§ç»“æ„ã€‚äº§å“ç­‰çº§ç»“æ„ä¹Ÿå°±æ˜¯äº§å“çš„ç»§æ‰¿ç»“æ„ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬ç°åœ¨æœ‰æ‰‹æœºè¿™ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒçš„å­ç±»æœ‰åä¸ºæ‰‹æœºã€è‹¹æœæ‰‹æœºã€å°ç±³æ‰‹æœºâ€¦â€¦ã€‚åä¸ºæ‰‹æœºä¸‹é¢åˆæœ‰Pç³»åˆ—æ‰‹æœºã€Mateç³»åˆ—æ‰‹æœºã€ç•…äº«ç³»åˆ—æ‰‹æœºç­‰ç­‰ã€‚æŠ½è±¡çš„æ‰‹æœºå’Œä¸åŒå“ç‰Œçš„å…·ä½“çš„æ‰‹æœºå°±æ„æˆäº†ä¸€ä¸ªäº§å“ç­‰çº§ç»“æ„ã€‚ äº§å“æ—ã€‚åœ¨æŠ½è±¡å·¥å‚æ¨¡å¼ä¸­ï¼Œäº§å“æ—æŒ‡çš„æ˜¯ç”±åŒä¸€ä¸ªå·¥å‚ç”Ÿäº§çš„ï¼Œä½äºä¸åŒäº§å“ç­‰çº§ç»“æ„çš„ä¸€ç»„äº§å“ã€‚å°±åƒä¸Šé¢çš„åä¸ºæ‰‹æœºç³»åˆ—çš„å…·ä½“æœºå‹ã€‚  äº§å“ç­‰çº§ç»“æ„å’Œäº§å“æ—å°±åƒæ˜¯ä¸€ä¸ªå¹³é¢çš„Xå’ŒYåæ ‡è½´ï¼Œé€šè¿‡ä¸€ä¸ªäº§å“äº§å“ç­‰çº§ç»“æ„å’Œäº§å“æ—å°±èƒ½å”¯ä¸€ç¡®å®šè¿™ä¸ªäº§å“ã€‚\nåŸºæœ¬å®ç°æ–¹æ¡ˆ æŠ½è±¡å·¥å‚æ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\nä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼ä¸»è¦åŒ…å«4ä¸ªè§’è‰²ï¼š\n AbstractFactoryï¼ˆæŠ½è±¡å·¥å‚ç±»ï¼‰ï¼šå®ƒå£°æ˜äº†ä¸€ç»„ç”¨æ¥åˆ›å»ºä¸€æ—äº§å“çš„æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ç§äº§å“ï¼› ConcreteFactoryï¼ˆå…·ä½“å·¥å‚ç±»ï¼‰ï¼šå®ƒå®ç°äº†æŠ½è±¡å·¥å‚ç±»ä¸­å£°æ˜çš„æ–¹æ³•ã€‚ä¸€ä¸ªå…·ä½“å·¥å‚ä¸­çš„ä¸åŒæ–¹æ³•è´Ÿè´£åˆ›å»ºä½äºåŒä¸€äº§å“æ—çš„ä¸åŒäº§å“ç­‰çº§ç»“æ„çš„äº§å“ï¼Œæ‰€æœ‰çš„è¿™äº›äº§å“æ„æˆäº†åŒä¸€ä¸ªäº§å“æ—ã€‚ AbstracProductï¼ˆæŠ½è±¡äº§å“ç±»ï¼‰ï¼šå®ƒå£°æ˜äº†äº§å“æ‰€å…·æœ‰çš„ä¸šåŠ¡æ–¹æ³•ï¼› ConcreteProductï¼ˆå…·ä½“äº§å“ç±»ï¼‰ï¼šå®ƒå®ç°äº†æŠ½è±¡äº§å“ç±»ä¸­å£°æ˜çš„æ–¹æ³•  æ ¹æ®ç»“æ„å›¾å¯ä»¥å†™å‡ºå¦‚ä¸‹ç¤ºä¾‹ä»£ç ï¼š\næŠ½è±¡äº§å“ï¼š\n// äº§å“æ—A public interface AbstractProductA { public void productAMethod(); } // äº§å“æ—B public interface AbstractProductB { public void productBMethod(); } å…·ä½“äº§å“ï¼š\n// å…·ä½“äº§å“A1 public class ConcreteProductA1 implements AbstractProductA { @Override public void productAMethod() { System.out.println(\u0026#34;è¿™æ˜¯äº§å“A1, å±äºäº§å“æ—1\u0026#34;); } } // å…·ä½“äº§å“A2 public class ConcreteProductA2 implements AbstractProductA { @Override public void productAMethod() { System.out.println(\u0026#34;è¿™æ˜¯äº§å“A2, å±äºäº§å“æ—2\u0026#34;); } } // å…·ä½“äº§å“B1 public class ConcreteProductB1 implements AbstractProductB { @Override public void productBMethod() { System.out.println(\u0026#34;è¿™æ˜¯äº§å“B1, å±äºäº§å“æ—1\u0026#34;); } } // å…·ä½“äº§å“B2 public class ConcreteProductB2 implements AbstractProductB { @Override public void productBMethod() { System.out.println(\u0026#34;è¿™æ˜¯äº§å“B2, å±äºäº§å“æ—2\u0026#34;); } } æŠ½è±¡å·¥å‚ï¼š\n// æŠ½è±¡å·¥å‚ public interface AbstractFactory { // åˆ›å»ºäº§å“æ—A  public AbstractProductA createProductA(); // åˆ›å»ºäº§å“æ—B  public AbstractProductB createProductB(); } å…·ä½“å·¥å‚ï¼š\n// å…·ä½“å·¥å‚1 public class ConcreteFactory1 implements AbstractFactory { @Override public AbstractProductA createProductA() { System.out.println(\u0026#34;åˆ›å»ºäº§å“A1, äº§å“ç­‰çº§A\u0026#34;); return new ConcreteProductA1(); } @Override public AbstractProductB createProductB() { System.out.println(\u0026#34;åˆ›å»ºäº§å“B1, äº§å“ç­‰çº§B\u0026#34;); return new ConcreteProductB1(); } } // å…·ä½“å·¥å‚2 public class ConcreteFactory2 implements AbstractFactory { @Override public AbstractProductA createProductA() { System.out.println(\u0026#34;åˆ›å»ºäº§å“A2, äº§å“ç­‰çº§A\u0026#34;); return new ConcreteProductA2(); } @Override public AbstractProductB createProductB() { System.out.println(\u0026#34;åˆ›å»ºäº§å“B2, äº§å“ç­‰çº§B\u0026#34;); return new ConcreteProductB2(); } } æµ‹è¯•ç”¨çš„å®¢æˆ·ç«¯ä»£ç ï¼š\n// å®¢æˆ·ç«¯ public class Client { public static void main(String[] args){ AbstractFactory factory; AbstractProductA productA; AbstractProductB productB; factory = new ConcreteFactory1(); productA = factory.createProductA(); productA.productAMethod(); productB = factory.createProductB(); productB.productBMethod(); factory = new ConcreteFactory2(); productA = factory.createProductA(); productA.productAMethod(); productB = factory.createProductB(); productB.productBMethod(); } } è¿è¡Œç»“æœï¼š\nåˆ›å»ºäº§å“A1, äº§å“ç­‰çº§A è¿™æ˜¯äº§å“A1, å±äºäº§å“æ—1 åˆ›å»ºäº§å“B1, äº§å“ç­‰çº§B è¿™æ˜¯äº§å“B1, å±äºäº§å“æ—1 åˆ›å»ºäº§å“A2, äº§å“ç­‰çº§A è¿™æ˜¯äº§å“A2, å±äºäº§å“æ—2 åˆ›å»ºäº§å“B2, äº§å“ç­‰çº§B è¿™æ˜¯äº§å“B2, å±äºäº§å“æ—2 æ€»ç»“ å’Œå·¥å‚æ–¹æ³•æ¨¡å¼ç›¸æ¯”ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼æœ€å¤§çš„ä¸åŒåœ¨äºï¼šå·¥å‚æ–¹æ³•æ¨¡å¼é’ˆå¯¹çš„æ˜¯ä¸€ä¸ªäº§å“ç­‰çº§ç»“æ„ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼é’ˆå¯¹çš„æ˜¯å¤šä¸ªäº§å“ç­‰çº§ç»“æ„ï¼ˆä¸€ä¸ªäº§å“æ—ï¼‰ã€‚åœ¨è¿™é‡Œï¼Œå±äºåŒä¸€ä¸ªäº§å“æ—çš„å¤šä¸ªå¯¹è±¡è¢«è®¾è®¡æˆä¸€èµ·å·¥ä½œã€‚å½“å‘ç³»ç»Ÿä¸­å¢åŠ äº§å“æ—çš„æ—¶å€™ï¼Œä¸ç”¨ä¿®æ”¹å·²æœ‰ä»£ç ï¼Œè¿™ç¬¦åˆå¼€é—­åŸåˆ™ã€‚ä½†æ˜¯å½“å‘ç³»ç»Ÿä¸­å¢åŠ æ–°çš„äº§å“ç­‰çº§ç»“æ„çš„æ—¶å€™ä¼šå¾ˆéº»çƒ¦ï¼Œéœ€è¦å¯¹åŸæ¥çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œè¿™ä¸ªä¿®æ”¹å¾€å¾€æ˜¯å¾ˆå¤§çš„ï¼Œè¿™åˆè¿åäº†å¼€é—­åŸåˆ™ã€‚\n","href":"/notebook/reading_notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%9B%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/","title":"ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°ä¹‹å››ï¼šæŠ½è±¡å·¥å‚æ¨¡å¼"},{"content":" å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Method Patternï¼‰ï¼šå®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå°†å“ªä¸€ä¸ªç±»å®ä¾‹åŒ–ï¼Œè¿™è®©ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°äº†å…¶å­ç±»ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼ç®€ç§°å·¥å‚æ¨¡å¼ï¼ˆFactory Methodï¼‰ï¼Œä¹Ÿç§°è™šæ‹Ÿæ„é€ å™¨æ¨¡å¼ï¼ˆVirtual Constructor Patternï¼‰ï¼Œåˆè¢«ç§°ä¸ºå¤šæ€å·¥å‚æ¨¡å¼ï¼ˆPolymorphic Factory Methodï¼‰ã€‚\n åŸºæœ¬å®ç°æ–¹æ¡ˆ  å°†éœ€è¦åˆ›å»ºçš„å„ç§ä¸åŒå¯¹è±¡çš„ç›¸å…³ä»£ç å°è£…åˆ°ä¸åŒçš„å…·ä½“äº§å“ç±»ä¸­ï¼› å°†å…·ä½“äº§å“ç±»çš„å…¬å…±ä»£ç è¿›è¡ŒæŠ½è±¡å’Œæå–åå°è£…åˆ°ä¸€ä¸ªæŠ½è±¡äº§å“ç±»(ä¹Ÿå¯ä»¥æ˜¯æ¥å£æˆ–è€…å…·ä½“çš„ç±»)ä¸­ï¼Œå®ƒæ˜¯æ‰€æœ‰å…·ä½“äº§å“ç±»çš„çˆ¶ç±»ï¼› åˆ›å»ºä¸€ä¸ªæŠ½è±¡å·¥å‚ç±»å¹¶æä¾›ä¸€ä¸ªåˆ›å»ºäº§å“çš„å·¥å‚æ–¹æ³•ï¼Œç”¨äºè¿”å›ä¸€ä¸ªå…·ä½“çš„äº§å“ï¼› åˆ›å»ºå’Œå…·ä½“äº§å“ç±»å¯¹åº”çš„å…·ä½“å·¥å‚ç±»ï¼Œä½¿ä¹‹æˆä¸ºæŠ½è±¡å·¥å‚ç±»çš„å­ç±»ï¼Œå¹¶å®ç°æŠ½è±¡å·¥å‚ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚  å·¥å‚æ–¹æ³•æ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\nå¯ä»¥çœ‹å‡ºï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼ä¸»è¦åŒ…å«å››ä¸ªè§’è‰²ï¼š\n Productï¼ˆæŠ½è±¡äº§å“ç±»ï¼‰ï¼šå®ƒå®šä¹‰äº†äº§å“çš„æ¥å£ï¼Œä¾›æ‰€æœ‰å…·ä½“çš„äº§å“ç±»å®ç°ã€‚ ConcreteProductï¼ˆå…·ä½“äº§å“ç±»ï¼‰ï¼šå®ƒå®ç°äº†äº§å“çš„æ¥å£ï¼Œæ˜¯å…·ä½“å·¥å‚ç±»åˆ›å»ºçš„å¯¹è±¡ï¼Œå’Œå…·ä½“å·¥å‚ä¸€ä¸€å¯¹åº”ï¼› Fatoryï¼ˆæŠ½è±¡å·¥å‚ç±»ï¼‰ï¼šå®ƒæ˜¯æ•´ä¸ªæ¨¡å¼çš„æ ¸å¿ƒï¼Œå£°æ˜äº†å·¥å‚æ–¹æ³•factoryMethod()ã€‚æ‰€æœ‰çš„å…·ä½“å·¥å‚ç±»éƒ½å¿…é¡»å®ç°å®ƒå£°æ˜çš„æ–¹æ³•ï¼› ConcreteFactoryï¼ˆå…·ä½“å·¥å‚ç±»ï¼‰ï¼šå®ƒå®ç°äº†æŠ½è±¡å·¥å‚ç±»çš„æ¥å£ï¼Œä¸ç‰¹å®šçš„äº§å“ç›¸å…³è”ï¼Œå¹¶å¯è¿”å›å…·ä½“äº§å“çš„å®ä¾‹ï¼›  æ ¹æ®ç»“æ„å›¾å¯ä»¥å†™å‡ºå¦‚ä¸‹çš„ç¤ºä¾‹ä»£ç ï¼š\näº§å“ç±»ï¼š\n// æŠ½è±¡äº§å“æ¥å£ public interface Product { public void productMethod(); } // å…·ä½“äº§å“A public class ConcreteProductA implements Product{ public ConcreteProductA(){ System.out.println(\u0026#34;åˆ›å»ºäº§å“A\u0026#34;); } @Override public void productMethod() { System.out.println(\u0026#34;è¿™æ˜¯äº§å“A\u0026#34;); } } // å…·ä½“äº§å“B public class ConcreteProductB implements Product { public ConcreteProductB(){ System.out.println(\u0026#34;åˆ›å»ºäº§å“B\u0026#34;); } @Override public void productMethod() { System.out.println(\u0026#34;è¿™æ˜¯äº§å“B\u0026#34;); } } å·¥å‚ç±»ï¼š\n// æŠ½è±¡å·¥å‚æ¥å£ public interface Factory { public Product factoryMethod(); } // å…·ä½“äº§å“Aå¯¹åº”çš„å…·ä½“å·¥å‚ public class ConcreteProductAFactory implements Factory { @Override public Product factoryMethod() { return new ConcreteProductA(); } } // å…·ä½“äº§å“Bå¯¹åº”çš„å…·ä½“å·¥å‚ public class ConcreteProductBFactory implements Factory { @Override public Product factoryMethod() { return new ConcreteProductB(); } } å®¢æˆ·ç«¯æµ‹è¯•ä»£ç ï¼š\n// å®¢æˆ·ç«¯ public class Client { public static void main(String[] args){ Factory factory = null; Product product = null; // åˆ›å»ºäº§å“A  factory = new ConcreteProductAFactory(); product = factory.factoryMethod(); product.productMethod(); // åˆ›å»ºäº§å“B  factory = new ConcreteProductBFactory(); product = factory.factoryMethod(); product.productMethod(); } } è¿è¡Œç»“æœï¼š\nåˆ›å»ºäº§å“A è¿™æ˜¯äº§å“A åˆ›å»ºäº§å“B è¿™æ˜¯äº§å“B ä¸ç®€å•å·¥å‚æ¨¡å¼ç›¸æ¯”ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å¼•å…¥äº†æŠ½è±¡å·¥å‚è¿™ä¸ªè§’è‰²ã€‚å®ƒåªæ˜¯ç®€å•çš„å£°æ˜äº†å·¥å‚æ–¹æ³•ï¼Œå…·ä½“çš„äº§å“å¯¹è±¡ç”±å…¶å­ç±»â€”â€”å…·ä½“å·¥å‚ç±»åˆ›å»ºï¼Œè¿™ä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥é’ˆå¯¹æŠ½è±¡å·¥å‚ç¼–ç¨‹ï¼Œå…·ä½“å·¥å‚ç±»å¯ä»¥å»¶è¿Ÿåˆ°è¿è¡Œæ—¶åˆ»å†ç¡®å®šã€‚\næ€»ç»“ å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯å¯¹ç®€å•å·¥å‚æ¨¡å¼çš„æ”¹è¿›ï¼Œå…‹æœäº†ç®€å•å·¥å‚æ¨¡å¼çš„ä¸è¶³ï¼Œå…³é”®åœ¨äºåŸºäºå·¥å‚è§’è‰²å’Œäº§å“è§’è‰²çš„ å¤šæ€ è®¾è®¡ã€‚æŠ½è±¡å·¥å‚é€šè¿‡æŒ‡å®šå…¶å­ç±»æ¥ç¡®å®šå…·ä½“ä½¿ç”¨å·¥å‚æ–¹æ³•åˆ›å»ºå“ªä¸ªå¯¹è±¡ï¼Œè¿™å°±å‘å®¢æˆ·ç«¯éšè—äº†å…·ä½“äº§å“çš„å®ç°ç»†èŠ‚ï¼Œå®¢æˆ·ç«¯ä¸å¿…çŸ¥é“å…·ä½“äº§å“ç±»çš„ç±»åï¼Œåªéœ€çŸ¥é“ç›¸åº”çš„å·¥å‚å³å¯ã€‚å¦‚æœé‡‡ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼æŒ‡å®šå…·ä½“çš„äº§å“ç±»ï¼Œåœ¨æ›´æ¢äº§å“çš„æ—¶å€™åªéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¸å¿…ä¿®æ”¹å·²æœ‰ä»£ç ã€‚å½“å‘ç³»ç»Ÿä¸­åŠ å…¥æ–°çš„äº§å“æ—¶ï¼Œä¹Ÿæ— é¡»ä¿®æ”¹å·²æœ‰ä»£ç ï¼Œåªéœ€æ·»åŠ å…·ä½“äº§å“ç±»å’Œå¯¹åº”çš„å·¥å‚ç±»å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥å·¥å‚æ–¹æ³•æ¨¡å¼æœ€ç»ˆæ˜¯ç¬¦åˆ å¼€é—­åŸåˆ™ çš„ï¼Œè¿™éå¸¸æœ‰åˆ©äºç³»ç»Ÿçš„æ‰©å±•ã€‚ç„¶è€Œï¼Œä½†åŠ å…¥æ–°çš„äº§å“çš„æ—¶å€™ï¼Œç³»ç»Ÿä¸­çš„ç±»çš„ä¸ªæ•°ä¹Ÿå°†æˆå¯¹å¢åŠ ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸ŠåŠ å¤§äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚\n","href":"/notebook/reading_notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%B8%89%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/","title":"ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°ä¸‰ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼"},{"content":" ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factory Patternï¼‰ï¼šå®šä¹‰ä¸€ä¸ªå·¥å‚ç±»ï¼Œå·¥å‚ç±»æ ¹æ®å‚æ•°è¿”å›ä¸åŒçš„å®ä¾‹ï¼Œè¢«åˆ›å»ºçš„å®ä¾‹é€šå¸¸å…·æœ‰å…±åŒçš„çˆ¶ç±»ã€‚ç”±äºåˆ›å»ºå®ä¾‹çš„æ–¹æ³•æ˜¯é™æ€æ–¹æ³•ï¼Œå› æ­¤ç®€å•å·¥å‚æ¨¡å¼åˆè¢«ç§°ä¸ºé™æ€å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚\n ç®€å•å·¥å‚çš„æ ¸å¿ƒåœ¨äºï¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°è·å–ç›¸åº”çš„å¯¹è±¡ï¼Œè€Œæ— é¡»çŸ¥é“åˆ›å»ºçš„ç»†èŠ‚ã€‚\nåŸºæœ¬å®ç°æ–¹æ¡ˆ  å°†éœ€è¦åˆ›å»ºçš„å„ç§ä¸åŒå¯¹è±¡çš„ç›¸å…³ä»£ç å°è£…åˆ°ä¸åŒçš„å…·ä½“äº§å“ç±»ä¸­ï¼› å°†å…·ä½“äº§å“ç±»çš„å…¬å…±ä»£ç è¿›è¡ŒæŠ½è±¡å’Œæå–åå°è£…åˆ°ä¸€ä¸ªæŠ½è±¡äº§å“ç±»(ä¹Ÿå¯ä»¥æ˜¯æ¥å£æˆ–è€…å…·ä½“çš„ç±»)ä¸­ï¼Œå®ƒæ˜¯æ‰€æœ‰å…·ä½“äº§å“ç±»çš„çˆ¶ç±»ï¼› åˆ›å»ºä¸€ä¸ªå·¥å‚ç±»å¹¶æä¾›ä¸€ä¸ªåˆ›å»ºäº§å“çš„å·¥å‚æ–¹æ³•ï¼Œå®ƒèƒ½æ ¹æ®ä¼ å…¥å‚æ•°çš„ä¸åŒåˆ›å»ºä¸åŒçš„å…·ä½“äº§å“å¯¹è±¡ï¼›  ç®€å•å·¥å‚æ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\nå¯ä»¥çœ‹å‡ºï¼Œç®€å•å·¥å‚æ¨¡å¼çš„ç»“æ„å›¾ä¸­åŒ…å«3ä¸ªè§’è‰²ï¼š\n Factoryï¼ˆå·¥å‚ç±»ï¼‰ï¼šå®ƒæ˜¯æ•´ä¸ªæ¨¡å¼çš„æ ¸å¿ƒï¼Œè´Ÿè´£åˆ›å»ºæ‰€æœ‰çš„äº§å“ã€‚å¤–ç•Œå¯ä»¥ç›´æ¥è°ƒç”¨é™æ€å·¥å‚æ–¹æ³•factoryMethod()åˆ›å»ºæ‰€éœ€è¦çš„å…·ä½“äº§å“å¯¹è±¡ï¼› Productï¼ˆæŠ½è±¡äº§å“ç±»ï¼‰ï¼šå®ƒæ˜¯æ‰€æœ‰å…·ä½“äº§å“ç±»çš„çˆ¶ç±»ï¼Œå°è£…äº†æ‰€æœ‰å…·ä½“äº§å“ç±»çš„å…¬æœ‰æ–¹æ³•ã€‚ ConcreteProductï¼ˆå…·ä½“äº§å“ç±»ï¼‰ï¼šå®ƒæ˜¯ç®€å•å·¥å‚æ¨¡å¼åˆ›å»ºçš„ç›®æ ‡ï¼Œæ‰€æœ‰è¢«åˆ›å»ºçš„å¯¹è±¡éƒ½æ˜¯æŸä¸ªå…·ä½“äº§å“ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚  æ ¹æ®ç»“æ„å›¾å†™å‡ºçš„ä»£ç å¦‚ä¸‹ï¼š\n// æŠ½è±¡äº§å“ public interface Product { // å…¬æœ‰æ–¹æ³•  public void sameMethod(); } // å…·ä½“äº§å“A public class ConcreteProductA implements Product { public ConcreteProductA(){ System.out.println(\u0026#34;åˆ›å»ºäº§å“A\u0026#34;); } @Override public void sameMethod() { System.out.println(\u0026#34;è¿™æ˜¯äº§å“A\u0026#34;); } } // å…·ä½“äº§å“B public class ConcreteProductB implements Product{ public ConcreteProductB(){ System.out.println(\u0026#34;åˆ›å»ºäº§å“B\u0026#34;); } @Override public void sameMethod() { System.out.println(\u0026#34;è¿™æ˜¯äº§å“B\u0026#34;); } } å·¥å‚ç±»æ ¹æ®ä¼ å…¥å‚æ•°åˆ›å»ºå¯¹åº”çš„å…·ä½“äº§å“ï¼š\n// å·¥å‚ç±» public class Factory { public static Product getProduct(String args){ Product product = null; if(args.equalsIgnoreCase(\u0026#34;A\u0026#34;)){ product = new ConcreteProductA(); // å…¶ä»–æ“ä½œ...  } else if(args.equalsIgnoreCase(\u0026#34;B\u0026#34;)){ product = new ConcreteProductB(); // å…¶ä»–æ“ä½œ...  } return product; } } ä¸‹é¢æ˜¯å®¢æˆ·ç«¯ä»£ç ï¼š\n// å®¢æˆ·ç«¯ public class Client { public static void main(String[] args){ Product product; product = Factory.getProduct(\u0026#34;A\u0026#34;); product.sameMethod(); product = Factory.getProduct(\u0026#34;B\u0026#34;); product.sameMethod(); } } æœ€ç»ˆè¿è¡Œçš„ç»“æœå¦‚ä¸‹ï¼š\nåˆ›å»ºäº§å“A è¿™æ˜¯äº§å“A åˆ›å»ºäº§å“B è¿™æ˜¯äº§å“B æ–¹æ¡ˆçš„æ”¹è¿› è§‚å¯Ÿå®¢æˆ·ç«¯çš„ä»£ç å¯ä»¥å‘ç°ï¼Œæ¯æ›´æ¢ä¸€ä¸ªäº§å“éƒ½å¿…é¡»æ›´æ”¹å®¢æˆ·ç«¯çš„ä»£ç ï¼Œè¿™è¿åäº†å¼€é—­åŸåˆ™ã€‚æœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼å¯ä»¥å®ç°åœ¨ä¸ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹æ›´æ¢äº§å“å‘¢ï¼Ÿå½“å‰æœ‰ã€‚åœ¨Javaä¸­ï¼Œå¯ä»¥é‡‡å–é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œå°†factoryMethod()çš„å‚æ•°å­˜å‚¨åœ¨XMLæˆ–è€…propertiesæ ¼å¼çš„é…ç½®æ–‡ä»¶ä¸­ã€‚é€šè¿‡è¯»å–é…ç½®æ–‡ä»¶è·å–å‚æ•°ï¼Œç„¶åå®¢æˆ·ç«¯æ ¹æ®ä»é…ç½®æ–‡ä»¶å¾—åˆ°çš„å‚æ•°å»è°ƒç”¨å·¥å‚ç±»çš„é™æ€æ–¹æ³•ï¼Œè¿™å°±è¾¾åˆ°äº†ç›®çš„ã€‚\næ€»ç»“ ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼ï¼Œå®¢æˆ·ç«¯åªçŸ¥é“ä¼ å…¥å·¥å‚ç±»çš„å‚æ•°ï¼Œä¸å¿…å…³å¿ƒå¯¹è±¡æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Œå®ƒä¹Ÿä¸çŸ¥é“æ‰€åˆ›å»ºçš„äº§å“æ˜¯å“ªä¸€ä¸ªç±»ã€‚å·¥å‚ç±»çŸ¥é“æ¯ä¸€ä¸ªå…·ä½“äº§å“çš„åˆ›å»ºç»†èŠ‚ï¼Œå®ƒæ ¹æ®ä¼ å…¥å‚æ•°å†³å®šåˆ›å»ºå“ªä¸€ä¸ªå¯¹è±¡ä¾›å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œå®ç°äº†å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨çš„åˆ†ç¦»ã€‚ä½†æ˜¯ï¼Œå·¥å‚ç±»é›†ä¸­äº†æ‰€æœ‰äº§å“çš„åˆ›å»ºé€»è¾‘ï¼ŒèŒè´£è¿‡é‡ã€‚å½“å¢åŠ æ–°çš„äº§å“çš„æ—¶å€™ï¼Œä¸å¾—ä¸ä¿®æ”¹å·¥å‚ç±»çš„ä»£ç ï¼Œè¿™è¿åäº†å¼€é—­åŸåˆ™ï¼ŒåŒæ—¶ä¹Ÿä¸åˆ©äºç³»ç»Ÿçš„æ‰©å±•å’Œç»´æŠ¤ã€‚\n","href":"/notebook/reading_notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%BA%8C%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/","title":"ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°äºŒï¼šç®€å•å·¥å‚æ¨¡å¼"},{"content":" å•ä¾‹æ¨¡å¼(Singleton Pattern)ï¼šç¡®ä¿æŸä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸”è‡ªè¡Œå®ä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªç±»å°±æ˜¯å•ä¾‹ç±»ã€‚\n ä»å•ä¾‹æ¨¡å¼çš„å®šä¹‰æ¥çœ‹ï¼Œå®ƒæœ‰3ä¸ªè¦ç‚¹ï¼š\n å®ƒåªæœ‰å”¯ä¸€ä¸€ä¸ªå®ä¾‹ï¼› å®ƒå¿…é¡»è‡ªè¡Œåˆ›å»ºè¿™ä¸ªå®ä¾‹ï¼› å®ƒå¿…é¡»å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹ï¼›  åŸºæœ¬å®ç°æ–¹æ¡ˆ  å°†æ„é€ å‡½æ•°è®¾ä¸ºç§æœ‰ï¼Œç¡®ä¿å¤–ç•Œæ— æ³•é€šè¿‡ new åˆ›å»ºè¯¥å¯¹è±¡ï¼› æä¾›å…¬æœ‰çš„é™æ€æ–¹æ³•ï¼Œè¿”å›å•ä¾‹ç±»çš„å”¯ä¸€å®ä¾‹ï¼Œä¾›å¤–ç•Œè®¿é—®ï¼› åˆ›å»ºå”¯ä¸€çš„å®ä¾‹ï¼Œå¹¶é€šè¿‡å…¬æœ‰çš„é™æ€æ–¹æ³•è¿”å›ï¼›  å•ä¾‹æ¨¡å¼çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\næ ¹æ®è¿™ä¸ªå›¾ï¼Œå¯ä»¥å¾ˆå®¹æ˜“å†™å‡ºå¯¹åº”çš„ä»£ç ï¼š\n// å•ä¾‹ç±» public class Singleton { // ç§æœ‰é™æ€æˆå‘˜å˜é‡  private static Singleton instance = null; // ç§æœ‰æ„é€ å‡½æ•°  private Singleton(){} // å…¬æœ‰é™æ€æˆå‘˜æ–¹æ³•ï¼Œè¿”å›å•ä¾‹  public static Singleton getInstance(){ if(instance == null) instance = new Singleton(); return instance; } } é¥¿æ±‰å¼å•ä¾‹ç±»(Eager Singleton) é¥¿æ±‰å¼å•ä¾‹ç±»çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\nä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“ç±» åŠ è½½ çš„æ—¶å€™ï¼Œé™æ€å˜é‡instanceå°±ä¼šè¢«åˆå§‹åŒ–ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨ç§æœ‰çš„æ„é€ å‡½æ•°åˆ›å»ºç±»çš„å”¯ä¸€å®ä¾‹ã€‚ä»£ç å¦‚ä¸‹ï¼š\n// é¥¿æ±‰å¼å•ä¾‹ç±» public class EagerSingleton { private static final EagerSingleton instance = new EagerSingleton(); private EagerSingleton(){} public static EagerSingleton getInstance(){ return instance; } } æ‡’æ±‰å¼å•ä¾‹ç±»(Lazy Singleton) æ‡’æ±‰å¼å•ä¾‹ç±»çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\nä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå’Œé¥¿æ±‰å¼å•ä¾‹ä¸åŒçš„æ˜¯ï¼šæ‡’æ±‰å¼å•ä¾‹åœ¨ç±»åŠ è½½çš„æ—¶å€™ä¸å®ä¾‹åŒ–ï¼Œè€Œæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨getInstance()çš„æ—¶å€™æ‰è¢«å®ä¾‹åŒ–ã€‚è¿™å°±æ˜¯ å»¶è¿ŸåŠ è½½ï¼ˆLazy Loadï¼‰æŠ€æœ¯ ï¼Œä¹Ÿå°±æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ è½½å®ä¾‹ã€‚åœ¨Javaä¸­ï¼Œä¸ºäº†é¿å…å¤šä¸ªå¿åŸåŒæ—¶è°ƒç”¨getInstance()æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨å…³é”®å­— synchronized è¿›è¡Œçº¿ç¨‹é”å®š ã€‚ä»£ç å¦‚ä¸‹ï¼ˆè¿™ä¸ªæ–¹æ³•æœ‰ç¼ºé™·ï¼‰ï¼š\n// æœ‰ç¼ºé™·çš„æ‡’æ±‰ç±» public class LazySingleton1 { private static LazySingleton1 instance = null; private LazySingleton1(){} synchronized public static LazySingleton1 getInstance(){ if(instance == null) instance = new LazySingleton1(); return instance; } } ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ synchronized é”å®šäº†æ•´ä¸ªgetInstance()æ–¹æ³•ï¼Œä¼šå½±å“ç³»ç»Ÿçš„æ€§èƒ½ï¼Œä¸€ä¸ªæ”¹è¿›çš„æ–¹æ³•æ˜¯ï¼šåªé”å®šåˆ›å»ºå®ä¾‹çš„é‚£ä¸€è¡Œä»£ç ã€‚ä¿®æ”¹åçš„getInstance()æ–¹æ³•å¦‚ä¸‹ï¼š\npublic static LazySingleton1 getInstance(){ if(instance == null){ synchronized (LazySingleton1.class){ instance = new LazySingleton1(); } } return instance; } ä¸Šé¢çš„ä»£ç çœ‹ä¼¼è§£å†³äº†é—®é¢˜ï¼Œç„¶è€Œå¹¶æ²¡æœ‰ã€‚è€ƒè™‘æŸä¸€ç¬é—´ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨getInstance()æ–¹æ³•ï¼Œå¦‚æœæ­¤æ—¶instance == null,è¿™äº›çº¿ç¨‹å°±éƒ½èƒ½é€šè¿‡ifè¯­å¥çš„åˆ¤æ–­ã€‚ç”±äºä½¿ç”¨äº†synchronizedï¼Œåé¢çš„çº¿ç¨‹ä¼šå¤„äºæ’é˜Ÿç­‰å¾…çš„çŠ¶æ€ã€‚å½“å‰é¢çš„çº¿ç¨‹æ‰§è¡Œå®Œç”±synchronizedé”å®šçš„ä»£ç ä¹‹åï¼Œå®ä¾‹å·²ç»è¢«åˆ›å»ºï¼Œè€Œåé¢çš„çº¿ç¨‹æ­¤æ—¶å¹¶ä¸çŸ¥é“å®ä¾‹å·²ç»è¢«åˆ›å»ºçš„äº‹å®ï¼Œå¤©çœŸçš„åˆ›å»ºäº†æ–°çš„å®ä¾‹ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œç³»ç»Ÿä¸­å°±ä¼šå‡ºç°å¤šä¸ªå•ä¾‹å¯¹è±¡ï¼Œè¿™å°±è¿èƒŒäº†å•ä¾‹æ¨¡å¼çš„è®¾è®¡æ€æƒ³ã€‚ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šé‡‡ç”¨ åŒé‡æ£€æŸ¥é”å®šï¼ˆDouble-Check Lockingï¼‰ ã€‚ä¹Ÿå°±æ˜¯åœ¨synchronizedé”å®šçš„ä»£ç ä¸­å†è¿›è¡Œä¸€æ¬¡instance == null çš„åˆ¤æ–­ï¼Œè¿™æ ·åé¢çš„çº¿ç¨‹å°±ä¸ä¼šé€šè¿‡æ–°çš„åˆ¤æ–­æ¡ä»¶ï¼Œä¹Ÿå°±ä¸ä¼šæ–°å»ºçº¿ç¨‹äº†ã€‚ä½¿ç”¨åŒé‡é”å®šéœ€è¦ä½¿ç”¨Javaä¸­çš„volatileå…³é”®å­—ï¼Œè¢«å®ƒä¿®é¥°çš„æˆå‘˜å˜é‡å¯ä»¥ç¡®ä¿å¤šä¸ªçº¿ç¨‹éƒ½èƒ½æ­£ç¡®å¤„ç†ã€‚ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼š\n// é‡‡ç”¨åŒé‡æ£€æŸ¥é”å®šçš„æ‡’æ±‰ç±» public class LazySingleton2 { private volatile static LazySingleton2 instance = null; private LazySingleton2(){} public static LazySingleton2 getInstance(){ if(instance == null){ // ç¬¬ä¸€é‡åˆ¤æ–­  synchronized (LazySingleton2.class){ if(instance == null){ // ç¬¬äºŒé‡åˆ¤æ–­  instance = new LazySingleton2(); } } } return instance; } } ç”±äºä½¿ç”¨volatileå…³é”®å­—ä¼šå±è”½JVMæ‰€åšçš„ä¸€äº›ä»£ç ä¼˜åŒ–ï¼Œå› æ­¤ä½¿ç”¨DCLæ¥å®ç°å•ä¾‹æ¨¡å¼ä¹Ÿä¸å¤Ÿå®Œç¾ã€‚ä¸€ç§æ›´å¥½çš„å®ç°æ–¹æ³•æ˜¯ï¼šé‡‡ç”¨ IoDHæŠ€æœ¯ ã€‚\né‡‡ç”¨IoDHæŠ€æœ¯å®ç°å•ä¾‹æ¨¡å¼ Initialization on Demand Holder(IoDH)æŠ€æœ¯ å…‹æœé¥¿æ±‰ç±»å•ä¾‹å’Œæ‡’æ±‰ç±»å•ä¾‹çš„ç¼ºç‚¹ï¼Œæ—¢èƒ½å®ç°å»¶è¿ŸåŠ è½½ï¼Œåˆèƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚åœ¨å®ç°çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å•ä¾‹ç±»æ·»åŠ ä¸€ä¸ª é™æ€å†…éƒ¨ç±» ï¼Œç„¶ååœ¨è¿™ä¸ªé™æ€å†…éƒ¨ç±»ä¸­åˆ›å»ºå•ä¾‹å¯¹è±¡ï¼Œå†å°†è¯¥å•ä¾‹å¯¹è±¡è¿”å›ç»™å¤–ç•Œä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š\n// ä½¿ç”¨IoDHæŠ€æœ¯å®ç° public class BetterSingleton { private BetterSingleton(){} private static class HolderClass{ private final static BetterSingleton instance = new BetterSingleton(); } public static BetterSingleton getInstance(){ return HolderClass.instance; } } æ€»ç»“ ä¸€ç¯‡è¯»ä¹¦ç¬”è®°ä¸‹æ¥ï¼Œå¯¹å•ä¾‹æ¨¡å¼çš„ç†è§£æ›´æ˜¯åŠ æ·±äº†ä¸å°‘ï¼Œå°¤å…¶æ˜¯åŒé‡æ£€æŸ¥é”å®šæœºåˆ¶ã€‚æ€»çš„æ¥è¯´ï¼šå•ä¾‹æ¨¡å¼é€‚ç”¨äºç³»ç»Ÿåªéœ€è¦ä¸€ä¸ªå®ä¾‹å¯¹è±¡æˆ–è€…åªèƒ½é€šè¿‡ä¸€ä¸ªå…¬å…±è®¿é—®ç‚¹è®¿é—®å•ä¸ªå®ä¾‹çš„æƒ…å†µã€‚é‡‡ç”¨å•ä¾‹æ¨¡å¼ï¼Œèƒ½å¤Ÿå®ç°å¯¹å”¯ä¸€å®ä¾‹çš„è®¿é—®ï¼Œç”±äºåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å¯¹ç³»ç»Ÿèµ„æºçš„å ç”¨ï¼Œä¸å¤±ä¸ºä¸€ç§èŠ‚çº¦ç³»ç»Ÿèµ„æºçš„å¥½æ–¹å¼ã€‚ä½†æ˜¯ï¼Œå•ä¾‹æ¨¡å¼ç¼ºä¹æŠ½è±¡å±‚ï¼Œä¸åˆ©äºæ‰©å±•å’Œä»£ç çš„å¤ç”¨ã€‚è¿˜æœ‰å°±æ˜¯ï¼Œå•ä¾‹ç±»é€šå¸¸å…·æœ‰å¾ˆå¤šèŒè´£ï¼Œè¿™è¿èƒŒäº†SRPã€‚\n","href":"/notebook/reading_notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%89%BA%E6%9C%AF%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%B8%80%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/","title":"ã€Šè®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°ä¸€ï¼šå•ä¾‹æ¨¡å¼"},{"content":"","href":"/tags/%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/","title":"è®¾è®¡åŸåˆ™"},{"content":"","href":"/categories/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/","title":"è½¯ä»¶è®¾è®¡"},{"content":"åœ¨å­¦ä¹ è½¯ä»¶å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æˆ–å¤šæˆ–å°‘éƒ½å¬è¿‡ä¸€äº›ç»å…¸çš„è®¾è®¡åŸåˆ™ï¼Œæ¯”å¦‚å•ä¸€åŸåˆ™ï¼ˆDRYï¼‰ã€ç®€å•åŸåˆ™ï¼ˆKISSï¼‰ã€é¢å‘å¯¹è±¡åŸåˆ™ï¼ˆSOLIDï¼‰â€¦â€¦è¿™äº›è®¾è®¡åŸåˆ™éƒ½æ˜¯å‰è¾ˆä»¬åœ¨ç»éªŒä¸­æ€»ç»“å‡ºæ¥çš„ã€‚åœ¨å¼€å‘å¤§å‹å¤æ‚è½¯ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œå¼€å‘è€…é¢ä¸´è½¯ä»¶çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§ã€çµæ´»æ€§ã€å¯é‡ç”¨æ€§ç­‰è¯¸å¤šæ–¹é¢çš„æŒ‘æˆ˜ï¼Œçµæ´»åœ°ä½¿ç”¨è®¾è®¡åŸåˆ™èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°é¢å¯¹è¿™äº›æŒ‘æˆ˜ï¼Œè®¾è®¡å‡ºæ›´åŠ ä¼˜ç§€çš„è½¯ä»¶ã€‚\nè®¾è®¡åŸåˆ™æœ‰å¾ˆå¤šï¼Œæœ‰äº›åŸåˆ™æ˜¯ä¹‹é—´æ˜¯ç›¸äº’å†²çªçš„ï¼Œè€Œæœ‰äº›åŸåˆ™ä¹‹é—´åˆæ˜¯ç›¸äº’é‡å¤çš„ã€‚å¤§å®¶å¯èƒ½éƒ½æœ‰è¿™æ ·ä¸€ä¸ªæ„Ÿè§‰â€”â€”é“ç†éƒ½æ‡‚ï¼Œä½†æ˜¯åœ¨å®é™…è¿ç”¨æ—¶åˆä¼šå‡ºç°é€‰æ‹©å›°éš¾ï¼Œä¸çŸ¥ä»ä½•ä¸‹æ‰‹ã€‚å…¶å®ï¼Œè®¾è®¡åŸåˆ™æ˜¯ç”¨æ¥æŒ‡å¯¼ç¼–ç¨‹çš„ï¼Œæ¯ä¸ªåŸåˆ™éƒ½æœ‰è‡ªå·±é€‚ç”¨çš„èŒƒå›´ï¼Œé”™è¯¯åœ°ä½¿ç”¨å„å¤§åŸåˆ™å¾ˆå®¹æ˜“å¯¼è‡´é—®é¢˜ã€‚ä¸‹é¢æ˜¯å¯¹å¸¸ç”¨è®¾è®¡åŸåˆ™çš„ä¸€ä¸ªæ¦‚æ‹¬ï¼Œè¿™äº›åŸåˆ™ä¸ä»…éœ€è¦å¤šçœ‹å¤šç†è§£ï¼Œæ›´è¦å¤šå®è·µã€‚\nDRY åŸåˆ™ Don\u0026rsquo;t Repeat Yourselfã€‚ã€Šç¨‹åºå‘˜ä¿®ç‚¼ä¹‹é“ã€‹ä¸€ä¹¦ä¸­æ˜¯è¿™ä¹ˆè§£é‡Š DRY çš„ï¼šç³»ç»Ÿçš„æ¯ä¸€ä¸ªåŠŸèƒ½éƒ½åº”è¯¥æœ‰å”¯ä¸€çš„å®ç°ï¼Œå¦‚æœå¤šæ¬¡é‡åˆ°åŒæ ·çš„é—®é¢˜ï¼Œå°±åº”è¯¥æŠ½è±¡å‡ºä¸€ä¸ªå…±åŒçš„è§£å†³æ–¹æ³•ï¼Œè€Œä¸è¦é‡å¤å¼€å‘åŒæ ·çš„åŠŸèƒ½ä»£ç ã€‚è¿™ä¸ªåŸåˆ™å¾ˆç®€å•ï¼Œå¤§å®¶åœ¨å¹³å¸¸çš„ç¼–ç¨‹ä¸­ä¹Ÿç»å¸¸ä½¿ç”¨ã€‚æˆ‘ä»¬å¸¸å¬è¯´çš„â€œä¸è¦é‡å¤é€ è½®å­â€å°±æ˜¯å¯¹ DRY çš„ä¸€ç§è®¤çŸ¥ã€‚\nKISS åŸåˆ™ Keep It Simple and Stupidã€‚ä¿æŒä»£ç çš„ç®€å•ï¼Œå¿«é€Ÿè¿­ä»£æ‹¥æŠ±å˜åŒ–ã€‚ç¼–å†™å¯è¯»æ€§é«˜çš„ä»£ç ï¼Œèƒ½å¤Ÿå‡å°‘ä»–äººé˜…è¯»ä»£ç çš„æ—¶é—´æŠ•å…¥ã€‚\nYAGNI åŸåˆ™ You Ainâ€™t Gonna Need Itã€‚æœ‰æ—¶å€™ï¼Œå¾ˆå¤šå¼€å‘è€…éƒ½ä¼šå†™ä¸€äº›å¤šä½™çš„ä»£ç ï¼Œæƒ³ç€ä¸‡ä¸€ä»¥åå¯èƒ½ä¼šç”¨ä¸Šã€‚ä½†å®é™…ä¸Šï¼Œè¿™äº›å¤šçš„ä»£ç å¯èƒ½æ°¸è¿œéƒ½ä¸ä¼šç”¨ä¸Šï¼Œåè€Œä¼šå¯¹åŸæ¥çš„ä»£ç é€ æˆæ±¡æŸ“ï¼Œå¢åŠ åˆ«äººé˜…è¯»ç†è§£ä»£ç çš„éš¾åº¦ã€‚YAGNI å¸Œæœ›æˆ‘ä»¬ä¸è¦å†™å°†æ¥å¯èƒ½éœ€è¦ï¼Œä½†ç°åœ¨å´ç”¨ä¸ä¸Šçš„ä»£ç ã€‚YAGNI åŸåˆ™ä¸ KISS åŸåˆ™è”ç³»ç´§å¯†ï¼Œèƒ½å¤Ÿå¸®åŠ©æ›´å¥½åœ°å®ç° KISSã€€åŸåˆ™ã€‚\nè¿ªç±³ç‰¹æ³•åˆ™(Law of Demeter, LoD) ä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å°½å¯èƒ½å°‘çš„ä¸å…¶å®ƒå®ä½“å‘ç”Ÿä½œç”¨ã€‚å¦‚æœä¸€ä¸ªç³»ç»Ÿç¬¦åˆè¿ªç±³ç‰¹æ³•åˆ™ï¼Œé‚£ä¹ˆå½“å…¶ä¸­çš„æŸä¸€ä¸ªæ¨¡å—å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°±ä¼šå°½é‡å°‘çš„å½±å“å…¶å®ƒæ¨¡å—ã€‚åœ¨è®¾è®¡ç³»ç»Ÿçš„æ—¶å€™ï¼Œå°½é‡å‡å°‘å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡ä¹‹é—´ä¸å¿…å½¼æ­¤ç›´æ¥é€šä¿¡ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å°±ä¸åº”å½“å‘ç”Ÿä»»ä½•ç›´æ¥çš„ä½œç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡éœ€è¦è°ƒç”¨å¦ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªç¬¬ä¸‰è€…æ¥å®Œæˆè¿™ä¸ªè°ƒç”¨ã€‚è¿™å°±é™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ã€‚\nSOLID åŸåˆ™ åœ¨è®¾è®¡ä¸­ä½¿ç”¨è¿™äº›åŸåˆ™ï¼Œæœ‰åŠ©äºæé«˜è®¾è®¡æ¨¡å‹çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæé«˜ç±»çš„å…§èšåº¦ï¼Œé™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ã€‚\nå•ä¸€èŒè´£åŸåˆ™(Single Responsibility Principle, SRP) èŒè´£ å¯ä»¥ç†è§£ä¸º å¼•èµ·ç±»å˜åŒ–çš„åŸå› ã€‚ å°±ä¸€ä¸ªç±»è€Œè¨€ï¼Œåº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå›  ã€‚å¦‚æœä¸€ä¸ªç±»å…·æœ‰å¤šä¸ªèŒè´£ï¼Œé‚£ä¹ˆå°±æœ‰å¤šä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚è¿‡å¤šçš„èŒè´£è€¦åˆåœ¨ä¸€èµ·ï¼Œå½“å…¶ä¸­ä¸€ä¸ªèŒè´£å˜åŒ–æ—¶ï¼Œå¯èƒ½å½±å“åˆ°å…¶å®ƒèŒè´£çš„æ­£å¸¸è¿ä½œã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡ç±»çš„æ—¶å€™ï¼Œè¦å°†è¿™äº›èŒè´£åˆ†ç¦»ï¼Œå°†ä¸åŒçš„èŒè´£å°è£…åœ¨ä¸åŒçš„ç±»ä¸­ã€‚ç¡®ä¿å¼•èµ·è¯¥ç±»å˜åŒ–çš„åŸå› åªæœ‰ä¸€ä¸ªï¼Œä»è€Œæé«˜ç±»çš„å…§èšåº¦ã€‚\nå¼€é—­åŸåˆ™(Open-Closed Principle, OCP) ä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š è½¯ä»¶å®ä½“åº”è¯¥å°½å¯èƒ½åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹è¿›è¡Œæ‰©å±• ã€‚ä¸ºäº†æ»¡è¶³å¼€é—­åŸåˆ™ï¼Œéœ€è¦å¯¹ç³»ç»Ÿè¿›è¡Œ æŠ½è±¡åŒ– è®¾è®¡ï¼ŒæŠ½è±¡åŒ–æ˜¯å¼€é—­åŸåˆ™çš„å…³é”®ã€‚å¯ä»¥å…ˆå®šä¹‰å‡º æŠ½è±¡å±‚ ï¼Œç„¶åé€šè¿‡ å…·ä½“ç±» æ¥è¿›è¡Œæ‰©å±•ã€‚å½“éœ€è¦ä¿®æ”¹ç³»ç»Ÿçš„è¡Œä¸ºæ—¶ï¼Œä¸éœ€è¦æ”¹åŠ¨æŠ½è±¡å±‚ï¼Œåªéœ€è¦æ·»åŠ æ–°çš„å…·ä½“ç±»å°±èƒ½å®ç°æ–°çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œè¿™å°±åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„åŸºç¡€ä¸Šå®Œæˆäº†ç›®æ ‡ã€‚\né‡Œæ°æ›¿æ¢åŸåˆ™(Liskov Substitution Principle, LSP) å­ç±»åº”å½“å¯ä»¥æ›¿æ¢çˆ¶ç±»å¹¶å‡ºç°åœ¨çˆ¶ç±»èƒ½å¤Ÿå‡ºç°çš„ä»»ä½•åœ°æ–¹ ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šåœ¨è½¯ä»¶ä¸­å°†ä¸€ä¸ªçˆ¶ç±»å¯¹è±¡æ›¿æ¢æˆå®ƒçš„å­ç±»å¯¹è±¡ï¼Œç¨‹åºä¸ä¼šå‡ºç°ä»»ä½•çš„é—®é¢˜ï¼Œåè¿‡æ¥åˆ™ä¸ç„¶ã€‚é‡Œæ°æ›¿æ¢åŸåˆ™æ˜¯å®ç°å¼€é—­åŸåˆ™çš„é‡è¦æ–¹å¼ä¹‹ä¸€ã€‚ç”±äºä½¿ç”¨çˆ¶ç±»çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å­ç±»ï¼Œå› æ­¤åœ¨ç¨‹åºä¸­åº”è¯¥å°½é‡ä½¿ç”¨çˆ¶ç±»æ¥å¯¹å¯¹è±¡è¿›è¡Œå®šä¹‰ï¼Œè€Œåœ¨è¿è¡Œçš„æ—¶å€™å†ç¡®å®šå­ç±»ç±»å‹ï¼Œç”¨å­ç±»æ›¿æ¢çˆ¶ç±»å¯¹è±¡ã€‚å› æ­¤ï¼Œå¯ä»¥å°†çˆ¶ç±»å£°æ˜è®¾è®¡ä¸ºæŠ½è±¡ç±»æˆ–è€…æ¥å£ï¼Œè®©å­ç±»ç»§æ‰¿çˆ¶ç±»æˆ–è€…å®ç°çˆ¶ç±»æ¥å£å¹¶å®ç°çˆ¶ç±»å£°æ˜çš„æ–¹æ³•ã€‚åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œå­ç±»å®ä¾‹æ›¿æ¢çˆ¶ç±»å®ä¾‹ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰©å±•ç³»ç»Ÿçš„åŠŸèƒ½ï¼Œå¢åŠ æ–°çš„åŠŸèƒ½å¯ä»¥é€šè¿‡å¢åŠ æ–°çš„å­ç±»æ¥å®ç°ã€‚\nä¾èµ–å€’ç½®åŸåˆ™(Dependence Inversion Principle, DIP) æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”å½“ä¾èµ–äºæŠ½è±¡ ã€‚é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”å½“ä¾èµ–äº æŠ½è±¡ ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šè¦é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œå°½é‡ä½¿ç”¨é«˜å±‚çš„æŠ½è±¡ç±»æ¥å®ŒæˆåŠŸèƒ½ï¼Œè€Œä¸è¦ä½¿ç”¨å…·ä½“çš„ç±»æ¥åšè¿™äº›ã€‚ä¸ºæ­¤ï¼Œä¸€ä¸ªå…·ä½“ç±»åº”å½“åªå®ç°æ¥å£æˆ–è€…æŠ½è±¡ç±»ä¸­å£°æ˜è¿‡çš„æ–¹æ³•ï¼Œè€Œä¸è¦æœ‰å¤šä½™çš„æ–¹æ³•ï¼Œå¦åˆ™é«˜å±‚çš„æŠ½è±¡ç±»æ— æ³•è°ƒç”¨åˆ°åœ¨å­ç±»æ–°å¢åŠ çš„æ–¹æ³•ã€‚\nå¼•å…¥æŠ½è±¡å±‚ä¹‹åï¼Œç³»ç»Ÿçš„çµæ´»æ€§å˜é«˜ã€‚åœ¨ç¨‹åºä¸­å°½é‡ä½¿ç”¨æŠ½è±¡ç±»è¿›è¡Œç¼–ç¨‹ï¼Œè€Œå°†å…·ä½“ç±»å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå½“ç³»ç»Ÿéœ€è¦æ‰©å±•æ—¶ï¼Œåªéœ€è¦å¯¹æŠ½è±¡å±‚è¿›è¡Œæ‰©å±•å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ— éœ€æ”¹åŠ¨åŸæ¥çš„ä»£ç ã€‚\nä¾èµ–æ³¨å…¥çš„ä¸‰ç§æ–¹å¼ï¼š æ„é€ æ³¨å…¥ ã€ è®¾å€¼æ³¨å…¥ ã€ æ¥å£æ³¨å…¥ ã€‚\næ¥å£éš”ç¦»åŸåˆ™(Interface Segregation Principle, ISP) ä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£ï¼Œè€Œä¸ä½¿ç”¨ä¸€ä¸ªæ€»çš„æ¥å£ ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šå®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ã€‚å½“ä¸€ä¸ªæ¥å£å¤ªå¤§çš„æ—¶å€™ï¼Œéœ€è¦å°†å…¶åˆ’åˆ†ä¸ºä¸€äº›æ›´å°çš„æ¥å£ã€‚å¦‚æœæŠŠæ¥å£æ¯”å–»æˆè§’è‰²ï¼Œé‚£ä¹ˆä¸€ä¸ªæ¥å£åº”å½“åªæ‰®æ¼”ä¸€ä¸ªæˆ–è€…ä¸€ç±»è§’è‰²ã€‚\nç»„åˆ/èšåˆå¤ç”¨åŸåˆ™(Composite Reuse Principle, CRP) åº”å½“å°½é‡ä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œè€Œä¸æ˜¯ç»§æ‰¿æ¥è¾¾åˆ°å¤ç”¨çš„ç›®çš„ã€‚ç»§æ‰¿å¤ç”¨ä¼šç ´åå°è£…æ€§ï¼Œå› ä¸ºç»§æ‰¿ä¼šå°†çˆ¶ç±»çš„å®ç°ç»†èŠ‚æš´éœ²ç»™å­ç±»ã€‚å½“çˆ¶ç±»æ”¹å˜çš„æ—¶å€™ï¼Œå­ç±»ä¹Ÿå¿…é¡»è·Ÿç€æ”¹å˜ã€‚ç»„åˆ/èšåˆå…³ç³»å¯ä»¥å°†å·²æœ‰çš„å¯¹è±¡çº³å…¥æ–°çš„å¯¹è±¡ä¸­ï¼Œæ–°å¯¹è±¡å¯ä»¥è°ƒç”¨å·²æœ‰å¯¹è±¡çš„åŠŸèƒ½ï¼Œè€Œå·²æœ‰å¯¹è±¡çš„å†…éƒ¨å¯¹æ–°å¯¹è±¡æ˜¯ä¸å¯è§çš„ã€‚ç›¸å¯¹äºç»§æ‰¿æ¥è¯´ï¼Œè¿™ç§æ–¹å¼çš„è€¦åˆåº¦è¾ƒä½ï¼Œå·²æœ‰å¯¹è±¡çš„æ”¹å˜ä¸ä¼šç»™æ–°å¯¹è±¡å¸¦æ¥å¤ªå¤§çš„å½±å“ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸¤ä¸ªç±»ä¹‹é—´æ˜¯ Is-A å…³ç³»ï¼Œåº”å½“ä½¿ç”¨ç»§æ‰¿ï¼›å¦‚æœä¸¤ä¸ªç±»ä¹‹é—´æ˜¯ Has-A å…³ç³»ï¼Œåº”å½“ä½¿ç”¨ç»„åˆæˆ–è€…èšåˆã€‚\nå‚è€ƒèµ„æ–™  åˆ˜ä¼Ÿ. è®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ï¼šè½¯ä»¶å¼€å‘äººå‘˜å†…åŠŸä¿®ç‚¼ä¹‹é“. æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾, 2013.  ","href":"/posts/design_patterns/software_design_principles/","title":"è½¯ä»¶è®¾è®¡åŸåˆ™"},{"content":"","href":"/tags/leetcode/","title":"Leetcode"},{"content":"","href":"/categories/leetcode/","title":"Leetcode"},{"content":"è¿™æ˜¯Leetcoceä¸Šçš„ç¬¬279ä¸ªé—®é¢˜ï¼Œè§£é¢˜çš„æ–¹æ³•å¾ˆæœ‰å¯å‘æ„ä¹‰ï¼Œä»¥æ­¤å¤‡å¿˜ã€‚\né¢˜ç›®æè¿° ç»™å®šæ­£æ•´æ•° nï¼Œæ‰¾åˆ°è‹¥å¹²ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼ˆæ¯”å¦‚ 1, 4, 9, 16, \u0026hellip;ï¼‰ä½¿å¾—å®ƒä»¬çš„å’Œç­‰äº nã€‚ä½ éœ€è¦è®©ç»„æˆå’Œçš„å®Œå…¨å¹³æ–¹æ•°çš„ä¸ªæ•°æœ€å°‘ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: n = 12 è¾“å‡º: 3 è§£é‡Š: 12 = 4 + 4 + 4. ç¤ºä¾‹ 2:\nè¾“å…¥: n = 13 è¾“å‡º: 2 è§£é‡Š: 13 = 4 + 9. è§£å†³æ–¹æ¡ˆ ä¸€ä¸ªé”™è¯¯çš„æ–¹æ³• æœ€å¼€å§‹çš„æƒ³æ³•æ˜¯ä¾æ¬¡å¯¹æ¯ä¸ªæ•°è¿›è¡Œå¼€æ–¹æ“ä½œï¼Œè¿™æ ·èƒ½å¤Ÿæ‰¾åˆ°æ¯”å®ƒå°çš„æœ€æ¥è¿‘å®ƒçš„å®Œå…¨å¹³æ–¹æ•°ã€‚ä»£ç å¦‚ä¸‹ï¼š\nprivate int numSquares1(int n){ int step = 0; while(n \u0026gt; 0){ n -= Math.pow((int)(Math.sqrt(n)), 2); step ++; } return step; } è¿™æ®µä»£ç ä½¿ç”¨çš„æ˜¯è´ªå¿ƒç®—æ³•çš„æ€æƒ³ï¼Œæ¯æ¬¡æ‰¾æ¯” n å°çš„æœ€å¤§çš„å®Œå…¨å¹³æ–¹æ•°ã€‚é”™è¯¯çš„åŸå› æ˜¯ï¼šè¿™ä¸ªè´ªå¿ƒç­–ç•¥åœ¨è¿™é‡Œ å¹¶ä¸é€‚ç”¨ ã€‚é¢˜ç›®ä¸­å°±æœ‰ä¸€ä¸ªåä¾‹ï¼š\n12 = 4 + 4 + 4 ä¸€ä¸ªæ­£ç¡®çš„æ–¹å¼ è´ªå¿ƒç­–ç•¥ä¸é€‚ç”¨ï¼Œåˆä¸æƒ³ä½¿ç”¨æš´åŠ›è§£æ³•ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰å¥½ä¸€ç‚¹çš„è§£é¢˜æ–¹æ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼šå¯ä»¥æŠŠåŸé—®é¢˜è½¬åŒ–ä¸ºä¸€ä¸ª å›¾è®º ä¸­çš„é—®é¢˜ã€‚è½¬åŒ–æ–¹æ³•å¦‚ä¸‹ï¼š\n å¯¹äºä» n åˆ° 0 çš„æ¯ä¸€ä¸ªæ•°å­—ï¼Œè®©å…¶æˆä¸ºå›¾ä¸­çš„ä¸€ä¸ªé¡¶ç‚¹ï¼› å¦‚æœå›¾ä¸­çš„ä¸¤ä¸ªæ•°å­—ä¹‹é—´ç›¸å·®ä¸€ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼Œåˆ™è¿æ¥å®ƒä»¬ï¼›  è¿™æ ·ä¸€æ¥ï¼ŒåŸæ¥çš„é—®é¢˜å°±è½¬åŒ–ä¸ºæ±‚ï¼šn åˆ° 0 ä¹‹é—´çš„ æœ€çŸ­è·¯å¾„ çš„é—®é¢˜ã€‚ä½¿ç”¨å¹¿åº¦ä¼˜å…ˆéå†çš„ç­–ç•¥å°±å¯ä»¥æ‰¾å‡ºç­”æ¡ˆã€‚\njavaä»£ç å¦‚ä¸‹ï¼š\n/** * æœ€å¼€å§‹æ˜¯æƒ³ç”¨è´ªå¿ƒç®—æ³•æ¥æ±‚è§£ï¼Œä½†æ˜¯åæ¥å‘ç°è´ªå¿ƒç®—æ³•åœ¨è¿™é‡Œå¹¶ä¸é€‚ç”¨ã€‚æ¯”å¦‚:12 = 4 + 4 + 4; * è¿™é‡Œå¯ä»¥å°†é—®é¢˜è½¬åŒ–ä¸ºä¸€ä¸ªæ±‚å›¾ä¸­çš„æœ€çŸ­è·¯å¾„çš„é—®é¢˜ï¼š * ä»nåˆ°0,æ¯ä¸ªæ•°å­—è¡¨ç¤ºä¸€ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœä¸¤ä¸ªæ•°å­—ä¹‹é—´ç›¸å·®ä¸€ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼Œåˆ™è¿æ¥å®ƒä»¬ã€‚ * æœ€ç»ˆä¼šå¾—åˆ°ä¸€ä¸ªæ— æƒå›¾ï¼Œæ­¤æ—¶åŸé—®é¢˜å°±è½¬åŒ–ä¸ºæ±‚è¿™ä¸ªæ— æƒå›¾ä¸­nåˆ°0çš„æœ€çŸ­è·¯å¾„ã€‚ * ä½¿ç”¨BFSçš„æ€æƒ³å¯¹å›¾è¿›è¡Œå±‚åºéå†ï¼Œä»næ‰€åœ¨å±‚åˆ°0æ‰€åœ¨å±‚ * @param n ç»™å®šçš„æ­£æ•´æ•°n * @return å’Œä¸ºnéœ€è¦çš„æœ€å°‘çš„å®Œå…¨å¹³æ–¹æ•° */ private int numSquares(int n){ if(n \u0026lt;= 0){ return 0; } int step = 0; // å­˜æ”¾æœ€ç»ˆç»“æœ  Queue\u0026lt;Integer\u0026gt; queue = new LinkedList\u0026lt;\u0026gt;(); queue.offer(n); // åˆå§‹èŠ‚ç‚¹nå…¥é˜Ÿ  int size = queue.size(); // ä¿å­˜å½“å‰å±‚çš„èŠ‚ç‚¹æ•°  while(!queue.isEmpty()){ if(size == 0){ size = queue.size(); step ++; } int number = queue.poll(); // é˜Ÿé¦–å…ƒç´ å‡ºé˜Ÿ  size --; if(number == 0){ return step; // åˆ°è¾¾ç»ˆç‚¹0ï¼Œç»“æŸç¨‹åº  } for(int i = 1;number \u0026gt;= i * i;i ++){ // numberå†…è¿˜å­˜åœ¨å®Œå…¨å¹³æ–¹æ•°  queue.offer(number - i * i); } } } ä¸å¹¸çš„æ˜¯ï¼šè¿™æ®µä»£ç åœ¨Leetcodeä¸Š è¶…æ—¶ äº†ã€‚\näºæ˜¯æˆ‘æ”¹ç”¨äº† Pair\u0026lt;\u0026gt; å¯¹çš„å½¢å¼ï¼Œå‡å°‘äº†å¯¹ä¸Šé¢ä»£ç ä¸­sizeå–å€¼çš„åˆ¤æ–­æ¬¡æ•°ï¼ŒæœŸæœ›ç¨‹åºèƒ½å¿«ä¸€ç‚¹ã€‚ä»£ç å¦‚ä¸‹ï¼š\nprivate int numSquares2(int n){ if(n \u0026lt;= 0){ return 0; } int step = 0; // å­˜æ”¾æœ€ç»ˆç»“æœ  Queue\u0026lt;Pair\u0026lt;Integer, Integer\u0026gt;\u0026gt; queue = new LinkedList\u0026lt;\u0026gt;(); queue.offer(new Pair\u0026lt;\u0026gt;(n, 0)); // åˆå§‹èŠ‚ç‚¹nå…¥é˜Ÿ  while(!queue.isEmpty()){ Pair\u0026lt;Integer, Integer\u0026gt; pair = queue.poll(); // é˜Ÿé¦–å…ƒç´ å‡ºé˜Ÿ  int number = pair.getKey(); step = pair.getValue(); if(number == 0){ return step; // åˆ°è¾¾ç»ˆç‚¹0ï¼Œç»“æŸç¨‹åº  } for(int i = 1;number - i * i \u0026gt;= 0;i ++){ // numberå†…è¿˜å­˜åœ¨å®Œå…¨å¹³æ–¹æ•°  queue.offer(new Pair\u0026lt;\u0026gt;(number - i * i, step + 1)); } } return step; } ç„¶è€Œï¼šè¿˜æ˜¯ è¶…æ—¶ äº†ã€‚\näºæ˜¯æˆ‘å¼€å§‹ä»”ç»†çœ‹è¿™ä¸€æ®µä»£ç ï¼Œå‘ç°äº†å¼•èµ·æ€§èƒ½é—®é¢˜çš„æœ€å¤§åŸå› ï¼šå¯¹äºè¾ƒå¤§çš„æ•°å­—ï¼Œæ¯æ¬¡æ‰§è¡Œforå¾ªç¯çš„æ—¶å€™ï¼Œéƒ½ä¼šå¾€é˜Ÿåˆ—ä¸­æ¨å…¥å¾ˆå¤šé‡å¤çš„è·¯å¾„ã€‚æ¯”å¦‚è¦åˆ°è¾¾æ•°å­—1æ‰€åœ¨çš„èŠ‚ç‚¹ï¼Œå¯èƒ½ä»2ã€5ã€10ã€17ã€26\u0026hellip;å‡ºå‘ ã€‚åªè¦å‡å°‘äº†é‡å¤çš„è·¯å¾„ï¼Œç¨‹åºçš„æ€§èƒ½åº”è¯¥å°±ä¼šæœ‰ä¸å°‘çš„æå‡ã€‚ä¸ºäº†è§£å†³é‡å¤å¤è®¿é—®çš„é—®é¢˜ï¼Œæˆ‘æ–°å¼€äº†ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥åˆ¤æ–­æŸä¸ªèŠ‚ç‚¹æ˜¯å¦å·²è¢«è®¿é—®ï¼Œç°åœ¨åªå°†æ²¡æœ‰è¢«è®¿é—®è¿‡çš„èŠ‚ç‚¹æ¨å…¥é˜Ÿåˆ—ã€‚\njavaä»£ç å¦‚ä¸‹ï¼š\nprivate int numSquares3(int n){ if(n \u0026lt;= 0){ return 0; } int step = 0; // å­˜æ”¾æœ€ç»ˆç»“æœ  Queue\u0026lt;Pair\u0026lt;Integer, Integer\u0026gt;\u0026gt; queue = new LinkedList\u0026lt;\u0026gt;(); queue.offer(new Pair\u0026lt;\u0026gt;(n, 0)); // åˆå§‹èŠ‚ç‚¹nå…¥é˜Ÿ  boolean[] visited = new boolean[n + 1]; // ç”¨æ¥ä¿å­˜å·²ç»è®¿é—®è¿‡çš„èŠ‚ç‚¹  visited[n] = true; while(!queue.isEmpty()){ Pair\u0026lt;Integer, Integer\u0026gt; pair = queue.poll(); // é˜Ÿé¦–å…ƒç´ å‡ºé˜Ÿ  int number = pair.getKey(); step = pair.getValue(); if(number == 0){ return step; // åˆ°è¾¾ç»ˆç‚¹0ï¼Œç»“æŸç¨‹åº  } for(int i = 1;number - i * i \u0026gt;= 0;i ++){ // numberå†…è¿˜å­˜åœ¨å®Œå…¨å¹³æ–¹æ•°  if(!visited[number - i * i]) { queue.offer(new Pair\u0026lt;\u0026gt;(number - i * i, step + 1)); visited[number - i * i] = true; // æ›´æ–°visited[]  } } } return step; } Accepted!è€¶~\nç»ˆäºèƒ½å¤Ÿçœ‹åˆ°ç”¨æ—¶æçŸ­çš„ç­”æ¡ˆæ˜¯æ€ä¹ˆåšçš„äº†ã€‚åŸæ¥å®ƒä»¬ä½¿ç”¨äº† æ•°è®º çš„çŸ¥è¯†ã€‚æˆ‘èµ¶ç´§å»è¡¥äº†ä¸€ä¸‹ å››å¹³æ–¹å®šç† ã€‚\nå››å¹³æ–¹å’Œå®šç† ï¼šä»»ä½•ä¸€ä¸ªæ­£æ•´æ•°éƒ½å¯ä»¥è¡¨ç¤ºæˆä¸è¶…è¿‡å››ä¸ªæ•´æ•°çš„å¹³æ–¹ä¹‹å’Œã€‚\næ¨è®º ï¼š å½“næ˜¯å½¢å¦‚:\\(4^a(8b + 7)(a \u0026gt;= 0;b \u0026gt;= 0)\\)nä¸èƒ½è¡¨ç¤ºæˆ3ä¸ªæ•´æ•°çš„å¹³æ–¹å’Œ\nå€ŸåŠ©è¿™ä¸¤æ¡å®šç†ï¼Œæˆ‘è‡ªå·±å®ç°äº†ä¸€ä¸‹ã€‚ javaä»£ç å¦‚ä¸‹ï¼š\n// ä½¿ç”¨å››å¹³æ–¹å’Œå®šç†åŠå…¶æ¨è®º  private int numSquares4(int n){ while(n % 4 == 0){ n /= 4; } if(n % 8 == 7){ return 4; } // åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ç”±ä¸€ä¸ªè¿˜æ˜¯ä¸¤ä¸ªå¹³æ–¹æ•°ç»„æˆ  int r = (int)Math.sqrt(n); if(r * r == n){ return 1; } for(int t = 1;t * t \u0026lt;= n;t ++){ int k = (int)Math.sqrt(n - t * t); if(k * k + t * t == n){ return 2; } } return 3; } ","href":"/posts/leetcode/perfect-squares/","title":"å®Œå…¨å¹³æ–¹æ•°"},{"content":"è¿™æ˜¯Leetcodeä¸Šçš„ç¬¬215é¢˜ï¼šæ•°ç»„ä¸­çš„ç¬¬kä¸ªæœ€å¤§å…ƒç´ ã€‚\né—®é¢˜æè¿° åœ¨æœªæ’åºçš„æ•°ç»„ä¸­æ‰¾åˆ°ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚è¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ k ä¸ªä¸åŒçš„å…ƒç´ ã€‚\nç¤ºä¾‹ 1:\nè¾“å…¥: [3,2,1,5,6,4] å’Œ k = 2 è¾“å‡º: 5 ç¤ºä¾‹ 2:\nè¾“å…¥: [3,2,3,1,2,4,5,5,6] å’Œ k = 4 è¾“å‡º: 4 è§£å†³æ–¹æ¡ˆ æä¾›ä¸¤ç§è§£æ³•ï¼Œä¸€ç§æ˜¯ä½¿ç”¨å¿«é€Ÿæ’åºçš„è§£æ³•ï¼Œä¸€ç§æ˜¯ä½¿ç”¨åˆ’åˆ†æ€æƒ³ä½†ä¸æ’åºçš„è§£æ³•ã€‚\nä½¿ç”¨æ’åº è¦æ‰¾å‡ºæ•°ç»„ä¸­ç¬¬Kä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œæœ€ç›´è§‚çš„æ–¹æ³•å°±æ˜¯å…ˆå°†åŸæ•°ç»„æŒ‰ç…§éé€’å¢é¡ºåºæ’åºï¼Œç„¶åè¿”å›ç¬¬Kä¸ªå…ƒç´ ã€‚æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯å¿«é€Ÿæ’åºã€‚\nå¿«é€Ÿæ’åºéœ€è¦å…ˆå¯¹æ•°ç»„è¿›è¡Œåˆ’åˆ†ï¼Œåˆ’åˆ†çš„ä»£ç å¦‚ä¸‹ï¼š\n/** * æ€»æ˜¯ä½¿ç”¨æœ€å³ç«¯çš„å…ƒç´ A[r]å°†æ•°ç»„A[p..r]åˆ’åˆ†ä¸ºA[p..q - 1]ã€A[q]ã€A[q + 1..r] * A[p..q - 1] \u0026gt;= A[q] * A[q + 1..r] \u0026lt; A[q] * @param A å¾…åˆ’åˆ†æ•°ç»„ * @param p ä¸‹ç•Œ * @param r ä¸Šç•Œ * @return q */ private int partition(int[] A, int p, int r){ int x = A[r]; // ä¿å­˜æœ€å³ç«¯å…ƒç´   int i = p - 1; // iæœ€ç»ˆæŒ‡å‘A[p..q - 1]ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´   for(int j = p;j \u0026lt;= r - 1;j++){ if(A[j] \u0026gt;= x){ i ++; exchange(A, i, j); // å°†ä¸å°äºA[q]çš„å…ƒç´ A[j]æ”¾åˆ°A[p..q - 1]ä¸­ï¼ŒåŒæ—¶ä¸€ä¸ªå°äºA[q]çš„å…ƒç´ è¢«æ”¾åˆ°A[q + 1..r]ä¸­  } } exchange(A, i + 1, r); // å°†æœ€å³ç«¯çš„å…ƒç´ æ”¾åˆ°æ­£ç¡®ä½ç½®  return i + 1; } æ¥ä¸‹æ¥æ˜¯å¯»æ‰¾ç¬¬Kä¸ªæœ€å¤§çš„å…ƒç´ äº†ï¼š\nprivate void quickSort(int[] nums, int p, int r){ if(p \u0026lt; r){ int q = partition(nums, p, r); quickSort(nums, p, q - 1); quickSort(nums, q + 1, r); } } public int findKthLargest(int[] nums, int k){ int p = 0, r = nums.length - 1; quickSort(nums, p, r); return nums[k - 1]; } ä½¿ç”¨åˆ’åˆ† åˆ©ç”¨å¿«é€Ÿæ’åºä¸­åˆ’åˆ†çš„æ€æƒ³ï¼Œå‡å®šå§‹ç»ˆé€‰å–æ•°ç»„A[0..n-1]ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆåˆ’åˆ†åå®ƒåœ¨æ•°ç»„ä¸­çš„ä½ç½®ä¸ºqï¼‰ä½œä¸ºå‚ç…§ç‚¹ï¼Œåˆ’åˆ†åçš„ç»“æœä¸ºï¼šA[1..n-1]åœ¨åˆ’åˆ†åç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œä»å·¦åˆ°å³ä¾æ¬¡ä¸ºï¼š\n A[0..q-1]: å‡ä¸å°äºA[q]; A[q] A[q+1..n-1]:å‡å°äºA[q];  ç”±æ­¤å¯ç¡®å®šç¬¬Kå¤§çš„å…ƒç´ çš„ä½ç½®ï¼š\n k = q + 1: è¿”å›A[q]; k \u0026lt; q + 1: åœ¨A[0..q-1]ä¸­ç»§ç»­å¯»æ‰¾ç¬¬Kå¤§çš„å…ƒç´  k \u0026gt; q + 1ï¼š åœ¨A[q+1..n-1]ä¸­ç»§ç»­å¯»æ‰¾ç¬¬(k - q + 1)å¤§çš„å…ƒç´   é€’å½’ç‰ˆæœ¬çš„ä»£ç å¦‚ä¸‹ï¼š\nprivate int findKthLargestHelper(int[] nums, int k, int p, int r){ int q = partition(nums, p, r); if(k == q + 1){ return nums[q]; } else if(k \u0026lt; q + 1){ return findKthLargestHelper(nums, k, p, q - 1); } else{ return findKthLargestHelper(nums, k - q + 1, q + 1, r); } } è¿­ä»£ç‰ˆæœ¬åšäº†ä¸€ç‚¹æ”¹åŠ¨ï¼Œä»£ç å¦‚ä¸‹ï¼š\nprivate int findKthLargestHelperIteratively(int[] nums, int k, int p, int r){ int q = partition(nums, p, r); while(k != q + 1){ if(k \u0026lt; q + 1){ q = partition(nums, p, q - 1); } else{ q = partition(nums, q + 1, r); } } return nums[q]; } ","href":"/posts/leetcode/%E5%AF%BB%E6%89%BE%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E7%AC%ACk%E4%B8%AA%E6%9C%80%E5%A4%A7%E7%9A%84%E5%85%83%E7%B4%A0/","title":"å¯»æ‰¾æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§çš„å…ƒç´ "},{"content":"é—®é¢˜æè¿° è·å…°å›½æ——é—®é¢˜(Dutch national flag problem)æ˜¯Dijkstraæå‡ºçš„ä¸€ä¸ªç»å…¸çš„ç¼–ç¨‹ç»ƒä¹ ã€‚åŸé—®é¢˜å¤§æ¦‚æ˜¯è¿™æ ·è¯´çš„ï¼š\n Dijkstra used the Dutch National Flag Problem* as a structured programming exercise in program derivation and program proof. Given `N' objects coloured red, white or blue, sort them so that objects of the same colour are adjacent, with the colours in the order red, white and blue.\n Leetcodeä¸Šçš„ç¬¬75é¢˜â€”â€”åˆ†ç±»é¢œè‰²è€ƒæŸ¥çš„ä¹Ÿæ­£æ˜¯è¿™ä¸ªé—®é¢˜ã€‚\nè§£å†³æ–¹æ¡ˆ ä½¿ç”¨ä»»æ„ä¸€ç§æ’åºç®—æ³• è¿™å…¶å®æ˜¯ä¸€ä¸ªå¯¹æ•°ç»„å…ƒç´ è¿›è¡Œæ’åºçš„é—®é¢˜ï¼Œå› æ­¤ä½¿ç”¨ä»»æ„ä¸€ç§æ’åºç®—æ³•å‡å¯ä»¥è¾¾åˆ°ç›®çš„ã€‚\nä½¿ç”¨è®¡æ•°æ’åº ä¸€ä¸ªè¾ƒä¸ºæ–¹ä¾¿çš„æ’åºç®—æ³•æ˜¯ä½¿ç”¨è®¡æ•°æ’åºï¼Œç»Ÿè®¡æ¯ç§é¢œè‰²å‡ºç°çš„æ¬¡æ•°ï¼Œç„¶åæŒ‰ç…§çº¢ã€ç™½ã€è“(ä½¿ç”¨0,1,2ä»£è¡¨çº¢ã€ç™½ã€è“)çš„å‡ºç°çš„æ¬¡æ•°æ’åºï¼Œé‡å†™å½“å‰æ•°ç»„ï¼Œè¿™æ­£æ˜¯è®¡æ•°æ’åºçš„æ€æƒ³ã€‚è¿™ä¸ªæ–¹æ³•è¦æ‰«æä¸¤éæ•°ç»„ï¼šç¬¬ä¸€éç»Ÿè®¡å„å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼›ç¬¬äºŒéé‡å†™å½“å‰æ•°ç»„ã€‚è¿˜éœ€è¦å¼€è¾Ÿé¢å¤–çš„ç©ºé—´æ¥æ”¯æŒè®¡æ•°è¿™ä¸ªæ“ä½œã€‚\n æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(n); ç©ºé—´å¤æ‚åº¦ä¸ºï¼šO(k), kä¸ºå…ƒç´ çš„å–å€¼èŒƒå›´;  Javaå®ç° private void countingSort(int[] nums){ int[] c = new int[3]; int n = nums.length; for(int i = 0;i \u0026lt; n;i++){ c[nums[i]] ++; } int k = 0; for(int i = 0;i \u0026lt; 3;i++){ for(int j = 0;j \u0026lt; c[i];j++){ nums[k ++] = i; } } } ä½¿ç”¨åˆ’åˆ† å¦ä¸€ç§è§£æ³•å°±æ˜¯åˆ©ç”¨å¿«é€Ÿæ’åºä¸­ä¸‰è·¯åˆ’åˆ†çš„æ€æƒ³ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯åªéœ€è¦æ‰«æä¸€è¶Ÿæ•°ç»„ã€‚åˆ’åˆ†è¿‡ç¨‹ä¸­åŸæ¥çš„æ•°ç»„ç”±å››éƒ¨åˆ†ç»„æˆï¼Œä»å·¦åˆ°å³ä¾æ¬¡ä¸ºï¼šå…¨0ï¼Œå…¨1ï¼Œæœªå¤„ç†ï¼Œå…¨2ã€‚åˆå§‹ç¤ºæ„å›¾å¦‚ä¸‹ï¼š è¿è¡Œè¿‡ç¨‹ä¸­ç¤ºæ„å›¾å¦‚ä¸‹ï¼š è¿™æ ·æ— éœ€å¼€è¾Ÿæ–°çš„æ•°ç»„ã€‚\n æ—¶é—´å¤æ‚åº¦ï¼šO(n); ç©ºé—´å¤æ‚åº¦ï¼šO(1);  Javaå®ç° public void tripartition(int[] nums){ int n = nums.length; int zero = -1; // ä»å·¦åˆ°å³æŒ‡å‘æœ€å³çš„é‚£ä¸ª0  int two = n; // ä»å³åˆ°å·¦æŒ‡å‘æœ€å·¦çš„é‚£ä¸ª2  int i = 0; // ç”¨æ¥éå†æ•°ç»„  while(i \u0026lt; two){ switch (nums[i]){ case 0: exchange(nums, ++zero, i ++);break; // nums[i] = 0,å°†å®ƒä¸æœ€å³ä¾§çš„é‚£ä¸ª1äº¤æ¢  case 1: i ++;break; // nums[i] = 1,æŒ‡é’ˆå‰è¿›ä¸€æ­¥  case 2: exchange(nums, -- two, i);break; // nums[i] = 2,å°†å®ƒä¸æœ€å·¦ä¾§çš„é‚£ä¸ª2çš„å‰ä¸€ä¸ªå…ƒç´ äº¤æ¢  default: break; } } } ","href":"/posts/leetcode/%E8%8D%B7%E5%85%B0%E5%9B%BD%E6%97%97%E9%97%AE%E9%A2%98/","title":"è·å…°å›½æ——é—®é¢˜"},{"content":"","href":"/tags/life/","title":"Life"},{"content":" åœ¨åŒ—é‚®ä¸€å¹´çš„äº¤æ¢å­¦ä¹ å·²ç»ç»“æŸã€‚ä»”ç»†æƒ³æƒ³æˆ‘è¿™ä¸€å¹´ï¼Œå¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆå€¼å¾—ä¸€æçš„ã€‚åœ¨æˆ‘çš„å°è±¡é‡Œï¼Œç¬¬ä¸€å­¦æœŸçš„å¤§å¤šæ•°æ—¶é—´éƒ½èŠ±åœ¨äº†å­¦æ ¡å¼€è®¾çš„è¯¾ç¨‹ä¸Šï¼Œæ€»æ˜¯åœ¨å®Œæˆè¯¾ç¨‹ä½œä¸šæˆ–è€…ç›¸å…³çš„ä¸œè¥¿ï¼Œå–å¾—ä¸€ä¸ªçœ‹èµ·æ¥è¿˜ä¸é”™çš„æˆç»©çœŸå¿ƒä¸å®¹æ˜“ã€‚å‡ºäºå¯¹æ–°åœ°æ–¹çš„å¥½å¥‡æ„Ÿï¼Œåœ¨å‘¨æœ«ï¼Œæˆ‘æ€»æ˜¯å–œæ¬¢å‡ºå»è½¬è½¬ï¼Œä¸€ä¸ªå­¦æœŸä¸‹æ¥ï¼Œæˆ‘å¯¹åŒ—äº¬çš„äº†è§£ç¨‹åº¦å±…ç„¶è¶…è¿‡äº†å·²ç»åœ¨åŒ—äº¬ä¸Šäº†ä¸¤å¹´å¤§å­¦çš„å®¤å‹ã€‚\n  åˆ°äº†ç¬¬äºŒå­¦æœŸï¼Œè¯¾ç¨‹æ•°é‡åªæœ‰ç¬¬ä¸€å­¦æœŸçš„ä¸€åŠï¼Œè¿™å°±æœ‰äº†å¤§é‡å¯æ”¯é…çš„è‡ªç”±æ—¶é—´ã€‚æˆ‘å˜å¾—ç©ºé—²ä¸‹æ¥ï¼Œè¿™ä¸ªæ—¶å€™å¼€å§‹æ€è€ƒè‡ªå·±æ¥ä¸‹æ¥åˆ°åº•è¯¥åšä»€ä¹ˆã€‚åˆšå¼€å­¦çš„3æœˆä»½ï¼ŒåŒ—é‚®å°±æœ‰ä¸å°‘äººå¼€å§‹å‡†å¤‡è€ƒç ”äº†ã€‚å¯¹äºè€ƒç ”ï¼Œæˆ‘ä¹Ÿé™·å…¥äº†çŠ¹è±«å½“ä¸­ï¼Œè¿‡äº†ä¸€ä¸ªæœˆï¼Œæˆ‘æ„è¯†åˆ°å†è¿™ä¹ˆçŠ¹è±«ä¸‹å»æ˜¯ä¸è¡Œçš„ã€‚äºæ˜¯æˆ‘å†³å®šä¹°ä¸€æœ¬ã€Šææ°¸ä¹æ•°å­¦å¤ä¹ å…¨ä¹¦ã€‹ï¼Œå…ˆåšåšè¯•è¯•çœ‹ã€‚ä¸¤ä¸ªæœˆè¿‡å»äº†ï¼Œã€Šå…¨ä¹¦ã€‹ä¹Ÿçœ‹å®Œäº†ã€‚ç„¶åæˆ‘å‘ç°ï¼Œæˆ‘çš„å†…å¿ƒæ˜¯æŠ—æ‹’è€ƒç ”çš„ï¼Œæˆ‘æ›´åŠ å€¾å‘äºæ¯•ä¸šåç›´æ¥å·¥ä½œã€‚äºæ˜¯æˆ‘ä¸¢å¼ƒäº†é‚£æœ¬å……æ»¡ç¬”å¢¨çš„ã€Šå…¨ä¹¦ã€‹ï¼Œå¼€å§‹æ€è€ƒå°±ä¸šçš„äº‹æƒ…ã€‚ä¹Ÿå¼€å§‹å¤ä¹ è‡ªå·±çš„ä¸“ä¸šæŠ€èƒ½ã€‚\n  çœŸæ­£è®©æˆ‘è·ç›Šå¾ˆå¤§çš„æ˜¯ç¬¬äºŒä¸ªå­¦æœŸçš„é‚£äº›ç©ºé—²æ—¶é—´ï¼Œè¿™è®©æˆ‘æœ‰äº†å¾ˆå¤šçš„æ—¶é—´æ¥æ€è€ƒè‡ªå·±åˆ°åº•æƒ³è¦ä»€ä¹ˆã€‚ç‰¹åˆ«æ˜¯å¬è¿‡åŒ—äº¬GDGåœ¨3æœˆåº•ä¸¾åŠçš„ç¯å¡”IOå’Œå¾®è½¯åœ¨6æœˆä¸¾åŠçš„Insider Dev Tourä¹‹åï¼Œæˆ‘å¯¹è‡ªå·±åº”è¯¥æå‡çš„èƒ½åŠ›æœ‰äº†æ›´åŠ æ˜ç¡®çš„è®¤è¯†ã€‚ä»–ä»¬ä¹Ÿæ­£æ˜¯æˆ‘æƒ³å‘Šè¯‰å­¦å¼Ÿå­¦å¦¹ä»¬çš„ä¸€äº›å»ºè®®ã€‚\n åœ¨åŒ—äº¬çš„ä¸€äº›ç»å†ï¼Œè®©æˆ‘çœ‹åˆ°äº†å¾ˆå¯æ€•çš„ä¸€ç‚¹: æ¯”ä½ ä¼˜ç§€çš„äººæ¯”ä½ è¿˜åŠªåŠ›ï¼\næˆ‘ç»ä¸æ˜¯ä¸€ä¸ªä¼˜ç§€çš„è®¡ç®—æœºä¸“ä¸šçš„å­¦ç”Ÿï¼Œä½†æˆ‘æ­£æœæˆä¸ºä¼˜ç§€çš„è®¡ç®—æœºäººæ‰åŠªåŠ›ã€‚å¦‚ä½•è®©è‡ªå·±å˜å¾—æ›´åŠ çš„ä¼˜ç§€å‘¢?æˆ‘è§‰å¾—è¦è¯€æœ‰ä¸‹:\n å¤¯å®ä¸“ä¸šåŸºç¡€ï¼Œæå‡ä¸“ä¸šèƒ½åŠ›æ°´å¹³ï¼› æ ‘ç«‹ç»ˆèº«å­¦ä¹ çš„ç›®æ ‡ï¼Œå­¦ä¹ æ˜¯æ²¡æœ‰æ­¢å¢ƒçš„ï¼› åŸ¹å…»ä¸€ç§ä¸è½»æ˜“æ”¾å¼ƒçš„æ€åº¦ï¼›  PSï¼šä¸‹é¢åªæ˜¯ä¸€äº›æˆ‘ä¸ªäººçš„çœ‹æ³•ï¼Œè¦å­¦ä¼šç”¨æ‰¹åˆ¤çš„æ€åº¦çœ‹å¾…å„ç§ä¸œè¥¿ã€‚\nä¸“ä¸šç›¸å…³ ä¸“ä¸šè¯¾ç¨‹ æˆ‘æ˜¯å¤§äºŒæ‰è½¬æ¥è®¡ç®—æœºå­¦é™¢çš„ã€‚åœ¨å¤§äºŒï¼Œæˆ‘ä»¬æœ€é‡è¦çš„ä¸“ä¸šè¯¾æœ‰ã€Šç¦»æ•£æ•°å­¦ã€‹ã€ã€Šæ•°æ®ç»“æ„ã€‹ã€‚æˆ‘æ•¢è‚¯å®šçš„è¯´:é™¤äº†æˆ‘ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šäººåœ¨é‚£ä¸ªæ—¶å€™ä¸çŸ¥é“ã€Šç¦»æ•£æ•°å­¦ã€‹å’Œã€Šæ•°æ®ç»“æ„ã€‹è¿™ä¸¤é—¨è¯¾å¯¹æˆ‘ä»¬è®¡ç®—æœºä¸“ä¸šçš„å­¦ç”Ÿæ¥è¯´æ˜¯å¤šä¹ˆçš„é‡è¦ã€‚å½“ç„¶è¿˜æœ‰åŒä¸€å­¦æœŸçš„ã€Šè®¡ç®—æœºç»„æˆåŸç†ã€‹ï¼Œè¿™æ˜¯ä¸€é—¨åç†è®ºå’Œç¡¬ä»¶çš„è¯¾ç¨‹ã€‚æˆ‘ä»¬å¾ˆå¤šäººéƒ½è§‰å¾—æˆ‘ä¸€ä¸ªè®¡ç®—æœºä¸“ä¸šçš„å­¦ç”Ÿå¤šå­¦ç‚¹ç¼–ç¨‹ï¼Œæ•´å¤©å­¦è¿™ä¸€å †æ•°å­¦å’Œä¸ç¡¬ä»¶ç›¸å…³çš„ä¸œè¥¿æœ‰ä»€ä¹ˆç”¨ï¼Ÿï¼\næˆ‘è§‰å¾—è®©æˆ‘ä»¬äº§ç”Ÿè¿™äº›æƒ³æ³•çš„åŸå› æœ‰ä¸¤ä¸ªï¼š\n è€å¸ˆæ²¡æœ‰åœ¨è¯¾ç¨‹å¼€å§‹ä¹‹å‰ç»™æˆ‘ä»¬è®²æ¸…æ¥šè¿™é—¨è¯¾ç¨‹å¯¹æˆ‘ä»¬åˆ°åº•æœ‰ä»€ä¹ˆç”¨ æˆ‘ä»¬è‡ªå·±æ²¡æœ‰ä¸»åŠ¨å»ææ¸…æ¥šè¿™äº›è¯¾ç¨‹åˆ°åº•æœ‰ä»€ä¹ˆç”¨  æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬ä¸çŸ¥é“è¿™äº›è¯¾ç¨‹åˆ°åº•æœ‰ä»€ä¹ˆç”¨ã€‚åæ¥ï¼Œæˆ‘ç»ˆäºæ˜ç™½äº†å­¦æ ¡ç»™æˆ‘ä»¬å¼€è®¾çš„è¯¾ç¨‹åˆ°åº•æœ‰ä»€ä¹ˆç”¨äº†ï¼š\n åœ¨è¯´æ•°å­¦çš„é‡è¦æ€§ä¹‹å‰ï¼Œæˆ‘è§‰å¾—åº”è¯¥ç¥­å‡ºã€Šæ•°æ®ç»“æ„ã€‹å’Œã€Šç®—æ³•è®¾è®¡ä¸åˆ†æã€‹è¿™ä¸¤é—¨è¯¾ã€‚å®ƒä»¬æ˜¯æˆ‘ä»¬ç”¨ç¼–ç¨‹è§£å†³å¤æ‚é—®é¢˜å¿…é¡»è¦è€ƒè™‘çš„ä¸œè¥¿ã€‚å½“æˆ‘ä»¬é‡åˆ°é—®é¢˜ï¼Œåœ¨å¼€å§‹ç¼–å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¾è®¡å¥½ç¨‹åºçš„æ€»ä½“æ¡†æ¶ï¼Œåˆ’åˆ†ç¨‹åºçš„åŠŸèƒ½æ¨¡å—ã€‚ç„¶åå†³å®šä¸åŒåŠŸèƒ½æ¨¡å—åº”è¯¥é‡‡ç”¨æ€æ ·çš„ç®—æ³•ä»¥åŠæ•°æ®ç»“æ„ã€‚è¿™æ—¶æˆ‘å°±æƒ³èµ·æ¥äº†é‚£ä¸ªè‘—åçš„å…¬å¼ï¼š$$ ç¨‹åº = ç®—æ³• + æ•°æ®ç»“æ„ $$è€Œå†™ç®—æ³•ä¸ä»…ä»…æ˜¯ç”¨ä¸€äº›æ•°å­¦æ¨¡å‹ï¼Œè¿˜æœ‰é€»è¾‘æ¨ç†çš„è¿‡ç¨‹ã€‚å¾ˆå¤šæ—¶å€™ä½ æƒ³åˆ°çš„ä¸œè¥¿åˆ°æœ€åå®ç°çš„æ—¶å€™éƒ½è¦ç”¨åˆ°æ•°å­¦ã€‚ å†è¯´è¯´æ•°å­¦ï¼Œæ•°å­¦æ˜¯å„ç§ç®—æ³•çš„åŸºç¡€ã€‚æˆ‘ä»¬å­¦æ ¡è®¡ç§‘ä¸“ä¸šåœ¨å¤§å­¦ä¸»è¦å°±å­¦ã€Šé«˜ç­‰æ•°å­¦ã€‹ã€ã€Šç¦»æ•£æ•°å­¦ã€‹ã€ã€Šçº¿æ€§ä»£æ•°ã€‹å’Œã€Šæ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡ã€‹è¿™å››é—¨è¯¾ç¨‹ã€‚ã€Šé«˜ç­‰æ•°å­¦ã€‹æ”¾å“ªä¸ªç†å·¥ç§‘çš„ä¸“ä¸šä½ éƒ½å¾—å­¦ï¼Œå®ƒè¿˜æ˜¯ã€Šæ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡ã€‹åŸºç¡€ï¼Œå­¦è¿‡ã€Šæ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡ã€‹çš„éƒ½çŸ¥é“ï¼Œè¿™é‡Œé¢ä¼šé‡åˆ°ä¸€å¤§å †å¾®ç§¯åˆ†ç›¸å…³çš„çŸ¥è¯†ã€‚æˆ‘è®¤ä¸ºã€Šç¦»æ•£æ•°å­¦ã€‹æ˜¯æˆ‘ä»¬è®¡ç®—æœºä¸“ä¸šå­¦ç”Ÿæœ€åº”è¯¥å¥½å¥½å­¦ä¹ çš„ä¸€é—¨æ•°å­¦è¯¾ï¼Œå®ƒæ˜¯ç®—æ³•çš„åŸºç¡€ï¼Œæ˜¯åŠ å¯†ç†è®ºçš„åŸºç¡€ã€‚å½“ä½ å­¦ä¹ ã€Šç®—æ³•è®¾è®¡ä¸åˆ†æã€‹è¿™ä¹ˆè¯¾ç¨‹çš„æ—¶å€™ï¼Œä½ å°±ä¼šå†æ¬¡è§åˆ°å¾ˆå¤šã€Šç¦»æ•£æ•°å­¦ã€‹é‡Œé¢çš„çŸ¥è¯†äº†ï¼Œåªä¸è¿‡è¿™æ¬¡ä½ æ˜¯ç”¨å®ƒä»¬è€Œä¸æ˜¯å­¦å®ƒä»¬ã€‚æœ€åå‰©ä¸‹ã€Šçº¿æ€§ä»£æ•°ã€‹å’Œã€Šæ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡ã€‹ï¼Œå…³äºå®ƒä»¬çš„ç”¨å¤„ï¼Œä½ éšä¾¿ç¿»ä¸€ä¸‹ä¸€æœ¬æœ‰å…³æœºå™¨å­¦ä¹ ã€æ•°æ®æŒ–æ˜ã€è‡ªç„¶è¯­è¨€å¤„ç†å¯¼è®ºç­‰è¿™äº›å½“å‰æ¯”è¾ƒç«çš„äººå·¥æ™ºèƒ½æŠ€æœ¯å°±çŸ¥é“äº†ã€‚å…³äºæ•°å­¦åœ¨è®¡ç®—æœºé¢†åŸŸçš„åº”ç”¨ï¼Œæœ‰ä¸€æœ¬ä¹¦å¯ä»¥ç›´è§‚çš„è§£å†³ä½ ä»¬çš„ç–‘æƒ‘â€”â€”å´å†›çš„ã€Šæ•°å­¦ä¹‹ç¾ã€‹ã€‚ è¿˜æœ‰ä¸€å †ç†è®ºå’Œç¡¬ä»¶ç›¸å…³çš„è¯¾ç¨‹ã€‚å®ƒä»¬å‘Šè¯‰äº†æˆ‘ä»¬è®¡ç®—æœºæ˜¯å¦‚ä½•å·¥ä½œå’Œæ„æˆçš„ã€‚å®ƒä»¬æˆ–è®¸ä¸èƒ½ç›´æ¥ç»™æˆ‘ä»¬å¸¦æ¥æ”¶ç›Šï¼Œä½†ä½ ç»å¯¹ä¼šåœ¨ä»¥åçš„å·¥ä½œç”Ÿæ¶¯é‡Œæ”¶ç›Šäºå®ƒä»¬ã€‚å®ƒä»¬å¯èƒ½æ˜¯ä½ å¤šäºåŒé¾„äººçš„ä¸€ä¸ªæŠ€èƒ½ã€‚  ç¼–ç¨‹èƒ½åŠ› ç¼–ç¨‹èƒ½åŠ›æ˜¯æˆ‘ä»¬è®¡ç®—æœºä¸“ä¸šå­¦ç”Ÿæœ€åŸºæœ¬çš„èƒ½åŠ›ã€‚æˆ‘ä»¬é€šè¿‡ç¼–ç¨‹æ¥è§£å†³é—®é¢˜ï¼Œå®ç°è‡ªå·±çš„æƒ³æ³•ã€‚ä½ çš„ç¼–ç¨‹èƒ½åŠ›å’Œä½ ç¼–å†™çš„ä»£ç é‡æœ‰ç€ç›´æ¥çš„å…³ç³»ã€‚æˆ‘ä»¥å‰éƒ½æ˜¯æ‡’å¾—å†™ç¨‹åºï¼Œæ€»è§‰å¾—æœ‰äº›å¤ªç®€å•ï¼Œç”¨ä¸ç€ç›´æ¥æŠŠç¨‹åºå†™å‡ºæ¥ã€‚åæ¥ä¸€é‡åˆ°éœ€è¦ç¼–ç¨‹è§£å†³çš„é—®é¢˜çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šé‡åˆ°â€œéš¾äº§â€çš„é—®é¢˜ï¼ŒåŠå¤©å†™ä¸å‡ºå‡ è¡Œä»£ç ï¼Œä¸çŸ¥é“ä»å“ªå¼€å§‹ã€‚æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ä¹‹åï¼Œæˆ‘å°±å¼€å§‹äº†ç§¯ç´¯ä»£ç é‡çš„è¿‡ç¨‹ã€‚\nç¼–ç¨‹è¯­è¨€ ç¼–ç¨‹è¯­è¨€å±‚å‡ºä¸ç©·ï¼Œå„æœ‰å„è‡ªçš„ä¼˜åŠ¿ã€‚ä¸æ­¤å¯¹åº”çš„è¿˜æœ‰ä¸æ–­æ¶Œç°çš„å„ç§æ–°æŠ€æœ¯ã€‚æˆ‘è§‰å¾—ç¼–ç¨‹è¯­è¨€ä¸åº”è¯¥æ˜¯æˆ‘ä»¬é‡ç‚¹å­¦ä¹ çš„å¯¹è±¡ï¼Œç¼–ç¨‹è¯­è¨€åªæ˜¯è§£å†³é—®é¢˜çš„ä¸€ä¸ªå·¥å…·ã€‚æˆ‘ä»¬éœ€è¦é‡ç‚¹å­¦ä¹ çš„æ˜¯ç¼–ç¨‹æ€æƒ³ï¼Œç„¶åç²¾é€šä¸€é—¨é¢å‘è¿‡ç¨‹çš„è¯­è¨€å’Œä¸€é—¨é¢å‘å¯¹è±¡çš„è¯­è¨€ã€‚åœ¨æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ–°çš„ç¼–ç¨‹è¯­è¨€æ¥è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œæ‰¾ä¸€ä»½Tutorial,æ˜¯èƒ½å¤Ÿå¾ˆå¿«é€Ÿçš„å…¥é—¨çš„ï¼Œç„¶åå€ŸåŠ©äºç¼–ç¨‹è¯­è¨€çš„æ–‡æ¡£å’Œæœç´¢å¼•æ“å°±å¯ä»¥å¼€å§‹å·¥ä½œäº†ã€‚\næ‰€ä»¥æˆ‘è®¤ä¸ºéœ€è¦é‡ç‚¹å­¦ä¹ çš„æ˜¯è§£å†³é—®é¢˜çš„æ€æƒ³ï¼Œç¼–ç¨‹çš„æ€æƒ³ï¼ŒæŠ½è±¡æ€ç»´ï¼ŒåŸç†å’Œæ–¹æ³•ã€‚\nç§¯ç´¯ç»éªŒ è¶ç€è¿˜åœ¨å¤§å­¦ï¼Œæœ‰ç€å……è¶³çš„å­¦ä¹ æ—¶é—´ï¼Œåšä¸€äº›å°çš„é¡¹ç›®ï¼Œç§¯ç´¯ä¸€äº›é¡¹ç›®ç»éªŒå§ï¼Œå®ƒå°†æ˜¯æˆ‘ä»¬æœ€å®è´µçš„è´¢å¯Œä¹‹ä¸€ã€‚å†™ç‚¹ä¸œè¥¿æ¥è®°å½•æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹å¼ã€‚\nå…³äºå­¦ä¹  é™¤äº†éœ€è¦å­¦ä¹ ç¼–ç¨‹ä»¥å¤–ï¼Œæˆ‘è§‰å¾—å†™ä½œå’Œè‹±è¯­ä¹Ÿæ˜¯æˆ‘ä»¬åº”å½“é‡ç‚¹åŸ¹å…»çš„èƒ½åŠ›ã€‚\nå­¦ä¹ å†™ä½œ ä¸ºä»€ä¹ˆè¦å­¦ä¹ å†™ä½œå‘¢ï¼Ÿæˆ‘è¯´çš„å†™ä½œå¯ä¸æ˜¯è®©ä½ å†™ä»€ä¹ˆæ–‡å­¦ä½œå“å•Šã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œå†™ä¸€äº›å’Œè‡ªå·±ä¸“ä¸šç›¸å…³çš„ä¸œè¥¿ï¼Œè®°å½•ä¸€äº›è‡ªå·±åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ä»¥åŠæ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„ï¼Œå†™ä¸€äº›å­¦ä¹ ç¬”è®°ã€‚å¥½è®°æ€§è¿˜æ˜¯æ•Œä¸è¿‡é”®ç›˜ä¾ å•Šã€‚ä¸€ä¸ªéå¸¸å¥½çš„æ–¹å¼å°±æ˜¯å†™åšå®¢ã€‚\nå…¶å®æˆ‘å¤§äºŒçš„æ—¶å€™å°±æƒ³å»ºä¸€ä¸ªè‡ªå·±çš„åšå®¢ç½‘ç«™äº†ï¼Œä½†å½“æ—¶æ€»è§‰å¾—è‡ªå·±å¤ªèœï¼Œå†™çš„ä¸œè¥¿å¤ªlowï¼Œä¹Ÿä¸çŸ¥é“å†™ä»€ä¹ˆï¼Œç„¶åå°±æ”¾å¼ƒäº†ã€‚æˆ‘çœŸæ­£å¼€å§‹å†™åšå®¢çš„æ—¶é—´æ˜¯å¤§ä¸‰çš„ä¸‹å­¦æœŸï¼Œé‚£æ—¶å€™æˆ‘çš„ç©ºé—²æ—¶é—´å¾ˆå¤šï¼Œæˆ‘åˆæ˜¯ä¸€ä¸ªå–œæ¬¢æŠ˜è…¾çš„äººï¼Œç„¶åå°±ä¼šé‡åˆ°å„ç§å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ã€‚é‡åˆ°äº†é—®é¢˜æ€ä¹ˆåŠå‘¢ï¼Ÿå½“ç„¶æ˜¯Googleäº†ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé€šè¿‡Googleæ€»èƒ½æ‰¾åˆ°é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æœ‰æ—¶å€™ä¹Ÿä¼šèŠ±æ‰ä½ å¤§é‡çš„æ—¶é—´ã€‚å¦‚æœæ¯æ¬¡å‡ºç°çš„é—®é¢˜éƒ½æ˜¯ä¸åŒçš„é—®é¢˜ï¼Œé‚£ä¹ˆè¿™æ˜¯æ²¡æœ‰ä»€ä¹ˆå½±å“çš„ï¼Œè¿˜æ˜¯å¾—èŠ±æ—¶é—´å»æŸ¥ã€‚å› ä¸ºæ¯æ¬¡éƒ½æ˜¯ç…§ç€åˆ«äººè®²çš„æ–¹æ³•ä¸€æ­¥æ­¥åšè§£å†³é—®é¢˜çš„ï¼ŒåŸºæœ¬ä¸Šè§£å†³å®Œé—®é¢˜è¿‡ä¸äº†å¤šä¹…å°±ä¼šå¿˜è®°ã€‚ç­‰åˆ°åŒæ ·çš„é—®é¢˜å†æ¬¡å‡ºç°çš„æ—¶å€™ï¼Œåˆè¦é‡å¤ä¹‹å‰çš„å·¥ä½œï¼Œå»å°è¯•é‚£äº›å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™å°±å¾ˆæµªè´¹æ—¶é—´äº†ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆå¯ä»¥å‡å°‘è¿™ç§é‡å¤æ€§åŠ³åŠ¨çš„æ–¹æ³•å‘¢ï¼Œæ–¹æ³•å°±æ˜¯è‡ªå·±å†™åšå®¢è®°å½•ä¸‹è¿™æ¬¡çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥å¤‡ä¸‹æ¬¡ä½¿ç”¨ã€‚\nå…¶å®æˆ‘çš„åšå®¢æ˜¯å†™ç»™æˆ‘è‡ªå·±çœ‹çš„ï¼Œæˆ‘è§‰å¾—å¯ä»¥äº†å°±å¯ä»¥äº†ï¼Œä¸ç”¨æ‹…å¿ƒåˆ«äººæ€ä¹ˆè¯´ã€‚\nå»ºç«‹è‡ªå·±çš„åšå®¢ç½‘ç«™ æˆ‘ç”¨Hugo(ä¸€ä¸ªç”¨Goè¯­è¨€ç¼–å†™é™æ€ç½‘ç«™ç”Ÿæˆæ¡†æ¶)å’ŒGithub Pageså»ºç«‹äº†è‡ªå·±çš„åšå®¢ç½‘ç«™ï¼Œå…¶å®å°±æ˜¯è®°å½•ä¸€äº›è‡ªå·±å­¦ä¹ çš„ä¸œè¥¿ä»¥åŠè¸©å‘æ—¥è®°ï¼Œæ–¹ä¾¿è‡ªå·±ä»¥åå›å¿†æˆ–è€…æŸ¥é˜…ã€‚æ¯”èµ·åœ¨ç”µè„‘æœ¬åœ°ç¬”è®°æ¥è¯´ï¼Œä¸€ä¸ªèƒ½å¤Ÿéšæ—¶é€šè¿‡æ‰‹æœºæˆ–è€…ç”µè„‘è®¿é—®çš„åšå®¢ç½‘ç«™çš„ä¼˜åŠ¿ä¸çŸ¥é“å¥½åˆ°äº†å“ªé‡Œå»ã€‚å¦‚æœä½ èƒ½å¤Ÿè®©åˆ«äººé€šè¿‡æœç´¢å¼•æ“æ‰¾åˆ°ä½ å†™çš„ä¸œè¥¿å¹¶ä»å…¶ä¸­å—ç›Šï¼Œé‚£ä¹ˆæˆ‘è§‰å¾—ä½ åº”è¯¥ä¼šå¾ˆé«˜å…´ã€‚\nå½“å‰æ­å»ºåšå®¢ç½‘ç«™çš„æ¡†æ¶å¾ˆå¤šï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚ä¸»æµçš„æœ‰Hexoã€Hugoã€Jekyllç­‰ç­‰ã€‚å…³äºå®ƒä»¬ï¼Œç½‘ä¸Šéƒ½æœ‰å¾ˆå¤šçš„æ•™ç¨‹ã€‚Hugoçš„ç¼–è¯‘é€Ÿåº¦æ˜¯æœ€å¿«çš„ï¼ŒåŒæ—¶æ”¯æŒMarkdownè¯­æ³•ï¼Œä½†ç½‘ä¸Šçš„ä¸­æ–‡å‚è€ƒèµ„æ–™ä¸å¦‚å…¶å®ƒçš„å¤šï¼Œç»å¤§å¤šæ•°å¤šæ˜¯è‹±æ–‡èµ„æ–™ã€‚ä¸­æ–‡æ–‡æ¡£è‡³ä»Šè¿˜æ²¡ç¿»è¯‘å®Œæˆï¼Œä½¿ç”¨Hugoéœ€è¦ä¸€å®šçš„è‹±è¯­èƒ½åŠ›ã€‚ é€‰æ‹©ä¸€ä¸ªæ¼‚äº®çš„çš®è‚¤ï¼Œä½ çš„åšå®¢ç½‘ç«™å°±ä¼šæ˜¾å¾—å¾ˆæ¼‚äº®ã€‚\næœ‰äººå¯èƒ½ä¼šé—®ï¼Œå†™åšå®¢ä¸ä¼šèŠ±å¾ˆå¤šæ—¶é—´å—ï¼Ÿå†™åšå®¢å½“ç„¶ä¼šèŠ±æ—¶é—´ï¼Œä½†å®ƒèƒ½å¤Ÿå¸®ä½ èŠ‚çœæ›´å¤šçš„æ—¶é—´ï¼Œè¿˜èƒ½å¤Ÿå¸®åŠ©å½¢æˆä½ è‡ªå·±çš„çŸ¥è¯†ä½“ç³»ã€‚é‚£åšç¬”è®°æ¥è¯´ï¼Œå¦‚æœä½ æœ‰åšç¬”è®°çš„ä¹ æƒ¯ï¼Œç¬”è®°éƒ½æ˜¯è¦åšçš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸æŠŠç¬”è®°å†™åœ¨ä¸€ä¸ªä½ æ›´åŠ å®¹æ˜“æŸ¥é˜…çš„åœ°æ–¹å‘¢ã€‚\nå†™ä¸‹ä½ çš„æƒ³æ³•å¹¶åˆ†äº«ç»™åˆ«äºº è¿‘å¹´æ¥ï¼ŒçŸ¥è¯†ä»˜è´¹çš„æ½®æµå¼€å§‹å…´èµ·ã€‚å¦‚æœä½ æ‹¥æœ‰ä¸€ä¸ªç²‰ä¸åœˆï¼Œæˆ–è€…æ˜¯ä½ èƒ½å¤Ÿæä¾›åˆ«äººéœ€è¦çš„çŸ¥è¯†ï¼Œä½ å°±èƒ½ä»ä¸­è·å¾—å›æŠ¥ã€‚åœ¨è¿™ä¹‹å‰ï¼Œåˆ«äººå¾—çŸ¥é“ä½ å¹¶è®¤å¯ä½ ã€‚æˆ–è®¸å†™åšå®¢èƒ½å¤Ÿæˆä¸ºä½ è‡ªæˆ‘è¥é”€çš„ä¸€ç§æ–¹å¼å‘¢ã€‚\nå­¦ä¹ è‹±è¯­ å¯ä»¥æ¯«ä¸å¤¸å¼ çš„è¯´ï¼Œè‹±è¯­æ˜¯ç¨‹åºå‘˜é™¤æ¯è¯­å¤–çš„ç¬¬äºŒè¯­è¨€ã€‚ä¸å•å•æ˜¯è®¡ç®—æœºä¸“ä¸šï¼Œå„è¡Œå„ä¸šéƒ½è¢«è‹±è¯­å½±å“ç€ã€‚Wikipediaä¸Šè‹±è¯­è¯æ¡çš„æ•°ç›®è¿œè¶…ä¸­æ–‡è¯æ¡ï¼Œè€Œä¸”è‹±æ–‡è¯æ¡çš„è´¨é‡ä¹Ÿæ›´é«˜ã€‚ æ‹¿æˆ‘ä»¬è®¡ç®—æœºä¸“ä¸šæ¥è¯´ï¼Œæˆ‘ä»¬é‡åˆ°çš„ç»å¤§å¤šæ•°é—®é¢˜éƒ½èƒ½åœ¨**StackOverFlow**ä¸Šæ‰¾åˆ°ç­”æ¡ˆï¼Œç„¶è€Œè¿™ä¸ªç½‘ç«™æ˜¯è‹±æ–‡çš„ã€‚å¦‚æœä½ çš„è‹±è¯­å¾ˆå·®ï¼Œåªèƒ½é ç€ç™¾åº¦æœç´¢ä¸€äº›å›½å†…çš„èµ„æ–™ä¹Ÿæ˜¯èƒ½æ­£å¸¸å·¥ä½œçš„ï¼Œæ±‰è¯­æ˜¯æˆ‘ä»¬çš„æ¯è¯­ï¼Œæ²¡æœ‰äº¤æµéšœç¢ï¼Œä¹Ÿæ›´åŠ å®¹æ˜“ç†è§£ã€‚ä½†ä¸€åˆ°ä¸“ä¸šæ–¹é¢ï¼Œå°¤å…¶æ˜¯æˆ‘ä»¬è®¡ç®—æœºè¡Œä¸šçš„ä¸œè¥¿ï¼Œå…‰é ä¸­æ–‡å¯èƒ½å°±ä¸å¤Ÿç”¨äº†ã€‚\nè®¡ç®—æœºçš„ç›¸å…³ç†è®ºå‡ ä¹éƒ½æ˜¯ä»å›½å¤–å‘å±•èµ·æ¥çš„ï¼Œå¾ˆå¤šä¸“ä¸šæ–‡æ¡£éƒ½æ˜¯ç”¨è‹±è¯­å†™çš„ã€‚å¦‚æœä½ å¯¹æ¯”é˜…è¯»è¿‡ä¸€æœ¬å›½å¤–çš„åŸç‰ˆè‹±æ–‡æ•™æå’Œå®ƒåœ¨å›½å†…çš„ç¿»è¯‘ç‰ˆæœ¬ï¼Œä½ æœ€ç»ˆåº”è¯¥ä¼šè®¤ä¸ºï¼šè¿˜æ˜¯åŸç‰ˆçš„å¥½ç†è§£ï¼Œä¸­æ–‡ç¿»è¯‘å¾—å¤ªåˆ«æ‰­äº†ã€‚å›½å¤–çš„æ•™æéƒ½å¾ˆåšï¼Œä¸åƒå›½å†…çš„æ•™æé‚£ä¹ˆè–„ï¼Œé‚£æ˜¯å› ä¸ºå›½å¤–ä¸Šè¯¾è®²çš„å°‘ï¼Œä½œè€…ä¸ºäº†æ–¹ä¾¿å­¦ç”Ÿè‡ªå­¦æ‰å†™äº†é‚£ä¹ˆå¤šçš„å†…å®¹ï¼Œå›½å†…ä¸»è¦çš„çŸ¥è¯†è¿˜æ˜¯é è€å¸ˆæ¥è®²ï¼Œå¾ˆå¤šè¯¾ç¨‹æ‹¿ç€è€å¸ˆä¸Šè¯¾çš„PPTä¸ç”¨æ•™æä¹Ÿèƒ½è½»æ¾é€šè¿‡ï¼Œå¯æœ€åå­¦åˆ°çš„ä¸œè¥¿æœ‰é‚£ä¹ˆå¤šé‚£ä¹ˆæ‰å®å—ï¼Ÿçœ‹ç¿»è¯‘ç‰ˆçš„ä¹¦çš„æ—¶å€™ï¼Œä½ å¯èƒ½å°±ä¸èƒ½é‚£ä¹ˆå‡†ç¡®çš„é¢†ä¼šåŸä½œè€…çš„æ„å›¾äº†ï¼Œç¿»è¯‘æ˜¯ä¸å¯èƒ½åšåˆ°ç™¾åˆ†ä¹‹ç™¾å‡†ç¡®çš„ã€‚\nå½“æˆ‘ä»¬å†™ç¨‹åºçš„æ—¶å€™ï¼Œå¾ˆå¤šæ—¶å€™éƒ½éœ€è¦å»æŸ¥é˜…ç›¸å…³çš„æŠ€æœ¯æ–‡æ¡£ã€‚è¿™ä¸ªæ—¶å€™ä½ å¯ä»¥ä½¿ç”¨ç½‘é¡µç¿»è¯‘æ’ä»¶æ¥å¸®åŠ©ä½ ä½ çœ‹æ‡‚æ–‡æ¡£ï¼Œä½†æ’ä»¶ç¿»è¯‘å‡ºæ¥çš„å‡†ç¡®åº¦ä¹Ÿæ˜¯æœ‰é™åˆ¶çš„ã€‚æœ€å¥½çš„æ–¹æ³•è¿˜æ˜¯è‡ªå·±çœ‹ï¼Œé‚£æ ·ä¸ä¼šæœ‰å¤ªå¤šçš„ä¿¡æ¯çš„æŸå¤±ï¼Œä¹Ÿæ²¡æœ‰é‚£ä¹ˆå®¹æ˜“äº§ç”Ÿæ­§ä¹‰ã€‚\nå¦‚ä½•å­¦ å¦‚æœåªæ˜¯ä¸ºäº†èƒ½å¤Ÿçœ‹æ‡‚è‹±æ–‡æ–‡æ¡£ï¼Œé‚£å°±å®¹æ˜“å¤šäº†ã€‚ä½ åªéœ€è¦ä¸æ–­åœ°ç§¯ç´¯è‡ªå·±çš„è¯æ±‡é‡å°±å¯ä»¥äº†ï¼Œä¸æ–­åœ°å»çœ¼ç†Ÿæ–°çš„å•è¯ï¼Œçœ‹å¤šäº†è‡ªç„¶å°±è®°ä½äº†ã€‚æˆ‘å­¦ä¹ è‹±è¯­è¯æ±‡ç”¨çš„å°±æ˜¯ï¼šVocabulary.com + æ¬§è·¯è¯å…¸ã€‚å®ƒä»¬åœ¨è‹±è¯­å­¦ä¹ æ–¹é¢ç»™äº†æˆ‘å·¨å¤§çš„å¸®åŠ©ã€‚å¦‚æœä½ æƒ³ç³»ç»Ÿçš„ææ¸…æ¥šæŸä¸€ä¸ªå•è¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæˆ‘æ¨èç»™ä½ ä¸€ä¸ªç½‘ç«™ï¼šVocabulary.comï¼Œå®ƒç”¨è‹±è¯­è§£é‡Šè‹±è¯­ï¼Œèƒ½å¤Ÿè®©ä½ ç›´è§‚çš„æ„Ÿå—åˆ°å•è¯çš„æ„æ€ä»¥åŠç›¸è¿‘å•è¯ä¹‹é—´çš„åŒºåˆ«ã€‚æˆ‘ä¸€ç›´è§‰å¾—ä¸€ç§è¯­è¨€æ˜¯ä¸èƒ½å®Œæ•´å‡†å¤‡çš„è¡¨è¾¾å‡ºå¦ä¸€ç§è¯­è¨€æ‰€è¦è¡¨è¾¾çš„ä¿¡æ¯çš„ã€‚ä¸Šé¢é‚£ä¸ªç½‘ç«™æ˜¯å…¨è‹±æ–‡ç‰ˆçš„ï¼Œä½ å¯èƒ½ä¼šçœ‹ä¸æ‡‚ã€‚æ‰€ä»¥ï¼Œæˆ‘å†æ¨èç»™ä½ ä¸€éƒ¨è¯å…¸ï¼šæ¬§è·¯è¯å…¸ï¼Œå®ƒæ”¯æŒæ‰©å……è¯åº“ï¼Œä½ å¯ä»¥è‡ªç”±åŠ è½½å„ç§è¯åº“ï¼ŒåŒ…æ‹¬å„ç§åŸç”Ÿè‹±æ–‡ä¾‹å¥ã€‚ç»“åˆè‹±æ–‡è¯åº“å’Œä¸­æ–‡è¯åº“ï¼Œä½ èƒ½å¤Ÿæ›´å¥½çš„ç†è§£ä¸€ä¸ªè¯çš„æ„æ€ã€‚å½“ç„¶ï¼Œè¿™åªæ˜¯è¯æ±‡ï¼Œç†è§£ä¸€ä¸ªå•è¯æœ€å¥½çš„æ–¹æ³•è¿˜æ˜¯è¦çœ‹å®ƒæ‰€å¤„çš„è¯­å¢ƒã€‚å°±åƒä¸­å›½æ±‰å­—åšå¤§ç²¾æ·±ä¸€æ ·ï¼Œè‹±æ–‡å•è¯ä¹Ÿæ˜¯åšå¤§ç²¾æ·±ã€‚å¦‚æœä½ æƒ³æ›´å¥½çš„å­¦ä¹ è‹±è¯­ï¼Œé‚£å°±è¦è‡ªå·±æƒ³åŠæ³•äº†ï¼Œæˆ‘å·²ç»æŠŠæˆ‘ç”¨åˆ°çš„æœ€å¥½çš„ä¸¤ä¸ªè½¯ä»¶æ¨èç»™ä½ äº†ã€‚æˆ‘å½“å‰çš„ç›®æ ‡æ˜¯ï¼Œåšåˆ°ä¸å€ŸåŠ©ç¿»è¯‘è½¯ä»¶é˜…è¯»è‹±è¯­ï¼Œå£è¯­å§‹ç»ˆæ˜¯ç¡¬ä¼¤ã€‚\nä¸“æ³¨åŠ› é€šè¿‡åŒ—é‚®å­¦ä¹ çš„ç»å†ï¼Œæˆ‘å‘ç°å¾ˆå¤šåŒ—é‚®äººç¨‹åºå†™å¾—å¥½çš„åŸå› ä¸å•å•æ˜¯å› ä¸ºä»–ä»¬å†™å¾—å¤šï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åŸå› æ˜¯ä»–ä»¬åšäº‹æƒ…çš„æ—¶å€™å¾ˆä¸“æ³¨ã€‚æˆ‘è§‰å¾—ä¸“æ³¨åŠ›åº”è¯¥ä¹Ÿæ˜¯æˆ‘ä»¬å¿…å¤‡çš„ç´ è´¨ä¹‹ä¸€ã€‚å½“é‡åˆ°éš¾ä»¥è§£å†³çš„é—®é¢˜ï¼Œä¸åŒäººå¤„ç†çš„æ€åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œæˆ‘ä¹‹å‰åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€ä¸ªç¼å­æè¿°çš„å¾ˆå½¢è±¡ã€‚ å¤§æ¦‚æ˜¯è¯´ï¼š985çš„æ­£é¢ç¡¬åˆšï¼Œä¸å¹²å‡ºæ¥ä¸ç½¢ä¼‘ï¼›211çš„å…ˆå°è¯•ï¼Œå°éå„ç§æ–¹æ³•ä¾ç„¶æ— æœï¼Œäºæ˜¯æ”¾å¼ƒï¼›æ°‘åŠçš„è§çŠ¶è¯´ï¼Œå¤ªéš¾äº†ï¼Œæˆ‘é€‰æ‹©æ”¾å¼ƒã€‚ è¿™æˆ–è®¸å°±æ˜¯ä¸åŒå­¦æ ¡ä¹‹é—´çš„ä¸€ä¸ªé‡è¦å·®è·å§ã€‚ä¸è¦è½»æ˜“çš„æ”¾å¼ƒã€‚\næé«˜å·¥ä½œæ•ˆç‡çš„ä¸€ä¸ªé‡è¦æ–¹æ³•å°±æ˜¯æé«˜è‡ªå·±çš„ä¸“æ³¨ç¨‹åº¦ï¼Œä¹Ÿå°±æ˜¯å‡å°‘å¤–ç•Œå¹²æ‰°è‡ªå·±çš„ç¨‹åº¦æˆ–è€…å¢åŠ è‡ªå·±æŠµæŠ—å¤–ç•Œå¹²æ‰°çš„ç¨‹åº¦ã€‚\nå‡ ä¸ªå°å»ºè®®  æ¨èä¸€æœ¬ä¹¦ã€Šè½¯æŠ€èƒ½ï¼šä»£ç ä¹‹å¤–ç”Ÿå­˜æŒ‡å—ã€‹ï¼› è¶ä½ è¿˜åœ¨å¤§å­¦ï¼Œå°‘å‘†å¯å®¤ï¼Œå¤šå‡ºå»èµ°èµ°ï¼Œå¤–é¢çš„ä¸–ç•Œå¾ˆç²¾å½©ï¼› é”»ç‚¼èº«ä½“ï¼Œå°‘ç†¬å¤œï¼›  ","href":"/posts/recyclebin/remember_bupt/","title":"åŒ—é‚®å›å¿†"},{"content":" è®¸å¤šéšæœºç®—æ³•é€šè¿‡æ’åˆ—ç»™å®šçš„è¾“å…¥æ•°ç»„æ¥ä½¿è¾“å…¥éšæœºåŒ–ã€‚è¿™é‡Œçš„ç›®æ ‡æ˜¯æ„é€ æ•°ç»„ A çš„ä¸€ä¸ªéšæœºæ’åˆ—ã€‚\n æ–¹æ³•ä¸€ï¼šæ’åº ä¸ºæ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´  A[i] åˆ†é…ä¸€ä¸ªéšæœºçš„ä¼˜å…ˆçº§ P[i] ï¼Œç„¶åæ ¹æ®ä¼˜å…ˆçº§æ¥å¯¹æ•°ç»„ A ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚æ¯”å¦‚ï¼š\\ A = {43, -1, 82, 61, -87, -86, -55, 28, 47, -97}\\ P = {70, 433, 302, 154, 805, 810, 740, 287, 213, 41}\\ æ’åºåçš„ A å°±æ˜¯ï¼š\\ A = {-97, 43, 61, 47, 28, 82, -1, -55, -87, -86}\næ–¹æ³•äºŒï¼šåŸåœ°æ’åˆ— å‡è®¾æ•°ç»„ A çš„é•¿åº¦ä¸º n , è¿›è¡Œ n æ¬¡è¿­ä»£ï¼Œåœ¨ç¬¬ i æ¬¡è¿­ä»£çš„æ—¶å€™ï¼Œ ä» A[i..n] ä¸­éšæœºé€‰å–ä¸€ä¸ªå…ƒç´ æ¥ä½œä¸º A[i] ã€‚ç¬¬ i è¿­ä»£ä¹‹åï¼Œ A[i] å°±ä¸å†æ”¹å˜ã€‚\nå®ç° ä¸»è¦javaä»£ç å¦‚ä¸‹ï¼š\nimport ch02.GenerateTestData; import java.util.Random; class PermutingArraysRandomly{ public void printArray(int[] A){ int n = A.length; for(int i = 0;i \u0026lt; n;i++){ System.out.printf(\u0026#34;%-6d\u0026#34;, A[i]); if((i + 1) % 10 == 0) System.out.println(); } } /** * @param a ä¸‹ç•Œ * @param b ä¸Šç•Œ * @return [a, b]ä¹‹é—´çš„ä¸€ä¸ªéšæœºæ•´æ•° */ public int rand(int a, int b){ Random random = new Random(); int c = b - a; return random.nextInt(c + 1) + a; } /** * äº¤æ¢A[i]å’ŒA[j]çš„å€¼ * @param A * @param i * @param j */ public void exchange(int[] A, int i, int j){ int t = A[i]; A[i] = A[j]; A[j] = t; } /** * æ ¹æ®ä¼˜å…ˆçº§å¯¹æ•°ç»„Aè¿›è¡Œé€‰æ‹©æ’åº * @param A å¾…æ’åºæ•°ç»„ * @param P ä¼˜å…ˆçº§æ•°ç»„ * @return æ ¹æ®ä¼˜å…ˆçº§æ’åºåçš„æ•°ç»„ */ public int[] selectSort(int[] A, int[] P){ int n = A.length; for(int i = 0;i \u0026lt; n;i++){ int minp = i; for(int j = i + 1;j \u0026lt; n;j++){ // å€¼å°çš„ä¼˜å…ˆçº§é«˜  if(P[j] \u0026lt; P[minp]){ minp = j; } } exchange(A, i, minp); exchange(P, i, minp); } return A; } /** * ä¸ºæ•°ç»„çš„æ¯ä¸ªå…ƒç´ A[i]åˆ†é…ä¸€ä¸ªéšæœºçš„ä¼˜å…ˆçº§P[i]ï¼Œç„¶åæ ¹æ®ä¼˜å…ˆçº§å¯¹æ•°ç»„Aä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚ * @param A * @return æŒ‰ä¼˜å…ˆçº§æ’åºåçš„æ•°ç»„ï¼Œå³éšæœºæ’åˆ—åçš„æ•°ç»„ */ public int[] permuteBySorting(int[] A){ int n = A.length; int[] P = new int[n]; // ä¼˜å…ˆçº§æ•°ç»„  for(int i = 0;i \u0026lt; n;i++){ P[i] = rand(0, n * n * n + 1); // ä½¿P[i]å°½å¯èƒ½å”¯ä¸€  } System.out.println(\u0026#34;\\nP:\u0026#34;); printArray(P); selectSort(A, P); // æ ¹æ®ä¼˜å…ˆçº§æ’åºA  System.out.println(\u0026#34;\\nsorted:\u0026#34;); printArray(A); return A; } /** * åŸåœ°æ’åˆ—ç»™å®šæ•°åˆ— * @param A * @return */ public int[] randomizeInPlace(int[] A){ int n = A.length; for(int i = 0;i \u0026lt; n;i++){ exchange(A, i, rand(i, n - 1)); } return A; } } ","href":"/notebook/reading_notes/introduction_to_algorithms/two-ways-to-produce-a-uniform-random-permutation/","title":"äº§ç”Ÿå‡åŒ€éšæœºæ’åˆ—çš„ä¸¤ç§æ–¹æ³•"},{"content":"","href":"/tags/%E7%AE%97%E6%B3%95%E5%AF%BC%E8%AE%BA/","title":"ç®—æ³•å¯¼è®º"},{"content":"é—®é¢˜æè¿° è¿™æ˜¯ã€Šç®—æ³•å¯¼è®ºã€‹çš„ä¹ é¢˜5.1-3ï¼š\n å‡è®¾ä½ å¸Œæœ›ä»¥å„1/2çš„æ¦‚ç‡è¾“å‡º0å’Œ1ã€‚ä½ å¯ä»¥è‡ªç”±ä½¿ç”¨ä¸€ä¸ªè¾“å‡º0æˆ–1çš„è¿‡ç¨‹BIASED-RANDOMã€‚å®ƒä»¥æ¦‚ç‡ p è¾“å‡º1ï¼Œä»¥æ¦‚ç‡ 1-p è¾“å‡º0ï¼Œå…¶ä¸­ 0 \u0026lt; p \u0026lt; 1ï¼Œä½†æ˜¯ä½ å¹¶ä¸çŸ¥é“ p çš„å€¼ã€‚ç»™å‡ºä¸€ä¸ªåˆ©ç”¨BIASED-RANDOMä½œä¸ºå­ç¨‹åºçš„ç®—æ³•ï¼Œè¿”å›ä¸€ä¸ªæ— åå‘çš„ç»“æœã€‚\n è§£å†³æ–¹æ¡ˆ åˆ†æ æˆ‘ä»¬å¹¶ä¸çŸ¥é“ p çš„å–å€¼ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡BIASED-RANDOMæ¥é‡æ–°æ„é€ ä¸€ä¸ªè¿‡ç¨‹ï¼Œä½¿ä¹‹ç­‰æ¦‚ç‡çš„è¾“å‡º0å’Œ1ã€‚è€ƒè™‘è¿ç»­ä¸¤æ¬¡è°ƒç”¨BIASED-RANDOMå¾—åˆ°çš„ç»“æœ P(ij)ï¼Œå°†ä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š $$ P(00) = p^2 $$ $$ P(01) = (1 - p)p $$ $$ P(10) = p(1 - p) $$ $$ P(11) = (1 - p)^2 $$ å¯ä»¥å‘ç°ï¼šP(01) = P(10)ã€‚åˆ©ç”¨äº§ç”Ÿ 01 å’Œ 10 çš„æ¦‚ç‡ç›¸ç­‰è¿™ä¸ªæ€§è´¨å°±å¯ä»¥è§£å†³é¢˜ç›®ä¸­çš„é—®é¢˜äº†ã€‚\njavaä»£ç  private int biasedRandom(){ Random random = new Random(); return random.nextInt(2); // éšæœºäº§ç”Ÿ[0,1]å†…çš„æ•´æ•°  } public int rand(){ while(true){ int i = biasedRandom(), j = biasedRandom(); if(i == 1 \u0026amp;\u0026amp; j == 0){ return 1; } else if(i == 0 \u0026amp;\u0026amp; j == 1){ return 0; } else continue; } } ","href":"/notebook/reading_notes/introduction_to_algorithms/%E9%80%9A%E8%BF%8701%E6%9C%89%E5%81%8F%E6%A6%82%E7%8E%87%E7%94%9F%E6%88%90%E6%97%A0%E5%81%8F%E6%A6%82%E7%8E%87/","title":"é€šè¿‡åæ¦‚ç‡0/1ç”Ÿæˆå™¨ï¼Œå¾—åˆ°æ— åæ¦‚ç‡0/1ç”Ÿæˆå™¨"},{"content":"","href":"/tags/python/","title":"Python"},{"content":" Anaconda æ˜¯ä¸€ä¸ª python çš„å‘è¡Œç‰ˆï¼Œå¯ä»¥ç”¨æ¥ç®¡ç† python çš„åŒ…å’Œç¯å¢ƒï¼ŒåŒæ—¶å®ƒåŒ…å«1000+çš„å¼€æºpackageã€‚æ­£å¦‚é‚£å¥è¯ä¸€æ ·ï¼š\\ The Most Trusted Distribution for Data Science\\ è¿˜æœ‰ä¸€ä¸ªæ²¡æœ‰åŒ…å«é‚£ä¹ˆå¤šåŒ…çš„ python å‘è¡Œç‰ˆï¼Œå«åšMinicondaã€‚\n æ˜¯ç”¨Anaconda Navigatorè¿˜æ˜¯conda Navigator å’Œ conda éƒ½æ˜¯å¯ä»¥ç”¨æ¥ç®¡ç†åŒ…å’Œç¯å¢ƒã€‚åœ¨å®‰è£…å®Œ Anaconda ä¹‹åï¼Œå®ƒä»¬å°±éƒ½å·²ç»å­˜åœ¨äºç³»ç»Ÿä¹‹ä¸­äº†ã€‚åŒºåˆ«æ˜¯ï¼š\n Navigator æ˜¯å›¾å½¢ç•Œé¢ conda æ˜¯å‘½ä»¤è¡Œç•Œé¢  å¯ä»¥åŒæ—¶ä½¿ç”¨å®ƒä»¬æ¥è¿›è¡Œç®¡ç†ã€‚\nè¿˜æ˜¯ä¹ æƒ¯ä½¿ç”¨conda è¿™é‡Œæœ‰ä¸€ä»½conda cheat sheetã€‚èŠ±ç‚¹æ—¶é—´çœ‹çœ‹ï¼Œå°±èƒ½å¼€å§‹ä½¿ç”¨ conda äº†ã€‚\n.condarc æ˜¯ conda çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒæ˜¯å¯é€‰çš„ã€‚å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡è¿è¡Œ conda config å‘½ä»¤çš„æ—¶å€™, è¿™ä¸ªæ–‡ä»¶å°±ä¼šè¢«åˆ›å»ºï¼Œé€šå¸¸ä½äºï¼šC:\\user\\username\\.condarcã€‚å¯ä»¥é€šè¿‡ç›´æ¥ä¿®æ”¹å®ƒæ¥é…ç½® conda ï¼Œå› ä¸º conda config å‘½ä»¤çš„ç»“æœæœ€ç»ˆä¼šå†™åˆ° .condarc ä¸­ã€‚\né…ç½®æº(channels) Anaconda é»˜è®¤çš„æºä½äºå›½å¤–ï¼Œåœ¨å›½å†…è®¿é—®çš„é€Ÿåº¦ä¸å¤Ÿå¿«ã€‚å¯ä»¥é‡‡ç”¨å›½å†…çš„é•œåƒæ¥åŠ å¿«è®¿é—®é€Ÿåº¦ã€‚æˆ‘ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯æ¸…åçš„æºï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/ conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ conda config --set show_channel_urls yes é€šè¿‡å‘½ä»¤ï¼š\nconda info å¯ä»¥æŸ¥çœ‹å½“å‰çš„é…ç½®ä¿¡æ¯ã€‚å¦‚æœæ·»åŠ æˆåŠŸï¼Œä½ ä¼šçœ‹åˆ°åˆšæ‰æ‰€æ·»åŠ çš„é“¾æ¥ã€‚ä¸è¿‡ä¹Ÿå¯ä»¥ç›´æ¥æŸ¥çœ‹ .condarc è¿™ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶çš„å†…å®¹ç›®å‰å¤§è‡´æ˜¯è¿™ä¸ªæ ·å­ï¼š\nchannels: - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/ - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/menpo/ - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/ - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/msys2/ - https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/ - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ - defaults ssl_verify: true show_channel_urls: true å…¶ä¸­æœ‰ä¸€ä¸ªå­—æ®µæ˜¯ defaults, è¿™ä½¿å¾—æ‰€æœ‰é»˜è®¤çš„æºéƒ½åŒ…å«åœ¨å½“å‰çš„æºé‡Œé¢ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åˆ é™¤å®ƒã€‚\\ æˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¹å˜é»˜è®¤çš„æºï¼Œä¿®æ”¹**defalut_channels** å³å¯ã€‚\nè®©condaè‡ªåŠ¨æ›´æ–°(auto_update_conda) conda é»˜è®¤æ˜¯è‡ªåŠ¨æ›´æ–°çš„ï¼Œæ¯å½“ç”¨æˆ·åœ¨rootç¯å¢ƒæ›´æ–°æˆ–å®‰è£…åŒ…çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘ã€‚å¯ä»¥é‡‡ç”¨å‘½ä»¤ï¼š\nconda config --set auto_update_conda false æ¥å…³é—­è‡ªåŠ¨æ›´æ–°ã€‚è¿™æ—¶å€™ conda å°±åªä¼šåœ¨ç”¨æˆ·è¿è¡Œæ‰‹åŠ¨æ›´æ–°çš„å‘½ä»¤ conda update çš„æ—¶å€™åŠè¿›è¡Œæ›´æ–°äº†ã€‚\nAlway yes(always_yes) æ¯å½“æˆ‘ä»¬æ‰§è¡Œå®‰è£…åŒ…çš„å‘½ä»¤çš„æ—¶å€™ï¼Œ conda éƒ½ä¼šé—®æˆ‘ä»¬Proceed ([y]/n)?ã€‚å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è¿™ä¹ˆè®¾ç½® always_yes :\nconda config --set always_yes true ç›®å‰æˆ‘ç”¨åˆ°çš„é…ç½®éƒ¨åˆ†å¤§è‡´å°±æ˜¯è¿™äº›ã€‚è¿™é‡Œæœ‰ä¸€ä»½å…³äºä½¿ç”¨ .condarc çš„å®Œæ•´è¯´æ˜ã€‚\n","href":"/posts/python/anaconda-source-configuration/","title":"é…ç½®Anacondaæº"},{"content":"çŸ©é˜µä¹˜æ³• çŸ©é˜µç›¸ä¹˜åªæœ‰åœ¨ç¬¬ä¸€ä¸ªçŸ©é˜µçš„åˆ—æ•°ï¼ˆcolumnï¼‰å’Œç¬¬äºŒä¸ªçŸ©é˜µçš„è¡Œæ•°ï¼ˆrowï¼‰ç›¸åŒæ—¶æ‰æœ‰å®šä¹‰ã€‚è‹¥ A ä¸º m x n çŸ©é˜µï¼ŒBä¸º n x p çŸ©é˜µï¼Œåˆ™ä»–ä»¬çš„ä¹˜ç§¯ C = AB ä¼šæ˜¯ä¸€ä¸ª m x p çŸ©é˜µã€‚å…¶ä¹˜ç§¯çŸ©é˜µçš„å…ƒç´ å¦‚ä¸‹é¢å¼å­å¾—å‡ºï¼š $$C_{ij} = \\sum_{k = 1}^n A_{ik} B_{kj}$$\nè§£å†³æ–¹æ¡ˆ å¸¸è§„æ–¹æ³•æ±‚è§£ æ ¹æ®çŸ©é˜µç›¸ä¹˜çš„å®šä¹‰ï¼Œå¯ä»¥ç›´æ¥æ±‚è§£ä¸¤ä¸ªçŸ©é˜µçš„ä¹˜ç§¯ã€‚ä½†è¿™ç§æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼š$ O(n^3) $ã€‚javaä»£ç å¦‚ä¸‹ï¼š\npublic int[][] matrixMultiply(int[][] A, int[][] B) { int rowc = A.length, colc = B[0].length, colab = A[0].length; int[][] C = new int[rowc][colc]; for (int i = 0; i \u0026lt; rowc; i++) { for (int j = 0; j \u0026lt; colc; j++) { for (int k = 0; k \u0026lt; colab; k++) { C[i][j] += A[i][k] * B[k][j]; } } } return C; } åˆ†æ²»æ³•æ±‚è§£ ä½¿ç”¨åˆ†æ²»æ³•æ±‚è§£çŸ©é˜µä¹˜æ³•å®é™…ä¸Šæ˜¯åˆ©ç”¨äº†åˆ†å—çŸ©é˜µçš„æ€§è´¨ã€‚ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨åˆ†æ²»æ³•ï¼Œå‡å®šç›¸ä¹˜çš„çŸ©é˜µéƒ½æ˜¯ n x n çš„ï¼Œå…¶ä¸­ n æ˜¯2çš„å¹‚ã€‚åˆ†æ²»æ³•å°† n x n çš„çŸ©é˜µåˆ’åˆ†ä¸º4ä¸ª n/2 x n/2 çš„å­çŸ©é˜µï¼Œç„¶åè¿›è¡Œè¿ç®—ã€‚å‡è®¾çŸ©é˜µ A ã€ B ã€ C å‡æ»¡è¶³ä¸Šé¢çš„è¦æ±‚ï¼Œé‚£ä¹ˆå®ƒä»¬å¯ä»¥è¿›è¡Œå¦‚ä¸‹è¡¨ç¤ºï¼š $$ A = \\begin{bmatrix}A_{11} \u0026amp; A_{12} \\\\ A_{21} \u0026amp; A_{22} \\\\ \\end{bmatrix}, B = \\begin{bmatrix}B_{11} \u0026amp; B_{12} \\\\ B_{21} \u0026amp; B_{22} \\\\ \\end{bmatrix}, C = \\begin{bmatrix}C_{11} \u0026amp; C_{12} \\\\ C_{21} \u0026amp; C_{22} \\\\ \\end{bmatrix} $$ äºæ˜¯æœ‰ï¼š $$ A = \\begin{bmatrix}C_{11} \u0026amp; C_{12} \\\\ C_{21} \u0026amp; C_{22} \\\\ \\end{bmatrix} = \\begin{bmatrix}A_{11} \u0026amp; A_{12} \\\\ A_{21} \u0026amp; A_{22} \\\\ \\end{bmatrix} \\begin{bmatrix}B_{11} \u0026amp; B_{12} \\\\ B_{21} \u0026amp; B_{22} \\\\ \\end{bmatrix} $$ ä¹Ÿå°±æ˜¯è¯´ï¼š $$ C_{11} = A_{11}B_{11} + A_{12}B_{21} $$ $$ C_{12} = A_{11}B_{12} + A_{12}B_{22} $$ $$ C_{21} = A_{21}B_{11} + A_{22}B_{21} $$ $$ C_{22} = A_{21}B_{12} + A_{22}B_{22} $$ ã€Šç®—æ³•å¯¼è®ºã€‹ä¸Šçš„ä¼ªä»£ç å¦‚ä¸‹ï¼š ä¹¦ä¸Šçš„ä¼ªä»£ç æ©ç›–äº†ä¸€ä¸ªéå¸¸é‡è¦çš„ç»†èŠ‚ï¼Œé‚£å°±æ˜¯å¦‚ä½•åˆ†è§£çŸ©é˜µã€‚å¦‚æœçœŸçš„åˆ›å»ºå‡º12ä¸ªå­çŸ©é˜µï¼Œé‚£å°†ä¼šèŠ±è´¹O($ n^2 $)çš„æ—¶é—´æ¥å¤åˆ¶çŸ©é˜µçš„å…ƒç´ ã€‚ä¸è¿‡ä¹¦ä¸Šç»™å‡ºäº†ä¸€ä¸ªååˆ†å…³é”®çš„æç¤ºâ€”â€”ç”¨ä¸‹æ ‡æ¥æŒ‡æ˜ä¸€ä¸ªå­çŸ©é˜µã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå°±å¯ä»¥é¿å…å¯¹çŸ©é˜µçš„å¤åˆ¶æ“ä½œï¼Œåªéœ€èŠ±è´¹O(1)çš„æ—¶é—´ã€‚æ—¢ç„¶çŸ©é˜µç¬¦åˆä¸Šé¢çš„è¦æ±‚ï¼Œåªéœ€è¦æ”¹å˜çŸ©é˜µçš„è¡¨ç¤ºæ–¹å¼å³å¯ã€‚æ·»åŠ å­çŸ©é˜µåœ¨åŸçŸ©é˜µä¸­çš„å¼€å§‹ä½ç½®åŠå­çŸ©é˜µçš„å¤§å°å°±å¥½äº†ã€‚\njavaå®ç°çš„ä»£ç å¦‚ä¸‹ï¼š\n/** * @param ra Aä¸­è¡Œå¼€å§‹ä¸‹æ ‡ * @param ca Aä¸­åˆ—å¼€å§‹ä¸‹æ ‡ * @param n å­æ–¹é˜µå®½åº¦ */ private int[][] squareMatrixMultiply(int[][] A, int[][] B, int[][] C, int ra, int ca, int rb, int cb, int rc, int cc, int n) { if (n == 1) { C[rc][cc] = A[ra][ca] * B[rb][cb]; // åªæœ‰ä¸€ä¸ªå…ƒç´   } else if (n == 2) { // éƒ½åªæœ‰å››ä¸ªå…ƒç´   C[rc][cc] += A[ra][ca] * B[rb][cb] + A[ra][ca + 1] * B[rb + 1][cb]; // C11 = A11 * B11 + A12 * B21  C[rc][cc + 1] += A[ra][ca] * B[rb][cb + 1] + A[ra][ca + 1] * B[rb + 1][cb + 1]; // C12 = A11 * B12 + A12 * B22  C[rc + 1][cc] += A[ra + 1][ca] * B[rb][cb] + A[ra + 1][ca + 1] * B[rb + 1][cb]; // C21 = A21 * B11 + A22 * B21  C[rc + 1][cc + 1] += A[ra + 1][ca] * B[rb][cb + 1] + A[ra + 1][ca + 1] * B[rb + 1][cb + 1]; // C22 = A21 * B12 + A22 * B22  } else { n /= 2; // åˆ†è§£çŸ©é˜µ  squareMatrixMultiply(A, B, C, ra, ca, rb, cb, rc, cc, n); // A11 * B11  squareMatrixMultiply(A, B, C, ra, ca + n, rb + n, cb, rc, cc, n); // A12 * B21  squareMatrixMultiply(A, B, C, ra, ca, rb, cb + n, rc, cc + n, n); // A11 * B12  squareMatrixMultiply(A, B, C, ra, ca + n, rb + n, cb + n, rc, cc + n, n); // A12 * B22  squareMatrixMultiply(A, B, C, ra + n, ca, rb, cb, rc + n, cc, n); // A21 * B11  squareMatrixMultiply(A, B, C, ra + n, ca + n, rb + n, cb, rc + n, cc, n); // A22 * B21  squareMatrixMultiply(A, B, C, ra + n, ca, rb, cb + n, rc + n, cc + n, n); // A21 * B12  squareMatrixMultiply(A, B, C, ra + n, ca + n, rb + n, cb + n, rc + n, cc + n, n); // A22 * B22  } return C; } Strassenæ–¹æ³• Strassenæ–¹æ³•ä¸æ˜¯å¾ˆç›´è§‚ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å‡å°‘ä¹˜æ³•çš„æ¬¡æ•°ã€‚åˆ†æ²»æ³•ç”¨äº†8æ¬¡ä¹˜æ³•ï¼Œè€ŒStrassenæ–¹æ³•åªç”¨äº†7æ¬¡ä¹˜æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$ O(n^{lg_7}) $ã€‚å®ƒçš„æ­¥éª¤å¦‚ä¸‹ï¼š\n å…ˆå°†çŸ©é˜µAã€Bã€Cåˆ†è§£ä¸º n/2 x n/2 çš„å­çŸ©é˜µï¼Œå¯ä»¥é‡‡ç”¨ä¸Šé¢çš„ä¸‹æ ‡è®¡ç®—æ–¹å¼ï¼Œä½†æˆ‘é‡æ–°åˆ›å»ºäº†å­çŸ©é˜µã€‚ åˆ›å»º10ä¸ª n/2 x n/2 çš„çŸ©é˜µ$ S_1, S_2, \u0026hellip;, S_{10} $:  $$ S_1 = B_{12} - B_{22} $$ $$ S_2 = A_{11} + A_{12} $$ $$ S_3 = A_{21} + A_{22} $$ $$ S_4 = B_{21} - B_{11} $$ $$ S_5 = A_{11} + A_{22} $$ $$ S_6 = B_{11} + B_{22} $$ $$ S_7 = A_{12} - A_{22} $$ $$ S_8 = B_{21} + B_{22} $$ $$ S_9 = A_{11} - A_{21} $$ $$ S_{10} = B_{11} + B_{12} $$ 3. é€’å½’çš„è®¡ç®—7æ¬¡ n/2 x n/2 çš„çŸ©é˜µä¹˜æ³•ï¼š $$ P_1 = A_{11}S_1 = A_{11}B_{12} - A_{11}B_{22} $$ $$ P_2 = B_{22}S_2 = A_{11}B_{22} + A_{12}B_{22} $$ $$ P_3 = B_{11}S_3 = A_{21}B_{11} + A_{22}B_{11} $$ $$ P_4 = A_{22}S_4 = A_{22}B_{21} - A_{22}B_{11} $$ $$ P_5 = S_5S_6 = A_{11}B_{11} + A_{11}B_{22} + A_{22}B_{11} + A_{22}B_{22} $$ $$ P_5 = S_5S_6 = A_{11}B_{11} + A_{11}B_{22} + A_{22}B_{11} + A_{22}B_{22} $$ $$ P_6 = S_7S_8 = A_{12}B_{21} + A_{12}B_{22} - A_{22}B_{21} - A_{22}B_{22} $$ $$ P_7 = S_9S_{10} = A_{11}B_{11} + A_{11}B_{12} - A_{21}B_{11} + A_{21}B_{12} $$ 4. å¯¹$ P_i $ æ‰§è¡ŒåŠ å‡æ³•è¿ç®—å¾—åˆ° C çš„å››ä¸ªå­çŸ©é˜µï¼š $$ C_{11} = P_5 + P_4 - P_2 + P_6 $$ $$ C_{12} = P_1 + P_2 $$ $$ C_{21} = P_3 + P_4 $$ $$ C_{22} = P_5 + P_1 - P_3 - P_7 $$ ç”±äºæˆ‘ç›´æ¥æ‹†åˆ†äº†çŸ©é˜µï¼Œå› æ­¤è¿™ä¸€æ­¥è¿˜éœ€è¦åˆå¹¶å››ä¸ªå­çŸ©é˜µåˆ° C ã€‚\njava ä»£ç å¦‚ä¸‹ï¼š\nprivate int[][] squareMatrixMultiplyStrassen(int[][] A, int[][] B, int ra, int ca, int rb, int cb, int n) { int[][] C = new int[n][n]; if (n == 1) { C[0][0] = A[ra][ca] * B[rb][cb]; return C; } else { // step 1: åˆ†è§£çŸ©é˜µ  n /= 2; // step 2: åˆ›å»º10ä¸ªçŸ©é˜µ  int[][] S1 = squareMatrixAddorSub(B, B, rb, cb + n, rb + n, cb + n, n, false); // S1 = B12 - B22  int[][] S2 = squareMatrixAddorSub(A, A, ra, ca, ra, ca + n, n, true); // S2 = A11 + A12  int[][] S3 = squareMatrixAddorSub(A, A, ra + n, ca, ra + n, ca + n, n, true); // S3 = A21 + A22  int[][] S4 = squareMatrixAddorSub(B, B, rb + n, cb, rb, cb, n, false); // S4 = B21 - B11  int[][] S5 = squareMatrixAddorSub(A, A, ra, ca, ra + n, ca + n, n, true); // S5 = A11 + A22  int[][] S6 = squareMatrixAddorSub(B, B, rb, cb, rb + n, cb + n, n, true); // S6 = B11 + B22  int[][] S7 = squareMatrixAddorSub(A, A, ra, ca + n, ra + n, ca + n, n, false); // S7 = A12 - A22  int[][] S8 = squareMatrixAddorSub(B, B, rb + n, cb, rb + n, cb + n, n, true); // S8 = B21 + B22  int[][] S9 = squareMatrixAddorSub(A, A, ra, ca, ra + n, ca, n, false); // S9 = A11 - A21  int[][] S10 = squareMatrixAddorSub(B, B, rb, cb, rb, cb + n, n, true); // S10 = B11 + B12  // Step 3: è®¡ç®—7æ¬¡ä¹˜æ³•  int[][] P1 = squareMatrixMultiplyStrassen(A, S1, ra, ca, 0, 0, n); // P1 = A11 * S1  int[][] P2 = squareMatrixMultiplyStrassen(S2, B, 0, 0, rb + n, cb + n, n); // P2 = S2 * B22  int[][] P3 = squareMatrixMultiplyStrassen(S3, B, 0, 0, rb, cb, n); // P3 = S3 * B11  int[][] P4 = squareMatrixMultiplyStrassen(A, S4, ra + n, ca + n, 0, 0, n); // P4 = A22 * S4  int[][] P5 = squareMatrixMultiplyStrassen(S5, S6, 0, 0, 0, 0, n); // P5 = S5 * S6  int[][] P6 = squareMatrixMultiplyStrassen(S7, S8, 0, 0, 0, 0, n); // P6 = S7 * S8  int[][] P7 = squareMatrixMultiplyStrassen(S9, S10, 0, 0, 0, 0, n); // P7 = S9 * S10  // Step4: æ ¹æ®P1-P7è®¡ç®—å‡ºC  int[][] T1 = squareMatrixAddorSub(P5, P4, 0, 0, 0, 0, n, true); // P5 + P4  int[][] T2 = squareMatrixAddorSub(P2, P6, 0, 0, 0, 0, n, false); // P2 - P6  int[][] C11 = squareMatrixAddorSub(T1, T2, 0, 0, 0, 0, n, false); // C11 = P5 + P4 - P2 + P6  int[][] C12 = squareMatrixAddorSub(P1, P2, 0, 0, 0, 0, n, true); // C12 = P1 + P2  int[][] C21 = squareMatrixAddorSub(P3, P4, 0, 0, 0, 0, n, true); // C21 = P3 + P4  int[][] T3 = squareMatrixAddorSub(P5, P1, 0, 0, 0, 0, n, true); // P5 + P1  int[][] T4 = squareMatrixAddorSub(P3, P7, 0, 0, 0, 0, n, true); // P3 + P7  int[][] C22 = squareMatrixAddorSub(T3, T4, 0, 0, 0, 0, n, false); // C22 = P5 + P1 - P3 - P7  // åˆå¹¶C11ã€C12ã€C21ã€C22ä¸ºC  for (int i = 0; i \u0026lt; n; i++) { for (int j = 0; j \u0026lt; n; j++) { C[i][j] = C11[i][j]; } } for (int i = 0; i \u0026lt; n; i++) { for (int j = 0; j \u0026lt; n; j++) { C[i][j + n] = C12[i][j]; } } for (int i = 0; i \u0026lt; n; i++) { for (int j = 0; j \u0026lt; n; j++) { C[i + n][j] = C21[i][j]; } } for (int i = 0; i \u0026lt; n; i++) { for (int j = 0; j \u0026lt; n; j++) { C[i + n][j + n] = C22[i][j]; } } } return C; } åè®° å½“ç„¶ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„çŸ©é˜µéƒ½æ˜¯æ–¹é˜µï¼Œ ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„æ–¹é˜µçš„å…ƒç´ ä¸ªæ•°çš„éƒ½æ˜¯2çš„å¹‚ã€‚ä¸ºäº†è®©Strassenæ–¹æ³•é€‚ç”¨äºä¸€èˆ¬çš„çŸ©é˜µä¹˜æ³•ï¼Œå¯ä»¥é€šè¿‡åœ¨åŸçŸ©é˜µçš„è¡Œåˆ—è¡¥é›¶å¾—åˆ°ä¸Šé¢è¦æ±‚çš„çŸ©é˜µã€‚åœ¨è¿™ä¹‹å‰ï¼Œéœ€è¦åˆ¤æ–­è¿™ä¸ªçŸ©é˜µæ˜¯ä¸æ˜¯ä¸Šé¢çš„æ–¹é˜µï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­æ–¹é˜µæ¯è¡Œçš„å…ƒç´ ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚\nä¸€ç§ç®€å•çš„æ–¹æ³•å¦‚ä¸‹ï¼š\nprivate boolean isSquareMatrix(int[][] A) { int rowa = A.length, cola = A[0].length; if ((rowa == cola) \u0026amp;\u0026amp; ((rowa \u0026amp; (rowa - 1)) == 0)) return true; else return false; } æ¯”å¦‚ï¼š8 \u0026amp; 7 = (1000 \u0026amp; 0111) = 0\nå¦‚æœçŸ©é˜µä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„æ–¹é˜µï¼Œé‚£ä¹ˆåœ¨å°†å…¶è½¬æ¢æˆç†æƒ³å½¢å¼çš„æ–¹é˜µä¹‹å‰ï¼Œ è¿˜éœ€è¦æ‰¾åˆ°æ¯”çŸ©é˜µæ¯è¡Œå’Œæ¯åˆ—çš„å…ƒç´ ä¸ªæ•°éƒ½è¦å¤§å¹¶ä¸”æœ€æ¥è¿‘çš„2çš„å¹‚æ¬¡æ–¹æ•°ï¼Œä¸‹é¢æ˜¯ä¸€ç§å¯è¡Œçš„æ–¹æ³•ï¼š\n// è·å–æ¯”aå¤§ï¼Œæœ€æ¥è¿‘açš„2çš„å¹‚æ¬¡æ–¹æ•°  private int nextP2(int a){ int t = 1; while(t \u0026lt; a) t \u0026lt;\u0026lt;= 1; return t; } å‡†å¤‡å·¥ä½œéƒ½åšå¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å°†çŸ©é˜µè½¬åŒ–ä¸ºæˆ‘ä»¬ç†æƒ³çš„æ–¹é˜µäº†ï¼Œæ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥å°†åŸæ¥çš„çŸ©é˜µå¤åˆ¶è¿›æ–°çš„çŸ©é˜µå°±è¡Œäº†ï¼š\nprivate int[][] convertMatrixToStandardSquareMatrix(int[][] A, int n){ int rowa = A.length, cola = A[0].length; int[][] C = new int[n][n]; for(int i = 0;i \u0026lt; rowa;i++){ for(int j = 0;j \u0026lt; cola;j++){ C[i][j] = A[i][j]; } } return C; } å¦‚æ­¤ä»¥æ¥ï¼ŒStrassenæ–¹æ³•æ‰€éœ€è¦çš„æ¡ä»¶éƒ½æœ‰äº†ï¼Œä½†è¿™ä¹ˆè®¡ç®—å‡ºæ¥çš„ç»“æœä¸­ä¼šå‡ºç°å¾ˆå¤šå¾ˆå¤šçš„0ã€‚è¿™çœ‹èµ·æ¥æ˜¯å¾ˆä¸èˆ’æœçš„ï¼Œäºæ˜¯ï¼Œå¯ä»¥å…ˆä¿å­˜åŸæ¥çŸ©é˜µçš„è¡Œæ•°å’Œåˆ—æ•°ï¼Œç„¶åå»æ‰å¤šä½™çš„0ï¼Œå¾—åˆ°å¸¸è§„æ–¹æ³•è®¡ç®—çŸ©é˜µä¹˜æ³•çš„ç»“æœã€‚\n// å¤„ç†ä¸æ˜¯2çš„æŒ‡æ•°æ¬¡å¹‚çš„çŸ©é˜µå˜æˆæ–¹é˜µåè¿ç®—å¤šå‡ºæ¥çš„é‚£ä¸€å¤§å †0  private int[][] removeZerosInMatrix(int[][] A, int rowa, int cola){ int[][] C = new int[rowa][cola]; for(int i = 0;i \u0026lt; rowa;i++){ for(int j = 0;j \u0026lt; cola;j++){ C[i][j] = A[i][j]; } } return C; } ","href":"/notebook/reading_notes/introduction_to_algorithms/matrix-multiplication/","title":"çŸ©é˜µä¹˜æ³•"},{"content":"é—®é¢˜  æœ‰ä¸€ä¸ªæ•°ç»„Aï¼Œå¯»æ‰¾ä¸€ä¸ª A[] çš„å­æ•°ç»„ B[] ï¼Œ ä½¿å¾—Bçš„å…ƒç´ å’Œå¤§äºAçš„ä»»ä½•ä¸€ä¸ªå­æ•°ç»„ã€‚æ¯”å¦‚A = [13, -3, 25, 20, -4, -20, -25, 18, 20, -5, 16, -5, -22, 18, -6, 8], æˆ‘ä»¬è¦æ±‚çš„ B[] å°±æ˜¯ï¼š[18, 20, -5, 16], å®ƒçš„å’Œå¤§äº A[] çš„ä»»ä½•ä¸€ä¸ªå­æ•°ç»„ã€‚\n è§£å†³æ–¹æ¡ˆ æš´åŠ›æ³•æ±‚è§£ æœ€ç®€å•ä¹Ÿæœ€ç›´æ¥çš„è§£é¢˜æ–¹å¼å°±æ˜¯æš´åŠ›æ³•ï¼ˆBrute forceï¼‰ã€‚ç”¨æš´åŠ›æ³•ç›´æ¥ç©·å°½ A[] çš„æ‰€æœ‰å­æ•°ç»„ï¼Œ ç„¶åé€‰æ‹©å…¶ä¸­æœ€å¤§çš„é‚£ä¸ªä½œä¸º B[] å°±å¯ä»¥äº†ã€‚ä½¿ç”¨æš´åŠ›æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º \\( O(n^2) \\) ã€‚ javaä»£ç å¦‚ä¸‹:\npublic int[] findMaxSubarray(int left, int right, int[] data){ int i, j, maxLeft = left, maxRight = left, sum = Integer.MIN_VALUE, tempSum; for(i = left;i \u0026lt;= right;i++){ tempSum = 0; // data[i..j]çš„å’Œ  for(j = i;j \u0026lt;= right;j++){ tempSum += data[j]; if(tempSum \u0026gt; sum){ sum = tempSum; maxLeft = i; maxRight = j; } } } return Arrays.copyOfRange(data, maxLeft, maxRight + 1); } è™½ç„¶æš´åŠ›æ³•èƒ½å¤Ÿå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œä½†æ˜¯å› ä¸ºæš´åŠ›æ³•çš„è§£ç©ºé—´å·¨å¤§ï¼Œå› æ­¤åªé€‚ç”¨äºæ•°é‡ä¸å¤§çš„åœºåˆã€‚ä¸‹é¢é‡‡å–çš„æ˜¯ä¸€ç§è¾ƒä¸ºé«˜æ•ˆçš„æ–¹æ³•â€”â€”åˆ†æ²»æ³•ã€‚\nåˆ†æ²»æ³•æ±‚è§£ å‡å¦‚æˆ‘ä»¬è¦æ±‚çš„æ˜¯ A[left, right] è¿™ä¸ªæ•°ç»„çš„æœ€å¤§å­æ•°ç»„ã€‚åˆ†æ²»æ³•çš„æ€æƒ³æ˜¯ï¼šdivide -\u0026gt; conquer -\u0026gt; combine , å°±æ˜¯è¯´ï¼šå…ˆæŠŠå¤§é—®é¢˜åˆ†è§£æˆä¸€ç³»åˆ—çš„å°é—®é¢˜ï¼Œç„¶åæ±‚è§£å°é—®é¢˜ï¼Œæœ€åæŠŠå°é—®é¢˜çš„è§£åˆå¹¶èµ·æ¥å¾—åˆ°å¤§é—®é¢˜çš„è§£ã€‚å½“ç„¶ï¼Œæœ‰ä¸€ä¸ªå‰æå°±æ˜¯ï¼šå¤§é—®é¢˜çš„è§£çš„ç¡®æ˜¯æœ‰è¿™äº›å°é—®é¢˜æ„æˆçš„ã€‚ å¯¹äºä»»ä½•ä¸€ä¸ªé•¿åº¦å¤§äº2çš„æ•°ç»„ A[left, right] ï¼Œ æˆ‘ä»¬æ€»èƒ½æŠŠå®ƒåˆ†è§£ä¸ºä¸¤ä¸ªå­æ•°ç»„ï¼š A[left, mid] å’Œ A[mid + 1, right] ã€‚å‡è®¾æˆ‘ä»¬è¦æ±‚çš„æ˜¯ B[] = A[i, j] ,å¦‚æ­¤ä¸€æ¥ï¼Œ A[i, j] åªæœ‰ä¸‰ç§å¯èƒ½ï¼š\n å®Œå…¨ä½äº A[] çš„å·¦åŠéƒ¨åˆ†ï¼Œå³ï¼š left \u0026lt;= i \u0026lt;= j \u0026lt;= mid ; å®Œå…¨ä½äº A[] çš„å³åŠéƒ¨åˆ†ï¼Œå³ï¼š mid + 1 \u0026lt;= i \u0026lt;= j \u0026lt;= right ; åŒæ—¶ä½äºå·¦å³ä¸¤éƒ¨åˆ†ï¼Œ å³ï¼š left \u0026lt;= i \u0026lt;= j \u0026lt;= right ;  å¯¹äºå‰ä¸¤ç§æƒ…å†µï¼Œå¯ä»¥ç›´æ¥é€’å½’æ±‚è§£ã€‚å¯¹äºç¬¬ä¸‰ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±è¦é‡‡ç”¨å…¶å®ƒçš„æ–¹å¼äº†ã€‚å¯¹äºè¶Šè¿‡ä¸­ç‚¹çš„ç¬¬ä¸‰ç§æƒ…å†µï¼Œ A[i, j] å¯ä»¥æ‹†åˆ†ä¸º A[i, mid] å’Œ A[mid + 1, j] ã€‚ ç”±äºä¸­ç‚¹åŒ…å«åœ¨ç»“æœä¹‹å†…ï¼Œæ‰€ä»¥å¯ä»¥è¿™ä¹ˆåšï¼š\n å¯¹äºå·¦åŠéƒ¨åˆ†ï¼Œ ä» A[mid] å¼€å§‹ï¼Œ å‘ A[left] é è¿‘ï¼Œ å¯»æ‰¾ A[i, mid] ; å¯¹äºå³åŠéƒ¨åˆ†ï¼Œ ä» A[mid + 1] å¼€å§‹ï¼Œ å‘ A[right] é è¿‘ï¼Œ å¯»æ‰¾ A[mid + 1, j] ;  ä½¿ç”¨åˆ†æ²»æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(nlogn).\njavaå®ç°çš„ä»£ç å¦‚ä¸‹ï¼š\npublic int[] findMaxCrossingArray(int left, int mid, int right, int[] data){ int maxLeftSum = Integer.MIN_VALUE; int sum = 0; int i, j, maxLeft = mid, maxRight = mid + 1; for(i = mid;i \u0026gt;= left;i--){ // [left, mid]çš„maxSum  sum += data[i]; if(sum \u0026gt; maxLeftSum){ maxLeftSum = sum; maxLeft = i; } } sum = 0; int maxRightSum = Integer.MIN_VALUE; for(j = mid + 1;j \u0026lt;= right;j++){ // [mid + 1, right] çš„maxSum  sum += data[j]; if(sum \u0026gt; maxRightSum){ maxRightSum = sum; maxRight = j; } } return Arrays.copyOfRange(data, maxLeft, maxRight + 1); // å¾—åˆ°A[i, j]  } ç„¶åä¸‹é¢æ˜¯é€’å½’æ±‚è§£åŸé—®é¢˜çš„ä»£ç ï¼š\npublic int[] findMaxSubarray(int left, int right, int[] data){ // å¯»æ‰¾æœ€å¤§å­æ•°ç»„  if(left == right) return data; else{ int mid = (left + right) / 2; int[] maxLeftArray = findMaxSubarray(left, mid, data); int[] maxRightArray = findMaxSubarray(mid + 1, right, data); int[] maxCrossingArray = findMaxCrossingArray(left, mid, right, data); int sumLeft = sumArray(0, maxLeftArray.length - 1, maxLeftArray); int sumRight = sumArray(0, maxRightArray.length - 1, maxRightArray); int sumCrossing = sumArray(0, maxCrossingArray.length - 1, maxCrossingArray); if(sumLeft \u0026gt;= sumRight \u0026amp;\u0026amp; sumLeft \u0026gt;= sumCrossing) return maxLeftArray; else if(sumRight \u0026gt;= sumLeft \u0026amp;\u0026amp; sumRight \u0026gt;= sumCrossing) return maxRightArray; else return maxCrossingArray; } } åŠ¨æ€è§„åˆ’æ±‚è§£ ã€Šç®—æ³•å¯¼è®ºã€‹åœ¨ä¹ é¢˜ä¸­è®²åˆ°ï¼š\n Use the following ideas to develop a nonrecursive, linear-time algorithm for the maximum-subarray problem. Start at the left end of the array, and progress toward the right, keeping track of the maximum subarray seen so far. Knowing a maximum subarray of A[1..j], extend the answer to find a maximum subarray ending at index j + 1 by using the following observation: a maximum subarray of A[1..j + 1] is either a maximum subarray of A[1..j] or a subarray A[i..j + 1], for some 1 \u0026lt;= i \u0026lt;= j + 1. Determine a maximum subarray of the form A[i..j + 1] in constant time based on knowing a maximum subarray ending at index j .\n ç”¨ä¸­æ–‡æ¥è¯´å°±æ˜¯ï¼š\n è‹¥å·²çŸ¥A[1\u0026hellip;j]çš„æœ€å¤§å­æ•°ç»„ï¼ŒåŸºäºå¦‚ä¸‹æ€§è´¨å¯ä»¥å¾—åˆ° A[1..j + 1] çš„æœ€å¤§å­æ•°ç»„: A[1..j + 1] çš„æœ€å¤§å­æ•°ç»„è¦ä¹ˆæ˜¯ A[1..j] çš„æœ€å¤§å­æ•°ç»„ï¼Œè¦ä¹ˆæ˜¯æŸä¸ªå­æ•°ç»„ A[i..j + 1] (1 =\u0026lt; i \u0026lt;= j + 1) ã€‚è¿™ä¸ªç®—æ³•æ˜¯çº¿æ€§æ—¶é—´O(n)ã€‚\n å› æ­¤ï¼Œéœ€è¦è®°å½• A[1..j] çš„æœ€å¤§å­æ•°ç»„ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæƒ³ï¼šå¦‚æœå‰é¢çš„è‹¥å¹²å’Œå°äº0ï¼Œ è¿™å¯¹ç»“æœæ²¡æœ‰ä»»ä½•çš„å¸®åŠ©ï¼Œåº”è¯¥ä¸¢å¼ƒï¼Œé‡æ–°å¼€å§‹è®¡ç®—å¹¶æ›´æ–°ä½ç½®æ ‡è®°ï¼›å¦åˆ™ï¼Œå‘åå»¶ä¼¸ã€‚ javaä»£ç å¦‚ä¸‹ï¼š\npublic int[] findMaxSubarray(int left, int right, int[] data){ int maxLeft = left, maxRight = left, sum = Integer.MIN_VALUE, temp = left; int[] tempSum = new int[right - left + 1]; tempSum[0] = data[left]; for(int i = left + 1;i \u0026lt;= right;i++){ if(tempSum[i - left - 1] \u0026lt; 0){ // å‰é¢çš„æœ€å¤§å’Œå°äº0ï¼Œç›´æ¥ä¸¢å¼ƒ, ä»ä¸‹ä¸€ä¸ªå¼€å§‹è€ƒè™‘  tempSum[i] = data[i]; temp = i; } else{ // å‘åå»¶ä¼¸  tempSum[i - left] = tempSum[i - left - 1] + data[i]; } if(tempSum[i - left] \u0026gt; sum){ sum = tempSum[i - left]; maxRight = i; maxLeft = temp; } } return Arrays.copyOfRange(data, maxLeft, maxRight + 1); } ","href":"/notebook/reading_notes/introduction_to_algorithms/maximum-sub-array-problem/","title":"æœ€å¤§å­æ•°ç»„é—®é¢˜"},{"content":"","href":"/tags/c%E7%AE%97%E6%B3%95/","title":"Cç®—æ³•"},{"content":" é”®ç´¢å¼•æœç´¢æ–¹æ³•ä¸­ï¼Œè¡¨ä¸­çš„ç¬¬ i ä¸ªä½ç½®ä¿å­˜äº†é”®ä¸º i å¯¹åº”çš„é¡¹ï¼Œä»¥ä¾¿è¾¾åˆ°å¿«é€Ÿè®¿é—®çš„ç›®çš„ã€‚å®ƒå°†é”®ä½œä¸ºæ•°ç»„çš„ç´¢å¼•ï¼Œå¹¶ä¸”ä¾èµ–äºåŒä¸€èŒƒå›´å†…ä¸åŒæ•´æ•°çš„é”®ä½œä¸ºè¡¨çš„ç´¢å¼•ã€‚è¿™ç§æ–¹æ³•ä¸é€‚ç”¨äºæ›´ä¸€èˆ¬çš„é”®ã€‚å“ˆå¸Œæ–¹æ³•æ‰©å±•äº†é”®ç´¢å¼•æœç´¢ï¼Œå®ƒé€šè¿‡ç®—æœ¯è¿ç®—æŠŠé”®è½¬æ¢ä¸ºè¡¨åœ°å€ï¼Œä»¥è¾¾åˆ°å¿«é€Ÿè®¿é—®çš„ç›®çš„ã€‚\n ä½¿ç”¨å“ˆå¸Œçš„æœç´¢ç®—æ³•åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼š\n å“ˆå¸Œå‡½æ•°ï¼šå°†é”®è½¬åŒ–ä¸ºè¡¨åœ°å€ å†²çªè°ƒèŠ‚ï¼šè§£å†³æ˜ å°„åˆ°åŒä¸€è¡¨åœ°å€ä¹‹é—´çš„é”®çš„å†²çª  å“ˆå¸Œå‡½æ•° å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªé•¿åº¦ä¸º M çš„è¡¨ï¼Œå“ˆå¸Œå‡½æ•°è¦åšçš„å°±æ˜¯æŠŠé”®è½¬æ¢ä¸º [0, M-1] ä¹‹é—´çš„æ•´æ•°ã€‚\nå–æ¨¡å“ˆå¸Œå‡½æ•° ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯é€‰æ‹©ä¸€ä¸ªç´ æ•° M åšä¸ºè¡¨é•¿ï¼Œç„¶åï¼š h(x) = k mod M ã€‚å…¶ä¸­ k ä¸ºé”®æ‰€å¯¹åº”çš„æ•´æ•°ã€‚ å¯¹äºæ•´æ•°é”®ï¼Œè¿˜å¯ä»¥é‡‡ç”¨ä¹˜æ³•å–æ¨¡æ³•ï¼šh(x) = [k * Î±] mod M ã€‚ Î± å¸¸è®¾ä¸ºé»„é‡‘æ¯”ï¼ˆ0.618033\u0026hellip;ï¼‰ã€‚\nå†²çªè°ƒèŠ‚ é“¾åœ°å€æ³• ä¸ºæ¯ä¸ªæ•£åˆ—åœ°å€å»ºä¸€ä¸ªé“¾è¡¨ï¼Œå°†æ•£åˆ—åˆ°åŒä¸€ä¸ªåœ°å€çš„å…³é”®å­—æ”¾å…¥ç›¸åº”çš„é“¾è¡¨ä¸­ã€‚é€‚åˆéš¾ä»¥é¢„æµ‹å¡«å…¥æ•£åˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°å¹¶ä¸”å†…å­˜ä¸æ˜¯å¤ªå……è¶³çš„æƒ…å†µã€‚\nçº¿æ€§æ¢æµ‹æ³• å¦‚æœèƒ½å¤Ÿé¢„æµ‹å¡«å…¥æ•£åˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°å¹¶ä¸”å†…å­˜å……è¶³ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•ã€‚ å½“äº§ç”Ÿå†²çªæ—¶ï¼Œæ£€æŸ¥è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç©ºçš„ä½ç½®ï¼Œç„¶åå°†é¡¹æ”¾è¿›å»ã€‚ çº¿æ€§æ¢æµ‹æ³•ä¸€æ¬¡æ¢æµ‹å¯ä»¥è¾¨åˆ«ä¸‰ç§å¯èƒ½çš„ç»“æœï¼š\n å¦‚æœè¡¨ä½ç½®åŒ…å«ä¸€ä¸ªä¸æœç´¢é”®åŒ¹é…çš„é¡¹ï¼Œåˆ™å‘½ä¸­ï¼› å¦‚æœè¡¨ä½ç½®ä¸ºç©ºï¼Œåˆ™æœç´¢å¤±è´¥ï¼› å¦‚æœè¡¨ä½ç½®åŒ…å«ä¸€ä¸ªä¸æœç´¢é”®ä¸åŒ¹é…çš„é¡¹ï¼Œåˆ™ç»§ç»­æ¢æµ‹æ›´é«˜åœ°å€ç›´åˆ°å‡ºç°ä»¥ä¸Šä¸¤ç§æƒ…å†µã€‚  å†å“ˆå¸Œæ³• å†å“ˆå¸Œæ³•çš„åŸºæœ¬ç­–ç•¥å’Œçº¿æ€§æ¢æµ‹æ³•ä¸€è‡´ã€‚ä¸åŒçš„æ˜¯ï¼Œä»–ä¸æ£€æŸ¥å†²çªä¹‹åçš„æ¯ä¸€ä¸ªä½ç½®ï¼Œè€Œæ˜¯ä½¿ç”¨ç¬¬äºŒä¸ªæ•£åˆ—å‡½æ•°å¾—åˆ°ç”¨äºæ¢æµ‹åºåˆ—çš„å›ºå®šå¢é‡ã€‚\næ€»ç»“  çº¿æ€§æ¢æµ‹æ³•æ˜¯ç½ªæœ€å¿«çš„ï¼ˆå‰æï¼šå†…å­˜è¶³å¤Ÿå¤§ï¼Œä¿è¯å“ˆå¸Œè¡¨æ˜¯ç¨€ç–çš„ï¼‰ å†å“ˆå¸Œæ³•å¯¹å†…å­˜çš„ä½¿ç”¨æ•ˆç‡æœ€é«˜ï¼Œä½†æ˜¯éœ€è¦é¢å¤–çš„æ—¶é—´æ¥è®¡ç®—ç¬¬äºŒä¸ªå“ˆå¸Œå‡½æ•° é“¾åœ°å€æ³•æœ€æ˜“å®ç°å’Œéƒ¨ç½²  ","href":"/notebook/reading_notes/algorithms_in_c/hashing-table/","title":"å“ˆå¸Œè¡¨"},{"content":"æ ‘æ˜¯æ»¡è¶³ä¸€å®šè¦æ±‚çš„é¡¶ç‚¹å’Œè¾¹çš„éç©ºé›†åˆã€‚\näºŒå‰æ ‘ äºŒå‰æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹è‡³å¤šæœ‰2ä¸ªå­èŠ‚ç‚¹ã€‚ ä¸€ç§è¡¨ç¤ºæ–¹æ³•ï¼š\nstruct Node{type key; Node *lchild, *richild;} typedef Node *link; è¿™ç§è¡¨ç¤ºæ–¹æ³•åªé€‚åˆä»æ ¹èŠ‚ç‚¹å¼€å§‹è‡ªé¡¶å‘ä¸‹çš„æ“ä½œï¼Œè€Œä¸é€‚åˆè‡ªåº•å‘ä¸Šçš„æ“ä½œã€‚ä¸è¿‡å¯ä»¥åœ¨èŠ‚ç‚¹çš„å®šä¹‰ä¸­åŠ å…¥æŒ‡å‘çˆ¶èŠ‚ç‚¹çš„è¿æ¥æ”¯æŒè¿™ç§åŠŸèƒ½ã€‚ ä¸äºŒå‰æ ‘ç±»ä¼¼çš„è¿˜æœ‰Må‰æ ‘ï¼Œå®ƒçš„æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåªæœ‰Mä¸ªèŠ‚ç‚¹ã€‚å¹¿ä¹‰çš„æ ‘æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰ä»»æ„å¤šä¸ªå­èŠ‚ç‚¹ï¼Œå¯ä»¥ç”¨äºŒå‰æ ‘æ¥è¡¨ç¤ºå®ƒä»¬ï¼Œæ–¹æ³•å°±æ˜¯â€”â€”â€œå·¦å­©å­ï¼Œå³å…„å¼Ÿâ€ã€‚æ ‘çš„åºåˆ—å°±å½¢æˆäº†æœ‰åºæ£®æ—ã€‚\n äºŒå‰æ ‘å’Œæœ‰åºæ£®æ—ä¹‹é—´å­˜åœ¨ä¸€ä¸€çš„å¯¹åº”å…³ç³»ã€‚\n äºŒå‰æ ‘çš„ä¸€äº›æ•°å­¦æ€§è´¨  ä¸€æ£µäºŒå‰æ ‘æœ‰ N ä¸ªå†…éƒ¨èŠ‚ç‚¹ï¼Œæœ‰ N + 1 ä¸ªå¤–éƒ¨èŠ‚ç‚¹ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰ã€‚ åŒ…å« N ä¸ªå†…éƒ¨èŠ‚ç‚¹çš„äºŒå‰æ ‘æœ‰ 2N ä¸ªé“¾æ¥ï¼š N - 1 ä¸ªå¤–éƒ¨èŠ‚ç‚¹çš„é“¾æ¥å’Œ N + 1 ä¸ªå†…éƒ¨èŠ‚ç‚¹çš„é“¾æ¥ã€‚ æ ‘ä¸­èŠ‚ç‚¹çš„æ‰€åœ¨çš„å±‚æ˜¯å®ƒçš„çˆ¶èŠ‚ç‚¹çš„ä¸‹ä¸€å±‚ï¼ˆæ ¹èŠ‚ç‚¹ä½äºç¬¬ 0 å±‚ï¼‰ã€‚æ ‘çš„é«˜åº¦ä¸ºæ ‘èŠ‚ç‚¹çš„æœ€å¤§å±‚ã€‚æ ‘çš„è·¯å¾„é•¿åº¦ä¸ºæ‰€æœ‰æ ‘èŠ‚ç‚¹çš„å±‚æ€»å’Œï¼šå¤–éƒ¨è·¯å¾„é•¿åº¦ä¸ºæ‰€æœ‰å¤–éƒ¨èŠ‚ç‚¹çš„å±‚æ€»å’Œï¼Œå†…éƒ¨è·¯å¾„é•¿åº¦ä¸ºæ‰€æœ‰å†…éƒ¨èŠ‚ç‚¹çš„å±‚æ€»å’Œã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªè®¡ç®—æ ‘è·¯å¾„é•¿åº¦çš„ç®€ä¾¿æ–¹æ³•ï¼šå¯¹äºæ‰€æœ‰çš„ k , æ±‚ k ä¸ k å±‚èŠ‚ç‚¹æ•°ä¹‹ç§¯çš„æ€»å’Œã€‚ å…·æœ‰ N ä¸ªå†…éƒ¨èŠ‚ç‚¹çš„äºŒå‰æ ‘çš„å¤–éƒ¨è·¯å¾„é•¿åº¦æ¯”å†…éƒ¨è·¯å¾„é•¿åº¦å¤§ 2N ã€‚ å…·æœ‰ N ä¸ªå†…éƒ¨èŠ‚ç‚¹çš„äºŒå‰æ ‘çš„é«˜åº¦çš„æœ€å°å€¼ä¸º lgN ï¼Œæœ€å¤§å€¼ä¸º N - 1 ã€‚ å½“æ ‘é€€åŒ–æˆåªæœ‰ä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå°±æ˜¯æœ€åçš„æƒ…å†µã€‚ å…·æœ‰ N ä¸ªå†…éƒ¨èŠ‚ç‚¹çš„äºŒå‰æ ‘å†…éƒ¨è·¯å¾„é•¿åº¦æœ€å°å€¼ä¸º Nlg(N/4) ï¼Œæœ€å¤§å€¼ä¸º N(N - 1)/2 ã€‚  æ ‘çš„éå†  å‰åºéå† æ ¹-\u0026gt;å·¦å­©å­-\u0026gt;å³å­©å­ ä¸­åºéå† å·¦å­©å­-\u0026gt;æ ¹-\u0026gt;å³å­©å­ ååºéå† å·¦å­©å­-\u0026gt;å³å­©å­-\u0026gt;æ ¹ å±‚æ¬¡éå† ä»ä¸Šåˆ°ä¸‹ï¼Œä»å·¦åˆ°å³  å‰åºéå†ï¼ˆé€’å½’ç‰ˆï¼‰ï¼š\nvoid preorderTraverse(link h, void visit(link)){ if(h == root) return; visit(h); preorderTraverse(h -\u0026gt; lchild, visit); preorderTraverse(h -\u0026gt; rchild, visit); } å‰åºéå†ï¼ˆéé€’å½’ç‰ˆï¼‰ï¼š\nvoid preorderTraverse(link h, void visit(link)){ stack\u0026lt;link\u0026gt; stk(maxn); s.push(h); while(!s.empty()){ visit(s.top()); s.pop(); if(h -\u0026gt; lchild != null) s.push(h -\u0026gt; lchild); if(h -\u0026gt; rchild != null) s.push(h -\u0026gt; rchild); } } ååºéå†å’Œä¸­åºéå†åªéœ€è¦äº¤æ¢å‰åºéå†ä¸­è®¿é—®èŠ‚ç‚¹çš„é¡ºåºå³å¯ã€‚ å±‚æ¬¡éå†ï¼š\nvoid levelTraverse(link h, void visit(link)){ queue\u0026lt;link\u0026gt; q(maxn); q.push(h); while(!q.empty()){ visit(q.front()); q.pop(); if(h -\u0026gt; lchild != null) q.push(q -\u0026gt; lchild); if(h -\u0026gt; rchild != null) q.push(q -\u0026gt; rchild); } } è®¡ç®—æ ‘å«æœ‰çš„èŠ‚ç‚¹æ•°ï¼š\nint count(link h){ if(h == null) return 0; return count(h -\u0026gt; lchild) + count(h -\u0026gt; rchild) + 1; } è®¡ç®—æ ‘çš„é«˜åº¦ï¼š\nint height(link h){ if(h == null) return -1; return max(height(h -\u0026gt; lchild), height(h -\u0026gt; rchild)) + 1; } äºŒå‰æœç´¢æ ‘ äºŒå‰æ ‘æœç´¢æ ‘æ˜¯ä¸€æ£µäºŒå‰æ ‘ï¼Œå®ƒè¦ä¹ˆæ˜¯ä¸€æ£µç©ºæ ‘ï¼Œè¦ä¹ˆå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š\n è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ä¸ºç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼ä¸å¤§äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ä¸ºç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼ä¸å°äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ ä»»æ„èŠ‚ç‚¹çš„å·¦å³å­æ ‘éƒ½æ˜¯äºŒå‰æœç´¢æ ‘ æ ‘ä¸­æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹  äºŒå‰æœç´¢æ ‘ä¸­çš„æŸ¥æ‰¾ åœ¨äºŒå‰æœç´¢æ ‘hä¸­æŸ¥æ‰¾vçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š\n è‹¥hæ˜¯ç©ºæ ‘ï¼Œåˆ™è¿”å›æŸ¥æ‰¾å¤±è´¥ï¼Œå¦åˆ™ï¼š è‹¥xä¸ºæ ¹èŠ‚ç‚¹å¯¹åº”çš„æ•°æ®å€¼ï¼Œåˆ™æŸ¥æ‰¾æˆåŠŸï¼Œå¦åˆ™ï¼š è‹¥xå°äºæ ¹èŠ‚ç‚¹å¯¹åº”çš„æ•°æ®å€¼ï¼Œåˆ™æŸ¥æ‰¾å·¦å­æ ‘ï¼Œå¦åˆ™ï¼š æŸ¥æ‰¾å³å­æ ‘  Item searchP(link h, type v){ if(h == 0) return nullItem; type t = h -\u0026gt; item.getKey(); if(t == v) return h -\u0026gt; item; if(v \u0026lt; t) searchP(h -\u0026gt; lchild, v); else searchP(h -\u0026gt; rchild, v); } åœ¨äºŒå‰æœç´¢æ ‘ä¸­æ’å…¥èŠ‚ç‚¹ åœ¨äºŒå‰æœç´¢æ ‘hä¸­æ’å…¥èŠ‚ç‚¹vçš„è¿‡ç¨‹å¦‚ä¸‹ï¼Œå…¶ä¸­æ’å…¥çš„èŠ‚ç‚¹æ€»æ˜¯å¶å­èŠ‚ç‚¹ï¼š\n è‹¥hæ˜¯ç©ºæ ‘ï¼Œåˆ™å°†væ‰€æŒ‡çš„èŠ‚ç‚¹ä½œä¸ºæ ¹èŠ‚ç‚¹æ’å…¥ï¼Œå¦åˆ™ï¼š è‹¥vå¯¹åº”çš„æ•°æ®å€¼å°äºæ ¹èŠ‚ç‚¹å¯¹åº”çš„æ•°æ®å€¼ï¼Œåˆ™åœ¨å·¦å­æ ‘ä¸­æ’å…¥ï¼Œå¦åˆ™ï¼š åœ¨å³å­æ ‘ä¸­æ’å…¥  void insertP(link \u0026amp;h, Item x){ if(h == 0) {h = new Node(x);return;} if(x.getKey() \u0026lt; h -\u0026gt; item.getKey()) insertP(h -\u0026gt; lchild, x); else insertP(h -\u0026gt; rchild, x); } ä¸Šé¢çš„æ’å…¥åªé€‚ç”¨äºæ’å…¥çš„èŠ‚ç‚¹æœ€ç»ˆæ˜¯å¶å­èŠ‚ç‚¹çš„æƒ…å†µï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥æ„é€ ä¸€æ£µæ ‘æ¥å¯¹æ•°æ®è¿›è¡Œæ’åºã€‚å¯¹äºæ’å…¥çš„èŠ‚ç‚¹ä¸ä¸€å®šåˆ°è¾¾å¶å­èŠ‚ç‚¹çš„æƒ…å†µï¼Œéœ€è¦è€ƒè™‘å…¶å®ƒçš„æ’å…¥æ–¹æ³•ã€‚æ—‹è½¬æ˜¯æ ‘çš„ä¸€ç§åŸºæœ¬å˜æ¢ï¼Œå®ƒå…è®¸äº¤æ¢æ ‘ä¸­æ ¹åŠå…¶ä¸€ä¸ªå­©å­çš„è§’è‰²ï¼ŒåŒæ—¶ä¿æŒèŠ‚ç‚¹ä¸­é”®çš„æ¬¡åºã€‚ æ¶‰åŠåˆ°3ä¸ªé“¾æ¥å’Œä¸¤ä¸ªèŠ‚ç‚¹ã€‚\n å³æ—‹ï¼ˆå·¦å­©å­ä¸ºè½´ï¼Œå½“å‰èŠ‚ç‚¹å³æ—‹ï¼‰ã€‚ç»“æœå°±æ˜¯ï¼šåŸæ¥çš„å·¦å­©å­æˆä¸ºäº†æ–°çš„æ ¹ï¼ŒåŸæ¥å·¦å­©å­çš„å·¦å­©å­ä¾æ—§æ˜¯æ–°æ ¹çš„å·¦å­©å­ï¼Œæ—§æ ¹çš„å³å­©å­ä¾æ—§æ˜¯æ—§æ ¹çš„å³å­©å­ã€‚æ—§æ ¹æˆä¸ºäº†æ–°æ ¹çš„å³å­©å­ï¼ŒåŸæ¥å·¦å­©å­çš„å³å­©å­æˆä¸ºäº†æ—§æ ¹ï¼ˆæ–°æ ¹çš„å³å­©å­ï¼‰çš„å·¦å­©å­ã€‚\n void rotateR(link \u0026amp;h){ link t = h -\u0026gt; lchild; h -\u0026gt; lchild = t -\u0026gt; rchild; t -\u0026gt; rchild = h; h = t; }  å·¦æ—‹å’Œå³æ—‹ç›¸åã€‚å³å­©å­ä¸ºè½´ï¼Œå½“å‰èŠ‚ç‚¹å·¦æ—‹ã€‚åŸæ¥çš„å³å­©å­æˆä¸ºäº†æ–°çš„æ ¹ï¼Œæ—§æ ¹æˆä¸ºäº†æ–°æ ¹çš„å·¦å­©å­ã€‚åŸæ¥çš„å³å­©å­çš„å·¦å­©å­æˆä¸ºäº†æ—§æ ¹çš„å³å­©å­ã€‚\n void rotateL(link \u0026amp;h){ link t = h -\u0026gt; rchild; h -\u0026gt; rchild = h -\u0026gt; lchild; t -\u0026gt; lchild = h; h = t; } æœ‰äº†å·¦æ—‹å’Œå³æ—‹ä¹‹åï¼Œå°±èƒ½è¿…é€Ÿå¾—åˆ°åœ¨BSTçš„æ ¹æ’å…¥æ–°èŠ‚ç‚¹çš„é€’å½’å‡½æ•°ï¼Œå†é€‚å½“å­æ ‘çš„æ ¹æ’å…¥æ–°é¡¹ï¼Œç„¶åé€šè¿‡æ—‹è½¬å°†å®ƒå¸¦åˆ°ä¸»æ ‘çš„æ ¹ã€‚\nvoid insertT(link \u0026amp;h, Item x){ if(h == 0){h = new Node(x);return;} if(x.getKey() \u0026lt; h -\u0026gt; item.getkey()){insertT(h -\u0026gt; lchild, x); rotateR(h);} else{insertT(h -\u0026gt; rchild,x); rotateL(h);} } åœ¨äºŒå‰æœç´¢æ ‘ä¸­é€‰æ‹©èŠ‚ç‚¹ å¯ä»¥é‡‡ç”¨å¿«é€Ÿæ’åºåˆ’åˆ†çš„æ€æƒ³æ¥é€‰æ‹©BSTä¸­ç¬¬ k å°çš„èŠ‚ç‚¹ã€‚ä¸è¿‡è¿™éœ€è¦ç»™ç»“ç‚¹å¢åŠ ä¸€ä¸ªè®¡æ•°åŸŸï¼Œç„¶åè¿˜éœ€è¦ä¿®æ”¹å…¶ä»–æ‰€æœ‰çš„å‡½æ•°ã€‚\nItem selectR(link h, int k){ if(h == 0) return nullItem; int c = (h -\u0026gt; lchild == 0) ? 0 : h -\u0026gt; lchild -\u0026gt; cnt; if(c \u0026gt; k) return selectR(h -\u0026gt; lchild, k); if(c \u0026lt; k) return selectR(h -\u0026gt; rchild, k - c - 1); return h -\u0026gt; item; } å¯¹äºŒå‰æœç´¢æ ‘è¿›è¡Œåˆ’åˆ† å¯ä»¥å°†é€‰æ‹©è¿ç®—ä¿®æ”¹ä¸ºåˆ’åˆ†è¿ç®—ï¼Œå®ƒé‡æ’æ ‘ï¼Œåˆ©ç”¨å·¦æ—‹å’Œå³æ—‹å°†ç¬¬ k å°çš„å…ƒç´ æ”¾åˆ°æ ¹ã€‚\nlink partition(link \u0026amp;h, int k){ int c = (h -\u0026gt; lchild == 0) ? 0 : h -\u0026gt; lchild -\u0026gt; cnt; if(c \u0026gt; k) {partition(h -\u0026gt; lchild, k); rotateR(h);} if(c \u0026lt; k) {partition(h -\u0026gt; rchild, k - c - 1); rotateL(h);} } åœ¨äºŒå‰æœç´¢æ ‘ä¸­åˆ é™¤èŠ‚ç‚¹ ä»BSTåˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥èŠ‚ç‚¹æ˜¯å¦åœ¨å…¶ä¸­ä¸€æ£µå­æ ‘ä¸­ã€‚å¦‚æœæ˜¯åˆ™ç”¨é€’å½’åˆ é™¤èŠ‚ç‚¹åçš„ç»“æœæ›¿æ¢å­æ ‘ã€‚å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹åœ¨æ ¹éƒ¨ï¼Œåˆ™éœ€è¦ç”¨åˆå¹¶ä¸¤æ£µå­æ ‘çš„ç»“æœæ›¿æ¢åŸæ¥çš„æ ‘ã€‚\nlink joinLR(link l, link r){ if(r == 0) return l; partition(r, 0); r -\u0026gt; lchild = l; return r; } void removeR(link \u0026amp;h, type v){ if(h == 0) return; type w = h -\u0026gt; item.getKey(); if(v \u0026lt; w) removeR(h -\u0026gt; lchild, v); if(v \u0026gt; w) removeR(h -\u0026gt; rchild, v); if(v == w){ link t = h; h = joinLR(h -\u0026gt; lchild, h -\u0026gt; rchild); delete t; } } åˆå¹¶ä¸¤æ£µäºŒå‰æœç´¢æ ‘ ä¹¦ä¸­çš„ä¸€ä¸ªçº¿æ€§æ—¶é—´çš„é€’å½’å®ç°ï¼šé¦–å…ˆï¼Œåˆ©ç”¨æ ¹æ’å…¥å°†ç¬¬ä¸€è¯¾BSTçš„æ ¹æ’å…¥åˆ°ç¬¬äºŒæ£µBSTä¸­ã€‚è¿™ä¼šå¾—åˆ°ä¸¤æ£µé”®å°äºæ ¹çš„å­æ ‘å’Œä¸¤æ£µé”®å¤§äºæ ¹çš„å­æ ‘ã€‚ç„¶åé€’å½’çš„åˆå¹¶æ ¹å·¦å­æ ‘çš„å‰ä¸€å¯¹ä¸æ ¹å³å­æ ‘çš„åä¸€å¯¹æ¥å¾—åˆ°ç»“æœã€‚\nlink joinAB(link a, link b){ if(a == 0) return b; if(b == 0) return a; insertT(b, a -\u0026gt; item); b -\u0026gt; lchild = jionAB(a -\u0026gt; lchild, b -\u0026gt; lchild); b -\u0026gt; rchild = jionAB(a -\u0026gt; rchild, b -\u0026gt; rchild); delete a; return b; } 2-3-4æ ‘ 2-3-4æ ‘å¯ä»¥åœ¨O(logN)çš„æ—¶é—´å†…å®ŒæˆæŸ¥æ‰¾ã€æ’å…¥ã€å’Œåˆ é™¤æ“ä½œã€‚\n2-3-4æ ‘æ˜¯ä¸€æ£µç©ºæ ‘æˆ–è€…æ˜¯å…·æœ‰ä»¥ä¸‹ä¸‰ç±»èŠ‚ç‚¹çš„æ ‘ï¼š\n 2-èŠ‚ç‚¹ å®ƒå…·æœ‰ä¸€ä¸ªé”®ï¼Œä»¥åŠå…·æœ‰è¾ƒå°é”®çš„å·¦å­æ ‘å’Œå…·æœ‰è¾ƒå¤§é”®çš„å³å­æ ‘çš„ä¸¤ä¸ªé“¾æ¥ã€‚ 3-èŠ‚ç‚¹ å®ƒå…·æœ‰ä¸¤ä¸ªé”®ï¼Œä»¥åŠå…·æœ‰è¾ƒå°é”®çš„å·¦å­æ ‘ï¼Œè¾ƒå¤§é”®çš„å³å­æ ‘å’Œä»‹äºèŠ‚ç‚¹é”®ä¹‹é—´çš„ä¸­é—´å­æ ‘çš„ä¸‰ä¸ªé“¾æ¥ã€‚ 4-èŠ‚ç‚¹ å®ƒå…·æœ‰ä¸‰ä¸ªé”®ï¼Œä»¥åŠç”±èŠ‚ç‚¹é”®å¯¹åº”çš„åŒºé—´å®šä¹‰çš„é”®å€¼çš„æ ‘çš„å››ä¸ªé“¾æ¥ã€‚  èŠ‚ç‚¹çš„æ’å…¥å¤„ç†  å¦‚æœæœç´¢ç»“æŸçš„èŠ‚ç‚¹æ˜¯2-èŠ‚ç‚¹ï¼Œå°†å…¶å˜ä¸º3-èŠ‚ç‚¹ã€‚ å¦‚æœæœç´¢ç»“æŸçš„èŠ‚ç‚¹æ˜¯3-èŠ‚ç‚¹ï¼Œå°†å…¶å˜ä¸º4-èŠ‚ç‚¹ã€‚ å¦‚æœæœç´¢ç»“æŸçš„èŠ‚ç‚¹æ˜¯4-èŠ‚ç‚¹ï¼Œå°†å…¶åˆ†è£‚æˆä¸¤ä¸ª2-èŠ‚ç‚¹ï¼Œå¹¶å°†ä¸­é—´é”®ä¸Šç§»åˆ°èŠ‚ç‚¹çš„çˆ¶äº²ï¼ˆçˆ¶èŠ‚ç‚¹ä¸æ˜¯4-èŠ‚ç‚¹ï¼‰ã€‚ä½†å¦‚æœçˆ¶èŠ‚ç‚¹ä¹Ÿæ˜¯4-èŠ‚ç‚¹å‘¢ï¼Ÿæ›´å¥½çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼šåœ¨æ²¿æ ‘å‘ä¸‹çš„è¿‡ç¨‹ä¸­ï¼Œåˆ†è§£ä»»ä½•4-èŠ‚ç‚¹ï¼Œä¿è¯æœç´¢è·¯å¾„ä¸åœ¨4-èŠ‚ç‚¹ç»ˆæ­¢ã€‚å…·ä½“åšæ³•æ˜¯ï¼šæ¯å½“é‡åˆ°ä¸€ä¸ª2-èŠ‚ç‚¹ï¼ˆçˆ¶äº²ï¼‰è¿æ¥åˆ°4-èŠ‚ç‚¹ï¼ˆå­©å­ï¼‰ï¼Œå°±æŠŠå®ƒè½¬åŒ–ä¸ºä¸€ä¸ª3-èŠ‚ç‚¹è¿æ¥åˆ°è¿ä¸ª2èŠ‚ç‚¹ï¼›æ¯å½“é‡åˆ°ä¸€ä¸ª3-èŠ‚ç‚¹è¿æ¥åˆ°4-èŠ‚ç‚¹ï¼Œå°±æŠŠå®ƒè½¬æ¢ä¸ºä¸€ä¸ª4-èŠ‚ç‚¹è¿æ¥åˆ°ä¸¤ä¸ª2-èŠ‚ç‚¹ã€‚  çº¢é»‘æ ‘ 2-3-4æ ‘æ˜“äºç†è§£ï¼Œä½†å®ç°å›°éš¾ã€‚ çº¢é»‘æ ‘æ˜¯2-3-4æ ‘çš„ä¸€ç§ç®€å•æŠ½è±¡è¡¨è¾¾æ–¹å¼ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯å°†2-3-4æ ‘è¡¨ç¤ºä¸ºæ ‡å‡†çš„BST(ä»…æœ‰2-èŠ‚ç‚¹)ï¼Œä½†ä¸ºæ¯ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªé¢å¤–çš„ä¿¡æ¯ä½ï¼Œæ¥ä¸º3-èŠ‚ç‚¹å’Œ4-èŠ‚ç‚¹ç¼–ç ã€‚\né“¾æ¥æœ‰ä¸¤ç§ä¸åŒçš„ç±»å‹ï¼š\n çº¢é“¾æ¥ çº¢é“¾æ¥å°†åŒ…å«3-èŠ‚ç‚¹å’Œ4-èŠ‚ç‚¹çš„å°äºŒå‰æ ‘æ†ç»‘åœ¨ä¸€èµ·ã€‚ é»‘é“¾æ¥ é»‘é“¾æ¥å°†2-3-4æ ‘æ†ç»‘åœ¨ä¸€èµ·ã€‚  çº¢é»‘æ ‘æœ‰ä¸¤ä¸ªæœ¬è´¨ç‰¹æ€§ï¼š\n ä¸ç”¨ä¿®æ”¹BSTçš„æ ‡å‡†æœç´¢è¿‡ç¨‹å°±èƒ½å·¥ä½œã€‚ å®ƒä»¬ä¸2-3-4æ ‘ç›´æ¥å¯¹åº”ã€‚å› æ­¤å¯ä»¥ç”¨ä¸Š2-3-4æ ‘çš„ç®€å•æ’å…¥å¹³è¡¡è¿‡ç¨‹ã€‚  å¦‚æœæŸä¸ªèŠ‚ç‚¹æœ‰2ä¸ªçº¢å­©å­ï¼Œåˆ™å®ƒæ˜¯4-èŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†ã€‚çº¢é»‘æ ‘çš„æ’å…¥å¼€é”€å¾ˆå°ï¼šä»…å½“çœ‹åˆ°4-èŠ‚ç‚¹çš„æ—¶å€™æ‰é‡‡å–å¹³è¡¡æªæ–½ã€‚åˆ†è§£ä¸åŒ4-èŠ‚ç‚¹çš„å…·ä½“åšæ³•å¯ä»¥å¯¹ç…§ä¸‹å›¾æ¥è¯´ï¼š  å·¦ä¸€ï¼š4-èŠ‚ç‚¹çš„çˆ¶äº²æ˜¯ä¸€ä¸ª2-èŠ‚ç‚¹ã€‚ å°†ä¸­é—´é”®ä¸Šç§»è½¬æ¢ä¸ºä¸€ä¸ª3-èŠ‚ç‚¹ä¸ä¸¤ä¸ª2-èŠ‚ç‚¹çš„è¿æ¥ï¼ˆå˜è‰²ï¼‰ã€‚ å·¦äºŒï¼š4-èŠ‚ç‚¹çš„çˆ¶äº²æ˜¯ä¸€ä¸ª3-èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ˜¯å®ƒçš„å³å­©å­ã€‚ å˜è‰²ã€‚ å·¦ä¸‰ï¼š4-èŠ‚ç‚¹çš„çˆ¶äº²æ˜¯ä¸€ä¸ª3-èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ˜¯å®ƒçš„å·¦å­©å­ã€‚ å…ˆå˜è‰²å¾—åˆ°ä¸¤ä¸ªæ–¹å‘ç›¸åŒçš„çº¢é“¾æ¥ï¼Œç„¶åå³æ—‹ã€‚ å·¦å››ï¼š4-èŠ‚ç‚¹çš„çˆ¶äº²æ˜¯ä¸€ä¸ª3-èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ˜¯å®ƒçš„ä¸­é—´å­©å­ã€‚ å…ˆå˜è‰²å¾—åˆ°ä¸¤ä¸ªæ–¹å‘ä¸åŒçš„çº¢é“¾æ¥ï¼Œç„¶åå³æ—‹å¾—åˆ°ä¸¤ä¸ªæ–¹å‘ç›¸åŒçš„çº¢é“¾æ¥ï¼Œç„¶åå†å·¦æ—‹ã€‚  ç”¨çº¢é»‘æ ‘è¡¨ç¤ºæ³•å®ç°2-3-4æ ‘çš„æ’å…¥æ“ä½œï¼Œé¦–å…ˆè¦ç»™ä¿®æ”¹èŠ‚ç‚¹å®šä¹‰ï¼ŒåŠ å…¥é¢œè‰²ä½ï¼ˆç”¨ 1 è¡¨ç¤ºçº¢èŠ‚ç‚¹ï¼Œ 0 è¡¨ç¤ºé»‘èŠ‚ç‚¹ï¼‰ã€‚åœ¨æ²¿æ ‘å‘ä¸‹çš„è·¯å¾„ä¸­ï¼ˆé€’å½’è°ƒç”¨ä¹‹å‰ï¼‰ï¼Œæ£€æŸ¥4-èŠ‚ç‚¹ï¼Œå¹¶é€šè¿‡åˆ‡æ¢æ‰€æœ‰3-èŠ‚ç‚¹çš„é¢œè‰²ä½æ¥åˆ†è£‚å®ƒä»¬ã€‚å½“åˆ°è¾¾åº•éƒ¨æ—¶ï¼Œä¸ºè¢«æ’å…¥çš„é¡¹æ–°å»ºä¸€ä¸ªçº¢èŠ‚ç‚¹å¹¶è¿”å›å®ƒçš„æŒ‡é’ˆã€‚åœ¨æ²¿å‘ä¸Šçš„è·¯å¾„ä¸­ï¼ˆé€’å½’è°ƒç”¨ä¹‹åï¼‰ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰§è¡Œä¸€æ¬¡æ—‹è½¬æ“ä½œï¼šå¦‚æœè·¯å¾„ä¸Šæœ‰ä¸¤ä¸ªç›¸åŒæ–¹å‘çš„çº¢é“¾æ¥ï¼Œåˆ™ä»ä¸Šæ–¹èŠ‚ç‚¹è¿›è¡Œä¸€æ¬¡æ—‹è½¬ï¼Œç„¶ååˆ‡æ¢é¢œè‰²ä½ï¼Œä»¥å½¢æˆä¸€ä¸ªæ­£ç¡®çš„4-èŠ‚ç‚¹ï¼›å¦‚æœè·¯å¾„ä¸Šæœ‰ä¸¤ä¸ªæ–¹å‘ä¸åŒçš„çº¢é“¾æ¥ï¼Œåˆ™ä»ä¸‹æ–¹çš„èŠ‚ç‚¹æ‰§è¡Œä¸€æ¬¡æ—‹è½¬ï¼Œä»¥ç®€åŒ–ä¸ºå¦ä¸€ç§æƒ…å†µï¼Œç•™ä½œå‘ä¸Šçš„ä¸‹ä¸€æ­¥å¤„ç†ã€‚\nint getColor(link x){if(x == 0) return 0; return x -\u0026gt; color;} void insertRB(link \u0026amp;h, Item x, int sw){ if(h == 0){h = new Node(x); return;} if(getColor(h -\u0026gt; lchild) \u0026amp;\u0026amp; getColor(h -\u0026gt; rchild)){ // å˜è‰², åˆ†è£‚4-èŠ‚ç‚¹ä¸º3-èŠ‚ç‚¹  h -\u0026gt; color = 1; h -\u0026gt; lchild -\u0026gt; color = 0; h -\u0026gt; rchild -\u0026gt; color = 0; } if(x.getKey() \u0026lt; h -\u0026gt; item.getKey()){ // å‘å·¦å­æ ‘æ’å…¥  insertRB(h -\u0026gt; lchild, x, 0); if(getColor(h) \u0026amp;\u0026amp; getColor(h -\u0026gt; lchild) \u0026amp;\u0026amp; sw) // ä¸¤ä¸ªæ–¹å‘ç›¸åŒçš„çº¢é“¾æ¥  rotateR(h); if(getColor(h -\u0026gt; lchild) \u0026amp;\u0026amp; getColor(h -\u0026gt; lchild -\u0026gt; lchild)){ rotateR(h); h -\u0026gt; color = 0; h -\u0026gt; rchild -\u0026gt; colot = 1; } } else{ // å‘å³å­æ ‘æ’å…¥  inserRB(h -\u0026gt; rchild, x, 1); if(getColor(h) \u0026amp;\u0026amp; getColor(h -\u0026gt; rchild) \u0026amp;\u0026amp; !sw) // å·¦æ—‹  rotateL(h); if(getColor(h -\u0026gt; rchild) \u0026amp;\u0026amp; getColor(h -\u0026gt; rchild -\u0026gt; rchild)){ rotateL(h); h -\u0026gt; color = 0; h -\u0026gt; lchild -\u0026gt; color = 1; } } } çº¢é»‘æ ‘çš„ç»“æ„æ€§å®šä¹‰ï¼š\nçº¢é»‘æ ‘æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½å¸¦æœ‰é¢œè‰²çš„BSTï¼Œé¢œè‰²ä¸ºçº¢è‰²æˆ–é»‘è‰²ã€‚é™¤äº†BSTçš„åŸºæœ¬è¦æ±‚å¤–ï¼Œå®ƒè¿˜å¿…é¡»æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š\n èŠ‚ç‚¹è¦ä¹ˆæ˜¯çº¢è‰²ï¼Œè¦ä¹ˆæ˜¯é»‘è‰² æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰² æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰² æ¯ä¸ªçº¢èŠ‚ç‚¹å¿…é¡»æœ‰ä¸¤ä¸ªé»‘è‰²çš„å­èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢é“¾æ¥ï¼‰ã€‚ ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­èŠ‚ç‚¹çš„æ‰€æœ‰ç®€å•è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘èŠ‚ç‚¹ã€‚  ","href":"/notebook/reading_notes/algorithms_in_c/binary-tree/","title":"æ ‘"},{"content":" å­¦ä¹ ã€ŠCç®—æ³•ã€‹ä¸­æ’åºè¿™ä¸€éƒ¨åˆ†æ—¶åšçš„ä¸€äº›ç¬”è®°ã€‚ä¸»è¦ä½¿ç”¨C++å®ç°äº†ä¹¦ä¸­çš„å¤§éƒ¨åˆ†æ’åºç®—æ³•ã€‚\n å¼€å§‹ä¹‹å‰ ä¸ºäº†æ–¹ä¾¿å¢åŠ ä»£ç çš„çµæ´»æ€§ï¼Œæˆ‘é‡‡å–äº†ä¹¦ä¸­ä½œè€…çš„éƒ¨åˆ†æ–¹æ³•ã€‚ä¸»è¦æ˜¯ç”¨ type ä»£æ›¿äº†å…·ä½“çš„æ•°æ®ç±»å‹ï¼Œä»¥åŠå®šä¹‰äº†ä¸¤ä¸ªç”¨äºæ¯”è¾ƒçš„å®ã€‚é€šè¿‡æ”¹å˜ä¸‹é¢å†…å®¹ï¼Œ å¯ä»¥å¾ˆå®¹æ˜“çš„è¿›è¡Œå…¶å®ƒæ•°æ®ç±»å‹çš„æ’åºã€‚\ntypedef int type; #define less(A, B) (A \u0026lt; B) #define equal(A, B) (A == B) ä¸‹é¢çš„ exchange() å‡½æ•°ç”¨æ¥äº¤æ¢ä¸¤ä¸ªå…ƒç´ ï¼š\nvoid exchange(type \u0026amp;a, type \u0026amp;b){type t = a; a = b; b = t;} è¿˜æœ‰ç”¨æ¥æµ‹è¯•ç®—æ³•æ­£ç¡®æ€§çš„é©±åŠ¨å‡½æ•°ï¼Œå®ƒé€šè¿‡è¯»å–ç”¨æˆ·è¾“å…¥çš„æ•°å­— n , äº§ç”Ÿ n ä¸ª10000ä»¥å†…çš„éšæœºæ•°ä½œä¸ºæµ‹è¯•æ•°æ®ã€‚ç„¶åè°ƒç”¨ç›¸åº”çš„æ’åºç®—æ³•å¹¶è¾“å‡ºæ’åºç»“æœã€‚\nint main(){ int n; scanf(\u0026#34;%d\u0026#34;, \u0026amp;n); type *a = new type[n]; for(int i = 0;i \u0026lt; n;i++) a[i] = 10000 * (1.0 * rand() / RAND_MAX); //selectSort(a, 0, n - 1);  //insertSort1(a, 0, n - 1);  //insertSort2(a, 0, n - 1);  //bubbleSort(a, 0, n - 1);  //shakerSort(a, 0, n - 1);  //shellSort(a, 0, n - 1);  //countSort(a, 0, n - 1);  //quickSort(a, 0, n - 1);  //tri_quickSort(a, 0, n - 1);  //mergeSort(a, 0, n - 1);  //mergeTD(a, 0, n - 1);  //oddEvenSort(a, 0, n - 1);  //heapSort(a, 0, n - 1);  //radixSort(a, 0, n - 1);  for(int i = 0;i \u0026lt; n;i++) printf(\u0026#34;%-6d\u0026#34;, a[i]); printf(\u0026#34;\\n\u0026#34;); delete []a; system(\u0026#34;pause\u0026#34;); return 0; } é€‰æ‹©æ’åº æ­¥éª¤  é¦–å…ˆï¼Œæ‰¾å‡ºæ•°ç»„ä¸­æœ€å°çš„å…ƒç´ å¹¶ç”¨é¦–ä½ç½®çš„å…ƒç´ å’Œå®ƒäº¤æ¢ ç„¶åï¼Œ æ‰¾å‡ºæ•°ç»„ä¸­æ¬¡å°çš„å…ƒç´ å¹¶ç”¨ç¬¬äºŒä¸ªä½ç½®çš„å…ƒç´ å’Œå®ƒäº¤æ¢ é‡å¤æ­¤æ­¥éª¤ï¼Œç›´åˆ°æ•´ä¸ªæ•°ç»„æ’åºå®Œæˆã€‚  å…·ä½“å®ç° å¯¹äºä» left åˆ° right - 1 çš„æ¯ä¸ª i ,ç”¨ a[i], a[i + 1], \u0026hellip;, a[right] ä¸­çš„æœ€å°å…ƒç´ è¿›è¡Œäº¤æ¢ã€‚å½“ç´¢å¼• i ä»å·¦å‘å³éå†æ—¶ï¼Œå…¶å·¦è¾¹çš„å…ƒç´ æ‰€å¤„çš„ä½ç½®å°±æ˜¯å…¶åœ¨æ•°ç»„ä¸­çš„æœ€ç»ˆä½ç½®ã€‚ æ‰€ä»¥ï¼Œå½“ i åˆ°è¾¾æœ€å³ç«¯æ—¶ï¼Œæ•´ä¸ªæ•°ç»„æ’åºå®Œæˆã€‚\nvoid selectSort(type a[], int left, int right){ for(int i = left;i \u0026lt; right;i++){ int minp = i; // å‡å®šæœªæ’åºåºåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªä¸ºæœ€å°å€¼  for(int j = i + 1;j \u0026lt;= right;j++) if(less(a[j], a[minp])) minp = j; exchange(a[i], a[minp]); } } æ’å…¥æ’åº æ­¥éª¤ å¯¹äºæœªæ’åºçš„åºåˆ—ï¼Œæ¯æ¬¡å–å…¶ä¸­çš„ä¸€ä¸ªæ•°ã€‚ç„¶ååœ¨å·²æ’åºçš„åºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œ æ‰¾åˆ°åˆé€‚çš„ä½ç½®å¹¶æ’å…¥ã€‚\nè¯´æ˜ å’Œé€‰æ‹©æ’åºä¸€æ ·ï¼Œåœ¨æ’åºè¿‡ç¨‹ä¸­ï¼Œå½“å‰ç´¢å¼•å·¦è¾¹çš„å…ƒç´ å·²ç»æœ‰åºï¼Œä½†è¿™å¹¶ä¸æ˜¯ä»–ä»¬çš„æœ€ç»ˆä½ç½®ï¼Œå¦‚æœç¢°åˆ°äº†æ¯”å®ƒä»¬æ›´å°çš„å…ƒç´ ï¼Œå®ƒä»¬è¿˜å¿…é¡»åç§»ï¼Œä¸ºè¾ƒå°çš„å…ƒç´ è…¾å‡ºä½ç½®ã€‚\nvoid insertSort1(type a[], int left, int right){ for(int i = left + 1;i \u0026lt;= right;i++) for(int j = i;j \u0026gt; left;j--) if(less(a[j], a[j - 1])) exchange(a[j], a[j - 1]); } æ”¹è¿›  ä¸é€‰æ‹©æ’åºä¸åŒçš„æ—¶ï¼Œæ’å…¥æ’åºçš„è¿è¡Œæ—¶é—´ä¸»è¦å–å†³äºè¾“å…¥ä¸­é”®çš„åˆå§‹é¡ºåºã€‚ å½“æˆ‘ä»¬ç¢°åˆ°çš„é”®ä¸å¤§äºæ­£è¢«æ’å…¥çš„é”®æ—¶ï¼Œå°±å¯ä»¥åœæ­¢ less() å’Œ exchange() è¿ç®—ï¼Œå› ä¸ºå·¦è¾¹çš„åºåˆ—æ—¶å·²ç»æ’åºå¥½çš„äº†ã€‚ç‰¹åˆ«åœ°ï¼Œå½“ less(a[j - 1], a[j]) ä¸ºçœŸæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è·³å‡ºå†…å±‚å¾ªç¯ã€‚ ä¸éš¾å‘ç°ï¼Œj \u0026gt; left çš„æµ‹è¯•é€šå¸¸æ˜¯å¤šä½™çš„ï¼ˆåªæœ‰åœ¨æ’å…¥å…ƒç´ æ—¶å½“å‰çœ‹åˆ°çš„æœ€å°å…ƒç´ å¹¶ä¸”åˆ°è¾¾äº†æ•°ç»„çš„èµ·å§‹å¤„ï¼Œå®ƒæ‰ä¸ºçœŸï¼‰ã€‚ä¸€ç§æ”¹è¿›æ–¹æ³•æ˜¯ï¼šè®©é”®åœ¨ a[left] åˆ° a[N] ä¸­ä¿æŒæœ‰åºï¼Œå¹¶åœ¨ a[0] ä¸­æ”¾å…¥ä¸€ä¸ªæ ‡è®°é”®ï¼Œå®ƒè‡³å°‘ä¸æ•°ç»„ä¸­çš„æœ€å°é”®ç›¸åŒã€‚ç„¶åé€šè¿‡æµ‹è¯•æ˜¯å¦ç¢°åˆ°äº†æœ€å°é”®æ¥åŒæ—¶æµ‹è¯• less(a[j - 1], a[j]) å’Œ j \u0026gt; left è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œè®©å†…å¾ªç¯æ›´å°ï¼Œç¨‹åºæ›´å¿«ã€‚ å¯¹åŒä¸€ä¸ªå…ƒç´ çš„è¿ç»­äº¤æ¢æ•ˆç‡ä¸é«˜ï¼Œå¦‚æœè¿›è¡Œä¸¤æ¬¡æˆ–è€…æ›´å¤šçš„äº¤æ¢ï¼Œä¸­é—´å˜é‡ t çš„å€¼å¹¶æ²¡æœ‰æ”¹å˜ã€‚åœ¨ç¬¬äºŒæ¬¡æˆ–ä»¥åçš„äº¤æ¢ä¸­ï¼Œå…ˆä¿å­˜å†é‡æ–°è½½å…¥ t çš„å€¼å°±æ˜¯æµªè´¹æ—¶é—´ã€‚\n å…·ä½“åšæ³•  å°†æ•°ç»„ä¸­æœ€å°å€¼æ”¾åˆ°ç¬¬ä¸€ä¸ªä½ç½®ï¼Œä½œä¸ºæ ‡è®°ã€‚ åœ¨å†…å¾ªç¯ä¸­ï¼Œè¿›è¡Œå•ä¸ªèµ‹å€¼ï¼Œè€Œä¸æ˜¯è¿ç»­äº¤æ¢ã€‚ å½“æ­£è¢«æ’å…¥çš„å…ƒç´ å·²ç»å°±ä½æ—¶ï¼Œç»ˆæ­¢å†…å¾ªç¯ã€‚å¯¹äºæ¯ä¸ª i ï¼ŒæŠŠå¤§äº a[i] çš„æ’åºè¡¨ a[left], ..., a[i - 1] çš„æ‰€æœ‰å…ƒç´ æ•´ä½“å‘å³ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œå†æŠŠ a[i] æ”¾å…¥é€‚å½“çš„ä½ç½®ã€‚è¿™æ ·å°±å®Œæˆäº†æ•´ä¸ªæ’åºçš„è¿‡ç¨‹ã€‚  void insertSort2(type a[], int left, int right){ for(int i = left + 1, minp = left;i \u0026lt;= right;i++){ if(less(a[i], a[left])) minp = i; exchange(a[minp], a[left]); } for(int i = left + 2;i \u0026lt;= right;i++){ int j = i; type v = a[i]; // å…ˆä¿å­˜a[i]ï¼Œç¡®ä¿å®ƒä¸ä¼šè¢«å³ç§»çš„å…ƒç´ è¦†ç›–  //æŠŠå¤§äºa[i]çš„æ‰€æœ‰å…ƒç´ æ•´ä½“å‘å³ç§»åŠ¨ä¸€ä¸ªä½ç½®  for(;less(v, a[j - 1]);j--) a[j] = a[j - 1]; a[j] = v; // æ”¾å…¥a[i]åˆ°é€‚å½“çš„ä½ç½®  } } å†’æ³¡æ’åº æ­¥éª¤  ä»å·¦åˆ°å³æ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢å®ƒä»¬ å¯¹æ¯ä¸€å¯¹å…ƒç´ é‡å¤ç¬¬1æ­¥ï¼Œç»“æŸæ—¶ï¼Œæœ€å¤§çš„å…ƒç´ åœ¨æ’åºåºåˆ—çš„æœ€å³ç«¯ã€‚ å¯¹é™¤æœ€åä¸€ä¸ªä»¥å¤–çš„æ‰€æœ‰å…ƒç´ é‡å¤ä»¥ä¸Šæ­¥éª¤ã€‚ é‡å¤ç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒã€‚  ä»£ç å¦‚ä¸‹ï¼š\nvoid bubbleSort(type a[], int left, int right){ for(int i = left;i \u0026lt;= right;i++){ for(int j = left;j \u0026lt;= right - i - 1;j++) if(less(a[j + 1], a[j])) exchange(a[j + 1], a[j]); } } æ‘‡æ‘†æ’åº å†’æ³¡æ’åºæ”¹è‰¯ç‰ˆã€‚å°†å•å‘æ‰«ææ•°ç»„æ”¹æˆä»å¤´åˆ°å°¾ï¼Œå†ä»å°¾åˆ°å¤´çš„äº¤æ›¿æ–¹å¼\nvoid shakerSort(type a[], int left, int right){ for(int i = left;i \u0026lt;= right;i++){ for(int j = left;j \u0026lt;= right - i - 1;j++) if(less(a[j + 1], a[j])) exchange(a[j + 1], a[j]); for(int j = right - i - 1;j \u0026gt; i;j--) if(less(a[j], a[j - 1])) exchange(a[j], a[j - 1]); } } å¸Œå°”æ’åº å¸Œå°”æ’åºåˆå«ç¼©å°å¢é‡æ’åºï¼Œå®ƒæ˜¯æ’å…¥æ’åºæ‰©å±•ã€‚\n æ’å…¥æ’åºæ…¢ï¼Œ å› ä¸ºå®ƒä¸€æ¬¡åªäº¤æ¢ç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ ï¼ˆæ­¥é•¿ä¸º1ï¼‰ã€‚å¦‚æœæœ€å°é”®ä½äºæ•°ç»„å°¾éƒ¨ï¼Œåˆ™å°†å®ƒç§»åŠ¨åˆ°æ­£ç¡®ä½ç½®éœ€è¦Næ­¥ã€‚ ä¸ºäº†è®©å…ƒç´ èƒ½å¤Ÿèƒ½å¿«çš„åˆ°è¾¾æ­£ç¡®çš„ä½ç½®ï¼Œæ”¹å˜æ­¥é•¿ã€‚æ¯éš”hå–ä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥å¾—åˆ°ä¸€äº›h-æœ‰åºåºåˆ—ã€‚ç„¶åæ”¹å˜æ­¥é•¿ç»§ç»­æ“ä½œï¼Œæœ€ç»ˆå½“æ­¥é•¿ä¸º1çš„æ—¶å€™ï¼Œå¸Œå°”æ’åºå˜æˆæ’å…¥æ’åºï¼Œè¿™å°±ä¿è¯äº†æ’åºèƒ½å¤Ÿå®Œæˆã€‚\n å¦‚æœä¸ä½¿ç”¨æ ‡è®°ï¼Œåˆ™åœ¨æ’å…¥æ’åºä¸­ï¼Œå°†æ­¥é•¿ç”±â€œ1â€æ¢æˆâ€œhâ€(ä¹Ÿå°±æ˜¯å°†æ¯ä¸ªâ€œ1â€æ¢æˆâ€œhâ€)ï¼Œå¾—åˆ°çš„ç¨‹åºå¯¹åºåˆ—è¿›è¡Œh-æ’åºã€‚å¢åŠ ä¸€ä¸ªå¤–å¾ªç¯æ¥æ”¹å˜å¢é‡hï¼Œå°±å¯ä»¥å¾—åˆ°æœ€ç»ˆç¨‹åºã€‚ç¨‹åºä¸­é€‰å–çš„å¢é‡åºåˆ—ä¸ºï¼š1ï¼Œ4ï¼Œ13ï¼Œ40ï¼Œ121ï¼Œ364ï¼Œ1093ï¼Œ3280ï¼Œ9841â€¦â€¦\nvoid shellSort(type a[], int left, int right){ int h, i, j; for(h = 1;h \u0026lt; (right - left) / 3;h = h * 3 + 1); for(;h \u0026gt; 0;h /= 3){ // è°ƒæ•´å¢é‡  for(i = left + h;i \u0026lt;= right;i += h){ j = i; type v = a[i]; // ä¿å­˜a[i]  for(;j \u0026gt;= left + h \u0026amp;\u0026amp; less(v, a[j - h]);j -= h) a[j] = a[j - h]; // å‘åç§»åŠ¨hä¸ªå…ƒç´   a[j] = v; // æŠŠa[i]æ”¾åˆ°æ­£ç¡®ä½ç½®  } } } é”®ç´¢å¼•è®¡æ•°æ’åº é”®ç´¢å¼•æ’åºæŠŠé”®å½“ä½œç´¢å¼•è¿›è¡Œæ’åºï¼Œè€Œä¸æ˜¯æŠŠé”®å½“ä½œè¢«æ¯”è¾ƒçš„æŠ½è±¡é¡¹ã€‚æ¯”å¦‚ï¼šæ’åºä¸€ä¸ªåŒ…å«Nä¸ªé¡¹çš„æ–‡ä»¶ï¼Œé¡¹çš„é”®ä¸º0~M-1ä¹‹é—´çš„æ•´æ•°ã€‚æˆ‘ä»¬å¯ä»¥ç”¨æ¯ä¸ªå€¼æ¥å¯¹é”®çš„ä¸ªæ•°è¿›è¡Œè®¡æ•°ï¼Œç„¶ååœ¨ç¬¬äºŒéæ‰«æä¸­ä½¿ç”¨è®¡ç®—å‡ºæ¥çš„æ•°å°†é¡¹ç§»åˆ°æ­£ç¡®çš„ä½ç½®ã€‚é€šä¿—çš„è®²ï¼šåŠ å…¥ä½ ä»¬ç­æœ‰30ä¸ªäººï¼Œç»Ÿè®¡å‡ºæ¥æœ‰5ä¸ªäººçš„ç»©ç‚¹æ¯”ä½ é«˜ï¼Œé‚£ä¹ˆä½ çš„ç»©ç‚¹å°±æ’åœ¨ç¬¬6ä½ã€‚ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥å¾—åˆ°å…¶å®ƒäººçš„æ’åï¼Œä¹Ÿå°±æ’å¥½äº†åºã€‚å¯¹äºé‡å¤å€¼ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ã€‚ ä¸è¿‡é”®ç´¢å¼•åŸºæ•°æ’åºå±€é™äºå¾…æ’åºæ•°æ®çš„èŒƒå›´ã€‚\næ­¥éª¤  é¦–å…ˆï¼Œè®¡æ•°æ¯ä¸ªå€¼çš„é”®çš„æ•°é‡ ç„¶åï¼Œå°è®¡å°äºæˆ–ç­‰äºæ¯ä¸ªå€¼çš„é”®æ•°ã€‚ æ¥ç€ï¼Œä½¿ç”¨è¿™äº›è®¡æ•°ä½œä¸ºç´¢å¼•åˆ†æ‹£é”®ï¼Œæ¯”å¦‚ cnt[i] è¡¨ç¤ºå°äº i çš„ä¸ªæ•°ï¼Œé‚£ä¸ª a[i] ä½äº aux[ant[i]] å†™å›åŸæ•°ç»„  ä»£ç å¦‚ä¸‹ï¼š\nvoid countSort(type a[], int left, int right){ int i, j, M = 10000; // é”®å¿…é¡»æ˜¯å°äºMçš„æ•´æ•°  int N = right - left + 1, cnt[M]; type *aux = new type[N]; for(j = 0;j \u0026lt; M;j++) cnt[j] = 0; // å°†è®¡æ•°åˆå§‹åŒ–ä¸º0  for(i = left;i \u0026lt;= right;i++) cnt[a[i] + 1]++; //ç»Ÿè®¡å°äºa[i]çš„å€¼çš„å‡ºç°é¢‘ç‡  for(j = left;j \u0026lt; M;j++) cnt[j + 1] += cnt[j]; // å¾—åˆ°å°äºç­‰äºè®¡æ•°å™¨å¯¹åº”è®¡æ•°å€¼é”®çš„æ•°é‡,å°†é¢‘ç‡è½¬æ¢ä¸ºç´¢å¼•  for(i = left;i \u0026lt;= right;i++) aux[cnt[a[i]]++] = a[i]; // å°†é”®åˆ†å¸ƒåˆ°è¾…åŠ©æ•°ç»„ä¸­  for(i = left;i \u0026lt;= right;i++) a[i] = aux[i]; // å›å†™  delete []aux; } å¿«é€Ÿæ’åº å¿«é€Ÿæ’åºæ˜¯ä¸€ç§åˆ†æ²»æ–¹æ³•ã€‚å®ƒçš„å·¥ä½œæ–¹å¼æ˜¯ï¼šå°†å¾…æ’åºçš„åºåˆ—åˆ’åˆ†ä¸ºä¸¤ç»„ï¼Œç„¶åç‹¬ç«‹æ’åºå„ä¸ªéƒ¨åˆ†åˆ’åˆ†çš„å‡†ç¡®ä½ç½®å–å†³äºè¾“å…¥ä¸­å…ƒç´ çš„åˆå§‹é¡ºåºã€‚ æ–¹æ³•çš„å…³é”®åœ¨äºåˆ’åˆ†è¿‡ç¨‹ï¼Œå®ƒå°†æ•°ç»„é‡æ’ï¼Œä½¿ä¸‹é¢3ä¸ªæ¡ä»¶æˆç«‹ï¼š\n å¯¹äºæŸä¸€ä¸ª i å€¼ï¼Œå…ƒç´  a[i] å¤„äºæ•°ç»„ä¸­çš„æœ€ç»ˆä½ç½®; a[i] å·¦è¾¹çš„å…ƒç´ éƒ½ä¸å¤§äº a[i] ; a[i] å³è¾¹çš„å…ƒç´ éƒ½ä¸å°äº a[i] ;  åˆ’åˆ†æ–¹æ³•  é¦–å…ˆï¼Œä»»æ„é€‰å®š a[right] ä½œä¸ºåˆ’åˆ†å…ƒç´ ï¼ˆå®ƒå°†å¤„äºåœ¨æ•°ç»„ä¸­çš„æœ€ç»ˆä½ç½®ï¼‰ã€‚ ä»å·¦å‘å³æ‰«æï¼Œç›´åˆ°å‘ç°ä¸€ä¸ªå¤§äºåˆ’åˆ†å…ƒç´ çš„å…ƒç´ ï¼›åŒæ—¶ä»å³å‘å·¦æ‰«æï¼Œç›´åˆ°å‘ç°ä¸€ä¸ªå°äºåˆ’åˆ†å…ƒç´ çš„å…ƒç´ ï¼Œç„¶åäº¤æ¢è¿™ä¸¤ä¸ªå…ƒç´ ã€‚ æŒ‰è¿™ç§æ–¹å¼ç»§ç»­åˆ’åˆ†ã€‚ç¡®ä¿å·¦æŒ‡é’ˆå·¦è¾¹çš„å…ƒç´ éƒ½å°äºåˆ’åˆ†å…ƒç´ ï¼Œå³æŒ‡é’ˆå³è¾¹çš„å…ƒç´ éƒ½å¤§äºåˆ’åˆ†å…ƒç´ ã€‚ å½“å·¦å³æŒ‡é’ˆç›¸é‡æˆ–è€…ç›¸äº’ç»è¿‡æ—¶ï¼Œäº¤æ¢ a[right] å’Œå³åŠéƒ¨åˆ†æœ€å·¦è¾¹çš„å…ƒç´ ï¼ˆç”±å·¦æŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ ï¼‰ï¼Œåˆ’åˆ†ç»“æŸã€‚  int partition(type a[], int left, int right){ int i = left - 1, j = right; type v = a[right]; // a[right]ä¸ºåˆ’åˆ†å…ƒç´   for(;;){ for(;less(a[++i], v);); for(;less(v, a[--j]);) if(j == left) break; // é¿å…åˆ’åˆ†å…ƒç´ ä¸ºåºåˆ—ä¸­çš„æœ€å°å…ƒç´ çš„æƒ…å†µå‘ç”Ÿ  if(j \u0026lt;= i) break; exchange(a[i], a[j]); } exchange(a[i], a[right]); //äº¤æ¢a[right]å’Œa[i]  return i; } å¦‚æœæ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä¸éœ€è¦è¿›è¡Œä»»ä½•è¿ç®—ã€‚å¦åˆ™ï¼Œè°ƒç”¨ partition() å‡½æ•°å¤„ç†è¿™ä¸ªæ•°ç»„ï¼Œå®ƒå°† a[i] æ”¾åˆ°æœ€ç»ˆä½ç½® (left \u0026lt; i \u0026lt;= right) å¹¶ä¸”é‡æ’å…¶å®ƒå…ƒç´ ï¼Œè®©é€’å½’è°ƒç”¨èƒ½å¤Ÿæ­£ç¡®å®Œæˆæ•´ä¸ªæ’åºè¿‡ç¨‹ã€‚\nvoid quickSort(type a[], int left, int right){ if(right \u0026lt;= left) return; int i = partition(a, left, right); quickSort(a, left, i - 1); quickSort(a, i + 1, right); } æ”¹è¿›ï¼ˆä¸‰å…ƒç´ ä¸­å€¼åˆ’åˆ†ï¼‰ ä¸‰å…ƒç´ ä¸­å€¼åˆ’åˆ†ä½¿ç”¨ä¸€ä¸ªæ›´æœ‰å¯èƒ½åœ¨ä¸­é—´ä½ç½®å‡ºç°çš„å…ƒç´ ä½œä¸ºåˆ’åˆ†å…ƒç´ ã€‚å®ƒä»åºåˆ—ä¸­é€‰å‡ºä¸‰ä¸ªå…ƒç´ çš„æ ·æœ¬ï¼Œç„¶åç”¨è¿™ä¸‰ä¸ªå…ƒç´ çš„ä¸­å€¼ä½œä¸ºåˆ’åˆ†å…ƒç´ ã€‚åˆ†åˆ«ä»æ•°ç»„ä¸­çš„å·¦ã€ä¸­ã€å³é€‰å–ä¸€ä¸ªå…ƒç´ ã€‚æ¥ç€æ’åºè¿™ä¸‰ä¸ªå…ƒç´ ï¼Œç„¶åç”¨ a[right - left] äº¤æ¢ä¸­é—´é‚£ä¸€ä¸ªï¼Œå†å¯¹ a[left + 1],...,a[right - 2] è¿è¡Œåˆ’åˆ†ç®—æ³•ã€‚\nåº”å¯¹å¤§é‡é‡å¤é”®çš„æƒ…å†µ\u0026mdash;ä¸‰è·¯åˆ’åˆ†  å½“æ’åºåºåˆ—ä¸­çš„é‡å¤é”®è¾ƒå¤šçš„æ—¶å€™ï¼Œå¿«é€Ÿæ’åºçš„ä½ä¸‹æ€§èƒ½è®©äººéš¾ä»¥æ¥å—ã€‚ å¯ä»¥æŠŠåºåˆ—åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ï¼šå°äºåˆ’åˆ†å…ƒç´ çš„éƒ¨åˆ†ã€ç­‰äºåˆ’åˆ†å…ƒç´ çš„éƒ¨åˆ†ã€å¤§äºåˆ’åˆ†å…ƒç´ çš„éƒ¨åˆ†ã€‚ ä¿®æ”¹æ ‡å‡†åˆ’åˆ†æ–¹æ¡ˆå¦‚ä¸‹ï¼šå°†åœ¨å·¦è¾¹éƒ¨åˆ†ç¢°åˆ°çš„å’Œåˆ’åˆ†å…ƒç´ ç›¸ç­‰çš„é”®æ”¾åˆ°åºåˆ—çš„å·¦ç«¯ï¼Œå°†å³è¾¹éƒ¨åˆ†ç¢°åˆ°çš„å’Œåˆ’åˆ†å…ƒç´ ç›¸ç­‰çš„é”®æ”¾åˆ°åºåˆ—å³ç«¯ã€‚ ç„¶åï¼Œå½“æŒ‡é’ˆäº¤å‰è€Œä¸”ç›¸ç­‰é”®çš„ä½ç½®å·²çŸ¥çš„æ—¶å€™ï¼Œå°†æ‰€æœ‰ä¸åˆ’åˆ†å…ƒç´ ç›¸ç­‰çš„é”®äº¤æ¢åˆ°ä½  ä¸€ç‚¹è¯´æ˜ ç¨‹åºå°†æ•°ç»„åˆ’åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šå°äºåˆ’åˆ†å…ƒç´ çš„éƒ¨åˆ†ï¼ˆ a[left],..., a[j] ï¼‰, ç­‰äºåˆ’åˆ†å…ƒç´ çš„éƒ¨åˆ†ï¼ˆ a[j + 1],..., a[i - 1] ï¼‰,å¤§äºåˆ’åˆ†å…ƒç´ çš„éƒ¨åˆ†( a[i],...,a[right] )ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š\nvoid tri_quickSort(type a[], int left, int right){ if(right \u0026lt;= left) return; type v = a[right]; // åˆ’åˆ†å…ƒç´   int i = left, j = right - 1, p = left, q = right - 1; for(;;){ for(;less(a[i], v);i++); for(;less(v, a[j]);j--) if(j == left) break; // é¿å…åˆ’åˆ†å…ƒç´ ä¸ºåºåˆ—ä¸­çš„æœ€å°å…ƒç´ çš„æƒ…å†µå‘ç”Ÿ  if(j \u0026lt;= i) break; exchange(a[i], a[j]); if(equal(a[i], v)){p++;exchange(a[i], a[p]);} if(equal(a[j], v)){q--;exchange(a[j], a[q]);} } exchange(a[i], a[right]); i--;j++; int k; for(k = left;k \u0026lt; p;k++,i--) exchange(a[k], a[i]); for(k = right - 1;k \u0026gt; q;k--, j++) exchange(a[k], a[j]); tri_quickSort(a, left, i); tri_quickSort(a, j, right); } å¥‡å¶æ’åº æ­¥éª¤  é€‰å–æ‰€æœ‰ä¸ºå¥‡æ•°åˆ—ï¼ˆä¸‹æ ‡ä¸º1,3,5\u0026hellip;)çš„å…ƒç´ ä¸å…¶å³ä¾§å…ƒç´ æ¯”è¾ƒï¼Œå°†å°çš„æ”¾åœ¨å‰é¢ é€‰å–æ‰€æœ‰ä¸ºå¶æ•°åˆ—ï¼ˆä¸‹æ ‡ä¸º2,4,6\u0026hellip;)çš„å…ƒç´ ä¸å…¶å³ä¾§å…ƒç´ æ¯”è¾ƒï¼Œå°†å°çš„æ”¾åœ¨å‰é¢ é‡å¤1å’Œ2ç›´åˆ°æ‰€æœ‰åºåˆ—æœ‰åºä¸ºæ­¢ã€‚  å®ç° void oddEvenSort(type a[], int left, int right){ int i; bool oddSorted = false, evenSorted = false; while(!oddSorted || !evenSorted){ oddSorted = true; evenSorted = true; for(i = left;i \u0026lt; right;i += 2){ if(less(a[i + 1], a[i])){ exchange(a[i + 1], a[i]); evenSorted = false; } } for(i = left + 1; i \u0026lt; right;i += 2){ if(less(a[i + 1], a[i])){ exchange(a[i + 1], a[i]); oddSorted = false; } } } } å½’å¹¶æ’åº å½’å¹¶ æ•°ç»„ a çš„å‰åŠéƒ¨åˆ†ï¼ˆ a[left],...,a[m] ï¼‰æœ‰åºï¼ŒååŠéƒ¨åˆ†ï¼ˆ a[m + 1],...,a[right] ï¼‰æœ‰åºã€‚å½’å¹¶è¿™ä¸¤éƒ¨åˆ†ï¼Œä½¿æ•´ä¸ªæ•°ç»„æœ‰åºã€‚ä¸€èˆ¬éœ€è¦ä¸€ä¸ªè¾…åŠ©æ•°ç»„ aux ,å…ˆæŠŠç»“æœå­˜åˆ° aux ä¸­ï¼Œç„¶åæŠŠæ’åºç»“æœä» aux å†™å›åˆ° a ä¸­ã€‚ ä¸€ç§å¸¸ç”¨çš„å½’å¹¶æ–¹æ³•ï¼š\nvoid merge0(type a[], int left, int m, int right){ int len = right - left + 1; type *aux = new type[len]; int i = left, j = m + 1, k = 0; while(i \u0026lt;= m \u0026amp;\u0026amp; j \u0026lt;= right) aux[k++] = less(a[i], a[j]) ? a[i++] : a[j++]; while(i \u0026lt;= m) aux[k++] = a[i++]; while(j \u0026lt;= right) aux[k++] = a[j++]; for(i = left, k = 0;i \u0026lt;= right;i++, k++) a[i] = aux[k]; delete []aux; } å¦ä¸€ç§å½’å¹¶æ–¹æ³•ï¼š å°†å‰åŠéƒ¨åˆ†å¤åˆ¶åˆ° aux ä¸­ï¼Œç„¶åå°†ååŠéƒ¨åˆ†ï¼ˆ a[m + 1],...,a[right] ï¼‰é€†åºå¤åˆ¶åˆ° aux ä¸­,ä½¿ä¸¤ä¸ªéƒ¨åˆ†æœ€å¤§å…ƒç´ èƒŒé èƒŒä½äº aux ä¸­é—´ï¼Œå½¢æˆåŒè°ƒåºåˆ—ã€‚è¿™æ ·ï¼Œä¸¤ä¸ªéƒ¨åˆ†ä¸­çš„æœ€å¤§å…ƒç´ åˆ†åˆ«æˆä¸ºä¸€ä¸ªæ ‡è®°ã€‚\nvoid merge1(type a[], int left, int m, int right){ int len = right - left + 1; type *aux = new type[len]; int i, j , k = 0; for(i = left;i \u0026lt;= m;i++) aux[k++] = a[i]; // å¤åˆ¶å‰åŠéƒ¨åˆ†åˆ°aux  for(j = right;j \u0026gt;= m + 1;j--) aux[k++] = a[j]; // é€†åºå¤åˆ¶ååŠéƒ¨åˆ†åˆ°aux  i = 0;j = len - 1; for(k = left;k \u0026lt;= right;k++){ if(less(aux[i], aux[j])) a[k] = aux[i++]; // å½’å¹¶ï¼Œæœ€å¤§å…ƒç´ ä¸ºå„è‡ªçš„æ ‡è®°  else a[k] = aux[j--]; } delete []aux; } æ’åº å°†æ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š a[left],..., a[m] å’Œ a[m + 1], ..., a[right] ã€‚ç„¶åå¯¹è¿™ä¸¤ä¸ªæ•°ç»„è¿›è¡Œç‹¬ç«‹æ’åºï¼ˆé€šè¿‡é€’å½’è°ƒç”¨ï¼‰ï¼Œç„¶åå°†è¿™ä¸¤ä¸ªæœ‰åºåºåˆ—å½’å¹¶åˆ°æœ€ç»ˆçš„åºåˆ—ã€‚\nvoid mergeSort(type a[], int left, int right){ int m = (left + right) / 2; if(right \u0026lt;= left) return; mergeSort(a, left, m); mergeSort(a, m + 1, right); merge1(a, left, m, right); // å½’å¹¶ } å·´åˆ‡å¥‡å¶å½’å¹¶æ’åº é¦–å…ˆè¦è®²ä¸¤ä¸ªå‡½æ•°ï¼š å®Œå…¨æ··æ´—(shuffle):å°†æ•°ç»„ a[left],...,a[right] åˆ†ä¸ºä¸¤åŠï¼Œå‰ä¸€åŠè¿›å…¥ç»“æœä¸­çš„å¶æ•°ç¼–å·ä½ç½®ï¼Œåä¸€åŠè¿›å…¥ç»“æœä¸­çš„å¥‡æ•°ç¼–å·ä½ç½®ã€‚ é€†å®Œå…¨æ··æ´—(unshuffle):å¶æ•°ç¼–å·ä½ç½®çš„å…ƒç´ è¿›å…¥ç»“æœçš„å‰ä¸€åŠï¼Œå¥‡æ•°ç¼–å·ä½ç½®çš„å…ƒç´ è¿›å…¥ç»“æœçš„åä¸€åŠã€‚ è¿™ä¸¤ä¸ªå‡½æ•°ä»…å¯¹å¸¦æœ‰å¶æ•°ä¸ªå…ƒç´ çš„å­æ•°ç»„ä½¿ç”¨ã€‚\nvoid shuffle(type a[], int left, int right){ int i, j, m = (left + right) / 2, len = right - left + 1; type *aux = new type[len]; for(i = left, j = 0;i \u0026lt;= m;i++, j += 2){ aux[j] = a[i]; aux[j + 1] = a[m + 1 + i - left]; } for(i = left, j = 0;i \u0026lt;= right;i++, j++) a[i] = aux[j]; delete []aux; } void unshuffle(type a[], int left, int right){ int i, j, m = (left + right) / 2, len = right - left + 1; int ma = len / 2; type *aux = new type[len]; for(i = left, j = 0;i \u0026lt;= right;i += 2, j++){ aux[j] = a[i]; aux[ma + j] = a[i + 1]; } for(i = left, j = 0;i \u0026lt;= right;i++, j++) a[i] = aux[j]; delete []aux; } å·´åˆ‡çš„å¥‡å¶å½’å¹¶ç½‘ç»œ è¿™ä¸ªç½‘ç»œè¾“å…¥ä¸¤ä¸ªå·²æ’å¥½åºçš„åºåˆ—ï¼Œå¯¹è¿™ä¸¤ä¸ªåºåˆ—è¿›è¡Œå½’å¹¶æ’åºã€‚é¦–å…ˆå¯¹è¿™ä¸¤ä¸ªåºåˆ—è¿›è¡Œé€†æ··æ´—ï¼Œç„¶ååˆ†åˆ«å½’å¹¶å‰åéƒ¨åˆ†ï¼Œæ¥ç€å†æ··æ´—ï¼Œæœ€åè¿›è¡Œä¸€æ¬¡(1,2)ã€(3,4)\u0026hellip;è¿™äº›ç›¸é‚»å…ƒç´ çš„æ¯”è¾ƒäº¤æ¢å¾—åˆ°æ’åºç»“æœã€‚è¿™é‡Œçš„ä»£ç åªé€‚åˆå…ƒç´ ä¸ªæ•°ä¸º 2^n çš„åºåˆ—ã€‚\nvoid mergeTD(type a[], int left, int right){ int i, m = (left + right) / 2; quickSort(a, left, m); quickSort(a, m + 1, right); if(left + 1 == right) if(less(a[right], a[left])) exchange(a[left], a[right]); if(left + 2 \u0026gt; right) return; // ä¸å¤šäºä¸¤ä¸ªå…ƒç´   unshuffle(a, left, right); // é€†æ··æ´—  mergeTD(a, left, m); mergeTD(a, m + 1, right); shuffle(a, left, right); // æ··æ´—  for(i = left + 1;i \u0026lt; right;i += 2) //æ¯”è¾ƒäº¤æ¢  if(less(a[i + 1], a[i])) exchange(a[i], a[i + 1]); } å †æ’åº å † å¤§é¡¶å †â€”â€”å †ä¸­ä¸å­˜åœ¨å¤§äºæ ¹é”®çš„ç»“ç‚¹ã€‚ä¸ä¹‹å¯¹åº”çš„ç”±å°é¡¶å †ã€‚è¿™é‡Œä½¿ç”¨å¤§é¡¶å †ã€‚ å¦‚æœç”¨æ•°ç»„æ¥ä¿å­˜å †ï¼Œå¦‚æœä¸‹æ ‡ä» 0 å¼€å§‹ï¼Œå¾ˆå®¹æ˜“çŸ¥é“ä½ç½® i å¤„ç»“ç‚¹çš„çˆ¶äº²ä½äº (i - 1) / 2 , åä¹‹ä½ç½® i å¤„ç»“ç‚¹çš„å­©å­ä½äº (2i + 1) å’Œ**(2i + 2)** å¤„ã€‚ å †ä¸­çš„ç¬¬ i ä¸ªå…ƒç´ å¤§äºç­‰äºç¬¬ (2i + 1) ä¸ªå…ƒç´ å’Œ (2i + 2) ä¸ªå…ƒç´ ã€‚ æœ‰å…³å †çš„å¾ˆå¤šç®—æ³•éƒ½æ˜¯é¦–å…ˆå¯¹å †åšä¸€ä¸ªç®€å•çš„ä¿®æ”¹ï¼Œè¿™å¯èƒ½è¿åå †çš„æ¡ä»¶ï¼Œç„¶åéå†å †ï¼ŒåŒæ—¶ä¿®æ­£å †ï¼Œç¡®ä¿æ•´ä¸ªå †æ»¡è¶³å †çš„æ¡ä»¶ã€‚ ä¿®æ­£å †çš„æƒ…å†µæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯åœ¨å †åº•éƒ¨æ·»åŠ æ–°èŠ‚ç‚¹ï¼Œç„¶åéœ€è¦å‘ä¸Šéå†è°ƒæ•´å †ï¼›å¦ä¸€ç§æ˜¯ç”¨ä¸€ä¸ªæ–°èŠ‚ç‚¹æ›¿æ¢æ‰æ ¹èŠ‚ç‚¹ï¼Œç„¶åéœ€è¦å‘ä¸‹éå†è°ƒæ•´å †ã€‚ å¦‚æœæ˜¯ç”±äºèŠ‚ç‚¹çš„é”®å˜å¾—å¤§äºå®ƒçš„çˆ¶äº²è€Œè¿åäº†å †çš„æ€§è´¨ï¼Œåˆ™å¯ä»¥é€šè¿‡äº¤æ¢è¯¥èŠ‚ç‚¹å’Œå®ƒçš„çˆ¶äº²çš„ä½ç½®ã€‚äº¤æ¢åï¼ŒèŠ‚ç‚¹å¤§äºå®ƒçš„ä¸¤ä¸ªå­©å­ï¼ˆ ä¸€ä¸ªæ˜¯åŸæ¥çš„çˆ¶äº²ï¼Œä¸€ä¸ªæ˜¯åŸæ¥çˆ¶äº²çš„å¦ä¸€ä¸ªå­©å­ï¼‰ï¼Œä½†å®ƒä»æœ‰å¯èƒ½å¤§äºç°åœ¨çš„çˆ¶äº²ï¼Œå› æ­¤éœ€è¦ç»§ç»­è°ƒæ•´ï¼Œç›´åˆ°é‡åˆ°ä¸€ä¸ªçœŸæ­£æ¯”å®ƒå¤§çš„çˆ¶èŠ‚ç‚¹æˆ–è€…åˆ°è¾¾æ ¹çš„ä½ç½®æ‰ç»“æŸã€‚ å¦‚æœæ˜¯ç”±äºèŠ‚ç‚¹çš„é”®å˜å¾—å°äºå®ƒçš„ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªå­©å­è€Œè¿åäº†å †çš„æ€§è´¨ã€‚åˆ™å¯ä»¥é€šè¿‡äº¤æ¢æ­¤èŠ‚ç‚¹å’Œå®ƒçš„å¤§å­©å­æ¥è¿›è¡Œä¿®æ”¹ã€‚è¿™å¯èƒ½å¯¼è‡´å­©å­ çš„è¿è§„ï¼Œç„¶åå°±æŒ‰ç…§è¿™ç§æ–¹å¼ç»§ç»­è°ƒæ•´ï¼Œç›´åˆ°åˆ°è¾¾ä¸å°äºå®ƒçš„æ‰€æœ‰å­©å­çš„èŠ‚ç‚¹æˆ–è€…å¶å­èŠ‚ç‚¹æ‰ç»“æŸã€‚\nè‡ªåº•å‘ä¸Šå †åŒ– å‘ä¸Šéå†å †ï¼Œåªè¦ a[k/2] \u0026lt; a[k] å°±äº¤æ¢ k å¤„å’Œ k/2 å¤„çš„èŠ‚ç‚¹çš„ä½ç½®ã€‚ç»§ç»­æ­¤è¿‡ç¨‹ï¼Œæˆ–è€…ç›´åˆ°åˆ°è¾¾æ ¹èŠ‚ç‚¹ä¸ºæ­¢\nvoid fixUp(type a[], int left, int right){ int s = right; int f = s / 2 - 1; while(f \u0026gt;= left){ if(a[f] \u0026lt; a[s]) exchange(a[f], a[s]); s = f; f = s / 2 - 1; } } è‡ªé¡¶å‘ä¸‹å †åŒ– å‘ä¸‹éå†å †ï¼Œ äº¤æ¢ä½ç½® k å¤„çš„èŠ‚ç‚¹å’Œå®ƒå­©å­ä¸­è¾ƒå¤§çš„é‚£ä¸ªèŠ‚ç‚¹ï¼ˆå¦‚æœæœ‰éœ€è¦çš„è¯ï¼‰ï¼Œå½“ä½ç½® k å¤„çš„èŠ‚ç‚¹ä¸å°äºå®ƒçš„å­©å­æˆ–è€…åˆ°è¾¾äº†åº•ç«¯å°±åœæ­¢ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœ N ä¸ºå¶æ•°ï¼Œä¸” k = N/2 æ—¶ï¼Œ å®ƒåªæœ‰ä¸€ä¸ªå­©å­èŠ‚ç‚¹ã€‚\nvoid fixDown(type a[], int left, int right){ int f = left; int s = 2 * f + 1; //å·¦å­©å­  while(s \u0026lt;= right){ // æ²¡æœ‰åˆ°è¾¾åº•ç«¯  if(s + 1 \u0026lt;= right \u0026amp;\u0026amp; less(a[s], a[s + 1])) s++; // æ‰¾å¤§å­©å­  if(!less(a[f], a[s])) break; // å·²ç»æ»¡è¶³å †çš„æ¡ä»¶ï¼Œè·³å‡º  exchange(a[s], a[f]); // äº¤æ¢  f = s; // ç»§ç»­  s = 2 * f + 1; } } æ’åºæ–¹æ³• ç§»å‡ºå †é¡¶å…ƒç´ ï¼Œç„¶åè°ƒæ•´å †ã€‚é‡å¤ç›´åˆ°å †ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ã€‚\nvoid heapSort(type a[], int left, int right){ int N = right - left + 1; int i = N / 2 - 1; // åˆå§‹åŒ–iä¸ºæœ€åä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼Œä»æœ€åä¸€ä¸ªçˆ¶èŠ‚ç‚¹å¼€å§‹è°ƒæ•´ï¼Œå› ä¸ºæ‰€æœ‰çš„å¶å­èŠ‚ç‚¹éƒ½æ˜¯å †äº†  for(;i \u0026gt;= 0;i--) fixDown(a, i, N); // å»ºå¤§é¡¶å †  for(i = right;i \u0026gt;= left;){ exchange(a[left], a[i]); // æŠŠæ ¹èŠ‚ç‚¹äº¤æ¢åˆ°æœ€å  fixDown(a, left, --i); // è°ƒæ•´  } } åŸºæ•°æ’åº  å¼•å…¥ï¼šå½“æˆ‘ä»¬åœ¨ç”µè¯ç°¿ä¸­æŸ¥æ‰¾æŸä¸ªäººçš„ç”µè¯æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸åªè¾“å…¥å‰å‡ ä¸ªå­—æ¯ï¼Œç„¶åå°±èƒ½å¾—åˆ°ç”µè¯å·ç æ‰€åœ¨çš„é¡µã€‚ä¸ºäº†åœ¨æ’åºç®—æ³•ä¸­å–å¾—ç›¸ä¼¼æ•ˆç‡ï¼Œå¯ä»¥å°†æ¯”è¾ƒé”®çš„æŠ½è±¡è½¬åŒ–ä¸ºå¦ä¸€ç§æŠ½è±¡ã€‚å°†è¿™äº›é”®åˆ†è§£ä¸ºä¸€ç³»åˆ—å®šé•¿ç‰‡æ®µæˆ–å­—èŠ‚ã€‚ç„¶åæ¯æ¬¡å¤„ç†å…¶ä¸­çš„ä¸€ä¸ªç‰‡æ®µï¼Œè¿™ç§æ’åºæ–¹æ³•å«åšåŸºæ•°æ’åºã€‚åŸºæ•°æ’åºç®—æ³•æŠŠé”®å½“ä½œä»¥Rä¸ºåŸºæ•°çš„æ•°å€¼ç³»ç»Ÿè¡¨ç¤ºçš„æ•°ï¼ŒRå¯å–ä¸åŒçš„å€¼ï¼Œåˆ†åˆ«å¤„ç†è¿™äº›æ•°ä¸­çš„å•ä¸ªæ•°å­—ã€‚ åŸºæ•°æ’åºæœ‰ä¸¤ç§ï¼šä¸€ç§æ—¶ä»å·¦åˆ°å³æŒ‰é¡ºåºæ£€æŸ¥é”®ä¸­çš„ä½ï¼Œç§°ä¸ºæœ€é«˜ä½åŸºæ•°æ’åºã€‚å¦ä¸€ç§é‡‡ç”¨ä»å³åˆ°å·¦çš„é¡ºåºï¼Œç§°ä¸ºæœ€ä½ä¸ºåŸºæ•°æ’åºã€‚\n ä»¥16è¿›åˆ¶ä¸ºä¾‹ï¼Œå¯ä»¥é€šè¿‡å³ç§»è¿ç®—å–å¾—int(è¿™é‡Œintä¸º32 ä½)å‹æ•°ç»„ a[i] çš„å„ä¸ªå­—èŠ‚çš„æ•°å­—:æœ€ä½ä½(a[i] \u0026raquo; 0) \u0026amp; 0xff ã€æ¬¡ä½ä½(a[i] \u0026raquo; 8) \u0026amp; 0xff ä»¥åŠ(a[i] \u0026raquo; 16) \u0026amp; 0xff å’Œ(a[i] \u0026raquo; 24) \u0026amp; 0xffã€‚æˆ‘ä»¬éœ€è¦256(0xff - 0x00 + 1 = 256)ä¸ªæ¡¶ã€‚ç¨å¾®ä¿®æ”¹é”®ç´¢å¼•è®¡æ•°çš„ç¨‹åºå°±å¾—åˆ°äº†åŸºæ•°æ’åºçš„ç¨‹åºã€‚\nvoid radix(int b, type a[], int left, int right){ int i, j, M = 256; int N = right - left + 1, cnt[M]; type *aux = new type[N]; for(j = 0;j \u0026lt; M;j++) cnt[j] = 0; // åˆå§‹åŒ–è®¡æ•°ä¸º0  for(i = left;i \u0026lt;= right;i++) cnt[((a[i] \u0026gt;\u0026gt; b * 8) \u0026amp; 0xff) + 1]++; // ç»Ÿè®¡å‡ºç°é¢‘ç‡  for(j = left;j \u0026lt; M;j++) cnt[j + 1] += cnt[j]; //å¾—åˆ°å°äºç­‰äºè®¡æ•°å™¨å¯¹åº”è®¡æ•°å€¼é”®çš„æ•°é‡,å°†é¢‘ç‡è½¬æ¢ä¸ºç´¢å¼•  for(i = left;i \u0026lt;= right;i++) aux[cnt[(a[i] \u0026gt;\u0026gt; b * 8) \u0026amp; 0xff]++] = a[i]; //å°†é”®åˆ†ä¸åˆ°è¾…åŠ©æ•°ç»„ä¸­  for(i = left;i \u0026lt;= right;i++) a[i] = aux[i]; // å›å†™  delete []aux; } void radixSort(type a[], int left, int right){ radix(0, a, left, right); radix(1, a, left, right); radix(2, a, left, right); radix(3, a, left, right); } ","href":"/notebook/reading_notes/algorithms_in_c/sorting/","title":"å„ç§æ’åºç®—æ³•"},{"content":"","href":"/tags/git/","title":"Git"},{"content":"å¼€å§‹ æ–‡ä»¶çš„ä¸‰ç§çŠ¶æ€  å·²æäº¤(committed) æ•°æ®å·²ç»å®‰å…¨çš„ä¿å­˜åœ¨äº†æœ¬åœ°çš„æ•°æ®åº“ä¸­ å·²ä¿®æ”¹(modified) ä¿®æ”¹äº†æ–‡ä»¶ï¼Œä½†è¿˜æ²¡ä¿å­˜åˆ°æ•°æ®åº“ä¸­ å·²æš‚å­˜(staged) å¯¹ä¸€ä¸ªå·²ä¿®æ”¹çš„æ–‡ä»¶çš„å½“å‰ç‰ˆæœ¬åšäº†æ ‡è®°ï¼Œä½¿ä¹‹åŒ…å«åœ¨ä¸‹æ¬¡çš„æäº¤å¿«ç…§ä¸­ã€‚  é¡¹ç›®çš„ä¸‰ä¸ªå·¥ä½œåŒºåŸŸ  Gitä»“åº“ç›®å½• ä¿å­˜é¡¹ç›®çš„å…ƒæ•°æ®å’Œå¯¹è±¡æ•°æ®åº“ å·¥ä½œç›®å½• å¯¹é¡¹ç›®çš„æŸä¸ªç‰ˆæœ¬ç‹¬ç«‹æå–å‡ºæ¥çš„å†…å®¹ æš‚å­˜åŒºåŸŸ ä¿å­˜ä¸‹æ¬¡å°†è¦æäº¤çš„æ–‡ä»¶åˆ—è¡¨ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶  åŸºæœ¬çš„Gitå·¥ä½œæµç¨‹  åœ¨å·¥ä½œç›®å½•ä¸­ä¿®æ”¹æ–‡ä»¶ æš‚å­˜æ–‡ä»¶ï¼Œå°†æ–‡ä»¶çš„å¿«ç…§æ”¾å…¥æš‚å­˜åŒºåŸŸ æäº¤æ›´æ–°ï¼Œå°†æš‚å­˜åŒºåŸŸä¸­çš„æ–‡ä»¶çš„å¿«ç…§æ°¸ä¹…ä¿å­˜åˆ°Gitä»“åº“ç›®å½•  åˆæ¬¡è¿è¡Œå‰  è®¾ç½®ç”¨æˆ·åä¸é‚®ç®±åœ°å€ --global è¡¨ç¤ºä½¿ç”¨ global config file , ç”¨äºæ‰€æœ‰é…ç½®ã€‚å¦‚æœæ˜¯å¯¹äºéœ€è¦ä½¿ç”¨ä¸åŒç”¨æˆ·åå’Œé‚®ç®±çš„ç‰¹å®šé¡¹ç›®å°±ä¸éœ€è¦è¿™ä¸ªé€‰é¡¹ã€‚  $ git config --global user.name username $ git config --global user.email example@xxx.com  è®¾ç½®æ–‡æœ¬ç¼–è¾‘å™¨  $ git config --global core.editor code  æŸ¥çœ‹é…ç½®ä¿¡æ¯  $ git config --list  è·å–å¸®åŠ©  æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥è·å–å¸®åŠ©ï¼Œwindowsä¸­é»˜è®¤æ”¯æ”¯æŒå‰ä¸¤ç§\n$ git help \u0026lt;verb\u0026gt; $ git \u0026lt;verb\u0026gt; --help $ man git-\u0026lt;verb\u0026gt; åŸºç¡€ è·å–Gitä»“åº“  åœ¨ç°æœ‰ç›®å½•ä¸­åˆå§‹åŒ–Gitä»“åº“  $ git init å¦‚æœä¸æ˜¯åœ¨ä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¤šåšä¸€ç‚¹äº‹æƒ…ï¼šå¼€å§‹è·Ÿè¸ªæŒ‡å®šæ–‡ä»¶å¹¶æäº¤ã€‚ä½¿ç”¨ git add å‘½ä»¤æ¥å®ç°å¯¹æŒ‡å®šæ–‡ä»¶çš„è·Ÿè¸ªï¼Œç„¶åæ‰§è¡Œ git commit æäº¤ã€‚\n å…‹éš†ç°æœ‰ä»“åº“  $ git clone [url] è¿™ä¸ªå‘½ä»¤å°†ä¼šå…‹éš†Gitä»“åº“æœåŠ¡å™¨ä¸Šå‡ ä¹æ‰€æœ‰çš„æ•°æ®ã€‚\nè®°å½•æ¯æ¬¡æ›´æ–°åˆ°ä»“åº“  æ£€æŸ¥æ–‡ä»¶å½“å‰çŠ¶æ€  $ git status  è·Ÿè¸ªæ–°æ–‡ä»¶  $ git add (files) è·Ÿè¸ªåçš„æ–‡ä»¶ä¼šå¤„äºæš‚å­˜çŠ¶æ€ã€‚å¯ä»¥è¿è¡Œ git status å‘½ä»¤æŸ¥çœ‹ã€‚ å¦‚æœä¿®æ”¹äº†å·²è·Ÿè¸ªçš„æ–‡ä»¶ï¼Œå®ƒçš„çŠ¶æ€ä¼šå˜ä¸ºå·²ä¿®æ”¹ï¼Œè¦æš‚å­˜è¿™æ¬¡æ›´æ–°ï¼Œå°±éœ€è¦è¿è¡Œ git add å‘½ä»¤ ã€‚æ³¨æ„ï¼š git add æ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½å‘½ä»¤ï¼Œå¯ä»¥ç†è§£ä¸ºâ€œæ·»åŠ å†…å®¹åˆ°ä¸‹ä¸€æ¬¡æäº¤ä¸­â€ã€‚\n æŸ¥çœ‹å·²æš‚å­˜æˆ–æœªæš‚å­˜çš„ä¿®æ”¹  $ git diff æ³¨æ„ï¼šgit diff åªæ˜¾ç¤ºå°šæœªæš‚å­˜çš„æ”¹åŠ¨ï¼Œå¯ä»¥åŠ ä¸Š --cache é€‰é¡¹æ¥æŸ¥çœ‹å·²ç»æš‚å­˜çš„æ”¹åŠ¨ã€‚å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥åˆ†ææ–‡ä»¶çš„å·®å¼‚ã€‚\n æäº¤æ›´æ–°  $ git commit è¿™ä¼šå¯åŠ¨é»˜è®¤çš„æ–‡æœ¬ç¼–è¾‘å™¨ä»¥ä¾¿è¾“å…¥æœ¬æ¬¡æäº¤çš„è¯´æ˜ã€‚å¯ä»¥ä½¿ç”¨ -m é€‰é¡¹æ¥æŠŠæäº¤ä¿¡æ¯ä¸å‘½ä»¤æ”¾åœ¨åŒä¸€è¡Œã€‚å¦‚ï¼š\n$ git commit -m \u0026quot;add readme.md\u0026quot;   è·³è¿‡ä½¿ç”¨æš‚å­˜åŒºåŸŸ åœ¨æäº¤çš„æ—¶å€™ï¼Œç»™ git commit å‘½ä»¤åŠ ä¸Š -a é€‰é¡¹ï¼ŒGitå°±ä¼šè‡ªåŠ¨æŠŠæ‰€æœ‰å·²è·Ÿè¸ªè¿‡çš„æ–‡ä»¶æš‚å­˜èµ·æ¥ä¸€å¹¶æäº¤ï¼Œä»è€Œè·³è¿‡ git add æ­¥éª¤ã€‚\n  ç§»é™¤æ–‡ä»¶ è¦ä»Gitä¸­ç§»é™¤æŸä¸ªæ–‡ä»¶ï¼Œå°±å¿…é¡»è¦ä»å·²è·Ÿè¸ªæ–‡ä»¶æ¸…å•ä¸­ç§»é™¤ï¼ˆå‡†ç¡®æ¥è¯´ï¼Œæ˜¯æš‚å­˜åŒºåŸŸï¼‰ï¼Œç„¶åæäº¤ã€‚ä½¿ç”¨çš„å‘½ä»¤æ˜¯ git rm ,å®ƒè¿˜ä¼šä»å·¥ä½œç›®å½•ä¸­åˆ é™¤æŒ‡å®šæ–‡ä»¶ï¼Œè¿™æ ·å°±ä¸ä¼šè¢«è·Ÿè¸ªäº†ã€‚ å¦‚æœæƒ³æŠŠæ–‡ä»¶ä»Gitä»“åº“ä¸­åˆ é™¤ï¼ˆäº¦ä»æš‚å­˜åŒºåŸŸåˆ é™¤ï¼‰ï¼ŒåŠ ä¸Š --cache é€‰é¡¹å³å¯ã€‚\n  ç§»åŠ¨æ–‡ä»¶ ä½¿ç”¨å‘½ä»¤ git mv å³å¯ã€‚å®ƒäº¦å¯ä»¥ç”¨æ¥é‡å‘½åæ–‡ä»¶ï¼š\n  $ git mv old_file new_file  æŸ¥çœ‹æäº¤å†å²  $ git log è¿™é»˜è®¤ä¼šæŒ‰æ–‡ä»¶æäº¤æ—¶é—´åˆ—å‡ºæ‰€æœ‰çš„æ›´æ–°ï¼Œå¹¶ä¸”æœ€æ–°çš„è·Ÿæ–°åœ¨æœ€ä¸Šé¢ã€‚ä¸€ä¸ªå¸¸ç”¨çš„é€‰é¡¹æ˜¯ -p ,ç”¨æ¥æ˜¾ç¤ºæ¯æ¬¡æäº¤å†…å®¹çš„å·®å¼‚ã€‚\n  æ’¤é”€æ“ä½œ\né‡æ–°æäº¤ï¼Œä¸‹é¢çš„å‘½ä»¤ä¼šç”¨ç¬¬äºŒæ¬¡æäº¤å–ä»£ç¬¬ä¸€æ¬¡æäº¤çš„ç»“æœï¼š\n  $ git commit --amend å–æ¶ˆæš‚å­˜çš„æ–‡ä»¶ï¼š\n$ git reset \u0026lt;file\u0026gt; æ’¤é”€å¯¹æ–‡ä»¶çš„ä¿®æ”¹ï¼š\n$ git checkout --\u0026lt;file\u0026gt; è¿œç¨‹ä»“åº“çš„ä½¿ç”¨  æŸ¥çœ‹è¿œç¨‹ä»“åº“  $ git remote  æ·»åŠ è¿œç¨‹ä»“åº“  $ git remote add \u0026lt;shortname\u0026gt; \u0026lt;url\u0026gt; è¿™ä¼šæ·»åŠ ä¸€ä¸ªè¿œç¨‹ä»“åº“å¹¶æŒ‡å®šä½¿ç”¨é—´å†™ shortname æ¥å¼•ç”¨å®ƒã€‚\n ä»è¿œç¨‹ä»“åº“æŠ“å–  $ git fetch [remote-name]  æ¨é€åˆ°è¿œç¨‹ä»“åº“  $ git push [remote-name] [branch-name]  æŸ¥çœ‹è¿œç¨‹ä»“åº“  $ git remote show [remote-name]  é‡å‘½åè¿œç¨‹ä»“åº“  $ git remote rename [old-name] [new-name]  åˆ é™¤è¿œç¨‹ä»“åº“  $ git remote rm [remote-name] ","href":"/posts/git/git_at_first_sight/","title":"Gitåˆæ¢"},{"content":"","href":"/categories/tools/","title":"Tools"},{"content":"é—®é¢˜ç”±æ¥  è¿™æ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„é—®é¢˜äº†ï¼Œå¤§æ¦‚å°±æ˜¯è¯´ï¼š å·²çŸ¥nä¸ªäººï¼ˆä»¥ç¼–å·1ï¼Œ2ï¼Œ3\u0026hellip;nåˆ†åˆ«è¡¨ç¤ºï¼‰å›´æˆä¸€ä¸ªåœ†åœˆã€‚ ä»ç¬¬ä¸€ä¸ªäººå¼€å§‹æŠ¥æ•°ï¼Œæ•°åˆ°mçš„é‚£ä¸ªäººå‡ºåˆ—è‡ªæ€ï¼›ä»–çš„ä¸‹ä¸€ä¸ªäººåˆä»1å¼€å§‹æŠ¥æ•°ï¼Œæ•°åˆ°mçš„é‚£ä¸ªäººåˆå‡ºåˆ—è‡ªæ€ï¼› ä¾æ­¤è§„å¾‹é‡å¤ä¸‹å»ï¼Œæ‰¾å‡ºæœ€åå‰©ä¸‹æ¥çš„é‚£ä¸ªäººã€‚æ›´ä¸€èˆ¬çš„ï¼Œæ‰¾å‡ºè‡ªæ€é¡ºåºã€‚\n ç”¨C++é“¾è¡¨å®ç° ä¸ºäº†ä»¥ä¸€ç§åœ†åœˆçš„å½¢å¼æ’åˆ—äººç¾¤ï¼Œ æˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªå¾ªç¯é“¾è¡¨ï¼Œæ¯ä¸ªäººå’Œä»–å·¦è¾¹çš„é‚£ä¸ªäººä¹‹é—´éƒ½æœ‰ä¸€ä¸ªé“¾æ¥ã€‚ç”¨æ•´æ•° i ä»£è¡¨å¾ªç¯ä¸­çš„ç¬¬ i ä¸ªäººã€‚ä» 1 å¼€å§‹ï¼Œæ¯æ¬¡ç”Ÿæˆä¸€ä¸ªç»“ç‚¹æ’å…¥é“¾è¡¨å°¾éƒ¨â€¦â€¦ç›´åˆ°æœ€åä¸€ä¸ªäºº n è¿›å…¥é“¾è¡¨ï¼Œ ç„¶åè®© n çš„ä¸‹ä¸€ä¸ªæŒ‡å‘ 1ï¼Œè¿™æ ·å°±æ„æˆäº†ä¸€ä¸ªå¾ªç¯é“¾è¡¨ã€‚è®¾ç½®ä¸€ä¸ªå˜é‡ t è®°å½•å½“å‰æ‰€æŠ¥æ•°å­—ã€‚ä»é“¾è¡¨å¤´éƒ¨å¼€å§‹ï¼ˆ t = 1ï¼‰ç”¨è¿­ä»£å™¨ it éå†é“¾è¡¨ï¼Œå½“ t == m æ—¶ï¼Œit åˆšå¥½æŒ‡å‘è¦è¯¥è‡ªæ€çš„é‚£ä¸ªäººï¼Œäºæ˜¯è¾“å‡ºå¹¶ä»é“¾è¡¨ä¸­åˆ é™¤ã€‚å½“ it åˆ°è¾¾é“¾è¡¨å°¾éƒ¨æ—¶ï¼Œè®© it æŒ‡å‘é“¾è¡¨å¤´ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªç¯ã€‚é‡å¤æ“ä½œï¼Œç›´åˆ°å‰©ä¸‹æœ€åä¸€ä¸ªäººã€‚\n#include\u0026lt;cstdlib\u0026gt;#include\u0026lt;cstdio\u0026gt;#include\u0026lt;list\u0026gt;using namespace std; int main(){ int n, m; scanf(\u0026#34;%d%d\u0026#34;, \u0026amp;n, \u0026amp;m); list\u0026lt;int\u0026gt; ring; for(int i = 1;i \u0026lt;= n;i++) ring.push_back(i); int t = 1; //è®¡æ•°  for(list\u0026lt;int\u0026gt;::iterator it = ring.begin();ring.size() != 1;){ if(t++ == m){ printf(\u0026#34;%-3d\u0026#34;, *it); it = ring.erase(it); // è‡ªæ€  t = 1; } else it++; // æŒ‡å‘ä¸‹ä¸€ä¸ª  if(it == ring.end()) it = ring.begin(); } printf(\u0026#34;\\nalive: %d\\n\u0026#34;, *ring.begin()); system(\u0026#34;pause\u0026#34;); return 0; } ç”¨æ•°ç»„æ¨¡æ‹Ÿé“¾è¡¨å®ç° æˆ‘ä»¬å¯ä»¥ç”¨æ•°ç»„çš„ç´¢å¼•æ¥å®ç°é“¾è¡¨ï¼Œè€Œä¸æ˜¯ç”¨æŒ‡é’ˆã€‚æ–¹æ³•å°±æ˜¯ï¼šç”¨æ•°ç»„å…ƒç´  item[i] å­˜å‚¨ç¼–å·ä¸º i çš„äººï¼Œç”¨æ•°ç»„å…ƒç´  next[i] å­˜å‚¨ i çš„ä¸‹ä¸€ä¸ªåœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚é‚£ä¹ˆæœ‰ item[i] == i + 1ã€‚æ³¨æ„æœ€å¼€å§‹çš„æ—¶å€™ next[n - 1] = 0 ã€‚ç”¨ä½ç½®å˜é‡ pos è·Ÿè¸ªå…ƒç´ ï¼Œé¦–å…ˆè®© pos = n - 1 ,è¿™æ · pos æ‰æ˜¯æŒ‡å‘ç¬¬ä¸€ä¸ªäººçš„ï¼Œé€šè¿‡ m - 1 æ¬¡ pos = next[pos] å¾—åˆ°è‡ªæ€çš„é‚£ä¸ªäººçš„å‰ä¸€ä¸ªäººä½ç½®ï¼Œç„¶åç”¨ next[pos] = next[next[pos]] åˆ é™¤ç¬¬ m ä¸ªäººã€‚è¿™ç§æ–¹å¼è¿˜æ˜¯å¾ˆæµªè´¹ç©ºé—´çš„ã€‚\n#include\u0026lt;cstdio\u0026gt;#include\u0026lt;cstdlib\u0026gt;#include\u0026lt;vector\u0026gt;using namespace std; int main(){ int n, m; scanf(\u0026#34;%d%d\u0026#34;, \u0026amp;n, \u0026amp;m); vector\u0026lt;int\u0026gt; item, next; for(int i = 1;i \u0026lt;= n;i++){ item.push_back(i); next.push_back(i % n); // å­˜æ”¾içš„ä¸‹ä¸€ä¸ªçš„æ•°ç»„ä¸‹æ ‡  } int t, pos = n - 1; // ä½¿posæŒ‡å‘é“¾è¡¨é¦–å…ƒç´   for(int i = 0;i \u0026lt; n - 1;i++){ for(t = 0;t \u0026lt; m - 1;t++) pos = next[pos]; printf(\u0026#34;%-3d\u0026#34;, item[next[pos]]); next[pos] = next[next[pos]]; // è‡ªæ€  } printf(\u0026#34;\\nalive: %d\\n\u0026#34;, item[pos]); system(\u0026#34;pause\u0026#34;); return 0; } ","href":"/notebook/reading_notes/algorithms_in_c/josepus-problem/","title":"çº¦ç‘Ÿå¤«é—®é¢˜"},{"content":"ç­›æ³•åŸç†  ç»™å‡ºè¦ç­›æ•°å€¼çš„èŒƒå›´maxnï¼Œæ‰¾å‡ºmaxnä»¥å†…æ‰€æœ‰çš„ç´ æ•°ã€‚å…ˆç”¨2å»ç­›ï¼Œå³æŠŠ2ç•™ä¸‹ï¼ŒæŠŠ2çš„å€æ•°å‰”é™¤æ‰ï¼›å†ç”¨ä¸‹ä¸€ä¸ªç´ æ•°ï¼Œä¹Ÿå°±æ˜¯3ç­›ï¼ŒæŠŠ3ç•™ä¸‹ï¼ŒæŠŠ3çš„å€æ•°å‰”é™¤æ‰ï¼›æ¥ä¸‹å»ç”¨ä¸‹ä¸€ä¸ªç´ æ•°5ç­›ï¼ŒæŠŠ5ç•™ä¸‹ï¼ŒæŠŠ5çš„å€æ•°å‰”é™¤æ‰ï¼›ä¸æ–­é‡å¤ä¸‹å»\u0026hellip;\u0026hellip;ã€‚\n ç®—æ³• å¯ä»¥é€šè¿‡ç»´æŠ¤ä¸€ä¸ªæ ‡è®°æ•°ç»„ **a[]**æ¥è¿›è¡Œåˆ¤æ–­ã€‚\n è‹¥ i ä¸ºç´ æ•°ï¼Œåˆ™ a[i] = 1 ï¼Œå¦åˆ™ a[i] = 0ã€‚ é¦–å…ˆï¼Œå°†æ‰€æœ‰çš„ a[i] éƒ½è®¾ç½®ä¸º 1ï¼Œè¡¨ç¤ºå·²çŸ¥çš„éƒ½æ˜¯ç´ æ•°ã€‚ç„¶åå°†æ‰€æœ‰ä»¥å·²çŸ¥ç´ æ•°çš„å€æ•°ä¸ºç´¢å¼•çš„æ•°ç»„å…ƒç´ è®¾ä¸º 0ã€‚ å¦‚æœå°†æ‰€æœ‰è¾ƒå°ç´ æ•°çš„å€æ•°éƒ½è®¾ç½®ä¸º 0 ä¹‹åï¼Œa[i] ä»ä¸º 1ï¼Œåˆ™ i ä¸ºç´ æ•°ã€‚  #include\u0026lt;cstdio\u0026gt;#include\u0026lt;cstdlib\u0026gt;const int maxn = 10000; int main(){ int i, j, t, a[maxn]; for(i = 2;i \u0026lt; maxn;i++) a[i] = 1; for(i = 2;i \u0026lt; maxn;i++){ if(a[i] == 1){ t = maxn / i; for(j = i;j \u0026lt; t;j++) a[i * j] = 0; } } for(i = 2;i \u0026lt; maxn;i++){ if(a[i] == 1) printf(\u0026#34;%4d \u0026#34;, i); } system(\u0026#34;pause\u0026#34;); return 0; } ","href":"/notebook/reading_notes/algorithms_in_c/seive-of-eratosthenes/","title":"å„æ‹‰å¤šç­›æ³•æ±‚ç´ æ•°"},{"content":"è®°å½•ä¸€ä¸‹æœ€è¿‘å­¦ä¹ çš„å¹¶æŸ¥é›†ã€‚\né—®é¢˜å¼•å…¥ å‡å®šæœ‰ä¸€ä¸ªæ•´æ•°å¯¹åºåˆ—ï¼Œå…¶ä¸­æ¯ä¸ªæ•´æ•°ä»£è¡¨æŸç§ç±»å‹çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸”å°† p-q è§£é‡Šä¸ºâ€œpä¸qè¿é€šâ€ã€‚å…³ç³»æ˜¯å¯ä¼ é€’çš„ï¼Œå¦‚æœ p-q å’Œ q-r ï¼Œåˆ™æœ‰ p-r ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç¼–å†™ä¸€æ®µç¨‹åºï¼Œä»é›†åˆä¸­è¿‡æ»¤é¢å¤–è¿æ¥å¯¹ã€‚å½“ç¨‹åºè¾“å…¥ä¸€ä¸ªè¿æ¥å¯¹ p-q ï¼Œè‹¥ä¹‹å‰çš„è¿æ¥å¯¹ä¸èƒ½é€šè¿‡ä¼ é€’å…³ç³»æ¨å¯¼å‡º p-q ï¼Œåˆ™è¾“å‡º p-q ï¼Œ å¦åˆ™å¿½ç•¥ p-q ï¼Œè¯»å–ä¸‹ä¸€ä¸ªæ•´æ•°å¯¹ã€‚\nè¿‡ç¨‹ç¤ºä¾‹:\n3-4 3-4\n4-0 4-0\n3-0\n4-1 4-1\n5-6 5-6\n0-5 0-5\n3-5\n2-9 2-9\næˆ‘ä»¬çš„é—®é¢˜æ˜¯è®¾è®¡ä¸€ä¸ªç¨‹åºï¼Œå®ƒé€šè¿‡å·²æœ‰çš„ä¿¡æ¯ï¼Œæ¥åˆ¤æ–­æ–°çš„å¯¹è±¡æ˜¯å¦è¿é€šã€‚æ•´æ•°å¯èƒ½ä»£è¡¨ä¸€ä¸ªå¤§å‹ç½‘ç»œä¸­çš„è®¡ç®—æœºï¼Œæ•´æ•°å¯¹å¯èƒ½ä»£è¡¨ç½‘ç»œä¸­çš„è¿é€šæƒ…å†µã€‚åŒæ ·ï¼Œæ•´æ•°ä¹Ÿå¯ä»¥ä»£è¡¨ä¸€ä¸ªç”µç½‘ä¸­çš„è§¦ç”µï¼Œ æ•´æ•°å¯¹å°±æ˜¯ç”µçº¿â€¦â€¦è¿™äº›é—®é¢˜çš„è§„æ¨¡å¯èƒ½éƒ½éå¸¸å·¨å¤§ï¼Œç®—æ³•çš„å¥½åç›´æ¥å†³å®šäº†å¼€é”€çš„å¤§å°ã€‚\nå¹¶å’ŒæŸ¥ å¹¶æŸ¥é›†ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ“ä½œ:\n å¹¶ï¼š åˆå¹¶ä¸¤ä¸ªé›†åˆ æŸ¥ï¼š åˆ¤æ–­ä¸¤ä¸ªå…ƒç´ æ˜¯å¦å±äºåŒä¸€ä¸ªé›†åˆ  è§£å†³æ–¹æ¡ˆ æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥æ‰¾ï¼ˆunionï¼‰å’Œå¹¶é›†ï¼ˆunionï¼‰è¿ç®—æ¥è§£å†³è¿é€šæ€§é—®é¢˜ã€‚æ¯å½“ä»è¾“å…¥è¯»å–ä¸€ä¸ªæ–°çš„ p-q å¯¹åï¼Œåˆ†åˆ«è¿›è¡Œ p å’Œ q çš„æŸ¥æ‰¾ï¼Œ å¦‚æœå®ƒä»¬ä½äºåŒä¸€ä¸ªé›†åˆä¸­ï¼Œå°±ç›´æ¥åˆ†æä¸‹ä¸€ä¸ª p-q å¯¹ã€‚å¦åˆ™ï¼Œå°±è¿›è¡Œå¹¶é›†æ“ä½œå¹¶è¾“å‡ºã€‚ æœ€å¯èƒ½æƒ³åˆ°çš„æ˜¯ä¾æ¬¡ä¿å­˜æ¯ä¸€ä¸ª p-q å¯¹ï¼Œç„¶åè¿›è¡Œéå†ï¼Œåˆ¤æ–­å®ƒä»¬æ˜¯å¦è¿é€šã€‚å¯é—®é¢˜çš„è§„æ¨¡å¯èƒ½å¾ˆå¤§ï¼Œè¿™æ—¶å€™è¿™ä¸ªæ–¹æ³•å°±æ‰è¥Ÿè§è‚˜äº†ã€‚æˆ‘ä»¬å…¶å®å¹¶ä¸ç”¨ä¿å­˜æ‰€æœ‰çš„ p-q å¯¹ï¼Œä½¿ç”¨ä¸€ä¸ªæ•´æ•°æ•°ç»„æ¥ä¿å­˜å®ç°findå’Œunionæ“ä½œçš„å¿…å¤‡ä¿¡æ¯å³å¯ã€‚\nå¿«é€ŸæŸ¥æ‰¾ï¼ˆquick-findï¼‰ç®€å•ç®—æ³•  å‡è®¾Aå’ŒBæ˜¯æœ‹å‹ï¼ŒBå’ŒCæ˜¯æœ‹å‹ï¼ŒAå’ŒBäº’ä¸è®¤è¯†ï¼Œä½†ä»–ä»¬é€šè¿‡Bè¿™ä¸ªå…±åŒçš„æœ‹å‹è”ç³»åœ¨äº†ä¸€å—å„¿ã€‚Cè¿˜ä¼šæœ‰æœ‹å‹Dâ€¦â€¦,æ‰€æœ‰èƒ½é€šè¿‡æŸç§æœ‹å‹å…³ç³»å»ºç«‹è”ç³»çš„æœ‹å‹å°±æ„æˆäº†ä¸€ä¸ªæœ‹å‹åœˆã€‚è®¾æƒ³æ¯ä¸ªæœ‹å‹åœˆéƒ½æœ‰ä¸€ä¸ªåœˆä¸»ï¼Œåœˆä¸»å”¯ä¸€çš„ç¡®å®šäº†è¿™ä¸ªåœˆå­ã€‚ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œæ¯å½“æœ‰ä¸€ä¸ªæ–°çš„äººåŠ å…¥åœˆå­ï¼Œä»–å°±æˆä¸ºäº†è¿™ä¸ªåœˆå­çš„åœˆä¸»ã€‚ äºæ˜¯æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ•°ç»„ A[] æ¥è¿›è¡Œå­˜å‚¨ã€‚å¦‚æœ i ä»£è¡¨ä¸€ä¸ªäººï¼Œé‚£ä¹ˆ A[i] å°±æ˜¯ä»–çš„åœˆä¸»ã€‚ç°åœ¨æˆ‘ä»¬æ¥åˆ¤æ–­ p å’Œ q æ˜¯ä¸æ˜¯ä½äºåŒä¸€ä¸ªåœˆå­, è§£å†³æœ€å¼€å§‹æå‡ºçš„é—®é¢˜ã€‚\n ä½¿ç”¨ä¸€ä¸ªæ•´æ•°æ•°ç»„ A[] , å®ƒå…·æœ‰å¦‚ä¸‹æ€§è´¨ï¼šå½“ä¸”ä»…å½“ A[p] = A[q] æ—¶ï¼Œpä¸qè¿é€šã€‚é¦–å…ˆç”¨ i åˆå§‹åŒ– A[i] , ä¸ºäº†å¯¹ p å’Œ q å®ç°å¹¶é›†çš„è¿ç®—ï¼Œéå†æ•°ç»„ï¼Œå°†æ‰€æœ‰å’Œ A[p] å€¼ç›¸åŒé¡¹çš„æ›¿æ¢ä¸º A[q] çš„å€¼ã€‚\n#include\u0026lt;cstdio\u0026gt;const int N = 10000; int main(){ int p, q, A[N]; for(int i = 0;i \u0026lt; N;i++) A[i] = i; while(scanf(\u0026#34;%d-%d\u0026#34;, \u0026amp;p, \u0026amp;q) == 2){ if(A[p] == A[q]) continue; for(int i = 0, t = A[p];i \u0026lt; N;i++){ if(A[i] == t) A[i] = A[q]; } printf(\u0026#34;%d-%d\\n\u0026#34;, p, q); } } å¯ä»¥ç”¨æ ‘æ¥è¡¨ç¤ºquick-findçš„è¿‡ç¨‹ã€‚å¦‚ä¸‹å›¾ä¸­å·¦åŠéƒ¨åˆ†æ‰€ç¤ºï¼Œæ¯è¾“å…¥ä¸€ä¸ª p-q å¯¹ï¼Œ A[q] å°±æˆä¸ºçˆ¶èŠ‚ç‚¹ã€‚ä¸‹å›¾çš„å³åŠéƒ¨åˆ†æè¿°çš„æ˜¯quick-unionçš„è¿‡ç¨‹ï¼Œ æ¯æ¬¡åªæœ‰ä¸€ä¸ªå€¼å‘ç”Ÿäº†æ”¹å˜ã€‚ä¹Ÿå°±æ˜¯ q æˆä¸ºäº† p çš„çˆ¶èŠ‚ç‚¹ã€‚ å¿«é€Ÿå¹¶é›†ï¼ˆquick-unionï¼‰ç®—æ³•  å‰é¢çš„å¿«é€ŸæŸ¥æ‰¾ç®—æ³•èƒ½å¤Ÿæ­£ç¡®è§£å†³é—®é¢˜ï¼Œå½“é¢å¯¹ç™¾ä¸‡çº§çš„è¾“å…¥ï¼Œæ•ˆç‡å°±ä¸è¡Œäº†ã€‚ä¸‹é¢æ˜¯quick-findçš„äº’è¡¥æ–¹æ³•â€”â€”quick-unionã€‚ å¯ä»¥ç”¨æ ‘æ¥æè¿°æè¿°på’Œqæ˜¯ä¸æ˜¯ä½äºåŒä¸€ä¸ªé›†åˆï¼Œå¦‚æœpå’Œqæœ‰ç›¸åŒçš„æ ¹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä»–ä»¬ä½äºåŒä¸€ä¸ªé›†åˆã€‚å¦‚æœpå’Œqä¸åœ¨åŒä¸€ä¸ªé›†åˆä¸­ï¼Œ ä¸ºäº†å½¢æˆå¹¶é›†ï¼Œä½¿på’Œqæ‹¥æœ‰ç›¸åŒçš„æ ¹èŠ‚ç‚¹å³å¯ã€‚ å’Œquick_findçš„ä¸åŒåœ¨äºï¼š\n  è¿™é‡Œ A[i] çš„å€¼æŒ‡å‘çš„æ˜¯å®ƒçš„çˆ¶äº²åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼ˆæ¯”å¦‚ A[1] = 2 ï¼Œ 1çš„çˆ¶äº²åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ä¸º2ï¼‰ã€‚ æ ¹èŠ‚ç‚¹çš„å€¼æŒ‡å‘å®ƒæœ¬èº«ï¼Œå³ï¼šè‹¥ i ä¸ºæ ¹èŠ‚ç‚¹ï¼Œåˆ™ A[i] = i ;æ ¹èŠ‚ç‚¹æ€»æ˜¯å­˜åœ¨çš„ã€‚ é€šè¿‡åˆ†åˆ«é€šè¿‡ i å’Œ j é€’å½’æŸ¥æ‰¾ p å’Œ q çš„æ ¹èŠ‚ç‚¹ã€‚  ç”¨ä¸‹é¢çš„ä»£ç æ›¿æ¢quick-findä¸­çš„ while å¾ªç¯ä½“\nint i , j; for(i = p;i != A[i];i = A[i]); for(j = q;j != A[j];j = A[j]); if(i == j) continue; //på’Œqçš„æ ¹ç›¸åŒï¼Œè¯´æ˜på’Œqè¿é€š A[i] = j; // è¿›è¡Œå¹¶é›†æ“ä½œ printf(\u0026#34;%d-%d\\n\u0026#34;, p, q); åŠ æƒå¿«é€Ÿå¹¶é›†ï¼ˆweighted-quick-unionï¼‰ç®—æ³•  quick-unionæ˜¯å¯¹quick-findçš„ä¸€ç§æ”¹è¿›ï¼Œä½†ä»ç„¶æœ‰ç¼ºé™·ã€‚æ¯æ¬¡è¿›è¡Œå¹¶é›†æ“ä½œå°±ç›¸å½“äºæŠŠä¸€æ£µæ ‘çš„æ ‘æ ¹é“¾æ¥åˆ°å¦ä¸€æ£µæ ‘çš„æ ‘æ ¹ä¸Šå»ã€‚ è€Œæ‰¾åˆ°æ ¹èŠ‚ç‚¹æ‰€åŒ–çš„æ—¶é—´å’Œå½“å‰ç»“ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·ç¦»æœ‰å…³ï¼Œè·ç¦»è¶ŠçŸ­ï¼Œforå¾ªç¯æ‰§è¡Œçš„æ¬¡æ•°å°±è¶Šå°‘ å¦‚æœèƒ½å¤Ÿç›´æ¥æŠŠè¾ƒå°çš„æ ‘çš„æ ¹ç›´æ¥è¿æ¥åˆ°è¾ƒå¤§çš„æ ‘çš„æ ¹ä¸Šï¼Œå°±èƒ½ç¼©çŸ­æ—¶é—´ã€‚ äºæ˜¯æˆ‘ä»¬å¯ä»¥è®¾ç½®è¾…åŠ©æ•°ç»„ S[] æ¥è·Ÿè¸ªæ¯ä¸ªç»“ç‚¹å­æ ‘ä¸­ç»“ç‚¹çš„æ•°é‡ï¼Œç„¶åæ€»æ˜¯æŠŠè¾ƒå°çš„æ ‘çš„æ ¹è¿æ¥åˆ°è¾ƒå¤§çš„æ ‘çš„æ ¹ä¸Šå»ã€‚\n #include\u0026lt;cstdio\u0026gt;const int N = 10000; int main(){ int p, q, A[N], S[N]; for(int i = 0;i \u0026lt; N;i++){A[i] = i;S[N] = 1;} while(scanf(\u0026#34;%d-%d\u0026#34;, \u0026amp;p, \u0026amp;q) == 2){ int i , j; for(i = p;i != A[i];i = A[i]); for(j = q;j != A[j];j = A[j]); if(i == j) continue; //på’Œqçš„æ ¹ç›¸åŒï¼Œè¯´æ˜på’Œqè¿é€š  A[i] = j; // è¿›è¡Œå¹¶é›†æ“ä½œ  if(S[i] \u0026lt; S[j]){A[i] = j;S[j] += S[i];} // å¯»æ‰¾å¤§æ ‘  else {A[j] = i;S[i] += S[j];} printf(\u0026#34;%d-%d\\n\u0026#34;, p, q); } } è·¯å¾„å‹ç¼©  å¦‚æœèƒ½å¤Ÿåœ¨å¹¶é›†æ“ä½œä¸­ï¼Œä½¿æ¯ä¸ªç»“ç‚¹éƒ½èƒ½ç›´æ¥æŒ‡å‘æ ‘æ ¹ï¼Œé‚£ä¹ˆå°†å¤§å¤§èŠ‚çœå¼€é”€ã€‚æœ€ç»ˆçš„ç»“æœå°±æ˜¯å‡ ä¹æŠŠæ•´æ£µæ ‘å‹å¹³ï¼Œæ¥è¿‘äºç†æƒ³æƒ…å†µã€‚ å¯ä»¥å¯¹ä¸Šé¢çš„ç®—æ³•åšä¸€ä¸ªç®€å•çš„æ”¹è¿›â€”â€”é€šè¿‡æŸç§æ–¹æ³•è®© A[i] å­˜å‚¨çš„ä¸å†æ˜¯å®ƒçˆ¶äº²åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼Œè€Œæ˜¯è¶Šè¿‡çˆ¶èŠ‚ç‚¹æ›´é è¿‘æ ¹èŠ‚ç‚¹çš„ç»“ç‚¹åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚æ¯”å¦‚çˆ¶ç»“ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚\n å¯¹ä»£ç è¿›è¡Œä¸€ä¸‹è°ƒæ•´ï¼š\nfor(i = p;i != A[i];i = A[i]) A[i] = A[A[i]]; for(j = q;j != A[j];j = A[j]) A[i] = A[A[i]]; ","href":"/notebook/reading_notes/algorithms_in_c/union-find/","title":"å¹¶æŸ¥é›†"},{"content":"","href":"/tags/hugo/","title":"Hugo"},{"content":" æœ¬æ–‡ä¸»è¦æ˜¯æƒ³è®°å½•ä¸€ä¸‹è‡ªå·±åœ¨win10ä¸‹ä½¿ç”¨hugoå’Œgithub pagesæ­å»ºåšå®¢çš„è¿‡ç¨‹ï¼Œå¤‡å¿˜ã€‚ ä¸ºä»€ä¹ˆæˆ‘è¦ç”¨hugoè€Œä¸ç”¨hexoå‘¢,æœ€ä¸»è¦æ˜¯å› ä¸ºhugoæ„å»ºç½‘ç«™çš„é€Ÿåº¦éå¸¸å¿«ï¼Œç›´æ¥ç§’å¥½ã€‚\n ç¯å¢ƒè¦æ±‚  Goè¯­è¨€ Git hugo  æ­å»ºç¯å¢ƒ Goè¯­è¨€  ä¸‹è½½ å¦‚ä½•å®‰è£… æ·»åŠ ç¯å¢ƒå˜é‡ éªŒè¯å®‰è£…  win+Ræ‰“å¼€å‘½ä»¤è¡Œçª—å£ï¼Œè¾“å…¥ï¼š\ngo version å¦‚æœè¾“å‡ºå½“å‰å®‰è£…çš„goè¯­è¨€çš„ç‰ˆæœ¬å·ï¼Œå³å®‰è£…æˆåŠŸã€‚\nGit  how to install Gitä¸­æ–‡æ•™ç¨‹  hugo  å¦‚ä½•å®‰è£… æ·»åŠ hugoç¯å¢ƒå˜é‡ éªŒè¯å®‰è£…  hugo version ç°åœ¨æˆ‘ä»¬éœ€è¦çš„ç¯å¢ƒéƒ½åˆ›å»ºå¥½äº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥åœ¨å»ºç«‹è‡ªå·±çš„ç½‘ç«™äº†ã€‚\nåˆ›å»ºç½‘ç«™ é¦–å…ˆåœ¨æœ¬åœ°å»ºç«‹ä¸€ä¸ªå­˜æ”¾è‡ªå·±ç½‘ç«™çš„æ–‡ä»¶å¤¹ï¼Œç„¶åé€šè¿‡å‘½ä»¤è¡Œè¿›å…¥åˆšæ‰åˆ›å»ºçš„æ–‡ä»¶å¤¹ï¼Œç»§ç»­æ“ä½œã€‚\nå»ºç«‹æ–°ç½‘ç«™mysite # mysiteæ˜¯å°†è¦åˆ›å»ºçš„ç½‘ç«™å hugo new site mysite æ·»åŠ theme # è¿›å…¥mysite cd mysite  é»˜è®¤æƒ…å†µä¸‹hugoç”Ÿæˆçš„ç½‘ç«™æ˜¯æ²¡æœ‰ä»»ä½•themeçš„ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦è‡ªå·±å»ä¸‹è½½themeã€‚ å¦‚æœç½‘é€Ÿå¥½çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§ä¸‹è½½æ‰€æœ‰çš„themesåˆ°themesæ–‡ä»¶å¤¹ä¸‹ï¼š\n git clone --depth 1 --recursive https://github.com/gohugoio/hugoThemes.git themes ä¹Ÿå¯ä»¥åªä¸‹è½½ä¸€ä¸ªtheme\ncd themes # æ²¡æœ‰çš„è¯å°±åˆ›å»ºä¸€ä¸ª ä½¿ç”¨git cloneå‘½ä»¤ä¸‹è½½å•ä¸ªä¸»é¢˜ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š\ngit clone URL_TO_THEME # URL_TO_THEMEæ˜¯themeçš„åœ°å€  æ¯”å¦‚æˆ‘è¦ä¸‹è½½hydeè¿™ä¸ªtheme:\ngit clone https://github.com/spf13/hyde æ·»åŠ å†…å®¹å¹¶å‘å¸ƒç½‘ç«™ åœ¨ç½‘ç«™çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š\nhugo new posts/my-first-article.md è¿™æ ·æˆ‘ä»¬å°±æˆåŠŸçš„å»ºç«‹äº†my-first-articleè¿™ç¯‡æ–‡ç« ï¼Œå®ƒä½äºç½‘ç«™æ ¹ç›®å½•ä¸‹çš„postsæ–‡ä»¶å¤¹é‡Œã€‚éšä¾¿å†™ä½ æƒ³å†™çš„å†…å®¹ï¼Œç„¶åå¯åŠ¨hugoæœåŠ¡å™¨ï¼Œä¸‹é¢-Dè¡¨ç¤ºå½“å‰å†…å®¹ä¸ºè‰ç¨¿ï¼Œ-t hydeè¡¨ç¤ºé‡‡ç”¨hydeä½œä¸ºç½‘ç«™çš„themeï¼š\nhugo setver -D -t hyde ç°åœ¨åœ¨æµè§ˆå™¨è¾“å…¥ï¼šhttp://localhost:1313/ã€‚ç„¶åä½ å°±èƒ½çœ‹åˆ°ä½ åˆšæ‰å†™çš„ç½‘ç«™äº†ã€‚ç°åœ¨ä½ å¯ä»¥ç»§ç»­ä¿®æ”¹my-first-articleçš„å†…å®¹ï¼Œæµè§ˆå™¨ä¼šå®æ—¶æ›´æ–°çš„çš„æ”¹åŠ¨ï¼Œä¸è¿‡è¿™å¯èƒ½å¹¶ä¸ä¼šè¢«ä½ å‘è§‰ï¼Œå› ä¸ºhugoçš„é€Ÿåº¦å®åœ¨æ˜¯å¤ªå¿«äº†ï¼Œå“ˆå“ˆå“ˆã€‚\næ­£å¼å‘å¸ƒ\u0026ndash;æ‰˜ç®¡åˆ°github æœ¬åœ°ç½‘ç«™å»ºå¥½äº†ï¼Œä¸è¿‡ç°åœ¨åªæœ‰ä½ è‡ªå·±èƒ½å¤Ÿçœ‹åˆ°ã€‚å¦‚æœä½ æƒ³è®©åˆ«äººä¹Ÿçœ‹åˆ°ä½ çš„ç½‘ç«™çš„è¯ï¼Œæˆ‘çŒœä½ è‚¯å®šä¸æƒ³ç”¨è‡ªå·±çš„ç”µè„‘åšæœåŠ¡å™¨å§ã€‚è¿™ä¸ªæ—¶å€™ä½ å¯ä»¥åˆ©ç”¨github pagesæ¥éƒ½è¾¾åˆ°ä½ çš„ç›®çš„ã€‚\n å¦‚æœä½ æ²¡æœ‰githubè´¦å·çš„è¯ï¼Œé‚£ä¹ˆé¦–å…ˆæ³¨å†Œgithubã€‚åƒä¸‡åˆ«å¿˜äº†ä½ çš„ç”¨æˆ·åï¼Œåé¢ä¼šç”¨ä¸Šã€‚å‡è®¾æˆ‘çš„ç”¨æˆ·åæ˜¯sarkarã€‚ ç™»å½•github, å»ºç«‹ä¸¤ä¸ªrepositoryã€‚ä¸€ä¸ªæ˜¯å·¥ç¨‹ä»“åº“ï¼ˆå‡å®šä¸ºmysite), ç”¨æ¥å­˜æ”¾hugoå†…å®¹å’Œå…¶ä»–çš„èµ„æºæ–‡ä»¶ã€‚å¦ä¸€ä¸ªå°±æ˜¯sarkar.github.io, è¿™å°±æ˜¯ç”¨æ¥æ”¾ä½ çš„ç½‘ç«™å†…å®¹çš„åœ°æ–¹äº†(è®°å¾—æŠŠè¿™é‡Œçš„å’Œä»¥åçš„sarkaréƒ½æ¢æˆä½ è‡ªå·±çš„githubç”¨æˆ·å)ã€‚ å›åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ä¸‹ï¼Œä¹Ÿå°±æ˜¯mysiteç›®å½•ï¼Œåœ¨è¿™ä¹‹å‰æ‰“å¼€ä½ å‡†å¤‡å‘å¸ƒçš„.mdæ–‡ä»¶ï¼Œå°†draft: falseæ”¹ä¸ºdraft: falseã€‚è¿™æ ·å°±å¯ä»¥æ­£å¼çš„å‘å¸ƒå†…å®¹äº†ï¼Œä¸å†æ˜¯è‰ç¨¿ã€‚ç„¶åæ‰§è¡Œå‘½ä»¤ï¼š  hugo -t hyde --baseUrl=\u0026#34;https://sarkar.github.io\u0026#34; è®°å¾—æŠŠusernameæ¢æˆä½ è‡ªå·±çš„githubç”¨æˆ·åã€‚\n å‘½ä»¤ä¼šåœ¨ç½‘ç«™ç½‘ç«™çš„æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªpublicæ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«äº†hugoç”Ÿæˆçš„æ‰€æœ‰é™æ€é¡µé¢ã€‚æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯æŠŠè¿™ä¸‹é™æ€é¡µé¢ç»™pushåˆ°githubä¸Šå»ã€‚\u0026gt;\n é¦–å…ˆéœ€è¦è¿›åˆ°pulibç›®å½•, ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ncd public # è¿›å…¥publicç›®å½• git init git remote add origin https://github.com/sarkar/sarkar.github.io.git git add -A git commit -m \u0026#34;first commit\u0026#34; git push -u origin master ä¸å‡ºæ„å¤–çš„è¯ï¼Œåº”è¯¥ä¼šå¼¹å‡ºä¸€ä¸ªgithubçš„ç™»é™†çª—å£æˆ–è€…ç±»ä¼¼çš„ä¸œè¥¿ã€‚ç„¶åé™å¾…æœ¬åœ°æ–‡ä»¶å…¨éƒ¨pushå®Œæˆã€‚åˆ°æµè§ˆå™¨è¾“å…¥sarkar.github.ioåº”è¯¥å°±èƒ½è®¿é—®åˆ°äº†åˆšæ‰å»ºç«‹çš„ç½‘ç«™äº†ã€‚\n","href":"/posts/getting_started/building-your-blogsite-with-github-pages-and-hugo/","title":"ç”¨hugoå’Œgithub pagesæ­å»ºä¸ªäººåšå®¢"},{"content":"","href":"/page/","title":"Pages"},{"content":"","href":"/search/","title":"Search"},{"content":"","href":"/series/","title":"Series"}]